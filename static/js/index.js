var fB=Object.create;var op=Object.defineProperty;var zB=Object.getOwnPropertyDescriptor;var LB=Object.getOwnPropertyNames;var EB=Object.getPrototypeOf,AB=Object.prototype.hasOwnProperty;var wB=(x,V)=>()=>(V||x((V={exports:{}}).exports,V),V.exports),jB=(x,V)=>{for(var U in V)op(x,U,{get:V[U],enumerable:!0})},HB=(x,V,U,M)=>{if(V&&typeof V=="object"||typeof V=="function")for(let w of LB(V))!AB.call(x,w)&&w!==U&&op(x,w,{get:()=>V[w],enumerable:!(M=zB(V,w))||M.enumerable});return x};var OB=(x,V,U)=>(U=x!=null?fB(EB(x)):{},HB(V||!x||!x.__esModule?op(U,"default",{value:x,enumerable:!0}):U,x));var pU=wB((Hp,Op)=>{(function(x,V){typeof Hp=="object"&&typeof Op<"u"?Op.exports=V():typeof define=="function"&&define.amd?define(V):(x=typeof globalThis<"u"?globalThis:x||self,x.mapboxgl=V())})(Hp,function(){"use strict";var x,V,U;function M(j,T){if(!x)x=T;else if(!V)V=T;else{var bt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+x+")(sharedChunk); ("+V+")(sharedChunk); self.onerror = null;",Ut={};x(Ut),U=T(Ut),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(U.workerUrl=window.URL.createObjectURL(new Blob([bt],{type:"text/javascript"})))}}M(["exports"],function(j){"use strict";var T=typeof self<"u"?self:{},bt="3.1.2";let Ut,Zt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ut==null){let e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ut=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):e}catch{Ut=e}}return Ut},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Zt.API_URL)return null;try{let e=new URL(Zt.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},Ct={supported:!1,testSupport:function(e){!ue&&Ue&&(Ke?ye(e):Ge=e)}},Ge,Ue,ue=!1,Ke=!1;function ye(e){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ue),e.isContextLost())return;Ct.supported=!0}catch{}e.deleteTexture(t),ue=!0}T.document&&(Ue=T.document.createElement("img"),Ue.onload=function(){Ge&&ye(Ge),Ge=null,Ke=!0},Ue.onerror=function(){ue=!0,Ge=null},Ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Ae="01";function we(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fi=mi;function mi(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=n}mi.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,n=0;n<8;n++){var a=this.sampleCurveX(i)-e;if(Math.abs(a)<t)return i;var l=this.sampleCurveDerivativeX(i);if(Math.abs(l)<1e-6)break;i-=a/l}var o=0,d=1;for(i=e,n=0;n<20&&(a=this.sampleCurveX(i),!(Math.abs(a-e)<t));n++)e>a?o=i:d=i,i=.5*(d-o)+o;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Te=we(Fi),Pe=Qe;function Qe(e,t){this.x=e,this.y=t}Qe.prototype={clone:function(){return new Qe(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),a=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qe.convert=function(e){return e instanceof Qe?e:Array.isArray(e)?new Qe(e[0],e[1]):e};var H=we(Pe);function te(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!te(e[i],t[i]))return!1;return!0}if(typeof e=="object"&&e!==null&&t!==null){if(typeof t!="object"||Object.keys(e).length!==Object.keys(t).length)return!1;for(let i in e)if(!te(e[i],t[i]))return!1;return!0}return e===t}let zi=Math.PI/180,Vi=180/Math.PI;function At(e){return e*zi}function ei(e){return e*Vi}let tn=[[0,0],[1,0],[1,1],[0,1]];function xn(e){if(e<=0)return 0;if(e>=1)return 1;let t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function ha(e){let t=1/0,i=1/0,n=-1/0,a=-1/0;for(let l of e)t=Math.min(t,l.x),i=Math.min(i,l.y),n=Math.max(n,l.x),a=Math.max(a,l.y);return{min:new H(t,i),max:new H(n,a)}}function Ai(e,t,i=0,n=!0){let a=new H(i,i),l=e.sub(a),o=t.add(a),d=[l,new H(o.x,l.y),o,new H(l.x,o.y)];return n&&d.push(l.clone()),d}function en(e,t,i,n){let a=new Te(e,t,i,n);return function(l){return a.solve(l)}}let sn=en(.25,.1,.25,1);function Mt(e,t,i){return Math.min(i,Math.max(t,e))}function pn(e,t,i){return(i=Mt((i-e)/(t-e),0,1))*i*(3-2*i)}function Nn(e,t,i){let n=i-t,a=((e-t)%n+n)%n+t;return a===t?i:a}function Ln(e,t,i){if(!e.length)return i(null,[]);let n=e.length,a=new Array(e.length),l=null;e.forEach((o,d)=>{t(o,(s,r)=>{s&&(l=s),a[d]=r,--n==0&&i(l,a)})})}function Dn(e){let t=[];for(let i in e)t.push(e[i]);return t}function Xt(e,...t){for(let i of t)for(let n in i)e[n]=i[n];return e}function Ci(e,t){let i={};for(let n=0;n<t.length;n++){let a=t[n];a in e&&(i[a]=e[a])}return i}let wa=1;function Wa(){return wa++}function _n(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function gl(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Oo(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Ni(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function ul(e,t){return e.indexOf(t,e.length-t.length)!==-1}function ja(e,t,i){let n={};for(let a in e)n[a]=t.call(i||this,e[a],a,e);return n}function pt(e,t,i){let n={};for(let a in e)t.call(i||this,e[a],a,e)&&(n[a]=e[a]);return n}function k(e){return Array.isArray(e)?e.map(k):typeof e=="object"&&e?ja(e,k):e}let v={};function A(e){v[e]||(typeof console<"u"&&console.warn(e),v[e]=!0)}function dt(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function ct(e){let t=0;for(let i,n,a=0,l=e.length,o=l-1;a<l;o=a++)i=e[a],n=e[o],t+=(n.x-i.x)*(i.y+n.y);return t}function xt([e,t,i]){let n=At(t+90),a=At(i);return{x:e*Math.cos(n)*Math.sin(a),y:e*Math.sin(n)*Math.sin(a),z:e*Math.cos(a),azimuthal:t,polar:i}}function Qt(e,t,i){let n=Math.sqrt(e*e+t*t+i*i),a=n>0?Math.acos(i/n)*Vi:0,l=e!==0||t!==0?Math.atan2(-t,-e)*Vi+90:0;return l<0&&(l+=360),[n,l,a]}function rt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Lt(e){let t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,a,l)=>{let o=a||l;return t[n]=!o||o.toLowerCase(),""}),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let Ht=null;function Kt(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement}function De(e){try{let t=T[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function li(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Ti(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]}function Wi(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function Ii(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}let ii="mapbox-tiles",rn=500,Zn=50,Vn,pa;function Do(){try{return T.caches}catch{}}function Yn(){Do()&&!Vn&&(Vn=T.caches.open(ii))}function Ha(e){let t=e.indexOf("?");if(t<0)return e;let i=function(a){let l=a.indexOf("?");return l>0?a.slice(l+1).split("&"):[]}(e),n=i.filter(a=>{let l=a.split("=");return l[0]==="language"||l[0]==="worldview"});return n.length?"".concat(e.slice(0,t),"?").concat(n.join("&")):e.slice(0,t)}let Rl=1/0;function _o(e){Rl++,Rl>Zn&&(e.getActor().send("enforceCacheSizeLimit",rn),Rl=0)}let nt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(nt);class lt extends Error{constructor(t,i,n){i===401&&pi(n)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}let ht=rt()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,Vt=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(ht())&&!/^\w+:/.test(i))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(n,a){let l=new T.AbortController,o=new T.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:ht(),referrerPolicy:n.referrerPolicy,signal:l.signal}),d=!1,s=!1,r=(c=o.url).indexOf("sku=")>0&&pi(c);var c;n.type==="json"&&o.headers.set("Accept","application/json");let b=(h,W,p)=>{if(s)return;if(h&&h.message!=="SecurityError"&&A(h.toString()),W&&p)return m(W);let Z=Date.now();T.fetch(o).then(g=>{if(g.ok){let u=r?g.clone():null;return m(g,u,Z)}return a(new lt(g.statusText,g.status,n.url))}).catch(g=>{g.name!=="AbortError"&&a(new Error("".concat(g.message," ").concat(n.url)))})},m=(h,W,p)=>{(n.type==="arrayBuffer"?h.arrayBuffer():n.type==="json"?h.json():h.text()).then(Z=>{s||(W&&p&&function(g,u,G){if(Yn(),!Vn)return;let F={status:u.status,statusText:u.statusText,headers:new T.Headers};u.headers.forEach((N,Y)=>F.headers.set(Y,N));let R=Lt(u.headers.get("Cache-Control")||"");if(R["no-store"])return;R["max-age"]&&F.headers.set("Expires",new Date(G+1e3*R["max-age"]).toUTCString());let I=F.headers.get("Expires");I&&(new Date(I).getTime()-G<42e4||function(N,Y){if(pa===void 0)try{new Response(new ReadableStream),pa=!0}catch{pa=!1}pa?Y(N.body):N.blob().then(Y)}(u,N=>{let Y=new T.Response(N,F);Yn(),Vn&&Vn.then(X=>X.put(Ha(g.url),Y)).catch(X=>A(X.message))}))}(o,W,p),d=!0,a(null,Z,h.headers.get("Cache-Control"),h.headers.get("Expires")))}).catch(Z=>{s||a(new Error(Z.message))})};return r?function(h,W){if(Yn(),!Vn)return W(null);let p=Ha(h.url);Vn.then(Z=>{Z.match(p).then(g=>{let u=function(G){if(!G)return!1;let F=new Date(G.headers.get("Expires")||0),R=Lt(G.headers.get("Cache-Control")||"");return F>Date.now()&&!R["no-cache"]}(g);Z.delete(p),u&&Z.put(p,g.clone()),W(null,g,u)}).catch(W)}).catch(W)}(o,b):b(null,null),{cancel:()=>{s=!0,d||l.abort()}}}(e,t);if(rt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(n,a){let l=new T.XMLHttpRequest;l.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(let o in n.headers)l.setRequestHeader(o,n.headers[o]);return n.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=n.credentials==="include",l.onerror=()=>{a(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let o=l.response;if(n.type==="json")try{o=JSON.parse(l.response)}catch(d){return a(d)}a(null,o,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else a(new lt(l.statusText,l.status,n.url))},l.send(n.body),{cancel:()=>l.abort()}}(e,t)},gt=function(e,t){return Vt(Xt(e,{type:"json"}),t)},Ft=function(e,t){return Vt(Xt(e,{type:"arrayBuffer"}),t)};function Nt(e){let t=T.document.createElement("a");return t.href=e,t.protocol===T.document.location.protocol&&t.host===T.document.location.host}let ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",St,It;St=[],It=0;let de=function(e,t){if(Ct.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),It>=Zt.MAX_PARALLEL_IMAGE_REQUESTS){let l={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return St.push(l),l}It++;let i=!1,n=()=>{if(!i)for(i=!0,It--;St.length&&It<Zt.MAX_PARALLEL_IMAGE_REQUESTS;){let l=St.shift(),{requestParameters:o,callback:d,cancelled:s}=l;s||(l.cancel=de(o,d).cancel)}},a=Ft(e,(l,o,d,s)=>{n(),l?t(l):o&&(T.createImageBitmap?function(r,c){let b=new T.Blob([new Uint8Array(r)],{type:"image/png"});T.createImageBitmap(b).then(m=>{c(null,m)}).catch(m=>{c(new Error("Could not load image because of ".concat(m.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(o,(r,c)=>t(r,c,d,s)):function(r,c){let b=new T.Image,m=T.URL;b.onload=()=>{c(null,b),m.revokeObjectURL(b.src),b.onload=null,T.requestAnimationFrame(()=>{b.src=ut})},b.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let h=new T.Blob([new Uint8Array(r)],{type:"image/png"});b.src=r.byteLength?m.createObjectURL(h):ut}(o,(r,c)=>t(r,c,d,s)))});return{cancel:()=>{a.cancel(),n()}}},je="NO_ACCESS_TOKEN";class wt{constructor(t,i,n){this._transformRequestFn=t,this._customAccessToken=i,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let i="";for(let n=0;n<10;n++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ae,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,i){return this._transformRequestFn&&this._transformRequestFn(t,i)||{url:t}}normalizeStyleURL(t,i){if(!ve(t))return t;let n=wi(t);return n.params.push("sdk=js-".concat(bt)),n.path="/styles/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||i)}normalizeGlyphsURL(t,i){if(!ve(t))return t;let n=wi(t);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||i)}normalizeModelURL(t,i){if(!ve(t))return t;let n=wi(t);return n.path="/models/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||i)}normalizeSourceURL(t,i,n,a){if(!ve(t))return t;let l=wi(t);return l.path="/v4/".concat(l.authority,".json"),l.params.push("secure"),n&&l.params.push("language=".concat(n)),a&&l.params.push("worldview=".concat(a)),this._makeAPIURL(l,this._customAccessToken||i)}normalizeSpriteURL(t,i,n,a){let l=wi(t);return ve(t)?(l.path="/styles/v1".concat(l.path,"/sprite").concat(i).concat(n),this._makeAPIURL(l,this._customAccessToken||a)):(l.path+="".concat(i).concat(n),gn(l))}normalizeTileURL(t,i,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ve(t))return t;let a=wi(t);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(i||n&&a.authority!=="raster"&&n===512?"@2x":"").concat(Ct.supported?".webp":"$1")),a.authority==="raster"?a.path="/".concat(Zt.RASTER_URL_PREFIX).concat(a.path):(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path="/".concat(Zt.TILE_URL_VERSION).concat(a.path));let l=this._customAccessToken||function(o){for(let d of o){let s=d.match(/^access_token=(.*)$/);if(s)return s[1]}return null}(a.params)||Zt.ACCESS_TOKEN;return Zt.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&a.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(a,l)}canonicalizeTileURL(t,i){let n=wi(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let a="mapbox://";n.path.match(/^\/raster\/v1\//)?a+="raster/".concat(n.path.replace("/".concat(Zt.RASTER_URL_PREFIX,"/"),"")):a+="tiles/".concat(n.path.replace("/".concat(Zt.TILE_URL_VERSION,"/"),""));let l=n.params;return i&&(l=l.filter(o=>!o.match(/^access_token=/))),l.length&&(a+="?".concat(l.join("&"))),a}canonicalizeTileset(t,i){let n=!!i&&ve(i),a=[];for(let l of t.tiles||[])pi(l)?a.push(this.canonicalizeTileURL(l,n)):a.push(l);return a}_makeAPIURL(t,i){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=wi(Zt.API_URL);if(t.protocol=a.protocol,t.authority=a.authority,t.protocol==="http"){let l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(a.path!=="/"&&(t.path="".concat(a.path).concat(t.path)),!Zt.REQUIRE_ACCESS_TOKEN)return gn(t);if(i=i||Zt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if(i[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push("access_token=".concat(i||"")),gn(t)}}function ve(e){return e.indexOf("mapbox:")===0}function pi(e){return Zt.API_URL_REGEX.test(e)}function Ui(e){return Zt.API_CDN_URL_REGEX.test(e)}function ki(e){return Zt.API_STYLE_REGEX.test(e)&&!cn(e)}function cn(e){return Zt.API_SPRITE_REGEX.test(e)}let Kn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wi(e){let t=e.match(Kn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function gn(e){let t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}let bn="mapbox.eventData";function Ko(e){if(!e)return null;let t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Gl{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let i=Ko(Zt.ACCESS_TOKEN),n="";return n=i&&i.u?T.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,l)=>String.fromCharCode(+("0x"+l)))):Zt.ACCESS_TOKEN||"",t?"".concat(bn,".").concat(t,":").concat(n):"".concat(bn,":").concat(n)}fetchEventData(){let t=De("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{let a=T.localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));let l=T.localStorage.getItem(n);l&&(this.anonId=l)}catch{A("Unable to read from LocalStorage")}}saveEventData(){let t=De("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{T.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{A("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,n,a){if(!Zt.EVENTS_URL)return;let l=wi(Zt.EVENTS_URL);l.params.push("access_token=".concat(a||Zt.ACCESS_TOKEN||""));let o={event:this.type,created:new Date(t).toISOString()},d=i?Xt(o,i):o,s={url:gn(l),headers:{"Content-Type":"text/plain"},body:JSON.stringify([d])};this.pendingRequest=function(r,c){return Vt(Xt(r,{method:"POST"}),c)}(s,r=>{this.pendingRequest=null,n(r),this.saveEventData(),this.processRequests(a)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}let Po=new class extends Gl{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){Zt.EVENTS_URL&&Zt.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>ve(i)||pi(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=Ko(Zt.ACCESS_TOKEN),i=t?t.u:Zt.ACCESS_TOKEN,n=i!==this.eventData.tokenU;Oo(this.anonId)||(this.anonId=_n(),n=!0);let a=this.queue.shift();if(this.eventData.lastSuccess){let l=new Date(this.eventData.lastSuccess),o=new Date(a),d=(a-this.eventData.lastSuccess)/864e5;n=n||d>=1||d<-1||l.getDate()!==o.getDate()}else n=!0;n?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:bt,skuId:Ae,"enabled.telemetry":!1,userId:this.anonId},l=>{l||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},e):this.processRequests()}},Gm=Po.postTurnstileEvent.bind(Po),Dp=new class extends Gl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,Zt.EVENTS_URL&&(i||Zt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(je)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Oo(this.anonId)||(this.anonId=_n()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:bt,skuId:Ae,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):t&&(this.success[t]=!0)},e))}},GU=Dp.postMapLoadEvent.bind(Dp),_p=new class extends Gl{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){Zt.EVENTS_URL&&(e||Zt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:i}=this.queue.shift(),n=function(a){let l=T.performance.getEntriesByType("resource"),o=T.performance.getEntriesByType("mark"),d=function(m){let h={};if(m){for(let W in m)if(W!=="other")for(let p of m[W]){let Z="".concat(W,"ResolveRangeMin"),g="".concat(W,"ResolveRangeMax"),u="".concat(W,"RequestCount"),G="".concat(W,"RequestCachedCount");h[Z]=Math.min(h[Z]||1/0,p.startTime),h[g]=Math.max(h[g]||-1/0,p.responseEnd);let F=R=>{h[R]===void 0&&(h[R]=0),++h[R]};p.transferSize!==void 0&&p.transferSize===0&&F(G),F(u)}}return h}(function(m,h){let W={};if(m)for(let p of m){let Z=h(p);W[Z]===void 0&&(W[Z]=[]),W[Z].push(p)}return W}(l,UU)),s=T.devicePixelRatio,r=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,c={counters:[],metadata:[],attributes:[]},b=(m,h,W)=>{W!=null&&m.push({name:h,value:W.toString()})};for(let m in d)b(c.counters,m,d[m]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(b(c.counters,"interactionRangeMin",a.interactionRange[0]),b(c.counters,"interactionRangeMax",a.interactionRange[1])),o)for(let m of Object.keys(Cr)){let h=Cr[m],W=o.find(p=>p.name===h);W&&b(c.counters,h,W.startTime)}return b(c.counters,"visibilityHidden",a.visibilityHidden),b(c.attributes,"style",function(m){if(m)for(let h of m){let W=h.name.split("?")[0];if(ki(W)){let p=W.split("/").slice(-2);if(p.length===2)return"mapbox://styles/".concat(p[0],"/").concat(p[1])}}}(l)),b(c.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),b(c.attributes,"fogEnabled",a.fogEnabled?"true":"false"),b(c.attributes,"projection",a.projection),b(c.attributes,"zoom",a.zoom),b(c.metadata,"devicePixelRatio",s),b(c.metadata,"connectionEffectiveType",r?r.effectiveType:void 0),b(c.metadata,"navigatorUserAgent",T.navigator.userAgent),b(c.metadata,"screenWidth",T.screen.width),b(c.metadata,"screenHeight",T.screen.height),b(c.metadata,"windowWidth",T.innerWidth),b(c.metadata,"windowHeight",T.innerHeight),b(c.metadata,"mapWidth",a.width/s),b(c.metadata,"mapHeight",a.height/s),b(c.metadata,"webglRenderer",a.renderer),b(c.metadata,"webglVendor",a.vendor),b(c.metadata,"sdkVersion",bt),b(c.metadata,"sdkIdentifier","mapbox-gl-js"),c}(i);for(let a of n.metadata);for(let a of n.counters);for(let a of n.attributes);this.postEvent(t,n,()=>{},e)}},FU=_p.postPerformanceEvent.bind(_p),Kp=new class extends Gl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!Zt.API_URL||!Zt.SESSION_PATH)return;let a=wi(Zt.API_URL+Zt.SESSION_PATH);a.params.push("sku=".concat(t||"")),a.params.push("access_token=".concat(n||Zt.ACCESS_TOKEN||""));let l={url:gn(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(o,d){return Vt(Xt(o,{method:"GET"}),d)}(l,o=>{this.pendingRequest=null,i(o),this.saveEventData(),this.processRequests(n)})}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,Zt.SESSION_PATH&&Zt.API_URL&&(i||Zt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(je)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,n=>{n?this.errorCb(n):t&&(this.success[t]=!0)},e)}},IU=Kp.getSessionAPI.bind(Kp),Mr=new Set;function Pp(e,t){t?Mr.add(e):Mr.delete(e)}let Cr={create:"create",load:"load",fullLoad:"fullLoad"},qp={mark(e){T.performance.mark(e)},measure(e,t,i){T.performance.measure(e,t,i)}};function UU(e){let t=e.name.split("?")[0];return Ui(t)&&t.includes("mapbox-gl.js")?"javascript":Ui(t)&&t.includes("mapbox-gl.css")?"css":function(i){return Zt.API_FONTS_REGEX.test(i)}(t)?"fontRange":cn(t)?"sprite":ki(t)?"style":function(i){return Zt.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}let xU=T.performance;function $p(e){let t=e?e.url.toString():void 0;return xU.getEntriesByName(t)}var t1=Fm;function Fm(e){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var n,a,l=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(l);try{a=new Worker(o),n=!0}catch{n=!1}return a&&a.terminate(),URL.revokeObjectURL(o),n}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var n=document.createElement("canvas");n.width=n.height=1;var a=n.getContext("2d");if(!a)return!1;var l=a.getImageData(0,0,1,1);return l&&l.width===n.width}()?(Im[i=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Im[i]=function(n){var a,l=function(o){var d=document.createElement("canvas"),s=Object.create(Fm.webGLContextAttributes);return s.failIfMajorPerformanceCaveat=o,d.getContext("webgl",s)||d.getContext("experimental-webgl",s)}(n);if(!l)return!1;try{a=l.createShader(l.VERTEX_SHADER)}catch{return!1}return!(!a||l.isContextLost())&&(l.shaderSource(a,"void main() {}"),l.compileShader(a),l.getShaderParameter(a,l.COMPILE_STATUS)===!0)}(i)),Im[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i}(e)}var Im={};let Um,Tr,xm,kr,lo;function e1(){return Um==null&&(Um=T.OffscreenCanvas&&new T.OffscreenCanvas(1,1).getContext("2d")&&typeof T.createImageBitmap=="function"),Um}Fm.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let ee={now:()=>kr!==void 0?kr:T.performance.now(),setNow(e){kr=e},restoreNow(){kr=void 0},frame(e){let t=T.requestAnimationFrame(e);return{cancel:()=>T.cancelAnimationFrame(t)}},getImageData(e,t=0){let{width:i,height:n}=e;lo||(lo=T.document.createElement("canvas"));let a=lo.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>lo.width||n>lo.height)&&(lo.width=i,lo.height=n),a.clearRect(-t,-t,i+2*t,n+2*t),a.drawImage(e,0,0,i,n),a.getImageData(-t,-t,i+2*t,n+2*t)},resolveURL:e=>(Tr||(Tr=T.document.createElement("a")),Tr.href=e,Tr.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(xm==null&&(xm=T.matchMedia("(prefers-reduced-motion: reduce)")),xm.matches)},hasCanvasFingerprintNoise(){if(!e1())return!1;let e=new T.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0}),i=0;for(let a=0;a<e.width;++a)t.fillStyle="rgba(".concat(i++,",").concat(i++,",").concat(i++,", 255)"),t.fillRect(a,0,1,1);let n=t.getImageData(0,0,e.width,e.height);i=0;for(let a=0;a<n.data.length;++a)if(a%4!=3&&i++!==n.data[a])return!0;return!1}};function qe(e,t,i){let n=T.document.createElement(e);return t!==void 0&&(n.className=t),i&&i.appendChild(n),n}function Oa(e,t,i){let n=T.document.createElementNS("http://www.w3.org/2000/svg",e);for(let a of Object.keys(t))n.setAttributeNS(null,a,t[a]);return i&&i.appendChild(n),n}let oo=T.document&&T.document.documentElement.style,ls=oo&&oo.userSelect!==void 0?"userSelect":"WebkitUserSelect",i1;function n1(){oo&&ls&&(i1=oo[ls],oo[ls]="none")}function a1(){oo&&ls&&(oo[ls]=i1)}function Nm(e){e.preventDefault(),e.stopPropagation(),T.removeEventListener("click",Nm,!0)}function Ym(){T.addEventListener("click",Nm,!0),T.setTimeout(()=>{T.removeEventListener("click",Nm,!0)},0)}function os(e,t){let i=e.getBoundingClientRect();return o1(e,i,t)}function Sr(e,t){let i=e.getBoundingClientRect(),n=[];for(let a=0;a<t.length;a++)n.push(o1(e,i,t[a]));return n}function l1(e){return T.InstallTrigger!==void 0&&e.button===2&&e.ctrlKey&&T.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function o1(e,t,i){let n=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new H((i.clientX-t.left)*n,(i.clientY-t.top)*n)}function d1(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function Xm(e,t,i){if(i&&i[e]){let n=i[e].indexOf(t);n!==-1&&i[e].splice(n,1)}}class Wt{constructor(t,i={}){Xt(this,i),this.type=t}}class $t extends Wt{constructor(t,i={}){super("error",Xt({error:t},i))}}class Xi{on(t,i){return this._listeners=this._listeners||{},d1(t,i,this._listeners),this}off(t,i){return Xm(t,i,this._listeners),Xm(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},d1(t,i,this._oneTimeListeners),this):new Promise(n=>this.once(t,n))}fire(t,i){typeof t=="string"&&(t=new Wt(t,i||{}));let n=t.type;if(this.listens(n)){t.target=this;let a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let d of a)d.call(this,t);let l=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let d of l)Xm(n,d,this._oneTimeListeners),d.call(this,t);let o=this._eventedParent;o&&(Xt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(t))}else t instanceof $t&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var _=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Tt{constructor(t,i,n,a){this.message=(t?"".concat(t,": "):"")+n,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}class so extends Tt{}function Da(e,...t){for(let i of t)for(let n in i)e[n]=i[n];return e}function Si(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function _a(e){if(Array.isArray(e))return e.map(_a);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let t={};for(let i in e)t[i]=_a(e[i]);return t}return Si(e)}class NU extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var Xa=NU;class Jm{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[n,a]of i)this.bindings[n]=a}concat(t){return new Jm(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error("".concat(t," not found in scope."))}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var YU=Jm;let qo={kind:"null"},yt={kind:"number"},Ye={kind:"string"},Me={kind:"boolean"},Pn={kind:"color"},$o={kind:"object"},Je={kind:"value"},Qr={kind:"collator"},ds={kind:"formatted"},ss={kind:"resolvedImage"};function Xn(e,t){return{kind:"array",itemType:e,N:t}}function Ji(e){if(e.kind==="array"){let t=Ji(e.itemType);return typeof e.N=="number"?"array<".concat(t,", ").concat(e.N,">"):e.itemType.kind==="value"?"array":"array<".concat(t,">")}return e.kind}let XU=[qo,yt,Ye,Me,Pn,ds,$o,Xn(Je),ss];function rs(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!rs(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(let i of XU)if(!rs(i,t))return null}}return"Expected ".concat(Ji(e)," but found ").concat(Ji(t)," instead.")}function ym(e,t){return t.some(i=>i.kind===e.kind)}function cs(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}var Bm,s1={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vr(e){return(e=Math.round(e))<0?0:e>255?255:e}function Mm(e){return vr(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function fr(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Cm(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{Bm={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in s1)return s1[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=i.indexOf("("),a=i.indexOf(")");if(n!==-1&&a+1===i.length){var l=i.substr(0,n),o=i.substr(n+1,a-(n+1)).split(","),d=1;switch(l){case"rgba":if(o.length!==4)return null;d=fr(o.pop());case"rgb":return o.length!==3?null:[Mm(o[0]),Mm(o[1]),Mm(o[2]),d];case"hsla":if(o.length!==4)return null;d=fr(o.pop());case"hsl":if(o.length!==3)return null;var s=(parseFloat(o[0])%360+360)%360/360,r=fr(o[1]),c=fr(o[2]),b=c<=.5?c*(r+1):c+r-c*r,m=2*c-b;return[vr(255*Cm(m,b,s+1/3)),vr(255*Cm(m,b,s)),vr(255*Cm(m,b,s-1/3)),d];default:return null}}return null}}catch{}class Jn{constructor(t,i,n,a=1){this.r=t,this.g=i,this.b=n,this.a=a}static parse(t){if(!t)return;if(t instanceof Jn)return t;if(typeof t!="string")return;let i=Bm(t);return i?new Jn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[t,i,n,a]=this.toArray();return"rgba(".concat(Math.round(t),",").concat(Math.round(i),",").concat(Math.round(n),",").concat(a,")")}toArray(){let{r:t,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[255*t/a,255*i/a,255*n/a,a]}toArray01(){let{r:t,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[t/a,i/a,n/a,a]}toArray01Scaled(t){let{r:i,g:n,b:a,a:l}=this;return l===0?[0,0,0]:[i/l*t,n/l*t,a/l*t]}toArray01PremultipliedAlpha(){let{r:t,g:i,b:n,a}=this;return[t,i,n,a]}toArray01Linear(){let{r:t,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[Math.pow(t/a,2.2),Math.pow(i/a,2.2),Math.pow(n/a,2.2),a]}}Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1),Jn.blue=new Jn(0,0,1,1);var re=Jn;class Tm{constructor(t,i,n){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class km{constructor(t,i,n,a,l){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=n,this.fontStack=a,this.textColor=l}}class yn{constructor(t){this.sections=t}static fromString(t){return new yn([new km(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof yn?t:yn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let i of this.sections){if(i.image){t.push(["image",i.image.namePrimary]);continue}t.push(i.text);let n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(n)}return t}}class qn{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?"[".concat(this.namePrimary,",").concat(this.nameSecondary,"]"):this.namePrimary}static fromString(t,i){return t?new qn({namePrimary:t,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function r1(e,t,i,n){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:"Invalid rgba value [".concat([e,t,i,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat((typeof n=="number"?[e,t,i,n]:[e,t,i]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function td(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof re||e instanceof Tm||e instanceof yn||e instanceof qn)return!0;if(Array.isArray(e)){for(let t of e)if(!td(t))return!1;return!0}if(typeof e=="object"){for(let t in e)if(!td(e[t]))return!1;return!0}return!1}function ji(e){if(e===null)return qo;if(typeof e=="string")return Ye;if(typeof e=="boolean")return Me;if(typeof e=="number")return yt;if(e instanceof re)return Pn;if(e instanceof Tm)return Qr;if(e instanceof yn)return ds;if(e instanceof qn)return ss;if(Array.isArray(e)){let t=e.length,i;for(let n of e){let a=ji(n);if(i){if(i===a)continue;i=Je;break}i=a}return Xn(i||Je,t)}return $o}function bs(e){let t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof re||e instanceof yn||e instanceof qn?e.toString():JSON.stringify(e)}class Sm{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!td(t[1]))return i.error("invalid value");let n=t[1],a=ji(n),l=i.expectedType;return a.kind!=="array"||a.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(a=l),new Sm(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof re?["rgba"].concat(this.value.toArray()):this.value instanceof yn?this.value.serialize():this.value}}var ms=Sm,Pi=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};let Qm={string:Ye,number:yt,boolean:Me,object:$o};class vm{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n,a=1,l=t[0];if(l==="array"){let d,s;if(t.length>2){let r=t[1];if(typeof r!="string"||!(r in Qm)||r==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);d=Qm[r],a++}else d=Je;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);s=t[2],a++}n=Xn(d,s)}else n=Qm[l];let o=[];for(;a<t.length;a++){let d=i.parse(t[a],a,Je);if(!d)return null;o.push(d)}return new vm(n,o)}evaluate(t){for(let i=0;i<this.args.length;i++){let n=this.args[i].evaluate(t);if(!rs(this.type,ji(n)))return n;if(i===this.args.length-1)throw new Pi("Expected value to be of type ".concat(Ji(this.type),", but found ").concat(Ji(ji(n))," instead."))}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,i=[t.kind];if(t.kind==="array"){let n=t.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){i.push(n.kind);let a=t.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(n=>n.serialize()))}}var Ka=vm;class hs{constructor(t){this.type=ds,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=t[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");let a=[],l=!1;for(let o=1;o<=t.length-1;++o){let d=t[o];if(l&&typeof d=="object"&&!Array.isArray(d)){l=!1;let s=null;if(d["font-scale"]&&(s=i.parse(d["font-scale"],1,yt),!s))return null;let r=null;if(d["text-font"]&&(r=i.parse(d["text-font"],1,Xn(Ye)),!r))return null;let c=null;if(d["text-color"]&&(c=i.parse(d["text-color"],1,Pn),!c))return null;let b=a[a.length-1];b.scale=s,b.font=r,b.textColor=c}else{let s=i.parse(t[o],1,Je);if(!s)return null;let r=s.type.kind;if(r!=="string"&&r!=="value"&&r!=="null"&&r!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,a.push({content:s,scale:null,font:null,textColor:null})}}return new hs(a)}evaluate(t){return new yn(this.sections.map(i=>{let n=i.content.evaluate(t);return ji(n)===ss?new km("",n,null,null,null):new km(bs(n),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let i of this.sections){t.push(i.content.serialize());let n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),t.push(n)}return t}}class Ws{constructor(t,i){this.type=ss,this.inputPrimary=t,this.inputSecondary=i}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");let n=i.parse(t[1],1,Ye);if(!n)return i.error("No image name provided.");if(t.length===2)return new Ws(n);let a=i.parse(t[2],1,Ye);return a?new Ws(n,a):i.error("Secondary image variant is not a string.")}evaluate(t){let i=qn.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&t.availableImages&&(i.available=t.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function fe(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}let JU={"to-boolean":Me,"to-color":Pn,"to-number":yt,"to-string":Ye};class fm{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=t[0],a=[],l=qo;if(n==="to-array"){if(!Array.isArray(t[1]))return null;let o=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error("Expected ".concat(i.expectedType.kind," but found array."));l=Xn(i.expectedType.itemType,o)}else{if(!(o>0&&td(t[1][0])))return null;l=Xn(ji(t[1][0]),o)}for(let d=0;d<o;d++){let s=t[1][d],r;if(fe(s)==="array")r=i.parse(s,void 0,l.itemType);else{let c=fe(s);if(c!==l.itemType.kind)return i.error("Expected ".concat(l.itemType.kind," but found ").concat(c,"."));r=i.registry.literal.parse(["literal",s===void 0?null:s],i)}if(!r)return null;a.push(r)}}else{if((n==="to-boolean"||n==="to-string")&&t.length!==2)return i.error("Expected one argument.");l=JU[n];for(let o=1;o<t.length;o++){let d=i.parse(t[o],o,Je);if(!d)return null;a.push(d)}}return new fm(l,a)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,n;for(let a of this.args){if(i=a.evaluate(t),n=null,i instanceof re)return i;if(typeof i=="string"){let l=t.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?"Invalid rbga value ".concat(JSON.stringify(i),": expected an array containing either three or four numeric values."):r1(i[0],i[1],i[2],i[3]),!n))return new re(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Pi(n||"Could not parse color from value '".concat(typeof i=="string"?i:String(JSON.stringify(i)),"'"))}if(this.type.kind==="number"){let i=null;for(let n of this.args){if(i=n.evaluate(t),i===null)return 0;let a=Number(i);if(!isNaN(a))return a}throw new Pi("Could not convert ".concat(JSON.stringify(i)," to number."))}return this.type.kind==="formatted"?yn.fromString(bs(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?qn.fromString(bs(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):bs(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new hs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ws(this.args[0]).serialize();let t=this.type.kind==="array"?[]:["to-".concat(this.type.kind)];return this.eachChild(i=>{t.push(i.serialize())}),t}}var ro=fm;let yU=["Unknown","Point","LineString","Polygon"];var c1=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yU[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=re.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class co{constructor(t,i,n,a,l){this.name=t,this.type=i,this._evaluate=n,this.args=a,this._overloadIndex=l}evaluate(t){if(!this._evaluate){let i=co.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){let n=t[0],a=co.definitions[n];if(!a)return i.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);let l=Array.isArray(a)?a[0]:a.type,o=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,d=[],s=null,r=-1;for(let[c,b]of o){if(Array.isArray(c)&&c.length!==t.length-1)continue;d.push(c),r++,s=new Y1(i.registry,i.path,null,i.scope,void 0,i.options);let m=[],h=!1;for(let W=1;W<t.length;W++){let p=t[W],Z=Array.isArray(c)?c[W-1]:c.type,g=s.parse(p,1+m.length,Z);if(!g){h=!0;break}m.push(g)}if(!h)if(Array.isArray(c)&&c.length!==m.length)s.error("Expected ".concat(c.length," arguments, but found ").concat(m.length," instead."));else{for(let W=0;W<m.length;W++){let p=Array.isArray(c)?c[W]:c.type,Z=m[W];s.concat(W+1).checkSubtype(p,Z.type)}if(s.errors.length===0)return new co(n,l,b,m,r)}}if(d.length===1)i.errors.push(...s.errors);else{let c=(d.length?d:o.map(([m])=>m)).map(BU).join(" | "),b=[];for(let m=1;m<t.length;m++){let h=i.parse(t[m],1+b.length);if(!h)return null;b.push(Ji(h.type))}i.error("Expected arguments of type ".concat(c,", but found (").concat(b.join(", "),") instead."))}return null}static register(t,i){co.definitions=i;for(let n in i)t[n]=co}}function BU(e){return Array.isArray(e)?"(".concat(e.map(Ji).join(", "),")"):"(".concat(Ji(e.type),"...)")}var Ja=co;class zr{constructor(t,i,n){this.type=Qr,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let n=t[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");let a=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Me);if(!a)return null;let l=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Me);if(!l)return null;let o=null;return n.locale&&(o=i.parse(n.locale,1,Ye),!o)?null:new zr(a,l,o)}evaluate(t){return new Tm(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var b1={exports:{}};b1.exports=function(){function e(n,a,l,o,d){for(;o>l;){if(o-l>600){var s=o-l+1,r=a-l+1,c=Math.log(s),b=.5*Math.exp(2*c/3),m=.5*Math.sqrt(c*b*(s-b)/s)*(r-s/2<0?-1:1);e(n,a,Math.max(l,Math.floor(a-r*b/s+m)),Math.min(o,Math.floor(a+(s-r)*b/s+m)),d)}var h=n[a],W=l,p=o;for(t(n,l,a),d(n[o],h)>0&&t(n,l,o);W<p;){for(t(n,W,p),W++,p--;d(n[W],h)<0;)W++;for(;d(n[p],h)>0;)p--}d(n[l],h)===0?t(n,l,p):t(n,++p,o),p<=a&&(l=p+1),a<=p&&(o=p-1)}}function t(n,a,l){var o=n[a];n[a]=n[l],n[l]=o}function i(n,a){return n<a?-1:n>a?1:0}return function(n,a,l,o,d){e(n,a,l||0,o||n.length-1,d||i)}}();var MU=we(b1.exports);function CU(e){let t=0;for(let i,n,a=0,l=e.length,o=l-1;a<l;o=a++)i=e[a],n=e[o],t+=(n.x-i.x)*(i.y+n.y);return t}function ps(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Zs(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function TU(e,t,i){let n=e[0]-t[0],a=e[1]-t[1],l=e[0]-i[0],o=e[1]-i[1];return n*o-l*a==0&&n*l<=0&&a*o<=0}function ed(e,t,i=!1){let n=!1;for(let d=0,s=t.length;d<s;d++){let r=t[d];for(let c=0,b=r.length,m=b-1;c<b;m=c++){let h=r[m],W=r[c];if(TU(e,h,W))return i;(l=h)[1]>(a=e)[1]!=(o=W)[1]>a[1]&&a[0]<(o[0]-l[0])*(a[1]-l[1])/(o[1]-l[1])+l[0]&&(n=!n)}}var a,l,o;return n}function m1(e,t,i,n){let a=n[0]-i[0],l=n[1]-i[1],o=(e[0]-i[0])*l-a*(e[1]-i[1]),d=(t[0]-i[0])*l-a*(t[1]-i[1]);return o>0&&d<0||o<0&&d>0}function Lr(e,t,i,n){return(a=[n[0]-i[0],n[1]-i[1]])[0]*(l=[t[0]-e[0],t[1]-e[1]])[1]-a[1]*l[0]!=0&&!(!m1(e,t,i,n)||!m1(i,n,e,t));var a,l}let Fl=8192;function kU(e,t){let i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,a=Math.pow(2,t.z);return[Math.round(i*a*Fl),Math.round(n*a*Fl)]}function SU(e,t){for(let i=0;i<t.length;i++)if(ed(e,t[i]))return!0;return!1}function QU(e,t,i){for(let n of i)for(let a=0,l=n.length,o=l-1;a<l;o=a++)if(Lr(e,t,n[o],n[a]))return!0;return!1}function h1(e,t){for(let i=0;i<e.length;++i)if(!ed(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(QU(e[i],e[i+1],t))return!1;return!0}function vU(e,t){for(let i=0;i<t.length;i++)if(h1(e,t[i]))return!0;return!1}function zm(e,t,i){let n=[];for(let a=0;a<e.length;a++){let l=[];for(let o=0;o<e[a].length;o++){let d=kU(e[a][o],i);ps(t,d),l.push(d)}n.push(l)}return n}function W1(e,t,i){let n=[];for(let a=0;a<e.length;a++){let l=zm(e[a],t,i);n.push(l)}return n}function p1(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){let a=.5*n,l=e[0]-i[0]>a?-n:i[0]-e[0]>a?n:0;l===0&&(l=e[0]-i[2]>a?-n:i[2]-e[0]>a?n:0),e[0]+=l}ps(t,e)}function Z1(e,t,i,n){let a=Math.pow(2,n.z)*Fl,l=[n.x*Fl,n.y*Fl],o=[];if(!e)return o;for(let d of e)for(let s of d){let r=[s.x+l[0],s.y+l[1]];p1(r,t,i,a),o.push(r)}return o}function V1(e,t,i,n){let a=Math.pow(2,n.z)*Fl,l=[n.x*Fl,n.y*Fl],o=[];if(!e)return o;for(let s of e){let r=[];for(let c of s){let b=[c.x+l[0],c.y+l[1]];ps(t,b),r.push(b)}o.push(r)}if(t[2]-t[0]<=a/2){(d=t)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(let s of o)for(let r of s)p1(r,t,i,a)}var d;return o}class Vs{constructor(t,i){this.type=Me,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(td(t[1])){let n=t[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){let l=n.features[a].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Vs(n,n.features[a].geometry)}else if(n.type==="Feature"){let a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Vs(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Vs(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,n){let a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],o=i.canonicalID();if(!o)return!1;if(n.type==="Polygon"){let d=zm(n.coordinates,l,o),s=Z1(i.geometry(),a,l,o);if(!Zs(a,l))return!1;for(let r of s)if(!ed(r,d))return!1}if(n.type==="MultiPolygon"){let d=W1(n.coordinates,l,o),s=Z1(i.geometry(),a,l,o);if(!Zs(a,l))return!1;for(let r of s)if(!SU(r,d))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,n){let a=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],o=i.canonicalID();if(!o)return!1;if(n.type==="Polygon"){let d=zm(n.coordinates,l,o),s=V1(i.geometry(),a,l,o);if(!Zs(a,l))return!1;for(let r of s)if(!h1(r,d))return!1}if(n.type==="MultiPolygon"){let d=W1(n.coordinates,l,o),s=V1(i.geometry(),a,l,o);if(!Zs(a,l))return!1;for(let r of s)if(!vU(r,d))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Lm=Vs,g1={exports:{}};g1.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,i=t*(2-t),n=Math.PI/180,a=function(r,c){if(r===void 0)throw new Error("No latitude given.");if(c&&!e[c])throw new Error("Unknown unit "+c+". Use one of: "+Object.keys(e).join(", "));var b=6378.137*n*(c?e[c]:1),m=Math.cos(r*n),h=1/(1-i*(1-m*m)),W=Math.sqrt(h);this.kx=b*W*m,this.ky=b*W*h*(1-i)},l={units:{configurable:!0}};function o(r,c){return r[0]===c[0]&&r[1]===c[1]}function d(r,c,b){var m=s(c[0]-r[0]);return[r[0]+m*b,r[1]+(c[1]-r[1])*b]}function s(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}return a.fromTile=function(r,c,b){var m=Math.PI*(1-2*(r+.5)/Math.pow(2,c)),h=Math.atan(.5*(Math.exp(m)-Math.exp(-m)))/n;return new a(h,b)},l.units.get=function(){return e},a.prototype.distance=function(r,c){var b=s(r[0]-c[0])*this.kx,m=(r[1]-c[1])*this.ky;return Math.sqrt(b*b+m*m)},a.prototype.bearing=function(r,c){var b=s(c[0]-r[0])*this.kx;return Math.atan2(b,(c[1]-r[1])*this.ky)/n},a.prototype.destination=function(r,c,b){var m=b*n;return this.offset(r,Math.sin(m)*c,Math.cos(m)*c)},a.prototype.offset=function(r,c,b){return[r[0]+c/this.kx,r[1]+b/this.ky]},a.prototype.lineDistance=function(r){for(var c=0,b=0;b<r.length-1;b++)c+=this.distance(r[b],r[b+1]);return c},a.prototype.area=function(r){for(var c=0,b=0;b<r.length;b++)for(var m=r[b],h=0,W=m.length,p=W-1;h<W;p=h++)c+=s(m[h][0]-m[p][0])*(m[h][1]+m[p][1])*(b?-1:1);return Math.abs(c)/2*this.kx*this.ky},a.prototype.along=function(r,c){var b=0;if(c<=0)return r[0];for(var m=0;m<r.length-1;m++){var h=r[m],W=r[m+1],p=this.distance(h,W);if((b+=p)>c)return d(h,W,(c-(b-p))/p)}return r[r.length-1]},a.prototype.pointToSegmentDistance=function(r,c,b){var m=c[0],h=c[1],W=s(b[0]-m)*this.kx,p=(b[1]-h)*this.ky,Z=0;return W===0&&p===0||((Z=(s(r[0]-m)*this.kx*W+(r[1]-h)*this.ky*p)/(W*W+p*p))>1?(m=b[0],h=b[1]):Z>0&&(m+=W/this.kx*Z,h+=p/this.ky*Z)),W=s(r[0]-m)*this.kx,p=(r[1]-h)*this.ky,Math.sqrt(W*W+p*p)},a.prototype.pointOnLine=function(r,c){for(var b,m,h,W,p=1/0,Z=0;Z<r.length-1;Z++){var g=r[Z][0],u=r[Z][1],G=s(r[Z+1][0]-g)*this.kx,F=(r[Z+1][1]-u)*this.ky,R=0;G===0&&F===0||((R=(s(c[0]-g)*this.kx*G+(c[1]-u)*this.ky*F)/(G*G+F*F))>1?(g=r[Z+1][0],u=r[Z+1][1]):R>0&&(g+=G/this.kx*R,u+=F/this.ky*R));var I=(G=s(c[0]-g)*this.kx)*G+(F=(c[1]-u)*this.ky)*F;I<p&&(p=I,b=g,m=u,h=Z,W=R)}return{point:[b,m],index:h,t:Math.max(0,Math.min(1,W))}},a.prototype.lineSlice=function(r,c,b){var m=this.pointOnLine(b,r),h=this.pointOnLine(b,c);if(m.index>h.index||m.index===h.index&&m.t>h.t){var W=m;m=h,h=W}var p=[m.point],Z=m.index+1,g=h.index;!o(b[Z],p[0])&&Z<=g&&p.push(b[Z]);for(var u=Z+1;u<=g;u++)p.push(b[u]);return o(b[g],h.point)||p.push(h.point),p},a.prototype.lineSliceAlong=function(r,c,b){for(var m=0,h=[],W=0;W<b.length-1;W++){var p=b[W],Z=b[W+1],g=this.distance(p,Z);if((m+=g)>r&&h.length===0&&h.push(d(p,Z,(r-(m-g))/g)),m>=c)return h.push(d(p,Z,(c-(m-g))/g)),h;m>r&&h.push(Z)}return h},a.prototype.bufferPoint=function(r,c){var b=c/this.ky,m=c/this.kx;return[r[0]-m,r[1]-b,r[0]+m,r[1]+b]},a.prototype.bufferBBox=function(r,c){var b=c/this.ky,m=c/this.kx;return[r[0]-m,r[1]-b,r[2]+m,r[3]+b]},a.prototype.insideBBox=function(r,c){return s(r[0]-c[0])>=0&&s(r[0]-c[2])<=0&&r[1]>=c[1]&&r[1]<=c[3]},Object.defineProperties(a,l),a}();var Em=we(g1.exports),u1={exports:{}};u1.exports=function(){var e=function(i,n){if(i===void 0&&(i=[]),n===void 0&&(n=t),this.data=i,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function t(i,n){return i<n?-1:i>n?1:0}return e.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var i=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),i}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(i){for(var n=this.data,a=this.compare,l=n[i];i>0;){var o=i-1>>1,d=n[o];if(a(l,d)>=0)break;n[i]=d,i=o}n[i]=l},e.prototype._down=function(i){for(var n=this.data,a=this.compare,l=this.length>>1,o=n[i];i<l;){var d=1+(i<<1),s=n[d],r=d+1;if(r<this.length&&a(n[r],s)<0&&(d=r,s=n[r]),a(s,o)>=0)break;n[i]=s,i=d}n[i]=o},e}();var Am=we(u1.exports),tt=8192;function R1(e,t){return t.dist-e.dist}let wm=100,jm=50;function G1(e){let t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Er(e){return e[1]-e[0]+1}function Pa(e,t){let i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function Hm(e,t){if(e[0]>e[1])return[null,null];let i=Er(e);if(t){if(i===2)return[e,null];let n=Math.floor(i/2);return[[e[0],e[0]+n],[e[0]+n,e[1]]]}{if(i===1)return[e,null];let n=Math.floor(i/2)-1;return[[e[0],e[0]+n],[e[0]+n+1,e[1]]]}}function bo(e,t){let i=[1/0,1/0,-1/0,-1/0];if(!Pa(t,e.length))return i;for(let n=t[0];n<=t[1];++n)ps(i,e[n]);return i}function Ar(e){let t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let n=0;n<e[i].length;++n)ps(t,e[i][n]);return t}function id(e,t,i){if(G1(e)||G1(t))return NaN;let n=0,a=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(a=e[1]-t[3]),e[3]<t[1]&&(a=t[1]-e[3]),i.distance([0,0],[n,a])}function Om(e,t){let i=Math.pow(2,t.z);return[(a=(e.x/tt+t.x)/i,360*a-180),(n=(e.y/tt+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,a}function fU(e,t){let i=[];for(let n=0;n<e.length;++n)i.push(Om(e[n],t));return i}function F1(e,t,i){let n=i.pointOnLine(t,e).point;return i.distance(e,n)}function I1(e,t,i,n,a){let l=i.slice(n[0],n[1]+1),o=1/0;for(let d=t[0];d<=t[1];++d)if((o=Math.min(o,F1(e[d],l,a)))===0)return 0;return o}function Dm(e,t,i,n,a){let l=Math.min(a.pointToSegmentDistance(e,i,n),a.pointToSegmentDistance(t,i,n)),o=Math.min(a.pointToSegmentDistance(i,e,t),a.pointToSegmentDistance(n,e,t));return Math.min(l,o)}function zU(e,t,i,n,a){if(!Pa(t,e.length)||!Pa(n,i.length))return NaN;let l=1/0;for(let o=t[0];o<t[1];++o)for(let d=n[0];d<n[1];++d){if(Lr(e[o],e[o+1],i[d],i[d+1]))return 0;l=Math.min(l,Dm(e[o],e[o+1],i[d],i[d+1],a))}return l}function LU(e,t,i,n,a){if(!Pa(t,e.length)||!Pa(n,i.length))return NaN;let l=1/0;for(let o=t[0];o<=t[1];++o)for(let d=n[0];d<=n[1];++d)if((l=Math.min(l,a.distance(e[o],i[d])))===0)return l;return l}function EU(e,t,i){if(ed(e,t,!0))return 0;let n=1/0;for(let a of t){let l=a.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[l-1]&&(n=Math.min(n,i.pointToSegmentDistance(e,a[l-1],a[0])))===0||(n=Math.min(n,F1(e,a,i)))===0)return n}return n}function AU(e,t,i,n){if(!Pa(t,e.length))return NaN;for(let l=t[0];l<=t[1];++l)if(ed(e[l],i,!0))return 0;let a=1/0;for(let l=t[0];l<t[1];++l)for(let o of i)for(let d=0,s=o.length,r=s-1;d<s;r=d++){if(Lr(e[l],e[l+1],o[r],o[d]))return 0;a=Math.min(a,Dm(e[l],e[l+1],o[r],o[d],n))}return a}function U1(e,t){for(let i of e)for(let n=0;n<=i.length-1;++n)if(ed(i[n],t,!0))return!0;return!1}function wU(e,t,i,n=1/0){let a=Ar(e),l=Ar(t);if(n!==1/0&&id(a,l,i)>=n)return n;if(Zs(a,l)){if(U1(e,t))return 0}else if(U1(t,e))return 0;let o=n;for(let d of e)for(let s=0,r=d.length,c=r-1;s<r;c=s++)for(let b of t)for(let m=0,h=b.length,W=h-1;m<h;W=m++){if(Lr(d[c],d[s],b[W],b[m]))return 0;o=Math.min(o,Dm(d[c],d[s],b[W],b[m],i))}return o}function wr(e,t,i,n,a,l,o){if(l===null||o===null)return;let d=id(bo(n,l),bo(a,o),i);d<t&&e.push({dist:d,range1:l,range2:o})}function jU(e,t,i,n,a=1/0){let l=Math.min(n.distance(e[0],i[0][0]),a);if(l===0)return l;let o=new Am([{dist:0,range1:[0,e.length-1],range2:[0,0]}],R1),d=t?jm:wm,s=Ar(i);for(;o.length;){let r=o.pop();if(r.dist>=l)continue;let c=r.range1;if(Er(c)<=d){if(!Pa(c,e.length))return NaN;if(t){let b=AU(e,c,i,n);if((l=Math.min(l,b))===0)return l}else for(let b=c[0];b<=c[1];++b){let m=EU(e[b],i,n);if((l=Math.min(l,m))===0)return l}}else{let b=Hm(c,t);if(b[0]!==null){let m=id(bo(e,b[0]),s,n);m<l&&o.push({dist:m,range1:b[0],range2:[0,0]})}if(b[1]!==null){let m=id(bo(e,b[1]),s,n);m<l&&o.push({dist:m,range1:b[1],range2:[0,0]})}}}return l}function x1(e,t,i,n,a,l=1/0){let o=Math.min(l,a.distance(e[0],i[0]));if(o===0)return o;let d=new Am([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],R1),s=t?jm:wm,r=n?jm:wm;for(;d.length;){let c=d.pop();if(c.dist>=o)continue;let b=c.range1,m=c.range2;if(Er(b)<=s&&Er(m)<=r){if(!Pa(b,e.length)||!Pa(m,i.length))return NaN;if(t&&n?o=Math.min(o,zU(e,b,i,m,a)):t||n?t&&!n?o=Math.min(o,I1(i,m,e,b,a)):!t&&n&&(o=Math.min(o,I1(e,b,i,m,a))):o=Math.min(o,LU(e,b,i,m,a)),o===0)return o}else{let h=Hm(b,t),W=Hm(m,n);wr(d,o,a,e,i,h[0],W[0]),wr(d,o,a,e,i,h[0],W[1]),wr(d,o,a,e,i,h[1],W[0]),wr(d,o,a,e,i,h[1],W[1])}}return o}function _m(e,t,i,n,a=1/0){let l=a,o=bo(e,[0,e.length-1]);for(let d of i)if(!(l!==1/0&&id(o,bo(d,[0,d.length-1]),n)>=l)&&(l=Math.min(l,x1(e,t,d,!0,n,l)),l===0))return l;return l}function jr(e,t,i,n,a=1/0){let l=a,o=bo(e,[0,e.length-1]);for(let d of i){if(l!==1/0&&id(o,Ar(d),n)>=l)continue;let s=jU(e,t,d,n,l);if(isNaN(s))return s;if((l=Math.min(l,s))===0)return l}return l}function Km(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class gs{constructor(t,i){this.type=yt,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error("'distance' expression requires either one argument, but found ' ".concat(t.length-1," instead."));if(td(t[1])){let n=t[1];if(n.type==="FeatureCollection"){for(let a=0;a<n.features.length;++a)if(Km(n.features[a].geometry.type))return new gs(n,n.features[a].geometry)}else if(n.type==="Feature"){if(Km(n.geometry.type))return new gs(n,n.geometry)}else if(Km(n.type))return new gs(n,n)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){let i=t.geometry(),n=t.canonicalID();if(i!=null&&n!=null){if(t.geometryType()==="Point")return function(a,l,o){let d=[];for(let r of a)for(let c of r)d.push(Om(c,l));let s=new Em(d[0][1],"meters");return o.type==="Point"||o.type==="MultiPoint"||o.type==="LineString"?x1(d,!1,o.type==="Point"?[o.coordinates]:o.coordinates,o.type==="LineString",s):o.type==="MultiLineString"?_m(d,!1,o.coordinates,s):o.type==="Polygon"||o.type==="MultiPolygon"?jr(d,!1,o.type==="Polygon"?[o.coordinates]:o.coordinates,s):null}(i,n,this.geometries);if(t.geometryType()==="LineString")return function(a,l,o){let d=[];for(let r of a){let c=[];for(let b of r)c.push(Om(b,l));d.push(c)}let s=new Em(d[0][0][1],"meters");if(o.type==="Point"||o.type==="MultiPoint"||o.type==="LineString")return _m(o.type==="Point"?[o.coordinates]:o.coordinates,o.type==="LineString",d,s);if(o.type==="MultiLineString"){let r=1/0;for(let c=0;c<o.coordinates.length;c++){let b=_m(o.coordinates[c],!0,d,s,r);if(isNaN(b))return b;if((r=Math.min(r,b))===0)return r}return r}if(o.type==="Polygon"||o.type==="MultiPolygon"){let r=1/0;for(let c=0;c<d.length;c++){let b=jr(d[c],!0,o.type==="Polygon"?[o.coordinates]:o.coordinates,s,r);if(isNaN(b))return b;if((r=Math.min(r,b))===0)return r}return r}return null}(i,n,this.geometries);if(t.geometryType()==="Polygon")return function(a,l,o){let d=[];for(let r of function(c,b){let m=c.length;if(m<=1)return[c];let h=[],W,p;for(let Z=0;Z<m;Z++){let g=CU(c[Z]);g!==0&&(c[Z].area=Math.abs(g),p===void 0&&(p=g<0),p===g<0?(W&&h.push(W),W=[c[Z]]):W.push(c[Z]))}return W&&h.push(W),h}(a)){let c=[];for(let b=0;b<r.length;++b)c.push(fU(r[b],l));d.push(c)}let s=new Em(d[0][0][0][1],"meters");if(o.type==="Point"||o.type==="MultiPoint"||o.type==="LineString")return jr(o.type==="Point"?[o.coordinates]:o.coordinates,o.type==="LineString",d,s);if(o.type==="MultiLineString"){let r=1/0;for(let c=0;c<o.coordinates.length;c++){let b=jr(o.coordinates[c],!0,d,s,r);if(isNaN(b))return b;if((r=Math.min(r,b))===0)return r}return r}return o.type==="Polygon"||o.type==="MultiPolygon"?function(r,c,b){let m=1/0;for(let h of r)for(let W of c){let p=wU(h,W,b,m);if(isNaN(p))return p;if((m=Math.min(m,p))===0)return m}return m}(o.type==="Polygon"?[o.coordinates]:o.coordinates,d,s):null}(i,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Pm=gs;function nd(e){if(e instanceof Ja&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Lm||e instanceof Pm)return!1;let t=!0;return e.eachChild(i=>{t&&!nd(i)&&(t=!1)}),t}function us(e){if(e instanceof Ja&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!us(i)&&(t=!1)}),t}function qm(e){if(e instanceof Ja&&e.name==="config")return!1;let t=!0;return e.eachChild(i=>{t&&!qm(i)&&(t=!1)}),t}function ad(e,t){if(e instanceof Ja&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(n=>{i&&!ad(n,t)&&(i=!1)}),i}class $m{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let n=t[1];return i.scope.has(n)?new $m(n,i.scope.get(n)):i.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var N1=$m;class t0{constructor(t,i=[],n,a=new YU,l=[],o){this.registry=t,this.path=i,this.key=i.map(d=>"[".concat(d,"]")).join(""),this.scope=a,this.errors=l,this.expectedType=n,this.options=o}parse(t,i,n,a,l={}){return i||n?this.concat(i,n,a)._parse(t,l):this._parse(t,l)}_parse(t,i){function n(a,l,o){return o==="assert"?new Ka(l,[a]):o==="coerce"?new ro(l,[a]):a}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let a=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(a){let l=a.parse(t,this);if(!l)return null;if(this.expectedType){let o=this.expectedType,d=l.type;if(o.kind!=="string"&&o.kind!=="number"&&o.kind!=="boolean"&&o.kind!=="object"&&o.kind!=="array"||d.kind!=="value")if(o.kind!=="color"&&o.kind!=="formatted"&&o.kind!=="resolvedImage"||d.kind!=="value"&&d.kind!=="string"){if(this.checkSubtype(o,d))return null}else l=n(l,o,i.typeAnnotation||"coerce");else l=n(l,o,i.typeAnnotation||"assert")}if(!(l instanceof ms)&&l.type.kind!=="resolvedImage"&&e0(l)){let o=new c1(this.options);try{l=new ms(l.type,l.evaluate(o))}catch(d){return this.error(d.message),null}}return l}return ro.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof t," instead."))}concat(t,i,n){let a=typeof t=="number"?this.path.concat(t):this.path,l=n?this.scope.concat(n):this.scope;return new t0(this.registry,a,i||null,l,this.errors,this.options)}error(t,...i){let n="".concat(this.key).concat(i.map(a=>"[".concat(a,"]")).join(""));this.errors.push(new Xa(n,t))}checkSubtype(t,i){let n=rs(t,i);return n&&this.error(n),n}}var Y1=t0;function e0(e){if(e instanceof N1)return e0(e.boundExpression);if(e instanceof Ja&&e.name==="error"||e instanceof Ja&&e.name==="config"||e instanceof zr||e instanceof Lm||e instanceof Pm)return!1;let t=e instanceof ro||e instanceof Ka,i=!0;return e.eachChild(n=>{i=t?i&&e0(n):i&&n instanceof ms}),!!i&&nd(e)&&ad(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Hr(e,t){let i=e.length-1,n,a,l=0,o=i,d=0;for(;l<=o;)if(d=Math.floor((l+o)/2),n=e[d],a=e[d+1],n<=t){if(d===i||t<a)return d;l=d+1}else{if(!(n>t))throw new Pi("Input is not a number.");o=d-1}return 0}class i0{constructor(t,i,n){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[a,l]of n)this.labels.push(a),this.outputs.push(l)}static parse(t,i){if(t.length-1<4)return i.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let n=i.parse(t[1],1,yt);if(!n)return null;let a=[],l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let o=1;o<t.length;o+=2){let d=o===1?-1/0:t[o],s=t[o+1],r=o,c=o+1;if(typeof d!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(a.length&&a[a.length-1][0]>=d)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',r);let b=i.parse(s,c,l);if(!b)return null;l=l||b.type,a.push([d,b])}return new i0(l,n,a)}evaluate(t){let i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(t);let a=this.input.evaluate(t);if(a<=i[0])return n[0].evaluate(t);let l=i.length;return a>=i[l-1]?n[l-1].evaluate(t):n[Hr(i,a)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var n0=i0;function Pt(e,t,i){return e*(1-i)+t*i}function X1(e,t,i){return e.map((n,a)=>Pt(n,t[a],i))}var Or=Object.freeze({__proto__:null,array:X1,color:function(e,t,i){return new re(Pt(e.r,t.r,i),Pt(e.g,t.g,i),Pt(e.b,t.b,i),Pt(e.a,t.a,i))},number:Pt});let J1=.95047,y1=1.08883,B1=4/29,ld=6/29,M1=3*ld*ld,HU=ld*ld*ld,OU=Math.PI/180,DU=180/Math.PI;function a0(e){return e>HU?Math.pow(e,1/3):e/M1+B1}function l0(e){return e>ld?e*e*e:M1*(e-B1)}function o0(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function d0(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function C1(e){let t=d0(e.r),i=d0(e.g),n=d0(e.b),a=a0((.4124564*t+.3575761*i+.1804375*n)/J1),l=a0((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*l-16,a:500*(a-l),b:200*(l-a0((.0193339*t+.119192*i+.9503041*n)/y1)),alpha:e.a}}function T1(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*l0(t),i=J1*l0(i),n=y1*l0(n),new re(o0(3.2404542*i-1.5371385*t-.4985314*n),o0(-.969266*i+1.8760108*t+.041556*n),o0(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function _U(e,t,i){let n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}let Rs={forward:C1,reverse:T1,interpolate:function(e,t,i){return{l:Pt(e.l,t.l,i),a:Pt(e.a,t.a,i),b:Pt(e.b,t.b,i),alpha:Pt(e.alpha,t.alpha,i)}}},Gs={forward:function(e){let{l:t,a:i,b:n}=C1(e),a=Math.atan2(n,i)*DU;return{h:a<0?a+360:a,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){let t=e.h*OU,i=e.c;return T1({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:_U(e.h,t.h,i),c:Pt(e.c,t.c,i),l:Pt(e.l,t.l,i),alpha:Pt(e.alpha,t.alpha,i)}}};var k1=Object.freeze({__proto__:null,hcl:Gs,lab:Rs});class Dr{constructor(t,i,n,a,l){this.type=t,this.operator=i,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(let[o,d]of l)this.labels.push(o),this.outputs.push(d)}static interpolationFactor(t,i,n,a){let l=0;if(t.name==="exponential")l=s0(i,t.base,n,a);else if(t.name==="linear")l=s0(i,1,n,a);else if(t.name==="cubic-bezier"){let o=t.controlPoints;l=new Te(o[0],o[1],o[2],o[3]).solve(s0(i,1,n,a))}return l}static parse(t,i){let[n,a,l,...o]=t;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){let r=a[1];if(typeof r!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:r}}else{if(a[0]!=="cubic-bezier")return i.error("Unknown interpolation type ".concat(String(a[0])),1,0);{let r=a.slice(1);if(r.length!==4||r.some(c=>typeof c!="number"||c<0||c>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:r}}}if(t.length-1<4)return i.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,yt),!l)return null;let d=[],s=null;n==="interpolate-hcl"||n==="interpolate-lab"?s=Pn:i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);for(let r=0;r<o.length;r+=2){let c=o[r],b=o[r+1],m=r+3,h=r+4;if(typeof c!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',m);if(d.length&&d[d.length-1][0]>=c)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',m);let W=i.parse(b,h,s);if(!W)return null;s=s||W.type,d.push([c,W])}return s.kind==="number"||s.kind==="color"||s.kind==="array"&&s.itemType.kind==="number"&&typeof s.N=="number"?new Dr(s,n,a,l,d):i.error("Type ".concat(Ji(s)," is not interpolatable."))}evaluate(t){let i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(t);let a=this.input.evaluate(t);if(a<=i[0])return n[0].evaluate(t);let l=i.length;if(a>=i[l-1])return n[l-1].evaluate(t);let o=Hr(i,a),d=Dr.interpolationFactor(this.interpolation,a,i[o],i[o+1]),s=n[o].evaluate(t),r=n[o+1].evaluate(t);return this.operator==="interpolate"?Or[this.type.kind.toLowerCase()](s,r,d):this.operator==="interpolate-hcl"?Gs.reverse(Gs.interpolate(Gs.forward(s),Gs.forward(r),d)):Rs.reverse(Rs.interpolate(Rs.forward(s),Rs.forward(r),d))}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)i.push(this.labels[n],this.outputs[n].serialize());return i}}function s0(e,t,i,n){let a=n-i,l=e-i;return a===0?0:t===1?l/a:(Math.pow(t,l)-1)/(Math.pow(t,a)-1)}var ya=Dr;class r0{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let n=null,a=i.expectedType;a&&a.kind!=="value"&&(n=a);let l=[];for(let d of t.slice(1)){let s=i.parse(d,1+l.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,l.push(s)}let o=a&&l.some(d=>rs(a,d.type));return new r0(o?Je:n,l)}evaluate(t){let i,n=null,a=0;for(let l of this.args){if(a++,n=l.evaluate(t),n&&n instanceof qn&&!n.available&&(i||(i=n),n=null,a===this.args.length))return i;if(n!==null)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var S1=r0;class c0{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));let n=[];for(let l=1;l<t.length-1;l+=2){let o=t[l];if(typeof o!="string")return i.error("Expected string, but found ".concat(typeof o," instead."),l);if(/[^a-zA-Z0-9_]/.test(o))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);let d=i.parse(t[l+1],l+1);if(!d)return null;n.push([o,d])}let a=i.parse(t[t.length-1],t.length-1,i.expectedType,n);return a?new c0(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[i,n]of this.bindings)t.push(i,n.serialize());return t.push(this.result.serialize()),t}}var Q1=c0;class b0{constructor(t,i,n){this.type=t,this.index=i,this.input=n}static parse(t,i){if(t.length!==3)return i.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,yt),a=i.parse(t[2],2,Xn(i.expectedType||Je));return n&&a?new b0(a.type.itemType,n,a):null}evaluate(t){let i=this.index.evaluate(t),n=this.input.evaluate(t);if(i<0)throw new Pi("Array index out of bounds: ".concat(i," < 0."));if(i>=n.length)throw new Pi("Array index out of bounds: ".concat(i," > ").concat(n.length-1,"."));if(i!==Math.floor(i))throw new Pi("Array index must be an integer, but found ".concat(i," instead."));return n[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var KU=b0;class m0{constructor(t,i){this.type=Me,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,Je),a=i.parse(t[2],2,Je);return n&&a?ym(n.type,[Me,Ye,yt,qo,Je])?new m0(n,a):i.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ji(n.type)," instead")):null}evaluate(t){let i=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(n==null)return!1;if(!cs(i,["boolean","string","number","null"]))throw new Pi("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ji(ji(i))," instead."));if(!cs(n,["string","array"]))throw new Pi("Expected second argument to be of type array or string, but found ".concat(Ji(ji(n))," instead."));return n.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var PU=m0;class _r{constructor(t,i,n){this.type=yt,this.needle=t,this.haystack=i,this.fromIndex=n}static parse(t,i){if(t.length<=2||t.length>=5)return i.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,Je),a=i.parse(t[2],2,Je);if(!n||!a)return null;if(!ym(n.type,[Me,Ye,yt,qo,Je]))return i.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ji(n.type)," instead"));if(t.length===4){let l=i.parse(t[3],3,yt);return l?new _r(n,a,l):null}return new _r(n,a)}evaluate(t){let i=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!cs(i,["boolean","string","number","null"]))throw new Pi("Expected first argument to be of type boolean, string, number or null, but found ".concat(Ji(ji(i))," instead."));if(!cs(n,["string","array"]))throw new Pi("Expected second argument to be of type array or string, but found ".concat(Ji(ji(n))," instead."));if(this.fromIndex){let a=this.fromIndex.evaluate(t);return n.indexOf(i,a)}return n.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var qU=_r;class h0{constructor(t,i,n,a,l,o){this.inputType=t,this.type=i,this.input=n,this.cases=a,this.outputs=l,this.otherwise=o}static parse(t,i){if(t.length<5)return i.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return i.error("Expected an even number of arguments.");let n,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);let l={},o=[];for(let r=2;r<t.length-1;r+=2){let c=t[r],b=t[r+1];Array.isArray(c)||(c=[c]);let m=i.concat(r);if(c.length===0)return m.error("Expected at least one branch label.");for(let W of c){if(typeof W!="number"&&typeof W!="string")return m.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return m.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if(typeof W=="number"&&Math.floor(W)!==W)return m.error("Numeric branch labels must be integer values.");if(n){if(m.checkSubtype(n,ji(W)))return null}else n=ji(W);if(l[String(W)]!==void 0)return m.error("Branch labels must be unique.");l[String(W)]=o.length}let h=i.parse(b,r,a);if(!h)return null;a=a||h.type,o.push(h)}let d=i.parse(t[1],1,Je);if(!d)return null;let s=i.parse(t[t.length-1],t.length-1,a);return s?d.type.kind!=="value"&&i.concat(1).checkSubtype(n,d.type)?null:new h0(n,a,d,l,o,s):null}evaluate(t){let i=this.input.evaluate(t);return(ji(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),n=[],a={};for(let o of i){let d=a[this.cases[o]];d===void 0?(a[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[d][1].push(o)}let l=o=>this.inputType.kind==="number"?Number(o):o;for(let[o,d]of n)t.push(d.length===1?l(d[0]):d.map(l)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}}var $U=h0;class W0{constructor(t,i,n){this.type=t,this.branches=i,this.otherwise=n}static parse(t,i){if(t.length<4)return i.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);let a=[];for(let o=1;o<t.length-1;o+=2){let d=i.parse(t[o],o,Me);if(!d)return null;let s=i.parse(t[o+1],o+1,n);if(!s)return null;a.push([d,s]),n=n||s.type}let l=i.parse(t[t.length-1],t.length-1,n);return l?new W0(n,a,l):null}evaluate(t){for(let[i,n]of this.branches)if(i.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,n]of this.branches)t(i),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var tx=W0;class Kr{constructor(t,i,n,a){this.type=t,this.input=i,this.beginIndex=n,this.endIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,Je),a=i.parse(t[2],2,yt);if(!n||!a)return null;if(!ym(n.type,[Xn(Je),Ye,Je]))return i.error("Expected first argument to be of type array or string, but found ".concat(Ji(n.type)," instead"));if(t.length===4){let l=i.parse(t[3],3,yt);return l?new Kr(n.type,n,a,l):null}return new Kr(n.type,n,a)}evaluate(t){let i=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!cs(i,["string","array"]))throw new Pi("Expected first argument to be of type array or string, but found ".concat(Ji(ji(i))," instead."));if(this.endIndex){let a=this.endIndex.evaluate(t);return i.slice(n,a)}return i.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ex=Kr;function v1(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function f1(e,t,i,n){return n.compare(t,i)===0}function od(e,t,i){let n=e!=="=="&&e!=="!=";return class WU{constructor(l,o,d){this.type=Me,this.lhs=l,this.rhs=o,this.collator=d,this.hasUntypedArgument=l.type.kind==="value"||o.type.kind==="value"}static parse(l,o){if(l.length!==3&&l.length!==4)return o.error("Expected two or three arguments.");let d=l[0],s=o.parse(l[1],1,Je);if(!s)return null;if(!v1(d,s.type))return o.concat(1).error('"'.concat(d,"\" comparisons are not supported for type '").concat(Ji(s.type),"'."));let r=o.parse(l[2],2,Je);if(!r)return null;if(!v1(d,r.type))return o.concat(2).error('"'.concat(d,"\" comparisons are not supported for type '").concat(Ji(r.type),"'."));if(s.type.kind!==r.type.kind&&s.type.kind!=="value"&&r.type.kind!=="value")return o.error("Cannot compare types '".concat(Ji(s.type),"' and '").concat(Ji(r.type),"'."));n&&(s.type.kind==="value"&&r.type.kind!=="value"?s=new Ka(r.type,[s]):s.type.kind!=="value"&&r.type.kind==="value"&&(r=new Ka(s.type,[r])));let c=null;if(l.length===4){if(s.type.kind!=="string"&&r.type.kind!=="string"&&s.type.kind!=="value"&&r.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(l[3],3,Qr),!c)return null}return new WU(s,r,c)}evaluate(l){let o=this.lhs.evaluate(l),d=this.rhs.evaluate(l);if(n&&this.hasUntypedArgument){let s=ji(o),r=ji(d);if(s.kind!==r.kind||s.kind!=="string"&&s.kind!=="number")throw new Pi('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(s.kind,", ").concat(r.kind,") instead."))}if(this.collator&&!n&&this.hasUntypedArgument){let s=ji(o),r=ji(d);if(s.kind!=="string"||r.kind!=="string")return t(l,o,d)}return this.collator?i(l,o,d,this.collator.evaluate(l)):t(l,o,d)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){let l=[e];return this.eachChild(o=>{l.push(o.serialize())}),l}}}let ix=od("==",function(e,t,i){return t===i},f1),nx=od("!=",function(e,t,i){return t!==i},function(e,t,i,n){return!f1(0,t,i,n)}),ax=od("<",function(e,t,i){return t<i},function(e,t,i,n){return n.compare(t,i)<0}),lx=od(">",function(e,t,i){return t>i},function(e,t,i,n){return n.compare(t,i)>0}),ox=od("<=",function(e,t,i){return t<=i},function(e,t,i,n){return n.compare(t,i)<=0}),dx=od(">=",function(e,t,i){return t>=i},function(e,t,i,n){return n.compare(t,i)>=0});class p0{constructor(t,i,n,a,l,o){this.type=Ye,this.number=t,this.locale=i,this.currency=n,this.unit=a,this.minFractionDigits=l,this.maxFractionDigits=o}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let n=i.parse(t[1],1,yt);if(!n)return null;let a=t[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let l=null;if(a.locale&&(l=i.parse(a.locale,1,Ye),!l))return null;let o=null;if(a.currency&&(o=i.parse(a.currency,1,Ye),!o))return null;let d=null;if(a.unit&&(d=i.parse(a.unit,1,Ye),!d))return null;let s=null;if(a["min-fraction-digits"]&&(s=i.parse(a["min-fraction-digits"],1,yt),!s))return null;let r=null;return a["max-fraction-digits"]&&(r=i.parse(a["max-fraction-digits"],1,yt),!r)?null:new p0(n,l,o,d,s,r)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Z0{constructor(t){this.type=yt,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected 1 argument, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error("Expected argument of type string or array, but found ".concat(Ji(n.type)," instead.")):new Z0(n):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Pi("Expected value to be of type string or array, but found ".concat(Ji(ji(i))," instead."))}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function V0(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}let z1={"==":ix,"!=":nx,">":lx,"<":ax,">=":dx,"<=":ox,array:Ka,at:KU,boolean:Ka,case:tx,coalesce:S1,collator:zr,format:hs,image:Ws,in:PU,"index-of":qU,interpolate:ya,"interpolate-hcl":ya,"interpolate-lab":ya,length:Z0,let:Q1,literal:ms,match:$U,number:Ka,"number-format":p0,object:Ka,slice:ex,step:n0,string:Ka,"to-boolean":ro,"to-color":ro,"to-number":ro,"to-string":ro,var:N1,within:Lm,distance:Pm};function L1(e,[t,i,n,a]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);let l=a?a.evaluate(e):1,o=r1(t,i,n,l);if(o)throw new Pi(o);return new re(t/255*l,i/255*l,n/255*l,l)}function E1(e,[t,i,n,a]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);let l=a?a.evaluate(e):1,o=function(r,c,b,m){return typeof r=="number"&&r>=0&&r<=360?typeof c=="number"&&c>=0&&c<=100&&typeof b=="number"&&b>=0&&b<=100?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid hsla value [".concat([r,c,b,m].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat((typeof m=="number"?[r,c,b,m]:[r,c,b]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat((typeof m=="number"?[r,c,b,m]:[r,c,b]).join(", "),"]: 'h' must be between 0 and 360.")}(t,i,n,l);if(o)throw new Pi(o);let d="hsla(".concat(t,", ").concat(i,"%, ").concat(n,"%, ").concat(l,")"),s=re.parse(d);if(!s)throw new Pi("Failed to parse HSLA color: ".concat(d));return s}function A1(e,t){return e in t}function g0(e,t){let i=t[e];return i===void 0?null:i}function w1(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return re.parse(t)}return t}function j1(e,t,i,n){return n!==void 0&&(e=n*Math.round(e/n)),t!==void 0&&e<t&&(e=t),i!==void 0&&e>i&&(e=i),e}function H1(e,t,i){i.length&&(t+="".concat(i));let n=e.getConfig(t);if(!n)return null;let{type:a,value:l,values:o,minValue:d,maxValue:s,stepValue:r}=n,c=n.default.evaluate(e),b=l?l.evaluate(e):c;return a&&(b=w1(a,b)),l!==void 0&&b!==void 0&&o&&!o.includes(b)&&(b=c,a&&(b=w1(a,b))),b===void 0||d===void 0&&s===void 0&&r===void 0||(typeof b=="number"?b=j1(b,d,s,r):Array.isArray(b)&&(b=b.map(m=>typeof m=="number"?j1(m,d,s,r):m))),b}function mo(e){return{type:e}}Ja.register(z1,{error:[{kind:"error"},[Ye],(e,[t])=>{throw new Pi(t.evaluate(e))}],typeof:[Ye,[Je],(e,[t])=>Ji(ji(t.evaluate(e)))],"to-rgba":[Xn(yt,4),[Pn],(e,[t])=>t.evaluate(e).toArray()],rgb:[Pn,[yt,yt,yt],L1],rgba:[Pn,[yt,yt,yt,yt],L1],hsl:[Pn,[yt,yt,yt],E1],hsla:[Pn,[yt,yt,yt,yt],E1],has:{type:Me,overloads:[[[Ye],(e,[t])=>A1(t.evaluate(e),e.properties())],[[Ye,$o],(e,[t,i])=>A1(t.evaluate(e),i.evaluate(e))]]},get:{type:Je,overloads:[[[Ye],(e,[t])=>g0(t.evaluate(e),e.properties())],[[Ye,$o],(e,[t,i])=>g0(t.evaluate(e),i.evaluate(e))]]},config:{type:Je,overloads:[[[Ye],(e,[t])=>H1(e,t.evaluate(e),"")],[[Ye,Ye],(e,[t,i])=>H1(e,t.evaluate(e),i.evaluate(e))]]},"feature-state":[Je,[Ye],(e,[t])=>g0(t.evaluate(e),e.featureState||{})],properties:[$o,[],e=>e.properties()],"geometry-type":[Ye,[],e=>e.geometryType()],id:[Je,[],e=>e.id()],zoom:[yt,[],e=>e.globals.zoom],pitch:[yt,[],e=>e.globals.pitch||0],"distance-from-center":[yt,[],e=>e.distanceFromCenter()],"measure-light":[yt,[Ye],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[yt,[],e=>e.globals.heatmapDensity||0],"line-progress":[yt,[],e=>e.globals.lineProgress||0],"raster-value":[yt,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[yt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Je,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[yt,mo(yt),(e,t)=>{let i=0;for(let n of t)i+=n.evaluate(e);return i}],"*":[yt,mo(yt),(e,t)=>{let i=1;for(let n of t)i*=n.evaluate(e);return i}],"-":{type:yt,overloads:[[[yt,yt],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[yt],(e,[t])=>-t.evaluate(e)]]},"/":[yt,[yt,yt],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[yt,[yt,yt],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[yt,[yt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))],log2:[yt,[yt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[yt,[yt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[yt,[yt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[yt,[yt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[yt,[yt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[yt,[yt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[yt,[yt],(e,[t])=>Math.atan(t.evaluate(e))],min:[yt,mo(yt),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[yt,mo(yt),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[yt,[yt],(e,[t])=>Math.abs(t.evaluate(e))],round:[yt,[yt],(e,[t])=>{let i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[yt,[yt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[yt,[yt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Me,[Ye,Je],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Me,[Je],(e,[t])=>e.id()===t.value],"filter-type-==":[Me,[Ye],(e,[t])=>e.geometryType()===t.value],"filter-<":[Me,[Ye,Je],(e,[t,i])=>{let n=e.properties()[t.value],a=i.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Me,[Je],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[Me,[Ye,Je],(e,[t,i])=>{let n=e.properties()[t.value],a=i.value;return typeof n==typeof a&&n>a}],"filter-id->":[Me,[Je],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[Me,[Ye,Je],(e,[t,i])=>{let n=e.properties()[t.value],a=i.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Me,[Je],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[Me,[Ye,Je],(e,[t,i])=>{let n=e.properties()[t.value],a=i.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Me,[Je],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[Me,[Je],(e,[t])=>t.value in e.properties()],"filter-has-id":[Me,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Me,[Xn(Ye)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Me,[Xn(Je)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Me,[Ye,Xn(Je)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Me,[Ye,Xn(Je)],(e,[t,i])=>function(n,a,l,o){for(;l<=o;){let d=l+o>>1;if(a[d]===n)return!0;a[d]>n?o=d-1:l=d+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Me,overloads:[[[Me,Me],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[mo(Me),(e,t)=>{for(let i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Me,overloads:[[[Me,Me],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[mo(Me),(e,t)=>{for(let i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Me,[Me],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Me,[Ye],(e,[t])=>{let i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Ye,[Ye],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Ye,[Ye],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Ye,mo(Je),(e,t)=>t.map(i=>bs(i.evaluate(e))).join("")],"resolved-locale":[Ye,[Qr],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[yt,[yt,yt,Je],(e,t)=>{let[i,n,a]=t.map(o=>o.evaluate(e));if(i>n||i===n)return i;let l;if(typeof a=="string")l=function(o){let d=0;if(o.length===0)return d;for(let s=0;s<o.length;s++)d=(d<<5)-d+o.charCodeAt(s),d&=d;return d}(a);else{if(typeof a!="number")throw new Pi("Invalid seed input: ".concat(a));l=a}return i+V0(l)()*(n-i)}]});var Fs=z1;function O1(e){return{result:"success",value:e}}function ho(e){return{result:"error",value:e}}function D1(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Wo(e){return e["property-type"]==="data-driven"}function _1(e){return D1(e.expression,"measure-light")}function u0(e){return D1(e.expression,"zoom")}function R0(e){return!!e.expression&&e.expression.interpolated}function Pr(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function sx(e){return e}function K1(e,t){let i=t.type==="color",n=e.stops&&typeof e.stops[0][0]=="object",a=n||!(n||e.property!==void 0),l=e.type||(R0(t)?"exponential":"interval");if(i&&((e=Da({},e)).stops&&(e.stops=e.stops.map(r=>[r[0],re.parse(r[1])])),e.default=re.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!k1[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let o,d,s;if(l==="exponential")o=P1;else if(l==="interval")o=cx;else if(l==="categorical"){o=rx,d=Object.create(null);for(let r of e.stops)d[r[0]]=r[1];s=typeof e.stops[0][0]}else{if(l!=="identity")throw new Error('Unknown function type "'.concat(l,'"'));o=bx}if(n){let r={},c=[];for(let h=0;h<e.stops.length;h++){let W=e.stops[h],p=W[0].zoom;r[p]===void 0&&(r[p]={zoom:p,type:e.type,property:e.property,default:e.default,stops:[]},c.push(p)),r[p].stops.push([W[0].value,W[1]])}let b=[];for(let h of c)b.push([r[h].zoom,K1(r[h],t)]);let m={name:"linear"};return{kind:"composite",interpolationType:m,interpolationFactor:ya.interpolationFactor.bind(void 0,m),zoomStops:b.map(h=>h[0]),evaluate:({zoom:h},W)=>P1({stops:b,base:e.base},t,h).evaluate(h,W)}}if(a){let r=l==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:ya.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map(c=>c[0]),evaluate:({zoom:c})=>o(e,t,c,d,s)}}return{kind:"source",evaluate(r,c){let b=c&&c.properties?c.properties[e.property]:void 0;return b===void 0?Is(e.default,t.default):o(e,t,b,d,s)}}}function Is(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function rx(e,t,i,n,a){return Is(typeof i===a?n[i]:void 0,e.default,t.default)}function cx(e,t,i){if(fe(i)!=="number")return Is(e.default,t.default);let n=e.stops.length;if(n===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];let a=Hr(e.stops.map(l=>l[0]),i);return e.stops[a][1]}function P1(e,t,i){let n=e.base!==void 0?e.base:1;if(fe(i)!=="number")return Is(e.default,t.default);let a=e.stops.length;if(a===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[a-1][0])return e.stops[a-1][1];let l=Hr(e.stops.map(c=>c[0]),i),o=function(c,b,m,h){let W=h-m,p=c-m;return W===0?0:b===1?p/W:(Math.pow(b,p)-1)/(Math.pow(b,W)-1)}(i,n,e.stops[l][0],e.stops[l+1][0]),d=e.stops[l][1],s=e.stops[l+1][1],r=Or[t.type]||sx;if(e.colorSpace&&e.colorSpace!=="rgb"){let c=k1[e.colorSpace];r=(b,m)=>c.reverse(c.interpolate(c.forward(b),c.forward(m),o))}return typeof d.evaluate=="function"?{evaluate(...c){let b=d.evaluate.apply(void 0,c),m=s.evaluate.apply(void 0,c);if(b!==void 0&&m!==void 0)return r(b,m,o)}}:r(d,s,o)}function bx(e,t,i){return t.type==="color"?i=re.parse(i):t.type==="formatted"?i=yn.fromString(i.toString()):t.type==="resolvedImage"?i=qn.fromString(i.toString()):fe(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),Is(i,e.default,t.default)}class G0{constructor(t,i,n){this.expression=t,this._warningHistory={},this._evaluator=new c1(n),this._defaultValue=i?function(a){return a.type==="color"&&(Pr(a.default)||Array.isArray(a.default))?new re(0,0,0,0):a.type==="color"?re.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,n,a,l,o,d,s){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,n,a,l,o,d,s){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=d||null,this._evaluator.featureDistanceData=s||null;try{let r=this.expression.evaluate(this._evaluator);if(r==null||typeof r=="number"&&r!=r)return this._defaultValue;if(this._enumValues&&!(r in this._enumValues))throw new Pi("Expected value to be one of ".concat(Object.keys(this._enumValues).map(c=>JSON.stringify(c)).join(", "),", but found ").concat(JSON.stringify(r)," instead."));return r}catch(r){return this._warningHistory[r.message]||(this._warningHistory[r.message]=!0,typeof console<"u"&&console.warn(r.message)),this._defaultValue}}}function qr(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Fs}function Il(e,t,i){let n=new Y1(Fs,[],t?function(l){let o={color:Pn,string:Ye,number:yt,enum:Ye,boolean:Me,formatted:ds,resolvedImage:ss};return l.type==="array"?Xn(o[l.value]||Je,l.length):o[l.type]}(t):void 0,void 0,void 0,i),a=n.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?O1(new G0(a,t,i)):ho(n.errors)}class F0{constructor(t,i,n){this.kind=t,this._styleExpression=i,this.isLightConstant=n,this.isStateDependent=t!=="constant"&&!us(i.expression),this.isConfigDependent=!qm(i.expression)}evaluateWithoutErrorHandling(t,i,n,a,l,o){return this._styleExpression.evaluateWithoutErrorHandling(t,i,n,a,l,o)}evaluate(t,i,n,a,l,o){return this._styleExpression.evaluate(t,i,n,a,l,o)}}class Ul{constructor(t,i,n,a,l){this.kind=t,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!us(i.expression),this.isLightConstant=l,this.isConfigDependent=!qm(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(t,i,n,a,l,o){return this._styleExpression.evaluateWithoutErrorHandling(t,i,n,a,l,o)}evaluate(t,i,n,a,l,o){return this._styleExpression.evaluate(t,i,n,a,l,o)}interpolationFactor(t,i,n){return this.interpolationType?ya.interpolationFactor(this.interpolationType,t,i,n):0}}function I0(e,t,i){if((e=Il(e,t,i)).result==="error")return e;let n=e.value.expression,a=nd(n);if(!a&&!Wo(t))return ho([new Xa("","data expressions not supported")]);let l=ad(n,["zoom","pitch","distance-from-center"]);if(!l&&!u0(t))return ho([new Xa("","zoom expressions not supported")]);let o=ad(n,["measure-light"]);if(!o&&!_1(t))return ho([new Xa("","measure-light expression not supported")]);let d=t.expression&&t.expression.relaxZoomRestriction,s=tc(n);return s||l||d?s instanceof Xa?ho([s]):s instanceof ya&&!R0(t)?ho([new Xa("",'"interpolate" expressions cannot be used with this property')]):O1(s?new Ul(a?"camera":"composite",e.value,s.labels,s instanceof ya?s.interpolation:void 0,o):new F0(a?"constant":"source",e.value,o)):ho([new Xa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class $r{constructor(t,i){this._parameters=t,this._specification=i,Da(this,K1(this._parameters,this._specification))}static deserialize(t){return new $r(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function tc(e){let t=null;if(e instanceof Q1)t=tc(e.result);else if(e instanceof S1){for(let i of e.args)if(t=tc(i),t)break}else(e instanceof n0||e instanceof ya)&&e.input instanceof Ja&&e.input.name==="zoom"&&(t=e);return t instanceof Xa||e.eachChild(i=>{let n=tc(i);n instanceof Xa?t=n:t&&n&&t!==n&&(t=new Xa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function $n(e){let t=e.key,i=e.value,n=e.valueSpec||{},a=e.objectElementValidators||{},l=e.style,o=e.styleSpec,d=[],s=fe(i);if(s!=="object")return[new Tt(t,i,"object expected, ".concat(s," found"))];for(let r in i){let c=r.split(".")[0],b;a[c]?b=a[c]:n[c]?b=nn:a["*"]?b=a["*"]:n["*"]&&(b=nn),b?d=d.concat(b({key:(t&&"".concat(t,"."))+r,value:i[r],valueSpec:n[c]||n["*"],style:l,styleSpec:o,object:i,objectKey:r},i)):d.push(new so(t,i[r],'unknown property "'.concat(r,'"')))}for(let r in n)a[r]||n[r].required&&n[r].default===void 0&&i[r]===void 0&&d.push(new Tt(t,i,'missing required property "'.concat(r,'"')));return d}function q1(e){let t=e.value,i=e.valueSpec,n=e.style,a=e.styleSpec,l=e.key,o=e.arrayElementValidator||nn;if(fe(t)!=="array")return[new Tt(l,t,"array expected, ".concat(fe(t)," found"))];if(i.length&&t.length!==i.length)return[new Tt(l,t,"array length ".concat(i.length," expected, length ").concat(t.length," found"))];if(i["min-length"]&&t.length<i["min-length"])return[new Tt(l,t,"array length at least ".concat(i["min-length"]," expected, length ").concat(t.length," found"))];let d={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};a.$version<7&&(d.function=i.function),fe(i.value)==="object"&&(d=i.value);let s=[];for(let r=0;r<t.length;r++)s=s.concat(o({array:t,arrayIndex:r,value:t[r],valueSpec:d,style:n,styleSpec:a,key:"".concat(l,"[").concat(r,"]")},!0));return s}function $1(e){let t=e.key,i=e.value,n=e.valueSpec,a=fe(i);if(a==="number"&&i!=i&&(a="NaN"),a!=="number")return[new Tt(t,i,"number expected, ".concat(a," found"))];if("minimum"in n){let l=n.minimum;if(fe(n.minimum)==="array"&&(l=n.minimum[e.arrayIndex]),i<l)return[new Tt(t,i,"".concat(i," is less than the minimum value ").concat(l))]}if("maximum"in n){let l=n.maximum;if(fe(n.maximum)==="array"&&(l=n.maximum[e.arrayIndex]),i>l)return[new Tt(t,i,"".concat(i," is greater than the maximum value ").concat(l))]}return[]}function tZ(e){let t=e.valueSpec,i=Si(e.value.type),n,a,l,o={},d=i!=="categorical"&&e.value.property===void 0,s=!d,r=fe(e.value.stops)==="array"&&fe(e.value.stops[0])==="array"&&fe(e.value.stops[0][0])==="object",c=$n({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(h){if(i==="identity")return[new Tt(h.key,h.value,'identity function may not have a "stops" property')];let W=[],p=h.value;return W=W.concat(q1({key:h.key,value:p,valueSpec:h.valueSpec,style:h.style,styleSpec:h.styleSpec,arrayElementValidator:b})),fe(p)==="array"&&p.length===0&&W.push(new Tt(h.key,p,"array must have at least one stop")),W},default:function(h){return nn({key:h.key,value:h.value,valueSpec:t,style:h.style,styleSpec:h.styleSpec})}}});return i==="identity"&&d&&c.push(new Tt(e.key,e.value,'missing required property "property"')),i==="identity"||e.value.stops||c.push(new Tt(e.key,e.value,'missing required property "stops"')),i==="exponential"&&e.valueSpec.expression&&!R0(e.valueSpec)&&c.push(new Tt(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(s&&!Wo(e.valueSpec)?c.push(new Tt(e.key,e.value,"property functions not supported")):d&&!u0(e.valueSpec)&&c.push(new Tt(e.key,e.value,"zoom functions not supported"))),i!=="categorical"&&!r||e.value.property!==void 0||c.push(new Tt(e.key,e.value,'"property" property is required')),c;function b(h){let W=[],p=h.value,Z=h.key;if(fe(p)!=="array")return[new Tt(Z,p,"array expected, ".concat(fe(p)," found"))];if(p.length!==2)return[new Tt(Z,p,"array length 2 expected, length ".concat(p.length," found"))];if(r){if(fe(p[0])!=="object")return[new Tt(Z,p,"object expected, ".concat(fe(p[0])," found"))];if(p[0].zoom===void 0)return[new Tt(Z,p,"object stop key must have zoom")];if(p[0].value===void 0)return[new Tt(Z,p,"object stop key must have value")];let g=Si(p[0].zoom);if(typeof g!="number")return[new Tt(Z,p[0].zoom,"stop zoom values must be numbers")];if(l&&l>g)return[new Tt(Z,p[0].zoom,"stop zoom values must appear in ascending order")];g!==l&&(l=g,a=void 0,o={}),W=W.concat($n({key:"".concat(Z,"[0]"),value:p[0],valueSpec:{zoom:{}},style:h.style,styleSpec:h.styleSpec,objectElementValidators:{zoom:$1,value:m}}))}else W=W.concat(m({key:"".concat(Z,"[0]"),value:p[0],valueSpec:{},style:h.style,styleSpec:h.styleSpec},p));return qr(_a(p[1]))?W.concat([new Tt("".concat(Z,"[1]"),p[1],"expressions are not allowed in function stops.")]):W.concat(nn({key:"".concat(Z,"[1]"),value:p[1],valueSpec:t,style:h.style,styleSpec:h.styleSpec}))}function m(h,W){let p=fe(h.value),Z=Si(h.value),g=h.value!==null?h.value:W;if(n){if(p!==n)return[new Tt(h.key,g,"".concat(p," stop domain type must match previous stop domain type ").concat(n))]}else n=p;if(p!=="number"&&p!=="string"&&p!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new Tt(h.key,g,"stop domain value must be a number, string, or boolean")];if(p!=="number"&&i!=="categorical"){let u="number expected, ".concat(p," found");return Wo(t)&&i===void 0&&(u+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(h.key,g,u)]}return i!=="categorical"||p!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?i!=="categorical"&&p==="number"&&typeof Z=="number"&&typeof a=="number"&&a!==void 0&&Z<a?[new Tt(h.key,g,"stop domain values must appear in ascending order")]:(a=Z,i==="categorical"&&Z in o?[new Tt(h.key,g,"stop domain values must be unique")]:(o[Z]=!0,[])):[new Tt(h.key,g,"integer expected, found ".concat(String(Z)))]}}function po(e){let t=(e.expressionContext==="property"?I0:Il)(_a(e.value),e.valueSpec);if(t.result==="error")return t.value.map(n=>new Tt("".concat(e.key).concat(n.key),e.value,n.message));let i=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!i.outputDefined())return[new Tt(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!us(i))return[new Tt(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return eZ(i,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!ad(i,["zoom","feature-state"]))return[new Tt(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!nd(i))return[new Tt(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function eZ(e,t){let i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let a of t.valueSpec.expression.parameters)i.delete(a);if(i.size===0)return[];let n=[];return e instanceof Ja&&i.has(e.name)?[new Tt(t.key,t.value,'["'.concat(e.name,'"] expression is not supported in a filter for a ').concat(t.object.type," layer with id: ").concat(t.object.id))]:(e.eachChild(a=>{n.push(...eZ(a,t))}),n)}function ec(e){let t=e.key,i=e.value,n=e.valueSpec,a=[];return Array.isArray(n.values)?n.values.indexOf(Si(i))===-1&&a.push(new Tt(t,i,"expected one of [".concat(n.values.join(", "),"], ").concat(JSON.stringify(i)," found"))):Object.keys(n.values).indexOf(Si(i))===-1&&a.push(new Tt(t,i,"expected one of [".concat(Object.keys(n.values).join(", "),"], ").concat(JSON.stringify(i)," found"))),a}function U0(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let t of e.slice(1))if(!U0(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function ic(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};U0(e)||(e=nc(e));let i=e,n=!0;try{n=function(r){if(!dd(r))return r;let c=_a(r);return nZ(c),c=iZ(c),c}(i)}catch{console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(i,null,2),"\n        "))}let a=_["filter_".concat(t)],l=Il(n,a),o=null;if(l.result==="error")throw new Error(l.value.map(r=>"".concat(r.key,": ").concat(r.message)).join(", "));o=(r,c,b)=>l.value.evaluate(r,c,{},b);let d=null,s=null;if(n!==i){let r=Il(i,a);if(r.result==="error")throw new Error(r.value.map(c=>"".concat(c.key,": ").concat(c.message)).join(", "));d=(c,b,m,h,W)=>r.value.evaluate(c,b,{},m,void 0,void 0,h,W),s=!nd(r.value.expression)}return{filter:o,dynamicFilter:d||void 0,needGeometry:aZ(n),needFeature:!!s}}function iZ(e){if(!Array.isArray(e))return e;let t=function(i){if(mx.has(i[0])){for(let n=1;n<i.length;n++)if(dd(i[n]))return!0}return i}(e);return t===!0?t:t.map(i=>iZ(i))}function nZ(e){let t=!1,i=[];if(e[0]==="case"){for(let n=1;n<e.length-1;n+=2)t=t||dd(e[n]),i.push(e[n+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||dd(e[1]);for(let n=2;n<e.length-1;n+=2)i.push(e[n+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||dd(e[1]);for(let n=1;n<e.length-1;n+=2)i.push(e[n+1])}t&&(e.length=0,e.push("any",...i));for(let n=1;n<e.length;n++)nZ(e[n])}function dd(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(dd(e[i]))return!0;return!1}let mx=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hx(e,t){return e<t?-1:e>t?1:0}function aZ(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(aZ(e[t]))return!0;return!1}function nc(e){if(!e)return!0;let t=e[0];return e.length<=1?t!=="any":t==="=="?x0(e[1],e[2],"=="):t==="!="?ac(x0(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?x0(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(nc))):t==="all"?["all"].concat(e.slice(1).map(nc)):t==="none"?["all"].concat(e.slice(1).map(nc).map(ac)):t==="in"?lZ(e[1],e.slice(2)):t==="!in"?ac(lZ(e[1],e.slice(2))):t==="has"?oZ(e[1]):t!=="!has"||ac(oZ(e[1]));var i}function x0(e,t,i){switch(e){case"$type":return["filter-type-".concat(i),t];case"$id":return["filter-id-".concat(i),t];default:return["filter-".concat(i),e,t]}}function lZ(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(hx)]]:["filter-in-small",e,["literal",t]]}}function oZ(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function ac(e){return["!",e]}function N0(e){return U0(_a(e.value))?po(Da({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_".concat(e.layerType||"fill")]})):dZ(e)}function dZ(e){let t=e.value,i=e.key;if(fe(t)!=="array")return[new Tt(i,t,"array expected, ".concat(fe(t)," found"))];let n=e.styleSpec,a,l=[];if(t.length<1)return[new Tt(i,t,"filter array must have at least 1 element")];switch(l=l.concat(ec({key:"".concat(i,"[0]"),value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),Si(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Si(t[1])==="$type"&&l.push(new Tt(i,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":t.length!==3&&l.push(new Tt(i,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&(a=fe(t[1]),a!=="string"&&l.push(new Tt("".concat(i,"[1]"),t[1],"string expected, ".concat(a," found"))));for(let o=2;o<t.length;o++)a=fe(t[o]),Si(t[1])==="$type"?l=l.concat(ec({key:"".concat(i,"[").concat(o,"]"),value:t[o],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&l.push(new Tt("".concat(i,"[").concat(o,"]"),t[o],"string, number, or boolean expected, ".concat(a," found")));break;case"any":case"all":case"none":for(let o=1;o<t.length;o++)l=l.concat(dZ({key:"".concat(i,"[").concat(o,"]"),value:t[o],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=fe(t[1]),t.length!==2?l.push(new Tt(i,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):a!=="string"&&l.push(new Tt("".concat(i,"[1]"),t[1],"string expected, ".concat(a," found")))}return l}function sZ(e,t){let i=e.key,n=e.style,a=e.layer,l=e.styleSpec,o=e.value,d=e.objectKey,s=l["".concat(t,"_").concat(e.layerType)];if(!s)return[];let r=d.match(/^(.*)-transition$/);if(t==="paint"&&r&&s[r[1]]&&s[r[1]].transition)return nn({key:i,value:o,valueSpec:l.transition,style:n,styleSpec:l});let c=e.valueSpec||s[d];if(!c)return[new so(i,o,'unknown property "'.concat(d,'"'))];let b;if(fe(o)==="string"&&Wo(c)&&!c.tokens&&(b=/^{([^}]+)}$/.exec(o))){let h='`{ "type": "identity", "property": '.concat(b?JSON.stringify(b[1]):'"_"'," }`");return[new Tt(i,o,'"'.concat(d,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(h,"."))]}let m=[];if(e.layerType==="symbol")d!=="text-field"||!n||n.glyphs||n.imports||m.push(new Tt(i,o,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&Pr(_a(o))&&Si(o.type)==="identity"&&m.push(new Tt(i,o,'"text-font" does not support identity functions'));else if(e.layerType==="model"&&t==="paint"&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&Wo(c)&&(_1(c)||u0(c))){let h=I0(_a(o),c),W=h.value.expression||h.value._styleExpression.expression;W&&!ad(W,["measure-light"])&&(d==="model-emissive-strength"&&nd(W)&&us(W)||m.push(new Tt(i,o,"".concat(d," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return m.concat(nn({key:e.key,value:o,valueSpec:c,style:n,styleSpec:l,expressionContext:"property",propertyType:t,propertyKey:d}))}function rZ(e){return sZ(e,"paint")}function cZ(e){return sZ(e,"layout")}function bZ(e){let t=[],i=e.value,n=e.key,a=e.style,l=e.styleSpec;i.type||i.ref||t.push(new Tt(n,i,'either "type" or "ref" is required'));let o=Si(i.type),d=Si(i.ref);if(i.id){let s=Si(i.id);for(let r=0;r<e.arrayIndex;r++){let c=a.layers[r];Si(c.id)===s&&t.push(new Tt(n,i.id,'duplicate layer id "'.concat(i.id,'", previously used at line ').concat(c.id.__line__)))}}if("ref"in i){let s;["type","source","source-layer","filter","layout"].forEach(r=>{r in i&&t.push(new Tt(n,i[r],'"'.concat(r,'" is prohibited for ref layers')))}),a.layers.forEach(r=>{Si(r.id)===d&&(s=r)}),s?s.ref?t.push(new Tt(n,i.ref,"ref cannot reference another ref layer")):o=Si(s.type):typeof d=="string"&&t.push(new Tt(n,i.ref,'ref layer "'.concat(d,'" not found')))}else if(o!=="background"&&o!=="sky"&&o!=="slot")if(i.source){let s=a.sources&&a.sources[i.source],r=s&&Si(s.type);s?r==="vector"&&o==="raster"?t.push(new Tt(n,i.source,'layer "'.concat(i.id,'" requires a raster source'))):r==="raster"&&o!=="raster"?t.push(new Tt(n,i.source,'layer "'.concat(i.id,'" requires a vector source'))):r!=="vector"||i["source-layer"]?r==="raster-dem"&&o!=="hillshade"?t.push(new Tt(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):o!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||r==="geojson"&&s.lineMetrics||t.push(new Tt(n,i,'layer "'.concat(i.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new Tt(n,i,'layer "'.concat(i.id,'" must specify a "source-layer"'))):t.push(new Tt(n,i.source,'source "'.concat(i.source,'" not found')))}else t.push(new Tt(n,i,'missing required property "source"'));return t=t.concat($n({key:n,value:i,valueSpec:l.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nn({key:"".concat(n,".type"),value:i.type,valueSpec:l.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:s=>N0(Da({layerType:o},s)),layout:s=>$n({layer:i,key:s.key,value:s.value,valueSpec:{},style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":r=>cZ(Da({layerType:o},r))}}),paint:s=>$n({layer:i,key:s.key,value:s.value,valueSpec:{},style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":r=>rZ(Da({layerType:o,layer:i},r))}})}})),t}function sd(e){let t=e.value,i=e.key,n=fe(t);return n!=="string"?[new Tt(i,t,"string expected, ".concat(n," found"))]:[]}let mZ={promoteId:function({key:e,value:t}){if(fe(t)==="string")return sd({key:e,value:t});{let i=[];for(let n in t)i.push(...sd({key:"".concat(e,".").concat(n),value:t[n]}));return i}}};function hZ(e){let t=e.value,i=e.key,n=e.styleSpec,a=e.style;if(!t.type)return[new Tt(i,t,'"type" is required')];let l=Si(t.type),o=[];switch(["vector","raster","raster-dem"].includes(l)&&(t.url||t.tiles||o.push(new Tt(i,t,'Either "url" or "tiles" is required.'))),l){case"vector":case"raster":case"raster-dem":return o=o.concat($n({key:i,value:t,valueSpec:n["source_".concat(l.replace("-","_"))],style:e.style,styleSpec:n,objectElementValidators:mZ})),o;case"geojson":if(o=$n({key:i,value:t,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:mZ}),t.cluster)for(let d in t.clusterProperties){let[s,r]=t.clusterProperties[d],c=typeof s=="string"?[s,["accumulated"],["get",d]]:s;o.push(...po({key:"".concat(i,".").concat(d,".map"),value:r,expressionContext:"cluster-map"})),o.push(...po({key:"".concat(i,".").concat(d,".reduce"),value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return $n({key:i,value:t,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return $n({key:i,value:t,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new Tt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ec({key:"".concat(i,".type"),value:t.type,valueSpec:{values:Wx(n)},style:a,styleSpec:n})}}function Wx(e){return e.source.reduce((t,i)=>{let n=e[i];return n.type.type==="enum"&&(t=t.concat(Object.keys(n.type.values))),t},[])}function WZ(e){let t=e.value,i=[];if(!t)return i;let n=fe(t);return n!=="string"?(i=i.concat([new Tt(e.key,t,'string expected, "'.concat(n,'" found'))]),i):(function(a){let l=a.indexOf("://")===-1;try{return new URL(a,l?"http://example.com":void 0),!0}catch{return!1}}(t)||(i=i.concat([new Tt(e.key,t,'invalid url "'.concat(t,'"'))])),i)}function pZ(e){let t=e.value,i=e.styleSpec,n=i.light,a=e.style,l=[],o=fe(t);if(t===void 0)return l;if(o!=="object")return l=l.concat([new Tt("light",t,"object expected, ".concat(o," found"))]),l;for(let d in t){let s=d.match(/^(.*)-transition$/);l=l.concat(s&&n[s[1]]&&n[s[1]].transition?nn({key:d,value:t[d],valueSpec:i.transition,style:a,styleSpec:i}):n[d]?nn({key:d,value:t[d],valueSpec:n[d],style:a,styleSpec:i}):[new Tt(d,t[d],'unknown property "'.concat(d,'"'))])}return l}function ZZ(e){let t=e.value,i=[];if(!t)return i;let n=fe(t);if(n!=="object")return i=i.concat([new Tt("light-3d",t,"object expected, ".concat(n," found"))]),i;let a=e.styleSpec,l=a["light-3d"],o=e.key,d=e.style,s=e.style.lights;for(let b of["type","id"])if(!(b in t))return i=i.concat([new Tt("light-3d",t,"missing property ".concat(b," on light"))]),i;if(t.type&&s)for(let b=0;b<e.arrayIndex;b++){let m=Si(t.type),h=s[b];Si(h.type)===m&&i.push(new Tt(o,t.id,'duplicate light type "'.concat(t.type,'", previously defined at line ').concat(h.id.__line__)))}let r="properties_light_".concat(t.type);if(!(r in a))return i=i.concat([new Tt("light-3d",t,"Invalid light type ".concat(t.type))]),i;let c=a[r];for(let b in t)if(b==="properties"){let m=t[b],h=fe(m);if(h!=="object")return i=i.concat([new Tt("properties",m,"object expected, ".concat(h," found"))]),i;for(let W in m)i=i.concat(c[W]?nn({key:W,value:m[W],valueSpec:c[W],style:d,styleSpec:a}):[new so(e.key,m[W],'unknown property "'.concat(W,'"'))])}else{let m=b.match(/^(.*)-transition$/);i=i.concat(m&&l[m[1]]&&l[m[1]].transition?nn({key:b,value:t[b],valueSpec:a.transition,style:d,styleSpec:a}):l[b]?nn({key:b,value:t[b],valueSpec:l[b],style:d,styleSpec:a}):[new so(b,t[b],'unknown property "'.concat(b,'"'))])}return i}function VZ(e){let t=e.value,i=e.key,n=e.style,a=e.styleSpec,l=a.terrain,o=[],d=fe(t);if(t===void 0||d==="null")return o;if(d!=="object")return o=o.concat([new Tt("terrain",t,"object expected, ".concat(d," found"))]),o;for(let s in t){let r=s.match(/^(.*)-transition$/);o=o.concat(r&&l[r[1]]&&l[r[1]].transition?nn({key:s,value:t[s],valueSpec:a.transition,style:n,styleSpec:a}):l[s]?nn({key:s,value:t[s],valueSpec:l[s],style:n,styleSpec:a}):[new so(s,t[s],'unknown property "'.concat(s,'"'))])}if(t.source){let s=n.sources&&n.sources[t.source],r=s&&Si(s.type);s?r!=="raster-dem"&&o.push(new Tt(i,t.source,"terrain cannot be used with a source of type ".concat(String(r),', it only be used with a "raster-dem" source type'))):o.push(new Tt(i,t.source,'source "'.concat(t.source,'" not found')))}else o.push(new Tt(i,t,'terrain is missing required property "source"'));return o}function gZ(e){let t=e.value,i=e.style,n=e.styleSpec,a=n.fog,l=[],o=fe(t);if(t===void 0)return l;if(o!=="object")return l=l.concat([new Tt("fog",t,"object expected, ".concat(o," found"))]),l;for(let d in t){let s=d.match(/^(.*)-transition$/);l=l.concat(s&&a[s[1]]&&a[s[1]].transition?nn({key:d,value:t[d],valueSpec:n.transition,style:i,styleSpec:n}):a[d]?nn({key:d,value:t[d],valueSpec:a[d],style:i,styleSpec:n}):[new so(d,t[d],'unknown property "'.concat(d,'"'))])}return l}let uZ={"*":()=>[],array:q1,boolean:function(e){let t=e.value,i=e.key,n=fe(t);return n!=="boolean"?[new Tt(i,t,"boolean expected, ".concat(n," found"))]:[]},number:$1,color:function(e){let t=e.key,i=e.value,n=fe(i);return n!=="string"?[new Tt(t,i,"color expected, ".concat(n," found"))]:Bm(i)===null?[new Tt(t,i,'color expected, "'.concat(i,'" found'))]:[]},enum:ec,filter:N0,function:tZ,layer:bZ,object:$n,source:hZ,model:WZ,light:pZ,"light-3d":ZZ,terrain:VZ,fog:gZ,string:sd,formatted:function(e){return sd(e).length===0?[]:po(e)},resolvedImage:function(e){return sd(e).length===0?[]:po(e)},projection:function(e){let t=e.value,i=e.styleSpec,n=i.projection,a=e.style,l=[],o=fe(t);if(o==="object")for(let d in t)l=l.concat(nn({key:d,value:t[d],valueSpec:n[d],style:a,styleSpec:i}));else o!=="string"&&(l=l.concat([new Tt("projection",t,"object or string expected, ".concat(o," found"))]));return l},import:function(e){let{value:t,styleSpec:i}=e,{data:n,...a}=t;Object.defineProperty(a,"__line__",{value:t.__line__,enumerable:!1});let l=$n(Da({},e,{value:a,valueSpec:i.import}));return Si(a.id)===""&&l.push(new Tt("".concat(e.key,".id"),a,"import id can't be an empty string")),n&&(l=l.concat(RZ(n,i,{key:"".concat(e.key,".data")}))),l}};function nn(e,t=!1){let i=e.value,n=e.valueSpec,a=e.styleSpec;if(n.expression&&Pr(Si(i)))return tZ(e);if(n.expression&&qr(_a(i)))return po(e);if(n.type&&uZ[n.type]){let l=uZ[n.type](e);return t===!0&&l.length>0&&fe(e.value)==="array"?po(e):l}return $n(Da({},e,{valueSpec:n.type?a[n.type]:n}))}function px(e){let t=e.value,i=e.key,n=sd(e);return n.length||(t.indexOf("{fontstack}")===-1&&n.push(new Tt(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&n.push(new Tt(i,t,'"glyphs" url must include a "{range}" token'))),n}function RZ(e,t=_,i={}){return nn({key:i.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:px,"*":()=>[]}})}function rd(e,t=_){return Za(RZ(e,t))}let Zx=e=>Za(hZ(e)),Vx=e=>Za(pZ(e)),gx=e=>Za(ZZ(e)),ux=e=>Za(VZ(e)),Rx=e=>Za(gZ(e)),Gx=e=>Za(bZ(e)),Y0=e=>Za(N0(e)),Fx=e=>Za(rZ(e)),Ix=e=>Za(cZ(e)),Ux=e=>Za(WZ(e));function Za(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function lc(e,t){let i=!1;if(t&&t.length)for(let n of t)n instanceof so?A(n.message):(e.fire(new $t(new Error(n.message))),i=!0);return i}var xx=Ba,xl=3;function Ba(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var a=new Int32Array(this.arrayBuffer);e=a[0],this.d=(t=a[1])+2*(i=a[2]);for(var l=0;l<this.d*this.d;l++){var o=a[xl+l],d=a[xl+l+1];n.push(o===d?null:a.subarray(o,d))}var s=a[xl+n.length+1];this.keys=a.subarray(a[xl+n.length],s),this.bboxes=a.subarray(s),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var r=0;r<this.d*this.d;r++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var c=i/t*e;this.min=-c,this.max=e+c}Ba.prototype.insert=function(e,t,i,n,a){this._forEachCell(t,i,n,a,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a)},Ba.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ba.prototype._insertCell=function(e,t,i,n,a,l){this.cells[a].push(l)},Ba.prototype.query=function(e,t,i,n,a){var l=this.min,o=this.max;if(e<=l&&t<=l&&o<=i&&o<=n&&!a)return Array.prototype.slice.call(this.keys);var d=[];return this._forEachCell(e,t,i,n,this._queryCell,d,{},a),d},Ba.prototype._queryCell=function(e,t,i,n,a,l,o,d){var s=this.cells[a];if(s!==null)for(var r=this.keys,c=this.bboxes,b=0;b<s.length;b++){var m=s[b];if(o[m]===void 0){var h=4*m;(d?d(c[h+0],c[h+1],c[h+2],c[h+3]):e<=c[h+2]&&t<=c[h+3]&&i>=c[h+0]&&n>=c[h+1])?(o[m]=!0,l.push(r[m])):o[m]=!1}}},Ba.prototype._forEachCell=function(e,t,i,n,a,l,o,d){for(var s=this._convertToCellCoord(e),r=this._convertToCellCoord(t),c=this._convertToCellCoord(i),b=this._convertToCellCoord(n),m=s;m<=c;m++)for(var h=r;h<=b;h++){var W=this.d*h+m;if((!d||d(this._convertFromCellCoord(m),this._convertFromCellCoord(h),this._convertFromCellCoord(m+1),this._convertFromCellCoord(h+1)))&&a.call(this,e,t,i,n,W,l,o,d))return}},Ba.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ba.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ba.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=xl+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var a=new Int32Array(t+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var l=t,o=0;o<e.length;o++){var d=e[o];a[xl+o]=l,a.set(d,l),l+=d.length}return a[xl+e.length]=l,a.set(this.keys,l),a[xl+e.length+1]=l+=this.keys.length,a.set(this.bboxes,l),l+=this.bboxes.length,a.buffer};var cd=we(xx);let oc={};function kt(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),oc[t]={klass:e,omit:i.omit||[]}}kt(Object,"Object"),cd.serialize=function(e,t){let i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},cd.deserialize=function(e){return new cd(e.buffer)},Object.defineProperty(cd,"name",{value:"Grid"}),kt(cd,"Grid"),kt(re,"Color"),kt(Error,"Error"),kt(lt,"AJAXError"),kt(qn,"ResolvedImage"),kt($r,"StylePropertyFunction"),kt(G0,"StyleExpression",{omit:["_evaluator"]}),kt(Ul,"ZoomDependentExpression"),kt(F0,"ZoomConstantExpression"),kt(Ja,"CompoundExpression",{omit:["_evaluate"]});for(let e in Fs)oc[Fs[e]._classRegistryKey]||kt(Fs[e],"Expression".concat(e));function GZ(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function FZ(e){return T.ImageBitmap&&e instanceof T.ImageBitmap}function bd(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(GZ(e)||FZ(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){let i=e;return t&&t.add(i.buffer),i}if(e instanceof T.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){let i=[];for(let n of e)i.push(bd(n,t));return i}if(e instanceof Map){let i={$name:"Map"};for(let[n,a]of e.entries())i[n]=bd(a);return i}if(typeof e=="object"){let i=e.constructor,n=i._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class ".concat(n));let a=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(let l in e)e.hasOwnProperty(l)&&(oc[n].omit.indexOf(l)>=0||(a[l]=bd(e[l],t)));e instanceof Error&&(a.message=e.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof e)}function md(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||GZ(e)||FZ(e)||ArrayBuffer.isView(e)||e instanceof T.ImageData)return e;if(Array.isArray(e))return e.map(md);if(typeof e=="object"){let t=e.$name||"Object";if(t==="Map"){let a=new Map;for(let l of Object.keys(e))l!=="$name"&&a.set(l,md(e[l]));return a}let{klass:i}=oc[t];if(!i)throw new Error("can't deserialize unregistered class ".concat(t));if(i.deserialize)return i.deserialize(e);let n=Object.create(i.prototype);for(let a of Object.keys(e))a!=="$name"&&(n[a]=md(e[a]));return n}throw new Error("can't deserialize object of type "+typeof e)}let vt={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function X0(e){for(let t of e)if(J0(t.charCodeAt(0)))return!0;return!1}function Nx(e){for(let t of e)if(!Yx(t.charCodeAt(0)))return!1;return!0}function Yx(e){return!(vt.Arabic(e)||vt["Arabic Supplement"](e)||vt["Arabic Extended-A"](e)||vt["Arabic Presentation Forms-A"](e)||vt["Arabic Presentation Forms-B"](e))}function J0(e){return!(e!==746&&e!==747&&(e<4352||!(vt["Bopomofo Extended"](e)||vt.Bopomofo(e)||vt["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||vt["CJK Compatibility Ideographs"](e)||vt["CJK Compatibility"](e)||vt["CJK Radicals Supplement"](e)||vt["CJK Strokes"](e)||!(!vt["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||vt["CJK Unified Ideographs Extension A"](e)||vt["CJK Unified Ideographs"](e)||vt["Enclosed CJK Letters and Months"](e)||vt["Hangul Compatibility Jamo"](e)||vt["Hangul Jamo Extended-A"](e)||vt["Hangul Jamo Extended-B"](e)||vt["Hangul Jamo"](e)||vt["Hangul Syllables"](e)||vt.Hiragana(e)||vt["Ideographic Description Characters"](e)||vt.Kanbun(e)||vt["Kangxi Radicals"](e)||vt["Katakana Phonetic Extensions"](e)||vt.Katakana(e)&&e!==12540||!(!vt["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!vt["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||vt["Unified Canadian Aboriginal Syllabics"](e)||vt["Unified Canadian Aboriginal Syllabics Extended"](e)||vt["Vertical Forms"](e)||vt["Yijing Hexagram Symbols"](e)||vt["Yi Syllables"](e)||vt["Yi Radicals"](e))))}function IZ(e){return!(J0(e)||function(t){return!!(vt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||vt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||vt["Letterlike Symbols"](t)||vt["Number Forms"](t)||vt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||vt["Control Pictures"](t)&&t!==9251||vt["Optical Character Recognition"](t)||vt["Enclosed Alphanumerics"](t)||vt["Geometric Shapes"](t)||vt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||vt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vt["CJK Symbols and Punctuation"](t)||vt.Katakana(t)||vt["Private Use Area"](t)||vt["CJK Compatibility Forms"](t)||vt["Small Form Variants"](t)||vt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function UZ(e){return e>=1424&&e<=2303||vt["Arabic Presentation Forms-A"](e)||vt["Arabic Presentation Forms-B"](e)}function Xx(e,t){return!(!t&&UZ(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||vt.Khmer(e))}function Jx(e){for(let t of e)if(UZ(t.charCodeAt(0)))return!0;return!1}let y0="deferred",B0="loading",M0="loaded",C0=null,Bn="unavailable",Nl=null,xZ=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Bn="error"),C0&&C0(e)};function T0(){k0.fire(new Wt("pluginStateChange",{pluginStatus:Bn,pluginURL:Nl}))}let k0=new Xi,S0=function(){return Bn},NZ=function(){if(Bn!==y0||!Nl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bn=B0,T0(),Nl&&Ft({url:Nl},e=>{e?xZ(e):(Bn=M0,T0())})},ta={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Bn===M0||ta.applyArabicShaping!=null,isLoading:()=>Bn===B0,setState(e){Bn=e.pluginStatus,Nl=e.pluginURL},isParsed:()=>ta.applyArabicShaping!=null&&ta.processBidirectionalText!=null&&ta.processStyledBidirectionalText!=null,getPluginURL:()=>Nl};class si{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,n){for(let a of i)if(!Xx(a.charCodeAt(0),n))return!1;return!0}(t,ta.isLoaded())}}class dc{constructor(t,i,n){this.property=t,this.value=i,this.expression=function(a,l,o){if(Pr(a))return new $r(a,l);if(qr(a)||Array.isArray(a)&&a.length>0){let d=I0(a,l,o);if(d.result==="error")throw new Error(d.value.map(s=>"".concat(s.key,": ").concat(s.message)).join(", "));return d.value}{let d=a;return typeof a=="string"&&l.type==="color"&&(d=re.parse(a)),{kind:"constant",isConfigDependent:!1,evaluate:()=>d}}}(i===void 0?t.specification.default:i,t.specification,n)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,n){return this.property.possiblyEvaluate(this,t,i,n)}}class Q0{constructor(t,i){this.property=t,this.value=new dc(t,void 0,i)}transitioned(t,i){return new YZ(this.property,this.value,i,Xt({},t.transition,this.transition),t.now)}untransitioned(){return new YZ(this.property,this.value,null,{},0)}}class Us{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return k(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new Q0(this._values[t].property,this._options)),this._values[t].value=new dc(this._values[t].property,i===null?void 0:k(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,i){i&&(this._options=i);let n=this._properties.properties;if(t)for(let a in t){let l=t[a];if(ul(a,"-transition")){let o=a.slice(0,-11);n[o]&&this.setTransition(o,l)}else n[a]&&this.setValue(a,l)}}getTransition(t){return k(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new Q0(this._values[t].property)),this._values[t].transition=k(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let n=this.getValue(i);n!==void 0&&(t[i]=n);let a=this.getTransition(i);a!==void 0&&(t["".concat(i,"-transition")]=a)}return t}transitioned(t,i){let n=new XZ(this._properties);for(let a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(t,i._values[a]);return n}untransitioned(){let t=new XZ(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class YZ{constructor(t,i,n,a,l){let o=a.delay||0,d=a.duration||0;l=l||0,this.property=t,this.value=i,this.begin=l+o,this.end=this.begin+d,t.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(t,i,n){let a=t.now||0,l=this.value.possiblyEvaluate(t,i,n),o=this.prior;if(o){if(a>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(a<this.begin)return o.possiblyEvaluate(t,i,n);{let d=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,i,n),l,xn(d))}}return l}}class XZ{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,n){let a=new xs(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(t,i,n);return a}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class yx{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=i,this.isConfigDependent=!1}getValue(t){return k(this._values[t].value)}setValue(t,i){this._values[t]=new dc(this._values[t].property,i===null?void 0:k(i),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){let t={};for(let i of Object.keys(this._values)){let n=this.getValue(i);n!==void 0&&(t[i]=n)}return t}possiblyEvaluate(t,i,n){let a=new xs(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].possiblyEvaluate(t,i,n);return a}}class hd{constructor(t,i,n){this.property=t,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,n,a){return this.property.evaluate(this.value,this.parameters,t,i,n,a)}}class xs{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class mt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,n){let a=Or[this.specification.type];return a?a(t,i,n):t}}class Et{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,n,a){return new hd(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},n,a)}:t.expression,i)}interpolate(t,i,n){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new hd(this,{kind:"constant",value:void 0},t.parameters);let a=Or[this.specification.type];return a?new hd(this,{kind:"constant",value:a(t.value.value,i.value.value,n)},t.parameters):t}evaluate(t,i,n,a,l,o){return t.kind==="constant"?t.value:t.evaluate(i,n,a,l,o)}}class Ns{constructor(t){this.specification=t}possiblyEvaluate(t,i,n,a){return!!t.expression.evaluate(i,null,{},n,a)}interpolate(){return!1}}class Zi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new si(0,{});for(let n in t){let a=t[n];a.specification.overridable&&this.overridableProperties.push(n);let l=this.defaultPropertyValues[n]=new dc(a,void 0),o=this.defaultTransitionablePropertyValues[n]=new Q0(a);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=l.possiblyEvaluate(i)}}}kt(Et,"DataDrivenProperty"),kt(mt,"DataConstantProperty"),kt(Ns,"ColorRampProperty");let sc="";function JZ(e){return e.indexOf(sc)>=0}function mn(e,t){return t?"".concat(e).concat(sc).concat(t):e}function rc(e){let t=e.indexOf(sc);return t>=0?e.slice(0,t):e}let yZ="-transition";class En extends Xi{constructor(t,i,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=n,t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new yx(i.layout,n),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Us(i.paint,n);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xs(i.paint)}}setScope(t){this.scope=t,this.fqid=mn(this.id,t)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,n={}){if(i!=null&&this._validate(Ix,"layers.".concat(this.id,".layout.").concat(t),t,i,n))return;if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);let a=this._unevaluatedLayout;a._properties.properties[t]&&(a.setValue(t,i),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return ul(t,yZ)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,n={}){if(i!=null&&this._validate(Fx,"layers.".concat(this.id,".paint.").concat(t),t,i,n))return!1;let a=this._transitionablePaint,l=a._properties.properties;if(ul(t,yZ)){let m=t.slice(0,-11);return l[m]&&a.setTransition(m,i||void 0),!1}if(!l[t])return!1;let o=a._values[t],d=o.value.isDataDriven(),s=o.value;a.setValue(t,i),this.isConfigDependent=this.isConfigDependent||a.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);let r=a._values[t].value,c=r.isDataDriven(),b=ul(t,"pattern")||t==="line-dasharray";return c||d||b||this._handleOverridablePaintPropertyUpdate(t,s,r)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i){return null}_handleOverridablePaintPropertyUpdate(t,i,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return pt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}_validate(t,i,n,a,l={}){return(!l||l.validate!==!1)&&lc(this,t.call(rd,{key:i,layerType:this.type,objectKey:n,value:a,styleSpec:_,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof hd&&Wo(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ic(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class Bx{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,i){this._updatedSourceCaches[t]=i,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let i=t.scope;this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._updatedLayers[i].add(t.id),this.setDirty()}removeLayer(t){let i=t.scope;this._removedLayers[i]=this._removedLayers[i]||{},this._updatedLayers[i]=this._updatedLayers[i]||new Set,this._removedLayers[i][t.id]=t,this._updatedLayers[i].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let i in this._updatedLayers)t[i]=t[i]||{},t[i].updatedIds=Array.from(this._updatedLayers[i].values());for(let i in this._removedLayers)t[i]=t[i]||{},t[i].removedIds=Object.keys(this._removedLayers[i]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let Mx={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cc{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ri{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ce(e,t=1){let i=0,n=0;return{members:e.map(a=>{let l=Mx[a.type].BYTES_PER_ELEMENT,o=i=BZ(i,Math.max(t,l)),d=a.components||1;return n=Math.max(n,l),i+=l*d,{name:a.name,type:a.type,components:d,offset:o}}),size:BZ(i,Math.max(n,t)),alignment:t}}function BZ(e,t){return Math.ceil(e/t)*t}class Mn extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let a=2*t;return this.int16[a+0]=i,this.int16[a+1]=n,t}}Mn.prototype.bytesPerElement=4,kt(Mn,"StructArrayLayout2i4");class bc extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,i,n)}emplace(t,i,n,a){let l=3*t;return this.int16[l+0]=i,this.int16[l+1]=n,this.int16[l+2]=a,t}}bc.prototype.bytesPerElement=6,kt(bc,"StructArrayLayout3i6");class Zo extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,n,a)}emplace(t,i,n,a,l){let o=4*t;return this.int16[o+0]=i,this.int16[o+1]=n,this.int16[o+2]=a,this.int16[o+3]=l,t}}Zo.prototype.bytesPerElement=8,kt(Zo,"StructArrayLayout4i8");class v0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l){let o=this.length;return this.resize(o+1),this.emplace(o,t,i,n,a,l)}emplace(t,i,n,a,l,o){let d=5*t;return this.int16[d+0]=i,this.int16[d+1]=n,this.int16[d+2]=a,this.int16[d+3]=l,this.int16[d+4]=o,t}}v0.prototype.bytesPerElement=10,kt(v0,"StructArrayLayout5i10");class f0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,a,l,o,d)}emplace(t,i,n,a,l,o,d,s){let r=6*t,c=12*t,b=3*t;return this.int16[r+0]=i,this.int16[r+1]=n,this.uint8[c+4]=a,this.uint8[c+5]=l,this.uint8[c+6]=o,this.uint8[c+7]=d,this.float32[b+2]=s,t}}f0.prototype.bytesPerElement=12,kt(f0,"StructArrayLayout2i4ub1f12");class qa extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,n,a)}emplace(t,i,n,a,l){let o=4*t;return this.float32[o+0]=i,this.float32[o+1]=n,this.float32[o+2]=a,this.float32[o+3]=l,t}}qa.prototype.bytesPerElement=16,kt(qa,"StructArrayLayout4f16");class Yl extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l){let o=this.length;return this.resize(o+1),this.emplace(o,t,i,n,a,l)}emplace(t,i,n,a,l,o){let d=6*t,s=3*t;return this.uint16[d+0]=i,this.uint16[d+1]=n,this.uint16[d+2]=a,this.uint16[d+3]=l,this.float32[s+2]=o,t}}Yl.prototype.bytesPerElement=12,kt(Yl,"StructArrayLayout4ui1f12");class mc extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,n,a)}emplace(t,i,n,a,l){let o=4*t;return this.uint16[o+0]=i,this.uint16[o+1]=n,this.uint16[o+2]=a,this.uint16[o+3]=l,t}}mc.prototype.bytesPerElement=8,kt(mc,"StructArrayLayout4ui8");class hc extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n,a,l,o)}emplace(t,i,n,a,l,o,d){let s=6*t;return this.int16[s+0]=i,this.int16[s+1]=n,this.int16[s+2]=a,this.int16[s+3]=l,this.int16[s+4]=o,this.int16[s+5]=d,t}}hc.prototype.bytesPerElement=12,kt(hc,"StructArrayLayout6i12");class z0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d,s,r,c,b,m){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,a,l,o,d,s,r,c,b,m)}emplace(t,i,n,a,l,o,d,s,r,c,b,m,h){let W=12*t;return this.int16[W+0]=i,this.int16[W+1]=n,this.int16[W+2]=a,this.int16[W+3]=l,this.uint16[W+4]=o,this.uint16[W+5]=d,this.uint16[W+6]=s,this.uint16[W+7]=r,this.int16[W+8]=c,this.int16[W+9]=b,this.int16[W+10]=m,this.int16[W+11]=h,t}}z0.prototype.bytesPerElement=24,kt(z0,"StructArrayLayout4i4ui4i24");class L0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,n,a,l,o)}emplace(t,i,n,a,l,o,d){let s=10*t,r=5*t;return this.int16[s+0]=i,this.int16[s+1]=n,this.int16[s+2]=a,this.float32[r+2]=l,this.float32[r+3]=o,this.float32[r+4]=d,t}}L0.prototype.bytesPerElement=20,kt(L0,"StructArrayLayout3i3f20");class E0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}E0.prototype.bytesPerElement=4,kt(E0,"StructArrayLayout1ul4");class Xl extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let a=2*t;return this.uint16[a+0]=i,this.uint16[a+1]=n,t}}Xl.prototype.bytesPerElement=4,kt(Xl,"StructArrayLayout2ui4");class A0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d,s,r,c,b,m,h){let W=this.length;return this.resize(W+1),this.emplace(W,t,i,n,a,l,o,d,s,r,c,b,m,h)}emplace(t,i,n,a,l,o,d,s,r,c,b,m,h,W){let p=20*t,Z=10*t;return this.int16[p+0]=i,this.int16[p+1]=n,this.int16[p+2]=a,this.int16[p+3]=l,this.int16[p+4]=o,this.float32[Z+3]=d,this.float32[Z+4]=s,this.float32[Z+5]=r,this.float32[Z+6]=c,this.int16[p+14]=b,this.uint32[Z+8]=m,this.uint16[p+18]=h,this.uint16[p+19]=W,t}}A0.prototype.bytesPerElement=40,kt(A0,"StructArrayLayout5i4f1i1ul2ui40");class Wc extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,a,l,o,d)}emplace(t,i,n,a,l,o,d,s){let r=8*t;return this.int16[r+0]=i,this.int16[r+1]=n,this.int16[r+2]=a,this.int16[r+4]=l,this.int16[r+5]=o,this.int16[r+6]=d,this.int16[r+7]=s,t}}Wc.prototype.bytesPerElement=16,kt(Wc,"StructArrayLayout3i2i2i16");class w0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l){let o=this.length;return this.resize(o+1),this.emplace(o,t,i,n,a,l)}emplace(t,i,n,a,l,o){let d=4*t,s=8*t;return this.float32[d+0]=i,this.float32[d+1]=n,this.float32[d+2]=a,this.int16[s+6]=l,this.int16[s+7]=o,t}}w0.prototype.bytesPerElement=16,kt(w0,"StructArrayLayout2f1f2i16");class j0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,n,a)}emplace(t,i,n,a,l){let o=12*t,d=3*t;return this.uint8[o+0]=i,this.uint8[o+1]=n,this.float32[d+1]=a,this.float32[d+2]=l,t}}j0.prototype.bytesPerElement=12,kt(j0,"StructArrayLayout2ub2f12");class yi extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,i,n)}emplace(t,i,n,a){let l=3*t;return this.uint16[l+0]=i,this.uint16[l+1]=n,this.uint16[l+2]=a,t}}yi.prototype.bytesPerElement=6,kt(yi,"StructArrayLayout3ui6");class H0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R){let I=this.length;return this.resize(I+1),this.emplace(I,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R)}emplace(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R,I){let N=30*t,Y=15*t,X=60*t;return this.int16[N+0]=i,this.int16[N+1]=n,this.int16[N+2]=a,this.float32[Y+2]=l,this.float32[Y+3]=o,this.uint16[N+8]=d,this.uint16[N+9]=s,this.uint32[Y+5]=r,this.uint32[Y+6]=c,this.uint32[Y+7]=b,this.uint16[N+16]=m,this.uint16[N+17]=h,this.uint16[N+18]=W,this.float32[Y+10]=p,this.float32[Y+11]=Z,this.uint8[X+48]=g,this.uint8[X+49]=u,this.uint8[X+50]=G,this.uint32[Y+13]=F,this.int16[N+28]=R,this.uint8[X+58]=I,t}}H0.prototype.bytesPerElement=60,kt(H0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class O0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R,I,N,Y,X,J,B,C,Q,y,z,E){let O=this.length;return this.resize(O+1),this.emplace(O,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R,I,N,Y,X,J,B,C,Q,y,z,E)}emplace(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R,I,N,Y,X,J,B,C,Q,y,z,E,O){let f=20*t,L=40*t,K=80*t;return this.float32[f+0]=i,this.float32[f+1]=n,this.int16[L+4]=a,this.int16[L+5]=l,this.int16[L+6]=o,this.int16[L+7]=d,this.int16[L+8]=s,this.int16[L+9]=r,this.int16[L+10]=c,this.int16[L+11]=b,this.int16[L+12]=m,this.uint16[L+13]=h,this.uint16[L+14]=W,this.uint16[L+15]=p,this.uint16[L+16]=Z,this.uint16[L+17]=g,this.uint16[L+18]=u,this.uint16[L+19]=G,this.uint16[L+20]=F,this.uint16[L+21]=R,this.uint16[L+22]=I,this.uint16[L+23]=N,this.uint16[L+24]=Y,this.uint16[L+25]=X,this.uint16[L+26]=J,this.uint16[L+27]=B,this.uint32[f+14]=C,this.float32[f+15]=Q,this.float32[f+16]=y,this.float32[f+17]=z,this.float32[f+18]=E,this.uint8[K+76]=O,t}}O0.prototype.bytesPerElement=80,kt(O0,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ys extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Ys.prototype.bytesPerElement=4,kt(Ys,"StructArrayLayout1f4");class Vo extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l){let o=this.length;return this.resize(o+1),this.emplace(o,t,i,n,a,l)}emplace(t,i,n,a,l,o){let d=5*t;return this.float32[d+0]=i,this.float32[d+1]=n,this.float32[d+2]=a,this.float32[d+3]=l,this.float32[d+4]=o,t}}Vo.prototype.bytesPerElement=20,kt(Vo,"StructArrayLayout5f20");class D0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,a,l,o,d)}emplace(t,i,n,a,l,o,d,s){let r=7*t;return this.float32[r+0]=i,this.float32[r+1]=n,this.float32[r+2]=a,this.float32[r+3]=l,this.float32[r+4]=o,this.float32[r+5]=d,this.float32[r+6]=s,t}}D0.prototype.bytesPerElement=28,kt(D0,"StructArrayLayout7f28");class _0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,n,a)}emplace(t,i,n,a,l){let o=6*t;return this.uint32[3*t+0]=i,this.uint16[o+2]=n,this.uint16[o+3]=a,this.uint16[o+4]=l,t}}_0.prototype.bytesPerElement=12,kt(_0,"StructArrayLayout1ul3ui12");class Xs extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Xs.prototype.bytesPerElement=2,kt(Xs,"StructArrayLayout1ui2");class go extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,i,n)}emplace(t,i,n,a){let l=3*t;return this.float32[l+0]=i,this.float32[l+1]=n,this.float32[l+2]=a,t}}go.prototype.bytesPerElement=12,kt(go,"StructArrayLayout3f12");class Js extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let a=2*t;return this.float32[a+0]=i,this.float32[a+1]=n,t}}Js.prototype.bytesPerElement=8,kt(Js,"StructArrayLayout2f8");class K0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z){let g=this.length;return this.resize(g+1),this.emplace(g,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z)}emplace(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g){let u=16*t;return this.float32[u+0]=i,this.float32[u+1]=n,this.float32[u+2]=a,this.float32[u+3]=l,this.float32[u+4]=o,this.float32[u+5]=d,this.float32[u+6]=s,this.float32[u+7]=r,this.float32[u+8]=c,this.float32[u+9]=b,this.float32[u+10]=m,this.float32[u+11]=h,this.float32[u+12]=W,this.float32[u+13]=p,this.float32[u+14]=Z,this.float32[u+15]=g,t}}K0.prototype.bytesPerElement=64,kt(K0,"StructArrayLayout16f64");class pc extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,a,l,o,d){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,a,l,o,d)}emplace(t,i,n,a,l,o,d,s){let r=10*t,c=5*t;return this.uint16[r+0]=i,this.uint16[r+1]=n,this.uint16[r+2]=a,this.uint16[r+3]=l,this.float32[c+2]=o,this.float32[c+3]=d,this.float32[c+4]=s,t}}pc.prototype.bytesPerElement=20,kt(pc,"StructArrayLayout4ui3f20");class P0 extends ri{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}P0.prototype.bytesPerElement=1,kt(P0,"StructArrayLayout1ub1");class MZ extends cc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}MZ.prototype.size=40;class q0 extends A0{get(t){return new MZ(this,t)}}kt(q0,"CollisionBoxArray");class CZ extends cc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}CZ.prototype.size=60;class TZ extends H0{get(t){return new CZ(this,t)}}kt(TZ,"PlacedSymbolArray");class kZ extends cc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}kZ.prototype.size=80;class SZ extends O0{get(t){return new kZ(this,t)}}kt(SZ,"SymbolInstanceArray");class QZ extends Ys{getoffsetX(t){return this.float32[1*t+0]}}kt(QZ,"GlyphOffsetArray");class vZ extends Mn{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}kt(vZ,"SymbolLineVertexArray");class fZ extends cc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fZ.prototype.size=12;class zZ extends _0{get(t){return new fZ(this,t)}}kt(zZ,"FeatureIndexArray");class LZ extends Xl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}kt(LZ,"FillExtrusionCentroidArray");let Cx=Ce([{name:"a_pos",components:2,type:"Int16"}],4),Tx=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ze{constructor(t=[]){this.segments=t}_prepareSegment(t,i,n,a){let l=this.segments[this.segments.length-1];return t>ze.MAX_VERTEX_ARRAY_LENGTH&&A("Max vertices per segment is ".concat(ze.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t)),(!l||l.vertexLength+t>ze.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==a)&&(l={vertexOffset:i,primitiveOffset:n,vertexLength:0,primitiveLength:0},a!==void 0&&(l.sortKey=a),this.segments.push(l)),l}prepareSegment(t,i,n,a){return this._prepareSegment(t,i.length,n.length,a)}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,n,a){return new ze([{vertexOffset:t,primitiveOffset:i,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}function EZ(e,t){return 256*(e=Mt(Math.floor(e),0,255))+Mt(Math.floor(t),0,255)}ze.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kt(ze,"SegmentVector");let kx=Ce([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Sx=Ce([{name:"a_dash",components:4,type:"Uint16"}]);var Zc={exports:{}},AZ={exports:{}};(function(e){e.exports=function(t,i){var n,a,l,o,d,s,r,c;for(a=t.length-(n=3&t.length),l=i,d=3432918353,s=461845907,c=0;c<a;)r=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,l=27492+(65535&(o=5*(65535&(l=(l^=r=(65535&(r=(r=(65535&r)*d+(((r>>>16)*d&65535)<<16)&4294967295)<<15|r>>>17))*s+(((r>>>16)*s&65535)<<16)&4294967295)<<13|l>>>19))+((5*(l>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(r=0,n){case 3:r^=(255&t.charCodeAt(c+2))<<16;case 2:r^=(255&t.charCodeAt(c+1))<<8;case 1:l^=r=(65535&(r=(r=(65535&(r^=255&t.charCodeAt(c)))*d+(((r>>>16)*d&65535)<<16)&4294967295)<<15|r>>>17))*s+(((r>>>16)*s&65535)<<16)&4294967295}return l^=t.length,l=2246822507*(65535&(l^=l>>>16))+((2246822507*(l>>>16)&65535)<<16)&4294967295,l=3266489909*(65535&(l^=l>>>13))+((3266489909*(l>>>16)&65535)<<16)&4294967295,(l^=l>>>16)>>>0}})(AZ);var Qx=AZ.exports,wZ={exports:{}};(function(e){e.exports=function(t,i){for(var n,a=t.length,l=i^a,o=0;a>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),l=1540483477*(65535&l)+((1540483477*(l>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++o;switch(a){case 3:l^=(255&t.charCodeAt(o+2))<<16;case 2:l^=(255&t.charCodeAt(o+1))<<8;case 1:l=1540483477*(65535&(l^=255&t.charCodeAt(o)))+((1540483477*(l>>>16)&65535)<<16)}return l=1540483477*(65535&(l^=l>>>13))+((1540483477*(l>>>16)&65535)<<16),(l^=l>>>15)>>>0}})(wZ);var jZ=Qx,vx=wZ.exports;Zc.exports=jZ,Zc.exports.murmur3=jZ,Zc.exports.murmur2=vx;var $0=we(Zc.exports);class ys{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,n,a){this.ids.push(HZ(t)),this.positions.push(i,n,a)}eachPosition(t,i){let n=HZ(t),a=0,l=this.ids.length-1;for(;a<l;){let o=a+l>>1;this.ids[o]>=n?l=o:a=o+1}for(;this.ids[a]===n;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(t,i){let n=new Float64Array(t.ids),a=new Uint32Array(t.positions);return th(n,a,0,n.length-1),i&&(i.add(n.buffer),i.add(a.buffer)),{ids:n,positions:a}}static deserialize(t){let i=new ys,n;i.ids=t.ids,i.positions=t.positions;for(let a of i.ids)a!==n&&i.uniqueIds.push(a),n=a;return i.indexed=!0,i}}function HZ(e){let t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:$0(String(e))}function th(e,t,i,n){for(;i<n;){let a=e[i+n>>1],l=i-1,o=n+1;for(;;){do l++;while(e[l]<a);do o--;while(e[o]>a);if(l>=o)break;Vc(e,l,o),Vc(t,3*l,3*o),Vc(t,3*l+1,3*o+1),Vc(t,3*l+2,3*o+2)}o-i<n-o?(th(e,t,i,o),i=o+1):(th(e,t,o+1,n),n=o)}}function Vc(e,t,i){let n=e[t];e[t]=e[i],e[i]=n}kt(ys,"FeaturePositionMap");class $a{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class he extends $a{constructor(t){super(t),this.current=0}set(t,i,n){this.fetchUniformLocation(t,i)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class st extends $a{constructor(t){super(t),this.current=0}set(t,i,n){this.fetchUniformLocation(t,i)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class We extends $a{constructor(t){super(t),this.current=[0,0]}set(t,i,n){this.fetchUniformLocation(t,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class ae extends $a{constructor(t){super(t),this.current=[0,0,0]}set(t,i,n){this.fetchUniformLocation(t,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class Cn extends $a{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,n){this.fetchUniformLocation(t,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Wd extends $a{constructor(t){super(t),this.current=re.transparent}set(t,i,n){this.fetchUniformLocation(t,i)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}let fx=new Float32Array(16);class ie extends $a{constructor(t){super(t),this.current=fx}set(t,i,n){if(this.fetchUniformLocation(t,i)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}let zx=new Float32Array(9);class eh extends $a{constructor(t){super(t),this.current=zx}set(t,i,n){if(this.fetchUniformLocation(t,i)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}}let Lx=new Float32Array(4);class ih extends $a{constructor(t){super(t),this.current=Lx}set(t,i,n){if(this.fetchUniformLocation(t,i)){for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}}function nh(e){return[EZ(255*e.r,255*e.g),EZ(255*e.b,255*e.a)]}class Bs{constructor(t,i,n){this.value=t,this.uniformNames=i.map(a=>"u_".concat(a)),this.type=n}setUniform(t,i,n,a,l){i.set(t,l,a.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new Wd(t):new st(t)}}class pd{constructor(t,i){this.uniformNames=i.map(n=>"u_".concat(n)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,n,a,l){let o=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;o&&i.set(t,l,o)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new Cn(t):new st(t)}}class tl{constructor(t,i,n,a){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:"a_".concat(l),type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(t,i,n,a,l,o,d){let s=this.paintVertexArray.length,r=this.expression.evaluate(new si(0,{brightness:o}),i,{},l,a,d);this.paintVertexArray.resize(t),this._setPaintValue(s,t,r)}updatePaintArray(t,i,n,a,l,o,d){let s=this.expression.evaluate({zoom:0,brightness:d},n,a,void 0,l);this._setPaintValue(t,i,s)}_setPaintValue(t,i,n){if(this.type==="color"){let a=nh(n);for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,a[0],a[1])}else{for(let a=t;a<i;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Va{constructor(t,i,n,a,l,o){this.expression=t,this.uniformNames=i.map(d=>"u_".concat(d,"_t")),this.type=n,this.useIntegerZoom=a,this.zoom=l,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:"a_".concat(d),type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,i,n,a,l,o,d){let s=this.expression.evaluate(new si(this.zoom,{brightness:o}),i,{},l,a,d),r=this.expression.evaluate(new si(this.zoom+1,{brightness:o}),i,{},l,a,d),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,s,r)}updatePaintArray(t,i,n,a,l,o,d){let s=this.expression.evaluate({zoom:this.zoom,brightness:d},n,a,void 0,l),r=this.expression.evaluate({zoom:this.zoom+1,brightness:d},n,a,void 0,l);this._setPaintValue(t,i,s,r)}_setPaintValue(t,i,n,a){if(this.type==="color"){let l=nh(n),o=nh(a);for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1],o[0],o[1])}else{for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,n,a,l){let o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,d=Mt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);i.set(t,l,d)}getBinding(t,i){return new st(t)}}class Jl{constructor(t,i,n,a,l){this.expression=t,this.layerId=l,this.paintVertexAttributes=(n==="array"?Sx:kx).members;for(let o=0;o<i.length;++o);this.paintVertexArray=new a}populatePaintArray(t,i,n){let a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(a,t,i.patterns&&i.patterns[this.layerId],n)}updatePaintArray(t,i,n,a,l,o,d){this._setPaintValues(t,i,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(t,i,n,a){if(!a||!n)return;let l=a[n];if(!l)return;let{tl:o,br:d,pixelRatio:s}=l;for(let r=t;r<i;r++)this.paintVertexArray.emplace(r,o[0],o[1],d[0],d[1],s)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class uo{constructor(t,i,n=()=>!0){this.binders={},this._buffers=[];let a=[];for(let l in t.paint._values){let o=t.paint.get(l);if(!n(l)||!(o instanceof hd&&Wo(o.property.specification)))continue;let d=Ax(l,t.type),s=o.value,r=o.property.specification.type,c=!!o.property.useIntegerZoom,b=l==="line-dasharray"||l.endsWith("pattern"),m=l==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(s.kind!=="constant"||m)if(s.kind==="source"||m||b){let h=OZ(l,r,"source");this.binders[l]=b?new Jl(s,d,r,h,t.id):new tl(s,d,r,h),a.push("/a_".concat(l))}else{let h=OZ(l,r,"composite");this.binders[l]=new Va(s,d,r,c,i,h),a.push("/z_".concat(l))}else this.binders[l]=b?new pd(s.value,d):new Bs(s.value,d,r),a.push("/u_".concat(l))}this.cacheKey=a.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof tl||i instanceof Va?i.maxValue:0}populatePaintArrays(t,i,n,a,l,o,d){for(let s in this.binders){let r=this.binders[s];(r instanceof tl||r instanceof Va||r instanceof Jl)&&r.populatePaintArray(t,i,n,a,l,o,d)}}setConstantPatternPositions(t){for(let i in this.binders){let n=this.binders[i];n instanceof pd&&n.setConstantPatternPositions(t)}}updatePaintArrays(t,i,n,a,l,o,d,s){let r=!1,c=Object.keys(t),b=c.length!==0,m=b?c:i.uniqueIds;for(let h in this.binders){let W=this.binders[h];if((W instanceof tl||W instanceof Va||W instanceof Jl)&&(W.expression.isStateDependent===!0||W.expression.isLightConstant===!1)){let p=l.paint.get(h);W.expression=p.value;for(let Z of m){let g=t[Z.toString()];i.eachPosition(Z,(u,G,F)=>{let R=a.feature(u);W.updatePaintArray(G,F,R,g,o,d,s)})}if(!b)for(let Z of n.uniqueIds){let g=t[Z.toString()];n.eachPosition(Z,(u,G,F)=>{let R=a.feature(u);W.updatePaintArray(G,F,R,g,o,d,s)})}r=!0}}return r}defines(){let t=[];for(let i in this.binders){let n=this.binders[i];(n instanceof Bs||n instanceof pd)&&t.push(...n.uniformNames.map(a=>"#define HAS_UNIFORM_".concat(a)))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let n=this.binders[i];if(n instanceof tl||n instanceof Va||n instanceof Jl)for(let a=0;a<n.paintVertexAttributes.length;a++)t.push(n.paintVertexAttributes[a].name)}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let n=this.binders[i];if(n instanceof Bs||n instanceof pd||n instanceof Va)for(let a of n.uniformNames)t.push(a)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){let i=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof Bs||a instanceof pd||a instanceof Va)for(let l of a.uniformNames)i.push({name:l,property:n,binding:a.getBinding(t,l)})}return i}setUniforms(t,i,n,a,l){for(let{name:o,property:d,binding:s}of n)this.binders[d].setUniform(t,s,l,a.get(d),o)}updatePaintBuffers(){this._buffers=[];for(let t in this.binders){let i=this.binders[t];(i instanceof tl||i instanceof Va||i instanceof Jl)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(let i in this.binders){let n=this.binders[i];(n instanceof tl||n instanceof Va||n instanceof Jl)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof tl||i instanceof Va||i instanceof Jl)&&i.destroy()}}}class yl{constructor(t,i,n=()=>!0){this.programConfigurations={};for(let a of t)this.programConfigurations[a.id]=new uo(a,i,n);this.needsUpload=!1,this._featureMap=new ys,this._featureMapWithoutIds=new ys,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,n,a,l,o,d,s){for(let r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,i,a,l,o,d,s);i.id!==void 0?this._featureMap.add(i.id,n,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,n,a,l,o){for(let d of n)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,d,a,l,o||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let Ex={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ax(e,t){return Ex[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}let wx={"line-pattern":{source:Yl,composite:Yl},"fill-pattern":{source:Yl,composite:Yl},"fill-extrusion-pattern":{source:Yl,composite:Yl},"line-dasharray":{source:mc,composite:mc}},jx={color:{source:Js,composite:qa},number:{source:Ys,composite:Js}};function OZ(e,t,i){let n=wx[e];return n&&n[i]||jx[t][i]}kt(Bs,"ConstantBinder"),kt(pd,"PatternConstantBinder"),kt(tl,"SourceExpressionBinder"),kt(Jl,"PatternCompositeBinder"),kt(Va,"CompositeExpressionBinder"),kt(uo,"ProgramConfiguration",{omit:["_buffers"]}),kt(yl,"ProgramConfigurationSet");class Tn{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof qt?new qt(t.lng,t.lat):qt.convert(t),this}setSouthWest(t){return this._sw=t instanceof qt?new qt(t.lng,t.lat):qt.convert(t),this}extend(t){let i=this._sw,n=this._ne,a,l;if(t instanceof qt)a=t,l=t;else{if(!(t instanceof Tn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Tn.convert(t)):this.extend(qt.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(qt.convert(t)):this;if(a=t._sw,l=t._ne,!a||!l)return this}return i||n?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),n.lng=Math.max(l.lng,n.lng),n.lat=Math.max(l.lat,n.lat)):(this._sw=new qt(a.lng,a.lat),this._ne=new qt(l.lng,l.lat)),this}getCenter(){return new qt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qt(this.getWest(),this.getNorth())}getSouthEast(){return new qt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:i,lat:n}=qt.convert(t),a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(t){return!t||t instanceof Tn?t:new Tn(t)}}var Hi={},Oi={};Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.setMatrixArrayType=function(e){Oi.ARRAY_TYPE=_Z=e},Oi.toRadian=function(e){return e*Ox},Oi.equals=function(e,t){return Math.abs(e-t)<=DZ*Math.max(1,Math.abs(e),Math.abs(t))},Oi.RANDOM=Oi.ARRAY_TYPE=Oi.EPSILON=void 0;var DZ=1e-6;Oi.EPSILON=DZ;var _Z=typeof Float32Array<"u"?Float32Array:Array;Oi.ARRAY_TYPE=_Z;var Hx=Math.random;Oi.RANDOM=Hx;var Ox=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ci={};function ah(e){return ah=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ah(e)}Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=function(){var e=new Bl.ARRAY_TYPE(4);return Bl.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},ci.clone=function(e){var t=new Bl.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ci.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ci.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},ci.fromValues=function(e,t,i,n){var a=new Bl.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a},ci.set=function(e,t,i,n,a){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e},ci.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},ci.invert=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=i*l-a*n;return o?(e[0]=l*(o=1/o),e[1]=-n*o,e[2]=-a*o,e[3]=i*o,e):null},ci.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},ci.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},ci.multiply=PZ,ci.rotate=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=Math.sin(i),s=Math.cos(i);return e[0]=n*s+l*d,e[1]=a*s+o*d,e[2]=n*-d+l*s,e[3]=a*-d+o*s,e},ci.scale=function(e,t,i){var n=t[1],a=t[2],l=t[3],o=i[0],d=i[1];return e[0]=t[0]*o,e[1]=n*o,e[2]=a*d,e[3]=l*d,e},ci.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e},ci.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},ci.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ci.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},ci.LDU=function(e,t,i,n){return e[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-e[2]*i[1],[e,t,i]},ci.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},ci.subtract=qZ,ci.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},ci.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=e[3],o=t[0],d=t[1],s=t[2],r=t[3];return Math.abs(i-o)<=Bl.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-d)<=Bl.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-s)<=Bl.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(l-r)<=Bl.EPSILON*Math.max(1,Math.abs(l),Math.abs(r))},ci.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},ci.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},ci.sub=ci.mul=void 0;var Bl=function(e,t){if(e&&e.__esModule)return e;if(e===null||ah(e)!=="object"&&typeof e!="function")return{default:e};var i=KZ(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function KZ(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(KZ=function(n){return n?i:t})(e)}function PZ(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=i[0],s=i[1],r=i[2],c=i[3];return e[0]=n*d+l*s,e[1]=a*d+o*s,e[2]=n*r+l*c,e[3]=a*r+o*c,e}function qZ(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}ci.mul=PZ,ci.sub=qZ;var hi={};function lh(e){return lh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lh(e)}Object.defineProperty(hi,"__esModule",{value:!0}),hi.create=function(){var e=new Ma.ARRAY_TYPE(6);return Ma.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},hi.clone=function(e){var t=new Ma.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},hi.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},hi.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},hi.fromValues=function(e,t,i,n,a,l){var o=new Ma.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=n,o[4]=a,o[5]=l,o},hi.set=function(e,t,i,n,a,l,o){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e[4]=l,e[5]=o,e},hi.invert=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=i*l-n*a;return s?(e[0]=l*(s=1/s),e[1]=-n*s,e[2]=-a*s,e[3]=i*s,e[4]=(a*d-l*o)*s,e[5]=(n*o-i*d)*s,e):null},hi.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},hi.multiply=tV,hi.rotate=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=Math.sin(i),c=Math.cos(i);return e[0]=n*c+l*r,e[1]=a*c+o*r,e[2]=n*-r+l*c,e[3]=a*-r+o*c,e[4]=d,e[5]=s,e},hi.scale=function(e,t,i){var n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=i[0],r=i[1];return e[0]=t[0]*s,e[1]=n*s,e[2]=a*r,e[3]=l*r,e[4]=o,e[5]=d,e},hi.translate=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=i[0],c=i[1];return e[0]=n,e[1]=a,e[2]=l,e[3]=o,e[4]=n*r+l*c+d,e[5]=a*r+o*c+s,e},hi.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e[4]=0,e[5]=0,e},hi.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},hi.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},hi.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},hi.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},hi.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},hi.subtract=eV,hi.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},hi.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e},hi.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},hi.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=e[3],o=e[4],d=e[5],s=t[0],r=t[1],c=t[2],b=t[3],m=t[4],h=t[5];return Math.abs(i-s)<=Ma.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-r)<=Ma.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(a-c)<=Ma.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(l-b)<=Ma.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(o-m)<=Ma.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(d-h)<=Ma.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))},hi.sub=hi.mul=void 0;var Ma=function(e,t){if(e&&e.__esModule)return e;if(e===null||lh(e)!=="object"&&typeof e!="function")return{default:e};var i=$Z(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function $Z(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return($Z=function(n){return n?i:t})(e)}function tV(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=i[0],c=i[1],b=i[2],m=i[3],h=i[4],W=i[5];return e[0]=n*r+l*c,e[1]=a*r+o*c,e[2]=n*b+l*m,e[3]=a*b+o*m,e[4]=n*h+l*W+d,e[5]=a*h+o*W+s,e}function eV(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}hi.mul=tV,hi.sub=eV;var _e={};function oh(e){return oh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oh(e)}Object.defineProperty(_e,"__esModule",{value:!0}),_e.create=function(){var e=new An.ARRAY_TYPE(9);return An.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},_e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},_e.clone=function(e){var t=new An.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},_e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},_e.fromValues=function(e,t,i,n,a,l,o,d,s){var r=new An.ARRAY_TYPE(9);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=a,r[5]=l,r[6]=o,r[7]=d,r[8]=s,r},_e.set=function(e,t,i,n,a,l,o,d,s,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e[4]=l,e[5]=o,e[6]=d,e[7]=s,e[8]=r,e},_e.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},_e.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},_e.invert=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=t[6],r=t[7],c=t[8],b=c*o-d*r,m=-c*l+d*s,h=r*l-o*s,W=i*b+n*m+a*h;return W?(e[0]=b*(W=1/W),e[1]=(-c*n+a*r)*W,e[2]=(d*n-a*o)*W,e[3]=m*W,e[4]=(c*i-a*s)*W,e[5]=(-d*i+a*l)*W,e[6]=h*W,e[7]=(-r*i+n*s)*W,e[8]=(o*i-n*l)*W,e):null},_e.adjoint=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=t[6],r=t[7],c=t[8];return e[0]=o*c-d*r,e[1]=a*r-n*c,e[2]=n*d-a*o,e[3]=d*s-l*c,e[4]=i*c-a*s,e[5]=a*l-i*d,e[6]=l*r-o*s,e[7]=n*s-i*r,e[8]=i*o-n*l,e},_e.determinant=function(e){var t=e[3],i=e[4],n=e[5],a=e[6],l=e[7],o=e[8];return e[0]*(o*i-n*l)+e[1]*(-o*t+n*a)+e[2]*(l*t-i*a)},_e.multiply=nV,_e.translate=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=t[8],m=i[0],h=i[1];return e[0]=n,e[1]=a,e[2]=l,e[3]=o,e[4]=d,e[5]=s,e[6]=m*n+h*o+r,e[7]=m*a+h*d+c,e[8]=m*l+h*s+b,e},_e.rotate=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=t[8],m=Math.sin(i),h=Math.cos(i);return e[0]=h*n+m*o,e[1]=h*a+m*d,e[2]=h*l+m*s,e[3]=h*o-m*n,e[4]=h*d-m*a,e[5]=h*s-m*l,e[6]=r,e[7]=c,e[8]=b,e},_e.scale=function(e,t,i){var n=i[0],a=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},_e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},_e.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},_e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},_e.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},_e.fromQuat=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=i+i,d=n+n,s=a+a,r=i*o,c=n*o,b=n*d,m=a*o,h=a*d,W=a*s,p=l*o,Z=l*d,g=l*s;return e[0]=1-b-W,e[3]=c-g,e[6]=m+Z,e[1]=c+g,e[4]=1-r-W,e[7]=h-p,e[2]=m-Z,e[5]=h+p,e[8]=1-r-b,e},_e.normalFromMat4=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=t[6],r=t[7],c=t[8],b=t[9],m=t[10],h=t[11],W=t[12],p=t[13],Z=t[14],g=t[15],u=i*d-n*o,G=i*s-a*o,F=i*r-l*o,R=n*s-a*d,I=n*r-l*d,N=a*r-l*s,Y=c*p-b*W,X=c*Z-m*W,J=c*g-h*W,B=b*Z-m*p,C=b*g-h*p,Q=m*g-h*Z,y=u*Q-G*C+F*B+R*J-I*X+N*Y;return y?(e[0]=(d*Q-s*C+r*B)*(y=1/y),e[1]=(s*J-o*Q-r*X)*y,e[2]=(o*C-d*J+r*Y)*y,e[3]=(a*C-n*Q-l*B)*y,e[4]=(i*Q-a*J+l*X)*y,e[5]=(n*J-i*C-l*Y)*y,e[6]=(p*N-Z*I+g*R)*y,e[7]=(Z*F-W*N-g*G)*y,e[8]=(W*I-p*F+g*u)*y,e):null},_e.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},_e.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},_e.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},_e.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},_e.subtract=aV,_e.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},_e.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e[6]=t[6]+i[6]*n,e[7]=t[7]+i[7]*n,e[8]=t[8]+i[8]*n,e},_e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},_e.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=e[3],o=e[4],d=e[5],s=e[6],r=e[7],c=e[8],b=t[0],m=t[1],h=t[2],W=t[3],p=t[4],Z=t[5],g=t[6],u=t[7],G=t[8];return Math.abs(i-b)<=An.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-m)<=An.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-h)<=An.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(l-W)<=An.EPSILON*Math.max(1,Math.abs(l),Math.abs(W))&&Math.abs(o-p)<=An.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(d-Z)<=An.EPSILON*Math.max(1,Math.abs(d),Math.abs(Z))&&Math.abs(s-g)<=An.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(r-u)<=An.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(c-G)<=An.EPSILON*Math.max(1,Math.abs(c),Math.abs(G))},_e.sub=_e.mul=void 0;var An=function(e,t){if(e&&e.__esModule)return e;if(e===null||oh(e)!=="object"&&typeof e!="function")return{default:e};var i=iV(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function iV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(iV=function(n){return n?i:t})(e)}function nV(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=t[8],m=i[0],h=i[1],W=i[2],p=i[3],Z=i[4],g=i[5],u=i[6],G=i[7],F=i[8];return e[0]=m*n+h*o+W*r,e[1]=m*a+h*d+W*c,e[2]=m*l+h*s+W*b,e[3]=p*n+Z*o+g*r,e[4]=p*a+Z*d+g*c,e[5]=p*l+Z*s+g*b,e[6]=u*n+G*o+F*r,e[7]=u*a+G*d+F*c,e[8]=u*l+G*s+F*b,e}function aV(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}_e.mul=nV,_e.sub=aV;var oe={};function dh(e){return dh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dh(e)}Object.defineProperty(oe,"__esModule",{value:!0}),oe.create=function(){var e=new gi.ARRAY_TYPE(16);return gi.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},oe.clone=function(e){var t=new gi.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},oe.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},oe.fromValues=function(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p){var Z=new gi.ARRAY_TYPE(16);return Z[0]=e,Z[1]=t,Z[2]=i,Z[3]=n,Z[4]=a,Z[5]=l,Z[6]=o,Z[7]=d,Z[8]=s,Z[9]=r,Z[10]=c,Z[11]=b,Z[12]=m,Z[13]=h,Z[14]=W,Z[15]=p,Z},oe.set=function(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e[4]=l,e[5]=o,e[6]=d,e[7]=s,e[8]=r,e[9]=c,e[10]=b,e[11]=m,e[12]=h,e[13]=W,e[14]=p,e[15]=Z,e},oe.identity=oV,oe.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],a=t[3],l=t[6],o=t[7],d=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=l,e[11]=t[14],e[12]=a,e[13]=o,e[14]=d}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},oe.invert=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=t[6],r=t[7],c=t[8],b=t[9],m=t[10],h=t[11],W=t[12],p=t[13],Z=t[14],g=t[15],u=i*d-n*o,G=i*s-a*o,F=i*r-l*o,R=n*s-a*d,I=n*r-l*d,N=a*r-l*s,Y=c*p-b*W,X=c*Z-m*W,J=c*g-h*W,B=b*Z-m*p,C=b*g-h*p,Q=m*g-h*Z,y=u*Q-G*C+F*B+R*J-I*X+N*Y;return y?(e[0]=(d*Q-s*C+r*B)*(y=1/y),e[1]=(a*C-n*Q-l*B)*y,e[2]=(p*N-Z*I+g*R)*y,e[3]=(m*I-b*N-h*R)*y,e[4]=(s*J-o*Q-r*X)*y,e[5]=(i*Q-a*J+l*X)*y,e[6]=(Z*F-W*N-g*G)*y,e[7]=(c*N-m*F+h*G)*y,e[8]=(o*C-d*J+r*Y)*y,e[9]=(n*J-i*C-l*Y)*y,e[10]=(W*I-p*F+g*u)*y,e[11]=(b*F-c*I-h*u)*y,e[12]=(d*X-o*B-s*Y)*y,e[13]=(i*B-n*X+a*Y)*y,e[14]=(p*G-W*R-Z*u)*y,e[15]=(c*R-b*G+m*u)*y,e):null},oe.adjoint=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=t[4],d=t[5],s=t[6],r=t[7],c=t[8],b=t[9],m=t[10],h=t[11],W=t[12],p=t[13],Z=t[14],g=t[15];return e[0]=d*(m*g-h*Z)-b*(s*g-r*Z)+p*(s*h-r*m),e[1]=-(n*(m*g-h*Z)-b*(a*g-l*Z)+p*(a*h-l*m)),e[2]=n*(s*g-r*Z)-d*(a*g-l*Z)+p*(a*r-l*s),e[3]=-(n*(s*h-r*m)-d*(a*h-l*m)+b*(a*r-l*s)),e[4]=-(o*(m*g-h*Z)-c*(s*g-r*Z)+W*(s*h-r*m)),e[5]=i*(m*g-h*Z)-c*(a*g-l*Z)+W*(a*h-l*m),e[6]=-(i*(s*g-r*Z)-o*(a*g-l*Z)+W*(a*r-l*s)),e[7]=i*(s*h-r*m)-o*(a*h-l*m)+c*(a*r-l*s),e[8]=o*(b*g-h*p)-c*(d*g-r*p)+W*(d*h-r*b),e[9]=-(i*(b*g-h*p)-c*(n*g-l*p)+W*(n*h-l*b)),e[10]=i*(d*g-r*p)-o*(n*g-l*p)+W*(n*r-l*d),e[11]=-(i*(d*h-r*b)-o*(n*h-l*b)+c*(n*r-l*d)),e[12]=-(o*(b*Z-m*p)-c*(d*Z-s*p)+W*(d*m-s*b)),e[13]=i*(b*Z-m*p)-c*(n*Z-a*p)+W*(n*m-a*b),e[14]=-(i*(d*Z-s*p)-o*(n*Z-a*p)+W*(n*s-a*d)),e[15]=i*(d*m-s*b)-o*(n*m-a*b)+c*(n*s-a*d),e},oe.determinant=function(e){var t=e[0],i=e[1],n=e[2],a=e[3],l=e[4],o=e[5],d=e[6],s=e[7],r=e[8],c=e[9],b=e[10],m=e[11],h=e[12],W=e[13],p=e[14],Z=e[15];return(t*o-i*l)*(b*Z-m*p)-(t*d-n*l)*(c*Z-m*W)+(t*s-a*l)*(c*p-b*W)+(i*d-n*o)*(r*Z-m*h)-(i*s-a*o)*(r*p-b*h)+(n*s-a*d)*(r*W-c*h)},oe.multiply=dV,oe.translate=function(e,t,i){var n,a,l,o,d,s,r,c,b,m,h,W,p=i[0],Z=i[1],g=i[2];return t===e?(e[12]=t[0]*p+t[4]*Z+t[8]*g+t[12],e[13]=t[1]*p+t[5]*Z+t[9]*g+t[13],e[14]=t[2]*p+t[6]*Z+t[10]*g+t[14],e[15]=t[3]*p+t[7]*Z+t[11]*g+t[15]):(a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=t[8],m=t[9],h=t[10],W=t[11],e[0]=n=t[0],e[1]=a,e[2]=l,e[3]=o,e[4]=d,e[5]=s,e[6]=r,e[7]=c,e[8]=b,e[9]=m,e[10]=h,e[11]=W,e[12]=n*p+d*Z+b*g+t[12],e[13]=a*p+s*Z+m*g+t[13],e[14]=l*p+r*Z+h*g+t[14],e[15]=o*p+c*Z+W*g+t[15]),e},oe.scale=function(e,t,i){var n=i[0],a=i[1],l=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*l,e[9]=t[9]*l,e[10]=t[10]*l,e[11]=t[11]*l,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},oe.rotate=function(e,t,i,n){var a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R,I,N,Y,X,J,B,C=n[0],Q=n[1],y=n[2],z=Math.hypot(C,Q,y);return z<gi.EPSILON?null:(C*=z=1/z,Q*=z,y*=z,a=Math.sin(i),l=Math.cos(i),s=t[1],r=t[2],c=t[3],m=t[5],h=t[6],W=t[7],Z=t[9],g=t[10],u=t[11],I=C*Q*(o=1-l)-y*a,N=Q*Q*o+l,Y=y*Q*o+C*a,X=C*y*o+Q*a,J=Q*y*o-C*a,B=y*y*o+l,e[0]=(d=t[0])*(G=C*C*o+l)+(b=t[4])*(F=Q*C*o+y*a)+(p=t[8])*(R=y*C*o-Q*a),e[1]=s*G+m*F+Z*R,e[2]=r*G+h*F+g*R,e[3]=c*G+W*F+u*R,e[4]=d*I+b*N+p*Y,e[5]=s*I+m*N+Z*Y,e[6]=r*I+h*N+g*Y,e[7]=c*I+W*N+u*Y,e[8]=d*X+b*J+p*B,e[9]=s*X+m*J+Z*B,e[10]=r*X+h*J+g*B,e[11]=c*X+W*J+u*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},oe.rotateX=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),l=t[4],o=t[5],d=t[6],s=t[7],r=t[8],c=t[9],b=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=l*a+r*n,e[5]=o*a+c*n,e[6]=d*a+b*n,e[7]=s*a+m*n,e[8]=r*a-l*n,e[9]=c*a-o*n,e[10]=b*a-d*n,e[11]=m*a-s*n,e},oe.rotateY=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),l=t[0],o=t[1],d=t[2],s=t[3],r=t[8],c=t[9],b=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*a-r*n,e[1]=o*a-c*n,e[2]=d*a-b*n,e[3]=s*a-m*n,e[8]=l*n+r*a,e[9]=o*n+c*a,e[10]=d*n+b*a,e[11]=s*n+m*a,e},oe.rotateZ=function(e,t,i){var n=Math.sin(i),a=Math.cos(i),l=t[0],o=t[1],d=t[2],s=t[3],r=t[4],c=t[5],b=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*a+r*n,e[1]=o*a+c*n,e[2]=d*a+b*n,e[3]=s*a+m*n,e[4]=r*a-l*n,e[5]=c*a-o*n,e[6]=b*a-d*n,e[7]=m*a-s*n,e},oe.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},oe.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},oe.fromRotation=function(e,t,i){var n,a,l,o=i[0],d=i[1],s=i[2],r=Math.hypot(o,d,s);return r<gi.EPSILON?null:(o*=r=1/r,d*=r,s*=r,n=Math.sin(t),a=Math.cos(t),e[0]=o*o*(l=1-a)+a,e[1]=d*o*l+s*n,e[2]=s*o*l-d*n,e[3]=0,e[4]=o*d*l-s*n,e[5]=d*d*l+a,e[6]=s*d*l+o*n,e[7]=0,e[8]=o*s*l+d*n,e[9]=d*s*l-o*n,e[10]=s*s*l+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},oe.fromXRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},oe.fromYRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},oe.fromZRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},oe.fromRotationTranslation=sV,oe.fromQuat2=function(e,t){var i=new gi.ARRAY_TYPE(3),n=-t[0],a=-t[1],l=-t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=n*n+a*a+l*l+o*o;return b>0?(i[0]=2*(d*o+c*n+s*l-r*a)/b,i[1]=2*(s*o+c*a+r*n-d*l)/b,i[2]=2*(r*o+c*l+d*a-s*n)/b):(i[0]=2*(d*o+c*n+s*l-r*a),i[1]=2*(s*o+c*a+r*n-d*l),i[2]=2*(r*o+c*l+d*a-s*n)),sV(e,t,i),e},oe.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},oe.getScaling=rV,oe.getRotation=function(e,t){var i=new gi.ARRAY_TYPE(3);rV(i,t);var n=1/i[0],a=1/i[1],l=1/i[2],o=t[0]*n,d=t[1]*a,s=t[2]*l,r=t[4]*n,c=t[5]*a,b=t[6]*l,m=t[8]*n,h=t[9]*a,W=t[10]*l,p=o+c+W,Z=0;return p>0?(Z=2*Math.sqrt(p+1),e[3]=.25*Z,e[0]=(b-h)/Z,e[1]=(m-s)/Z,e[2]=(d-r)/Z):o>c&&o>W?(Z=2*Math.sqrt(1+o-c-W),e[3]=(b-h)/Z,e[0]=.25*Z,e[1]=(d+r)/Z,e[2]=(m+s)/Z):c>W?(Z=2*Math.sqrt(1+c-o-W),e[3]=(m-s)/Z,e[0]=(d+r)/Z,e[1]=.25*Z,e[2]=(b+h)/Z):(Z=2*Math.sqrt(1+W-o-c),e[3]=(d-r)/Z,e[0]=(m+s)/Z,e[1]=(b+h)/Z,e[2]=.25*Z),e},oe.fromRotationTranslationScale=function(e,t,i,n){var a=t[0],l=t[1],o=t[2],d=t[3],s=a+a,r=l+l,c=o+o,b=a*s,m=a*r,h=a*c,W=l*r,p=l*c,Z=o*c,g=d*s,u=d*r,G=d*c,F=n[0],R=n[1],I=n[2];return e[0]=(1-(W+Z))*F,e[1]=(m+G)*F,e[2]=(h-u)*F,e[3]=0,e[4]=(m-G)*R,e[5]=(1-(b+Z))*R,e[6]=(p+g)*R,e[7]=0,e[8]=(h+u)*I,e[9]=(p-g)*I,e[10]=(1-(b+W))*I,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},oe.fromRotationTranslationScaleOrigin=function(e,t,i,n,a){var l=t[0],o=t[1],d=t[2],s=t[3],r=l+l,c=o+o,b=d+d,m=l*r,h=l*c,W=l*b,p=o*c,Z=o*b,g=d*b,u=s*r,G=s*c,F=s*b,R=n[0],I=n[1],N=n[2],Y=a[0],X=a[1],J=a[2],B=(1-(p+g))*R,C=(h+F)*R,Q=(W-G)*R,y=(h-F)*I,z=(1-(m+g))*I,E=(Z+u)*I,O=(W+G)*N,f=(Z-u)*N,L=(1-(m+p))*N;return e[0]=B,e[1]=C,e[2]=Q,e[3]=0,e[4]=y,e[5]=z,e[6]=E,e[7]=0,e[8]=O,e[9]=f,e[10]=L,e[11]=0,e[12]=i[0]+Y-(B*Y+y*X+O*J),e[13]=i[1]+X-(C*Y+z*X+f*J),e[14]=i[2]+J-(Q*Y+E*X+L*J),e[15]=1,e},oe.fromQuat=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=i+i,d=n+n,s=a+a,r=i*o,c=n*o,b=n*d,m=a*o,h=a*d,W=a*s,p=l*o,Z=l*d,g=l*s;return e[0]=1-b-W,e[1]=c+g,e[2]=m-Z,e[3]=0,e[4]=c-g,e[5]=1-r-W,e[6]=h+p,e[7]=0,e[8]=m+Z,e[9]=h-p,e[10]=1-r-b,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},oe.frustum=function(e,t,i,n,a,l,o){var d=1/(i-t),s=1/(a-n),r=1/(l-o);return e[0]=2*l*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*l*s,e[6]=0,e[7]=0,e[8]=(i+t)*d,e[9]=(a+n)*s,e[10]=(o+l)*r,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*l*2*r,e[15]=0,e},oe.perspectiveNO=cV,oe.perspectiveZO=function(e,t,i,n,a){var l,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(e[10]=a*(l=1/(n-a)),e[14]=a*n*l):(e[10]=-1,e[14]=-n),e},oe.perspectiveFromFieldOfView=function(e,t,i,n){var a=Math.tan(t.upDegrees*Math.PI/180),l=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),d=Math.tan(t.rightDegrees*Math.PI/180),s=2/(o+d),r=2/(a+l);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=-(o-d)*s*.5,e[9]=(a-l)*r*.5,e[10]=n/(i-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*i/(i-n),e[15]=0,e},oe.orthoNO=bV,oe.orthoZO=function(e,t,i,n,a,l,o){var d=1/(t-i),s=1/(n-a),r=1/(l-o);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r,e[11]=0,e[12]=(t+i)*d,e[13]=(a+n)*s,e[14]=l*r,e[15]=1,e},oe.lookAt=function(e,t,i,n){var a,l,o,d,s,r,c,b,m,h,W=t[0],p=t[1],Z=t[2],g=n[0],u=n[1],G=n[2],F=i[0],R=i[1],I=i[2];return Math.abs(W-F)<gi.EPSILON&&Math.abs(p-R)<gi.EPSILON&&Math.abs(Z-I)<gi.EPSILON?oV(e):(c=W-F,b=p-R,m=Z-I,a=u*(m*=h=1/Math.hypot(c,b,m))-G*(b*=h),l=G*(c*=h)-g*m,o=g*b-u*c,(h=Math.hypot(a,l,o))?(a*=h=1/h,l*=h,o*=h):(a=0,l=0,o=0),d=b*o-m*l,s=m*a-c*o,r=c*l-b*a,(h=Math.hypot(d,s,r))?(d*=h=1/h,s*=h,r*=h):(d=0,s=0,r=0),e[0]=a,e[1]=d,e[2]=c,e[3]=0,e[4]=l,e[5]=s,e[6]=b,e[7]=0,e[8]=o,e[9]=r,e[10]=m,e[11]=0,e[12]=-(a*W+l*p+o*Z),e[13]=-(d*W+s*p+r*Z),e[14]=-(c*W+b*p+m*Z),e[15]=1,e)},oe.targetTo=function(e,t,i,n){var a=t[0],l=t[1],o=t[2],d=n[0],s=n[1],r=n[2],c=a-i[0],b=l-i[1],m=o-i[2],h=c*c+b*b+m*m;h>0&&(c*=h=1/Math.sqrt(h),b*=h,m*=h);var W=s*m-r*b,p=r*c-d*m,Z=d*b-s*c;return(h=W*W+p*p+Z*Z)>0&&(W*=h=1/Math.sqrt(h),p*=h,Z*=h),e[0]=W,e[1]=p,e[2]=Z,e[3]=0,e[4]=b*Z-m*p,e[5]=m*W-c*Z,e[6]=c*p-b*W,e[7]=0,e[8]=c,e[9]=b,e[10]=m,e[11]=0,e[12]=a,e[13]=l,e[14]=o,e[15]=1,e},oe.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},oe.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},oe.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},oe.subtract=mV,oe.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},oe.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e[6]=t[6]+i[6]*n,e[7]=t[7]+i[7]*n,e[8]=t[8]+i[8]*n,e[9]=t[9]+i[9]*n,e[10]=t[10]+i[10]*n,e[11]=t[11]+i[11]*n,e[12]=t[12]+i[12]*n,e[13]=t[13]+i[13]*n,e[14]=t[14]+i[14]*n,e[15]=t[15]+i[15]*n,e},oe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},oe.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=e[3],o=e[4],d=e[5],s=e[6],r=e[7],c=e[8],b=e[9],m=e[10],h=e[11],W=e[12],p=e[13],Z=e[14],g=e[15],u=t[0],G=t[1],F=t[2],R=t[3],I=t[4],N=t[5],Y=t[6],X=t[7],J=t[8],B=t[9],C=t[10],Q=t[11],y=t[12],z=t[13],E=t[14],O=t[15];return Math.abs(i-u)<=gi.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-G)<=gi.EPSILON*Math.max(1,Math.abs(n),Math.abs(G))&&Math.abs(a-F)<=gi.EPSILON*Math.max(1,Math.abs(a),Math.abs(F))&&Math.abs(l-R)<=gi.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(o-I)<=gi.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(d-N)<=gi.EPSILON*Math.max(1,Math.abs(d),Math.abs(N))&&Math.abs(s-Y)<=gi.EPSILON*Math.max(1,Math.abs(s),Math.abs(Y))&&Math.abs(r-X)<=gi.EPSILON*Math.max(1,Math.abs(r),Math.abs(X))&&Math.abs(c-J)<=gi.EPSILON*Math.max(1,Math.abs(c),Math.abs(J))&&Math.abs(b-B)<=gi.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(m-C)<=gi.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(h-Q)<=gi.EPSILON*Math.max(1,Math.abs(h),Math.abs(Q))&&Math.abs(W-y)<=gi.EPSILON*Math.max(1,Math.abs(W),Math.abs(y))&&Math.abs(p-z)<=gi.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(Z-E)<=gi.EPSILON*Math.max(1,Math.abs(Z),Math.abs(E))&&Math.abs(g-O)<=gi.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))},oe.sub=oe.mul=oe.ortho=oe.perspective=void 0;var gi=function(e,t){if(e&&e.__esModule)return e;if(e===null||dh(e)!=="object"&&typeof e!="function")return{default:e};var i=lV(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function lV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(lV=function(n){return n?i:t})(e)}function oV(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dV(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=t[8],m=t[9],h=t[10],W=t[11],p=t[12],Z=t[13],g=t[14],u=t[15],G=i[0],F=i[1],R=i[2],I=i[3];return e[0]=G*n+F*d+R*b+I*p,e[1]=G*a+F*s+R*m+I*Z,e[2]=G*l+F*r+R*h+I*g,e[3]=G*o+F*c+R*W+I*u,e[4]=(G=i[4])*n+(F=i[5])*d+(R=i[6])*b+(I=i[7])*p,e[5]=G*a+F*s+R*m+I*Z,e[6]=G*l+F*r+R*h+I*g,e[7]=G*o+F*c+R*W+I*u,e[8]=(G=i[8])*n+(F=i[9])*d+(R=i[10])*b+(I=i[11])*p,e[9]=G*a+F*s+R*m+I*Z,e[10]=G*l+F*r+R*h+I*g,e[11]=G*o+F*c+R*W+I*u,e[12]=(G=i[12])*n+(F=i[13])*d+(R=i[14])*b+(I=i[15])*p,e[13]=G*a+F*s+R*m+I*Z,e[14]=G*l+F*r+R*h+I*g,e[15]=G*o+F*c+R*W+I*u,e}function sV(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=n+n,s=a+a,r=l+l,c=n*d,b=n*s,m=n*r,h=a*s,W=a*r,p=l*r,Z=o*d,g=o*s,u=o*r;return e[0]=1-(h+p),e[1]=b+u,e[2]=m-g,e[3]=0,e[4]=b-u,e[5]=1-(c+p),e[6]=W+Z,e[7]=0,e[8]=m+g,e[9]=W-Z,e[10]=1-(c+h),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function rV(e,t){var i=t[4],n=t[5],a=t[6],l=t[8],o=t[9],d=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,n,a),e[2]=Math.hypot(l,o,d),e}function cV(e,t,i,n,a){var l,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(e[10]=(a+n)*(l=1/(n-a)),e[14]=2*a*n*l):(e[10]=-1,e[14]=-2*n),e}function bV(e,t,i,n,a,l,o){var d=1/(t-i),s=1/(n-a),r=1/(l-o);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*r,e[11]=0,e[12]=(t+i)*d,e[13]=(a+n)*s,e[14]=(o+l)*r,e[15]=1,e}function mV(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}oe.perspective=cV,oe.ortho=bV,oe.mul=dV,oe.sub=mV;var ne={},le={};function sh(e){return sh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sh(e)}Object.defineProperty(le,"__esModule",{value:!0}),le.create=WV,le.clone=function(e){var t=new el.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},le.length=pV,le.fromValues=function(e,t,i){var n=new el.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=i,n},le.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},le.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},le.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},le.subtract=ZV,le.multiply=VV,le.divide=gV,le.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},le.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},le.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},le.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},le.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},le.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},le.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e},le.distance=uV,le.squaredDistance=RV,le.squaredLength=GV,le.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},le.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},le.normalize=function(e,t){var i=t[0],n=t[1],a=t[2],l=i*i+n*n+a*a;return l>0&&(l=1/Math.sqrt(l)),e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e},le.dot=FV,le.cross=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=i[0],d=i[1],s=i[2];return e[0]=a*s-l*d,e[1]=l*o-n*s,e[2]=n*d-a*o,e},le.lerp=function(e,t,i,n){var a=t[0],l=t[1],o=t[2];return e[0]=a+n*(i[0]-a),e[1]=l+n*(i[1]-l),e[2]=o+n*(i[2]-o),e},le.hermite=function(e,t,i,n,a,l){var o=l*l,d=o*(2*l-3)+1,s=o*(l-2)+l,r=o*(l-1),c=o*(3-2*l);return e[0]=t[0]*d+i[0]*s+n[0]*r+a[0]*c,e[1]=t[1]*d+i[1]*s+n[1]*r+a[1]*c,e[2]=t[2]*d+i[2]*s+n[2]*r+a[2]*c,e},le.bezier=function(e,t,i,n,a,l){var o=1-l,d=o*o,s=l*l,r=d*o,c=3*l*d,b=3*s*o,m=s*l;return e[0]=t[0]*r+i[0]*c+n[0]*b+a[0]*m,e[1]=t[1]*r+i[1]*c+n[1]*b+a[1]*m,e[2]=t[2]*r+i[2]*c+n[2]*b+a[2]*m,e},le.random=function(e,t){t=t||1;var i=2*el.RANDOM()*Math.PI,n=2*el.RANDOM()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(i)*a,e[1]=Math.sin(i)*a,e[2]=n*t,e},le.transformMat4=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=i[3]*n+i[7]*a+i[11]*l+i[15];return e[0]=(i[0]*n+i[4]*a+i[8]*l+i[12])/(o=o||1),e[1]=(i[1]*n+i[5]*a+i[9]*l+i[13])/o,e[2]=(i[2]*n+i[6]*a+i[10]*l+i[14])/o,e},le.transformMat3=function(e,t,i){var n=t[0],a=t[1],l=t[2];return e[0]=n*i[0]+a*i[3]+l*i[6],e[1]=n*i[1]+a*i[4]+l*i[7],e[2]=n*i[2]+a*i[5]+l*i[8],e},le.transformQuat=function(e,t,i){var n=i[0],a=i[1],l=i[2],o=t[0],d=t[1],s=t[2],r=a*s-l*d,c=l*o-n*s,b=n*d-a*o,m=a*b-l*c,h=l*r-n*b,W=n*c-a*r,p=2*i[3];return c*=p,b*=p,h*=2,W*=2,e[0]=o+(r*=p)+(m*=2),e[1]=d+c+h,e[2]=s+b+W,e},le.rotateX=function(e,t,i,n){var a=[],l=[];return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],l[0]=a[0],l[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),l[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),e[0]=l[0]+i[0],e[1]=l[1]+i[1],e[2]=l[2]+i[2],e},le.rotateY=function(e,t,i,n){var a=[],l=[];return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],l[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),l[1]=a[1],l[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),e[0]=l[0]+i[0],e[1]=l[1]+i[1],e[2]=l[2]+i[2],e},le.rotateZ=function(e,t,i,n){var a=[],l=[];return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],l[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),l[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),l[2]=a[2],e[0]=l[0]+i[0],e[1]=l[1]+i[1],e[2]=l[2]+i[2],e},le.angle=function(e,t){var i=e[0],n=e[1],a=e[2],l=t[0],o=t[1],d=t[2],s=Math.sqrt(i*i+n*n+a*a)*Math.sqrt(l*l+o*o+d*d),r=s&&FV(e,t)/s;return Math.acos(Math.min(Math.max(r,-1),1))},le.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},le.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},le.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},le.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=t[0],o=t[1],d=t[2];return Math.abs(i-l)<=el.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-o)<=el.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-d)<=el.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},le.forEach=le.sqrLen=le.len=le.sqrDist=le.dist=le.div=le.mul=le.sub=void 0;var el=function(e,t){if(e&&e.__esModule)return e;if(e===null||sh(e)!=="object"&&typeof e!="function")return{default:e};var i=hV(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function hV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(hV=function(n){return n?i:t})(e)}function WV(){var e=new el.ARRAY_TYPE(3);return el.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function pV(e){return Math.hypot(e[0],e[1],e[2])}function ZV(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function VV(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function gV(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function uV(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function RV(e,t){var i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return i*i+n*n+a*a}function GV(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n}function FV(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}le.sub=ZV,le.mul=VV,le.div=gV,le.dist=uV,le.sqrDist=RV,le.len=pV,le.sqrLen=GV;var il,Dx=(il=WV(),function(e,t,i,n,a,l){var o,d;for(t||(t=3),i||(i=0),d=n?Math.min(n*t+i,e.length):e.length,o=i;o<d;o+=t)il[0]=e[o],il[1]=e[o+1],il[2]=e[o+2],a(il,il,l),e[o]=il[0],e[o+1]=il[1],e[o+2]=il[2];return e});le.forEach=Dx;var Ve={};function rh(e){return rh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rh(e)}Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.create=UV,Ve.clone=function(e){var t=new ea.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ve.fromValues=function(e,t,i,n){var a=new ea.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a},Ve.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ve.set=function(e,t,i,n,a){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e},Ve.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},Ve.subtract=xV,Ve.multiply=NV,Ve.divide=YV,Ve.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},Ve.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},Ve.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},Ve.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},Ve.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},Ve.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},Ve.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},Ve.distance=XV,Ve.squaredDistance=JV,Ve.length=yV,Ve.squaredLength=BV,Ve.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},Ve.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},Ve.normalize=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=i*i+n*n+a*a+l*l;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=n*o,e[2]=a*o,e[3]=l*o,e},Ve.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},Ve.cross=function(e,t,i,n){var a=i[0]*n[1]-i[1]*n[0],l=i[0]*n[2]-i[2]*n[0],o=i[0]*n[3]-i[3]*n[0],d=i[1]*n[2]-i[2]*n[1],s=i[1]*n[3]-i[3]*n[1],r=i[2]*n[3]-i[3]*n[2],c=t[0],b=t[1],m=t[2],h=t[3];return e[0]=b*r-m*s+h*d,e[1]=-c*r+m*o-h*l,e[2]=c*s-b*o+h*a,e[3]=-c*d+b*l-m*a,e},Ve.lerp=function(e,t,i,n){var a=t[0],l=t[1],o=t[2],d=t[3];return e[0]=a+n*(i[0]-a),e[1]=l+n*(i[1]-l),e[2]=o+n*(i[2]-o),e[3]=d+n*(i[3]-d),e},Ve.random=function(e,t){var i,n,a,l,o,d;t=t||1;do o=(i=2*ea.RANDOM()-1)*i+(n=2*ea.RANDOM()-1)*n;while(o>=1);do d=(a=2*ea.RANDOM()-1)*a+(l=2*ea.RANDOM()-1)*l;while(d>=1);var s=Math.sqrt((1-o)/d);return e[0]=t*i,e[1]=t*n,e[2]=t*a*s,e[3]=t*l*s,e},Ve.transformMat4=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3];return e[0]=i[0]*n+i[4]*a+i[8]*l+i[12]*o,e[1]=i[1]*n+i[5]*a+i[9]*l+i[13]*o,e[2]=i[2]*n+i[6]*a+i[10]*l+i[14]*o,e[3]=i[3]*n+i[7]*a+i[11]*l+i[15]*o,e},Ve.transformQuat=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=i[0],d=i[1],s=i[2],r=i[3],c=r*n+d*l-s*a,b=r*a+s*n-o*l,m=r*l+o*a-d*n,h=-o*n-d*a-s*l;return e[0]=c*r+h*-o+b*-s-m*-d,e[1]=b*r+h*-d+m*-o-c*-s,e[2]=m*r+h*-s+c*-d-b*-o,e[3]=t[3],e},Ve.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},Ve.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Ve.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Ve.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=e[3],o=t[0],d=t[1],s=t[2],r=t[3];return Math.abs(i-o)<=ea.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-d)<=ea.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-s)<=ea.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(l-r)<=ea.EPSILON*Math.max(1,Math.abs(l),Math.abs(r))},Ve.forEach=Ve.sqrLen=Ve.len=Ve.sqrDist=Ve.dist=Ve.div=Ve.mul=Ve.sub=void 0;var ea=function(e,t){if(e&&e.__esModule)return e;if(e===null||rh(e)!=="object"&&typeof e!="function")return{default:e};var i=IV(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function IV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(IV=function(n){return n?i:t})(e)}function UV(){var e=new ea.ARRAY_TYPE(4);return ea.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function xV(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function NV(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function YV(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function XV(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function JV(e,t){var i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],l=t[3]-e[3];return i*i+n*n+a*a+l*l}function yV(e){return Math.hypot(e[0],e[1],e[2],e[3])}function BV(e){var t=e[0],i=e[1],n=e[2],a=e[3];return t*t+i*i+n*n+a*a}Ve.sub=xV,Ve.mul=NV,Ve.div=YV,Ve.dist=XV,Ve.sqrDist=JV,Ve.len=yV,Ve.sqrLen=BV;var _x=function(){var e=UV();return function(t,i,n,a,l,o){var d,s;for(i||(i=4),n||(n=0),s=a?Math.min(a*i+n,t.length):t.length,d=n;d<s;d+=i)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],l(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}();function ch(e){return ch=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ch(e)}Ve.forEach=_x,Object.defineProperty(ne,"__esModule",{value:!0}),ne.create=bh,ne.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},ne.setAxisAngle=CV,ne.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),n=Math.sin(i/2);return n>Ro.EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),i},ne.getAngle=function(e,t){var i=fV(e,t);return Math.acos(2*i*i-1)},ne.multiply=TV,ne.rotateX=function(e,t,i){i*=.5;var n=t[0],a=t[1],l=t[2],o=t[3],d=Math.sin(i),s=Math.cos(i);return e[0]=n*s+o*d,e[1]=a*s+l*d,e[2]=l*s-a*d,e[3]=o*s-n*d,e},ne.rotateY=function(e,t,i){i*=.5;var n=t[0],a=t[1],l=t[2],o=t[3],d=Math.sin(i),s=Math.cos(i);return e[0]=n*s-l*d,e[1]=a*s+o*d,e[2]=l*s+n*d,e[3]=o*s-a*d,e},ne.rotateZ=function(e,t,i){i*=.5;var n=t[0],a=t[1],l=t[2],o=t[3],d=Math.sin(i),s=Math.cos(i);return e[0]=n*s+a*d,e[1]=a*s-n*d,e[2]=l*s+o*d,e[3]=o*s-l*d,e},ne.calculateW=function(e,t){var i=t[0],n=t[1],a=t[2];return e[0]=i,e[1]=n,e[2]=a,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-a*a)),e},ne.exp=kV,ne.ln=SV,ne.pow=function(e,t,i){return SV(e,t),vV(e,e,i),kV(e,e),e},ne.slerp=uc,ne.random=function(e){var t=Ro.RANDOM(),i=Ro.RANDOM(),n=Ro.RANDOM(),a=Math.sqrt(1-t),l=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*i),e[1]=a*Math.cos(2*Math.PI*i),e[2]=l*Math.sin(2*Math.PI*n),e[3]=l*Math.cos(2*Math.PI*n),e},ne.invert=function(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=i*i+n*n+a*a+l*l,d=o?1/o:0;return e[0]=-i*d,e[1]=-n*d,e[2]=-a*d,e[3]=l*d,e},ne.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},ne.fromMat3=QV,ne.fromEuler=function(e,t,i,n){var a=.5*Math.PI/180;t*=a,i*=a,n*=a;var l=Math.sin(t),o=Math.cos(t),d=Math.sin(i),s=Math.cos(i),r=Math.sin(n),c=Math.cos(n);return e[0]=l*s*c-o*d*r,e[1]=o*d*c+l*s*r,e[2]=o*s*r-l*d*c,e[3]=o*s*c+l*d*r,e},ne.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ne.setAxes=ne.sqlerp=ne.rotationTo=ne.equals=ne.exactEquals=ne.normalize=ne.sqrLen=ne.squaredLength=ne.len=ne.length=ne.lerp=ne.dot=ne.scale=ne.mul=ne.add=ne.set=ne.copy=ne.fromValues=ne.clone=void 0;var Ro=gc(Oi),Kx=gc(_e),nl=gc(le),wn=gc(Ve);function MV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(MV=function(n){return n?i:t})(e)}function gc(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ch(e)!=="object"&&typeof e!="function")return{default:e};var i=MV(t);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}function bh(){var e=new Ro.ARRAY_TYPE(4);return Ro.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function CV(e,t,i){i*=.5;var n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function TV(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=i[0],s=i[1],r=i[2],c=i[3];return e[0]=n*c+o*d+a*r-l*s,e[1]=a*c+o*s+l*d-n*r,e[2]=l*c+o*r+n*s-a*d,e[3]=o*c-n*d-a*s-l*r,e}function kV(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=Math.sqrt(i*i+n*n+a*a),d=Math.exp(l),s=o>0?d*Math.sin(o)/o:0;return e[0]=i*s,e[1]=n*s,e[2]=a*s,e[3]=d*Math.cos(o),e}function SV(e,t){var i=t[0],n=t[1],a=t[2],l=t[3],o=Math.sqrt(i*i+n*n+a*a),d=o>0?Math.atan2(o,l)/o:0;return e[0]=i*d,e[1]=n*d,e[2]=a*d,e[3]=.5*Math.log(i*i+n*n+a*a+l*l),e}function uc(e,t,i,n){var a,l,o,d,s,r=t[0],c=t[1],b=t[2],m=t[3],h=i[0],W=i[1],p=i[2],Z=i[3];return(l=r*h+c*W+b*p+m*Z)<0&&(l=-l,h=-h,W=-W,p=-p,Z=-Z),1-l>Ro.EPSILON?(a=Math.acos(l),o=Math.sin(a),d=Math.sin((1-n)*a)/o,s=Math.sin(n*a)/o):(d=1-n,s=n),e[0]=d*r+s*h,e[1]=d*c+s*W,e[2]=d*b+s*p,e[3]=d*m+s*Z,e}function QV(e,t){var i,n=t[0]+t[4]+t[8];if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var l=(a+1)%3,o=(a+2)%3;i=Math.sqrt(t[3*a+a]-t[3*l+l]-t[3*o+o]+1),e[a]=.5*i,e[3]=(t[3*l+o]-t[3*o+l])*(i=.5/i),e[l]=(t[3*l+a]+t[3*a+l])*i,e[o]=(t[3*o+a]+t[3*a+o])*i}return e}ne.clone=wn.clone,ne.fromValues=wn.fromValues,ne.copy=wn.copy,ne.set=wn.set,ne.add=wn.add,ne.mul=TV;var vV=wn.scale;ne.scale=vV;var fV=wn.dot;ne.dot=fV,ne.lerp=wn.lerp;var zV=wn.length;ne.length=zV,ne.len=zV;var LV=wn.squaredLength;ne.squaredLength=LV,ne.sqrLen=LV;var mh=wn.normalize;ne.normalize=mh,ne.exactEquals=wn.exactEquals,ne.equals=wn.equals;var ga,EV,AV,Px=(ga=nl.create(),EV=nl.fromValues(1,0,0),AV=nl.fromValues(0,1,0),function(e,t,i){var n=nl.dot(t,i);return n<-.999999?(nl.cross(ga,EV,t),nl.len(ga)<1e-6&&nl.cross(ga,AV,t),nl.normalize(ga,ga),CV(e,ga,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(nl.cross(ga,t,i),e[0]=ga[0],e[1]=ga[1],e[2]=ga[2],e[3]=1+n,mh(e,e))});ne.rotationTo=Px;var hh,Wh,qx=(hh=bh(),Wh=bh(),function(e,t,i,n,a,l){return uc(hh,t,a,l),uc(Wh,i,n,l),uc(e,hh,Wh,2*l*(1-l)),e});ne.sqlerp=qx;var ua,$x=(ua=Kx.create(),function(e,t,i,n){return ua[0]=i[0],ua[3]=i[1],ua[6]=i[2],ua[1]=n[0],ua[4]=n[1],ua[7]=n[2],ua[2]=-t[0],ua[5]=-t[1],ua[8]=-t[2],mh(e,QV(e,ua))});ne.setAxes=$x;var Fe={};function ph(e){return ph=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ph(e)}Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.create=function(){var e=new un.ARRAY_TYPE(8);return un.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Fe.clone=function(e){var t=new un.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Fe.fromValues=function(e,t,i,n,a,l,o,d){var s=new un.ARRAY_TYPE(8);return s[0]=e,s[1]=t,s[2]=i,s[3]=n,s[4]=a,s[5]=l,s[6]=o,s[7]=d,s},Fe.fromRotationTranslationValues=function(e,t,i,n,a,l,o){var d=new un.ARRAY_TYPE(8);d[0]=e,d[1]=t,d[2]=i,d[3]=n;var s=.5*a,r=.5*l,c=.5*o;return d[4]=s*n+r*i-c*t,d[5]=r*n+c*e-s*i,d[6]=c*n+s*t-r*e,d[7]=-s*e-r*t-c*i,d},Fe.fromRotationTranslation=HV,Fe.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Fe.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Fe.fromMat4=function(e,t){var i=al.create();wV.getRotation(i,t);var n=new un.ARRAY_TYPE(3);return wV.getTranslation(n,t),HV(e,i,n),e},Fe.copy=OV,Fe.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Fe.set=function(e,t,i,n,a,l,o,d,s){return e[0]=t,e[1]=i,e[2]=n,e[3]=a,e[4]=l,e[5]=o,e[6]=d,e[7]=s,e},Fe.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Fe.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Fe.getTranslation=function(e,t){var i=t[4],n=t[5],a=t[6],l=t[7],o=-t[0],d=-t[1],s=-t[2],r=t[3];return e[0]=2*(i*r+l*o+n*s-a*d),e[1]=2*(n*r+l*d+a*o-i*s),e[2]=2*(a*r+l*s+i*d-n*o),e},Fe.translate=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=.5*i[0],s=.5*i[1],r=.5*i[2],c=t[4],b=t[5],m=t[6],h=t[7];return e[0]=n,e[1]=a,e[2]=l,e[3]=o,e[4]=o*d+a*r-l*s+c,e[5]=o*s+l*d-n*r+b,e[6]=o*r+n*s-a*d+m,e[7]=-n*d-a*s-l*r+h,e},Fe.rotateX=function(e,t,i){var n=-t[0],a=-t[1],l=-t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=d*o+c*n+s*l-r*a,m=s*o+c*a+r*n-d*l,h=r*o+c*l+d*a-s*n,W=c*o-d*n-s*a-r*l;return al.rotateX(e,t,i),e[4]=b*(o=e[3])+W*(n=e[0])+m*(l=e[2])-h*(a=e[1]),e[5]=m*o+W*a+h*n-b*l,e[6]=h*o+W*l+b*a-m*n,e[7]=W*o-b*n-m*a-h*l,e},Fe.rotateY=function(e,t,i){var n=-t[0],a=-t[1],l=-t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=d*o+c*n+s*l-r*a,m=s*o+c*a+r*n-d*l,h=r*o+c*l+d*a-s*n,W=c*o-d*n-s*a-r*l;return al.rotateY(e,t,i),e[4]=b*(o=e[3])+W*(n=e[0])+m*(l=e[2])-h*(a=e[1]),e[5]=m*o+W*a+h*n-b*l,e[6]=h*o+W*l+b*a-m*n,e[7]=W*o-b*n-m*a-h*l,e},Fe.rotateZ=function(e,t,i){var n=-t[0],a=-t[1],l=-t[2],o=t[3],d=t[4],s=t[5],r=t[6],c=t[7],b=d*o+c*n+s*l-r*a,m=s*o+c*a+r*n-d*l,h=r*o+c*l+d*a-s*n,W=c*o-d*n-s*a-r*l;return al.rotateZ(e,t,i),e[4]=b*(o=e[3])+W*(n=e[0])+m*(l=e[2])-h*(a=e[1]),e[5]=m*o+W*a+h*n-b*l,e[6]=h*o+W*l+b*a-m*n,e[7]=W*o-b*n-m*a-h*l,e},Fe.rotateByQuatAppend=function(e,t,i){var n=i[0],a=i[1],l=i[2],o=i[3],d=t[0],s=t[1],r=t[2],c=t[3];return e[0]=d*o+c*n+s*l-r*a,e[1]=s*o+c*a+r*n-d*l,e[2]=r*o+c*l+d*a-s*n,e[3]=c*o-d*n-s*a-r*l,e[4]=(d=t[4])*o+(c=t[7])*n+(s=t[5])*l-(r=t[6])*a,e[5]=s*o+c*a+r*n-d*l,e[6]=r*o+c*l+d*a-s*n,e[7]=c*o-d*n-s*a-r*l,e},Fe.rotateByQuatPrepend=function(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=i[0],s=i[1],r=i[2],c=i[3];return e[0]=n*c+o*d+a*r-l*s,e[1]=a*c+o*s+l*d-n*r,e[2]=l*c+o*r+n*s-a*d,e[3]=o*c-n*d-a*s-l*r,e[4]=n*(c=i[7])+o*(d=i[4])+a*(r=i[6])-l*(s=i[5]),e[5]=a*c+o*s+l*d-n*r,e[6]=l*c+o*r+n*s-a*d,e[7]=o*c-n*d-a*s-l*r,e},Fe.rotateAroundAxis=function(e,t,i,n){if(Math.abs(n)<un.EPSILON)return OV(e,t);var a=Math.hypot(i[0],i[1],i[2]);n*=.5;var l=Math.sin(n),o=l*i[0]/a,d=l*i[1]/a,s=l*i[2]/a,r=Math.cos(n),c=t[0],b=t[1],m=t[2],h=t[3];e[0]=c*r+h*o+b*s-m*d,e[1]=b*r+h*d+m*o-c*s,e[2]=m*r+h*s+c*d-b*o,e[3]=h*r-c*o-b*d-m*s;var W=t[4],p=t[5],Z=t[6],g=t[7];return e[4]=W*r+g*o+p*s-Z*d,e[5]=p*r+g*d+Z*o-W*s,e[6]=Z*r+g*s+W*d-p*o,e[7]=g*r-W*o-p*d-Z*s,e},Fe.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Fe.multiply=DV,Fe.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Fe.lerp=function(e,t,i,n){var a=1-n;return _V(t,i)<0&&(n=-n),e[0]=t[0]*a+i[0]*n,e[1]=t[1]*a+i[1]*n,e[2]=t[2]*a+i[2]*n,e[3]=t[3]*a+i[3]*n,e[4]=t[4]*a+i[4]*n,e[5]=t[5]*a+i[5]*n,e[6]=t[6]*a+i[6]*n,e[7]=t[7]*a+i[7]*n,e},Fe.invert=function(e,t){var i=Rc(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Fe.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Fe.normalize=function(e,t){var i=Rc(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i,a=t[1]/i,l=t[2]/i,o=t[3]/i,d=t[4],s=t[5],r=t[6],c=t[7],b=n*d+a*s+l*r+o*c;e[0]=n,e[1]=a,e[2]=l,e[3]=o,e[4]=(d-n*b)/i,e[5]=(s-a*b)/i,e[6]=(r-l*b)/i,e[7]=(c-o*b)/i}return e},Fe.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Fe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Fe.equals=function(e,t){var i=e[0],n=e[1],a=e[2],l=e[3],o=e[4],d=e[5],s=e[6],r=e[7],c=t[0],b=t[1],m=t[2],h=t[3],W=t[4],p=t[5],Z=t[6],g=t[7];return Math.abs(i-c)<=un.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-b)<=un.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-m)<=un.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-h)<=un.EPSILON*Math.max(1,Math.abs(l),Math.abs(h))&&Math.abs(o-W)<=un.EPSILON*Math.max(1,Math.abs(o),Math.abs(W))&&Math.abs(d-p)<=un.EPSILON*Math.max(1,Math.abs(d),Math.abs(p))&&Math.abs(s-Z)<=un.EPSILON*Math.max(1,Math.abs(s),Math.abs(Z))&&Math.abs(r-g)<=un.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))},Fe.sqrLen=Fe.squaredLength=Fe.len=Fe.length=Fe.dot=Fe.mul=Fe.setReal=Fe.getReal=void 0;var un=Zh(Oi),al=Zh(ne),wV=Zh(oe);function jV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(jV=function(n){return n?i:t})(e)}function Zh(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ph(e)!=="object"&&typeof e!="function")return{default:e};var i=jV(t);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}function HV(e,t,i){var n=.5*i[0],a=.5*i[1],l=.5*i[2],o=t[0],d=t[1],s=t[2],r=t[3];return e[0]=o,e[1]=d,e[2]=s,e[3]=r,e[4]=n*r+a*s-l*d,e[5]=a*r+l*o-n*s,e[6]=l*r+n*d-a*o,e[7]=-n*o-a*d-l*s,e}function OV(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function DV(e,t,i){var n=t[0],a=t[1],l=t[2],o=t[3],d=i[4],s=i[5],r=i[6],c=i[7],b=t[4],m=t[5],h=t[6],W=t[7],p=i[0],Z=i[1],g=i[2],u=i[3];return e[0]=n*u+o*p+a*g-l*Z,e[1]=a*u+o*Z+l*p-n*g,e[2]=l*u+o*g+n*Z-a*p,e[3]=o*u-n*p-a*Z-l*g,e[4]=n*c+o*d+a*r-l*s+b*u+W*p+m*g-h*Z,e[5]=a*c+o*s+l*d-n*r+m*u+W*Z+h*p-b*g,e[6]=l*c+o*r+n*s-a*d+h*u+W*g+b*Z-m*p,e[7]=o*c-n*d-a*s-l*r+W*u-b*p-m*Z-h*g,e}Fe.getReal=al.copy,Fe.setReal=al.copy,Fe.mul=DV;var _V=al.dot;Fe.dot=_V;var KV=al.length;Fe.length=KV,Fe.len=KV;var Rc=al.squaredLength;Fe.squaredLength=Rc,Fe.sqrLen=Rc;var be={};function Vh(e){return Vh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vh(e)}Object.defineProperty(be,"__esModule",{value:!0}),be.create=qV,be.clone=function(e){var t=new Go.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},be.fromValues=function(e,t){var i=new Go.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},be.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},be.set=function(e,t,i){return e[0]=t,e[1]=i,e},be.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},be.subtract=$V,be.multiply=tg,be.divide=eg,be.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},be.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},be.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},be.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},be.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},be.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},be.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e},be.distance=ig,be.squaredDistance=ng,be.length=ag,be.squaredLength=lg,be.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},be.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},be.normalize=function(e,t){var i=t[0],n=t[1],a=i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e},be.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},be.cross=function(e,t,i){var n=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=n,e},be.lerp=function(e,t,i,n){var a=t[0],l=t[1];return e[0]=a+n*(i[0]-a),e[1]=l+n*(i[1]-l),e},be.random=function(e,t){t=t||1;var i=2*Go.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},be.transformMat2=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[2]*a,e[1]=i[1]*n+i[3]*a,e},be.transformMat2d=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[2]*a+i[4],e[1]=i[1]*n+i[3]*a+i[5],e},be.transformMat3=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[3]*a+i[6],e[1]=i[1]*n+i[4]*a+i[7],e},be.transformMat4=function(e,t,i){var n=t[0],a=t[1];return e[0]=i[0]*n+i[4]*a+i[12],e[1]=i[1]*n+i[5]*a+i[13],e},be.rotate=function(e,t,i,n){var a=t[0]-i[0],l=t[1]-i[1],o=Math.sin(n),d=Math.cos(n);return e[0]=a*d-l*o+i[0],e[1]=a*o+l*d+i[1],e},be.angle=function(e,t){var i=e[0],n=e[1],a=t[0],l=t[1],o=Math.sqrt(i*i+n*n)*Math.sqrt(a*a+l*l);return Math.acos(Math.min(Math.max(o&&(i*a+n*l)/o,-1),1))},be.zero=function(e){return e[0]=0,e[1]=0,e},be.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},be.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},be.equals=function(e,t){var i=e[0],n=e[1],a=t[0],l=t[1];return Math.abs(i-a)<=Go.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=Go.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))},be.forEach=be.sqrLen=be.sqrDist=be.dist=be.div=be.mul=be.sub=be.len=void 0;var Go=function(e,t){if(e&&e.__esModule)return e;if(e===null||Vh(e)!=="object"&&typeof e!="function")return{default:e};var i=PV(void 0);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}(Oi);function PV(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(PV=function(n){return n?i:t})(e)}function qV(){var e=new Go.ARRAY_TYPE(2);return Go.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function $V(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function tg(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function eg(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function ig(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function ng(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function ag(e){return Math.hypot(e[0],e[1])}function lg(e){var t=e[0],i=e[1];return t*t+i*i}be.len=ag,be.sub=$V,be.mul=tg,be.div=eg,be.dist=ig,be.sqrDist=ng,be.sqrLen=lg;var tN=function(){var e=qV();return function(t,i,n,a,l,o){var d,s;for(i||(i=2),n||(n=0),s=a?Math.min(a*i+n,t.length):t.length,d=n;d<s;d+=i)e[0]=t[d],e[1]=t[d+1],l(e,e,o),t[d]=e[0],t[d+1]=e[1];return t}}();function gh(e){return gh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gh(e)}be.forEach=tN,Object.defineProperty(Hi,"__esModule",{value:!0});var Le=Hi.vec4=S=Hi.vec3=Hi.vec2=Hi.quat2=an=Hi.quat=D=Hi.mat4=Rn=Hi.mat3=Hi.mat2d=Zd=Hi.mat2=Hi.glMatrix=void 0,eN=Ca(Oi);Hi.glMatrix=eN;var iN=Ca(ci),Zd=Hi.mat2=iN,nN=Ca(hi);Hi.mat2d=nN;var aN=Ca(_e),Rn=Hi.mat3=aN,lN=Ca(oe),D=Hi.mat4=lN,oN=Ca(ne),an=Hi.quat=oN,dN=Ca(Fe);Hi.quat2=dN;var sN=Ca(be);Hi.vec2=sN;var rN=Ca(le),S=Hi.vec3=rN,cN=Ca(Ve);function og(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(og=function(n){return n?i:t})(e)}function Ca(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||gh(e)!=="object"&&typeof e!="function")return{default:e};var i=og(t);if(i&&i.has(e))return i.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(l!=="default"&&Object.prototype.hasOwnProperty.call(e,l)){var o=a?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(n,l,o):n[l]=e[l]}return n.default=e,i&&i.set(e,n),n}Le=Hi.vec4=cN;let bN=Ce([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Gc}=bN,dg=Ce([{name:"a_pos_3",components:3,type:"Int16"}]);var Ml=Ce([{name:"a_pos",type:"Int16",components:2}]),sg={};(function(e,t){(function(i){function n(l,o,d){var s=a(256*l,256*(o=Math.pow(2,d)-o-1),d),r=a(256*(l+1),256*(o+1),d);return s[0]+","+s[1]+","+r[0]+","+r[1]}function a(l,o,d){var s=2*Math.PI*6378137/256/Math.pow(2,d);return[l*s-2*Math.PI*6378137/2,o*s-2*Math.PI*6378137/2]}i.getURL=function(l,o,d,s,r,c){return c=c||{},l+"?"+["bbox="+n(d,s,r),"format="+(c.format||"image/png"),"service="+(c.service||"WMS"),"version="+(c.version||"1.1.1"),"request="+(c.request||"GetMap"),"srs="+(c.srs||"EPSG:3857"),"width="+(c.width||256),"height="+(c.height||256),"layers="+o].join("&")},i.getTileBBox=n,i.getMercCoords=a,Object.defineProperty(i,"__esModule",{value:!0})})(t)})(0,sg);var mN=sg;class ia{constructor(t,i,n){this.z=t,this.x=i,this.y=n,this.key=Ms(0,t,t,i,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){let n=mN.getTileBBox(this.x,this.y,this.z),a=function(l,o,d){let s,r="";for(let c=l;c>0;c--)s=1<<c-1,r+=(o&s?1:0)+(d&s?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class uh{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Ms(t,i.z,i.z,i.x,i.y)}}class Xe{constructor(t,i,n,a,l){this.overscaledZ=t,this.wrap=i,this.canonical=new ia(n,+a,+l),this.key=i===0&&t===n?this.canonical.key:Ms(i,t,n,a,l)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let i=this.canonical.z-t;return t>this.canonical.z?new Xe(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xe(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Ms(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{let n=this.canonical.z-t;return Ms(this.wrap*+i,t,t,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Xe(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Xe(i,this.wrap,i,n,a),new Xe(i,this.wrap,i,n+1,a),new Xe(i,this.wrap,i,n,a+1),new Xe(i,this.wrap,i,n+1,a+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Xe(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Xe(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function Ms(e,t,i,n,a){let l=1<<Math.min(i,22),o=l*(a%l)+n%l;return e&&i<22&&(o+=l*l*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*o+i)+(t-i)}let rg=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new Xe(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new Xe(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new Xe(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new Xe(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];kt(ia,"CanonicalTileID"),kt(Xe,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class Fc{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,n){let a=S.dot(i,this.dir);if(Math.abs(a)<1e-6)return!1;let l=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/a;return n[0]=this.pos[0]+this.dir[0]*l,n[1]=this.pos[1]+this.dir[1]*l,n[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(t,i,n){if(S.equals(this.pos,t)||i===0)return n[0]=n[1]=n[2]=0,!1;let[a,l,o]=this.dir,d=this.pos[0]-t[0],s=this.pos[1]-t[1],r=this.pos[2]-t[2],c=a*a+l*l+o*o,b=2*(d*a+s*l+r*o),m=b*b-4*c*(d*d+s*s+r*r-i*i);if(m<0){let h=Math.max(-b/2,0),W=d+a*h,p=s+l*h,Z=r+o*h,g=Math.hypot(W,p,Z);return n[0]=W*i/g,n[1]=p*i/g,n[2]=Z*i/g,!1}{let h=(-b-Math.sqrt(m))/(2*c);if(h<0){let W=Math.hypot(d,s,r);return n[0]=d*i/W,n[1]=s*i/W,n[2]=r*i/W,!1}return n[0]=d+a*h,n[1]=s+l*h,n[2]=r+o*h,!0}}}class Rh{constructor(t,i,n,a,l){this.TL=t,this.TR=i,this.BR=n,this.BL=a,this.horizon=l}static fromInvProjectionMatrix(t,i,n){let a=[-1,1,1],l=[1,1,1],o=[1,-1,1],d=[-1,-1,1],s=S.transformMat4(a,a,t),r=S.transformMat4(l,l,t),c=S.transformMat4(o,o,t),b=S.transformMat4(d,d,t);return new Rh(s,r,c,b,i/n)}}function Cs(e,t,i){let n=1/0,a=-1/0,l=[];for(let o of e){S.sub(l,o,t);let d=S.dot(l,i);n=Math.min(n,d),a=Math.max(a,d)}return[n,a]}function cg(e,t){let i=!0;for(let n=0;n<e.planes.length;n++){let a=e.planes[n],l=0;for(let o=0;o<t.length;o++)l+=S.dot(a,t[o])+a[3]>=0;if(l===0)return 0;l!==t.length&&(i=!1)}return i?2:1}function bg(e,t){for(let i of e.projections){let n=Cs(t,e.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function mg(e,t){let i=0,n=[0,0,0,0];for(let a=0;a<e.length;a++)n[0]=e[a][0],n[1]=e[a][1],n[2]=e[a][2],n[3]=1,Le.dot(n,t)>=0&&i++;return i}class ll{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=$e.fromPoints(this.points),this.projections=[],this.frustumEdges=[S.sub([],this.points[2],this.points[3]),S.sub([],this.points[0],this.points[3]),S.sub([],this.points[4],this.points[0]),S.sub([],this.points[5],this.points[1]),S.sub([],this.points[6],this.points[2]),S.sub([],this.points[7],this.points[3])];for(let n of this.frustumEdges){let a=[0,-n[2],n[1]],l=[n[2],0,-n[0]];this.projections.push({axis:a,projection:Cs(this.points,this.points[0],a)}),this.projections.push({axis:l,projection:Cs(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(t,i,n,a){let l=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>{let c=Le.transformMat4([],r,t),b=1/c[3]/i*l;return Le.mul(c,c,[b,b,a?1/c[3]:b,b])}),d=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(r=>{let c=S.sub([],o[r[0]],o[r[1]]),b=S.sub([],o[r[2]],o[r[1]]),m=S.normalize([],S.cross([],c,b)),h=-S.dot(m,o[r[1]]);return m.concat(h)}),s=[];for(let r=0;r<o.length;r++)s.push([o[r][0],o[r][1],o[r][2]]);return new ll(s,d)}intersectsPrecise(t,i,n){for(let a=0;a<i.length;a++)if(!mg(t,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!mg(t,this.planes[a]))return 0;for(let a of n)for(let l of this.frustumEdges){let o=S.cross([],a,l),d=S.length(o);if(d===0)continue;S.scale(o,o,1/d);let s=Cs(this.points,this.points[0],o),r=Cs(t,this.points[0],o);if(s[0]>r[1]||r[0]>s[1])return 0}return 1}}class $e{static fromPoints(t){let i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(let a of t)S.min(i,i,a),S.max(n,n,a);return new $e(i,n)}static fromTileIdAndHeight(t,i,n){let a=1<<t.canonical.z,l=t.canonical.x,o=t.canonical.y;return new $e([l/a,o/a,i],[(l+1)/a,(o+1)/a,n])}static applyTransform(t,i){let n=t.getCorners();for(let a=0;a<n.length;++a)S.transformMat4(n[a],n[a],i);return $e.fromPoints(n)}static projectAabbCorners(t,i){let n=t.getCorners();for(let a=0;a<n.length;++a)S.transformMat4(n[a],n[a],i);return n}constructor(t,i){this.min=t,this.max=i,this.center=S.scale([],S.add([],this.min,this.max),.5)}quadrant(t){let i=[t%2==0,t<2],n=S.clone(this.min),a=S.clone(this.max);for(let l=0;l<i.length;l++)n[l]=i[l]?this.min[l]:this.center[l],a[l]=i[l]?this.center[l]:this.max[l];return a[2]=this.max[2],new $e(n,a)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?cg(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?cg(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?bg(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?bg(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}kt($e,"Aabb");let Ts=5,Cl=6,Wn=tt/Math.PI/2,hN=16383,Vd=64,Gh=[Vd,32,16],na=-Wn,aa=Wn,WN=[new $e([na,na,na],[aa,aa,aa]),new $e([na,na,na],[0,0,aa]),new $e([0,na,na],[aa,0,aa]),new $e([na,0,na],[0,aa,aa]),new $e([0,0,na],[aa,aa,aa])];function Ic(e){return e*Wn/ud}function hg(e,t,i,n=!0){let a=S.scale([],e._camera.position,e.worldSize),l=[t,i,1,1];Le.transformMat4(l,l,e.pixelMatrixInverse),Le.scale(l,l,1/l[3]);let o=S.sub([],l,a),d=S.normalize([],o),s=e.globeMatrix,r=[s[12],s[13],s[14]],c=S.sub([],r,a),b=S.length(c),m=S.normalize([],c),h=e.worldSize/(2*Math.PI),W=S.dot(m,d),p=Math.asin(h/b);if(p<Math.acos(W)){if(!n)return null;let B=[],C=[];S.scale(B,d,b/W),S.normalize(C,S.sub(C,B,c)),S.normalize(d,S.add(d,c,S.scale(d,C,Math.tan(p)*b)))}let Z=[];new Fc(a,d).closestPointOnSphere(r,h,Z);let g=S.normalize([],li(s,0)),u=S.normalize([],li(s,1)),G=S.normalize([],li(s,2)),F=S.dot(g,Z),R=S.dot(u,Z),I=S.dot(G,Z),N=ei(Math.asin(-R/h)),Y=ei(Math.atan2(F,I));Y=e.center.lng+function(B,C){let Q=(C-B+180)%360-180;return Q<-180?Q+360:Q}(e.center.lng,Y);let X=Qi(Y),J=Mt(Li(N),0,1);return new Re(X,J)}class pN{constructor(t,i,n){this.a=S.sub([],t,n),this.b=S.sub([],i,n),this.center=n;let a=S.normalize([],this.a),l=S.normalize([],this.b);this.angle=Math.acos(S.dot(a,l))}}function Fh(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(n,a,l,o){let d=Math.sin(l);return n*(Math.sin((1-o)*l)/d)+a*(Math.sin(o*l)/d)}(e.a[t],e.b[t],e.angle,Mt(i,0,1))+e.center[t]}function jn(e){if(e.z<=1)return WN[e.z+2*e.y+e.x];let t=Uh(Uc(e));return $e.fromPoints(t)}function ol(e,t,i){return S.scale(e,e,1-i),S.scaleAndAdd(e,e,t,i)}function Wg(e,t){let i=Di(t.zoom);if(i===0)return jn(e);let n=Uc(e),a=Uh(n),l=Qi(n.getWest())*t.worldSize,o=Qi(n.getEast())*t.worldSize,d=Li(n.getNorth())*t.worldSize,s=Li(n.getSouth())*t.worldSize,r=[l,d,0],c=[o,d,0],b=[l,s,0],m=[o,s,0],h=D.invert([],t.globeMatrix);return S.transformMat4(r,r,h),S.transformMat4(c,c,h),S.transformMat4(b,b,h),S.transformMat4(m,m,h),a[0]=ol(a[0],b,i),a[1]=ol(a[1],m,i),a[2]=ol(a[2],c,i),a[3]=ol(a[3],r,i),$e.fromPoints(a)}function pg(e,t,i){for(let n of e)S.transformMat4(n,n,t),S.scale(n,n,i)}function Ih(e,t,i,n){let a=t/e.worldSize,l=e.globeMatrix;if(i.z<=1){let X=jn(i).getCorners();return pg(X,l,a),$e.fromPoints(X)}let o=Uc(i,n),d=Uh(o);pg(d,l,a);let s=Number.MAX_VALUE,r=[-s,-s,-s],c=[s,s,s];if(o.contains(e.center)){for(let B of d)S.min(c,c,B),S.max(r,r,B);r[2]=0;let X=e.point,J=[X.x*a,X.y*a,0];return S.min(c,c,J),S.max(r,r,J),new $e(c,r)}let b=[l[12]*a,l[13]*a,l[14]*a],m=o.getCenter(),h=Mt(e.center.lat,-ui,ui),W=Mt(m.lat,-ui,ui),p=Qi(e.center.lng),Z=Li(h),g=p-Qi(m.lng),u=Z-Li(W);g>.5?g-=1:g<-.5&&(g+=1);let G=0;if(Math.abs(g)>Math.abs(u))G=g>=0?1:3;else{G=u>=0?0:2;let X=[l[4]*a,l[5]*a,l[6]*a],J=-Math.sin(At(u>=0?o.getSouth():o.getNorth()))*Wn;S.scaleAndAdd(b,b,X,J)}let F=d[G],R=d[(G+1)%4],I=new pN(F,R,b),N=[Fh(I,0)||F[0],Fh(I,1)||F[1],Fh(I,2)||F[2]],Y=Di(e.zoom);if(Y>0){let X=function({x:B,y:C,z:Q},y,z,E,O){let f=1/(1<<Q),L=B*f,K=L+f,q=C*f,P=q+f,et=0,it=(L+K)/2-E;return it>.5?et=-1:it<-.5&&(et=1),L=((L+et)*y-(E*=y))*z+E,K=((K+et)*y-E)*z+E,q=(q*y-(O*=y))*z+O,P=(P*y-O)*z+O,[[L,P,0],[K,P,0],[K,q,0],[L,q,0]]}(i,t,e._pixelsPerMercatorPixel,p,Z);for(let B=0;B<d.length;B++)ol(d[B],X[B],Y);let J=S.add([],X[G],X[(G+1)%4]);S.scale(J,J,.5),ol(N,J,Y)}for(let X of d)S.min(c,c,X),S.max(r,r,X);return c[2]=Math.min(F[2],R[2]),S.min(c,c,N),S.max(r,r,N),new $e(c,r)}function Uc({x:e,y:t,z:i},n=!1){let a=1/(1<<i),l=new qt(kn(e*a),t===(1<<i)-1&&n?-90:Bi((t+1)*a)),o=new qt(kn((e+1)*a),t===0&&n?90:Bi(t*a));return new Tn(l,o)}function Uh(e){let t=At(e.getNorth()),i=At(e.getSouth()),n=Math.cos(t),a=Math.cos(i),l=Math.sin(t),o=Math.sin(i),d=e.getWest(),s=e.getEast();return[gd(a,o,d),gd(a,o,s),gd(n,l,s),gd(n,l,d)]}function gd(e,t,i,n=Wn){return i=At(i),[e*Math.sin(i)*n,-t*n,e*Math.cos(i)*n]}function Gn(e,t,i){return gd(Math.cos(At(e)),Math.sin(At(e)),t,i)}function ks(e,t,i,n){let a=1<<i.z,l=(e/tt+i.x)/a;return Gn(Bi((t/tt+i.y)/a),kn(l),n)}function xc({min:e,max:t}){return hN/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}let Zg=new Float64Array(16);function Tl(e){let t=xc(e),i=D.fromScaling(Zg,[t,t,t]);return D.translate(i,i,S.negate([],e.min))}function xh(e){let t=D.fromTranslation(Zg,e.min),i=1/xc(e);return D.scale(t,t,[i,i,i])}function Nh(e){let t=tt/(2*Math.PI);return e/(2*Math.PI)/t}function Vg(e,t){return tt/(512*Math.pow(2,e))*xc(jn(t))}function gg(e,t,i,n,a){let l=Nh(i),o=[e,t,-i/(2*Math.PI)],d=D.identity(new Float64Array(16));return D.translate(d,d,o),D.scale(d,d,[l,l,l]),D.rotateX(d,d,At(-a)),D.rotateY(d,d,At(-n)),d}function ug(e){let t=e.pixelsPerMeter,i=t/He(1,e.center.lat),n=D.identity(new Float64Array(16));return D.translate(n,n,[e.point.x,e.point.y,0]),D.scale(n,n,[i,i,t]),Float32Array.from(n)}function Di(e){return pn(Ts,Cl,e)}function Rg(e,t,i){let n=D.identity(new Float64Array(16)),a=(t/(1<<e)-.5)*Math.PI*2;return D.rotateY(n,i.globeMatrix,a),Float32Array.from(n)}function Gg(e,t,i){let n=Di(i.zoom),a=e.style.map._antialias,l=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return n===0&&!a&&!l}function Fg(e,t,i,n){let a=t.getNorth(),l=t.getSouth(),o=t.getWest(),d=t.getEast(),s=1<<e.z,r=d-o,c=a-l,b=r/Vd,m=-c/Gh[i],h=[0,b,0,m,0,0,a,o,0];if(e.z>0){let W=180/n;Rn.multiply(h,h,[W/r+1,0,0,0,W/c+1,0,-.5*W/b,.5*W/m,1])}return h[2]=s,h[5]=e.x,h[8]=e.y,h}function ZN(e){let t=ui-5;e=Mt(e,-t,t)/t*90;let i=Math.pow(Math.abs(Math.sin(At(e))),3);return Math.round(i*(Gh.length-1))}function Ig(e){let t=[0,0,0],i=D.identity(new Float64Array(16));return D.multiply(i,e.pixelMatrix,e.globeMatrix),S.transformMat4(t,t,i),new H(t[0],t[1])}function Ug(e,t){let i=Gn(t.lat,t.lng),n=function(l){let o=Gn(l._center.lat,l._center.lng),d=S.fromValues(0,1,0),s=S.cross([],d,o),r=D.fromRotation([],-l.angle,o);s=S.transformMat4(s,s,r),D.fromRotation(r,-l._pitch,s);let c=S.normalize([],o);return S.scale(c,c,Ic(l.cameraToCenterDistance/l.pixelsPerMeter)),S.transformMat4(c,c,r),S.add([],o,c)}(e),a=S.subtract([],n,i);return S.angle(a,i)}function Nc(e,t){return Ug(e,t)>Math.PI/2*1.01}let xg=At(85),VN=Math.cos(xg),gN=Math.sin(xg);class uN{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,i){let n=new Mn,a=new yi,l=[],o=t+1+2,d=i[0]+1,s=i[0]+1+(1+i.length),r=(c,b,m)=>{let h=c===o-1?c-2:c===0?c:c-1;return h+=m?24575:0,[h,b]};for(let c=0;c<o;++c)n.emplaceBack(...r(c,0,!0));for(let c=0;c<d;++c)for(let b=0;b<o;++b)n.emplaceBack(...r(b,c,(b===0||b===o-1)&&!0));for(let c=0;c<i.length;++c){let b=i[c];for(let m=0;m<o;++m)n.emplaceBack(...r(m,b,!0))}for(let c=0;c<i.length;++c){let b=a.length,m=i[c]+1+2,h=new yi;for(let Z=0;Z<m-1;Z++){let g=Z===m-2,u=g?o*(s-i.length+c-Z):o;for(let G=0;G<o-1;G++){let F=Z*o+G;Z===0||g||G===0||G===o-2?(h.emplaceBack(F+1,F,F+u),h.emplaceBack(F+u,F+u+1,F+1)):(a.emplaceBack(F+1,F,F+u),a.emplaceBack(F+u,F+u+1,F+1))}}let W=ze.simpleSegment(0,b,n.length,a.length-b);for(let Z=0;Z<h.uint16.length;Z+=3)a.emplaceBack(h.uint16[Z],h.uint16[Z+1],h.uint16[Z+2]);let p=ze.simpleSegment(0,b,n.length,a.length-b);l.push({withoutSkirts:W,withSkirts:p})}return{vertices:n,indices:a,segments:l}}_createGrid(t){let i=this._fillGridMeshWithLods(Vd,Gh);this._gridSegments=i.segments,this._gridBuffer=t.createVertexBuffer(i.vertices,Ml.members),this._gridIndexBuffer=t.createIndexBuffer(i.indices,!0)}_createPoles(t){let i=new yi;for(let d=0;d<=Vd;d++)i.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(i,!0);let n=new Vo,a=new Vo,l=new Vo,o=new Vo;this._poleSegments=[];for(let d=0,s=0;d<Ts;d++){let r=360/(1<<d);n.emplaceBack(0,-Wn,0,.5,0),a.emplaceBack(0,-Wn,0,.5,1),l.emplaceBack(0,-Wn,0,.5,.5),o.emplaceBack(0,-Wn,0,.5,.5);for(let c=0;c<=Vd;c++){let b=c/Vd,m=0,h=Pt(0,r,b),[W,p,Z]=gd(VN,gN,h,Wn);n.emplaceBack(W,p,Z,b,m),a.emplaceBack(W,p,Z,b,1-m);let g=At(h);b=.5+.5*Math.sin(g),m=.5+.5*Math.cos(g),l.emplaceBack(W,p,Z,b,m),o.emplaceBack(W,p,Z,b,1-m)}this._poleSegments.push(ze.simpleSegment(s,0,66,64)),s+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Gc,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(a,Gc,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,Gc,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(o,Gc,!1)}getGridBuffers(t,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}let ud=63710088e-1,Yh=2*Math.PI*ud;class kl{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(i,")"));if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kl(Nn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(t){let i=Math.PI/180,n=this.lat*i,a=t.lat*i,l=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((t.lng-this.lng)*i);return ud*Math.acos(Math.min(l,1))}toBounds(t=0){let i=360*t/40075017,n=i/Math.cos(Math.PI/180*this.lat);return new Tn(new kl(this.lng-n,this.lat-i),new kl(this.lng+n,this.lat+i))}toEcef(t){let i=Ic(t);return Gn(this.lat,this.lng,Wn+i)}static convert(t){if(t instanceof kl)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new kl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new kl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var qt=kl;let RN=0,GN=25.5;function Yc(e){return Yh*Math.cos(e*Math.PI/180)}function Qi(e){return(180+e)/360}function Li(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function He(e,t){return e/Yc(t)}function kn(e){return 360*e-180}function Bi(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Ng(e,t){return e*Yc(Bi(t))}let ui=85.051129;function Yg(e){return Math.cos(At(Mt(e,-ui,ui)))}function Sl(e,t){let i=Mt(t,RN,GN),n=Math.pow(2,i);return Yg(e)*Yh/(512*n)}function Xh(e){return 1/Math.cos(e*Math.PI/180)}function Ss(e,t=0){let i=Math.exp(Math.PI*(1-(e.y+t/tt)/(1<<e.z)*2));return 80150034*i/(i*i+1)/tt/(1<<e.z)}class Re{constructor(t,i,n=0){this.x=+t,this.y=+i,this.z=+n}static fromLngLat(t,i=0){let n=qt.convert(t);return new Re(Qi(n.lng),Li(n.lat),He(i,n.lat))}toLngLat(){return new qt(kn(this.x),Bi(this.y))}toAltitude(){return Ng(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Yh*Xh(Bi(this.y))}}function Jh(e,t,i,n,a,l,o,d,s){let r=(t+n)/2,c=(i+a)/2,b=new H(r,c);d(b),function(m,h,W,p,Z,g){let u=W-Z,G=p-g;return Math.abs((p-h)*u-(W-m)*G)/Math.hypot(u,G)}(b.x,b.y,l.x,l.y,o.x,o.y)>=s?(Jh(e,t,i,r,c,l,b,d,s),Jh(e,r,c,n,a,b,o,d,s)):e.push(o)}function Xg(e,t,i){let n=e[0],a=n.x,l=n.y;t(n);let o=[n];for(let d=1;d<e.length;d++){let s=e[d],{x:r,y:c}=s;t(s),Jh(o,a,l,r,c,n,s,t,i),a=r,l=c,n=s}return o}function yh(e,t,i,n){if(n(t,i)){let a=t.add(i)._mult(.5);yh(e,t,a,n),yh(e,a,i,n)}else e.push(i)}function FN(e,t){let i=e[0],n=[i];for(let a=1;a<e.length;a++){let l=e[a];yh(n,i,l,t),i=l}return n}let Bh=Math.pow(2,14)-1,Jg=-Bh-1;function IN(e,t){let i=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=Mt(i,Jg,Bh),e.y=Mt(n,Jg,Bh),(i<e.x||i>e.x+1||n<e.y||n>e.y+1)&&A("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ta(e,t,i){let n=e.loadGeometry(),a=e.extent,l=tt/a;if(t&&i&&i.projection.isReprojectedInTileSpace){let o=1<<t.z,{scale:d,x:s,y:r,projection:c}=i,b=m=>{let h=kn((t.x+m.x/a)/o),W=Bi((t.y+m.y/a)/o),p=c.project(h,W);m.x=(p.x*d-s)*a,m.y=(p.y*d-r)*a};for(let m=0;m<n.length;m++)if(e.type!==1)n[m]=Xg(n[m],b,1);else{let h=[];for(let W of n[m])W.x<0||W.x>=a||W.y<0||W.y>=a||(b(W),h.push(W));n[m]=h}}for(let o of n)for(let d of o)IN(d,l);return n}function Ql(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ta(e):[]}}function Xc(e,t,i,n,a){e.emplaceBack(2*t+(n+1)/2,2*i+(a+1)/2)}function Jc(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Mh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Mn,this.indexArray=new yi,this.segments=new ze,this.programConfigurations=new yl(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,n,a){let l=this.layers[0],o=[],d=null;l.type==="circle"&&(d=l.layout.get("circle-sort-key"));for(let{feature:r,id:c,index:b,sourceLayerIndex:m}of t){let h=this.layers[0]._featureFilter.needGeometry,W=Ql(r,h);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),W,n))continue;let p=d?d.evaluate(W,{},n):void 0,Z={id:c,properties:r.properties,type:r.type,sourceLayerIndex:m,index:b,geometry:h?W.geometry:Ta(r,n,a),patterns:{},sortKey:p};o.push(Z)}d&&o.sort((r,c)=>r.sortKey-c.sortKey);let s=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new hc,s=a.projection);for(let r of o){let{geometry:c,index:b,sourceLayerIndex:m}=r,h=t[b].feature;this.addFeature(r,c,b,i.availableImages,n,s,i.brightness),i.featureIndex.insert(h,c,b,m,this.index)}}update(t,i,n,a,l){let o=Object.keys(t).length!==0;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,o?this.stateDependentLayers:this.layers,n,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Tx.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,n,a,l,o,d){for(let s of i)for(let r of s){let c=r.x,b=r.y;if(c<0||c>=tt||b<0||b>=tt)continue;if(o){let W=o.projectTilePoint(c,b,l),p=o.upVector(l,c,b),Z=this.globeExtVertexArray;Jc(Z,W,p),Jc(Z,W,p),Jc(Z,W,p),Jc(Z,W,p)}let m=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),h=m.vertexLength;Xc(this.layoutVertexArray,c,b,-1,-1),Xc(this.layoutVertexArray,c,b,1,-1),Xc(this.layoutVertexArray,c,b,1,1),Xc(this.layoutVertexArray,c,b,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+2,h+3),m.vertexLength+=4,m.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},a,l,d)}}function yg(e,t){for(let i=0;i<e.length;i++)if(vl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(vl(e,t[i]))return!0;return!!Ch(e,t)}function UN(e,t,i){return!!vl(e,t)||!!Th(t,e,i)}function Bg(e,t){if(e.length===1)return Cg(t,e[0]);for(let i=0;i<t.length;i++){let n=t[i];for(let a=0;a<n.length;a++)if(vl(e,n[a]))return!0}for(let i=0;i<e.length;i++)if(Cg(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Ch(e,t[i]))return!0;return!1}function xN(e,t,i){if(e.length>1){if(Ch(e,t))return!0;for(let n=0;n<t.length;n++)if(Th(t[n],e,i))return!0}for(let n=0;n<e.length;n++)if(Th(e[n],t,i))return!0;return!1}function Ch(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){let n=e[i],a=e[i+1];for(let l=0;l<t.length-1;l++)if(NN(n,a,t[l],t[l+1]))return!0}return!1}function NN(e,t,i,n){return dt(e,i,n)!==dt(t,i,n)&&dt(e,t,i)!==dt(e,t,n)}function Th(e,t,i){let n=i*i;if(t.length===1)return e.distSqr(t[0])<n;for(let a=1;a<t.length;a++)if(Mg(e,t[a-1],t[a])<n)return!0;return!1}function Mg(e,t,i){let n=t.distSqr(i);if(n===0)return e.distSqr(t);let a=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(a<0?t:a>1?i:i.sub(t)._mult(a)._add(t))}function Cg(e,t){let i,n,a,l=!1;for(let o=0;o<e.length;o++){i=e[o];for(let d=0,s=i.length-1;d<i.length;s=d++)n=i[d],a=i[s],n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(l=!l)}return l}function vl(e,t){let i=!1;for(let n=0,a=e.length-1;n<e.length;a=n++){let l=e[n],o=e[a];l.y>t.y!=o.y>t.y&&t.x<(o.x-l.x)*(t.y-l.y)/(o.y-l.y)+l.x&&(i=!i)}return i}function Tg(e,t,i,n,a){for(let o of e)if(t<=o.x&&i<=o.y&&n>=o.x&&a>=o.y)return!0;let l=[new H(t,i),new H(t,a),new H(n,a),new H(n,i)];if(e.length>2){for(let o of l)if(vl(e,o))return!0}for(let o=0;o<e.length-1;o++)if(YN(e[o],e[o+1],l))return!0;return!1}function YN(e,t,i){let n=i[0],a=i[2];if(e.x<n.x&&t.x<n.x||e.x>a.x&&t.x>a.x||e.y<n.y&&t.y<n.y||e.y>a.y&&t.y>a.y)return!1;let l=dt(e,t,i[0]);return l!==dt(e,t,i[1])||l!==dt(e,t,i[2])||l!==dt(e,t,i[3])}function Rd(e,t,i,n,a,l){let o=t.y-e.y,d=e.x-t.x;if(l=l||0){let s=o*o+d*d;if(s===0)return!0;let r=Math.sqrt(s);o/=r,d/=r}return!((i.x-e.x)*o+(i.y-e.y)*d-l<0||(n.x-e.x)*o+(n.y-e.y)*d-l<0||(a.x-e.x)*o+(a.y-e.y)*d-l<0)}function kh(e,t,i,n,a,l,o){return!(Rd(e,t,n,a,l,o)||Rd(t,i,n,a,l,o)||Rd(i,e,n,a,l,o)||Rd(n,a,e,t,i,o)||Rd(a,l,e,t,i,o)||Rd(l,n,e,t,i,o))}function Gd(e,t,i){let n=t.paint.get(e).value;return n.kind==="constant"?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function yc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function kg(e,t,i,n,a){if(!t[0]&&!t[1])return e;let l=H.convert(t)._mult(a);i==="viewport"&&l._rotate(-n);let o=[];for(let d=0;d<e.length;d++)o.push(e[d].sub(l));return o}function Sg(e,t,i,n){let a=H.convert(e)._mult(n);return t==="viewport"&&a._rotate(-i),a}kt(Mh,"CircleBucket",{omit:["layers"]});let XN=new Zi({"circle-sort-key":new Et(_.layout_circle["circle-sort-key"]),visibility:new mt(_.layout_circle.visibility)});var JN={paint:new Zi({"circle-radius":new Et(_.paint_circle["circle-radius"]),"circle-color":new Et(_.paint_circle["circle-color"]),"circle-blur":new Et(_.paint_circle["circle-blur"]),"circle-opacity":new Et(_.paint_circle["circle-opacity"]),"circle-translate":new mt(_.paint_circle["circle-translate"]),"circle-translate-anchor":new mt(_.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mt(_.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mt(_.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Et(_.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Et(_.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Et(_.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new mt(_.paint_circle["circle-emissive-strength"])}),layout:XN};let yN=D.create(),BN=(e,t,i,n,a,l)=>{let o=e.transform,d=o.projection.name==="globe",s;if(l.paint.get("circle-pitch-alignment")==="map")if(d){let c=Vg(o.zoom,t.canonical)*o._pixelsPerMercatorPixel;s=Float32Array.from([c,0,0,c])}else s=o.calculatePixelsToTileUnitsMatrix(i);else s=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);let r={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(o.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ee.devicePixelRatio,u_extrude_scale:s,u_inv_rot_matrix:yN,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(d){r.u_inv_rot_matrix=n,r.u_merc_center=a,r.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],r.u_zoom_transition=Di(o.zoom);let c=a[0]*tt,b=a[1]*tt;r.u_up_dir=o.projection.upVector(new ia(0,0,0),c,b)}return r},Qg=e=>{let t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function vg(e,t,i,n,a,l,o,d,s){if(l&&e.queryGeometry.isAboveHorizon)return!1;l&&(s*=e.pixelToTileUnitsFactor);let r=e.tileID.canonical,c=i.projection.upVectorScale(r,i.center.lat,i.worldSize).metersToTile;for(let b of t)for(let m of b){let h=m.add(d),W=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,r);if(W>0){let G=i.projection.upVector(r,h.x,h.y);p.x+=G[0]*c*W,p.y+=G[1]*c*W,p.z+=G[2]*c*W}let Z=l?h:MN(p.x,p.y,p.z,n),g=l?e.tilespaceRays.map(G=>TN(G,W)):e.queryGeometry.screenGeometry,u=Le.transformMat4([],[p.x,p.y,p.z,1],n);if(!o&&l?s*=u[3]/i.cameraToCenterDistance:o&&!l&&(s*=i.cameraToCenterDistance/u[3]),l){let G=Bi((m.y/tt+r.y)/(1<<r.z));s/=i.projection.pixelsPerMeter(G,1)/He(1,G)}if(UN(g,Z,s))return!0}return!1}function MN(e,t,i,n){let a=Le.transformMat4([],[e,t,i,1],n);return new H(a[0]/a[3],a[1]/a[3])}let fg=S.fromValues(0,0,0),CN=S.fromValues(0,0,1);function TN(e,t){let i=S.create();return fg[2]=t,e.intersectsPlane(fg,CN,i),new H(i[0],i[1])}class zg extends Mh{}function Lg(e,{width:t,height:i},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==t*i*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=a,e}function Eg(e,t,i){let{width:n,height:a}=t;n===e.width&&a===e.height||(Sh(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,a)},i),e.width=n,e.height=a,e.data=t.data)}function Sh(e,t,i,n,a,l){if(a.width===0||a.height===0)return t;if(a.width>e.width||a.height>e.height||i.x>e.width-a.width||i.y>e.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||n.x>t.width-a.width||n.y>t.height-a.height)throw new RangeError("out of range destination coordinates for image copy");let o=e.data,d=t.data;for(let s=0;s<a.height;s++){let r=((i.y+s)*e.width+i.x)*l,c=((n.y+s)*t.width+n.x)*l;for(let b=0;b<a.width*l;b++)d[c+b]=o[r+b]}return t}kt(zg,"HeatmapBucket",{omit:["layers"]});class dl{constructor(t,i){Lg(this,t,1,i)}resize(t){Eg(this,new dl(t),1)}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,n,a,l){Sh(t,i,n,a,l,1)}}class Yi{constructor(t,i){Lg(this,t,4,i)}resize(t){Eg(this,new Yi(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Yi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,n,a,l){Sh(t,i,n,a,l,4)}}class Ag{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}kt(dl,"AlphaImage"),kt(Yi,"RGBAImage");let kN=new Zi({visibility:new mt(_.layout_heatmap.visibility)});var SN={paint:new Zi({"heatmap-radius":new Et(_.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Et(_.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mt(_.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ns(_.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mt(_.paint_heatmap["heatmap-opacity"])}),layout:kN};function Bc(e){let t={},i=e.resolution||256,n=e.clips?e.clips.length:1,a=e.image||new Yi({width:i,height:n}),l=(o,d,s)=>{t[e.evaluationKey]=s;let r=e.expression.evaluate(t);r&&(a.data[o+d+0]=Math.floor(255*r.r/r.a),a.data[o+d+1]=Math.floor(255*r.g/r.a),a.data[o+d+2]=Math.floor(255*r.b/r.a),a.data[o+d+3]=Math.floor(255*r.a))};if(e.clips)for(let o=0,d=0;o<n;++o,d+=4*i)for(let s=0,r=0;s<i;s++,r+=4){let c=s/(i-1),{start:b,end:m}=e.clips[o];l(d,r,b*(1-c)+m*c)}else for(let o=0,d=0;o<i;o++,d+=4)l(0,d,o/(i-1));return a}let QN=new Zi({visibility:new mt(_.layout_hillshade.visibility)});var vN={paint:new Zi({"hillshade-illumination-direction":new mt(_.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mt(_.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mt(_.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mt(_.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mt(_.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mt(_.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new mt(_.paint_hillshade["hillshade-emissive-strength"])}),layout:QN};let fN=Ce([{name:"a_pos",components:2,type:"Int16"}],4),{members:zN}=fN;var Qh={exports:{}};function Mc(e,t,i){i=i||2;var n,a,l,o,d,s,r,c=t&&t.length,b=c?t[0]*i:e.length,m=wg(e,0,b,i,!0),h=[];if(!m||m.next===m.prev)return h;if(c&&(m=function(p,Z,g,u){var G,F,R,I=[];for(G=0,F=Z.length;G<F;G++)(R=wg(p,Z[G]*u,G<F-1?Z[G+1]*u:p.length,u,!1))===R.next&&(R.steiner=!0),I.push(DN(R));for(I.sort(jN),G=0;G<I.length;G++)g=HN(I[G],g);return g}(e,t,m,i)),e.length>80*i){n=l=e[0],a=o=e[1];for(var W=i;W<b;W+=i)(d=e[W])<n&&(n=d),(s=e[W+1])<a&&(a=s),d>l&&(l=d),s>o&&(o=s);r=(r=Math.max(l-n,o-a))!==0?32767/r:0}return Qs(m,h,i,n,a,r,0),h}function wg(e,t,i,n,a){var l,o;if(a===zh(e,t,i,n)>0)for(l=t;l<i;l+=n)o=Og(l,e[l],e[l+1],o);else for(l=i-n;l>=t;l-=n)o=Og(l,e[l],e[l+1],o);return o&&Cc(o,o.next)&&(fs(o),o=o.next),o}function Fo(e,t){if(!e)return e;t||(t=e);var i,n=e;do if(i=!1,n.steiner||!Cc(n,n.next)&&vi(n.prev,n,n.next)!==0)n=n.next;else{if(fs(n),(n=t=n.prev)===n.next)break;i=!0}while(i||n!==t);return t}function Qs(e,t,i,n,a,l,o){if(e){!o&&l&&function(c,b,m,h){var W=c;do W.z===0&&(W.z=vh(W.x,W.y,b,m,h)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==c);W.prevZ.nextZ=null,W.prevZ=null,function(p){var Z,g,u,G,F,R,I,N,Y=1;do{for(g=p,p=null,F=null,R=0;g;){for(R++,u=g,I=0,Z=0;Z<Y&&(I++,u=u.nextZ);Z++);for(N=Y;I>0||N>0&&u;)I!==0&&(N===0||!u||g.z<=u.z)?(G=g,g=g.nextZ,I--):(G=u,u=u.nextZ,N--),F?F.nextZ=G:p=G,G.prevZ=F,F=G;g=u}F.nextZ=null,Y*=2}while(R>1)}(W)}(e,n,a,l);for(var d,s,r=e;e.prev!==e.next;)if(d=e.prev,s=e.next,l?EN(e,n,a,l):LN(e))t.push(d.i/i|0),t.push(e.i/i|0),t.push(s.i/i|0),fs(e),e=s.next,r=s.next;else if((e=s)===r){o?o===1?Qs(e=AN(Fo(e),t,i),t,i,n,a,l,2):o===2&&wN(e,t,i,n,a,l):Qs(Fo(e),t,i,n,a,l,1);break}}}function LN(e){var t=e.prev,i=e,n=e.next;if(vi(t,i,n)>=0)return!1;for(var a=t.x,l=i.x,o=n.x,d=t.y,s=i.y,r=n.y,c=a<l?a<o?a:o:l<o?l:o,b=d<s?d<r?d:r:s<r?s:r,m=a>l?a>o?a:o:l>o?l:o,h=d>s?d>r?d:r:s>r?s:r,W=n.next;W!==t;){if(W.x>=c&&W.x<=m&&W.y>=b&&W.y<=h&&Fd(a,d,l,s,o,r,W.x,W.y)&&vi(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function EN(e,t,i,n){var a=e.prev,l=e,o=e.next;if(vi(a,l,o)>=0)return!1;for(var d=a.x,s=l.x,r=o.x,c=a.y,b=l.y,m=o.y,h=d<s?d<r?d:r:s<r?s:r,W=c<b?c<m?c:m:b<m?b:m,p=d>s?d>r?d:r:s>r?s:r,Z=c>b?c>m?c:m:b>m?b:m,g=vh(h,W,t,i,n),u=vh(p,Z,t,i,n),G=e.prevZ,F=e.nextZ;G&&G.z>=g&&F&&F.z<=u;){if(G.x>=h&&G.x<=p&&G.y>=W&&G.y<=Z&&G!==a&&G!==o&&Fd(d,c,s,b,r,m,G.x,G.y)&&vi(G.prev,G,G.next)>=0||(G=G.prevZ,F.x>=h&&F.x<=p&&F.y>=W&&F.y<=Z&&F!==a&&F!==o&&Fd(d,c,s,b,r,m,F.x,F.y)&&vi(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;G&&G.z>=g;){if(G.x>=h&&G.x<=p&&G.y>=W&&G.y<=Z&&G!==a&&G!==o&&Fd(d,c,s,b,r,m,G.x,G.y)&&vi(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;F&&F.z<=u;){if(F.x>=h&&F.x<=p&&F.y>=W&&F.y<=Z&&F!==a&&F!==o&&Fd(d,c,s,b,r,m,F.x,F.y)&&vi(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function AN(e,t,i){var n=e;do{var a=n.prev,l=n.next.next;!Cc(a,l)&&jg(a,n,n.next,l)&&vs(a,l)&&vs(l,a)&&(t.push(a.i/i|0),t.push(n.i/i|0),t.push(l.i/i|0),fs(n),fs(n.next),n=e=l),n=n.next}while(n!==e);return Fo(n)}function wN(e,t,i,n,a,l){var o=e;do{for(var d=o.next.next;d!==o.prev;){if(o.i!==d.i&&_N(o,d)){var s=Hg(o,d);return o=Fo(o,o.next),s=Fo(s,s.next),Qs(o,t,i,n,a,l,0),void Qs(s,t,i,n,a,l,0)}d=d.next}o=o.next}while(o!==e)}function jN(e,t){return e.x-t.x}function HN(e,t){var i=function(a,l){var o,d=l,s=a.x,r=a.y,c=-1/0;do{if(r<=d.y&&r>=d.next.y&&d.next.y!==d.y){var b=d.x+(r-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(b<=s&&b>c&&(c=b,o=d.x<d.next.x?d:d.next,b===s))return o}d=d.next}while(d!==l);if(!o)return null;var m,h=o,W=o.x,p=o.y,Z=1/0;d=o;do s>=d.x&&d.x>=W&&s!==d.x&&Fd(r<p?s:c,r,W,p,r<p?c:s,r,d.x,d.y)&&(m=Math.abs(r-d.y)/(s-d.x),vs(d,a)&&(m<Z||m===Z&&(d.x>o.x||d.x===o.x&&ON(o,d)))&&(o=d,Z=m)),d=d.next;while(d!==h);return o}(e,t);if(!i)return t;var n=Hg(i,e);return Fo(n,n.next),Fo(i,i.next)}function ON(e,t){return vi(e.prev,e,t.prev)<0&&vi(t.next,e,e.next)<0}function vh(e,t,i,n,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function DN(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Fd(e,t,i,n,a,l,o,d){return(a-o)*(t-d)>=(e-o)*(l-d)&&(e-o)*(n-d)>=(i-o)*(t-d)&&(i-o)*(l-d)>=(a-o)*(n-d)}function _N(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,n){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==n.i&&a.next.i!==n.i&&jg(a,a.next,i,n))return!0;a=a.next}while(a!==i);return!1}(e,t)&&(vs(e,t)&&vs(t,e)&&function(i,n){var a=i,l=!1,o=(i.x+n.x)/2,d=(i.y+n.y)/2;do a.y>d!=a.next.y>d&&a.next.y!==a.y&&o<(a.next.x-a.x)*(d-a.y)/(a.next.y-a.y)+a.x&&(l=!l),a=a.next;while(a!==i);return l}(e,t)&&(vi(e.prev,e,t.prev)||vi(e,t.prev,t))||Cc(e,t)&&vi(e.prev,e,e.next)>0&&vi(t.prev,t,t.next)>0)}function vi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Cc(e,t){return e.x===t.x&&e.y===t.y}function jg(e,t,i,n){var a=kc(vi(e,t,i)),l=kc(vi(e,t,n)),o=kc(vi(i,n,e)),d=kc(vi(i,n,t));return a!==l&&o!==d||!(a!==0||!Tc(e,i,t))||!(l!==0||!Tc(e,n,t))||!(o!==0||!Tc(i,e,n))||!(d!==0||!Tc(i,t,n))}function Tc(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function kc(e){return e>0?1:e<0?-1:0}function vs(e,t){return vi(e.prev,e,e.next)<0?vi(e,t,e.next)>=0&&vi(e,e.prev,t)>=0:vi(e,t,e.prev)<0||vi(e,e.next,t)<0}function Hg(e,t){var i=new fh(e.i,e.x,e.y),n=new fh(t.i,t.x,t.y),a=e.next,l=t.prev;return e.next=t,t.prev=e,i.next=a,a.prev=i,n.next=i,i.prev=n,l.next=n,n.prev=l,n}function Og(e,t,i,n){var a=new fh(e,t,i);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function fs(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function fh(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zh(e,t,i,n){for(var a=0,l=t,o=i-n;l<i;l+=n)a+=(e[o]-e[l])*(e[l+1]+e[o+1]),o=l;return a}Qh.exports=Mc,Qh.exports.default=Mc,Mc.deviation=function(e,t,i,n){var a=t&&t.length,l=Math.abs(zh(e,0,a?t[0]*i:e.length,i));if(a)for(var o=0,d=t.length;o<d;o++)l-=Math.abs(zh(e,t[o]*i,o<d-1?t[o+1]*i:e.length,i));var s=0;for(o=0;o<n.length;o+=3){var r=n[o]*i,c=n[o+1]*i,b=n[o+2]*i;s+=Math.abs((e[r]-e[b])*(e[c+1]-e[r+1])-(e[r]-e[c])*(e[b+1]-e[r+1]))}return l===0&&s===0?0:Math.abs((s-l)/l)},Mc.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,a=0;a<e.length;a++){for(var l=0;l<e[a].length;l++)for(var o=0;o<t;o++)i.vertices.push(e[a][l][o]);a>0&&i.holes.push(n+=e[a-1].length)}return i};var Sc=we(Qh.exports);function Lh(e,t){let i=e.length;if(i<=1)return[e];let n=[],a,l;for(let o=0;o<i;o++){let d=ct(e[o]);d!==0&&(e[o].area=Math.abs(d),l===void 0&&(l=d<0),l===d<0?(a&&n.push(a),a=[e[o]]):a.push(e[o]))}if(a&&n.push(a),t>1)for(let o=0;o<n.length;o++)n[o].length<=t||(MU(n[o],t,1,n[o].length-1,KN),n[o]=n[o].slice(0,t));return n}function KN(e,t){return t.area-e.area}function Eh(e,t,i){let n=i.patternDependencies,a=!1;for(let l of t){let o=l.paint.get("".concat(e,"-pattern"));o.isConstant()||(a=!0);let d=o.constantOr(null);d&&(a=!0,n[d]=!0)}return a}function Ah(e,t,i,n,a){let l=a.patternDependencies;for(let o of t){let d=o.paint.get("".concat(e,"-pattern")).value;if(d.kind!=="constant"){let s=d.evaluate({zoom:n},i,{},a.availableImages);s=s&&s.name?s.name:s,l[s]=!0,i.patterns[o.id]=s}}return i}class Qc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mn,this.indexArray=new yi,this.indexArray2=new Xl,this.programConfigurations=new yl(t.layers,t.zoom),this.segments=new ze,this.segments2=new ze,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,n,a){this.hasPattern=Eh("fill",this.layers,i);let l=this.layers[0].layout.get("fill-sort-key"),o=[];for(let{feature:d,id:s,index:r,sourceLayerIndex:c}of t){let b=this.layers[0]._featureFilter.needGeometry,m=Ql(d,b);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),m,n))continue;let h=l?l.evaluate(m,{},n,i.availableImages):void 0,W={id:s,properties:d.properties,type:d.type,sourceLayerIndex:c,index:r,geometry:b?m.geometry:Ta(d,n,a),patterns:{},sortKey:h};o.push(W)}l&&o.sort((d,s)=>d.sortKey-s.sortKey);for(let d of o){let{geometry:s,index:r,sourceLayerIndex:c}=d;if(this.hasPattern){let b=Ah("fill",this.layers,d,this.zoom,i);this.patternFeatures.push(b)}else this.addFeature(d,s,r,n,{},i.availableImages,i.brightness);i.featureIndex.insert(t[r].feature,s,r,c,this.index)}}update(t,i,n,a,l){let o=Object.keys(t).length!==0;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,o?this.stateDependentLayers:this.layers,n,a,l)}addFeatures(t,i,n,a,l,o){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,n,a,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zN),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,n,a,l,o=[],d){for(let s of Lh(i,500)){let r=0;for(let p of s)r+=p.length;let c=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray),b=c.vertexLength,m=[],h=[];for(let p of s){if(p.length===0)continue;p!==s[0]&&h.push(m.length/2);let Z=this.segments2.prepareSegment(p.length,this.layoutVertexArray,this.indexArray2),g=Z.vertexLength;this.layoutVertexArray.emplaceBack(p[0].x,p[0].y),this.indexArray2.emplaceBack(g+p.length-1,g),m.push(p[0].x),m.push(p[0].y);for(let u=1;u<p.length;u++)this.layoutVertexArray.emplaceBack(p[u].x,p[u].y),this.indexArray2.emplaceBack(g+u-1,g+u),m.push(p[u].x),m.push(p[u].y);Z.vertexLength+=p.length,Z.primitiveLength+=p.length}let W=Sc(m,h);for(let p=0;p<W.length;p+=3)this.indexArray.emplaceBack(b+W[p],b+W[p+1],b+W[p+2]);c.vertexLength+=r,c.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,l,o,a,d)}}kt(Qc,"FillBucket",{omit:["layers","patternFeatures"]});let PN=new Zi({"fill-sort-key":new Et(_.layout_fill["fill-sort-key"]),visibility:new mt(_.layout_fill.visibility)});var qN={paint:new Zi({"fill-antialias":new mt(_.paint_fill["fill-antialias"]),"fill-opacity":new Et(_.paint_fill["fill-opacity"]),"fill-color":new Et(_.paint_fill["fill-color"]),"fill-outline-color":new Et(_.paint_fill["fill-outline-color"]),"fill-translate":new mt(_.paint_fill["fill-translate"]),"fill-translate-anchor":new mt(_.paint_fill["fill-translate-anchor"]),"fill-pattern":new Et(_.paint_fill["fill-pattern"]),"fill-emissive-strength":new mt(_.paint_fill["fill-emissive-strength"])}),layout:PN};let $N=Ce([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tY=Ce([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),eY=Ce([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iY=Ce([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),nY=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:aY}=$N;var vc={},lY=Pe,Dg=Id;function Id(e,t,i,n,a){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=a,e.readFields(oY,this,t)}function oY(e,t,i){e==1?t.id=i.readVarint():e==2?function(n,a){for(var l=n.readVarint()+n.pos;n.pos<l;){var o=a._keys[n.readVarint()],d=a._values[n.readVarint()];a.properties[o]=d}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function dY(e){for(var t,i,n=0,a=0,l=e.length,o=l-1;a<l;o=a++)n+=((i=e[o]).x-(t=e[a]).x)*(t.y+i.y);return n}Id.types=["Unknown","Point","LineString","Polygon"],Id.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,a=0,l=0,o=0,d=[];e.pos<i;){if(a<=0){var s=e.readVarint();n=7&s,a=s>>3}if(a--,n===1||n===2)l+=e.readSVarint(),o+=e.readSVarint(),n===1&&(t&&d.push(t),t=[]),t.push(new lY(l,o));else{if(n!==7)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&d.push(t),d},Id.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,n=0,a=0,l=0,o=1/0,d=-1/0,s=1/0,r=-1/0;e.pos<t;){if(n<=0){var c=e.readVarint();i=7&c,n=c>>3}if(n--,i===1||i===2)(a+=e.readSVarint())<o&&(o=a),a>d&&(d=a),(l+=e.readSVarint())<s&&(s=l),l>r&&(r=l);else if(i!==7)throw new Error("unknown command "+i)}return[o,s,d,r]},Id.prototype.toGeoJSON=function(e,t,i){var n,a,l=this.extent*Math.pow(2,i),o=this.extent*e,d=this.extent*t,s=this.loadGeometry(),r=Id.types[this.type];function c(h){for(var W=0;W<h.length;W++){var p=h[W];h[W]=[360*(p.x+o)/l-180,360/Math.PI*Math.atan(Math.exp((180-360*(p.y+d)/l)*Math.PI/180))-90]}}switch(this.type){case 1:var b=[];for(n=0;n<s.length;n++)b[n]=s[n][0];c(s=b);break;case 2:for(n=0;n<s.length;n++)c(s[n]);break;case 3:for(s=function(h){var W=h.length;if(W<=1)return[h];for(var p,Z,g=[],u=0;u<W;u++){var G=dY(h[u]);G!==0&&(Z===void 0&&(Z=G<0),Z===G<0?(p&&g.push(p),p=[h[u]]):p.push(h[u]))}return p&&g.push(p),g}(s),n=0;n<s.length;n++)for(a=0;a<s[n].length;a++)c(s[n][a])}s.length===1?s=s[0]:r="Multi"+r;var m={type:"Feature",geometry:{type:r,coordinates:s},properties:this.properties};return"id"in this&&(m.id=this.id),m};var sY=Dg,_g=Kg;function Kg(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(rY,this,t),this.length=this._features.length}function rY(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(n){for(var a=null,l=n.readVarint()+n.pos;n.pos<l;){var o=n.readVarint()>>3;a=o===1?n.readString():o===2?n.readFloat():o===3?n.readDouble():o===4?n.readVarint64():o===5?n.readVarint():o===6?n.readSVarint():o===7?n.readBoolean():null}return a}(i))}Kg.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new sY(this._pbf,t,this.extent,this._keys,this._values)};var cY=_g;function bY(e,t,i){if(e===3){var n=new cY(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}var wh=vc.VectorTile=function(e,t){this.layers=e.readFields(bY,{},t)},fc=vc.VectorTileFeature=Dg;function zc(e,t,i,n){let a=[],l=n===0?(o,d,s,r,c,b)=>{o.push(new H(b,s+(b-d)/(r-d)*(c-s)))}:(o,d,s,r,c,b)=>{o.push(new H(d+(b-s)/(c-s)*(r-d),b))};for(let o of e){let d=[];for(let s of o){if(s.length<=2)continue;let r=[];for(let m=0;m<s.length-1;m++){let h=s[m].x,W=s[m].y,p=s[m+1].x,Z=s[m+1].y,g=n===0?h:W,u=n===0?p:Z;g<t?u>t&&l(r,h,W,p,Z,t):g>i?u<i&&l(r,h,W,p,Z,i):r.push(s[m]),u<t&&g>=t&&l(r,h,W,p,Z,t),u>i&&g<=i&&l(r,h,W,p,Z,i)}let c=s[s.length-1],b=n===0?c.x:c.y;b>=t&&b<=i&&r.push(c),r.length&&(c=r[r.length-1],r[0].x===c.x&&r[0].y===c.y||r.push(r[0]),d.push(r))}d.length&&a.push(d)}return a}vc.VectorTileLayer=_g;class Pg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let n=t[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var mY={read:function(e,t,i,n,a){var l,o,d=8*a-n-1,s=(1<<d)-1,r=s>>1,c=-7,b=i?a-1:0,m=i?-1:1,h=e[t+b];for(b+=m,l=h&(1<<-c)-1,h>>=-c,c+=d;c>0;l=256*l+e[t+b],b+=m,c-=8);for(o=l&(1<<-c)-1,l>>=-c,c+=n;c>0;o=256*o+e[t+b],b+=m,c-=8);if(l===0)l=1-r;else{if(l===s)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,n),l-=r}return(h?-1:1)*o*Math.pow(2,l-n)},write:function(e,t,i,n,a,l){var o,d,s,r=8*l-a-1,c=(1<<r)-1,b=c>>1,m=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:l-1,W=n?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(d=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-o))<1&&(o--,s*=2),(t+=o+b>=1?m/s:m*Math.pow(2,1-b))*s>=2&&(o++,s/=2),o+b>=c?(d=0,o=c):o+b>=1?(d=(t*s-1)*Math.pow(2,a),o+=b):(d=t*Math.pow(2,b-1)*Math.pow(2,a),o=0));a>=8;e[i+h]=255&d,h+=W,d/=256,a-=8);for(o=o<<a|d,r+=a;r>0;e[i+h]=255&o,h+=W,o/=256,r-=8);e[i+h-W]|=128*p}},qg=oi,Lc=mY;function oi(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}oi.Varint=0,oi.Fixed64=1,oi.Bytes=2,oi.Fixed32=5;var jh=4294967296,$g=1/jh,tu=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function sl(e){return e.type===oi.Bytes?e.readVarint()+e.pos:e.pos+1}function Ud(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function eu(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var a=i.pos-1;a>=e;a--)i.buf[a+n]=i.buf[a]}function hY(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function WY(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function pY(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function ZY(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function VY(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function gY(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function uY(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function RY(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function GY(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Ec(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function xd(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function iu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}oi.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),a=n>>3,l=this.pos;this.type=7&n,e(a,t,this),this.pos===l&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ec(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=iu(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ec(this.buf,this.pos)+Ec(this.buf,this.pos+4)*jh;return this.pos+=8,e},readSFixed64:function(){var e=Ec(this.buf,this.pos)+iu(this.buf,this.pos+4)*jh;return this.pos+=8,e},readFloat:function(){var e=Lc.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Lc.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(a,l,o){var d,s,r=o.buf;if(d=(112&(s=r[o.pos++]))>>4,s<128||(d|=(127&(s=r[o.pos++]))<<3,s<128)||(d|=(127&(s=r[o.pos++]))<<10,s<128)||(d|=(127&(s=r[o.pos++]))<<17,s<128)||(d|=(127&(s=r[o.pos++]))<<24,s<128)||(d|=(1&(s=r[o.pos++]))<<31,s<128))return Ud(a,d,l);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&tu?function(i,n,a){return tu.decode(i.subarray(n,a))}(this.buf,t,e):function(i,n,a){for(var l="",o=n;o<a;){var d,s,r,c=i[o],b=null,m=c>239?4:c>223?3:c>191?2:1;if(o+m>a)break;m===1?c<128&&(b=c):m===2?(192&(d=i[o+1]))==128&&(b=(31&c)<<6|63&d)<=127&&(b=null):m===3?(s=i[o+2],(192&(d=i[o+1]))==128&&(192&s)==128&&((b=(15&c)<<12|(63&d)<<6|63&s)<=2047||b>=55296&&b<=57343)&&(b=null)):m===4&&(s=i[o+2],r=i[o+3],(192&(d=i[o+1]))==128&&(192&s)==128&&(192&r)==128&&((b=(15&c)<<18|(63&d)<<12|(63&s)<<6|63&r)<=65535||b>=1114112)&&(b=null)),b===null?(b=65533,m=1):b>65535&&(b-=65536,l+=String.fromCharCode(b>>>10&1023|55296),b=56320|1023&b),l+=String.fromCharCode(b),o+=m}return l}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==oi.Bytes)return e.push(this.readVarint(t));var i=sl(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==oi.Bytes)return e.push(this.readSVarint());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==oi.Bytes)return e.push(this.readBoolean());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==oi.Bytes)return e.push(this.readFloat());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==oi.Bytes)return e.push(this.readDouble());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==oi.Bytes)return e.push(this.readFixed32());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==oi.Bytes)return e.push(this.readSFixed32());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==oi.Bytes)return e.push(this.readFixed64());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==oi.Bytes)return e.push(this.readSFixed64());var t=sl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===oi.Varint)for(;this.buf[this.pos++]>127;);else if(t===oi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===oi.Fixed32)this.pos+=4;else{if(t!==oi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),xd(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),xd(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),xd(this.buf,-1&e,this.pos),xd(this.buf,Math.floor(e*$g),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),xd(this.buf,-1&e,this.pos),xd(this.buf,Math.floor(e*$g),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var n,a;if(t>=0?(n=t%4294967296|0,a=t/4294967296|0):(a=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,a=a+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(l,o,d){d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,l>>>=7,d.buf[d.pos++]=127&l|128,d.buf[d.pos]=127&(l>>>=7)}(n,0,i),function(l,o){var d=(7&l)<<4;o.buf[o.pos++]|=d|((l>>>=3)?128:0),l&&(o.buf[o.pos++]=127&l|((l>>>=7)?128:0),l&&(o.buf[o.pos++]=127&l|((l>>>=7)?128:0),l&&(o.buf[o.pos++]=127&l|((l>>>=7)?128:0),l&&(o.buf[o.pos++]=127&l|((l>>>=7)?128:0),l&&(o.buf[o.pos++]=127&l)))))}(a,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(n,a,l){for(var o,d,s=0;s<a.length;s++){if((o=a.charCodeAt(s))>55295&&o<57344){if(!d){o>56319||s+1===a.length?(n[l++]=239,n[l++]=191,n[l++]=189):d=o;continue}if(o<56320){n[l++]=239,n[l++]=191,n[l++]=189,d=o;continue}o=d-55296<<10|o-56320|65536,d=null}else d&&(n[l++]=239,n[l++]=191,n[l++]=189,d=null);o<128?n[l++]=o:(o<2048?n[l++]=o>>6|192:(o<65536?n[l++]=o>>12|224:(n[l++]=o>>18|240,n[l++]=o>>12&63|128),n[l++]=o>>6&63|128),n[l++]=63&o|128)}return l}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&eu(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Lc.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Lc.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&eu(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,oi.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,hY,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,WY,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,VY,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,pY,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ZY,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,gY,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,uY,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,RY,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,GY,t)},writeBytesField:function(e,t){this.writeTag(e,oi.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,oi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,oi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,oi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,oi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,oi.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,oi.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,oi.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,oi.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,oi.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var Ac=we(qg);let FY=["tile","layer","source","sourceLayer","state"];class nu{constructor(t,i,n,a,l){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=n,this._y=a,this.properties=t.properties,this.id=l}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(let i of FY)this[i]!==void 0&&(t[i]=this[i]);return t}}class IY{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,n){let a=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][a]=this.stateChanges[t][a]||{},Xt(this.stateChanges[t][a],n),this.deletedStates[t]===null){this.deletedStates[t]={};for(let l in this.state[t])l!==a&&(this.deletedStates[t][l]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][a]===null){this.deletedStates[t][a]={};for(let l in this.state[t][a])n[l]||(this.deletedStates[t][a][l]=null)}else for(let l in n)this.deletedStates[t]&&this.deletedStates[t][a]&&this.deletedStates[t][a][l]===null&&delete this.deletedStates[t][a][l]}removeFeatureState(t,i,n){if(this.deletedStates[t]===null)return;let a=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&i!==void 0)this.deletedStates[t][a]!==null&&(this.deletedStates[t][a]=this.deletedStates[t][a]||{},this.deletedStates[t][a][n]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][a])for(n in this.deletedStates[t][a]={},this.stateChanges[t][a])this.deletedStates[t][a][n]=null;else this.deletedStates[t][a]=null;else this.deletedStates[t]=null}getState(t,i){let n=String(i),a=Xt({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){let l=this.deletedStates[t][i];if(l===null)return{};for(let o in l)delete a[o]}return a}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){let n={};for(let a in this.stateChanges){this.state[a]=this.state[a]||{};let l={};for(let o in this.stateChanges[a])this.state[a][o]||(this.state[a][o]={}),Xt(this.state[a][o],this.stateChanges[a][o]),l[o]=this.state[a][o];n[a]=l}for(let a in this.deletedStates){this.state[a]=this.state[a]||{};let l={};if(this.deletedStates[a]===null)for(let o in this.state[a])l[o]={},this.state[a][o]={};else for(let o in this.deletedStates[a]){if(this.deletedStates[a][o]===null)this.state[a][o]={};else if(this.state[a][o])for(let d of Object.keys(this.deletedStates[a][o]))delete this.state[a][o][d];l[o]=this.state[a][o]}n[a]=n[a]||{},Xt(n[a],l)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(let a in t)t[a].setFeatureState(n,i)}}class au{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){let n=this.toIdx(t,i);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function lu(e,t,i,n){let a=0,l=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(i[o]<e[o]||i[o]>t[o])return null}else{let d=1/n[o],s=(e[o]-i[o])*d,r=(t[o]-i[o])*d;if(s>r){let c=s;s=r,r=c}if(s>a&&(a=s),r<l&&(l=r),a>l)return null}return a}function ou(e,t,i,n,a,l,o,d,s,r,c){let b=n-e,m=a-t,h=l-i,W=o-e,p=d-t,Z=s-i,g=c[1]*Z-c[2]*p,u=c[2]*W-c[0]*Z,G=c[0]*p-c[1]*W,F=b*g+m*u+h*G;if(Math.abs(F)<1e-15)return null;let R=1/F,I=r[0]-e,N=r[1]-t,Y=r[2]-i,X=(I*g+N*u+Y*G)*R;if(X<0||X>1)return null;let J=N*h-Y*m,B=Y*b-I*h,C=I*m-N*b,Q=(c[0]*J+c[1]*B+c[2]*C)*R;return Q<0||X+Q>1?null:(W*J+p*B+Z*C)*R}function du(e,t,i){return(e-t)/(i-t)}function su(e,t,i,n,a,l,o,d,s){let r=1<<i,c=l-n,b=o-a,m=(e+1)/r*c+n,h=(t+0)/r*b+a,W=(t+1)/r*b+a;d[0]=(e+0)/r*c+n,d[1]=h,s[0]=m,s[1]=W}class ru{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(l){let o=Math.ceil(Math.log2(l.dim/8)),d=[],s=Math.ceil(Math.pow(2,o)),r=1/s,c=(h,W,p,Z,g)=>{let u=Z?1:0,G=(h+1)*p-u,F=W*p,R=(W+1)*p-u;g[0]=h*p,g[1]=F,g[2]=G,g[3]=R},b=new au(s),m=[];for(let h=0;h<s*s;h++){c(h%s,Math.floor(h/s),r,!1,m);let W=fl(m[0],m[1],l),p=fl(m[2],m[1],l),Z=fl(m[2],m[3],l),g=fl(m[0],m[3],l);b.minimums.push(Math.min(W,p,Z,g)),b.maximums.push(Math.max(W,p,Z,g)),b.leaves.push(1)}for(d.push(b),s/=2;s>=1;s/=2){let h=d[d.length-1];b=new au(s);for(let W=0;W<s*s;W++){c(W%s,Math.floor(W/s),2,!0,m);let p=h.getElevation(m[0],m[1]),Z=h.getElevation(m[2],m[1]),g=h.getElevation(m[2],m[3]),u=h.getElevation(m[0],m[3]),G=h.isLeaf(m[0],m[1]),F=h.isLeaf(m[2],m[1]),R=h.isLeaf(m[2],m[3]),I=h.isLeaf(m[0],m[3]),N=Math.min(p.min,Z.min,g.min,u.min),Y=Math.max(p.max,Z.max,g.max,u.max),X=G&&F&&R&&I;b.maximums.push(Y),b.minimums.push(N),b.leaves.push(Y-N<=5&&X?1:0)}d.push(b)}return d}(this.dem),n=i.length-1,a=i[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,n,0)}raycastRoot(t,i,n,a,l,o,d=1){return lu([t,i,-100],[n,a,this.maximums[0]*d],l,o)}raycast(t,i,n,a,l,o,d=1){if(!this.nodeCount)return null;let s=this.raycastRoot(t,i,n,a,l,o,d);if(s==null)return null;let r=[],c=[],b=[],m=[],h=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;h.length>0;){let{idx:W,t:p,nodex:Z,nodey:g,depth:u}=h.pop();if(this.leaves[W]){su(Z,g,u,t,i,n,a,b,m);let F=1<<u,R=(Z+0)/F,I=(Z+1)/F,N=(g+0)/F,Y=(g+1)/F,X=fl(R,N,this.dem)*d,J=fl(I,N,this.dem)*d,B=fl(I,Y,this.dem)*d,C=fl(R,Y,this.dem)*d,Q=ou(b[0],b[1],X,m[0],b[1],J,m[0],m[1],B,l,o),y=ou(m[0],m[1],B,b[0],m[1],C,b[0],b[1],X,l,o),z=Math.min(Q!==null?Q:Number.MAX_VALUE,y!==null?y:Number.MAX_VALUE);if(z!==Number.MAX_VALUE)return z;{let E=S.scaleAndAdd([],l,o,p);if(cu(X,J,C,B,du(E[0],b[0],m[0]),du(E[1],b[1],m[1]))>=E[2])return p}continue}let G=0;for(let F=0;F<this._siblingOffset.length;F++){su((Z<<1)+this._siblingOffset[F][0],(g<<1)+this._siblingOffset[F][1],u+1,t,i,n,a,b,m),b[2]=-100,m[2]=this.maximums[this.childOffsets[W]+F]*d;let R=lu(b,m,l,o);if(R!=null){let I=R;r[F]=I;let N=!1;for(let Y=0;Y<G&&!N;Y++)I>=r[c[Y]]&&(c.splice(Y,0,F),N=!0);N||(c[G]=F),G++}}for(let F=0;F<G;F++){let R=c[F];h.push({idx:this.childOffsets[W]+R,t:r[R],nodex:(Z<<1)+this._siblingOffset[R][0],nodey:(g<<1)+this._siblingOffset[R][1],depth:u+1})}}return null}_addNode(t,i,n){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,n,a,l){if(t[a].isLeaf(i,n)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);let o=a-1,d=t[o],s=0,r=0;for(let c=0;c<this._siblingOffset.length;c++){let b=2*i+this._siblingOffset[c][0],m=2*n+this._siblingOffset[c][1],h=d.getElevation(b,m),W=d.isLeaf(b,m),p=this._addNode(h.min,h.max,W);W&&(s|=1<<c),r||(r=p)}for(let c=0;c<this._siblingOffset.length;c++)s&1<<c||this._construct(t,2*i+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],o,r+c)}}function cu(e,t,i,n,a,l){return Pt(Pt(e,i,l),Pt(t,n,l),a)}function fl(e,t,i){let n=i.dim,a=Mt(e*n-.5,0,n-1),l=Mt(t*n-.5,0,n-1),o=Math.floor(a),d=Math.floor(l),s=Math.min(o+1,n-1),r=Math.min(d+1,n-1);return cu(i.get(o,d),i.get(s,d),i.get(o,r),i.get(s,r),a-o,l-d)}let UY={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function xY(e,t,i){return(256*e*256+256*t+i)/10-1e4}function NY(e,t,i){return 256*e+t+i/256-32768}class wc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,n,a=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return A('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=i.height;let l=this.dim=i.height-2,o=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let s=0;s<l;s++)o[this._idx(-1,s)]=o[this._idx(0,s)],o[this._idx(l,s)]=o[this._idx(l-1,s)],o[this._idx(s,-1)]=o[this._idx(s,0)],o[this._idx(s,l)]=o[this._idx(s,l-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(l,-1)]=o[this._idx(l-1,0)],o[this._idx(-1,l)]=o[this._idx(0,l-1)],o[this._idx(l,l)]=o[this._idx(l-1,l-1)]}let d=n==="terrarium"?NY:xY;for(let s=0;s<o.length;++s){let r=4*s;this.floatView[s]=d(this.pixels[r],this.pixels[r+1],this.pixels[r+2])}this._timestamp=ee.now()}_buildQuadTree(){this._tree=new ru(this)}get(t,i,n=!1){n&&(t=Mt(t,-1,this.dim),i=Mt(i,-1,this.dim));let a=this._idx(t,i);return this.floatView[a]}set(t,i,n){let a=this._idx(t,i),l=this.floatView[a];return this.floatView[a]=n,n-l}static getUnpackVector(t){return UY[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){let n=[0,0,0,0],a=wc.getUnpackVector(i),l=Math.floor((t+a[3])/a[2]);return n[2]=l%256,l=Math.floor(l/256),n[1]=l%256,l=Math.floor(l/256),n[0]=l,n}getPixels(){return new Ag({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,l=i*this.dim+this.dim,o=n*this.dim,d=n*this.dim+this.dim;switch(i){case-1:a=l-1;break;case 1:l=a+1}switch(n){case-1:o=d-1;break;case 1:d=o+1}let s=-i*this.dim,r=-n*this.dim;for(let c=o;c<d;c++)for(let b=a;b<l;b++){let m=4*this._idx(b,c),h=4*this._idx(b+s,c+r);this.pixels[m+0]=t.pixels[h+0],this.pixels[m+1]=t.pixels[h+1],this.pixels[m+2]=t.pixels[h+2],this.pixels[m+3]=t.pixels[h+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}kt(wc,"DEMData"),kt(ru,"DemMinMaxQuadTree",{omit:["dem"]});class YY{isDataAvailableAtPoint(t){let i=this._source();if(this.isUsingMockSource()||!i||t.y<0||t.y>1)return!1;let n=i.getSource().maxzoom,a=1<<n,l=Math.floor(t.x),o=Math.floor((t.x-l)*a),d=Math.floor(t.y*a),s=this.findDEMTileFor(new Xe(n,l,n,o,d));return!(!s||!s.dem)}getAtPointOrZero(t,i=0){return this.getAtPoint(t,i)||0}getAtPoint(t,i,n=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);let a=this._source();if(!a||t.y<0||t.y>1)return i;let l=a.getSource().maxzoom,o=1<<l,d=Math.floor(t.x),s=t.x-d,r=new Xe(l,d,l,Math.floor(s*o),Math.floor(t.y*o)),c=this.findDEMTileFor(r);if(!c||!c.dem)return i;let b=c.dem,m=1<<c.tileID.canonical.z,h=(s*m-c.tileID.canonical.x)*b.dim,W=(t.y*m-c.tileID.canonical.y)*b.dim,p=Math.floor(h),Z=Math.floor(W);return(n?this.exaggeration():1)*Pt(Pt(b.get(p,Z),b.get(p,Z+1),W-Z),Pt(b.get(p+1,Z),b.get(p+1,Z+1),W-Z),h-p)}getAtTileOffset(t,i,n){let a=1<<t.canonical.z;return this.getAtPointOrZero(new Re(t.wrap+(t.canonical.x+i/tt)/a,(t.canonical.y+n/tt)/a))}getAtTileOffsetFunc(t,i,n,a){return l=>{let o=this.getAtTileOffset(t,l.x,l.y),d=a.upVector(t.canonical,l.x,l.y),s=a.upVectorScale(t.canonical,i,n).metersToTile;return S.scale(d,d,o*s),d}}getForTilePoints(t,i,n,a){if(this.isUsingMockSource())return!1;let l=Nd.create(this,t,a);return!!l&&(i.forEach(o=>{o[2]=this.exaggeration()*l.getElevationAt(o[0],o[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let i=this.findDEMTileFor(t);if(!i||!i.dem)return null;let n=i.dem.tree,a=i.tileID,l=1<<t.canonical.z-a.canonical.z,o=t.canonical.x/l-a.canonical.x,d=t.canonical.y/l-a.canonical.y,s=0;for(let r=0;r<t.canonical.z-a.canonical.z&&!n.leaves[s];r++){o*=2,d*=2;let c=2*Math.floor(d)+Math.floor(o);s=n.childOffsets[s]+c,o%=1,d%=1}return{min:this.exaggeration()*n.minimums[s],max:this.exaggeration()*n.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,i,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let i=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let l of t){let o=this.getMinMaxForTile(l.tileID);o&&(n=Math.min(n,o.min),a=Math.max(a,o.max),i=!0)}return i?{min:n,max:a}:null}}class Nd{constructor(t,i,n){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=n}static create(t,i,n){let a=n||t.findDEMTileFor(i);if(!a||!a.dem)return;let l=a.dem,o=a.tileID,d=1<<i.canonical.z-o.canonical.z;return new Nd(a,l.dim/tt/d,[(i.canonical.x/d-o.canonical.x)*l.dim,(i.canonical.y/d-o.canonical.y)*l.dim])}tileCoordToPixel(t,i){let n=i*this._scale+this._offset[1],a=Math.floor(t*this._scale+this._offset[0]),l=Math.floor(n);return new H(a,l)}getElevationAt(t,i,n,a){let l=t*this._scale+this._offset[0],o=i*this._scale+this._offset[1],d=Math.floor(l),s=Math.floor(o),r=this._dem;return a=!!a,n?Pt(Pt(r.get(d,s,a),r.get(d,s+1,a),o-s),Pt(r.get(d+1,s,a),r.get(d+1,s+1,a),o-s),l-d):r.get(d,s,a)}getElevationAtPixel(t,i,n){return this._dem.get(t,i,!!n)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*He(1,t)*this._dem.stride}}class Hh{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new cd(tt,16,0),this.featureIndexArray=new zZ,this.promoteId=i}insert(t,i,n,a,l,o=0){let d=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,l,o);let s=this.grid;for(let r=0;r<i.length;r++){let c=i[r],b=[1/0,1/0,-1/0,-1/0];for(let m=0;m<c.length;m++){let h=c[m];b[0]=Math.min(b[0],h.x),b[1]=Math.min(b[1],h.y),b[2]=Math.max(b[2],h.x),b[3]=Math.max(b[3],h.y)}b[0]<tt&&b[1]<tt&&b[2]>=0&&b[3]>=0&&s.insert(d,b[0],b[1],b[2],b[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wh(new Ac(this.rawTileData)).layers,this.sourceLayerCoder=new Pg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,n,a){this.loadVTLayers();let l=t.params||{},o=ic(l.filter),d=t.tileResult,s=t.transform,r=d.bufferedTilespaceBounds,c=this.grid.query(r.min.x,r.min.y,r.max.x,r.max.y,(W,p,Z,g)=>Tg(d.bufferedTilespaceGeometry,W,p,Z,g));c.sort(XY);let b=null;s.elevation&&c.length>0&&(b=Nd.create(s.elevation,this.tileID));let m={},h;for(let W=0;W<c.length;W++){let p=c[W];if(p===h)continue;h=p;let Z=this.featureIndexArray.get(p),g=null;this.loadMatchingFeature(m,Z,o,l.layers,l.availableImages,i,n,a,(u,G,F,R=0)=>(g||(g=Ta(u,this.tileID.canonical,t.tileTransform)),G.queryIntersectsFeature(d,u,F,g,this.z,t.transform,t.pixelPosMatrix,b,R)))}return m}loadMatchingFeature(t,i,n,a,l,o,d,s,r){let{featureIndex:c,bucketIndex:b,sourceLayerIndex:m,layoutVertexArrayOffset:h}=i,W=this.bucketLayerIDs[b];if(a&&!function(u,G){for(let F=0;F<u.length;F++)if(G.indexOf(u[F])>=0)return!0;return!1}(a,W))return;let p=this.sourceLayerCoder.decode(m),Z=this.vtLayers[p].feature(c);if(n.needGeometry){let u=Ql(Z,!0);if(!n.filter(new si(this.tileID.overscaledZ),u,this.tileID.canonical))return}else if(!n.filter(new si(this.tileID.overscaledZ),Z))return;let g=this.getId(Z,p);for(let u=0;u<W.length;u++){let G=W[u];if(a&&a.indexOf(G)<0)continue;let F=o[G];if(!F)continue;let R={};g!==void 0&&s&&(R=s.getState(F.sourceLayer||"_geojsonTileLayer",g));let I=Xt({},d[G]);I.paint=bu(I.paint,F.paint,Z,R,l),I.layout=bu(I.layout,F.layout,Z,R,l);let N=!r||r(Z,F,R,h);if(!N)continue;let Y=new nu(Z,this.z,this.x,this.y,g);Y.layer=I;let X=t[G];X===void 0&&(X=t[G]=[]),X.push({featureIndex:c,feature:Y,intersectionZ:N})}}lookupSymbolFeatures(t,i,n,a,l,o,d,s){let r={};this.loadVTLayers();let c=ic(l);for(let b of t)this.loadMatchingFeature(r,{bucketIndex:n,sourceLayerIndex:a,featureIndex:b,layoutVertexArrayOffset:0},c,o,d,s,i);return r}loadFeature(t){let{featureIndex:i,sourceLayerIndex:n}=t;this.loadVTLayers();let a=this.sourceLayerCoder.decode(n),l=this.vtFeatures[a];if(l[i])return l[i];let o=this.vtLayers[a].feature(i);return l[i]=o,o}hasLayer(t){for(let i of this.bucketLayerIDs)for(let n of i)if(t===n)return!0;return!1}getId(t,i){let n=t.id;if(this.promoteId){let a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(n=t.properties[a]),typeof n=="boolean"&&(n=Number(n))}return n}}function bu(e,t,i,n,a){return ja(e,(l,o)=>{let d=t instanceof xs?t.get(o):null;return d&&d.evaluate?d.evaluate(i,n,a):d})}function XY(e,t){return t-e}kt(Hh,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let JY=Ce([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yY=Ce([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),BY=Ce([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ce([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let MY=Ce([{name:"a_z_offset",components:1,type:"Float32"}],4),CY=Ce([{name:"a_texb",components:2,type:"Uint16"}]),TY=Ce([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),kY=Ce([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let mu=Ce([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),SY=Ce([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ce([{name:"triangle",components:3,type:"Uint16"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ce([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ce([{type:"Float32",name:"offsetX"}]),Ce([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _i=24;let Ra=128;function Oh(e,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new si(e+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:n,interpolationType:a}=i,l=0;for(;l<n.length&&n[l]<=e;)l++;l=Math.max(0,l-1);let o=l;for(;o<n.length&&n[o]<e+1;)o++;o=Math.min(n.length-1,o);let d=n[l],s=n[o];return i.kind==="composite"?{kind:"composite",minZoom:d,maxZoom:s,interpolationType:a}:{kind:"camera",minZoom:d,maxZoom:s,minSize:i.evaluate(new si(d)),maxSize:i.evaluate(new si(s)),interpolationType:a}}}function zs(e,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:a}){return e.kind==="source"?n/Ra:e.kind==="composite"?Pt(n/Ra,a/Ra,i):t}function ka(e,t){let i=0,n=0;if(e.kind==="constant")n=e.layoutSize;else if(e.kind!=="source"){let{interpolationType:a,minZoom:l,maxZoom:o}=e,d=a?Mt(ya.interpolationFactor(a,t,l,o),0,1):0;e.kind==="camera"?n=Pt(e.minSize,e.maxSize,d):i=d}return{uSizeT:i,uSize:n}}var QY=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ra,evaluateSizeForFeature:zs,evaluateSizeForZoom:ka,getSizeData:Oh});function vY(e,t,i){return e.sections.forEach(n=>{n.text=function(a,l,o){let d=l.layout.get("text-transform").evaluate(o,{});return d==="uppercase"?a=a.toLocaleUpperCase():d==="lowercase"&&(a=a.toLocaleLowerCase()),ta.applyArabicShaping&&(a=ta.applyArabicShaping(a)),a}(n.text,t,i)}),e}let Ls={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function fY(e){return e==="\uFE36"||e==="\uFE48"||e==="\uFE38"||e==="\uFE44"||e==="\uFE42"||e==="\uFE3E"||e==="\uFE3C"||e==="\uFE3A"||e==="\uFE18"||e==="\uFE40"||e==="\uFE10"||e==="\uFE13"||e==="\uFE14"||e==="\uFF40"||e==="\uFFE3"||e==="\uFE11"||e==="\uFE12"}function zY(e){return e==="\uFE35"||e==="\uFE47"||e==="\uFE37"||e==="\uFE43"||e==="\uFE41"||e==="\uFE3D"||e==="\uFE3B"||e==="\uFE39"||e==="\uFE17"||e==="\uFE3F"}let Dh=3;function LY(e,t,i){t.glyphs=[],e===1&&i.readMessage(EY,t)}function EY(e,t,i){if(e===3){let{id:n,bitmap:a,width:l,height:o,left:d,top:s,advance:r}=i.readMessage(AY,{});t.glyphs.push({id:n,bitmap:new dl({width:l+2*Dh,height:o+2*Dh},a),metrics:{width:l,height:o,left:d,top:s,advance:r}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function AY(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}let hu=Dh,di={horizontal:1,vertical:2,horizontalOnly:3},Wu=-17;class Es{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){let n=new Es;return n.scale=t||1,n.fontStack=i,n}static forImage(t){let i=new Es;return i.imageName=t,i}}class Yd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){let n=new Yd;for(let a=0;a<t.sections.length;a++){let l=t.sections[a];l.image?n.addImageSection(l):n.addTextSection(l,i)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,n){let a="";for(let l=0;l<i.length;l++){let o=i.charCodeAt(l+1)||null,d=i.charCodeAt(l-1)||null;a+=!n&&(o&&IZ(o)&&!Ls[i[l+1]]||d&&IZ(d)&&!Ls[i[l-1]])||!Ls[i[l]]?i[l]:Ls[i[l]]}return a}(this.text,t)}trim(){let t=0;for(let n=0;n<this.text.length&&jc[this.text.charCodeAt(n)];n++)t++;let i=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&jc[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){let n=new Yd;return n.text=this.text.substring(t,i),n.sectionIndex=this.sectionIndex.slice(t,i),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Es.forText(t.scale,t.fontStack||i));let n=this.sections.length-1;for(let a=0;a<t.text.length;++a)this.sectionIndex.push(n)}addImageSection(t){let i=t.image?t.image.namePrimary:"";if(i.length===0)return void A("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Es.forImage(i)),this.sectionIndex.push(this.sections.length-1)):A("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _h(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W){let p=Yd.fromFeature(e,a);b===di.vertical&&p.verticalizePunctuation(m);let Z=[],g=function(I,N,Y,X,J,B){if(!I)return[];let C=[],Q=function(O,f,L,K,q,P){let et=0;for(let it=0;it<O.length();it++){let at=O.getSection(it);et+=pu(O.getCodePoint(it),at,K,q,f,P)}return et/Math.max(1,Math.ceil(et/L))}(I,N,Y,X,J,B),y=I.text.indexOf("\u200B")>=0,z=0;for(let O=0;O<I.length();O++){let f=I.getSection(O),L=I.getCodePoint(O);if(jc[L]||(z+=pu(L,f,X,J,N,B)),O<I.length()-1){let K=!((E=L)<11904||!(vt["Bopomofo Extended"](E)||vt.Bopomofo(E)||vt["CJK Compatibility Forms"](E)||vt["CJK Compatibility Ideographs"](E)||vt["CJK Compatibility"](E)||vt["CJK Radicals Supplement"](E)||vt["CJK Strokes"](E)||vt["CJK Symbols and Punctuation"](E)||vt["CJK Unified Ideographs Extension A"](E)||vt["CJK Unified Ideographs"](E)||vt["Enclosed CJK Letters and Months"](E)||vt["Halfwidth and Fullwidth Forms"](E)||vt.Hiragana(E)||vt["Ideographic Description Characters"](E)||vt["Kangxi Radicals"](E)||vt["Katakana Phonetic Extensions"](E)||vt.Katakana(E)||vt["Vertical Forms"](E)||vt["Yi Radicals"](E)||vt["Yi Syllables"](E)));(wY[L]||K||f.imageName)&&C.push(Vu(O+1,z,Q,C,jY(L,I.getCodePoint(O+1),K&&y),!1))}}var E;return gu(Vu(I.length(),z,Q,C,0,!0))}(p,r,l,t,n,h),{processBidirectionalText:u,processStyledBidirectionalText:G}=ta;if(u&&p.sections.length===1){let I=u(p.toString(),g);for(let N of I){let Y=new Yd;Y.text=N,Y.sections=p.sections;for(let X=0;X<N.length;X++)Y.sectionIndex.push(0);Z.push(Y)}}else if(G){let I=G(p.text,p.sectionIndex,g);for(let N of I){let Y=new Yd;Y.text=N[0],Y.sectionIndex=N[1],Y.sections=p.sections,Z.push(Y)}}else Z=function(I,N){let Y=[],X=I.text,J=0;for(let B of N)Y.push(I.substring(J,B)),J=B;return J<X.length&&Y.push(I.substring(J,X.length)),Y}(p,g);let F=[],R={positionedLines:F,text:p.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:b,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(I,N,Y,X,J,B,C,Q,y,z,E,O){let f=0,L=0,K=0,q=Q==="right"?1:Q==="left"?0:.5,P=!1;for(let Rt of J){let Gt=Rt.getSections();for(let Yt of Gt){if(Yt.imageName)continue;let Bt=N[Yt.fontStack];if(Bt&&(P=Bt.ascender!==void 0&&Bt.descender!==void 0,!P))break}if(!P)break}let et=0;for(let Rt of J){Rt.trim();let Gt=Rt.getMaxScale(),Yt=(Gt-1)*_i,Bt={positionedGlyphs:[],lineOffset:0};I.positionedLines[et]=Bt;let Dt=Bt.positionedGlyphs,ft=0;if(!Rt.length()){L+=B,++et;continue}let xe=0,pe=0;for(let jt=0;jt<Rt.length();jt++){let zt=Rt.getSection(jt),ge=Rt.getSectionIndex(jt),Ie=Rt.getCodePoint(jt),se=zt.scale,Oe=null,Ri=null,Ee=null,ti=_i,xi=0,Gi=!(y===di.horizontal||!E&&!J0(Ie)||E&&(jc[Ie]||(it=Ie,vt.Arabic(it)||vt["Arabic Supplement"](it)||vt["Arabic Extended-A"](it)||vt["Arabic Presentation Forms-A"](it)||vt["Arabic Presentation Forms-B"](it))));if(zt.imageName){let ai=X[zt.imageName];if(!ai)continue;Ee=zt.imageName,I.iconsInText=I.iconsInText||!0,Ri=ai.paddedRect;let Se=ai.displaySize;se=se*_i/O,Oe={width:Se[0],height:Se[1],left:0,top:-hu,advance:Gi?Se[1]:Se[0],localGlyph:!1},xi=P?-Oe.height*se:Wu+Gt*_i-Se[1]*se,ti=Oe.advance;let qi=(Gi?Se[0]:Se[1])*se-_i*Gt;qi>0&&qi>ft&&(ft=qi)}else{let ai=Y[zt.fontStack];if(!ai)continue;ai[Ie]&&(Ri=ai[Ie]);let Se=N[zt.fontStack];if(!Se)continue;let qi=Se.glyphs[Ie];if(!qi)continue;if(Oe=qi.metrics,ti=Ie!==8203?_i:0,P){let La=Se.ascender!==void 0?Math.abs(Se.ascender):0,cl=Se.descender!==void 0?Math.abs(Se.descender):0,bl=(La+cl)*se;xe<bl&&(xe=bl,pe=(La-cl)/2*se),xi=-La*se}else xi=Wu+(Gt-se)*_i}Gi?(I.verticalizable=!0,Dt.push({glyph:Ie,imageName:Ee,x:f,y:L+xi,vertical:Gi,scale:se,localGlyph:Oe.localGlyph,fontStack:zt.fontStack,sectionIndex:ge,metrics:Oe,rect:Ri}),f+=ti*se+z):(Dt.push({glyph:Ie,imageName:Ee,x:f,y:L+xi,vertical:Gi,scale:se,localGlyph:Oe.localGlyph,fontStack:zt.fontStack,sectionIndex:ge,metrics:Oe,rect:Ri}),f+=Oe.advance*se+z)}Dt.length!==0&&(K=Math.max(f-z,K),P?uu(Dt,q,ft,pe,B*Gt/2):uu(Dt,q,ft,0,B/2)),f=0;let _t=B*Gt+ft;Bt.lineOffset=Math.max(ft,Yt),L+=_t,++et}var it;let at=L,{horizontalAlign:$,verticalAlign:ot}=Hc(C);(function(Rt,Gt,Yt,Bt,Dt,ft){let xe=(Gt-Yt)*Dt,pe=-ft*Bt;for(let _t of Rt)for(let jt of _t.positionedGlyphs)jt.x+=xe,jt.y+=pe})(I.positionedLines,q,$,ot,K,at),I.top+=-ot*at,I.bottom=I.top+at,I.left+=-$*K,I.right=I.left+K,I.hasBaseline=P}(R,t,i,n,Z,o,d,s,b,r,m,W),!function(I){for(let N of I)if(N.positionedGlyphs.length!==0)return!1;return!0}(F)&&R}let jc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wY={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pu(e,t,i,n,a,l){if(t.imageName){let o=n[t.imageName];return o?o.displaySize[0]*t.scale*_i/l+a:0}{let o=i[t.fontStack],d=o&&o.glyphs[e];return d?d.metrics.advance*t.scale+a:0}}function Zu(e,t,i,n){let a=Math.pow(e-t,2);return n?e<t?a/2:2*a:a+Math.abs(i)*i}function jY(e,t,i){let n=0;return e===10&&(n-=1e4),i&&(n+=150),e!==40&&e!==65288||(n+=50),t!==41&&t!==65289||(n+=50),n}function Vu(e,t,i,n,a,l){let o=null,d=Zu(t,i,a,l);for(let s of n){let r=Zu(t-s.x,i,a,l)+s.badness;r<=d&&(o=s,d=r)}return{index:e,x:t,priorBreak:o,badness:d}}function gu(e){return e?gu(e.priorBreak).concat(e.index):[]}function Hc(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function uu(e,t,i,n,a){if(!(t||i||n||a))return;let l=e.length-1,o=e[l],d=(o.x+o.metrics.advance*o.scale)*t;for(let s=0;s<=l;s++)e[s].x-=d,e[s].y+=i+n+a}function HY(e,t,i,n){let{horizontalAlign:a,verticalAlign:l}=Hc(n),o=i[0]-e.displaySize[0]*a,d=i[1]-e.displaySize[1]*l;return{imagePrimary:e,imageSecondary:t,top:d,bottom:d+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Ru(e,t,i,n,a,l){let o=e.imagePrimary,d;if(o.content){let Z=o.content,g=o.pixelRatio||1;d=[Z[0]/g,Z[1]/g,o.displaySize[0]-Z[2]/g,o.displaySize[1]-Z[3]/g]}let s=t.left*l,r=t.right*l,c,b,m,h;i==="width"||i==="both"?(h=a[0]+s-n[3],b=a[0]+r+n[1]):(h=a[0]+(s+r-o.displaySize[0])/2,b=h+o.displaySize[0]);let W=t.top*l,p=t.bottom*l;return i==="height"||i==="both"?(c=a[1]+W-n[0],m=a[1]+p+n[2]):(c=a[1]+(W+p-o.displaySize[1])/2,m=c+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:c,right:b,bottom:m,left:h,collisionPadding:d}}class rl extends H{constructor(t,i,n,a,l){super(t,i),this.angle=a,this.z=n,l!==void 0&&(this.segment=l)}clone(){return new rl(this.x,this.y,this.z,this.angle,this.segment)}}function Gu(e,t,i,n,a){if(t.segment===void 0)return!0;let l=t,o=t.segment+1,d=0;for(;d>-i/2;){if(o--,o<0)return!1;d-=e[o].dist(l),l=e[o]}d+=e[o].dist(e[o+1]),o++;let s=[],r=0;for(;d<i/2;){let c=e[o],b=e[o+1];if(!b)return!1;let m=e[o-1].angleTo(c)-c.angleTo(b);for(m=Math.abs((m+3*Math.PI)%(2*Math.PI)-Math.PI),s.push({distance:d,angleDelta:m}),r+=m;d-s[0].distance>n;)r-=s.shift().angleDelta;if(r>a)return!1;o++,d+=c.dist(b)}return!0}function Fu(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Iu(e,t,i){return e?.6*t*i:0}function Uu(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function OY(e,t,i,n,a,l){let o=Iu(i,a,l),d=Uu(i,n)*l,s=0,r=Fu(e)/2;for(let c=0;c<e.length-1;c++){let b=e[c],m=e[c+1],h=b.dist(m);if(s+h>r){let W=(r-s)/h,p=Pt(b.x,m.x,W),Z=Pt(b.y,m.y,W),g=new rl(p,Z,0,m.angleTo(b),c);return!o||Gu(e,g,d,o,t)?g:void 0}s+=h}}function DY(e,t,i,n,a,l,o,d,s){let r=Iu(n,l,o),c=Uu(n,a),b=c*o,m=e[0].x===0||e[0].x===s||e[0].y===0||e[0].y===s;return t-b<t/4&&(t=b+t/4),xu(e,m?t/2*d%t:(c/2+2*l)*o*d%t,t,r,i,b,m,!1,s)}function xu(e,t,i,n,a,l,o,d,s){let r=l/2,c=Fu(e),b=0,m=t-i,h=[];for(let W=0;W<e.length-1;W++){let p=e[W],Z=e[W+1],g=p.dist(Z),u=Z.angleTo(p);for(;m+i<b+g;){m+=i;let G=(m-b)/g,F=Pt(p.x,Z.x,G),R=Pt(p.y,Z.y,G);if(F>=0&&F<s&&R>=0&&R<s&&m-r>=0&&m+r<=c){let I=new rl(F,R,0,u,W);n&&!Gu(e,I,l,n,a)||h.push(I)}}b+=g}return d||h.length||o||(h=xu(e,b/2,i,n,a,l,o,!0,s)),h}function Nu(e,t,i,n,a){let l=[];for(let o=0;o<e.length;o++){let d=e[o],s;for(let r=0;r<d.length-1;r++){let c=d[r],b=d[r+1];c.x<t&&b.x<t||(c.x<t?c=new H(t,c.y+(t-c.x)/(b.x-c.x)*(b.y-c.y))._round():b.x<t&&(b=new H(t,c.y+(t-c.x)/(b.x-c.x)*(b.y-c.y))._round()),c.y<i&&b.y<i||(c.y<i?c=new H(c.x+(i-c.y)/(b.y-c.y)*(b.x-c.x),i)._round():b.y<i&&(b=new H(c.x+(i-c.y)/(b.y-c.y)*(b.x-c.x),i)._round()),c.x>=n&&b.x>=n||(c.x>=n?c=new H(n,c.y+(n-c.x)/(b.x-c.x)*(b.y-c.y))._round():b.x>=n&&(b=new H(n,c.y+(n-c.x)/(b.x-c.x)*(b.y-c.y))._round()),c.y>=a&&b.y>=a||(c.y>=a?c=new H(c.x+(a-c.y)/(b.y-c.y)*(b.x-c.x),a)._round():b.y>=a&&(b=new H(c.x+(a-c.y)/(b.y-c.y)*(b.x-c.x),a)._round()),s&&c.equals(s[s.length-1])||(s=[c],l.push(s)),s.push(b)))))}}return l}function Kh(e){let t=0,i=0;for(let o of e)t+=o.w*o.h,i=Math.max(i,o.w);e.sort((o,d)=>d.h-o.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],a=0,l=0;for(let o of e)for(let d=n.length-1;d>=0;d--){let s=n[d];if(!(o.w>s.w||o.h>s.h)){if(o.x=s.x,o.y=s.y,l=Math.max(l,o.y+o.h),a=Math.max(a,o.x+o.w),o.w===s.w&&o.h===s.h){let r=n.pop();d<n.length&&(n[d]=r)}else o.h===s.h?(s.x+=o.w,s.w-=o.w):o.w===s.w?(s.y+=o.h,s.h-=o.h):(n.push({x:s.x+o.w,y:s.y,w:s.w-o.w,h:o.h}),s.y+=o.h,s.h-=o.h);break}}return{w:a,h:l,fill:t/(a*l)||0}}kt(rl,"Anchor");let Sn=1;class Ph{constructor(t,{pixelRatio:i,version:n,stretchX:a,stretchY:l,content:o}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=a,this.stretchY=l,this.content=o,this.version=n}get tl(){return[this.paddedRect.x+Sn,this.paddedRect.y+Sn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Sn,this.paddedRect.y+this.paddedRect.h-Sn]}get displaySize(){return[(this.paddedRect.w-2*Sn)/this.pixelRatio,(this.paddedRect.h-2*Sn)/this.pixelRatio]}}class Yu{constructor(t,i){let n={},a={};this.haveRenderCallbacks=[];let l=[];this.addImages(t,n,l),this.addImages(i,a,l);let{w:o,h:d}=Kh(l),s=new Yi({width:o||1,height:d||1});for(let r in t){let c=t[r],b=n[r].paddedRect;Yi.copy(c.data,s,{x:0,y:0},{x:b.x+Sn,y:b.y+Sn},c.data)}for(let r in i){let c=i[r],b=a[r].paddedRect,m=b.x+Sn,h=b.y+Sn,W=c.data.width,p=c.data.height;Yi.copy(c.data,s,{x:0,y:0},{x:m,y:h},c.data),Yi.copy(c.data,s,{x:0,y:p-1},{x:m,y:h-1},{width:W,height:1}),Yi.copy(c.data,s,{x:0,y:0},{x:m,y:h+p},{width:W,height:1}),Yi.copy(c.data,s,{x:W-1,y:0},{x:m-1,y:h},{width:1,height:p}),Yi.copy(c.data,s,{x:0,y:0},{x:m+W,y:h},{width:1,height:p})}this.image=s,this.iconPositions=n,this.patternPositions=a}addImages(t,i,n){for(let a in t){let l=t[a],o={x:0,y:0,w:l.data.width+2*Sn,h:l.data.height+2*Sn};n.push(o),i[a]=new Ph(o,l),l.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(t,i,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>t.hasImage(a,n)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(let a in t.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[a],t.getImage(a,n),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a,n),i)}patchUpdatedImage(t,i,n){if(!t||!i||t.version===i.version)return;t.version=i.version;let[a,l]=t.tl;n.update(i.data,void 0,{x:a,y:l})}}kt(Ph,"ImagePosition"),kt(Yu,"ImageAtlas");let As=1e20;function Xu(e,t,i,n,a,l,o,d,s){for(let r=t;r<t+n;r++)Ju(e,i*l+r,l,a,o,d,s);for(let r=i;r<i+a;r++)Ju(e,r*l+t,1,n,o,d,s)}function Ju(e,t,i,n,a,l,o){l[0]=0,o[0]=-As,o[1]=As,a[0]=e[t];for(let d=1,s=0,r=0;d<n;d++){a[d]=e[t+d*i];let c=d*d;do{let b=l[s];r=(a[d]-a[b]+c-b*b)/(d-b)/2}while(r<=o[s]&&--s>-1);s++,l[s]=d,o[s]=r,o[s+1]=As}for(let d=0,s=0;d<n;d++){for(;o[s+1]<d;)s++;let r=l[s],c=d-r;e[t+d*i]=a[r]+c*c}}let Ga=2;class Xd{constructor(t,i,n){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,n){let a=[],l=this.urls[i]||Zt.GLYPHS_URL;for(let o in t)for(let d of t[o])a.push({stack:o,id:d});Ln(a,({stack:o,id:d},s)=>{let r=this.entries[o];r||(r=this.entries[o]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let c=r.glyphs[d];if(c!==void 0)return void s(null,{stack:o,id:d,glyph:c});if(c=this._tinySDF(r,o,d),c)return r.glyphs[d]=c,void s(null,{stack:o,id:d,glyph:c});let b=Math.floor(d/256);if(256*b>65535)return void s(new Error("glyphs > 65535 not supported"));if(r.ranges[b])return void s(null,{stack:o,id:d,glyph:c});let m=r.requests[b];m||(m=r.requests[b]=[],Xd.loadGlyphRange(o,b,l,this.requestManager,(h,W)=>{if(W){r.ascender=W.ascender,r.descender=W.descender;for(let p in W.glyphs)this._doesCharSupportLocalGlyph(+p)||(r.glyphs[+p]=W.glyphs[+p]);r.ranges[b]=!0}for(let p of m)p(h,W);delete r.requests[b]})),m.push((h,W)=>{h?s(h):W&&s(null,{stack:o,id:d,glyph:W.glyphs[d]||null})})},(o,d)=>{if(o)n(o);else if(d){let s={};for(let{stack:r,id:c,glyph:b}of d)s[r]===void 0&&(s[r]={}),s[r].glyphs===void 0&&(s[r].glyphs={}),s[r].glyphs[c]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},s[r].ascender=this.entries[r].ascender,s[r].descender=this.entries[r].descender;n(null,s)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(vt["CJK Unified Ideographs"](t)||vt["Hangul Syllables"](t)||vt.Hiragana(t)||vt.Katakana(t)||vt["CJK Symbols and Punctuation"](t)||vt["CJK Unified Ideographs Extension A"](t)||vt["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,i,n){let a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let l=t.tinySDF;if(!l){let p="400";/bold/i.test(i)?p="900":/medium/i.test(i)?p="500":/light/i.test(i)&&(p="200"),l=t.tinySDF=new Xd.TinySDF({fontFamily:a,fontWeight:p,fontSize:24*Ga,buffer:3*Ga,radius:8*Ga}),l.fontWeight=p}if(this.localGlyphs[l.fontWeight][n])return this.localGlyphs[l.fontWeight][n];let o=String.fromCodePoint(n),{data:d,width:s,height:r,glyphWidth:c,glyphHeight:b,glyphLeft:m,glyphTop:h,glyphAdvance:W}=l.draw(o);return this.localGlyphs[l.fontWeight][n]={id:n,bitmap:new dl({width:s,height:r},d),metrics:{width:c/Ga,height:b/Ga,left:m/Ga,top:h/Ga-27,advance:W/Ga,localGlyph:!0}}}}Xd.loadGlyphRange=function(e,t,i,n,a){let l=256*t,o=l+255,d=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}","".concat(l,"-").concat(o)),nt.Glyphs);Ft(d,(s,r)=>{if(s)a(s);else if(r){let c={},b=function(m){return new Ac(m).readFields(LY,{})}(r);for(let m of b.glyphs)c[m.id]=m;a(null,{glyphs:c,ascender:b.ascender,descender:b.descender})}})},Xd.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:l="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;let d=this.size=e+4*t,s=this._createCanvas(d),r=this.ctx=s.getContext("2d",{willReadFrequently:!0});r.font="".concat(o," ").concat(l," ").concat(e,"px ").concat(a),r.textBaseline="alphabetic",r.textAlign="left",r.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:l}=this.ctx.measureText(e),o=Math.ceil(i),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-a))),s=Math.min(this.size-this.buffer,o+Math.ceil(n)),r=d+2*this.buffer,c=s+2*this.buffer,b=Math.max(r*c,0),m=new Uint8ClampedArray(b),h={data:m,width:r,height:c,glyphWidth:d,glyphHeight:s,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(d===0||s===0)return h;let{ctx:W,buffer:p,gridInner:Z,gridOuter:g}=this;W.clearRect(p,p,d,s),W.fillText(e,p,p+o);let u=W.getImageData(p,p,d,s);g.fill(As,0,b),Z.fill(0,0,b);for(let G=0;G<s;G++)for(let F=0;F<d;F++){let R=u.data[4*(G*d+F)+3]/255;if(R===0)continue;let I=(G+p)*r+F+p;if(R===1)g[I]=0,Z[I]=As;else{let N=.5-R;g[I]=N>0?N*N:0,Z[I]=N<0?N*N:0}}Xu(g,0,0,r,c,r,this.f,this.v,this.z),Xu(Z,p,p,d,s,r,this.f,this.v,this.z);for(let G=0;G<b;G++){let F=Math.sqrt(g[G])-Math.sqrt(Z[G]);m[G]=Math.round(255-255*(F/this.radius+this.cutoff))}return h}};let zl=Sn;function yu(e,t,i,n){let a=[],l=e.imagePrimary,o=l.pixelRatio,d=l.paddedRect.w-2*zl,s=l.paddedRect.h-2*zl,r=e.right-e.left,c=e.bottom-e.top,b=l.stretchX||[[0,d]],m=l.stretchY||[[0,s]],h=(B,C)=>B+C[1]-C[0],W=b.reduce(h,0),p=m.reduce(h,0),Z=d-W,g=s-p,u=0,G=W,F=0,R=p,I=0,N=Z,Y=0,X=g;if(l.content&&n){let B=l.content;u=Oc(b,0,B[0]),F=Oc(m,0,B[1]),G=Oc(b,B[0],B[2]),R=Oc(m,B[1],B[3]),I=B[0]-u,Y=B[1]-F,N=B[2]-B[0]-G,X=B[3]-B[1]-R}let J=(B,C,Q,y)=>{let z=Dc(B.stretch-u,G,r,e.left),E=_c(B.fixed-I,N,B.stretch,W),O=Dc(C.stretch-F,R,c,e.top),f=_c(C.fixed-Y,X,C.stretch,p),L=Dc(Q.stretch-u,G,r,e.left),K=_c(Q.fixed-I,N,Q.stretch,W),q=Dc(y.stretch-F,R,c,e.top),P=_c(y.fixed-Y,X,y.stretch,p),et=new H(z,O),it=new H(L,O),at=new H(L,q),$=new H(z,q),ot=new H(E/o,f/o),Rt=new H(K/o,P/o),Gt=t*Math.PI/180;if(Gt){let pe=Math.sin(Gt),_t=Math.cos(Gt),jt=[_t,-pe,pe,_t];et._matMult(jt),it._matMult(jt),$._matMult(jt),at._matMult(jt)}let Yt=B.stretch+B.fixed,Bt=Q.stretch+Q.fixed,Dt=C.stretch+C.fixed,ft=y.stretch+y.fixed,xe=e.imageSecondary;return{tl:et,tr:it,bl:$,br:at,texPrimary:{x:l.paddedRect.x+zl+Yt,y:l.paddedRect.y+zl+Dt,w:Bt-Yt,h:ft-Dt},texSecondary:xe?{x:xe.paddedRect.x+zl+Yt,y:xe.paddedRect.y+zl+Dt,w:Bt-Yt,h:ft-Dt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ot,pixelOffsetBR:Rt,minFontScaleX:N/o/r,minFontScaleY:X/o/c,isSDF:i}};if(n&&(l.stretchX||l.stretchY)){let B=Bu(b,Z,W),C=Bu(m,g,p);for(let Q=0;Q<B.length-1;Q++){let y=B[Q],z=B[Q+1];for(let E=0;E<C.length-1;E++)a.push(J(y,C[E],z,C[E+1]))}}else a.push(J({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:d+1},{fixed:0,stretch:s+1}));return a}function Oc(e,t,i){let n=0;for(let a of e)n+=Math.max(t,Math.min(i,a[1]))-Math.max(t,Math.min(i,a[0]));return n}function Bu(e,t,i){let n=[{fixed:-zl,stretch:0}];for(let[a,l]of e){let o=n[n.length-1];n.push({fixed:a-o.stretch,stretch:o.stretch}),n.push({fixed:a-o.stretch,stretch:o.stretch+(l-a)})}return n.push({fixed:t+zl,stretch:i}),n}function Dc(e,t,i,n){return e/t*i+n}function _c(e,t,i,n){return e-t*i/n}function _Y(e,t,i,n){let a=t+e.positionedLines[n].lineOffset;return n===0?i+a/2:i+(a+(t+e.positionedLines[n-1].lineOffset))/2}function KY(e,t=1,i=!1){let n=1/0,a=1/0,l=-1/0,o=-1/0,d=e[0];for(let h=0;h<d.length;h++){let W=d[h];(!h||W.x<n)&&(n=W.x),(!h||W.y<a)&&(a=W.y),(!h||W.x>l)&&(l=W.x),(!h||W.y>o)&&(o=W.y)}let s=Math.min(l-n,o-a),r=s/2,c=new Am([],PY);if(s===0)return new H(n,a);for(let h=n;h<l;h+=s)for(let W=a;W<o;W+=s)c.push(new Jd(h+r,W+r,r,e));let b=function(h){let W=0,p=0,Z=0,g=h[0];for(let u=0,G=g.length,F=G-1;u<G;F=u++){let R=g[u],I=g[F],N=R.x*I.y-I.x*R.y;p+=(R.x+I.x)*N,Z+=(R.y+I.y)*N,W+=3*N}return new Jd(p/W,Z/W,0,h)}(e),m=c.length;for(;c.length;){let h=c.pop();(h.d>b.d||!b.d)&&(b=h,i&&console.log("found best %d after %d probes",Math.round(1e4*h.d)/1e4,m)),h.max-b.d<=t||(r=h.h/2,c.push(new Jd(h.p.x-r,h.p.y-r,r,e)),c.push(new Jd(h.p.x+r,h.p.y-r,r,e)),c.push(new Jd(h.p.x-r,h.p.y+r,r,e)),c.push(new Jd(h.p.x+r,h.p.y+r,r,e)),m+=4)}return i&&(console.log("num probes: ".concat(m)),console.log("best distance: ".concat(b.d))),b.p}function PY(e,t){return t.max-e.max}class Jd{constructor(t,i,n,a){this.p=new H(t,i),this.h=n,this.d=function(l,o){let d=!1,s=1/0;for(let r=0;r<o.length;r++){let c=o[r];for(let b=0,m=c.length,h=m-1;b<m;h=b++){let W=c[b],p=c[h];W.y>l.y!=p.y>l.y&&l.x<(p.x-W.x)*(l.y-W.y)/(p.y-W.y)+W.x&&(d=!d),s=Math.min(s,Mg(l,W,p))}}return(d?1:-1)*Math.sqrt(s)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}let yd=7,qh=Number.POSITIVE_INFINITY,qY=Math.sqrt(2);function $h(e,[t,i]){let n=0,a=0;if(i===qh){t<0&&(t=0);let l=t/qY;switch(e){case"top-right":case"top-left":a=l-yd;break;case"bottom-right":case"bottom-left":a=-l+yd;break;case"bottom":a=-t+yd;break;case"top":a=t-yd}switch(e){case"top-right":case"bottom-right":n=-l;break;case"top-left":case"bottom-left":n=l;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":a=i-yd;break;case"bottom-right":case"bottom-left":case"bottom":a=-i+yd}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,a]}function $Y(e,t,i,n,a,l,o,d,s,r,c){e.createArrays(),e.tilePixelRatio=tt/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;let b=e.layers[0].layout,m=e.layers[0]._unevaluatedLayout._values,h={};if(e.textSizeData.kind==="composite"){let{minZoom:g,maxZoom:u}=e.textSizeData;h.compositeTextSizes=[m["text-size"].possiblyEvaluate(new si(g),d),m["text-size"].possiblyEvaluate(new si(u),d)]}if(e.iconSizeData.kind==="composite"){let{minZoom:g,maxZoom:u}=e.iconSizeData;h.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new si(g),d),m["icon-size"].possiblyEvaluate(new si(u),d)]}h.layoutTextSize=m["text-size"].possiblyEvaluate(new si(s+1),d),h.layoutIconSize=m["icon-size"].possiblyEvaluate(new si(s+1),d),h.textMaxSize=m["text-size"].possiblyEvaluate(new si(18),d);let W=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point",p=b.get("text-size"),Z=!1;for(let g of e.features)if(g.icon&&g.icon.nameSecondary){Z=!0;break}for(let g of e.features){let u=b.get("text-font").evaluate(g,{},d).join(","),G=p.evaluate(g,{},d),F=h.layoutTextSize.evaluate(g,{},d),R=(h.layoutIconSize.evaluate(g,{},d),{horizontal:{},vertical:void 0}),I=g.text,N,Y=[0,0];if(I){let B=I.toString(),C=b.get("text-letter-spacing").evaluate(g,{},d)*_i,Q=b.get("text-line-height").evaluate(g,{},d)*_i,y=Nx(B)?C:0,z=b.get("text-anchor").evaluate(g,{},d),E=b.get("text-variable-anchor");if(!E){let q=b.get("text-radial-offset").evaluate(g,{},d);Y=q?$h(z,[q*_i,qh]):b.get("text-offset").evaluate(g,{},d).map(P=>P*_i)}let O=W?"center":b.get("text-justify").evaluate(g,{},d),f=b.get("symbol-placement")==="point",L=f?b.get("text-max-width").evaluate(g,{},d)*_i:1/0,K=q=>{e.allowVerticalPlacement&&X0(B)&&(R.vertical=_h(I,t,i,a,u,L,Q,z,q,y,Y,di.vertical,!0,F,G))};if(!W&&E){let q=O==="auto"?E.map(et=>tW(et)):[O],P=!1;for(let et=0;et<q.length;et++){let it=q[et];if(!R.horizontal[it])if(P)R.horizontal[it]=R.horizontal[0];else{let at=_h(I,t,i,a,u,L,Q,"center",it,y,Y,di.horizontal,!1,F,G);at&&(R.horizontal[it]=at,P=at.positionedLines.length===1)}}K("left")}else{if(O==="auto"&&(O=tW(z)),f||b.get("text-writing-mode").indexOf("horizontal")>=0||!X0(B)){let q=_h(I,t,i,a,u,L,Q,z,O,y,Y,di.horizontal,!1,F,G);q&&(R.horizontal[O]=q)}K(f?"left":O)}}let X=!1;if(g.icon&&g.icon.namePrimary){let B=n[g.icon.namePrimary];B&&(N=HY(a[g.icon.namePrimary],g.icon.nameSecondary?a[g.icon.nameSecondary]:void 0,b.get("icon-offset").evaluate(g,{},d),b.get("icon-anchor").evaluate(g,{},d)),X=B.sdf,e.sdfIcons===void 0?e.sdfIcons=B.sdf:e.sdfIcons!==B.sdf&&A("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(B.pixelRatio!==e.pixelRatio||b.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}let J=Cu(R.horizontal)||R.vertical;e.iconsInText||(e.iconsInText=!!J&&J.iconsInText),(J||N)&&tX(e,g,R,N,n,h,F,0,Y,X,o,d,r,c,Z)}l&&e.generateCollisionDebugBuffers(s,e.collisionBoxArray)}function tW(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tX(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W){let p=l.textMaxSize.evaluate(t,{},b);p===void 0&&(p=o);let Z=e.layers[0].layout,g=Z.get("icon-offset").evaluate(t,{},b),u=Cu(i.horizontal)||i.vertical,G=m.name==="globe",F=_i,R=o/F,I=e.tilePixelRatio*p/F,N=(z=e.overscaling,e.zoom>18&&z>2&&(z>>=1),Math.max(tt/(512*z),1)*Z.get("symbol-spacing")),Y=Z.get("text-padding")*e.tilePixelRatio,X=Z.get("icon-padding")*e.tilePixelRatio,J=At(Z.get("text-max-angle")),B=Z.get("text-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",C=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",Q=Z.get("symbol-placement"),y=N/2;var z;let E=Z.get("icon-text-fit").evaluate(t,{},b),O=Z.get("icon-text-fit-padding").evaluate(t,{},b),f=E!=="none",L;e.hasAnyIconTextFit===!1&&f&&(e.hasAnyIconTextFit=!0),n&&f&&(e.allowVerticalPlacement&&i.vertical&&(L=Ru(n,i.vertical,E,O,g,R)),u&&(n=Ru(n,u,E,O,g,R)));let K=(q,P,et)=>{if(P.x<0||P.x>=tt||P.y<0||P.y>=tt)return;let it=null;if(G){let{x:at,y:$,z:ot}=m.projectTilePoint(P.x,P.y,et);it={anchor:new rl(at,$,ot,0,void 0),up:m.upVector(et,P.x,P.y)}}(function(at,$,ot,Rt,Gt,Yt,Bt,Dt,ft,xe,pe,_t,jt,zt,ge,Ie,se,Oe,Ri,Ee,ti,xi,Gi,ai,Se,qi,La){let cl=at.addToLineVertexArray($,Rt),bl,br,mr,wb,fF,zF,LF,EF=0,AF=0,wF=0,jF=0,tp=-1,ep=-1,Ea={},HF=$0(""),Bo=ot?ot.anchor:$,ip=ft.layout.get("icon-text-fit").evaluate(ti,{},Se)!=="none",np=0,ap=0;if(ft._unevaluatedLayout.getValue("text-radial-offset")===void 0?[np,ap]=ft.layout.get("text-offset").evaluate(ti,{},Se).map(vn=>vn*_i):(np=ft.layout.get("text-radial-offset").evaluate(ti,{},Se)*_i,ap=qh),at.allowVerticalPlacement&&Gt.vertical){let vn=Gt.vertical;if(ge)zF=eW(vn),Dt&&(LF=eW(Dt));else{let fn=ft.layout.get("text-rotate").evaluate(ti,{},Se)+90;mr=Kc(xe,Bo,$,pe,_t,jt,vn,zt,fn,Ie),Dt&&(wb=Kc(xe,Bo,$,pe,_t,jt,Dt,Oe,fn))}}if(Yt){let vn=ft.layout.get("icon-rotate").evaluate(ti,{},Se),fn=yu(Yt,vn,Gi,ip),Ld=Dt?yu(Dt,vn,Gi,ip):void 0;br=Kc(xe,Bo,$,pe,_t,jt,Yt,Oe,vn),EF=4*fn.length;let OF=at.iconSizeData,Mo=null;OF.kind==="source"?(Mo=[Ra*ft.layout.get("icon-size").evaluate(ti,{},Se)],Mo[0]>Ll&&A("".concat(at.layerIds[0],': Value for "icon-size" is >= ').concat(ws,'. Reduce your "icon-size".'))):OF.kind==="composite"&&(Mo=[Ra*xi.compositeIconSizes[0].evaluate(ti,{},Se),Ra*xi.compositeIconSizes[1].evaluate(ti,{},Se)],(Mo[0]>Ll||Mo[1]>Ll)&&A("".concat(at.layerIds[0],': Value for "icon-size" is >= ').concat(ws,'. Reduce your "icon-size".'))),at.addSymbols(at.icon,fn,Mo,Ee,Ri,ti,!1,ot,$,cl.lineStartIndex,cl.lineLength,-1,ai,Se,qi,La),tp=at.icon.placedSymbolArray.length-1,Ld&&(AF=4*Ld.length,at.addSymbols(at.icon,Ld,Mo,Ee,Ri,ti,di.vertical,ot,$,cl.lineStartIndex,cl.lineLength,-1,ai,Se,qi,La),ep=at.icon.placedSymbolArray.length-1)}for(let vn in Gt.horizontal){let fn=Gt.horizontal[vn];bl||(HF=$0(fn.text),ge?fF=eW(fn):bl=Kc(xe,Bo,$,pe,_t,jt,fn,zt,ft.layout.get("text-rotate").evaluate(ti,{},Se),Ie));let Ld=fn.positionedLines.length===1;if(wF+=Mu(at,ot,$,fn,Bt,ft,ge,ti,Ie,cl,Gt.vertical?di.horizontal:di.horizontalOnly,Ld?Object.keys(Gt.horizontal):[vn],Ea,tp,xi,ai,Se,qi),Ld)break}Gt.vertical&&(jF+=Mu(at,ot,$,Gt.vertical,Bt,ft,ge,ti,Ie,cl,di.vertical,["vertical"],Ea,ep,xi,ai,Se,qi));let _l=-1,lp=(vn,fn)=>vn?Math.max(vn,fn):fn;_l=lp(fF,_l),_l=lp(zF,_l),_l=lp(LF,_l);let vB=_l>-1?1:0;at.glyphOffsetArray.length>=_s.MAX_GLYPHS&&A("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ti.sortKey!==void 0&&at.addToSortKeyRanges(at.symbolInstances.length,ti.sortKey),at.symbolInstances.emplaceBack($.x,$.y,Bo.x,Bo.y,Bo.z,Ea.right>=0?Ea.right:-1,Ea.center>=0?Ea.center:-1,Ea.left>=0?Ea.left:-1,Ea.vertical>=0?Ea.vertical:-1,tp,ep,HF,bl!==void 0?bl:at.collisionBoxArray.length,bl!==void 0?bl+1:at.collisionBoxArray.length,mr!==void 0?mr:at.collisionBoxArray.length,mr!==void 0?mr+1:at.collisionBoxArray.length,br!==void 0?br:at.collisionBoxArray.length,br!==void 0?br+1:at.collisionBoxArray.length,wb||at.collisionBoxArray.length,wb?wb+1:at.collisionBoxArray.length,pe,wF,jF,EF,AF,vB,0,np,ap,_l,0,ip?1:0)})(e,P,it,q,i,n,a,L,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,Y,B,s,0,X,C,g,t,l,r,c,b,h,W)};if(Q==="line")for(let q of Nu(t.geometry,0,0,tt,tt)){let P=DY(q,N,J,i.vertical||u,n,F,I,e.overscaling,tt);for(let et of P)u&&eX(e,u.text,y,et)||K(q,et,b)}else if(Q==="line-center"){for(let q of t.geometry)if(q.length>1){let P=OY(q,J,i.vertical||u,n,F,I);P&&K(q,P,b)}}else if(t.type==="Polygon")for(let q of Lh(t.geometry,0)){let P=KY(q,16);K(q[0],new rl(P.x,P.y,0,0,void 0),b)}else if(t.type==="LineString")for(let q of t.geometry)K(q,new rl(q[0].x,q[0].y,0,0,void 0),b);else if(t.type==="Point")for(let q of t.geometry)for(let P of q)K([P],new rl(P.x,P.y,0,0,void 0),b)}let ws=255,Ll=ws*Ra;function Mu(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g){let u=function(R,I,N,Y,X,J,B,C){let Q=[];if(I.positionedLines.length===0)return Q;let y=Y.layout.get("text-rotate").evaluate(J,{})*Math.PI/180,z=function(K){let q=K[0],P=K[1],et=q*P;return et>0?[q,-P]:et<0?[-q,P]:q===0?[P,q]:[P,-q]}(N),E=Math.abs(I.top-I.bottom);for(let K of I.positionedLines)E-=K.lineOffset;let O=I.positionedLines.length,f=E/O,L=I.top-N[1];for(let K=0;K<O;++K){let q=I.positionedLines[K];L=_Y(I,f,L,K);for(let P of q.positionedGlyphs){if(!P.rect)continue;let et=P.rect||{},it=hu+1,at=!0,$=1,ot=0;if(P.imageName){let Ee=B[P.imageName];if(!Ee)continue;if(Ee.sdf){A("SDF images are not supported in formatted text and will be ignored.");continue}at=!1,$=Ee.pixelRatio,it=Sn/$}let Rt=(X||C)&&P.vertical,Gt=P.metrics.advance*P.scale/2,Yt=P.metrics,Bt=P.rect;if(Bt===null)continue;C&&I.verticalizable&&(ot=P.imageName?Gt-P.metrics.width*P.scale/2:0);let Dt=X?[P.x+Gt,P.y]:[0,0],ft=[0,0],xe=[0,0],pe=!1;X||(Rt?(xe=[P.x+Gt+z[0],P.y+z[1]-ot],pe=!0):ft=[P.x+Gt+N[0],P.y+N[1]-ot]);let _t=Bt.w*P.scale/($*(P.localGlyph?Ga:1)),jt=Bt.h*P.scale/($*(P.localGlyph?Ga:1)),zt,ge,Ie,se;if(Rt){let Ee=P.y-L,ti=new H(-Gt,Gt-Ee),xi=-Math.PI/2,Gi=new H(...xe);zt=new H(-Gt+ft[0],ft[1]),zt._rotateAround(xi,ti)._add(Gi),zt.x+=-Ee+Gt,zt.y-=(Yt.left-it)*P.scale;let ai=P.imageName?Yt.advance*P.scale:_i*P.scale,Se=String.fromCodePoint(P.glyph);fY(Se)?zt.x+=(1-it)*P.scale:zY(Se)?zt.x+=ai-Yt.height*P.scale+(-it-1)*P.scale:zt.x+=P.imageName||Yt.width+2*it===Bt.w&&Yt.height+2*it===Bt.h?(ai-jt)/2:(ai-(Yt.height+2*it)*P.scale)/2,ge=new H(zt.x,zt.y-_t),Ie=new H(zt.x+jt,zt.y),se=new H(zt.x+jt,zt.y-_t)}else{let Ee=(Yt.left-it)*P.scale-Gt+ft[0],ti=(-Yt.top-it)*P.scale+ft[1],xi=Ee+_t,Gi=ti+jt;zt=new H(Ee,ti),ge=new H(xi,ti),Ie=new H(Ee,Gi),se=new H(xi,Gi)}if(y){let Ee;Ee=X?new H(0,0):pe?new H(z[0],z[1]):new H(N[0],N[1]),zt._rotateAround(y,Ee),ge._rotateAround(y,Ee),Ie._rotateAround(y,Ee),se._rotateAround(y,Ee)}let Oe=new H(0,0),Ri=new H(0,0);Q.push({tl:zt,tr:ge,bl:Ie,br:se,texPrimary:et,texSecondary:void 0,writingMode:I.writingMode,glyphOffset:Dt,sectionIndex:P.sectionIndex,isSDF:at,pixelOffsetTL:Oe,pixelOffsetBR:Ri,minFontScaleX:0,minFontScaleY:0})}}return Q}(0,n,s,l,o,d,a,e.allowVerticalPlacement),G=e.textSizeData,F=null;G.kind==="source"?(F=[Ra*l.layout.get("text-size").evaluate(d,{},Z)],F[0]>Ll&&A("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(ws,'. Reduce your "text-size".'))):G.kind==="composite"&&(F=[Ra*W.compositeTextSizes[0].evaluate(d,{},Z),Ra*W.compositeTextSizes[1].evaluate(d,{},Z)],(F[0]>Ll||F[1]>Ll)&&A("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(ws,'. Reduce your "text-size".'))),e.addSymbols(e.text,u,F,s,o,d,c,t,i,r.lineStartIndex,r.lineLength,h,p,Z,g,!1);for(let R of b)m[R]=e.text.placedSymbolArray.length-1;return 4*u.length}function Cu(e){for(let t in e)return e[t];return null}function Kc(e,t,i,n,a,l,o,d,s,r){let c=o.top,b=o.bottom,m=o.left,h=o.right,W=o.collisionPadding;if(W&&(m-=W[0],c-=W[1],h+=W[2],b+=W[3]),s){let p=new H(m,c),Z=new H(h,c),g=new H(m,b),u=new H(h,b),G=At(s),F=new H(0,0);r&&(F=new H(r[0],r[1])),p._rotateAround(G,F),Z._rotateAround(G,F),g._rotateAround(G,F),u._rotateAround(G,F),m=Math.min(p.x,Z.x,g.x,u.x),h=Math.max(p.x,Z.x,g.x,u.x),c=Math.min(p.y,Z.y,g.y,u.y),b=Math.max(p.y,Z.y,g.y,u.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,m,c,h,b,d,n,a,l),e.length-1}function eW(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);let t=e.bottom-e.top;return t>0?Math.max(10,t):null}function eX(e,t,i,n){let a=e.compareText;if(t in a){let l=a[t];for(let o=l.length-1;o>=0;o--)if(n.dist(l[o])<i)return!0}else a[t]=[];return a[t].push(n),!1}function Tu(e,t){let i=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,a=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),l=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),o=Math.sin(e._pitch)*l+a;return Math.min(1.01*o,a*(1/e._horizonShift))}function Io(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};let i=Math.pow(2,-e.z),n=e.x*i,a=(e.x+1)*i,l=e.y*i,o=(e.y+1)*i,d=kn(n),s=kn(a),r=Bi(l),c=Bi(o),b=t.project(d,r),m=t.project(s,r),h=t.project(s,c),W=t.project(d,c),p=Math.min(b.x,m.x,h.x,W.x),Z=Math.min(b.y,m.y,h.y,W.y),g=Math.max(b.x,m.x,h.x,W.x),u=Math.max(b.y,m.y,h.y,W.y),G=i/16;function F(I,N,Y,X,J,B){let C=(Y+J)/2,Q=(X+B)/2,y=t.project(kn(C),Bi(Q)),z=Math.max(0,p-y.x,Z-y.y,y.x-g,y.y-u);p=Math.min(p,y.x),g=Math.max(g,y.x),Z=Math.min(Z,y.y),u=Math.max(u,y.y),z>G&&(F(I,y,Y,X,C,Q),F(y,N,C,Q,J,B))}F(b,m,n,l,a,l),F(m,h,a,l,a,o),F(h,W,a,o,n,o),F(W,b,n,o,n,l),p-=G,Z-=G,g+=G,u+=G;let R=1/Math.max(g-p,u-Z);return{scale:R,x:p*R,y:Z*R,x2:g*R,y2:u*R,projection:t}}function ku(e,t,i,n,a,l,o,d,s){if(s.name==="globe")return Ih(e,t,new ia(i,n,a),!1);let r=Io({z:i,x:n,y:a},s);return new $e([(l+r.x/r.scale)*t,t*(r.y/r.scale),o],[(l+r.x2/r.scale)*t,t*(r.y2/r.scale),d])}function Su(e,{x:t,y:i},n=0){return new H(((t-n)*e.scale-e.x)*tt,(i*e.scale-e.y)*tt)}function Qu(e,t,i=0){return S.fromValues(((t.x-i)*e.scale-e.x)*tt,(t.y*e.scale-e.y)*tt,Ng(t.z,t.y))}let iX=D.identity(new Float32Array(16));class El{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new qt(0,0)}projectTilePoint(t,i,n){return{x:t,y:i,z:0}}locationPoint(t,i,n=!0){return t._coordinatePoint(t.locationCoordinate(i),n)}pixelsPerMeter(t,i){return He(1,t)*i}pixelSpaceConversion(t,i,n){return 1}farthestPixelDistance(t){return Tu(t,t.pixelsPerMeter)}pointCoordinate(t,i,n,a){let l=t.horizonLineFromTop(!1),o=new H(i,Math.max(l,n));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,a))}pointCoordinate3D(t,i,n){let a=new H(i,n);if(t.elevation)return t.elevation.pointCoordinate(a);{let l=this.pointCoordinate(t,a.x,a.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);let n=t.horizonLineFromTop();return i.y<n}createInversionMatrix(t,i){return iX}createTileMatrix(t,i,n){let a,l,o,d=n.canonical,s=D.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let r=Io(d,this);a=1,l=r.x+n.wrap*r.scale,o=r.y,D.scale(s,s,[a/r.scale,a/r.scale,t.pixelsPerMeter/i])}else a=i/t.zoomScale(d.z),l=(d.x+Math.pow(2,d.z)*n.wrap)*a,o=d.y*a;return D.translate(s,s,[l,o,0]),D.scale(s,s,[a/tt,a/tt,1]),s}upVector(t,i,n){return[0,0,1]}upVectorScale(t,i,n){return{metersToTile:1}}}class nX extends El{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[i,n]=this.parallels=t.parallels||[29.5,45.5],a=Math.sin(At(i));this.n=(a+Math.sin(At(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(t,i){let{n,c:a,r0:l}=this,o=At(t-this.center[0]),d=At(i),s=Math.sqrt(a-2*n*Math.sin(d))/n;return{x:s*Math.sin(o*n),y:s*Math.cos(o*n)-l,z:0}}unproject(t,i){let{n,c:a,r0:l}=this,o=l+i,d=Math.atan2(t,Math.abs(o))*Math.sign(o);o*n<0&&(d-=Math.PI*Math.sign(t)*Math.sign(o));let s=At(this.center[0])*n;d=Nn(d,-Math.PI-s,Math.PI-s);let r=Mt(ei(d/n)+this.center[0],-180,180),c=Math.asin(Mt((a-(t*t+o*o)*n*n)/(2*n),-1,1)),b=Mt(ei(c),-ui,ui);return new qt(r,b)}}let js=1.340264,Hs=-.081106,Os=893e-6,Ds=.003796,Pc=Math.sqrt(3)/2;class aX extends El{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;let n=Math.asin(Pc*Math.sin(i)),a=n*n,l=a*a*a;return{x:.5*(t*Math.cos(n)/(Pc*(js+3*Hs*a+l*(7*Os+9*Ds*a)))/Math.PI+.5),y:1-.5*(n*(js+Hs*a+l*(Os+Ds*a))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=n*n,l=a*a*a;for(let c,b,m,h=0;h<12&&(b=n*(js+Hs*a+l*(Os+Ds*a))-i,m=js+3*Hs*a+l*(7*Os+9*Ds*a),c=b/m,n=Mt(n-c,-Math.PI/3,Math.PI/3),a=n*n,l=a*a*a,!(Math.abs(c)<1e-12));++h);let o=Pc*t*(js+3*Hs*a+l*(7*Os+9*Ds*a))/Math.cos(n),d=Math.asin(Math.sin(n)/Pc),s=Mt(180*o/Math.PI,-180,180),r=Mt(180*d/Math.PI,-ui,ui);return new qt(s,r)}}class lX extends El{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){let n=360*(t-.5),a=Mt(360*(.5-i),-ui,ui);return new qt(n,a)}}let Bd=Math.PI/2;function qc(e){return Math.tan((Bd+e)/2)}class oX extends El{constructor(t){super(t),this.center=t.center||[0,30];let[i,n]=this.parallels=t.parallels||[30,30],a=At(i),l=At(n);this.southernCenter=a+l<0,this.southernCenter&&(a=-a,l=-l);let o=Math.cos(a),d=qc(a);this.n=a===l?Math.sin(a):Math.log(o/Math.cos(l))/Math.log(qc(l)/d),this.f=o*Math.pow(qc(a),this.n)/this.n}project(t,i){i=At(i),this.southernCenter&&(i=-i),t=At(t-this.center[0]);let n=1e-6,{n:a,f:l}=this;l>0?i<-Bd+n&&(i=-Bd+n):i>Bd-n&&(i=Bd-n);let o=l/Math.pow(qc(i),a),d=o*Math.sin(a*t),s=l-o*Math.cos(a*t);return d=.5*(d/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:d,y:this.southernCenter?s:1-s,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n,f:a}=this,l=a-i,o=Math.sign(l),d=Math.sign(n)*Math.sqrt(t*t+l*l),s=Math.atan2(t,Math.abs(l))*o;l*n<0&&(s-=Math.PI*Math.sign(t)*o);let r=Mt(ei(s/n)+this.center[0],-180,180),c=Mt(ei(2*Math.atan(Math.pow(a/d,1/n))-Bd),-ui,ui);return new qt(r,this.southernCenter?-c:c)}}class vu extends El{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:Qi(t),y:Li(i),z:0}}unproject(t,i){let n=kn(t),a=Bi(i);return new qt(n,a)}}let fu=At(ui);class dX extends El{project(t,i){let n=(i=At(i))*i,a=n*n;return{x:.5*((t=At(t))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=25,l=0,o=n*n;do{o=n*n;let r=o*o;l=(n*(1.007226+o*(.015085+r*(.028874*o-.044475-.005916*r)))-i)/(1.007226+o*(.045255+r*(.259866*o-.311325-.005916*11*r))),n=Mt(n-l,-fu,fu)}while(Math.abs(l)>1e-6&&--a>0);o=n*n;let d=Mt(ei(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),s=ei(n);return new qt(d,s)}}let zu=At(ui);class sX extends El{project(t,i){i=At(i),t=At(t);let n=Math.cos(i),a=2/Math.PI,l=Math.acos(n*Math.cos(t/2)),o=Math.sin(l)/l,d=.5*(t*a+2*n*Math.sin(t/2)/o)||0,s=.5*(i+Math.sin(i)/o)||0;return{x:.5*(d/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(t,i){let n=t=(2*t-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,l=25,o=1e-6,d=0,s=0;do{let r=Math.cos(a),c=Math.sin(a),b=2*c*r,m=c*c,h=r*r,W=Math.cos(n/2),p=Math.sin(n/2),Z=2*W*p,g=p*p,u=1-h*W*W,G=u?1/u:0,F=u?Math.acos(r*W)*Math.sqrt(1/u):0,R=.5*(2*F*r*p+2*n/Math.PI)-t,I=.5*(F*c+a)-i,N=.5*G*(h*g+F*r*W*m)+1/Math.PI,Y=G*(Z*b/4-F*c*p),X=.125*G*(b*p-F*c*h*Z),J=.5*G*(m*W+F*g*r)+.5,B=Y*X-J*N;d=(I*Y-R*J)/B,s=(R*X-I*N)/B,n=Mt(n-d,-Math.PI,Math.PI),a=Mt(a-s,-zu,zu)}while((Math.abs(d)>o||Math.abs(s)>o)&&--l>0);return new qt(ei(n),ei(a))}}class Lu extends El{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(At(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){let{scale:n,cosPhi:a}=this;return{x:At(t)*a*n+.5,y:-Math.sin(At(i))/a*n+.5,z:0}}unproject(t,i){let{scale:n,cosPhi:a}=this,l=-(i-.5)/n,o=Mt(ei((t-.5)/n)/a,-180,180),d=Math.asin(Mt(l*a,-1,1)),s=Mt(ei(d),-ui,ui);return new qt(o,s)}}class rX extends vu{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,n){let a=ks(t,i,n),l=Tl(jn(n));return S.transformMat4(a,a,l),{x:a[0],y:a[1],z:a[2]}}locationPoint(t,i){let n=Gn(i.lat,i.lng),a=S.normalize([],n),l=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,o=He(1,0)*tt*l;S.scaleAndAdd(n,n,a,o);let d=D.identity(new Float64Array(16));return D.multiply(d,t.pixelMatrix,t.globeMatrix),S.transformMat4(n,n,d),new H(n[0],n[1])}pixelsPerMeter(t,i){return He(1,0)*i}pixelSpaceConversion(t,i,n){let a=He(1,t)*i,l=Pt(He(1,45)*i,a,n);return this.pixelsPerMeter(t,i)/l}createTileMatrix(t,i,n){let a=xh(jn(n.canonical));return D.multiply(new Float64Array(16),t.globeMatrix,a)}createInversionMatrix(t,i){let{center:n}=t,a=Tl(jn(i));return D.rotateY(a,a,At(n.lng)),D.rotateX(a,a,At(n.lat)),D.scale(a,a,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(t,i,n,a){return hg(t,i,n,!0)||new Re(0,0)}pointCoordinate3D(t,i,n){let a=this.pointCoordinate(t,i,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(t,i){return!hg(t,i.x,i.y,!1)}farthestPixelDistance(t){let i=function(a,l){let o=a.cameraToCenterDistance,d=a._centerAltitude*l,s=a._camera,r=a._camera.forward(),c=S.add([],S.scale([],r,-o),[0,0,d]),b=a.worldSize/(2*Math.PI),m=[0,0,-b],h=a.width/a.height,W=Math.tan(a.fovAboveCenter),p=S.scale([],s.up(),W),Z=S.scale([],s.right(),W*h),g=S.normalize([],S.add([],S.add([],r,p),Z)),u=[],G;if(new Fc(c,g).closestPointOnSphere(m,b,u)){let F=S.add([],u,m),R=S.sub([],F,c);G=Math.cos(a.fovAboveCenter)*S.length(R)}else{let F=S.sub([],c,m),R=S.sub([],m,c);S.normalize(R,R);let I=S.length(F)-b;G=Math.sqrt(I*(I+2*b));let N=Math.acos(G/(b+I))-Math.acos(S.dot(r,R));G*=Math.cos(N)}return 1.01*G}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),n=Di(t.zoom);if(n>0){let a=Tu(t,He(1,t.center.lat)*t.worldSize),l=t.worldSize/(2*Math.PI),o=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Pt(i,a+l*(1-Math.cos(o)),Math.pow(n,10))}return i}upVector(t,i,n){return ks(i,n,t,1)}upVectorScale(t){return{metersToTile:Ic(xc(jn(t)))}}}function $c(e){let t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new vu(e);case"equirectangular":return new lX(e);case"naturalEarth":return new dX(e);case"equalEarth":return new aX(e);case"winkelTripel":return new sX(e);case"albers":return i?new Lu(e):new nX(e);case"lambertConformalConic":return i?new Lu(e):new oX(e);case"globe":return new rX(e)}throw new Error("Invalid projection name: ".concat(e.name))}let cX=new Zi({"symbol-placement":new mt(_.layout_symbol["symbol-placement"]),"symbol-spacing":new mt(_.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mt(_.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Et(_.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mt(_.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new mt(_.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new mt(_.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mt(_.layout_symbol["icon-ignore-placement"]),"icon-optional":new mt(_.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mt(_.layout_symbol["icon-rotation-alignment"]),"icon-size":new Et(_.layout_symbol["icon-size"]),"icon-text-fit":new Et(_.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Et(_.layout_symbol["icon-text-fit-padding"]),"icon-image":new Et(_.layout_symbol["icon-image"]),"icon-rotate":new Et(_.layout_symbol["icon-rotate"]),"icon-padding":new mt(_.layout_symbol["icon-padding"]),"icon-keep-upright":new mt(_.layout_symbol["icon-keep-upright"]),"icon-offset":new Et(_.layout_symbol["icon-offset"]),"icon-anchor":new Et(_.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mt(_.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mt(_.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mt(_.layout_symbol["text-rotation-alignment"]),"text-field":new Et(_.layout_symbol["text-field"]),"text-font":new Et(_.layout_symbol["text-font"]),"text-size":new Et(_.layout_symbol["text-size"]),"text-max-width":new Et(_.layout_symbol["text-max-width"]),"text-line-height":new Et(_.layout_symbol["text-line-height"]),"text-letter-spacing":new Et(_.layout_symbol["text-letter-spacing"]),"text-justify":new Et(_.layout_symbol["text-justify"]),"text-radial-offset":new Et(_.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mt(_.layout_symbol["text-variable-anchor"]),"text-anchor":new Et(_.layout_symbol["text-anchor"]),"text-max-angle":new mt(_.layout_symbol["text-max-angle"]),"text-writing-mode":new mt(_.layout_symbol["text-writing-mode"]),"text-rotate":new Et(_.layout_symbol["text-rotate"]),"text-padding":new mt(_.layout_symbol["text-padding"]),"text-keep-upright":new mt(_.layout_symbol["text-keep-upright"]),"text-transform":new Et(_.layout_symbol["text-transform"]),"text-offset":new Et(_.layout_symbol["text-offset"]),"text-allow-overlap":new mt(_.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mt(_.layout_symbol["text-ignore-placement"]),"text-optional":new mt(_.layout_symbol["text-optional"]),visibility:new mt(_.layout_symbol.visibility)});var iW={paint:new Zi({"icon-opacity":new Et(_.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Et(_.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Et(_.paint_symbol["text-emissive-strength"]),"icon-color":new Et(_.paint_symbol["icon-color"]),"icon-halo-color":new Et(_.paint_symbol["icon-halo-color"]),"icon-halo-width":new Et(_.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Et(_.paint_symbol["icon-halo-blur"]),"icon-translate":new mt(_.paint_symbol["icon-translate"]),"icon-translate-anchor":new mt(_.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Et(_.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Et(_.paint_symbol["text-opacity"]),"text-color":new Et(_.paint_symbol["text-color"],{runtimeType:Pn,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Et(_.paint_symbol["text-halo-color"]),"text-halo-width":new Et(_.paint_symbol["text-halo-width"]),"text-halo-blur":new Et(_.paint_symbol["text-halo-blur"]),"text-translate":new mt(_.paint_symbol["text-translate"]),"text-translate-anchor":new mt(_.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new mt(_.paint_symbol["icon-color-saturation"])}),layout:cX};class Eu{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:qo,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kt(Eu,"FormatSectionOverride",{omit:["defaultValue"]});class tb extends En{constructor(t,i){super(t,iW,i)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let n=this.layout.get("text-writing-mode");if(n){let a=[];for(let l of n)a.indexOf(l)<0&&a.push(l);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,n,a){let l=this.layout.get(t).evaluate(i,{},n,a),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||qr(o.value)||!l?l:function(d,s){return s.replace(/{([^{}]+)}/g,(r,c)=>c in d?String(d[c]):"")}(i.properties,l)}createBucket(t){return new _s(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of iW.paint.overridableProperties){if(!tb.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),n=new Eu(i),a=new G0(n,i.property.specification),l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new F0("source",a):new Ul("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new hd(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&tb.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let n=t.get("text-field"),a=iW.paint.properties[i],l=!1,o=d=>{for(let s of d)if(a.overrides&&a.overrides.hasOverride(s))return void(l=!0)};if(n.value.kind==="constant"&&n.value.value instanceof yn)o(n.value.value.sections);else if(n.value.kind==="source"){let d=r=>{l||(r instanceof ms&&ji(r.value)===ds?o(r.value.sections):r instanceof hs?o(r.sections):r.eachChild(d))},s=n.value;s._styleExpression&&d(s._styleExpression.expression)}return l}getProgramIds(){let t=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,n=[];return t&&n.push("symbolIcon"),i&&n.push("symbolSDF"),n}getDefaultProgramParams(t,i){return{config:new uo(this,i),overrideFog:!1}}}let bX=fc.types,mX=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eb(e,t,i,n,a,l,o,d,s,r,c,b,m){let h=d?Math.min(Ll,Math.round(d[0])):0,W=d?Math.min(Ll,Math.round(d[1])):0;e.emplaceBack(t,i,Math.round(32*n),Math.round(32*a),l,o,(h<<1)+(s?1:0),W,16*r,16*c,256*b,256*m)}function ib(e,t,i){e.emplaceBack(t,i)}function nb(e,t,i,n,a,l,o){e.emplaceBack(t,i,n,a,l,o)}function ab(e,t,i,n,a){let l=5*t+2;e.float32[l+0]=i,e.float32[l+1]=n,e.float32[l+2]=a}function Md(e,t,i,n,a){e.emplaceBack(t,i,n,a),e.emplaceBack(t,i,n,a),e.emplaceBack(t,i,n,a),e.emplaceBack(t,i,n,a)}function hX(e){for(let t of e.sections)if(Jx(t.text))return!0;return!1}class nW{constructor(t){this.layoutVertexArray=new z0,this.indexArray=new yi,this.programConfigurations=t,this.segments=new ze,this.dynamicLayoutVertexArray=new qa,this.opacityVertexArray=new E0,this.placedSymbolArray=new TZ,this.iconTransitioningVertexArray=new Xl,this.globeExtVertexArray=new L0,this.zOffsetVertexArray=new Ys}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,n,a,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,JY.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,BY.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,mX,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,CY.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,yY.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,MY.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}kt(nW,"SymbolBuffers");class aW{constructor(t,i,n){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new n,this.segments=new ze,this.collisionVertexArray=new j0,this.collisionVertexArrayExt=new qa}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,TY.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,kY.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}kt(aW,"CollisionBuffers");class lb{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=D.identity([]),this.placementViewportMatrix=D.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Oh(this.zoom,i["text-size"]),this.iconSizeData=Oh(this.zoom,i["icon-size"]);let n=this.layers[0].layout,a=n.get("symbol-sort-key"),l=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(o=>di[o]),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new nW(new yl(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new nW(new yl(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new QZ,this.lineVertexArray=new vZ,this.symbolInstances=new SZ}calculateGlyphDependencies(t,i,n,a,l){for(let o=0;o<t.length;o++){let d=t.codePointAt(o);if(d===void 0)break;if(i[d]=!0,a&&l&&d<=65535){let s=Ls[t.charAt(o)];s&&(i[s.charCodeAt(0)]=!0)}}}populate(t,i,n,a){let l=this.layers[0],o=l.layout,d=this.projection.name==="globe",s=o.get("text-font"),r=o.get("text-field"),c=o.get("icon-image"),b=(r.value.kind!=="constant"||r.value.value instanceof yn&&!r.value.value.isEmpty()||r.value.value.toString().length>0)&&(s.value.kind!=="constant"||s.value.value.length>0),m=c.value.kind!=="constant"||!!c.value.value||Object.keys(c.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!b&&!m)return;let W=i.iconDependencies,p=i.glyphDependencies,Z=i.availableImages,g=new si(this.zoom);for(let{feature:u,id:G,index:F,sourceLayerIndex:R}of t){let I=l._featureFilter.needGeometry,N=Ql(u,I);if(!l._featureFilter.filter(g,N,n))continue;if(I||(N.geometry=Ta(u,n,a)),d&&u.type!==1&&n.z<=5){let B=N.geometry,C=.98078528056,Q=(y,z)=>{let E=ks(y.x,y.y,n,1),O=ks(z.x,z.y,n,1);return S.dot(E,O)<C};for(let y=0;y<B.length;y++)B[y]=FN(B[y],Q)}let Y,X;if(b){let B=l.getValueAndResolveTokens("text-field",N,n,Z),C=yn.factory(B);hX(C)&&(this.hasRTLText=!0),(!this.hasRTLText||S0()==="unavailable"||this.hasRTLText&&ta.isParsed())&&(Y=vY(C,l,N))}if(m){let B=l.getValueAndResolveTokens("icon-image",N,n,Z);X=B instanceof qn?B:qn.fromString(B)}if(!Y&&!X)continue;let J=this.sortFeaturesByKey?h.evaluate(N,{},n):void 0;if(this.features.push({id:G,text:Y,icon:X,index:F,sourceLayerIndex:R,geometry:N.geometry,properties:u.properties,type:bX[u.type],sortKey:J}),X&&(W[X.namePrimary]=!0,X.nameSecondary&&(W[X.nameSecondary]=!0)),Y){let B=s.evaluate(N,{},n).join(","),C=o.get("text-rotation-alignment")==="map"&&o.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(di.vertical)>=0;for(let Q of Y.sections)if(Q.image)W[Q.image.namePrimary]=!0;else{let y=X0(Y.toString()),z=Q.fontStack||B,E=p[z]=p[z]||{};this.calculateGlyphDependencies(Q.text,E,C,this.allowVerticalPlacement,y)}}}o.get("symbol-placement")==="line"&&(this.features=function(u){let G={},F={},R=[],I=0;function N(B){R.push(u[B]),I++}function Y(B,C,Q){let y=F[B];return delete F[B],F[C]=y,R[y].geometry[0].pop(),R[y].geometry[0]=R[y].geometry[0].concat(Q[0]),y}function X(B,C,Q){let y=G[C];return delete G[C],G[B]=y,R[y].geometry[0].shift(),R[y].geometry[0]=Q[0].concat(R[y].geometry[0]),y}function J(B,C,Q){let y=Q?C[0][C[0].length-1]:C[0][0];return"".concat(B,":").concat(y.x,":").concat(y.y)}for(let B=0;B<u.length;B++){let C=u[B],Q=C.geometry,y=C.text?C.text.toString():null;if(!y){N(B);continue}let z=J(y,Q),E=J(y,Q,!0);if(z in F&&E in G&&F[z]!==G[E]){let O=X(z,E,Q),f=Y(z,E,R[O].geometry);delete G[z],delete F[E],F[J(y,R[f].geometry,!0)]=f,R[O].geometry=null}else z in F?Y(z,E,Q):E in G?X(z,E,Q):(N(B),G[z]=I-1,F[E]=I-1)}return R.filter(B=>B.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((u,G)=>u.sortKey-G.sortKey)}update(t,i,n,a,l){let o=Object.keys(t).length!==0;if(o&&!this.stateDependentLayers.length)return;let d=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,i,d,n,a,l),this.icon.programConfigurations.updatePaintArrays(t,i,d,n,a,l)}updateZOffset(){let t=(l,o,d)=>{n+=o,n>l.length&&l.resize(n);for(let s=-o;s<0;s++)l.emplace(s+n,d)},i=(l,o,d)=>{a+=o,a>l.length&&l.resize(a);for(let s=-o;s<0;s++)l.emplace(s+a,d)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,a=0;for(let l=0;l<this.symbolInstances.length;l++){let o=this.symbolInstances.get(l),{numHorizontalGlyphVertices:d,numVerticalGlyphVertices:s,numIconVertices:r}=o,c=o.zOffset,b=r>0;if((d>0||s>0)&&(t(this.text.zOffsetVertexArray,d,c),t(this.text.zOffsetVertexArray,s,c)),b){let{placedIconSymbolIndex:m,verticalPlacedIconSymbolIndex:h}=o;m>=0&&i(this.icon.zOffsetVertexArray,r,c),h>=0&&i(this.icon.zOffsetVertexArray,o.numVerticalIconVertices,c)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$c(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let n=this.lineVertexArray.length;if(t.segment!==void 0)for(let{x:a,y:l}of i)this.lineVertexArray.emplaceBack(a,l);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z){let g=t.indexArray,u=t.layoutVertexArray,G=t.globeExtVertexArray,F=t.segments.prepareSegment(4*i.length,u,g,this.canOverlap?o.sortKey:void 0),R=this.glyphOffsetArray.length,I=F.vertexLength,N=this.allowVerticalPlacement&&d===di.vertical?Math.PI/2:0,Y=o.text&&o.text.sections;for(let J=0;J<i.length;J++){let{tl:B,tr:C,bl:Q,br:y,texPrimary:z,texSecondary:E,pixelOffsetTL:O,pixelOffsetBR:f,minFontScaleX:L,minFontScaleY:K,glyphOffset:q,isSDF:P,sectionIndex:et}=i[J],it=F.vertexLength,at=q[1];if(eb(u,r.x,r.y,B.x,at+B.y,z.x,z.y,n,P,O.x,O.y,L,K),eb(u,r.x,r.y,C.x,at+C.y,z.x+z.w,z.y,n,P,f.x,O.y,L,K),eb(u,r.x,r.y,Q.x,at+Q.y,z.x,z.y+z.h,n,P,O.x,f.y,L,K),eb(u,r.x,r.y,y.x,at+y.y,z.x+z.w,z.y+z.h,n,P,f.x,f.y,L,K),s){let{x:$,y:ot,z:Rt}=s.anchor,[Gt,Yt,Bt]=s.up;nb(G,$,ot,Rt,Gt,Yt,Bt),nb(G,$,ot,Rt,Gt,Yt,Bt),nb(G,$,ot,Rt,Gt,Yt,Bt),nb(G,$,ot,Rt,Gt,Yt,Bt),Md(t.dynamicLayoutVertexArray,$,ot,Rt,N)}else Md(t.dynamicLayoutVertexArray,r.x,r.y,r.z,N);if(Z){let $=E||z;ib(t.iconTransitioningVertexArray,$.x,$.y),ib(t.iconTransitioningVertexArray,$.x+$.w,$.y),ib(t.iconTransitioningVertexArray,$.x,$.y+$.h),ib(t.iconTransitioningVertexArray,$.x+$.w,$.y+$.h)}g.emplaceBack(it,it+1,it+2),g.emplaceBack(it+1,it+2,it+3),F.vertexLength+=4,F.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(q[0]),J!==i.length-1&&et===i[J+1].sectionIndex||t.programConfigurations.populatePaintArrays(u.length,o,o.index,{},h,W,p,Y&&Y[et])}let X=s?s.anchor:r;t.placedSymbolArray.emplaceBack(X.x,X.y,X.z,r.x,r.y,R,this.glyphOffsetArray.length-R,I,c,b,r.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],d,0,!1,0,m,0)}_commitLayoutVertex(t,i,n,a,l,o,d){t.emplaceBack(i,n,a,l,o,Math.round(d.x),Math.round(d.y))}_addCollisionDebugVertices(t,i,n,a,l,o,d){let s=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),r=s.vertexLength,c=d.tileAnchorX,b=d.tileAnchorY;for(let h=0;h<4;h++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,i,t.padding,d.zOffset),this._commitLayoutVertex(n.layoutVertexArray,a,l,o,c,b,new H(t.x1,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,o,c,b,new H(t.x2,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,l,o,c,b,new H(t.x2,t.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,l,o,c,b,new H(t.x1,t.y2)),s.vertexLength+=4;let m=n.indexArray;m.emplaceBack(r,r+1),m.emplaceBack(r+1,r+2),m.emplaceBack(r+2,r+3),m.emplaceBack(r+3,r),s.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,n,a,l,o){for(let d=a;d<l;d++){let s=n.get(d),r=this.getSymbolInstanceTextSize(t,o,i,d);this._addCollisionDebugVertices(s,r,this.textCollisionBox,s.projectedAnchorX,s.projectedAnchorY,s.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,i,n,a,l,o){for(let d=a;d<l;d++){let s=n.get(d),r=this.getSymbolInstanceIconSize(t,i,o.placedIconSymbolIndex);this._addCollisionDebugVertices(s,r,this.iconCollisionBox,s.projectedAnchorX,s.projectedAnchorY,s.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new aW(Wc,mu.members,Xl),this.iconCollisionBox=new aW(Wc,mu.members,Xl);let n=ka(this.iconSizeData,t),a=ka(this.textSizeData,t);for(let l=0;l<this.symbolInstances.length;l++){let o=this.symbolInstances.get(l);this._addTextDebugCollisionBoxes(a,t,i,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(a,t,i,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,i,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,i,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,i,n,a){let l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),o=zs(this.textSizeData,t,l)/_i;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,i,n){let a=this.icon.placedSymbolArray.get(n),l=zs(this.iconSizeData,t,a);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(t,i,n,a){t.emplaceBack(i,-n,-n,a),t.emplaceBack(i,n,-n,a),t.emplaceBack(i,n,n,a),t.emplaceBack(i,-n,n,a)}_updateTextDebugCollisionBoxes(t,i,n,a,l,o){for(let d=a;d<l;d++){let s=n.get(d),r=this.getSymbolInstanceTextSize(t,o,i,d);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,s.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(t,i,n,a,l,o){for(let d=a;d<l;d++){let s=n.get(d),r=this.getSymbolInstanceIconSize(t,i,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,s.padding,o.zOffset)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let n=ka(this.iconSizeData,t),a=ka(this.textSizeData,t);for(let l=0;l<this.symbolInstances.length;l++){let o=this.symbolInstances.get(l);this._updateTextDebugCollisionBoxes(a,t,i,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(a,t,i,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,t,i,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,t,i,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,n,a,l,o,d,s,r){let c={};if(i<n){let{x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F,featureIndex:R}=t.get(i);c.textBox={x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F},c.textFeatureIndex=R}if(a<l){let{x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F,featureIndex:R}=t.get(a);c.verticalTextBox={x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F},c.verticalTextFeatureIndex=R}if(o<d){let{x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F,featureIndex:R}=t.get(o);c.iconBox={x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F},c.iconFeatureIndex=R}if(s<r){let{x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F,featureIndex:R}=t.get(s);c.verticalIconBox={x1:b,y1:m,x2:h,y2:W,padding:p,projectedAnchorX:Z,projectedAnchorY:g,projectedAnchorZ:u,tileAnchorX:G,tileAnchorY:F},c.verticalIconFeatureIndex=R}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){let n=t.placedSymbolArray.get(i),a=n.vertexStartIndex+4*n.numGlyphs;for(let l=n.vertexStartIndex;l<a;l+=4)t.indexArray.emplaceBack(l,l+1,l+2),t.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),n=Math.cos(t),a=[],l=[],o=[];for(let d=0;d<this.symbolInstances.length;++d){o.push(d);let s=this.symbolInstances.get(d);a.push(0|Math.round(i*s.tileAnchorX+n*s.tileAnchorY)),l.push(s.featureIndex)}return o.sort((d,s)=>a[d]-a[s]||l[s]-l[d]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex);let{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:d,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:r}=n;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),l>=0&&l!==a&&this.addIndicesForPlacedSymbol(this.text,l),o>=0&&o!==l&&o!==a&&this.addIndicesForPlacedSymbol(this.text,o),d>=0&&this.addIndicesForPlacedSymbol(this.text,d),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),r>=0&&this.addIndicesForPlacedSymbol(this.icon,r)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}kt(lb,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),lb.MAX_GLYPHS=65535,lb.addDynamicAttributes=Md;var _s=lb;let WX=Ce([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:pX}=WX,ZX=Ce([{name:"a_packed",components:4,type:"Float32"}]),{members:VX}=ZX,gX=fc.types,uX=Math.cos(Math.PI/180*37.5);class ob{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new f0,this.layoutVertexArray2=new qa,this.indexArray=new yi,this.programConfigurations=new yl(t.layers,t.zoom),this.segments=new ze,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,n,a){this.hasPattern=Eh("line",this.layers,i);let l=this.layers[0].layout.get("line-sort-key"),o=[];for(let{feature:c,id:b,index:m,sourceLayerIndex:h}of t){let W=this.layers[0]._featureFilter.needGeometry,p=Ql(c,W);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),p,n))continue;let Z=l?l.evaluate(p,{},n):void 0,g={id:b,properties:c.properties,type:c.type,sourceLayerIndex:h,index:m,geometry:W?p.geometry:Ta(c,n,a),patterns:{},sortKey:Z};o.push(g)}l&&o.sort((c,b)=>c.sortKey-b.sortKey);let{lineAtlas:d,featureIndex:s}=i,r=this.addConstantDashes(d);for(let c of o){let{geometry:b,index:m,sourceLayerIndex:h}=c;if(r&&this.addFeatureDashes(c,d),this.hasPattern){let W=Ah("line",this.layers,c,this.zoom,i);this.patternFeatures.push(W)}else this.addFeature(c,b,m,n,d.positions,i.availableImages,i.brightness);s.insert(t[m].feature,b,m,h,this.index)}}addConstantDashes(t){let i=!1;for(let n of this.layers){let a=n.paint.get("line-dasharray").value,l=n.layout.get("line-cap").value;if(a.kind!=="constant"||l.kind!=="constant")i=!0;else{let o=l.value,d=a.value;if(!d)continue;t.addDash(d,o)}}return i}addFeatureDashes(t,i){let n=this.zoom;for(let a of this.layers){let l=a.paint.get("line-dasharray").value,o=a.layout.get("line-cap").value;if(l.kind==="constant"&&o.kind==="constant")continue;let d,s;if(l.kind==="constant"){if(d=l.value,!d)continue}else d=l.evaluate({zoom:n},t);s=o.kind==="constant"?o.value:o.evaluate({zoom:n},t),i.addDash(d,s),t.patterns[a.id]=i.getKey(d,s)}}update(t,i,n,a,l){let o=Object.keys(t).length!==0;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,o?this.stateDependentLayers:this.layers,n,a,l)}addFeatures(t,i,n,a,l,o){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,n,a,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,VX)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pX),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,n,a,l,o,d){let s=this.layers[0].layout,r=s.get("line-join").evaluate(t,{}),c=s.get("line-cap").evaluate(t,{}),b=s.get("line-miter-limit"),m=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let h of i)this.addLine(h,t,r,c,b,m);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,l,o,a,d)}addLine(t,i,n,a,l,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let g=0;g<t.length-1;g++)this.totalDistance+=t[g].dist(t[g+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let d=gX[i.type]==="Polygon",s=t.length;for(;s>=2&&t[s-1].equals(t[s-2]);)s--;let r=0;for(;r<s-1&&t[r].equals(t[r+1]);)r++;if(s<(d?3:2))return;n==="bevel"&&(l=1.05);let c=this.overscaling<=16?15*tt/(512*this.overscaling):0,b=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray),m,h,W,p,Z;this.e1=this.e2=-1,d&&(m=t[s-2],Z=t[r].sub(m)._unit()._perp());for(let g=r;g<s;g++){if(W=g===s-1?d?t[r+1]:void 0:t[g+1],W&&t[g].equals(W))continue;Z&&(p=Z),m&&(h=m),m=t[g],Z=W?W.sub(m)._unit()._perp():p,p=p||Z;let u=p.add(Z);u.x===0&&u.y===0||u._unit();let G=p.x*Z.x+p.y*Z.y,F=u.x*Z.x+u.y*Z.y,R=F!==0?1/F:1/0,I=2*Math.sqrt(2-2*F),N=F<uX&&h&&W,Y=p.x*Z.y-p.y*Z.x>0;if(N&&g>r){let B=m.dist(h);if(B>2*c){let C=m.sub(m.sub(h)._mult(c/B)._round());this.updateDistance(h,C),this.addCurrentVertex(C,p,0,0,b),h=C}}let X=h&&W,J=X?n:d?"butt":a;if(X&&J==="round"&&(R<o?J="miter":R<=2&&(J="fakeround")),J==="miter"&&R>l&&(J="bevel"),J==="bevel"&&(R>2&&(J="flipbevel"),R<l&&(J="miter")),h&&this.updateDistance(h,m),J==="miter")u._mult(R),this.addCurrentVertex(m,u,0,0,b);else if(J==="flipbevel"){if(R>100)u=Z.mult(-1);else{let B=R*p.add(Z).mag()/p.sub(Z).mag();u._perp()._mult(B*(Y?-1:1))}this.addCurrentVertex(m,u,0,0,b),this.addCurrentVertex(m,u.mult(-1),0,0,b)}else if(J==="bevel"||J==="fakeround"){let B=-Math.sqrt(R*R-1),C=Y?B:0,Q=Y?0:B;if(h&&this.addCurrentVertex(m,p,C,Q,b),J==="fakeround"){let y=Math.round(180*I/Math.PI/20);for(let z=1;z<y;z++){let E=z/y;if(E!==.5){let f=E-.5;E+=E*f*(E-1)*((1.0904+G*(G*(3.55645-1.43519*G)-3.2452))*f*f+(.848013+G*(.215638*G-1.06021)))}let O=Z.sub(p)._mult(E)._add(p)._unit()._mult(Y?-1:1);this.addHalfVertex(m,O.x,O.y,!1,Y,0,b)}}W&&this.addCurrentVertex(m,Z,-C,-Q,b)}else if(J==="butt")this.addCurrentVertex(m,u,0,0,b);else if(J==="square"){let B=h?1:-1;h||this.addCurrentVertex(m,u,B,B,b),this.addCurrentVertex(m,u,0,0,b),h&&this.addCurrentVertex(m,u,B,B,b)}else J==="round"&&(h&&(this.addCurrentVertex(m,p,0,0,b),this.addCurrentVertex(m,p,1,1,b,!0)),W&&(this.addCurrentVertex(m,Z,-1,-1,b,!0),this.addCurrentVertex(m,Z,0,0,b)));if(N&&g<s-1){let B=m.dist(W);if(B>2*c){let C=m.add(W.sub(m)._mult(c/B)._round());this.updateDistance(m,C),this.addCurrentVertex(C,Z,0,0,b),m=C}}}}addCurrentVertex(t,i,n,a,l,o=!1){let d=i.y*a-i.x,s=-i.y-i.x*a;this.addHalfVertex(t,i.x+i.y*n,i.y-i.x*n,o,!1,n,l),this.addHalfVertex(t,d,s,o,!0,-a,l)}addHalfVertex({x:t,y:i},n,a,l,o,d,s){this.layoutVertexArray.emplaceBack((t<<1)+(l?1:0),(i<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(d===0?0:d<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let r=s.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,r),s.primitiveLength++),o?this.e2=r:this.e1=r}updateScaledDistance(){if(this.lineClips){let t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}kt(ob,"LineBucket",{omit:["layers","patternFeatures"]});class bi{constructor(t,i,n,a){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(i,a)}update(t,i,n){let{width:a,height:l}=t,{context:o}=this,{gl:d}=o,{HTMLImageElement:s,HTMLCanvasElement:r,HTMLVideoElement:c,ImageData:b,ImageBitmap:m}=T;if(d.bindTexture(d.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA&&(!i||i.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===l){let{x:h,y:W}=n||{x:0,y:0};if(t instanceof s||t instanceof r||t instanceof c||t instanceof b||m&&t instanceof m)d.texSubImage2D(d.TEXTURE_2D,0,h,W,d.RGBA,d.UNSIGNED_BYTE,t);else{let p=this.format,Z=d.UNSIGNED_BYTE;this.format===d.R32F&&(p=d.RED,Z=d.FLOAT),d.texSubImage2D(d.TEXTURE_2D,0,h,W,a,l,p,Z,t.data)}}else if(this.size=[a,l],t instanceof s||t instanceof r||t instanceof c||t instanceof b||m&&t instanceof m){let h=this.format;this.format===d.R8&&(h=d.RED),d.texImage2D(d.TEXTURE_2D,0,this.format,h,d.UNSIGNED_BYTE,t)}else{let h=this.format,W=this.format,p=d.UNSIGNED_BYTE;this.format===d.DEPTH_COMPONENT&&(h=d.DEPTH_COMPONENT16,p=d.UNSIGNED_SHORT),this.format===d.R32F&&(p=d.FLOAT,W=d.RED),d.texImage2D(d.TEXTURE_2D,0,h,a,l,0,W,p,t.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(t,i){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?t===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,n,a){let{context:l}=this,{gl:o}=l;o.bindTexture(o.TEXTURE_2D,this.texture),i!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),n!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,n),this.wrapS=n),a!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class db{constructor(t,i){this.context=t,this.texture=i}bind(t,i){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}let la=32,Sa=33,Al=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,n=0,a=0,l=0,o=0,d=0;for(1&t?a=l=o=la:i=n=d=la;(t>>=1)>1;){let r=i+a>>1,c=n+l>>1;1&t?(a=i,l=n,i=o,n=d):(i=a,n=l,a=o,l=d),o=r,d=c}let s=4*e;Al[s+0]=i,Al[s+1]=n,Al[s+2]=a,Al[s+3]=l}let Qa=new Uint16Array(2178),wl=new Uint8Array(1089),sb=new Uint16Array(1089);function Au(e){return e===0?-.03125:e===32?.03125:0}var lW=Ce([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let wu={type:2,extent:tt,loadGeometry:()=>[[new H(0,0),new H(tt+1,0),new H(tt+1,tt+1),new H(0,tt+1),new H(0,0)]]};class Ks{constructor(t,i,n,a,l){this.tileID=t,this.uid=Wa(),this.uses=0,this.tileSize=i,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=l,a&&a.style&&(this._lastUpdatedBrightness=a.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(t){let i=t+this.timeAdded;i<ee.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Io(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,n){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(a,l){let o={};if(!l)return o;for(let d of a){let s=d.layerIds.map(r=>l.getLayer(r)).filter(Boolean);if(s.length!==0){d.layers=s,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(r=>s.filter(c=>c.id===r)[0]));for(let r of s)o[r.fqid]=d}}return o}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(let a in this.buckets){let l=this.buckets[a];if(l instanceof _s){if(this.hasSymbolBuckets=!0,!n)break;l.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let a in this.buckets){let l=this.buckets[a];if(l instanceof _s&&l.hasRTLText){this.hasRTLText=!0,ta.isLoading()||ta.isLoaded()||S0()!=="deferred"||NZ();break}}this.queryPadding=0;for(let a in this.buckets){let l=this.buckets[a],o=i.style.getOwnLayer(a);if(!o)continue;let d=o.queryRadius(l);this.queryPadding=Math.max(this.queryPadding,d)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new q0}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let n in this.buckets){let a=this.buckets[n];a.uploadPending()&&a.upload(t)}let i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bi(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bi(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new bi(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,i,n){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,n),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let a=i.style.getBrightness();(this._lastUpdatedBrightness||a)&&(this._lastUpdatedBrightness&&a&&Math.abs(this._lastUpdatedBrightness-a)<.001||(this._lastUpdatedBrightness=a,this.updateBuckets(void 0,i)))}queryRenderedFeatures(t,i,n,a,l,o,d,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:d,transform:o,params:l,tileTransform:this.tileTransform},t,i,n):{}}querySourceFeatures(t,i){let n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;let a=n.loadVTLayers(),l=i?i.sourceLayer:"",o=a._geojsonTileLayer||a[l];if(!o)return;let d=ic(i&&i.filter),{z:s,x:r,y:c}=this.tileID.canonical,b={z:s,x:r,y:c};for(let m=0;m<o.length;m++){let h=o.feature(m);if(d.needGeometry){let Z=Ql(h,!0);if(!d.filter(new si(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!d.filter(new si(this.tileID.overscaledZ),h))continue;let W=n.getId(h,l),p=new nu(h,s,r,c,W);p.tile=b,t.push(p)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let i=this.expirationTime;if(t.cacheControl){let n=Lt(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let n=Date.now(),a=!1;if(this.expirationTime>n)a=!1;else if(i)if(this.expirationTime<i)a=!0;else{let l=this.expirationTime-i;l?this.expirationTime=n+Math.max(l,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&i&&this.updateBuckets(t,i)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;let n=this.latestFeatureIndex.loadVTLayers(),a=i.style.listImages(),l=i.style.getBrightness();for(let o in this.buckets){if(!i.style.hasLayer(o))continue;let d=this.buckets[o],s=d.layers[0].sourceLayer||"_geojsonTileLayer",r=n[s],c={};if(t&&(c=t[s],!r||!c||Object.keys(c).length===0))continue;if(d.update(c,r,a,this.imageAtlas&&this.imageAtlas.patternPositions||{},l),d instanceof ob||d instanceof Qc){let m=i.style.getOwnSourceCache(d.layers[0].source);i._terrain&&i._terrain.enabled&&m&&d.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(m.id,this.tileID)}let b=i&&i.style&&i.style.getOwnLayer(o);b&&(this.queryPadding=Math.max(this.queryPadding,b.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ee.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ee.now()+t}setTexture(t,i){let n=i.context,a=n.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof bi?this.texture.update(t,{useMipmap:!0}):(this.texture=new bi(n,t,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE))}setDependencies(t,i){let n={};for(let a of i)n[a]=!0;this.dependencies[t]=n}hasDependency(t,i){for(let n of t){let a=this.dependencies[n];if(a){for(let l of i)if(a[l])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;let n=Ta(wu,this.tileID.canonical,this.tileTransform)[0],a=new Mn,l=new Xs;for(let o=0;o<n.length;o++){let{x:d,y:s}=n[o];a.emplaceBack(d,s),l.emplaceBack(o)}l.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,Ml.members),this._tileDebugSegments=ze.simpleSegment(0,0,a.length,l.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;let n=Ta(wu,this.tileID.canonical,this.tileTransform)[0],a,l;if(this.isRaster){let o=function(d,s){let r=Io(d,s),c=Math.pow(2,d.z);for(let Z=0;Z<Sa;Z++)for(let g=0;g<Sa;g++){let u=kn((d.x+(g+Au(g))/la)/c),G=Bi((d.y+(Z+Au(Z))/la)/c),F=s.project(u,G),R=Z*Sa+g;Qa[2*R+0]=Math.round((F.x*r.scale-r.x)*tt),Qa[2*R+1]=Math.round((F.y*r.scale-r.y)*tt)}wl.fill(0),sb.fill(0);for(let Z=2045;Z>=0;Z--){let g=4*Z,u=Al[g+0],G=Al[g+1],F=Al[g+2],R=Al[g+3],I=u+F>>1,N=G+R>>1,Y=I+N-G,X=N+u-I,J=G*Sa+u,B=R*Sa+F,C=N*Sa+I,Q=Math.hypot((Qa[2*J+0]+Qa[2*B+0])/2-Qa[2*C+0],(Qa[2*J+1]+Qa[2*B+1])/2-Qa[2*C+1])>=16;wl[C]=wl[C]||(Q?1:0),Z<1022&&(wl[C]=wl[C]||wl[(G+X>>1)*Sa+(u+Y>>1)]||wl[(R+X>>1)*Sa+(F+Y>>1)])}let b=new Zo,m=new yi,h=0;function W(Z,g){let u=g*Sa+Z;return sb[u]===0&&(b.emplaceBack(Qa[2*u+0],Qa[2*u+1],Z*tt/la,g*tt/la),sb[u]=++h),sb[u]-1}function p(Z,g,u,G,F,R){let I=Z+u>>1,N=g+G>>1;if(Math.abs(Z-F)+Math.abs(g-R)>1&&wl[N*Sa+I])p(F,R,Z,g,I,N),p(u,G,F,R,I,N);else{let Y=W(Z,g),X=W(u,G),J=W(F,R);m.emplaceBack(Y,X,J)}}return p(0,0,la,la,la,0),p(la,la,0,0,0,la),{vertices:b,indices:m}}(this.tileID.canonical,i);a=o.vertices,l=o.indices}else{a=new Zo,l=new yi;for(let{x:d,y:s}of n)a.emplaceBack(d,s,0,0);let o=Sc(a.int16,void 0,4);for(let d=0;d<o.length;d+=3)l.emplaceBack(o[d],o[d+1],o[d+2])}this._tileBoundsBuffer=t.createVertexBuffer(a,lW.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(l),this._tileBoundsSegments=ze.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugBuffers(t,i){let n=i.projection;if(!n||n.name!=="globe"||i.freezeTileCoverage)return;let a=this.tileID.canonical,l=Tl(Wg(a,i)),o=Di(i.zoom),d;o>0&&(d=D.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,a,i,l,d,o),this._makeGlobeTileDebugTextBuffer(t,a,i,l,d,o)}_globePoint(t,i,n,a,l,o,d){let s=ks(t,i,n);if(o){let r=1<<n.z,c=Qi(a.center.lng),b=Li(a.center.lat),m=(n.x+.5)/r-c,h=0;m>.5?h=-1:m<-.5&&(h=1);let W=(t/tt+n.x)/r+h,p=(i/tt+n.y)/r;W=(W-c)*a._pixelsPerMercatorPixel+c,p=(p-b)*a._pixelsPerMercatorPixel+b;let Z=[W*a.worldSize,p*a.worldSize,0];S.transformMat4(Z,Z,o),s=ol(s,Z,d)}return S.transformMat4(s,s,l)}_makeGlobeTileDebugBorderBuffer(t,i,n,a,l,o){let d=new Mn,s=new Xs,r=new bc,c=(m,h,W,p,Z)=>{let g=(W-m)/(Z-1),u=(p-h)/(Z-1),G=d.length;for(let F=0;F<Z;F++){let R=m+F*g,I=h+F*u;d.emplaceBack(R,I);let N=this._globePoint(R,I,i,n,a,l,o);r.emplaceBack(N[0],N[1],N[2]),s.emplaceBack(G+F)}},b=tt;c(0,0,b,0,16),c(b,0,b,b,16),c(b,b,0,b,16),c(0,b,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(d,Ml.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(r,dg.members),this._tileDebugSegments=ze.simpleSegment(0,0,d.length,s.length)}_makeGlobeTileDebugTextBuffer(t,i,n,a,l,o){let d=tt/4,s=new Mn,r=new yi,c=new bc,b=25;r.reserve(32),s.reserve(b),c.reserve(b);let m=(h,W)=>b*h+W;for(let h=0;h<b;h++){let W=h*d;for(let p=0;p<b;p++){let Z=p*d;s.emplaceBack(Z,W);let g=this._globePoint(Z,W,i,n,a,l,o);c.emplaceBack(g[0],g[1],g[2])}}for(let h=0;h<4;h++)for(let W=0;W<4;W++){let p=m(h,W),Z=m(h,W+1),g=m(h+1,W),u=m(h+1,W+1);r.emplaceBack(p,Z,g),r.emplaceBack(g,Z,u)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(r),this._tileDebugTextBuffer=t.createVertexBuffer(s,Ml.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(c,dg.members),this._tileDebugTextSegments=ze.simpleSegment(0,0,b,32)}destroy(t=!1){for(let i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof bi&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class RX{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(let t in this.data)for(let i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,n){let a=t.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);let l={value:i,timeout:void 0};if(n!==void 0&&(l.timeout=setTimeout(()=>{this.remove(t,l)},n)),this.data[a].push(l),this.order.push(a),this.order.length>this.max){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){let i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;let n=t.wrapped().key,a=i===void 0?0:this.data[n].indexOf(i),l=this.data[n][a];return this.data[n].splice(a,1),l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(l.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){let i=[];for(let n in this.data)for(let a of this.data[n])t(a.value)||i.push(a);for(let n of i)this.remove(n.value.tileID,n)}}class jl{constructor(t,i,n,a){this.id=jl.uniqueIdxCounter,jl.uniqueIdxCounter++,this.context=t;let l=t.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!n,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||a||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=jl.uniqueIdxCounter,jl.uniqueIdxCounter++;let i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}jl.uniqueIdxCounter=0;let GX={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class FX{constructor(t,i,n,a,l,o){this.length=i.length,this.attributes=n,this.itemSize=i.bytesPerElement,this.dynamicDraw=a,this.instanceCount=o,this.context=t;let d=t.gl;this.buffer=d.createBuffer(),t.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||l||i.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,i){for(let n=0;n<this.attributes.length;n++){let a=i.attributes[this.attributes[n].name];a!==void 0&&t.enableVertexAttribArray(a)}}setVertexAttribPointers(t,i,n){for(let a=0;a<this.attributes.length;a++){let l=this.attributes[a],o=i.attributes[l.name];o!==void 0&&t.vertexAttribPointer(o,l.components,t[GX[l.type]],!1,this.itemSize,l.offset+this.itemSize*(n||0))}}setVertexAttribDivisor(t,i,n){for(let a=0;a<this.attributes.length;a++){let l=i.attributes[this.attributes[a].name];l!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(l,n)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ni{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class IX extends ni{getDefault(){return re.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class UX extends ni{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class xX extends ni{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class NX extends ni{getDefault(){return[!0,!0,!0,!0]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class YX extends ni{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class XX extends ni{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class JX extends ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let i=this.current;(t.func!==i.func||t.ref!==i.ref||t.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class yX extends ni{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class BX extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=t,this.dirty=!1}}class MX extends ni{getDefault(){return[0,1]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class CX extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=t,this.dirty=!1}}class TX extends ni{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class kX extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.BLEND):i.disable(i.BLEND),this.current=t,this.dirty=!1}}class SX extends ni{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class QX extends ni{getDefault(){return re.transparent}set(t){let i=this.current;(t.r!==i.r||t.g!==i.g||t.b!==i.b||t.a!==i.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vX extends ni{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class fX extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;t?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=t,this.dirty=!1}}class zX extends ni{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class LX extends ni{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let EX=class extends ni{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class AX extends ni{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class wX extends ni{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let i=this.current;(t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class jX extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class HX extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class OX extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindTexture(i.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class DX extends ni{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class _X extends ni{getDefault(){return null}set(t){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class KX extends ni{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class PX extends ni{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class qX extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class $X extends ni{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class oW extends ni{constructor(t,i){super(t),this.context=t,this.parent=i}getDefault(){return null}}class tJ extends oW{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ju extends oW{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,this.attachment(),i.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class eJ extends oW{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,this.attachment(),i.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class iJ extends ju{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class nJ{constructor(t,i,n,a,l){this.context=t,this.width=i,this.height=n;let o=this.framebuffer=t.gl.createFramebuffer();a&&(this.colorAttachment=new tJ(t,o)),l&&(this.depthAttachmentType=l,this.depthAttachment=l==="renderbuffer"?new ju(t,o):new eJ(t,o))}destroy(){let t=this.context.gl;if(this.colorAttachment){let i=this.colorAttachment.get();i&&t.deleteTexture(i)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let i=this.depthAttachment.get();i&&t.deleteRenderbuffer(i)}else{let i=this.depthAttachment.get();i&&t.deleteTexture(i)}t.deleteFramebuffer(this.framebuffer)}}class Ot{constructor(t,i,n){this.func=t,this.mask=i,this.range=n}}Ot.ReadOnly=!1,Ot.ReadWrite=!0,Ot.disabled=new Ot(519,Ot.ReadOnly,[0,1]);let dW=7680;class ce{constructor(t,i,n,a,l,o){this.test=t,this.ref=i,this.mask=n,this.fail=a,this.depthFail=l,this.pass=o}}ce.disabled=new ce({func:519,mask:0},0,0,dW,dW,dW);let rb=771;class Ne{constructor(t,i,n,a){this.blendFunction=t,this.blendColor=i,this.mask=n,this.blendEquation=a}}Ne.Replace=[1,0,1,0],Ne.disabled=new Ne(Ne.Replace,re.transparent,[!1,!1,!1,!1]),Ne.unblended=new Ne(Ne.Replace,re.transparent,[!0,!0,!0,!0]),Ne.alphaBlended=new Ne([1,rb,1,rb],re.transparent,[!0,!0,!0,!0]),Ne.multiply=new Ne([774,0,774,0],re.transparent,[!0,!0,!0,!0]);let sW=1029,rW=2305;class me{constructor(t,i,n){this.enable=t,this.mode=i,this.frontFace=n}}me.disabled=new me(!1,sW,rW),me.backCCW=new me(!0,sW,rW),me.backCW=new me(!0,sW,2304),me.frontCW=new me(!0,1028,2304),me.frontCCW=new me(!0,1028,rW);class aJ{constructor(t,i){this.gl=t,this.clearColor=new IX(this),this.clearDepth=new UX(this),this.clearStencil=new xX(this),this.colorMask=new NX(this),this.depthMask=new YX(this),this.stencilMask=new XX(this),this.stencilFunc=new JX(this),this.stencilOp=new yX(this),this.stencilTest=new BX(this),this.depthRange=new MX(this),this.depthTest=new CX(this),this.depthFunc=new TX(this),this.blend=new kX(this),this.blendFunc=new SX(this),this.blendColor=new QX(this),this.blendEquation=new vX(this),this.cullFace=new fX(this),this.cullFaceSide=new zX(this),this.frontFace=new LX(this),this.program=new EX(this),this.activeTexture=new AX(this),this.viewport=new wX(this),this.bindFramebuffer=new jX(this),this.bindRenderbuffer=new HX(this),this.bindTexture=new OX(this),this.bindVertexBuffer=new DX(this),this.bindElementBuffer=new _X(this),this.bindVertexArrayOES=new KX(this),this.pixelStoreUnpack=new PX(this),this.pixelStoreUnpackPremultiplyAlpha=new qX(this),this.pixelStoreUnpackFlipY=new $X(this),this.options=i?{...i}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,i,n){return new jl(this,t,i,n)}createVertexBuffer(t,i,n,a,l){return new FX(this,t,i,n,a,l)}createRenderbuffer(t,i,n){let a=this.gl,l=a.createRenderbuffer();return this.bindRenderbuffer.set(l),a.renderbufferStorage(a.RENDERBUFFER,t,i,n),this.bindRenderbuffer.set(null),l}createFramebuffer(t,i,n,a){return new nJ(this,t,i,n,a)}clear({color:t,depth:i,stencil:n,colorMask:a}){let l=this.gl,o=0;t&&(o|=l.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(a||[!0,!0,!0,!0])),i!==void 0&&(o|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),n!==void 0&&(o|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),l.clear(o)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){te(t.blendFunction,Ne.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Fa extends Xi{constructor(t,i,n){super(),this.id=t,this._onlySymbols=n,i.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new RX(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new IY,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let i=this._tiles[t];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let i in this._tiles){let n=this._tiles[i];n.upload(t),n.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Dn(this._tiles).map(t=>t.tileID).sort(Hu).map(t=>t.key)}getRenderableIds(t,i){let n=[];for(let a in this._tiles)this._isIdRenderable(+a,t,i)&&n.push(this._tiles[a]);return t?n.sort((a,l)=>{let o=a.tileID,d=l.tileID,s=new H(o.canonical.x,o.canonical.y)._rotate(this.transform.angle),r=new H(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return o.overscaledZ-d.overscaledZ||r.y-s.y||r.x-s.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Hu).map(a=>a.key)}hasRenderableParent(t){let i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())&&(n||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){let n=this._tiles[t];n&&(n.state!=="loading"&&(n.state=i),this._loadTile(n,this._tileLoaded.bind(this,n,t,i)))}_tileLoaded(t,i,n,a){if(a)if(t.state="errored",a.status!==404)this._source.fire(new $t(a,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Wt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let l=this.map.painter.terrain;this.update(this.transform,l.getScaledDemTileSize(),!0),l.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=ee.now(),n==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Wt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let i=this.getRenderableIds();for(let a=0;a<i.length;a++){let l=i[a];if(t.neighboringTiles&&t.neighboringTiles[l]){let o=this.getTileByID(l);n(t,o),n(o,t)}}function n(a,l){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let o=l.tileID.canonical.x-a.tileID.canonical.x,d=l.tileID.canonical.y-a.tileID.canonical.y,s=Math.pow(2,a.tileID.canonical.z),r=l.tileID.key;o===0&&d===0||Math.abs(d)>1||(Math.abs(o)>1&&(Math.abs(o+s)===1?o+=s:Math.abs(o-s)===1&&(o-=s)),l.dem&&a.dem&&(a.dem.backfillBorder(l.dem,o,d),a.neighboringTiles&&a.neighboringTiles[r]&&(a.neighboringTiles[r].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,n,a){for(let l in this._tiles){let o=this._tiles[l];if(a[l]||!o.hasData()||o.tileID.overscaledZ<=i||o.tileID.overscaledZ>n)continue;let d=o.tileID;for(;o&&o.tileID.overscaledZ>i+1;){let r=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[r.key],o&&o.hasData()&&(d=r)}let s=d;for(;s.overscaledZ>i;)if(s=s.scaledTo(s.overscaledZ-1),t[s.key]){a[d.key]=d;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){let n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=i?n:null}for(let n=t.overscaledZ-1;n>=i;n--){let a=t.scaledTo(n),l=this._getLoadedTile(a);if(l)return l}}_getLoadedTile(t){let i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;let n=Math.ceil(t.width/i)+1,a=Math.ceil(t.height/i)+1,l=Math.floor(n*a*5),o=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,l):l,d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(d)}handleWrapJump(t){let i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){let n={};for(let a in this._tiles){let l=this._tiles[a];l.tileID=l.tileID.unwrapTo(l.tileID.wrap+i),n[l.tileID.key]=l}this._tiles=n;for(let a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(let a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(t,i,n,a){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let l;if(this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(s=>new Xe(s.canonical.z,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y)):(l=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(s=>this._source.hasTile(s)))):l=[],l.length>0&&this.castsShadows&&a&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!cW(this._source.type)){let s=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),r=Math.min(s,this._source.maxzoom),c=t.extendTileCoverForShadows(l,a,r);for(let b of c)this._shadowCasterTiles[b.key]=!0,l.push(b)}let o=this._updateRetainedTiles(l);if(cW(this._source.type)&&l.length!==0){let s={},r={},c=Object.keys(o);for(let m of c){let h=o[m],W=this._tiles[m];if(!W||W.fadeEndTime&&W.fadeEndTime<=ee.now())continue;let p=this.findLoadedParent(h,Math.max(h.overscaledZ-Fa.maxOverzooming,this._source.minzoom));p&&(this._addTile(p.tileID),s[p.tileID.key]=p.tileID),r[m]=h}let b=l[l.length-1].overscaledZ;for(let m in this._tiles){let h=this._tiles[m];if(o[m]||!h.hasData())continue;let W=h.tileID;for(;W.overscaledZ>b;){W=W.scaledTo(W.overscaledZ-1);let p=this._tiles[W.key];if(p&&p.hasData()&&r[W.key]){o[m]=h.tileID;break}}}for(let m in s)o[m]||(this._coveredTiles[m]=!0,o[m]=s[m])}for(let s in o)this._tiles[s].clearFadeHold();let d=function(s,r){let c=[];for(let b in s)b in r||c.push(b);return c}(this._tiles,o);for(let s of d){let r=this._tiles[s];r.hasSymbolBuckets&&!r.holdingForFade()?r.setHoldDuration(this.map._fadeDuration):r.hasSymbolBuckets&&!r.symbolFadeFinished()||this._removeTile(+s)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let i={};if(t.length===0)return i;let n={},a=t.reduce((r,c)=>Math.min(r,c.overscaledZ),1/0),l=t[0].overscaledZ,o=Math.max(l-Fa.maxOverzooming,this._source.minzoom),d=Math.max(l+Fa.maxUnderzooming,this._source.minzoom),s={};for(let r of t){let c=this._addTile(r);i[r.key]=r,c.hasData()||a<this._source.maxzoom&&(s[r.key]=r)}this._retainLoadedChildren(s,a,d,i);for(let r of t){let c=this._tiles[r.key];if(c.hasData())continue;if(r.canonical.z>=this._source.maxzoom){let m=r.children(this._source.maxzoom)[0],h=this.getTile(m);if(h&&h.hasData()){i[m.key]=m;continue}}else{let m=r.children(this._source.maxzoom);if(i[m[0].key]&&i[m[1].key]&&i[m[2].key]&&i[m[3].key])continue}let b=c.wasRequested();for(let m=r.overscaledZ-1;m>=o;--m){let h=r.scaledTo(m);if(n[h.key]||(n[h.key]=!0,c=this.getTile(h),!c&&b&&(c=this._addTile(h)),c&&(i[h.key]=h,b=c.wasRequested(),c.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let i=[],n,a=this._tiles[t].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){n=this._loadedParentTiles[a.key];break}i.push(a.key);let l=a.scaledTo(a.overscaledZ-1);if(n=this._getLoadedTile(l),n)break;a=l}for(let l of i)this._loadedParentTiles[l]=n}}_addTile(t){let i=this._tiles[t.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));let n=!!i;if(!n){let a=this.map?this.map.painter:null;i=new Ks(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,n||this._source.fire(new Wt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let n=i.getExpiryTimeout();n&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},n))}_removeTile(t){let i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,n){let a=[],l=this.transform;if(!l)return a;let o=l.projection.name==="globe",d=Qi(l.center.lng);for(let s in this._tiles){let r=this._tiles[s];if(n&&r.clearQueryDebugViz(),r.holdingForFade())continue;let c;if(o){let b=r.tileID.canonical;if(b.z===0){let m=[Math.abs(Mt(d,...Ps(b,-1))-d),Math.abs(Mt(d,...Ps(b,1))-d)];c=[0,2*m.indexOf(Math.min(...m))-1]}else{let m=[Math.abs(Mt(d,...Ps(b,-1))-d),Math.abs(Mt(d,...Ps(b,0))-d),Math.abs(Mt(d,...Ps(b,1))-d)];c=[m.indexOf(Math.min(...m))-1]}}else c=[0];for(let b of c){let m=t.containsTile(r,l,i,b);m&&a.push(m)}}return a}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,i){let n=this.getRenderableIds(t,i).map(l=>this._tiles[l].tileID),a=this.transform.projection.name==="globe";for(let l of n)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped()),l.expandedProjMatrix=a?this.transform.calculateProjMatrix(l.toUnwrapped(),!1,!0):l.projMatrix;return n}sortCoordinatesByDistance(t){let i=t.slice(),n=this.transform._camera.position,a=this.transform._camera.forward(),l={};for(let o of i){let d=1/(1<<o.canonical.z);l[o.key]=((o.canonical.x+.5)*d+o.wrap-n[0])*a[0]+((o.canonical.y+.5)*d-n[1])*a[1]-n[2]*a[2]}return i.sort((o,d)=>l[o.key]-l[d.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(cW(this._source.type))for(let t in this._tiles){let i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ee.now())return!0}return!1}setFeatureState(t,i,n){this._state.updateState(t=t||"_geojsonTileLayer",i,n)}removeFeatureState(t,i,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,n)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,n){let a=this._tiles[t];a&&a.setDependencies(i,n)}reloadTilesForDependencies(t,i){for(let n in this._tiles)this._tiles[n].hasDependency(t,i)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){let d=()=>{this._sourceLoaded&&(this._source.off("data",d),this._preloadTiles(t,i))};return void this._source.on("data",d)}let n=new Map,a=Array.isArray(t)?t:[t],l=this.map.painter.terrain,o=this.usedForTerrain&&l?l.getScaledDemTileSize():this._source.tileSize;for(let d of a){let s=d.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let r of s)n.set(r.key,r);this.usedForTerrain&&d.updateElevation(!1)}Ln(Array.from(n.values()),(d,s)=>{let r=new Ks(d,this._source.tileSize*d.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,c=>{this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),s(c,r)})},i)}}function Hu(e,t){let i=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function cW(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function Ps(e,t){let i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}Fa.maxOverzooming=10,Fa.maxUnderzooming=3;let lJ=Ce([{name:"a_pos_3f",components:3,type:"Float32"}]),oJ=Ce([{name:"a_color_3f",components:3,type:"Float32"}]),dJ=Ce([{name:"a_color_4f",components:4,type:"Float32"}]),sJ=Ce([{name:"a_uv_2f",components:2,type:"Float32"}]),rJ=Ce([{name:"a_normal_3f",components:3,type:"Float32"}]),cJ=Ce([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bJ=Ce([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class bW{constructor(t=0,i=0,n=0,a=0){if(isNaN(t)||t<0||isNaN(i)||i<0||isNaN(n)||n<0||isNaN(a)||a<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=i,this.left=n,this.right=a}interpolate(t,i,n){return i.top!=null&&t.top!=null&&(this.top=Pt(t.top,i.top,n)),i.bottom!=null&&t.bottom!=null&&(this.bottom=Pt(t.bottom,i.bottom,n)),i.left!=null&&t.left!=null&&(this.left=Pt(t.left,i.left,n)),i.right!=null&&t.right!=null&&(this.right=Pt(t.right,i.right,n)),this}getCenter(t,i){let n=Mt((this.left+t-this.right)/2,0,t),a=Mt((this.top+i-this.bottom)/2,0,i);return new H(n,a)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new bW(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ou(e,t){let i=li(e,3);D.fromQuat(e,t),Ti(e,3,i)}function mW(e,t){let i=an.identity([]);return an.rotateZ(i,i,-t),an.rotateX(i,i,-e),i}function Du(e,t){let i=[e[0],e[1],0],n=[t[0],t[1],0];if(S.length(i)>=1e-15){let o=S.normalize([],i);S.scale(n,o,S.dot(n,o)),t[0]=n[0],t[1]=n[1]}let a=S.cross([],t,e);if(S.len(a)<1e-15)return null;let l=Math.atan2(-a[1],a[0]);return mW(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),l)}class _u{constructor(t,i){this.position=t,this.orientation=i}get position(){return this._position}set position(t){if(t){let i=t instanceof Re?t:new Re(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=Nn(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;let n=this.position,a=this._elevation?this._elevation.getAtPointOrZero(Re.fromLngLat(t)):0,l=Re.fromLngLat(t,a),o=[l.x-n.x,l.y-n.y,l.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Du(o,i)}setPitchBearing(t,i){this.orientation=mW(At(t),At(-i))}}class cb{constructor(t,i){this._transform=D.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){let t=this.position;return new Re(t[0],t[1],t[2])}get position(){let t=li(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&Ti(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||an.identity([]),t&&Ou(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),i=this.right();return{bearing:Math.atan2(-i[1],i[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,i){this._orientation=mW(t,i),Ou(this._transform,this._orientation)}forward(){let t=li(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=li(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=li(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){let n=new Float64Array(16);return D.invert(n,this.getWorldToCamera(t,i)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,n){let a=this.position;S.scale(a,a,-t);let l=new Float64Array(16);return D.fromScaling(l,[n,n,n]),D.translate(l,l,a),l[10]*=i,l}getWorldToCamera(t,i){let n=new Float64Array(16),a=new Float64Array(4),l=this.position;return an.conjugate(a,this._orientation),S.scale(l,l,-t),D.fromQuat(n,a),D.translate(n,n,l),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(t,i,n,a){let l=new Float64Array(16);return D.perspective(l,t,i,n,a),l}getCameraToClipOrthographic(t,i,n,a,l,o){let d=new Float64Array(16);return D.ortho(d,t,i,n,a,l,o),d}getDistanceToElevation(t,i=!1){let n=t===0?0:He(t,i?Bi(this.position[1]):this.position[1]),a=this.forward();return(n-this.position[2])/a[2]}clone(){return new cb([...this.position],[...this.orientation])}}function Ku(e,t){let i=qs(e.projection,e.zoom,e.width,e.height),n=function(l,o,d,s,r){let c=new qt(d.lng-180*Hl,d.lat),b=new qt(d.lng+180*Hl,d.lat),m=l.project(c.lng,c.lat),h=l.project(b.lng,b.lat),W=-Math.atan2(h.y-m.y,h.x-m.x),p=Re.fromLngLat(d);p.y=Mt(p.y,-1+Hl,1-Hl);let Z=p.toLngLat(),g=l.project(Z.lng,Z.lat),u=Re.fromLngLat(Z);u.x+=Hl;let G=u.toLngLat(),F=l.project(G.lng,G.lat),R=$u(F.x-g.x,F.y-g.y,W),I=Re.fromLngLat(Z);I.y+=Hl;let N=I.toLngLat(),Y=l.project(N.lng,N.lat),X=$u(Y.x-g.x,Y.y-g.y,W),J=Math.abs(R.x)/Math.abs(X.y),B=D.identity([]);D.rotateZ(B,B,-W*(1-(r?0:s)));let C=D.identity([]);return D.scale(C,C,[1,1-(1-J)*s,1]),C[4]=-X.x/X.y*s,D.rotateZ(C,C,W),D.multiply(C,B,C),C}(e.projection,0,e.center,i,t),a=Pu(e);return D.scale(n,n,[a,a,1]),n}function Pu(e){let t=e.projection,i=qs(e.projection,e.zoom,e.width,e.height),n=qu(t,e.center),a=qu(t,qt.convert(t.center));return Math.pow(2,n*i+(1-i)*a)}function qs(e,t,i,n,a=1/0){let l=e.range;if(!l)return 0;let o=Math.min(a,Math.max(i,n)),d=Math.log(o/1024)/Math.LN2;return pn(l[0]+d,l[1]+d,t)}let Hl=1/4e4;function qu(e,t){let i=Mt(t.lat,-ui,ui),n=new qt(t.lng-180*Hl,i),a=new qt(t.lng+180*Hl,i),l=e.project(n.lng,i),o=e.project(a.lng,i),d=Re.fromLngLat(n),s=Re.fromLngLat(a),r=o.x-l.x,c=o.y-l.y,b=s.x-d.x,m=s.y-d.y,h=Math.sqrt((b*b+m*m)/(r*r+c*c));return Math.log(h)/Math.LN2}function $u(e,t,i){let n=Math.cos(i),a=Math.sin(i);return{x:e*n-t*a,y:e*a+t*n}}function Uo(e,t,i){return t*(tt/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}let Cd={unknown:0,flipRequired:1,flipNotRequired:2},mJ=Math.tan(85*Math.PI/180);function bb(e,t,i,n,a,l,o){let d=D.create();if(i)if(l.name==="globe"){let s=function(r,c){let{x:b,y:m}=r.point,h=gg(b,m,r.worldSize/r._pixelsPerMercatorPixel,0,0);return D.multiply(h,h,xh(jn(c)))}(a,t);D.multiply(d,d,s)}else{let s=Zd.invert([],o);d[0]=s[0],d[1]=s[1],d[4]=s[2],d[5]=s[3],n||D.rotateZ(d,d,a.angle)}else D.multiply(d,a.labelPlaneMatrix,e);return d}function tR(e,t,i,n,a,l,o){let d=bb(e,t,i,n,a,l,o);return l.name==="globe"&&i||(d[2]=d[6]=d[10]=d[14]=0),d}function eR(e,t,i,n,a,l,o){if(i){if(l.name==="globe"){let d=bb(e,t,i,n,a,l,o);return D.invert(d,d),D.multiply(d,e,d),d}{let d=D.clone(e),s=D.identity([]);return s[0]=o[0],s[1]=o[1],s[4]=o[2],s[5]=o[3],D.multiply(d,d,s),n||D.rotateZ(d,d,-a.angle),d}}return a.glCoordMatrix}function Ia(e,t,i,n){let a=[e,t,i,1];i?Le.transformMat4(a,a,n):sR(a,a,n);let l=a[3];return a[0]/=l,a[1]/=l,a[2]/=l,a}function iR(e,t){return Math.min(.5+e/t*.5,1.5)}function hJ(e,t){let i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function WJ(e,t,i,n,a,l,o,d,s,r){let c=i.transform,b=n?e.textSizeData:e.iconSizeData,m=ka(b,i.transform.zoom),h=c.projection.name==="globe",W=[256/i.width*2+1,256/i.height*2+1],p=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();let Z=null;h&&(Z=n?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);let g=e.lineVertexArray,u=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,G=i.transform.width/i.transform.height,F,R=!1;for(let I=0;I<u.length;I++){let N=u.get(I),{numGlyphs:Y,writingMode:X}=N;if(X!==di.vertical||R||F===di.horizontal||(R=!0),F=X,(N.hidden||X===di.vertical)&&!R){Td(Y,p);continue}R=!1;let J=new H(N.tileAnchorX,N.tileAnchorY),{x:B,y:C,z:Q}=c.projection.projectTilePoint(J.x,J.y,r.canonical);if(s){let[et,it,at]=s(J);B+=et,C+=it,Q+=at}let y=[B,C,Q,1];if(Le.transformMat4(y,y,t),!hJ(y,W)){Td(Y,p);continue}let z=y[3],E=iR(i.transform.getCameraToCenterDistance(c.projection),z),O=zs(b,m,N),f=o?O/E:O*E,L=Ia(B,C,Q,a);if(L[3]<=0){Td(Y,p);continue}let K={},q=o?null:s,P=lR(N,f,!1,d,t,a,l,e.glyphOffsetArray,g,p,Z,L,J,K,G,q,c.projection,r,o);R=P.useVertical,q&&P.needsFlipping&&(K={}),(P.notEnoughRoom||R||P.needsFlipping&&lR(N,f,!0,d,t,a,l,e.glyphOffsetArray,g,p,Z,L,J,K,G,q,c.projection,r,o).notEnoughRoom)&&Td(Y,p)}n?(e.text.dynamicLayoutVertexBuffer.updateData(p),Z&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(Z)):(e.icon.dynamicLayoutVertexBuffer.updateData(p),Z&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(Z))}function nR(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p){let{lineStartIndex:Z,glyphStartIndex:g,segment:u}=d,G=g+d.numGlyphs,F=Z+d.lineLength,R=t.getoffsetX(g),I=t.getoffsetX(G-1),N=mb(e*R,i,n,a,l,o,u,Z,F,s,r,c,b,m,!0,h,W,p);if(!N)return null;let Y=mb(e*I,i,n,a,l,o,u,Z,F,s,r,c,b,m,!0,h,W,p);return Y?{first:N,last:Y}:null}function aR(e,t,i,n){return e===di.horizontal&&Math.abs(n)>Math.abs(i)?{useVertical:!0}:e===di.vertical?n>0?{needsFlipping:!0}:null:t!==Cd.unknown&&function(a,l){return a===0||Math.abs(l/a)>mJ}(i,n)?t===Cd.flipRequired?{needsFlipping:!0}:null:i<0?{needsFlipping:!0}:null}function lR(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u){let G=t/24,F=e.lineOffsetX*G,R=e.lineOffsetY*G,{lineStartIndex:I,glyphStartIndex:N,numGlyphs:Y,segment:X,writingMode:J,flipState:B}=e,C=I+e.lineLength,Q=y=>{if(c){let[f,L,K]=y.up,q=r.length;ab(c,q+0,f,L,K),ab(c,q+1,f,L,K),ab(c,q+2,f,L,K),ab(c,q+3,f,L,K)}let[z,E,O]=y.point;Md(r,z,E,O,y.angle)};if(Y>1){let y=nR(G,d,F,R,i,b,m,e,s,l,h,p,!1,Z,g,u);if(!y)return{notEnoughRoom:!0};if(n&&!i){let[z,E,O]=y.first.point,[f,L,K]=y.last.point;[z,E]=Ia(z,E,O,o),[f,L]=Ia(f,L,K,o);let q=aR(J,B,(f-z)*W,L-E);if(e.flipState=q&&q.needsFlipping?Cd.flipRequired:Cd.flipNotRequired,q)return q}Q(y.first);for(let z=N+1;z<N+Y-1;z++){let E=mb(G*d.getoffsetX(z),F,R,i,b,m,X,I,C,s,l,h,p,!1,!1,Z,g,u);if(!E)return r.length-=4*(z-N),{notEnoughRoom:!0};Q(E)}Q(y.last)}else{if(n&&!i){let z=Ia(m.x,m.y,0,a),E=I+X+1,O=new H(s.getx(E),s.gety(E)),f=Ia(O.x,O.y,0,a),L=f[3]>0?f:dR(m,O,z,1,a,void 0,Z,g.canonical),K=aR(J,B,(L[0]-z[0])*W,L[1]-z[1]);if(e.flipState=K&&K.needsFlipping?Cd.flipRequired:Cd.flipNotRequired,K)return K}let y=mb(G*d.getoffsetX(N),F,R,i,b,m,X,I,C,s,l,h,p,!1,!1,Z,g,u);if(!y)return{notEnoughRoom:!0};Q(y)}return{}}function oR(e,t,i,n,a){let{x:l,y:o,z:d}=n.projectTilePoint(e.x,e.y,t);if(!a)return Ia(l,o,d,i);let[s,r,c]=a(e);return Ia(l+s,o+r,d+c,i)}function dR(e,t,i,n,a,l,o,d){let s=oR(e.sub(t)._unit()._add(e),d,a,o,l);return S.sub(s,i,s),S.normalize(s,s),S.scaleAndAdd(s,i,s,n)}function mb(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g){let u=n?e-t:e+t,G=u>0?1:-1,F=0;n&&(G*=-1,F=Math.PI),G<0&&(F+=Math.PI);let R=d+o+(G>0?0:1)|0,I=a,N=a,Y=0,X=0,J=Math.abs(u),B=[],C=[],Q=l,y=Q,z=()=>dR(y,Q,N,J-Y+1,c,m,p,Z.canonical);for(;Y+X<=J;){if(R+=G,R<d||R>=s)return null;if(N=I,y=Q,B.push(N),h&&C.push(y),Q=new H(r.getx(R),r.gety(R)),I=b[R],!I){let it=oR(Q,Z.canonical,c,p,m);I=it[3]>0?b[R]=it:z()}Y+=X,X=S.distance(N,I)}W&&m&&(b[R]&&(I=z(),X=S.distance(N,I)),b[R]=I);let E=(J-Y)/X,O=Q.sub(y)._mult(E)._add(y),f=S.sub([],I,N),L=S.scaleAndAdd([],N,f,E),K=[0,0,1],q=f[0],P=f[1];if(g&&(K=p.upVector(Z.canonical,O.x,O.y),K[0]!==0||K[1]!==0||K[2]!==1)){let it=[K[2],0,-K[0]],at=S.cross([],K,it);S.normalize(it,it),S.normalize(at,at),q=S.dot(f,it),P=S.dot(f,at)}if(i){let it=S.cross([],K,f);S.normalize(it,it),S.scaleAndAdd(L,L,it,i*G)}let et=F+Math.atan2(P,q);return B.push(L),h&&C.push(O),{point:L,angle:et,path:B,tilePath:C,up:K}}function Td(e,t){let i=t.length,n=i+4*e;t.resize(n),t.float32.fill(-1/0,4*i,4*n)}function sR(e,t,i){let n=t[0],a=t[1];return e[0]=i[0]*n+i[4]*a+i[12],e[1]=i[1]*n+i[5]*a+i[13],e[3]=i[3]*n+i[7]*a+i[15],e}let rR=(e,t,i)=>(1-i)*e+i*t,cR=e=>e*e*e*e*e;class hW{constructor(t,i,n,a,l,o,d){this.tileSize=512,this._renderWorldCopies=l===void 0||l,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=n==null?0:n,this._maxPitch=a==null?60:a,this.setProjection(o),this.setMaxBounds(d),this.width=0,this.height=0,this._center=new qt(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new bW,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new cb,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new hW(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,i=!1){let n=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||n)&&this._updateCameraOnTerrain(),(t||n)&&this._constrainCamera(i),this._calcMatrices()}getProjection(){return Ci(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let i=this.projection?this.getProjection():void 0;this.projection=$c(this.projectionOptions);let n=!te(i,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=$c({name:"mercator"});let i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return He(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new H(this.width,this.height)}get bearing(){return Nn(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=Zd.create(),Zd.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let i=Mt(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=At(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._setZoom(i),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,i=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!i||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let n=this._elevation;i||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&n.exaggeration()&&this._centerAltitudeValidForExaggeration!==n.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*n.exaggeration(),this._centerAltitudeValidForExaggeration=n.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=n.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop(),a=0,l=0;for(let o=0;o<i.length;o++){let d=new H(i[o][0]*this.width,n+i[o][1]*(this.height-n)),s=t.pointCoordinate(d);if(!s)continue;let r=1/Math.hypot(s[0]-this._camera.position[0],s[1]-this._camera.position[1]);a+=s[3]*r,l+=r}return l===0?NaN:a/l}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*i,a=this._mercatorZfromZoom(t),l=this._mercatorZfromZoom(this._maxZoom),o=Math.max(a-n,l);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),n;n=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];let a=S.length(S.sub([],this._camera.position,n));return Mt(this._zoomFromMercatorZ(a),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!an.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){let n=[t.position.x,t.position.y,t.position.z];S.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,i=new _u;return i.position=new Re(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!an.length(t))return!1;an.normalize(t,t);let i=S.transformQuat([],[0,0,-1],t),n=S.transformQuat([],[0,-1,0],t);if(n[2]<0)return!1;let a=Du(i,n);return!!a&&(this._camera.orientation=a,!0)}_setCameraPosition(t){let i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,a=this.cameraToCenterDistance;t[2]=Mt(t[2],a/n,a/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,i,n){this._unmodified=!1,this._edgeInsets.interpolate(t,i,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let i=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,i)}getVisibleUnwrappedCoordinates(t){let i=[new uh(0,t)];if(this.renderWorldCopies){let n=this.pointCoordinate(new H(0,0)),a=this.pointCoordinate(new H(this.width,0)),l=this.pointCoordinate(new H(this.width,this.height)),o=this.pointCoordinate(new H(0,this.height)),d=Math.floor(Math.min(n.x,a.x,l.x,o.x)),s=Math.floor(Math.max(n.x,a.x,l.x,o.x)),r=1;for(let c=d-r;c<=s+r;c++)c!==0&&i.push(new uh(c,t))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,i,n){let a=[];if(i[0]===0&&i[1]===0)return a;for(let o of t){let d=o.canonical,s=o.overscaledZ,r=o.wrap,c=1<<d.z,b=d.x+1<c,m=d.x>0,h=d.y+1<c,W=d.y>0,p=o.wrap-(m?0:1),Z=o.wrap+(b?0:1),g=m?d.x-1:c-1,u=b?d.x+1:0;i[0]<0?(a.push(new Xe(s,Z,d.z,u,d.y)),i[1]<0&&h&&(a.push(new Xe(s,r,d.z,d.x,d.y+1)),a.push(new Xe(s,Z,d.z,u,d.y+1))),i[1]>0&&W&&(a.push(new Xe(s,r,d.z,d.x,d.y-1)),a.push(new Xe(s,Z,d.z,u,d.y-1)))):i[0]>0?(a.push(new Xe(s,p,d.z,g,d.y)),i[1]<0&&h&&(a.push(new Xe(s,r,d.z,d.x,d.y+1)),a.push(new Xe(s,p,d.z,g,d.y+1))),i[1]>0&&W&&(a.push(new Xe(s,r,d.z,d.x,d.y-1)),a.push(new Xe(s,p,d.z,g,d.y-1)))):i[1]<0&&h?a.push(new Xe(s,r,d.z,d.x,d.y+1)):W&&a.push(new Xe(s,r,d.z,d.x,d.y-1))}if(a.length>1){a.sort((s,r)=>s.overscaledZ-r.overscaledZ||s.wrap-r.wrap||s.canonical.z-r.canonical.z||s.canonical.x-r.canonical.x||s.canonical.y-r.canonical.y);let o=0,d=0;for(;d<a.length;)a[d].equals(a[o])?++d:a[++o]=a[d++];a.length=o+1}let l=[];for(let o of a)a.some(d=>o.isChildOf(d))||l.push(o);return a=l.filter(o=>!t.some(d=>!!(o.overscaledZ<n&&d.isChildOf(o))||o.equals(d)||o.isChildOf(d))),a}coveringTiles(t){let i=this.coveringZoomLevel(t),n=i,a=this.elevation&&this.elevation.exaggeration(),l=a&&!t.isTerrainDEM,o=this.projection.name==="mercator";if(t.minzoom!==void 0&&i<t.minzoom)return[];t.maxzoom!==void 0&&i>t.maxzoom&&(i=t.maxzoom);let d=this.locationCoordinate(this.center),s=this.center.lat,r=1<<i,c=[r*d.x,r*d.y,0],b=this.projection.name==="globe",m=!b,h=ll.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,m),W=b?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),p=r*He(1,this.center.lat),Z=this._camera.position[2]/He(1,this.center.lat),g=[r*W.x,r*W.y,Z*(m?1:p)],u=b||a,G=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),F=this.isLODDisabled(!0)?i:0,R;if(this._elevation&&t.isTerrainDEM)R=1e4*this._elevation.exaggeration();else if(this._elevation){let f=this._elevation.getMinMaxForVisibleTiles();R=f?f.max:this._centerAltitude}else R=this._centerAltitude;let I=t.isTerrainDEM?-R:this._elevation?this._elevation.getMinElevationBelowMSL():0,N=this.projection.isReprojectedInTileSpace?Pu(this):1,Y=f=>{let K=new Re(f.x+25e-6,f.y,f.z),q=new Re(f.x,f.y+25e-6,f.z),P=f.toLngLat(),et=K.toLngLat(),it=q.toLngLat(),at=this.locationCoordinate(P),$=this.locationCoordinate(et),ot=this.locationCoordinate(it),Rt=Math.hypot($.x-at.x,$.y-at.y),Gt=Math.hypot(ot.x-at.x,ot.y-at.y);return Math.sqrt(Rt*Gt)*N/25e-6},X=f=>{let L=R,K=I;return{aabb:ku(this,r,0,0,0,f,K,L,this.projection),zoom:0,x:0,y:0,minZ:K,maxZ:L,wrap:f,fullyVisible:!1}},J=[],B=[],C=i,Q=t.reparseOverscaled?n:i,y=f=>f*f,z=y((Z-this._centerAltitude)*p),E=f=>{if(!this._elevation||!f.tileID||!o)return;let L=this._elevation.getMinMaxForTile(f.tileID),K=f.aabb;L?(K.min[2]=L.min,K.max[2]=L.max,K.center[2]=(K.min[2]+K.max[2])/2):(f.shouldSplit=O(f),f.shouldSplit||(K.min[2]=K.max[2]=K.center[2]=this._centerAltitude))},O=f=>{if(f.zoom<F)return!0;if(f.zoom===C)return!1;if(f.shouldSplit!=null)return f.shouldSplit;let L=f.aabb.distanceX(g),K=f.aabb.distanceY(g),q=z,P=1;if(b){q=y(f.aabb.distanceZ(g));let at=Math.pow(2,f.zoom),$=Bi((f.y+1)/at),ot=Bi(f.y/at),Rt=Math.min(Math.max(s,$),ot),Gt=Yc(Rt)/Yc(s);if(P=Rt===s?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Gt/this._mercatorScaleRatio),this.zoom<=Ts&&f.zoom===C-1&&Gt>=.9)return!0}else if(l&&(q=y(f.aabb.distanceZ(g)*p)),this.projection.isReprojectedInTileSpace&&n<=5){let at=Math.pow(2,f.zoom),$=Y(new Re((f.x+.5)/at,(f.y+.5)/at));P=$>.85?1:$}let et=L*L+K*K+q,it=y((1<<C-f.zoom)*G*P*((at,$)=>{if($*y(.707)<at)return 1;let ot=Math.sqrt($/at);return ot/(1.4144271570014144+(Math.pow(1.1,ot-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(q,z),et));return et<it};if(this.renderWorldCopies)for(let f=1;f<=3;f++)J.push(X(-f)),J.push(X(f));for(J.push(X(0));J.length>0;){let f=J.pop(),L=f.x,K=f.y,q=f.fullyVisible,P=()=>this.projection.name==="globe"&&(f.y===0||f.y===(1<<f.zoom)-1);if(!q){let et=u?f.aabb.intersects(h):f.aabb.intersectsFlat(h);if(et===0&&P()){let it=new ia(f.zoom,L,K);et=Ih(this,r,it,!0).intersects(h)}if(et===0)continue;q=et===2}if(f.zoom!==C&&O(f))for(let et=0;et<4;et++){let it=(L<<1)+et%2,at=(K<<1)+(et>>1),$={aabb:o?f.aabb.quadrant(et):ku(this,r,f.zoom+1,it,at,f.wrap,f.minZ,f.maxZ,this.projection),zoom:f.zoom+1,x:it,y:at,wrap:f.wrap,fullyVisible:q,tileID:void 0,shouldSplit:void 0,minZ:f.minZ,maxZ:f.maxZ};l&&!b&&($.tileID=new Xe(f.zoom+1===C?Q:f.zoom+1,f.wrap,f.zoom+1,it,at),E($)),J.push($)}else{let et=f.zoom===C?Q:f.zoom;if(t.minzoom&&t.minzoom>et)continue;if(!q){let ot=u?f.aabb.intersectsPrecise(h):f.aabb.intersectsPreciseFlat(h);if(ot===0&&P()){let Rt=new ia(f.zoom,L,K);ot=Ih(this,r,Rt,!0).intersectsPrecise(h)}if(ot===0)continue}let it=c[0]-(.5+L+(f.wrap<<f.zoom))*(1<<i-f.zoom),at=c[1]-.5-K,$=f.tileID?f.tileID:new Xe(et,f.wrap,f.zoom,L,K);B.push({tileID:$,distanceSq:it*it+at*at})}}if(this.fogCullDistSq){let f=this.fogCullDistSq,L=this.horizonLineFromTop();B=B.filter(K=>{let q=[0,0,0,1],P=[tt,tt,0,1],et=this.calculateFogTileMatrix(K.tileID.toUnwrapped());Le.transformMat4(q,q,et),Le.transformMat4(P,P,et);let it=function(ot,Rt,Gt){let Yt=0;for(let Bt=0;Bt<2;++Bt)ot[Bt]>0&&(Yt+=(ot[Bt]-0)*(ot[Bt]-0)),Rt[Bt]<0&&(Yt+=(0-Rt[Bt])*(0-Rt[Bt]));return Yt}(Le.min([],q,P),Le.max([],q,P));if(it===0)return!0;let at=!1,$=this._elevation;if($&&it>f&&L!==0){let ot=this.calculateProjMatrix(K.tileID.toUnwrapped()),Rt;t.isTerrainDEM||(Rt=$.getMinMaxForTile(K.tileID)),Rt||(Rt={min:I,max:R});let Gt=function(Bt){let Dt=Math.round((Bt+45+360)%360/90)%4;return tn[Dt]}(this.rotation),Yt=[Gt[0]*tt,Gt[1]*tt,Rt.max];S.transformMat4(Yt,Yt,ot),at=(1-Yt[1])*this.height*.5<L}return it<f||at})}return B.sort((f,L)=>f.distanceSq-L.distanceSq).map(f=>f.tileID)}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let i=Mt(t.lat,-ui,ui),n=this.projection.project(t.lng,i);return new H(n.x*this.worldSize,n.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/He(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let n,a,l=this.centerPoint;if(this.projection.name==="globe"){let d=this.worldSize;n=(i.x-l.x)/d,a=(i.y-l.y)/d}else{let d=this.pointCoordinate(i),s=this.pointCoordinate(l);n=d.x-s.x,a=d.y-s.y}let o=this.locationCoordinate(t);this.setLocation(new Re(o.x-n,o.y-a))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,i){let n=i?He(i,t.lat):void 0,a=this.projection.project(t.lng,t.lat);return new Re(a.x,a.y,n)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,i){let n=i!=null?i:this._centerAltitude,a=[t.x,t.y,0,1],l=[t.x,t.y,1,1];Le.transformMat4(a,a,this.pixelMatrixInverse),Le.transformMat4(l,l,this.pixelMatrixInverse);let o=l[3];Le.scale(a,a,1/a[3]),Le.scale(l,l,1/o);let d=a[2],s=l[2];return{p0:a,p1:l,t:d===s?0:(n-d)/(s-d)}}screenPointToMercatorRay(t){let i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return Le.transformMat4(i,i,this.pixelMatrixInverse),Le.transformMat4(n,n,this.pixelMatrixInverse),Le.scale(i,i,1/i[3]),Le.scale(n,n,1/n[3]),i[2]=He(i[2],this._center.lat)*this.worldSize,n[2]=He(n[2],this._center.lat)*this.worldSize,Le.scale(i,i,1/this.worldSize),Le.scale(n,n,1/this.worldSize),new Fc([i[0],i[1],i[2]],S.normalize([],S.sub([],n,i)))}rayIntersectionCoordinate(t){let{p0:i,p1:n,t:a}=t,l=He(i[2],this._center.lat),o=He(n[2],this._center.lat);return new Re(Pt(i[0],n[0],a)/this.worldSize,Pt(i[1],n[1],a)/this.worldSize,Pt(l,o,a))}pointCoordinate(t,i=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,i)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new Re(i[0],i[1],i[2]);let n=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);let l=.02*a,o=t.clone();for(let d=0;d<10&&a-n>l;d++){o.y=Pt(n,a,.66);let s=this.projection.pointCoordinate3D(this,o.x,o.y);s?(a=o.y,i=s):n=o.y}return i?new Re(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=Cl)return!this.isPointAboveHorizon(t);let i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){let n=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,a=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return Le.transformMat4(a,a,this.pixelMatrix),a[3]>0?new H(a[0]/a[3],a[1]/a[3]):new H(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,l=this.pointLocation3D(new H(i,t)),o=this.pointLocation3D(new H(a,t)),d=this.pointLocation3D(new H(a,n)),s=this.pointLocation3D(new H(i,n)),r=Math.min(l.lng,o.lng,d.lng,s.lng),c=Math.max(l.lng,o.lng,d.lng,s.lng),b=Math.min(l.lat,o.lat,d.lat,s.lat),m=Math.max(l.lat,o.lat,d.lat,s.lat),h=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,p=(Z,g,u,G,F)=>{let R=(Z+u)/2,I=(g+G)/2,N=new H(R,I),{lng:Y,lat:X}=this.pointLocation3D(N),J=Math.max(0,r-Y,b-X,Y-c,X-m);r=Math.min(r,Y),c=Math.max(c,Y),b=Math.min(b,X),m=Math.max(m,X),(F<W||J>h)&&(p(Z,g,R,I,F+1),p(R,I,u,G,F+1))};if(p(i,t,a,t,1),p(a,t,a,n,1),p(a,n,i,n,1),p(i,n,i,t,1),this.projection.name==="globe"){let[Z,g]=function(u){let G=D.identity(new Float64Array(16));D.multiply(G,u.pixelMatrix,u.globeMatrix);let F=[0,na,0],R=[0,aa,0];return S.transformMat4(F,F,G),S.transformMat4(R,R,G),[F[0]>0&&F[0]<=u.width&&F[1]>0&&F[1]<=u.height&&!Nc(u,new qt(u.center.lat,90)),R[0]>0&&R[0]<=u.width&&R[1]>0&&R[1]<=u.height&&!Nc(u,new qt(u.center.lat,-90))]}(this);Z?(m=90,c=180,r=-180):g&&(b=-90,c=180,r=-180)}return new Tn(new qt(r,b),new qt(c,m))}_getBoundsRectangular(t,i){let{top:n,left:a}=this._edgeInsets,l=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,d=new H(a,n),s=new H(o,n),r=new H(o,l),c=new H(a,l),b=this.pointCoordinate(d,t),m=this.pointCoordinate(s,t),h=this.pointCoordinate(r,i),W=this.pointCoordinate(c,i),p=(Z,g)=>(g.y-Z.y)/(g.x-Z.x);return b.y>1&&m.y>=0?b=new Re((1-W.y)/p(W,b)+W.x,1):b.y<0&&m.y<=1&&(b=new Re(-W.y/p(W,b)+W.x,0)),m.y>1&&b.y>=0?m=new Re((1-h.y)/p(h,m)+h.x,1):m.y<0&&b.y<=1&&(m=new Re(-h.y/p(h,m)+h.x,0)),new Tn().extend(this.coordinateLocation(b)).extend(this.coordinateLocation(m)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(h))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let i=t.visibleDemTiles.reduce((n,a)=>{if(a.dem){let l=a.dem.tree;n.min=Math.min(n.min,l.minimums[0]),n.max=Math.max(n.max,l.maximums[0])}return n},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(i.min*t.exaggeration(),i.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let i=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,n=this.height/2-i*(1-this._horizonShift);return t?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-ui,this.maxLat=ui,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Qi(this.minLng)*this.tileSize,this.worldMaxX=Qi(this.maxLng)*this.tileSize,this.worldMinY=Li(this.maxLat)*this.tileSize,this.worldMaxY=Li(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,i){return this.projection.createTileMatrix(this,i,t)}calculateDistanceTileData(t){let i=t.key,n=this._distanceTileDataCache;if(n[i])return n[i];let a=t.canonical,l=1/this.height,o=this.cameraWorldSize,d=o/this.zoomScale(a.z),s=(a.x+Math.pow(2,a.z)*t.wrap)*d,r=a.y*d,c=this.point;c.x*=o/this.worldSize,c.y*=o/this.worldSize;let b=this.angle,m=Math.sin(-b),h=-Math.cos(-b);return n[i]={bearing:[m,h],center:[(c.x-s)*l,(c.y-r)*l],scale:d/tt*l},n[i]}calculateFogTileMatrix(t){let i=t.key,n=this._fogTileMatrixCache;if(n[i])return n[i];let a=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return D.multiply(a,this.worldToFogMatrix,a),n[i]=new Float32Array(a),n[i]}calculateProjMatrix(t,i=!1,n=!1){let a=t.key,l;if(l=n?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,l[a])return l[a];let o=this.calculatePosMatrix(t,this.worldSize),d;return d=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,D.multiply(o,d,o),l[a]=new Float32Array(o),l[a]}calculatePixelsToTileUnitsMatrix(t){let i=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];let a=function(l,o){let{scale:d}=l.tileTransform,s=d*tt/(l.tileSize*Math.pow(2,o.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return Zd.scale(new Float32Array(4),o.inverseAdjustmentMatrix,[s,s])}(t,this);return n[i]=a,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,i=D.fromScaling([],[t,t,t]);return D.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let i=He(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),a=this._camera.forward(),l=He(1,this._center.lat);n[2]/=l,a[2]/=l,S.normalize(a,a);let o=t.raycast(n,a,t.exaggeration());if(o){let d=S.scaleAndAdd([],n,a,o),s=new Re(d[0],d[1],He(d[2],Bi(d[1]))),r=(s.z+S.length([s.x-n[0],s.y-n[1],s.z-n[2]*l]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(r),this._centerAltitude=s.toAltitude(),this._center=this.coordinateLocation(s),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let i=this._elevation,n=He(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(n),l=i.getAtPointOrZero(new Re(...a)),o=this.pixelsPerMeter/this.worldSize*l,d=this._minimumHeightOverTerrain(),s=a[2]-o;if(s<=d)if(s<0||t){let r=this.locationCoordinate(this._center,this._centerAltitude),c=[a[0],a[1],r.z-a[2]],b=S.length(c);c[2]-=(d-s)/this._pixelsPerMercatorPixel;let m=S.length(c);if(m===0)return;S.scale(c,c,b/m*this._pixelsPerMercatorPixel),this._camera.position=[a[0],a[1],r.z*this._pixelsPerMercatorPixel-c[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let m=this.center;return m.lat=Mt(m.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(m.lng=Mt(m.lng,this.minLng,this.maxLng)),this.center=m,void(this._constraining=!1)}let i=this._unmodified,{x:n,y:a}=this.point,l=0,o=n,d=a,s=this.width/2,r=this.height/2,c=this.worldMinY*this.scale,b=this.worldMaxY*this.scale;if(a-r<c&&(d=c+r),a+r>b&&(d=b-r),b-c<this.height&&(l=Math.max(l,this.height/(b-c)),d=(b+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let m=this.worldMinX*this.scale,h=this.worldMaxX*this.scale,W=this.worldSize/2-(m+h)/2;o=(n+W+this.worldSize)%this.worldSize-W,o-s<m&&(o=m+s),o+s>h&&(o=h-s),h-m<this.width&&(l=Math.max(l,this.width/(h-m)),o=(h+m)/2)}o===n&&d===a||(this.center=this.unproject(new H(o,d))),l&&(this.zoom+=this.scaleZoom(l)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,i=this.projection.name==="globe",n=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=He(1,this.center.lat)/He(1,45));let a=qs(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let l=this.projection.zAxisUnit==="meters"?n:1,o=this._camera.getWorldToCamera(this.worldSize,l),d,s=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(s[8]=2*-t.x/this.width,s[9]=2*t.y/this.height,this.isOrthographic){let X=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),J=X*this.aspect,B=-J,C=-X;J-=t.x,B-=t.x,X+=t.y,C+=t.y,d=this._camera.getCameraToClipOrthographic(B,J,C,X,this._nearZ,this._farZ),((Q,y,z,E)=>{for(let O=0;O<16;O++)Q[O]=rR(y[O],z[O],E)})(d,d,s,cR(this.pitch>=15?1:this.pitch/15))}else d=s;let r=D.mul([],s,o),c=D.mul([],d,o);if(this.projection.isReprojectedInTileSpace){let X=this.locationCoordinate(this.center),J=D.identity([]);D.translate(J,J,[X.x*this.worldSize,X.y*this.worldSize,0]),D.multiply(J,J,Ku(this)),D.translate(J,J,[-X.x*this.worldSize,-X.y*this.worldSize,0]),D.multiply(c,c,J),D.multiply(r,r,J),this.inverseAdjustmentMatrix=function(B){let C=Ku(B,!0);return Zd.invert([],[C[0],C[1],C[4],C[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=D.scale([],c,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=c,this.invProjMatrix=D.invert(new Float64Array(16),this.projMatrix),i){let X=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);X[8]=2*-t.x/this.width,X[9]=2*t.y/this.height,this.expandedFarZProjMatrix=D.mul([],X,o)}else this.expandedFarZProjMatrix=this.projMatrix;let b=D.invert([],d);this.frustumCorners=Rh.fromInvProjectionMatrix(b,this.horizonLineFromTop(),this.height),this.cameraFrustum=ll.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);let m=new Float32Array(16);D.identity(m),D.scale(m,m,[1,-1,1]),D.rotateX(m,m,this._pitch),D.rotateZ(m,m,this.angle);let h=D.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=D.clone(h);let W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;h[8]=2*-t.x/this.width,h[9]=2*(t.y+W)/this.height,this.skyboxMatrix=D.multiply(m,h,m);let p=this.point,Z=p.x,g=p.y,u=this.width%2/2,G=this.height%2/2,F=Math.cos(this.angle),R=Math.sin(this.angle),I=Z-Math.round(Z)+F*u+R*G,N=g-Math.round(g)+F*G+R*u,Y=new Float64Array(c);if(D.translate(Y,Y,[I>.5?I-1:I,N>.5?N-1:N,0]),this.alignedProjMatrix=Y,c=D.create(),D.scale(c,c,[this.width/2,-this.height/2,1]),D.translate(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=D.create(),D.scale(c,c,[1,-1,1]),D.translate(c,c,[-1,-1,0]),D.scale(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=D.multiply(new Float64Array(16),this.labelPlaneMatrix,r),this._calcFogMatrices(),this._distanceTileDataCache={},c=D.invert(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=c,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(J){let{x:B,y:C}=J.point,{lng:Q,lat:y}=J._center;return gg(B,C,J.worldSize,Q,y)}(this);let X=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=S.transformMat4(X,X,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=c;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,a=1/this.height/this._pixelsPerMercatorPixel,l=[t,t,i];S.scale(l,l,a),S.scale(n,n,-1),S.multiply(n,n,l);let o=D.create();D.translate(o,o,n),D.scale(o,o,l),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,a)}_computeCameraPosition(t){let i=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),a=this.point,l=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*i-t/this.worldSize*this._centerAltitude;return[a.x/this.worldSize-n[0]*l,a.y/this.worldSize-n[1]*l,t/this.worldSize*this._centerAltitude-n[2]*l]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],a=t[2],l=1;this.projection.wrap&&(this.center=this.center.wrap()),a>0&&(l=Math.min((i-n)/a,1)),this._camera.position=S.scaleAndAdd([],this._camera.position,t,l),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:a}=this._camera.getPitchBearing(),l=He(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(At(this._maxPitch)),d=Math.max((t[2]-l)/Math.cos(n),o),s=this._zoomFromMercatorZ(d);S.scaleAndAdd(t,t,i,d),this._pitch=Mt(n,At(this.minPitch),At(this.maxPitch)),this.angle=Nn(a,-Math.PI,Math.PI),this._setZoom(Mt(s,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Re(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,n=Cl,a=0,l=1/0;for(;n-i>1e-6&&n>i;){let o=i+.5*(n-i),d=this.tileSize*Math.pow(2,o),s=this.getCameraToCenterDistance(this.projection,o,d),r=this.scaleZoom(s/(t*this.tileSize)),c=Math.abs(o-r);c<l&&(l=c,a=o),o<r?i=o:n=o}return a}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(A("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){let n=Math.min(t.x,i.x),a=Math.max(t.x,i.x),l=Math.min(t.y,i.y),o=Math.max(t.y,i.y);if(l<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let d=[new H(n,l),new H(a,o),new H(n,o),new H(a,l)],s=this.renderWorldCopies?-3:0,r=this.renderWorldCopies?4:1;for(let c of d){let b=this.pointRayIntersection(c);if(b.t<0)return!0;let m=this.rayIntersectionCoordinate(b);if(m.x<s||m.y<0||m.x>r||m.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ei(this.fovAboveCenter)>88||this.anyCornerOffEdge(new H(0,0),new H(this.width,this.height))}zoomDeltaToMovement(t,i){let n=S.length(S.sub([],this._camera.position,t)),a=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(a)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([i,n,a],l){let o=[i,n,a,1];Le.transformMat4(o,o,l);let d=o[3]=Math.max(o[3],1e-6);return o[0]/=d,o[1]/=d,o[2]/=d,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new H(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new H(0,t))}}getCameraToCenterDistance(t,i=this.zoom,n=this.worldSize){let a=qs(t,i,this.width,this.height,1024),l=t.pixelSpaceConversion(this.center.lat,n,a),o=.5/Math.tan(.5*this._fov)*this.height*l;return this.isOrthographic&&(o=rR(1,o,cR(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&D.multiply(t,t,this.globeMatrix),t}getFrustum(t){return ll.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}function bR(e,t,i){D.identity(e),D.rotateZ(e,e,At(t[2])),D.rotateX(e,e,At(t[0])),D.rotateY(e,e,At(t[1])),D.scale(e,e,i),D.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function hb(e,t,i,n,a,l,o,d){let s=[i[0]-t[0],i[1]-t[1],0],r=[n[0]-t[0],n[1]-t[1],0];if(S.length(s)<1e-12||S.length(r)<1e-12)return an.identity(e);let c=S.cross([],s,r);S.normalize(c,c),S.subtract(r,n,t),s[2]=(l-a)*d,r[2]=(o-a)*d;let b=s;return S.cross(b,s,r),S.normalize(b,b),an.rotationTo(e,c,b)}function mR(e,t,i=!1){let n=Di(t.zoom),a=function(l,o,d){let s=o.worldSize,r=[l[12],l[13],l[14]],c=Bi(r[1]/s),b=kn(r[0]/s),m=D.identity([]),h=He(1,c)*s,W=He(1,0)*s*Sl(c,o.zoom),p=1/Nh(s),Z=W*p;if(d){let F=qs(o.projection,o.zoom,o.width,o.height,1024);Z=p*o.projection.pixelSpaceConversion(o.center.lat,s,F)}let g=Gn(c,b);S.add(g,g,S.scale([],S.normalize([],g),h*Z*r[2]));let u=function(F){let R=[F[0],F[1],F[2]],I=[0,1,0],N=S.cross([],I,R);return S.cross(I,R,N),S.squaredLength(I)===0&&(I=[0,1,0],S.cross(N,R,I)),S.normalize(N,N),S.normalize(I,I),S.normalize(R,R),[N[0],N[1],N[2],0,I[0],I[1],I[2],0,R[0],R[1],R[2],0,F[0],F[1],F[2],1]}(g);D.scale(m,m,[Z,Z,Z*h]),D.translate(m,m,[-r[0],-r[1],-r[2]]);let G=D.multiply([],o.globeMatrix,u);return D.multiply(G,G,m),D.multiply(G,G,l),G}(e,t,i);if(n>0){let l=function(o,d){let s=d.worldSize,r=He(1,0)*s*Sl(d.center.lat,d.zoom)/Nh(s),c=He(1,d.center.lat)*s,b=D.identity([]);return D.rotateY(b,b,At(d.center.lng)),D.rotateX(b,b,At(d.center.lat)),D.translate(b,b,[0,0,Wn]),D.scale(b,b,[r,r,r*c]),D.translate(b,b,[d.point.x-.5*s,d.point.y-.5*s,0]),D.multiply(b,b,o),D.multiply(b,d.globeMatrix,b)}(e,t);return function(o,d,s){let r=(W,p,Z)=>{let g=S.length(W),u=S.length(p),G=ol(W,p,Z);return S.scale(G,G,1/S.length(G)*Pt(g,u,Z))},c=r([o[0],o[1],o[2]],[d[0],d[1],d[2]],s),b=r([o[4],o[5],o[6]],[d[4],d[5],d[6]],s),m=r([o[8],o[9],o[10]],[d[8],d[9],d[10]],s),h=ol([o[12],o[13],o[14]],[d[12],d[13],d[14]],s);return[c[0],c[1],c[2],0,b[0],b[1],b[2],0,m[0],m[1],m[2],0,h[0],h[1],h[2],1]}(a,l,n)}return a}let xo=64,pJ=[1,1,1];class hR{constructor(t,i,n,a){this.id=t,this.position=i!=null?new qt(i[0],i[1]):new qt(0,0),this.orientation=n!=null?n:[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new $e([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(D.multiply(t.matrix,i,t.matrix),t.meshes)for(let n of t.meshes){let a=$e.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(a)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=D.identity([]);for(let i of this.nodes)this._applyTransformations(i,t)}_positionModelOnTerrain(t,i){let n=t.elevation;if(!n)return 0;let a=$e.projectAabbCorners(this.aabb,this.matrix),l=He(1,this.position.lat)*t.worldSize,o=function(g,u){let G=[0,0,1],F=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let R of F){let I=g[R.corners[0]],N=g[R.corners[1]],Y=g[R.corners[2]],X=[N[0]-I[0],N[1]-I[1],u*(N[2]-I[2])],J=S.cross(X,X,[Y[0]-I[0],Y[1]-I[1],u*(Y[2]-I[2])]);S.normalize(J,J),R.dotProductWithUp=S.dot(J,G)}return F.sort((R,I)=>R.dotProductWithUp-I.dotProductWithUp),F[0].corners}(a,l),d=a[o[0]],s=a[o[1]],r=a[o[2]],c=a[o[3]],b=n.getAtPointOrZero(new Re(d[0]/t.worldSize,d[1]/t.worldSize),0),m=n.getAtPointOrZero(new Re(s[0]/t.worldSize,s[1]/t.worldSize),0),h=n.getAtPointOrZero(new Re(r[0]/t.worldSize,r[1]/t.worldSize),0),W=n.getAtPointOrZero(new Re(c[0]/t.worldSize,c[1]/t.worldSize),0),p=(b+W)/2,Z=(m+h)/2;return p>Z?m<h?hb(i,s,c,d,m,W,b,l):hb(i,r,d,c,h,b,W,l):b<W?hb(i,d,s,r,b,m,h,l):hb(i,c,r,s,W,h,m,l),Math.max(p,Z)}computeModelMatrix(t,i,n,a,l,o,d=!1){let s=t.transform,r=s.zoom,c=s.project(this.position),b=Sl(this.position.lat,r),m=1/b;D.identity(this.matrix),D.translate(this.matrix,this.matrix,[c.x+a[0]*m,c.y+a[1]*m,a[2]]);let h=1,W=1,p=s.worldSize;if(d){if(s.projection.name==="mercator"){let G=0;s.elevation&&(G=s.elevation.getAtPointOrZero(new Re(c.x/p,c.y/p),0));let F=Le.transformMat4([],[c.x,c.y,G,1],s.projMatrix)[3]/s.cameraToCenterDistance;h=F,W=F*Sl(s.center.lat,r)}else if(s.projection.name==="globe"){let G=mR(this.matrix,s),F=D.multiply([],s.projMatrix,G),R=[0,0,0,1];Le.transformMat4(R,R,F);let I=R[3]/s.cameraToCenterDistance,N=Di(r),Y=s.projection.pixelsPerMeter(this.position.lat,p)*Sl(this.position.lat,r),X=s.projection.pixelsPerMeter(s.center.lat,p)*Sl(s.center.lat,r);h=I/Pt(Y,Yg(s.center.lat),N),W=I*b/Y,h*=X,W*=X}}else h=m;D.scale(this.matrix,this.matrix,[h,h,W]);let Z=[...this.matrix],g=this.orientation,u=[];if(bR(u,[g[0]+i[0],g[1]+i[1],g[2]+i[2]],n),D.multiply(this.matrix,Z,u),l&&s.elevation){let G=0,F=[];if(o&&s.elevation){G=this._positionModelOnTerrain(s,F);let R=D.fromQuat([],F),I=D.multiply([],R,u);D.multiply(this.matrix,Z,I)}else G=s.elevation.getAtPointOrZero(new Re(c.x/p,c.y/p),0);G!==0&&(this.matrix[14]+=G)}}upload(t){if(!this.uploaded){for(let i of this.nodes)WW(i,t);for(let i of this.nodes)Wb(i);this.uploaded=!0}}destroy(){for(let t of this.nodes)pb(t)}}function $s(e,t,i=!1){e.uploaded||(e.gfxTexture=new bi(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function ZJ(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,lJ.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,rJ.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,sJ.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?oJ:dJ).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,bJ.members,!0)),e.segments=ze.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);let n=e.material;n.pbrMetallicRoughness.baseColorTexture&&$s(n.pbrMetallicRoughness.baseColorTexture,t),n.pbrMetallicRoughness.metallicRoughnessTexture&&$s(n.pbrMetallicRoughness.metallicRoughnessTexture,t),n.normalTexture&&$s(n.normalTexture,t),n.occlusionTexture&&$s(n.occlusionTexture,t,i),n.emissionTexture&&$s(n.emissionTexture,t)}function WW(e,t,i){if(e.meshes)for(let n of e.meshes)ZJ(n,t,i);if(e.children)for(let n of e.children)WW(n,t,i)}function Wb(e){if(e.meshes)for(let t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(let t of e.children)Wb(t)}function pb(e){if(e.meshes)for(let i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(let i of e.children)pb(i)}class WR{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class pR{constructor(){this.instancedDataArray=new K0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ZR{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,i,n,a){this.tileToMeter=Ss(n);let l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:o,id:d,index:s,sourceLayerIndex:r}of t){let c=Ql(o,l);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),c,n))continue;let b={id:d,sourceLayerIndex:r,index:s,geometry:l?c.geometry:Ta(o,n,a),properties:o.properties,type:o.type,patterns:{}},m=this.addFeature(b,b.geometry,c);m&&i.featureIndex.insert(o,b.geometry,s,r,this.index,this.instancesPerModel[m].instancedDataArray.length)}this.lookup=null}update(t,i,n,a){for(let l in this.instancesPerModel){let o=this.instancesPerModel[l];for(let d in t)o.idToFeaturesIndex.hasOwnProperty(d)&&this.evaluate(o.features[o.idToFeaturesIndex[d]],t[d],o,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(let i in this.instancesPerModel){let n=this.instancesPerModel[i];for(let a of n.features){let l=this.layers[0],o=a.feature,d=this.canonical,s=l.paint.get("model-rotation").evaluate(o,{},d),r=l.paint.get("model-scale").evaluate(o,{},d),c=l.paint.get("model-translation").evaluate(o,{},d);S.exactEquals(a.rotation,s)&&S.exactEquals(a.scale,r)&&S.exactEquals(a.translation,c)||(this.evaluate(a,a.featureStates,n,!0),t=!0)}}return t}isEmpty(){for(let t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(let i in this.instancesPerModel){let n=this.instancesPerModel[i];n.instancedDataArray.length<0||n.instancedDataArray.length===0||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=t.createVertexBuffer(n.instancedDataArray,cJ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let t in this.instancesPerModel){let i=this.instancesPerModel[t];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(t,i,n){let a=this.layers[0],l=a.layout.get("model-id").evaluate(n,{},this.canonical);if(!l)return A("modelId is not evaluated for layer ".concat(a.id," and it is not going to get rendered.")),l;this.instancesPerModel[l]||(this.instancesPerModel[l]=new pR);let o=this.instancesPerModel[l],d=o.instancedDataArray,s=new WR(n,d.length);for(let r of i)for(let c of r){if(c.x<0||c.x>=tt||c.y<0||c.y>=tt)continue;let b=(this.lookupDim-1)/tt,m=this.lookupDim*(c.y*b|0)+c.x*b|0;if(this.lookup){if(this.lookup[m]!==0)continue;this.lookup[m]=1}this.instanceCount++;let h=d.length;d.resize(h+1),o.instancesEvaluatedElevation.push(0),d.float32[16*h]=c.x,d.float32[16*h+1]=c.y}return s.instancedDataCount=o.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(t.id&&(o.idToFeaturesIndex[t.id]=o.features.length),o.features.push(s),this.evaluate(s,{},o,!1)),l}evaluate(t,i,n,a){let l=this.layers[0],o=t.feature,d=this.canonical,s=t.rotation=l.paint.get("model-rotation").evaluate(o,i,d),r=t.scale=l.paint.get("model-scale").evaluate(o,i,d),c=t.translation=l.paint.get("model-translation").evaluate(o,i,d),b=l.paint.get("model-color").evaluate(o,i,d);b.a=l.paint.get("model-color-mix-intensity").evaluate(o,i,d);let m=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,r[0]),Math.max(r[1],r[2])),bR(m,s,r);let h=Math.round(100*b.a)+b.b/1.05;for(let W=0;W<t.instancedDataCount;++W){let p=t.instancedDataOffset+W,Z=16*p,g=n.instancedDataArray.float32,u=0;a&&(u=g[Z+6]-n.instancesEvaluatedElevation[p]);let G=0|g[Z+1];g[Z]=(0|g[Z])+b.r/1.05,g[Z+1]=G+b.g/1.05,g[Z+2]=h,g[Z+3]=1/(d.z>10?this.tileToMeter:Ss(d,G)),g[Z+4]=c[0],g[Z+5]=c[1],g[Z+6]=c[2]+u,g[Z+7]=m[0],g[Z+8]=m[1],g[Z+9]=m[2],g[Z+10]=m[4],g[Z+11]=m[5],g[Z+12]=m[6],g[Z+13]=m[8],g[Z+14]=m[9],g[Z+15]=m[10],n.instancesEvaluatedElevation[p]=c[2]}}}kt(ZR,"ModelBucket",{omit:["layers"]}),kt(pR,"PerModelAttributes"),kt(WR,"ModelFeature");let VJ=new Zi({visibility:new mt(_.layout_model.visibility),"model-id":new Et(_.layout_model["model-id"])});var gJ={paint:new Zi({"model-opacity":new mt(_.paint_model["model-opacity"]),"model-rotation":new Et(_.paint_model["model-rotation"]),"model-scale":new Et(_.paint_model["model-scale"]),"model-translation":new Et(_.paint_model["model-translation"]),"model-color":new Et(_.paint_model["model-color"]),"model-color-mix-intensity":new Et(_.paint_model["model-color-mix-intensity"]),"model-type":new mt(_.paint_model["model-type"]),"model-cast-shadows":new mt(_.paint_model["model-cast-shadows"]),"model-receive-shadows":new mt(_.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new mt(_.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Et(_.paint_model["model-emissive-strength"]),"model-roughness":new Et(_.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Et(_.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new mt(_.paint_model["model-cutoff-fade-range"])}),layout:VJ};let pW=new Float32Array(262144),No=new Uint8Array(262144);function VR(e){let t=0;if(e.meshes)for(let i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(let i of e.children)t=Math.max(t,VR(i));return t}let gR=["","wall","door","roof","window","lamp","logo"];class uR{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:VR(t)}}}}class RR{constructor(t,i,n,a){this.nodes=t,this.id=i,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=a,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let n of i){let a=n.node;this.uploaded?this.updatePbrBuffer(a):WW(a,t,!0)}for(let n of i)Wb(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(let n of t.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),i=!0);return i}needsReEvaluation(t,i,n){let a=t.transform.projectionOptions,l=t.style.getBrightness(),o=this.brightness!==l;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||tr(n.paint.get("model-color").value,o)||tr(n.paint.get("model-color-mix-intensity").value,o)||tr(n.paint.get("model-roughness").value,o)||tr(n.paint.get("model-emissive-strength").value,o)||tr(n.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=a,this.brightness=l,!0)}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;let n=this.getNodesInfo(),a=this.id.canonical;for(let l of n){let o=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(o,{},a)}}evaluate(t){let i=this.getNodesInfo();for(let n of i){if(!n.node.meshes)continue;let a=n.feature,l=n.node.meshes&&n.node.meshes[0].featureData,o=n.evaluatedColor[2],d=n.evaluatedRMEA[2],s=this.id.canonical;if(n.hasTranslucentParts=!1,l){for(let r=0;r<gR.length;r++){let c=gR[r];c.length&&(a.properties.part=c);let b=t.paint.get("model-color").evaluate(a,{},s),m=t.paint.get("model-color-mix-intensity").evaluate(a,{},s);n.evaluatedColor[r]=[b.r,b.g,b.b,m],n.evaluatedRMEA[r][0]=t.paint.get("model-roughness").evaluate(a,{},s),n.evaluatedRMEA[r][2]=t.paint.get("model-emissive-strength").evaluate(a,{},s),n.evaluatedRMEA[r][3]=b.a,n.emissionHeightBasedParams[r]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},s),!n.hasTranslucentParts&&b.a<1&&(n.hasTranslucentParts=!0)}delete a.properties.part,RJ(n,o!==n.evaluatedColor[2]||d!==n.evaluatedRMEA[2])}n.evaluatedScale=t.paint.get("model-scale").evaluate(a,{},s),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,n,a){let l=t.findDEMTileFor(n);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;let o=Nd.create(t,n,l);if(!o)return;4&this.modelTraits&&this.updateDEM(t,o,n,a);for(let d of this.getNodesInfo()){let s=d.node;if(!s.footprint||!s.footprint.vertices||!s.footprint.vertices.length)continue;let r=s.footprint.vertices,c=o.getElevationAt(r[0].x,r[0].y,!0,!0);for(let b=1;b<r.length;b++)c=Math.min(c,o.getElevationAt(r[b].x,r[b].y,!0,!0));s.elevation=c}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,n,a){let l=i._dem._modifiedForSources[a];if(l===void 0&&(i._dem._modifiedForSources[a]=[],l=i._dem._modifiedForSources[a]),l.includes(n.canonical))return;let o=i._dem.dim;l.push(n.canonical);let d=!1;for(let s of this.getNodesInfo()){let r=s.node;if(!r.footprint||!r.footprint.grid)continue;let c=r.footprint.grid,b=i.tileCoordToPixel(c.min.x,c.min.y),m=i.tileCoordToPixel(c.max.x,c.max.y),h=Math.min(Math.min(o-m.y,b.x),Math.min(b.y,o-m.x));if(h<0)continue;let W=Mt(h,2,5),p=Math.max(0,b.x-W),Z=Math.max(0,b.y-W),g=Math.min(m.x+W,o-1),u=Math.min(m.y+W,o-1);for(let I=Z;I<=u;++I)for(let N=p;N<=g;++N)No[I*o+N]=255;let G=0,F=0;for(let I=0;I<c.cellsY;++I)for(let N=0;N<c.cellsX;++N){if(!c.cells[I*c.cellsX+N])continue;let Y=i.tileCoordToPixel(c.min.x+N/c.xScale,c.min.y+I/c.yScale),X=i.tileCoordToPixel(c.min.x+(N+1)/c.xScale,c.min.y+(I+1)/c.yScale);for(let J=Y.y;J<=Math.min(X.y+1,o-1);++J)for(let B=Y.x;B<=Math.min(X.x+1,o-1);++B)No[J*o+B]===255&&(No[J*o+B]=0,G+=i.getElevationAtPixel(B,J),F++)}let R=G/F;p=Math.max(1,b.x-W),Z=Math.max(1,b.y-W),g=Math.min(m.x+W,o-2),u=Math.min(m.y+W,o-2),d=!0;for(let I=Z;I<=u;++I)for(let N=p;N<=g;++N)No[I*o+N]===0&&(pW[I*o+N]=i._dem.set(N,I,R));for(let I=1;I<W;++I){p=Math.max(1,b.x-I),Z=Math.max(1,b.y-I),g=Math.min(m.x+I,o-2),u=Math.min(m.y+I,o-2);for(let N=Z;N<=u;++N)for(let Y=p;Y<=g;++Y){let X=N*o+Y;if(No[X]===255){let J=0,B=0,C=-1,Q=-1;for(let y=-1;y<=1;++y)for(let z=-1;z<=1;++z){let E=(N+y)*o+Y+z;if(No[E]>=I)continue;let O=pW[E],f=Math.abs(O);f>B&&(J=O,B=f,C=z,Q=y)}if(B>.1){let y=1-(I+.5*Math.abs(C*Q))/W,z=i._dem.get(Y,N)+J*y,E=i._dem.get(Y+C,N+Q),O=i._dem.get(Y-C,N-Q,!0);(z-E)*(z-O)>0&&(z=(E+O)/2),pW[X]=i._dem.set(Y,N,z),No[X]=I}}}}}d&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ee.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(let t of this.nodes)this.nodesInfo.push(new uR(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(let t of this.nodes)pb(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();let t=this.getNodesInfo();for(let i of t)Wb(i.node),pb(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let n=i.getReplacementRegionsForTile(t.toUnwrapped()),a=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){let o=a[l].node;a[l].hiddenByReplacement=!!o.footprint&&!n.find(d=>d.footprint===o.footprint)}}getHeightAtTileCoord(t,i){let n=this.getNodesInfo(),a=[];for(let l=0;l<this.nodesInfo.length;l++){let o=n[l],d=o.node.meshes[0];if(t<d.aabb.min[0]||i<d.aabb.min[1]||t>d.aabb.max[0]||i>d.aabb.max[1])continue;let s=(t-d.aabb.min[0])/(d.aabb.max[0]-d.aabb.min[0])*xo|0,r=Math.min(63,(i-d.aabb.min[1])/(d.aabb.max[1]-d.aabb.min[1])*xo|0)*xo+Math.min(63,s);if(!(d.heightmap[r]<0&&o.node.footprint))return o.hiddenByReplacement?void 0:{height:d.heightmap[r],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]};if(o.node.footprint.grid.query(new H(t,i),new H(t,i),a),a.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function tr(e,t){return!e.isLightConstant&&t}function uJ(e,t,i,n,a,l,o,d){let s=(61440&t|(61440&t)>>4)>>8,r=(3840&t|(3840&t)>>4)>>4,c=240&t|(240&t)>>4;i[3]>0&&(s=Pt(s,255*i[0],i[3]),r=Pt(r,255*i[1],i[3]),c=Pt(c,255*i[2],i[3]));let b=s<<8|r,m=c<<8|Math.floor(255*n[3]),h=function(I){let N=Mt(I,0,2);return Math.min(Math.round(.5*N*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],W=Mt(a[0],0,1),p=Mt(a[1],0,1),Z=Mt(a[2],0,1),g=Mt(a[3],0,1),u,G,F,R;if(W!==p&&o!==l&&p!==W){let I=o-l;G=1/(I*(p-W)),F=-(l+I*W)/(I*(p-W));let N=Mt(a[4],-1,1);R=Math.pow(10,N),u=255*Z<<8|255*g}else u=65535,G=0,F=1,R=1;if(e.emplaceBack(b,m,h,u,G,F,R),d){let I=d.length;d.clear();for(let N=0;N<I;N++)d.emplaceBack(b,m,h,u,G,F,R)}}function RJ(e,t){let i=e.node,n=0;for(let a of i.meshes){if(i.lights&&i.lightMeshIndex===n||!a.featureData)continue;a.featureArray=new pc,a.featureArray.reserve(a.featureData.length);let l=t;for(let o of a.featureData){let d,s=65535&o,r=(15&s)<8?15&s:0,c=o>>16&65535,b=e.evaluatedRMEA[r],m=e.evaluatedColor[r],h=e.emissionHeightBasedParams[r];if(l&&r===2&&i.lights&&(d=new pc,d.resize(10*i.lights.length)),uJ(a.featureArray,c,m,b,h,a.aabb.min[2],a.aabb.max[2],d),d&&l){l=!1;let W=i.meshes[i.lightMeshIndex];W.featureArray=d,W.featureArray._trim()}}a.featureArray._trim(),n++}}kt(RR,"Tiled3dModelBucket",{omit:["layers"]}),kt(uR,"Tiled3dModelFeature");class GJ{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let i=IR(new H(0,0),new H(tt,tt),t),n=[];for(let a of this._activeRegions){if(a.hiddenByOverlap||!FR(i,a))continue;let l=FJ(a.min,a.max,t);n.push({min:l.min,max:l.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return n}setSources(t){this._setSources(t.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{let n=[];for(let a of i.cache.getVisibleCoordinates()){let l=i.cache.getTile(a).buckets[i.layer];if(l)for(let o of l.getNodesInfo()){let d=o.node;d.footprint&&n.push({footprint:d.footprint,id:a.toUnwrapped()})}}return n}})))}_addSource(t){let i=t.getFootprints();if(i.length!==0){for(let n of i){if(!n.footprint)continue;let a=IR(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((i,n)=>i.priority-n.priority||Zb(i.min,n.min)||Zb(i.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let i=0,n=0;for(;!t&&i!==this._activeRegions.length;){let a=this._activeRegions[i],l=this._prevRegions[n];t=a.priority!==l.priority||!GR(a,l),++i,++n}}if(t){++this._updateTime;let i=n=>{let a=this._activeRegions;if(n>=a.length)return n;let l=a[n].priority;for(;n<a.length&&a[n].priority===l;)++n;return n};if(this._sourceIds.length>1){let n=0,a=i(n);for(;n!==a;){let l=n,o=n;for(;l!==a;){let d=this._activeRegions[l];d.hiddenByOverlap=!1;for(let s=0;s<o;s++){let r=this._activeRegions[s];if(!r.hiddenByOverlap&&FR(d,r)&&(d.hiddenByOverlap=xR(d.footprint,d.tileId,r.footprint,r.tileId),d.hiddenByOverlap))break}++l}n=a,a=i(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=t.length-1;i>=0;i--)this._addSource(t[i]);this._computeReplacement()}}function Zb(e,t){return e.x-t.x||e.y-t.y}function GR(e,t){return Zb(e.min,t.min)===0&&Zb(e.max,t.max)===0}function FR(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function IR(e,t,i){let n=1/tt,a=1/(1<<i.canonical.z),l=(t.x*n+i.canonical.x)*a+i.wrap,o=(t.y*n+i.canonical.y)*a;return{min:new H((e.x*n+i.canonical.x)*a+i.wrap,(e.y*n+i.canonical.y)*a),max:new H(l,o)}}function FJ(e,t,i){let n=1<<i.canonical.z,a=((t.x-i.wrap)*n-i.canonical.x)*tt,l=(t.y*n-i.canonical.y)*tt;return{min:new H(((e.x-i.wrap)*n-i.canonical.x)*tt,(e.y*n-i.canonical.y)*tt),max:new H(a,l)}}function UR(e,t,i,n,a,l,o){let d=e.indices,s=e.vertices,r=[];for(let c=n;c<n+a;c+=3){let b=t[i[c+0]+l],m=t[i[c+1]+l],h=t[i[c+2]+l],W=Math.min(b.x,m.x,h.x),p=Math.max(b.x,m.x,h.x),Z=Math.min(b.y,m.y,h.y),g=Math.max(b.y,m.y,h.y);r.length=0,e.grid.query(new H(W,Z),new H(p,g),r);for(let u=0;u<r.length;u++){let G=r[u];if(kh(s[d[3*G+0]],s[d[3*G+1]],s[d[3*G+2]],b,m,h,o))return!0}}return!1}function xR(e,t,i,n){if(!e||!i)return!1;let a=e.vertices;if(!t.canonical.equals(n.canonical)||t.wrap!==n.wrap){if(i.vertices.length<e.vertices.length)return xR(i,n,e,t);let l=t.canonical,o=n.canonical,d=Math.pow(2,o.z-l.z);a=e.vertices.map(s=>new H(s.x*l.x*tt*d-o.x*tt,s.y*l.y*tt*d-o.y*tt))}return UR(i,a,e.indices,0,e.indices.length,0,0)}let IJ=fc.types,UJ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],xJ=["fill-extrusion-flood-light-ground-radius"],NJ=Math.pow(2,13),YJ=Math.pow(2,15)-1,NR=new H(0,1),va=2147483648;function er(e,t,i,n,a,l,o,d){e.emplaceBack((t<<1)+o,(i<<1)+l,(Math.floor(n*NJ)<<1)+a,Math.round(d))}function Vb(e,t,i,n,a,l){e.emplaceBack(t.x,t.y,(i.x<<1)+n,(i.y<<1)+a,l)}function ir(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class YR{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class XR{constructor(){this.centroidXY=new H(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new H(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new H(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new H(this.max.x-this.min.x,this.max.y-this.min.y)}}class JR{constructor(){this.acc=new H(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,n){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<t.min.x?(t.min.x=i.x,a=!0):i.x>t.max.x&&(t.max.x=i.x,a=!0),i.y<t.min.y?(t.min.y=i.y,a=!0):i.y>t.max.y&&(t.max.y=i.y,a=!0),((i.x===0||i.x===tt)&&i.x===n.x)!=((i.y===0||i.y===tt)&&i.y===n.y)&&this.processBorderOverlap(i,n),a&&this.checkBorderIntersection(i,n)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,Pt(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>tt!=t.x>tt&&this.addBorderIntersection(1,Pt(i.y,t.y,(tt-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,Pt(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>tt!=t.y>tt&&this.addBorderIntersection(3,Pt(i.x,t.x,(tt-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let n=this.borders[t];i<n[0]&&(n[0]=i),i>n[1]&&(n[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;let n=t.x===0?0:1;this.addBorderIntersection(n,i.y),this.addBorderIntersection(n,t.y)}else{let n=t.y===0?2:3;this.addBorderIntersection(n,i.x),this.addBorderIntersection(n,t.x)}}centroid(){return this.accCount===0?new H(0,0):new H(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function yR(e,t){let i=e.add(t)._unit(),n=Mt(e.x*i.x+e.y*i.y,-1,1);var a,l,o;return a=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(a)))/4*YJ*((l=e).x*(o=t).y-l.y*o.x<0?-1:1)}let XJ=[e=>e.x<0,e=>e.x>tt,e=>e.y<0,e=>e.y>tt];function JJ(e,t,i,n){let a=[4];if(n===0)return a;i._mult(n);let l=e.sub(i),o=t.sub(i),d=[e,t,l,o];for(let s=0;s<4;s++)for(let r of d)if(XJ[s](r)){a.push(s);break}return a}class BR{constructor(t){this.vertexArray=new v0,this.indexArray=new yi,this.programConfigurations=new yl(t.layers,t.zoom,i=>xJ.includes(i)),this._segments=new ze,this.hiddenByLandmarkVertexArray=new P0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ze}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,n,a=!1){let l=t.length;if(l>2){let o=Math.max(0,this._segments.get().length-1),d=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[o].length),s;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{let r=t[0],c=t[1];s=yR(r.sub(t[l-1])._perp()._unit(),c.sub(r)._perp()._unit())}for(let r=0;r<l;r++){let c=r===l-1?0:r+1,b=t[r],m=t[c],h=t[c===l-1?0:c+1],W=m.sub(b)._perp()._unit(),p=yR(W,h.sub(m)._perp()._unit()),Z=s,g=p;if(ZW(b,m,i)||a&&TR(b,i)&&TR(m,i)){s=p;continue}let u=d.vertexLength;Vb(this.vertexArray,b,m,1,1,Z),Vb(this.vertexArray,b,m,1,0,Z),Vb(this.vertexArray,b,m,0,1,g),Vb(this.vertexArray,b,m,0,0,g),d.vertexLength+=4;let G=JJ(b,m,W,n);for(let F of G)this._segmentToGroundQuads[o].push({id:u,region:F}),this._segmentToRegionTriCounts[o][F]+=2,d.primitiveLength+=2;s=p}}}prepareBorderSegments(){if(!this.hasData())return;let t=this._segments.get(),i=t.length;for(let n=0;n<i;n++)this._segmentToGroundQuads[n].sort((a,l)=>a.region-l.region);for(let n=0;n<i;n++){let a=this._segmentToGroundQuads[n],l=t[n],o=this._segmentToRegionTriCounts[n];o.reduce((s,r)=>s+r,0);let d=0;for(let s=0;s<=4;s++){let r=o[s];if(r!==0){let c=this.regionSegments[s];c||(c=this.regionSegments[s]=new ze);let b={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+d,vertexLength:l.vertexLength,primitiveLength:r};c.get().push(b)}d+=r}for(let s=0;s<a.length;s++){let r=a[s].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,n,a,l,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,n,a,l,o)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,tY.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,n,a,l,o){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,n,a,l,o)}updateHiddenByLandmark(t){if(!this.hasData())return;let i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;let n=t.flags&va?1:0;for(let a=t.groundVertexArrayOffset;a<i;++a)this.hiddenByLandmarkVertexArray.emplace(a,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,iY.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){let i=this.regionSegments[t];i&&i.destroy()}}}}class nr{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new yi,this.footprintVertices=new Mn,this.footprintSegments=[],this.layoutVertexArray=new Zo,this.centroidVertexArray=new LZ,this.indexArray=new yi,this.programConfigurations=new yl(t.layers,t.zoom,i=>UJ.includes(i)),this.segments=new ze,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new BR(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,i,n,a){this.features=[],this.hasPattern=Eh("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ss(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:l,id:o,index:d,sourceLayerIndex:s}of t){let r=this.layers[0]._featureFilter.needGeometry,c=Ql(l,r);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),c,n))continue;let b={id:o,sourceLayerIndex:s,index:d,geometry:r?c.geometry:Ta(l,n,a),properties:l.properties,type:l.type,patterns:{}},m=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ah("fill-extrusion",this.layers,b,this.zoom,i)):this.addFeature(b,b.geometry,d,n,{},i.availableImages,a,i.brightness),i.featureIndex.insert(l,b.geometry,d,s,this.index,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,n,a,l,o){for(let d of this.features){let{geometry:s}=d;this.addFeature(d,s,d.index,i,n,a,l,o)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,n,a,l){let o=Object.keys(t).length!==0;if(o&&!this.stateDependentLayers.length)return;let d=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,i,d,n,a,l),this.groundEffect.update(t,i,d,n,a,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,aY),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,nY.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,eY.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,n,a,l,o,d,s){let r=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,c=[new H(0,0),new H(tt,tt)],b=d.projection,m=b.name==="globe",h=IJ[t.type]==="Polygon",W=new JR;W.centroidDataIndex=this.centroidData.length;let p=new XR,Z=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},a)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},a);p.height=g,p.vertexArrayOffset=this.layoutVertexArray.length,p.groundVertexArrayOffset=this.groundEffect.vertexArray.length,m&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new hc);let u=Lh(i,500);for(let Y=u.length-1;Y>=0;Y--){let X=u[Y];(X.length===0||(G=X[0]).every(J=>J.x<=0)||G.every(J=>J.x>=tt)||G.every(J=>J.y<=0)||G.every(J=>J.y>=tt))&&u.splice(Y,1)}var G;let F;if(m)F=vR(u,c,a);else{F=[];for(let Y of u)F.push({polygon:Y,bounds:c})}let R=h?this.edgeRadius:0,I=R>0&&this.zoom<17,N=(Y,X)=>{if(Y.length===0)return!1;let J=Y[Y.length-1];return X.x===J.x&&X.y===J.y};for(let{polygon:Y,bounds:X}of F){let J=0,B=0;for(let z of Y)h&&!z[0].equals(z[z.length-1])&&z.push(z[0]),B+=h?z.length-1:z.length;let C=this.segments.prepareSegment((h?5:4)*B,this.layoutVertexArray,this.indexArray);p.footprintSegIdx<0&&(p.footprintSegIdx=this.footprintSegments.length),p.polygonSegIdx<0&&(p.polygonSegIdx=this.polygonSegments.length);let Q={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},y=new YR;if(y.vertexOffset=this.footprintVertices.length,y.indexOffset=3*this.footprintIndices.length,y.ringIndices=[],h){let z=[],E=[];J=C.vertexLength;for(let f=0;f<Y.length;f++){let L=Y[f];L.length&&f!==0&&E.push(z.length/2);let K=[],q,P;q=L[1].sub(L[0])._perp()._unit(),y.ringIndices.push(L.length-1);for(let et=1;et<L.length;et++){let it=L[et],at=L[et===L.length-1?1:et+1],$=it.clone();if(R){P=at.sub(it)._perp()._unit();let ot=q.add(P)._unit(),Rt=R*Math.min(4,1/(q.x*ot.x+q.y*ot.y));$.x+=Rt*ot.x,$.y+=Rt*ot.y,$.x=Math.round($.x),$.y=Math.round($.y),q=P}!Z||R!==0&&!I||N(K,$)||K.push($),er(this.layoutVertexArray,$.x,$.y,0,0,1,1,0),C.vertexLength++,this.footprintVertices.emplaceBack(it.x,it.y),z.push(it.x,it.y),m&&ir(this.layoutVertexExtArray,b.projectTilePoint($.x,$.y,a),b.upVector(a,$.x,$.y))}Z&&(R===0||I)&&(K.length!==0&&N(K,K[0])&&K.pop(),this.groundEffect.addData(K,X,r))}let O=Sc(z,E);for(let f=0;f<O.length;f+=3)this.footprintIndices.emplaceBack(y.vertexOffset+O[f+0],y.vertexOffset+O[f+1],y.vertexOffset+O[f+2]),this.indexArray.emplaceBack(J+O[f],J+O[f+2],J+O[f+1]),C.primitiveLength++;y.indexCount+=O.length,y.vertexCount+=this.footprintVertices.length-y.vertexOffset}for(let z=0;z<Y.length;z++){let E=Y[z];W.startRing(p,E[0]);let O=E.length>4&&kR(E[E.length-2],E[0],E[1]),f=R?yJ(E[E.length-2],E[0],E[1],R):0,L=[],K,q,P;q=E[1].sub(E[0])._perp()._unit();let et=!0;for(let it=1,at=0;it<E.length;it++){let $=E[it-1],ot=E[it],Rt=E[it===E.length-1?1:it+1];if(W.appendEdge(p,ot,$),ZW(ot,$,X)){R&&(q=Rt.sub(ot)._perp()._unit(),et=!et);continue}let Gt=ot.sub($)._perp(),Yt=Gt.x/(Math.abs(Gt.x)+Math.abs(Gt.y)),Bt=Gt.y>0?1:0,Dt=$.dist(ot);if(at+Dt>32768&&(at=0),R){P=Rt.sub(ot)._perp()._unit();let _t=CR($,ot,Rt,MR(q,P),R);isNaN(_t)&&(_t=0);let jt=ot.sub($)._unit();$=$.add(jt.mult(f))._round(),ot=ot.add(jt.mult(-_t))._round(),f=_t,q=P,Z&&this.zoom>=17&&(N(L,$)||L.push($),N(L,ot)||L.push(ot))}let ft=C.vertexLength,xe=E.length>4&&kR($,ot,Rt),pe=SR(at,O,et);if(er(this.layoutVertexArray,$.x,$.y,Yt,Bt,0,0,pe),er(this.layoutVertexArray,$.x,$.y,Yt,Bt,0,1,pe),at+=Dt,pe=SR(at,xe,!et),O=xe,er(this.layoutVertexArray,ot.x,ot.y,Yt,Bt,0,0,pe),er(this.layoutVertexArray,ot.x,ot.y,Yt,Bt,0,1,pe),C.vertexLength+=4,this.indexArray.emplaceBack(ft+0,ft+1,ft+2),this.indexArray.emplaceBack(ft+1,ft+3,ft+2),C.primitiveLength+=2,R){let _t=J+(it===1?E.length-2:it-2),jt=it===1?J:_t+1;if(this.indexArray.emplaceBack(ft+1,_t,ft+3),this.indexArray.emplaceBack(_t,jt,ft+3),C.primitiveLength+=2,K===void 0&&(K=ft),!ZW(Rt,E[it],X)){let zt=it===E.length-1?K:C.vertexLength;this.indexArray.emplaceBack(ft+2,ft+3,zt),this.indexArray.emplaceBack(ft+3,zt+1,zt),this.indexArray.emplaceBack(ft+3,jt,zt+1),C.primitiveLength+=3}et=!et}if(m){let _t=this.layoutVertexExtArray,jt=b.projectTilePoint($.x,$.y,a),zt=b.projectTilePoint(ot.x,ot.y,a),ge=b.upVector(a,$.x,$.y),Ie=b.upVector(a,ot.x,ot.y);ir(_t,jt,ge),ir(_t,jt,ge),ir(_t,zt,Ie),ir(_t,zt,Ie)}}h&&(J+=E.length-1),Z&&R&&this.zoom>=17&&(L.length!==0&&N(L,L[0])&&L.pop(),this.groundEffect.addData(L,X,r,R>0))}this.footprintSegments.push(y),Q.triangleCount=this.indexArray.length-Q.triangleArrayOffset,this.polygonSegments.push(Q),++p.footprintSegLen,++p.polygonSegLen}if(p.vertexCount=this.layoutVertexArray.length-p.vertexArrayOffset,p.groundVertexCount=this.groundEffect.vertexArray.length-p.groundVertexArrayOffset,p.vertexCount!==0){if(p.centroidXY=W.borders?NR:this.encodeCentroid(W,p),this.centroidData.push(p),W.borders){this.featuresOnBorder.push(W);let Y=this.featuresOnBorder.length-1;for(let X=0;X<W.borders.length;X++)W.borders[X][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[X].push(Y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,l,o,a,s),this.groundEffect.addPaintPropertiesData(t,n,l,o,a,s),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,n)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[n].borders[t][0])}splitToSubtiles(){let t=[];for(let d=0;d<this.centroidData.length;d++){let s=this.centroidData[d],r=+(s.min.y+s.max.y>tt),c=2*r+(+(s.min.x+s.max.x>tt)^r);for(let b=0;b<s.polygonSegLen;b++){let m=s.polygonSegIdx+b;t.push({centroidIdx:d,subtile:c,polygonSegmentIdx:m,triangleSegmentIdx:this.polygonSegments[m].triangleSegIdx})}}let i=new yi;t.sort((d,s)=>d.triangleSegmentIdx===s.triangleSegmentIdx?d.subtile-s.subtile:d.triangleSegmentIdx-s.triangleSegmentIdx);let n=0,a=0,l=0;for(let d of t){if(d.triangleSegmentIdx!==n)break;l++}let o=t.length;for(;a!==t.length;){n=t[a].triangleSegmentIdx;let d=0,s=a,r=a;for(let c=s;c<l&&t[c].subtile===d;c++)r++;for(;s!==l;){let c=t[s];d=c.subtile;let b=this.centroidData[c.centroidIdx].min.clone(),m=this.centroidData[c.centroidIdx].max.clone(),h={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let W=s;W<r;W++){let p=t[W],Z=this.polygonSegments[p.polygonSegmentIdx],g=this.centroidData[p.centroidIdx].min,u=this.centroidData[p.centroidIdx].max,G=this.indexArray.uint16;for(let F=Z.triangleArrayOffset;F<Z.triangleArrayOffset+Z.triangleCount;F++)i.emplaceBack(G[3*F],G[3*F+1],G[3*F+2]);h.primitiveLength+=Z.triangleCount,b.x=Math.min(b.x,g.x),b.y=Math.min(b.y,g.y),m.x=Math.max(m.x,u.x),m.y=Math.max(m.y,u.y)}h.primitiveLength>0&&this.triangleSubSegments.push({segment:h,min:b,max:m}),s=r;for(let W=s;W<l&&t[W].subtile===t[s].subtile;W++)r++}a=l;for(let c=a;c<o&&t[c].triangleSegmentIdx===t[a].triangleSegmentIdx;c++)l++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,n){let a=0,l=0,o=1<<t.canonical.z;if(i){let p=i.getMinMaxForTile(t);p&&(a=p.min,l=p.max)}l+=this.maxHeight;let d=t.toUnwrapped(),s,r=[d.canonical.x/o+d.wrap,d.canonical.y/o],c=[(d.canonical.x+1)/o+d.wrap,(d.canonical.y+1)/o],b=new ze,m=(p,Z,g)=>[p[0]*(1-g[0])+Z[0]*g[0],p[1]*(1-g[1])+Z[1]*g[1]],h=[],W=[];for(let p of this.triangleSubSegments){h[0]=p.min.x/tt,h[1]=p.min.y/tt,W[0]=p.max.x/tt,W[1]=p.max.y/tt;let Z=m(r,c,h),g=m(r,c,W);if(new $e([Z[0],Z[1],a],[g[0],g[1],l]).intersectsPrecise(n)===0){s&&(b.segments.push(s),s=void 0);continue}let u=p.segment;s&&s.vertexOffset!==u.vertexOffset&&(b.segments.push(s),s=void 0),s?(s.vertexLength+=u.vertexLength,s.primitiveLength+=u.primitiveLength):s={vertexOffset:u.vertexOffset,primitiveLength:u.primitiveLength,vertexLength:u.vertexLength,primitiveOffset:u.primitiveOffset,sortKey:void 0,vaos:{}}}return s&&b.segments.push(s),b}encodeCentroid(t,i){let n=t.centroid(),a=i.span(),l=Math.min(7,Math.round(a.x*this.tileToMeter/10)),o=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new H(Mt(n.x,1,tt-1)<<3|l,Mt(n.y,1,tt-1)<<3|o)}showCentroid(t){let i=this.centroidData[t.centroidDataIndex];i.flags&=va,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);let i=t.vertexArrayOffset,n=t.vertexCount+t.vertexArrayOffset,a=t.flags&va?NR:t.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||l!==a.x){for(let o=i;o<n;++o)this.centroidVertexArray.emplace(o,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let n=i.getReplacementRegionsForTile(t.toUnwrapped());if(function(l,o){if(l.length!==o.length)return!1;for(let d=0;d<l.length;d++)if(l[d].sourceId!==o[d].sourceId||!GR(l[d],o[d]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let l of this.centroidData)l.flags&=2147483647;let a=[];for(let l of this.activeReplacements){let o=Math.pow(2,l.footprintTileId.canonical.z-t.canonical.z);for(let d of this.centroidData)if(!(d.flags&va||l.min.x>d.max.x||d.min.x>l.max.x||l.min.y>d.max.y||d.min.y>l.max.y))for(let s=0;s<d.footprintSegLen;s++){let r=this.footprintSegments[d.footprintSegIdx+s];if(a.length=0,BJ(this.footprintVertices,r.vertexOffset,r.vertexCount,l.footprintTileId.canonical,t.canonical,a),UR(l.footprint,a,this.footprintIndices.uint16,r.indexOffset,r.indexCount,-r.vertexOffset,-o)){d.flags|=va;break}}}for(let l of this.centroidData)this.writeCentroidToBuffer(l);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,n){let a=!1;for(let l=0;l<n.footprintSegLen;l++){let o=this.footprintSegments[n.footprintSegIdx+l],d=0;for(let s of o.ringIndices){for(let r=d,c=s+d-1;r<s+d;c=r++){let b=this.footprintVertices.int16[2*(r+o.vertexOffset)+0],m=this.footprintVertices.int16[2*(r+o.vertexOffset)+1],h=this.footprintVertices.int16[2*(c+o.vertexOffset)+1];m>i!=h>i&&t<(this.footprintVertices.int16[2*(c+o.vertexOffset)+0]-b)*(i-m)/(h-m)+b&&(a=!a)}d=s}}return a}getHeightAtTileCoord(t,i){let n=Number.NEGATIVE_INFINITY,a=!0,l=4*(t+tt)*tt+(i+tt);if(this.partLookup.hasOwnProperty(l)){let o=this.partLookup[l];return o?{height:o.height,hidden:!!(o.flags&va)}:void 0}for(let o of this.centroidData)t>o.max.x||o.min.x>t||i>o.max.y||o.min.y>i||this.footprintContainsPoint(t,i,o)&&o&&o.height>n&&(n=o.height,this.partLookup[l]=o,a=!!(o.flags&va));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:a};this.partLookup[l]=void 0}}function MR(e,t){let i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function yJ(e,t,i,n){let a=t.sub(e)._perp()._unit(),l=i.sub(t)._perp()._unit();return CR(e,t,i,MR(a,l),n)}function CR(e,t,i,n,a){let l=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(i)/3,a*l/n)}function ZW(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function TR(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function kR(e,t,i){if(e.x<0||e.x>=tt||t.x<0||t.x>=tt||i.x<0||i.x>=tt)return!1;let n=i.sub(t),a=n.perp(),l=e.sub(t);return(n.x*l.x+n.y*l.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(l.x*l.x+l.y*l.y))>-.866&&a.x*l.x+a.y*l.y<0}function SR(e,t,i){let n=t?2|e:-3&e;return i?1|n:-2&n}function QR(){let e=Math.PI/32,t=Math.tan(e),i=ud;return i*Math.sqrt(1+2*t*t)-i}function vR(e,t,i){let n=1<<i.z,a=kn(i.x/n),l=kn((i.x+1)/n),o=Bi(i.y/n),d=Bi((i.y+1)/n);return function(s,r,c,b,m=0,h){let W=[];if(!s.length||!c||!b)return W;let p=(I,N)=>{for(let Y of I)W.push({polygon:Y,bounds:N})},Z=Math.ceil(Math.log2(c)),g=Math.ceil(Math.log2(b)),u=Z-g,G=[];for(let I=0;I<Math.abs(u);I++)G.push(u>0?0:1);for(let I=0;I<Math.min(Z,g);I++)G.push(0),G.push(1);let F=s;if(F=zc(F,r[0].y-m,r[1].y+m,1),F=zc(F,r[0].x-m,r[1].x+m,0),!F.length)return W;let R=[];for(G.length?R.push({polygons:F,bounds:r,depth:0}):p(F,r);R.length;){let I=R.pop(),N=I.depth,Y=G[N],X=I.bounds[0],J=I.bounds[1],B=Y===0?X.x:X.y,C=Y===0?J.x:J.y,Q=h?h(Y,B,C):.5*(B+C),y=zc(I.polygons,B-m,Q+m,Y),z=zc(I.polygons,Q-m,C+m,Y);if(y.length){let E=[X,new H(Y===0?Q:J.x,Y===1?Q:J.y)];G.length>N+1?R.push({polygons:y,bounds:E,depth:N+1}):p(y,E)}if(z.length){let E=[new H(Y===0?Q:X.x,Y===1?Q:X.y),J];G.length>N+1?R.push({polygons:z,bounds:E,depth:N+1}):p(z,E)}}return W}(e,t,Math.ceil((l-a)/11.25),Math.ceil((o-d)/11.25),1,(s,r,c)=>{if(s===0)return .5*(r+c);{let b=Bi((i.y+r/tt)/n);return(Li(.5*(Bi((i.y+c/tt)/n)+b))*n-i.y)*tt}})}function BJ(e,t,i,n,a,l){let o=Math.pow(2,n.z-a.z);for(let d=0;d<i;d++){let s=e.int16[2*(d+t)+0],r=e.int16[2*(d+t)+1];s=(s+a.x*tt)*o-n.x*tt,r=(r+a.y*tt)*o-n.y*tt,l.push(new H(s,r))}}kt(nr,"FillExtrusionBucket",{omit:["layers","features"]}),kt(XR,"PartData"),kt(YR,"FootprintSegment"),kt(JR,"BorderCentroidData"),kt(BR,"GroundEffect");let MJ=new Zi({visibility:new mt(_["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new mt(_["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var CJ={paint:new Zi({"fill-extrusion-opacity":new mt(_["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Et(_["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mt(_["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mt(_["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Et(_["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Et(_["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Et(_["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mt(_["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new mt(_["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new mt(_["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new mt(_["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new mt(_["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new mt(_["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new mt(_["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new mt(_["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Et(_["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Et(_["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new mt(_["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new mt(_["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new mt(_["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new mt(_["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new mt(_["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:MJ};class kd extends H{constructor(t,i,n){super(t,i),this.z=n}}function ar(e,t){return e.x*t.x+e.y*t.y}function fR(e,t){if(e.length===1){let i=0,n=t[i++],a;for(;!a||n.equals(a);)if(a=t[i++],!a)return 1/0;for(;i<t.length;i++){let l=t[i],o=e[0],d=a.sub(n),s=l.sub(n),r=o.sub(n),c=ar(d,d),b=ar(d,s),m=ar(s,s),h=ar(r,d),W=ar(r,s),p=c*m-b*b,Z=(m*h-b*W)/p,g=(c*W-b*h)/p,u=n.z*(1-Z-g)+a.z*Z+l.z*g;if(isFinite(u))return u}return 1/0}{let i=1/0;for(let n of t)i=Math.min(i,n.z);return i}}function zR(e,t,i,n,a,l,o,d){let s=o*a.getElevationAt(e,t,!0,!0),r=l[0]!==0,c=r?l[1]===0?o*(l[0]/7-450):o*function(b,m,h){let W=Math.floor(m[0]/8),p=Math.floor(m[1]/8),Z=10*(m[0]-8*W),g=10*(m[1]-8*p),u=b.getElevationAt(W,p,!0,!0),G=b.getMeterToDEM(h),F=Math.floor(.5*(Z*G-1)),R=Math.floor(.5*(g*G-1)),I=b.tileCoordToPixel(W,p),N=2*F+1,Y=2*R+1,X=function(z,E,O,f,L){return[z.getElevationAtPixel(E,O,!0),z.getElevationAtPixel(E+L,O,!0),z.getElevationAtPixel(E,O+L,!0),z.getElevationAtPixel(E+f,O+L,!0)]}(b,I.x-F,I.y-R,N,Y),J=Math.abs(X[0]-X[1]),B=Math.abs(X[2]-X[3]),C=Math.abs(X[0]-X[2])+Math.abs(X[1]-X[3]),Q=Math.min(.25,.5*G*(J+B)/N),y=Math.min(.25,.5*G*C/Y);return u+Math.max(Q*Z,y*g)}(a,l,d):s;return{base:s+(i===0)?-1:i,top:r?Math.max(c+n,s+i+2):s+n}}let TJ=new Zi({"line-cap":new Et(_.layout_line["line-cap"]),"line-join":new Et(_.layout_line["line-join"]),"line-miter-limit":new mt(_.layout_line["line-miter-limit"]),"line-round-limit":new mt(_.layout_line["line-round-limit"]),"line-sort-key":new Et(_.layout_line["line-sort-key"]),visibility:new mt(_.layout_line.visibility)});var LR={paint:new Zi({"line-opacity":new Et(_.paint_line["line-opacity"]),"line-color":new Et(_.paint_line["line-color"]),"line-translate":new mt(_.paint_line["line-translate"]),"line-translate-anchor":new mt(_.paint_line["line-translate-anchor"]),"line-width":new Et(_.paint_line["line-width"]),"line-gap-width":new Et(_.paint_line["line-gap-width"]),"line-offset":new Et(_.paint_line["line-offset"]),"line-blur":new Et(_.paint_line["line-blur"]),"line-dasharray":new Et(_.paint_line["line-dasharray"]),"line-pattern":new Et(_.paint_line["line-pattern"]),"line-gradient":new Ns(_.paint_line["line-gradient"]),"line-trim-offset":new mt(_.paint_line["line-trim-offset"]),"line-emissive-strength":new mt(_.paint_line["line-emissive-strength"]),"line-border-width":new Et(_.paint_line["line-border-width"]),"line-border-color":new Et(_.paint_line["line-border-color"])}),layout:TJ};let kJ=(e,t,i,n,a,l,o)=>{let d=e.transform,s=d.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:AR(e,t,i,n),u_pixels_to_tile_units:s,u_device_pixel_ratio:l,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:jR(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ER(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:o,u_emissive_strength:i.paint.get("line-emissive-strength")}},SJ=(e,t,i,n,a)=>{let l=e.transform;return{u_matrix:AR(e,t,i,n),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:l.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:ER(t,l),u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ER(e,t){return 1/Uo(e,1,t.tileZoom)}function AR(e,t,i,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let wR=e=>{let t=[];jR(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");let i=e.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function jR(e){let t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let HR=new class extends Et{possiblyEvaluate(e,t){return t=new si(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=Xt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(LR.paint.properties["line-width"].specification);function OR(e,t){return t>0?t+2*e:e}HR.useIntegerZoom=!0;let QJ=new Zi({visibility:new mt(_.layout_background.visibility)});var vJ={paint:new Zi({"background-color":new mt(_.paint_background["background-color"]),"background-pattern":new mt(_.paint_background["background-pattern"]),"background-opacity":new mt(_.paint_background["background-opacity"]),"background-emissive-strength":new mt(_.paint_background["background-emissive-strength"])}),layout:QJ};let fJ=new Zi({visibility:new mt(_.layout_raster.visibility)});var zJ={paint:new Zi({"raster-opacity":new mt(_.paint_raster["raster-opacity"]),"raster-color":new Ns(_.paint_raster["raster-color"]),"raster-color-mix":new mt(_.paint_raster["raster-color-mix"]),"raster-color-range":new mt(_.paint_raster["raster-color-range"]),"raster-hue-rotate":new mt(_.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mt(_.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mt(_.paint_raster["raster-brightness-max"]),"raster-saturation":new mt(_.paint_raster["raster-saturation"]),"raster-contrast":new mt(_.paint_raster["raster-contrast"]),"raster-resampling":new mt(_.paint_raster["raster-resampling"]),"raster-fade-duration":new mt(_.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new mt(_.paint_raster["raster-emissive-strength"]),"raster-array-band":new mt(_.paint_raster["raster-array-band"]),"raster-elevation":new mt(_.paint_raster["raster-elevation"])}),layout:fJ};function DR(e,t,i,n,a,l,o,d){let s=[e,i,a,t,n,l,1,1,1],r=[o,d,1],c=Rn.adjoint([],s),[b,m,h]=S.transformMat3(r,r,Rn.transpose(c,c));return Rn.multiply(s,[b,0,0,0,m,0,0,0,h],s)}class oa extends Xi{constructor(t,i,n,a){super(),this.id=t,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new Wt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=de(this.map._requestManager.transformRequest(this.url,nt.Image),(n,a)=>{if(this._imageRequest=null,this._loaded=!0,n)this.fire(new $t(n));else if(a){let{HTMLImageElement:l}=T;this.image=a instanceof l?ee.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new db(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof db||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],n=t[0][1];for(let l of t)l[1]>n&&(n=l[1]),l[1]<i&&(i=l[1]);let a=(n+i)/2;if(a>ui?this.onNorthPole=!0:a<-ui&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let l=t.map(Re.fromLngLat);this.tileID=function(o){let d=1/0,s=1/0,r=-1/0,c=-1/0;for(let W of o)d=Math.min(d,W.x),s=Math.min(s,W.y),r=Math.max(r,W.x),c=Math.max(c,W.y);let b=Math.max(r-d,c-s),m=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),h=Math.pow(2,m);return new ia(m,Math.floor((d+r)/2*h),Math.floor((s+c)/2*h))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(let s in this.tiles){let r=this.tiles[s];r.state!=="loaded"&&(r.state="loaded",r.texture=this.texture)}if(this._boundsArray)return;let i=Io(this.tileID,this.map.transform.projection),[n,a,l,o]=this.coordinates.map(s=>{let r=i.projection.project(s[0],s[1]);return Su(i,r)._round()});this.perspectiveTransform=function(s,r,c,b,m,h,W,p,Z,g){let u=DR(0,0,s,0,0,r,s,r),G=DR(c,b,m,h,W,p,Z,g);return Rn.multiply(G,Rn.adjoint(u,u),G),[G[6]/G[8]*s/tt,G[7]/G[8]*r/tt]}(this.width,this.height,n.x,n.y,a.x,a.y,o.x,o.y,l.x,l.y);let d=this._boundsArray=new Zo;d.emplaceBack(n.x,n.y,0,0),d.emplaceBack(a.x,a.y,tt,0),d.emplaceBack(o.x,o.y,0,tt),d.emplaceBack(l.x,l.y,tt,tt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(d,lW.members),this.boundsSegments=ze.simpleSegment(0,0,4,2)}prepare(){let t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;let i=this.map.painter.context,n=i.gl;!this._dirty||this.texture instanceof db||(this.texture?this.texture.update(this.image):(this.texture=new bi(i,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class LJ extends En{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}let EJ=new Zi({visibility:new mt(_.layout_sky.visibility)});var AJ={paint:new Zi({"sky-type":new mt(_.paint_sky["sky-type"]),"sky-atmosphere-sun":new mt(_.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new mt(_.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new mt(_.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new mt(_.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ns(_.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new mt(_.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new mt(_.paint_sky["sky-atmosphere-color"]),"sky-opacity":new mt(_.paint_sky["sky-opacity"])}),layout:EJ};function VW(e,t,i){let n=[0,0,1],a=an.identity([]);return an.rotateY(a,a,i?-At(e)+Math.PI:At(e)),an.rotateX(a,a,-At(t)),S.transformQuat(n,n,a),S.normalize(n,n)}var wJ={paint:new Zi({})};let jJ={circle:class extends En{constructor(e,t){super(e,JN,t)}createBucket(e){return new Mh(e)}queryRadius(e){let t=e;return Gd("circle-radius",this,t)+Gd("circle-stroke-width",this,t)+yc(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,n,a,l,o,d){let s=Sg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),r=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return vg(e,n,l,o,d,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",s,r)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){let i=Qg(this);return{config:new uo(this,t),defines:i,overrideFog:!1}}},heatmap:class extends En{createBucket(e){return new zg(e)}constructor(e,t){super(e,SN,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Bc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Gd("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,n,a,l,o,d){let s=this.paint.get("heatmap-radius").evaluate(t,i);return vg(e,n,l,o,d,!0,!0,new H(0,0),s)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new uo(this,t),overrideFog:!1}:{}}},hillshade:class extends En{constructor(e,t){super(e,vN,t)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends En{constructor(e,t){super(e,qN,t)}getProgramIds(){let e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new uo(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Qc(e)}queryRadius(){return yc(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,n,a,l){return!e.queryGeometry.isAboveHorizon&&Bg(kg(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends En{constructor(e,t){super(e,CJ,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new nr(e)}queryRadius(){return yc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,n,a,l,o,d,s){let r=Sg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(t,i),b=this.paint.get("fill-extrusion-base").evaluate(t,i),m=[0,0],h=d&&l.elevation,W=l.elevation?l.elevation.exaggeration():1,p=e.tile.getBucket(this);if(h&&p instanceof nr){let F=p.centroidVertexArray,R=s+1;R<F.length&&(m[0]=F.geta_centroid_pos0(R),m[1]=F.geta_centroid_pos1(R))}if(m[0]===0&&m[1]===1)return!1;l.projection.name==="globe"&&(n=vR([n],[new H(0,0),new H(tt,tt)],e.tileID.canonical).map(F=>F.polygon).flat());let Z=h?d:null,[g,u]=function(F,R,I,N,Y,X,J,B,C,Q,y){return F.projection.name==="globe"?function(z,E,O,f,L,K,q,P,et,it,at){let $=[],ot=[],Rt=z.projection.upVectorScale(at,z.center.lat,z.worldSize).metersToTile,Gt=[0,0,0,1],Yt=[0,0,0,1],Bt=(ft,xe,pe,_t)=>{ft[0]=xe,ft[1]=pe,ft[2]=_t,ft[3]=1},Dt=QR();O>0&&(O+=Dt),f+=Dt;for(let ft of E){let xe=[],pe=[];for(let _t of ft){let jt=_t.x+L.x,zt=_t.y+L.y,ge=z.projection.projectTilePoint(jt,zt,at),Ie=z.projection.upVector(at,_t.x,_t.y),se=O,Oe=f;if(q){let Ri=zR(jt,zt,O,f,q,P,et,it);se+=Ri.base,Oe+=Ri.top}O!==0?Bt(Gt,ge.x+Ie[0]*Rt*se,ge.y+Ie[1]*Rt*se,ge.z+Ie[2]*Rt*se):Bt(Gt,ge.x,ge.y,ge.z),Bt(Yt,ge.x+Ie[0]*Rt*Oe,ge.y+Ie[1]*Rt*Oe,ge.z+Ie[2]*Rt*Oe),S.transformMat4(Gt,Gt,K),S.transformMat4(Yt,Yt,K),xe.push(new kd(Gt[0],Gt[1],Gt[2])),pe.push(new kd(Yt[0],Yt[1],Yt[2]))}$.push(xe),ot.push(pe)}return[$,ot]}(F,R,I,N,Y,X,J,B,C,Q,y):J?function(z,E,O,f,L,K,q,P,et){let it=[],at=[],$=[0,0,0,1];for(let ot of z){let Rt=[],Gt=[];for(let Yt of ot){let Bt=Yt.x+f.x,Dt=Yt.y+f.y,ft=zR(Bt,Dt,E,O,K,q,P,et);$[0]=Bt,$[1]=Dt,$[2]=ft.base,$[3]=1,Le.transformMat4($,$,L),$[3]=Math.max($[3],1e-5);let xe=new kd($[0]/$[3],$[1]/$[3],$[2]/$[3]);$[0]=Bt,$[1]=Dt,$[2]=ft.top,$[3]=1,Le.transformMat4($,$,L),$[3]=Math.max($[3],1e-5);let pe=new kd($[0]/$[3],$[1]/$[3],$[2]/$[3]);Rt.push(xe),Gt.push(pe)}it.push(Rt),at.push(Gt)}return[it,at]}(R,I,N,Y,X,J,B,C,Q):function(z,E,O,f,L){let K=[],q=[],P=L[8]*E,et=L[9]*E,it=L[10]*E,at=L[11]*E,$=L[8]*O,ot=L[9]*O,Rt=L[10]*O,Gt=L[11]*O;for(let Yt of z){let Bt=[],Dt=[];for(let ft of Yt){let xe=ft.x+f.x,pe=ft.y+f.y,_t=L[0]*xe+L[4]*pe+L[12],jt=L[1]*xe+L[5]*pe+L[13],zt=L[2]*xe+L[6]*pe+L[14],ge=L[3]*xe+L[7]*pe+L[15],Ie=_t+P,se=jt+et,Oe=zt+it,Ri=Math.max(ge+at,1e-5),Ee=_t+$,ti=jt+ot,xi=zt+Rt,Gi=Math.max(ge+Gt,1e-5);Bt.push(new kd(Ie/Ri,se/Ri,Oe/Ri)),Dt.push(new kd(Ee/Gi,ti/Gi,xi/Gi))}K.push(Bt),q.push(Dt)}return[K,q]}(R,I,N,Y,X)}(l,n,b,c,r,o,Z,m,W,l.center.lat,e.tileID.canonical),G=e.queryGeometry;return function(F,R,I){let N=1/0;Bg(I,R)&&(N=fR(I,R[0]));for(let Y=0;Y<R.length;Y++){let X=R[Y],J=F[Y];for(let B=0;B<X.length-1;B++){let C=X[B],Q=[C,X[B+1],J[B+1],J[B],C];yg(I,Q)&&(N=Math.min(N,fR(I,Q)))}}return N!==1/0&&N}(g,u,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends En{constructor(e,t){super(e,LR,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof n0,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=HR.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ob(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){let i=wR(this);return{config:new uo(this,t),defines:i,overrideFog:!1}}queryRadius(e){let t=e,i=OR(Gd("line-width",this,t),Gd("line-gap-width",this,t)),n=Gd("line-offset",this,t);return i/2+Math.abs(n)+yc(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,a,l){if(e.queryGeometry.isAboveHorizon)return!1;let o=kg(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,e.pixelToTileUnitsFactor),d=e.pixelToTileUnitsFactor/2*OR(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),s=this.paint.get("line-offset").evaluate(t,i);return s&&(n=function(r,c){let b=[],m=new H(0,0);for(let h=0;h<r.length;h++){let W=r[h],p=[];for(let Z=0;Z<W.length;Z++){let g=W[Z],u=W[Z+1],G=Z===0?m:g.sub(W[Z-1])._unit()._perp(),F=Z===W.length-1?m:u.sub(g)._unit()._perp(),R=G._add(F)._unit();R._mult(1/(R.x*F.x+R.y*F.y)),p.push(R._mult(c)._add(g))}b.push(p)}return b}(n,s*e.pixelToTileUnitsFactor)),function(r,c,b){for(let m=0;m<c.length;m++){let h=c[m];if(r.length>=3){for(let W=0;W<h.length;W++)if(vl(r,h[W]))return!0}if(xN(r,h,b))return!0}return!1}(o,n,d)}isTileClipped(){return!0}},symbol:tb,background:class extends En{constructor(e,t){super(e,vJ,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends En{constructor(e,t){super(e,zJ,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof oa)||!e._source.onNorthPole&&!e._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-color"].value.expression,[t,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Bc({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends En{constructor(e,t){super(e,AJ,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Bc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){let n=this.paint.get("sky-atmosphere-sun"),a=!n,l=e.style.light,o=l.properties.get("position");return a&&l.properties.get("anchor")==="viewport"&&A("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?VW(o.azimuthal,90-o.polar,t):VW(n[0],90-n[1],t)}let i=this.paint.get("sky-gradient-center");return VW(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends En{constructor(e,t){super(e,wJ)}},model:class extends En{constructor(e,t){super(e,gJ,t)}createBucket(e){return new ZR(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){let t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Ul}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function gb(e,t){return e.type==="custom"?new LJ(e):new jJ[e.type](e,t)}function HJ(e){let{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class OJ extends Xi{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Yi({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,i){if(this.loaded[i]!==t&&(this.loaded[i]=t,t)){for(let{ids:n,callback:a}of this.requestors)this._notify(n,i,a);this.requestors=[]}}hasImage(t,i){return!!this.getImage(t,i)}getImage(t,i){return this.images[i][t]}addImage(t,i,n){this._validate(t,n)&&(this.images[i][t]=n)}_validate(t,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new $t(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new $t(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),n=!1),this._validateContent(i.content,i)||(this.fire(new $t(new Error('Image "'.concat(t,'" has invalid "content" value')))),n=!1),n}_validateStretch(t,i){if(!t)return!0;let n=0;for(let a of t){if(a[0]<n||a[1]<a[0]||i<a[1])return!1;n=a[1]}return!0}_validateContent(t,i){return!(t&&(t.length!==4||t[0]<0||i.data.width<t[0]||t[1]<0||i.data.height<t[1]||t[2]<0||i.data.width<t[2]||t[3]<0||i.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,i,n){n.version=this.images[i][t].version+1,this.images[i][t]=n,this.updatedImages[i][t]=!0}removeImage(t,i){let n=this.images[i][t];delete this.images[i][t],delete this.patterns[i][t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,i,n){let a=!0,l=!!this.loaded[i];if(!l)for(let o of t)this.images[i][o]||(a=!1);l||a?this._notify(t,i,n):this.requestors.push({ids:t,scope:i,callback:n})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,i,n){let a={};for(let l of t){this.images[i][l]||this.fire(new Wt("styleimagemissing",{id:l}));let o=this.images[i][l];o?a[l]={data:o.data.clone(),pixelRatio:o.pixelRatio,sdf:o.sdf,version:o.version,stretchX:o.stretchX,stretchY:o.stretchY,content:o.content,hasRenderCallback:!!(o.userImage&&o.userImage.render)}:A('Image "'.concat(l,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}n(null,a)}getPixelSize(t){let{width:i,height:n}=this.atlasImage[t];return{width:i,height:n}}getPattern(t,i){let n=this.patterns[i][t],a=this.getImage(t,i);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{let l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},o=new Ph(l,a);this.patterns[i][t]={bin:l,position:o}}return this._updatePatternAtlas(i),this.patterns[i][t].position}bind(t,i){let n=t.gl,a=this.atlasTexture[i];a?this.dirty&&(a.update(this.atlasImage[i]),this.dirty=!1):(a=new bi(t,this.atlasImage[i],n.RGBA),this.atlasTexture[i]=a),a.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(t){let i=[];for(let o in this.patterns[t])i.push(this.patterns[t][o].bin);let{w:n,h:a}=Kh(i),l=this.atlasImage[t];l.resize({width:n||1,height:a||1});for(let o in this.patterns[t]){let{bin:d}=this.patterns[t][o],s=d.x+1,r=d.y+1,c=this.images[t][o].data,b=c.width,m=c.height;Yi.copy(c,l,{x:0,y:0},{x:s,y:r},{width:b,height:m}),Yi.copy(c,l,{x:0,y:m-1},{x:s,y:r-1},{width:b,height:1}),Yi.copy(c,l,{x:0,y:0},{x:s,y:r+m},{width:b,height:1}),Yi.copy(c,l,{x:b-1,y:0},{x:s-1,y:r},{width:1,height:m}),Yi.copy(c,l,{x:0,y:0},{x:s+b,y:r},{width:1,height:m})}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,i){for(let n of t){if(this.callbackDispatchedThisFrame[i][n])continue;this.callbackDispatchedThisFrame[i][n]=!0;let a=this.images[i][n];HJ(a)&&this.updateImage(n,i,a)}}}let DJ=new Zi({anchor:new mt(_.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return xt(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Pt(e.x,t.x,i),y:Pt(e.y,t.y,i),z:Pt(e.z,t.z,i),azimuthal:Pt(e.azimuthal,t.azimuthal,i),polar:Pt(e.polar,t.polar,i)}}}(_.light.position),color:new mt(_.light.color),intensity:new mt(_.light.intensity)});class _R extends Xi{constructor(t,i="flat"){super(),this._transitionable=new Us(DJ),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i,n={}){this._validate(Vx,t,n)||(this._transitionable.setTransitionOrValue(t),this.id=i)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,n){return(!n||n.validate!==!1)&&lc(this,t.call(rd,Xt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:_})))}}let _J=new Zi({source:new mt(_.terrain.source),exaggeration:new mt(_.terrain.exaggeration)}),KJ=class extends Xi{constructor(e,t,i,n){super(),this.scope=i,this._transitionable=new Us(_J,n),this._transitionable.setTransitionOrValue(e,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new si(e)).get("exaggeration")}isZoomDependent(){let e=this._transitionable._values.exaggeration;return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ul}},KR=45,PR=65,Yo=.05;function ub(e,t,i,n){let a=pn(KR,PR,i),[l,o]=qR(e,n),d=1-Math.min(1,Math.exp((t-l)/(o-l)*-6));return d*=d*d,d=Math.min(1,1.00747*d),d*a*e.alpha}function qR(e,t){let i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function $R(e,t,i,n,a){let l=S.transformMat4([],[t,i,n],a.mercatorFogMatrix);return ub(e,S.length(l),a.pitch,a._fov)}function tG(e,t,i,n,a,l,o){let d=[[i,n,0],[a,n,0],[a,l,0],[i,l,0]],s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let c of d){let b=S.transformMat4([],c,t),m=S.length(b);s=Math.min(s,m),r=Math.max(r,m)}return[ub(e,s,o.pitch,o._fov),ub(e,r,o.pitch,o._fov)]}let PJ=new Zi({range:new mt(_.fog.range),color:new mt(_.fog.color),"high-color":new mt(_.fog["high-color"]),"space-color":new mt(_.fog["space-color"]),"horizon-blend":new mt(_.fog["horizon-blend"]),"star-intensity":new mt(_.fog["star-intensity"]),"vertical-range":new mt(_.fog["vertical-range"])});class qJ extends Xi{constructor(t,i){super(),this._transitionable=new Us(PJ),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){let t=this._transform,i=t.projection.name==="globe",n=Di(t.zoom),a=this.properties.get("range"),l=[.5,3];return{range:i?[Pt(l[0],a[0],n),Pt(l[1],a[1],n)]:a,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(this._validate(Rx,t,i))return;let n=Xt({},t);for(let a of Object.keys(_.fog))n[a]===void 0&&(n[a]=_.fog[a].default);this._transitionable.setTransitionOrValue(n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let i=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:pn(KR,PR,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(n,a,l){let o=Re.fromLngLat(a),d=l.elevation?l.elevation.getAtPointOrZero(o):0;return $R(n,o.x,o.y,d,l)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return tG(this.state,i,0,0,tt,tt,this._transform)}getOpacityForBounds(t,i,n,a,l){return this._transform.projection.supportsFog?tG(this.state,t,i,n,a,l,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?qR(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let i=[4,5,6,7];for(let n of i){let a=t.points[n],l;if(a[2]>=0)l=a;else{let o=t.points[n-4];l=X1(o,a,o[2]/(o[2]-a[2]))}if($R(this.state,l[0],l[1],0,this._transform)>=Yo)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,n){return(!n||n.validate!==!1)&&lc(this,t.call(rd,Xt({value:i,style:{glyphs:!0,sprite:!0},styleSpec:_})))}}class $J{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class t2{constructor(){this.tasks={},this.taskQueue=[],Ni(["process"],this),this.invoker=new $J(this.process),this.nextId=0}add(t,i){let n=this.nextId++,a=function({type:l,isSymbolTile:o,zoom:d}){return d=d||0,l==="message"?0:l!=="maybePrepare"||o?l!=="parseTile"||o?l==="parseTile"&&o?300-d:l==="maybePrepare"&&o?400-d:500:200-d:100-d}(i);if(a===0){rt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:t,metadata:i,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){rt();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){let l=this.tasks[this.taskQueue[a]];l.priority<i&&(i=l.priority,t=a)}if(t===null)return null;let n=this.taskQueue[t];return this.taskQueue.splice(t,1),n}remove(){this.invoker.remove()}}class eG{constructor(t,i,n){this.target=t,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Ni(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new t2}send(t,i,n,a,l=!1,o){let d=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[d]=n);let s=new Set;return this.target.postMessage({id:d,type:t,hasCallback:!!n,targetMapId:a,mustQueue:l,sourceMapId:this.mapId,data:bd(i,s)},s),{cancel:()=>{n&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(t){let i=t.data,n=i.id;if(n&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(i.mustQueue||rt()){let a=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,i),a&&a.metadata||{type:"message"})}else this.processTask(n,i)}processTask(t,i){if(i.type==="<response>"){let n=this.callbacks[t];delete this.callbacks[t],n&&(i.error?n(md(i.error)):n(null,md(i.data)))}else{let n=new Set,a=i.hasCallback?(o,d)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:o?bd(o):null,data:bd(d,n)},n)}:o=>{},l=md(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,a);else if(this.parent.getWorkerSource){let o=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,o[0],l.source,l.scope)[o[1]](l,a)}else a(new Error("Could not find function ".concat(i.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Xo{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Wa();let n=this.workerPool.acquire(this.id);for(let a=0;a<n.length;a++){let l=new Xo.Actor(n[a],i,this.id);l.name="Worker ".concat(a),this.actors.push(l)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,i,n){Ln(this.actors,(a,l)=>{a.send(t,i,l)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}Xo.Actor=eG;class iG extends Xi{constructor(t,i,n,a){super(),this.scope=n,this._options=t,this.properties=new xs(i),this._transitionable=new Us(i,new Map(a)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,i){this._options=t,this._transitionable.setTransitionOrValue(t.properties,i)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let e2=new Zi({color:new mt(_.properties_light_ambient.color),intensity:new mt(_.properties_light_ambient.intensity)}),i2=new Zi({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([i,n]){let a=xt([1,i,n]);return{x:a.x,y:a.y,z:a.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Pt(e.x,t.x,i),y:Pt(e.y,t.y,i),z:Pt(e.z,t.z,i)}}}(_.properties_light_directional.direction),color:new mt(_.properties_light_directional.color),intensity:new mt(_.properties_light_directional.intensity),"cast-shadows":new mt(_.properties_light_directional["cast-shadows"]),"shadow-intensity":new mt(_.properties_light_directional["shadow-intensity"])});class gW{constructor(t,i,n,a){this.screenBounds=t,this.cameraPoint=i,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,a)}static createFromScreenPoints(t,i){let n,a;if(t instanceof H||typeof t[0]=="number"){let l=H.convert(t);n=[l],a=i.isPointAboveHorizon(l)}else{let l=H.convert(t[0]),o=H.convert(t[1]);n=[l,o],a=Ai(l,o).every(d=>i.isPointAboveHorizon(d))}return new gW(n,i.getCameraPoint(),a,i)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return Ai(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let i=this.screenBounds[0],n=this.screenBounds.length===1?this.screenBounds[0].add(new H(1,1)):this.screenBounds[1],a=Ai(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?a.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?a[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(a[3]=this.cameraPoint)),function(l,o){let d=[];for(let s=0;s<l.length;s++){let r=Nn(s-1,-1,l.length-1),c=Nn(s+1,-1,l.length-1),b=l[s],m=l[c],h=l[r].sub(b).unit(),W=m.sub(b).unit(),p=W.angleWithSep(h.x,h.y),Z=h.add(W).unit().mult(-1*o/Math.sin(p/2));d.push(b.add(Z))}return d}(a,t)}bufferedCameraGeometryGlobe(t){let i=this.screenBounds[0],n=this.screenBounds.length===1?this.screenBounds[0].add(new H(1,1)):this.screenBounds[1],a=Ai(i,n,t),l=this.cameraPoint.clone();switch(3*((l.y>i.y)+(l.y>n.y))+((l.x>i.x)+(l.x>n.x))){case 0:a[0]=l,a[4]=l.clone();break;case 1:a.splice(1,0,l);break;case 2:a[1]=l;break;case 3:a.splice(4,0,l);break;case 5:a.splice(2,0,l);break;case 6:a[3]=l;break;case 7:a.splice(3,0,l);break;case 8:a[2]=l}return a}containsTile(t,i,n,a=0){let l=t.queryPadding/i._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(l,i):this._bufferedScreenMercator(l,i),d=t.tileID.wrap+(o.unwrapped?a:0),s=o.polygon.map(Z=>Su(t.tileTransform,Z,d));if(!Tg(s,0,0,tt,tt))return;d=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?a:0);let r=this.screenGeometryMercator.polygon.map(Z=>Qu(t.tileTransform,Z,d)),c=r.map(Z=>new H(Z[0],Z[1])),b=i.getFreeCameraOptions().position||new Re(0,0,0),m=Qu(t.tileTransform,b,d),h=r.map(Z=>{let g=S.sub(Z,Z,m);return S.normalize(g,g),new Fc(m,g)}),W=Uo(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:h,bufferedTilespaceGeometry:s,bufferedTilespaceBounds:(p=ha(s),p.min.x=Mt(p.min.x,0,tt),p.min.y=Mt(p.min.y,0,tt),p.max.x=Mt(p.max.x,0,tt),p.max.y=Mt(p.max.y,0,tt),p),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:W};var p}_bufferedScreenMercator(t,i){let n=nG(t);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{let a;return a=i.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),i):{polygon:this.bufferedScreenGeometry(t).map(l=>i.pointCoordinate3D(l)),unwrapped:!0},this._screenRaycastCache[n]=a,a}}_bufferedCameraMercator(t,i){let n=nG(t);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{let a;return a=i.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),i):{polygon:this.bufferedCameraGeometry(t).map(l=>i.pointCoordinate3D(l)),unwrapped:!0},this._cameraRaycastCache[n]=a,a}}_projectAndResample(t,i){let n=function(l,o){let d=D.multiply([],o.pixelMatrix,o.globeMatrix),s=[0,-Wn,0,1],r=[0,Wn,0,1],c=[0,0,0,1];Le.transformMat4(s,s,d),Le.transformMat4(r,r,d),Le.transformMat4(c,c,d);let b=new H(s[0]/s[3],s[1]/s[3]),m=new H(r[0]/r[3],r[1]/r[3]),h=vl(l,b)&&s[3]<c[3],W=vl(l,m)&&r[3]<c[3];if(!h&&!W)return null;let p=function(N,Y,X){for(let J=1;J<N.length;J++){let B=lr(Y.pointCoordinate3D(N[J-1]).x),C=lr(Y.pointCoordinate3D(N[J]).x);if(X<0){if(B<C)return{idx:J,t:-B/(C-1-B)}}else if(C<B)return{idx:J,t:(1-B)/(C+1-B)}}return null}(l,o,h?-1:1);if(!p)return null;let{idx:Z,t:g}=p,u=Z>1?uW(l.slice(0,Z),o):[],G=Z<l.length?uW(l.slice(Z),o):[];u=u.map(N=>new H(lr(N.x),N.y)),G=G.map(N=>new H(lr(N.x),N.y));let F=[...u];F.length===0&&F.push(G[G.length-1]);let R=Pt(F[F.length-1].y,(G.length===0?u[0]:G[0]).y,g),I;return I=h?[new H(0,R),new H(0,0),new H(1,0),new H(1,R)]:[new H(1,R),new H(1,1),new H(0,1),new H(0,R)],F.push(...I),G.length===0?F.push(u[0]):F.push(...G),{polygon:F.map(N=>new Re(N.x,N.y)),unwrapped:!1}}(t,i);if(n)return n;let a=function(l,o){let d=!1,s=-1/0,r=0;for(let b=0;b<l.length-1;b++)l[b].x>s&&(s=l[b].x,r=b);for(let b=0;b<l.length-1;b++){let m=(r+b)%(l.length-1),h=l[m],W=l[m+1];Math.abs(h.x-W.x)>.5&&(h.x<W.x?(h.x+=1,m===0&&(l[l.length-1].x+=1)):(W.x+=1,m+1===l.length-1&&(l[0].x+=1)),d=!0)}let c=Qi(o.center.lng);return d&&c<Math.abs(c-1)&&l.forEach(b=>{b.x-=1}),{polygon:l,unwrapped:d}}(uW(t,i).map(l=>new H(lr(l.x),l.y)),i);return{polygon:a.polygon.map(l=>new Re(l.x,l.y)),unwrapped:a.unwrapped}}}function uW(e,t){return Xg(e,i=>{let n=t.pointCoordinate3D(i);i.x=n.x,i.y=n.y},1/256)}function lr(e){return e<0?1+e%1:e%1}function nG(e){return 100*e|0}function RW(e,t,i,n,a){let l=function(o,d){if(o)return a(o);if(d){e.url&&d.tiles&&e.tiles&&delete e.tiles;let s=Ci(Xt(d,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);d.vector_layers&&(s.vectorLayers=d.vector_layers,s.vectorLayerIds=s.vectorLayers.map(r=>r.id)),s.tiles=t.canonicalizeTileset(s,e.url),a(null,s)}};return e.url?gt(t.transformRequest(t.normalizeSourceURL(e.url,null,i,n),nt.Source),l):ee.frame(()=>l(null,e))}class Rb{constructor(t,i,n){this.bounds=Tn.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let i=Math.pow(2,t.z),n=Math.floor(Qi(this.bounds.getWest())*i),a=Math.floor(Li(this.bounds.getNorth())*i),l=Math.ceil(Qi(this.bounds.getEast())*i),o=Math.ceil(Li(this.bounds.getSouth())*i);return t.x>=n&&t.x<l&&t.y>=a&&t.y<o}}class aG{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new dl({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){let n=this.getKey(t,i);return this.positions[n]}trim(){let t=this.width,i=this.height=gl(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,n){let a=[],l=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,d=!0;a.push({left:l,right:o,isDash:d,zeroLength:t[0]===0});let s=t[0];for(let r=1;r<t.length;r++){d=!d;let c=t[r];l=s*n,s+=c,o=s*n,a.push({left:l,right:o,isDash:d,zeroLength:c===0})}return a}addRoundDash(t,i,n){let a=i/2;for(let l=-n;l<=n;l++){let o=this.width*(this.nextRow+n+l),d=0,s=t[d];for(let r=0;r<this.width;r++){r/s.right>1&&(s=t[++d]);let c=Math.abs(r-s.left),b=Math.abs(r-s.right),m=Math.min(c,b),h,W=l/n*(a+1);if(s.isDash){let p=a-Math.abs(W);h=Math.sqrt(m*m+p*p)}else h=a-Math.sqrt(m*m+W*W);this.image.data[o+r]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,i){for(let s=t.length-1;s>=0;--s){let r=t[s],c=t[s+1];r.zeroLength?t.splice(s,1):c&&c.isDash===r.isDash&&(c.left=r.left,t.splice(s,1))}let n=t[0],a=t[t.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);let l=this.width*this.nextRow,o=0,d=t[o];for(let s=0;s<this.width;s++){s/d.right>1&&(d=t[++o]);let r=Math.abs(s-d.left),c=Math.abs(s-d.right),b=Math.min(r,c);this.image.data[l+s]=Math.max(0,Math.min(255,(d.isDash?b:-b)+i+128))}}addDash(t,i){let n=this.getKey(t,i);if(this.positions[n])return this.positions[n];let a=i==="round",l=a?7:0,o=2*l+1;if(this.nextRow+o>this.height)return A("LineAtlas out of space"),null;t.length===0&&t.push(1);let d=0;for(let c=0;c<t.length;c++)t[c]<0&&(A("Negative value is found in line dasharray, replacing values with 0"),t[c]=0),d+=t[c];if(d!==0){let c=this.width/d,b=this.getDashRanges(t,this.width,c);a?this.addRoundDash(b,c,l):this.addRegularDash(b,i==="square"?.5*c:0)}let s=this.nextRow+l;this.nextRow+=o;let r={tl:[s,l],br:[d,0]};return this.positions[n]=r,r}}kt(aG,"LineAtlas");let lG=1*Ga;class oG{constructor(t){let i={},n=[];for(let d in t){let s=t[d],r=i[d]={};for(let c in s.glyphs){let b=s.glyphs[+c];if(!b||b.bitmap.width===0||b.bitmap.height===0)continue;let m=b.metrics.localGlyph?lG:1,h={x:0,y:0,w:b.bitmap.width+2*m,h:b.bitmap.height+2*m};n.push(h),r[c]=h}}let{w:a,h:l}=Kh(n),o=new dl({width:a||1,height:l||1});for(let d in t){let s=t[d];for(let r in s.glyphs){let c=s.glyphs[+r];if(!c||c.bitmap.width===0||c.bitmap.height===0)continue;let b=i[d][r],m=c.metrics.localGlyph?lG:1;dl.copy(c.bitmap,o,{x:0,y:0},{x:b.x+m,y:b.y+m},c.bitmap)}}this.image=o,this.positions=i}}kt(oG,"GlyphAtlas");class n2{constructor(t){this.tileID=new Xe(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Io(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,i,n,a,l){this.status="parsing",this.data=t,this.collisionBoxArray=new q0;let o=new Pg(Object.keys(t.layers).sort()),d=new Hh(this.tileID,this.promoteId);d.bucketLayerIDs=[];let s={},r=new aG(256,256),c={featureIndex:d,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:r,availableImages:n,brightness:this.brightness},b=i.familiesBySource[this.source];for(let u in b){let G=t.layers[u];if(!G)continue;let F=!1,R=!1,I=!1;for(let X of b[u])X[0].type==="symbol"?F=!0:R=!0,X[0].is3D()&&X[0].type!=="model"&&(I=!0);if(this.extraShadowCaster&&!I||this.isSymbolTile===!0&&!F||this.isSymbolTile===!1&&!R)continue;G.version===1&&A('Vector tile source "'.concat(this.source,'" layer "').concat(u,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));let N=o.encode(u),Y=[];for(let X=0;X<G.length;X++){let J=G.feature(X),B=d.getId(J,u);Y.push({feature:J,id:B,index:X,sourceLayerIndex:N})}for(let X of b[u]){let J=X[0];(!this.extraShadowCaster||J.is3D()&&J.type!=="model")&&(this.isSymbolTile!==void 0&&J.type==="symbol"!==this.isSymbolTile||J.minzoom&&this.zoom<Math.floor(J.minzoom)||J.maxzoom&&this.zoom>=J.maxzoom||J.visibility!=="none"&&(GW(X,this.zoom,c.brightness,n),(s[J.id]=J.createBucket({index:d.bucketLayerIDs.length,layers:X,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:N,sourceID:this.source,projection:this.projection.spec})).populate(Y,c,this.tileID.canonical,this.tileTransform),d.bucketLayerIDs.push(X.map(B=>B.id))))}}let m,h,W,p;r.trim();let Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=()=>{if(m)return this.status="done",l(m);if(this.extraShadowCaster)this.status="done",l(null,{buckets:Dn(s).filter(u=>!u.isEmpty()),featureIndex:d,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:c.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(h&&W&&p){let u=new oG(h),G=new Yu(W,p);for(let F in s){let R=s[F];R instanceof _s?(GW(R.layers,this.zoom,c.brightness,n),$Y(R,h,u.positions,W,G.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):R.hasPattern&&(R instanceof ob||R instanceof Qc||R instanceof nr)&&(GW(R.layers,this.zoom,c.brightness,n),R.addFeatures(c,this.tileID.canonical,G.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",l(null,{buckets:Dn(s).filter(F=>!F.isEmpty()),featureIndex:d,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:u.image,lineAtlas:r,imageAtlas:G,brightness:c.brightness})}};if(!this.extraShadowCaster){let u=ja(c.glyphDependencies,R=>Object.keys(R).map(Number));Object.keys(u).length?a.send("getGlyphs",{uid:this.uid,stacks:u,scope:this.scope},(R,I)=>{m||(m=R,h=I,g())},void 0,!1,Z):h={};let G=Object.keys(c.iconDependencies);G.length?a.send("getImages",{icons:G,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(R,I)=>{m||(m=R,W=I,g())},void 0,!1,Z):W={};let F=Object.keys(c.patternDependencies);F.length?a.send("getImages",{icons:F,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(R,I)=>{m||(m=R,p=I,g())},void 0,!1,Z):p={}}g()}}function GW(e,t,i,n){let a=new si(t,{brightness:i});for(let l of e)l.recalculate(a,n)}class dG{constructor(t){this.entries={},this.scheduler=t}request(t,i,n,a){let l=this.entries[t]=this.entries[t]||{callbacks:[]};if(l.result){let[o,d]=l.result;return this.scheduler?this.scheduler.add(()=>{a(o,d)},i):a(o,d),()=>{}}return l.callbacks.push(a),l.cancel||(l.cancel=n((o,d)=>{l.result=[o,d];for(let s of l.callbacks)this.scheduler?this.scheduler.add(()=>{s(o,d)},i):s(o,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(o=>o!==a),l.callbacks.length||(l.cancel(),delete this.entries[t]))}}}function sG(e,t,i){let n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},a=>{let l=Ft(e.request,(o,d,s,r)=>{o?a(o):d&&a(null,{vectorTile:i?void 0:new wh(new Ac(d)),rawData:d,cacheControl:s,expires:r})});return()=>{l.cancel(),a()}},t)}class rG extends Xi{constructor(t,i,n,a){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Xt(this,Ci(i,["url","scheme","tileSize","promoteId"])),this._options=Xt({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a),this._tileWorkers={},this._deduped=new dG}load(t){this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"}));let i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=RW(this._options,this.map._requestManager,i,n,(a,l)=>{this._tileJSONRequest=null,this._loaded=!0,a?(i&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(i)),n&&n.length!==2&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new $t(a))):l&&(Xt(this,l),l.bounds&&(this.tileBounds=new Rb(l.bounds,this.minzoom,this.maxzoom)),Gm(l.tiles,this.map._requestManager._customAccessToken),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=mn(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Xt({},this._options)}loadTile(t,i){let n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(n,nt.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ee.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(a.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=i:t.request=t.actor.send("reloadTile",a,l.bind(this));else if(t.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",a,l.bind(this),void 0,!0);else{let o=sG.call({deduped:this._deduped},a,(d,s)=>{d||!s?l.call(this,d):(a.data={cacheControl:s.cacheControl,expires:s.expires,rawData:s.rawData.slice(0)},t.actor&&t.actor.send("loadTile",a,l.bind(this),void 0,!0))},!0);t.request={cancel:o}}function l(o,d){return delete t.request,t.aborted?i(null):o&&o.status!==404?i(o):(d&&d.resourceTiming&&(t.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&t.setExpiryData(d),t.loadVectorData(d,this.map.painter),_o(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class FW extends Xi{constructor(t,i,n,a){super(),this.id=t,this.dispatcher=n,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Xt({type:"raster"},i),Xt(this,Ci(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"})),this._tileJSONRequest=RW(this._options,this.map._requestManager,null,null,(i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new $t(i)):n&&(Xt(this,n),n.bounds&&(this.tileBounds=new Rb(n.bounds,this.minzoom,this.maxzoom)),Gm(n.tiles),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=mn(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return Xt({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,i){let n=ee.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=de(this.map._requestManager.transformRequest(a,nt.Tile),(l,o,d,s)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):l?(t.state="errored",i(l)):o?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:d,expires:s}),t.setTexture(o,this.map.painter),t.state="loaded",_o(this.dispatcher),void i(null)):i(null)))}abortTile(t,i){t.request&&(t.request.cancel(),delete t.request),i()}unloadTile(t,i){t.texture&&t.texture instanceof bi?(t.destroy(!0),t.texture&&t.texture instanceof bi&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function a2(){return Ab.workerClass!=null?new Ab.workerClass:new T.Worker(Ab.workerUrl)}let IW="mapboxgl_preloaded_worker_pool";class Sd{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Sd.workerCount;)this.workers.push(new a2);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[IW]}numActive(){return Object.keys(this.active).length}}let or;function dr(){return or||(or=new Sd),or}Sd.workerCount=2;let Gb,UW,Ua,xW=null;function cG(){return rt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:UW||Zt.DRACO_URL}let NW=5123,YW=5126,XW={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[NW]:Uint16Array,5125:Uint32Array,[YW]:Float32Array},l2={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[NW]:"DT_UINT16",5125:"DT_UINT32",[YW]:"DT_FLOAT32"},JW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function bG(e,t,i){let n=i.json.bufferViews.length,a=i.buffers.length;t.bufferView=n,i.json.bufferViews[n]={buffer:a,byteLength:e.byteLength},i.buffers[a]=e}let yW="KHR_draco_mesh_compression";function o2(e,t){let i=e.extensions&&e.extensions[yW];if(!i)return;let n=new Ua.Decoder,a=pG(t,i.bufferView),l=new Ua.Mesh;if(!n.DecodeArrayToMesh(a,a.byteLength,l))throw new Error("Failed to decode Draco mesh");let o=t.json.accessors[e.indices],d=XW[o.componentType],s=o.count*d.BYTES_PER_ELEMENT,r=Ua._malloc(s);d===Uint16Array?n.GetTrianglesUInt16Array(l,s,r):n.GetTrianglesUInt32Array(l,s,r),bG(Ua.memory.buffer.slice(r,r+s),o,t),Ua._free(r);for(let c of Object.keys(i.attributes)){let b=n.GetAttributeByUniqueId(l,i.attributes[c]),m=t.json.accessors[e.attributes[c]],h=l2[m.componentType],W=m.count*JW[m.type]*XW[m.componentType].BYTES_PER_ELEMENT,p=Ua._malloc(W);n.GetAttributeDataArrayForAllPoints(l,b,Ua[h],W,p),bG(Ua.memory.buffer.slice(p,p+W),m,t),Ua._free(p)}n.destroy(),l.destroy(),delete e.extensions[yW]}let mG=1179937895,hG=new TextDecoder("utf8");function WG(e,t){return new URL(e,t).href}function d2(e,t,i,n){return fetch(WG(e.uri,n)).then(a=>a.arrayBuffer()).then(a=>{t.buffers[i]=a})}function pG(e,t){let i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function s2(e,t,i,n){if(e.uri){let a=WG(e.uri,n);return fetch(a).then(l=>l.blob()).then(l=>T.createImageBitmap(l)).then(l=>{t.images[i]=l})}if(e.bufferView!==void 0){let a=pG(t,e.bufferView),l=new T.Blob([a],{type:e.mimeType});return T.createImageBitmap(l).then(o=>{t.images[i]=o})}}function ZG(e,t=0,i){let n={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===mG){let r=new Uint32Array(e,t),c=2,b=(r[c++]>>2)-3,m=r[c++]>>2;if(c++,n.json=JSON.parse(hG.decode(r.subarray(c,c+m))),c+=m,c<b){let h=r[c++];c++;let W=t+(c<<2);n.buffers[0]=e.slice(W,W+h)}}else n.json=JSON.parse(hG.decode(new Uint8Array(e,t)));let{buffers:a,images:l,meshes:o,extensionsUsed:d}=n.json,s=Promise.resolve();if(a){let r=[];for(let c=0;c<a.length;c++){let b=a[c];b.uri?r.push(d2(b,n,c,i)):n.buffers[c]||(n.buffers[c]=null)}s=Promise.all(r)}return s.then(()=>{let r=[],c=d&&d.includes(yW);if(c&&r.push(function(){if(!Ua)return Gb||(Gb=function(b){let m,h=null;function W(){m=new Uint8Array(h.buffer)}function p(){throw new Error("Unexpected Draco error.")}let Z={a:{a:p,d:function(g,u,G){return m.copyWithin(g,u,u+G)},c:function(g){let u=m.length,G=Math.max(g>>>0,Math.ceil(1.2*u)),F=Math.ceil((G-u)/65536);try{return h.grow(F),W(),!0}catch{return!1}},b:p}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(b,Z):b.then(g=>g.arrayBuffer()).then(g=>WebAssembly.instantiate(g,Z))).then(g=>{let{Rb:u,Qb:G,P:F,T:R,X:I,Ja:N,La:Y,Qa:X,Va:J,Wa:B,eb:C,jb:Q,f:y,e:z,yb:E,zb:O,Ab:f,Bb:L,Db:K,Gb:q}=g.instance.exports;h=z;let P=(()=>{let et=0,it=0,at=0,$=0;return ot=>{at&&(u($),u(et),it+=at,at=et=0),et||(it+=128,et=G(it));let Rt=ot.length+7&-8,Gt=et;Rt>=it&&(at=Rt,Gt=$=G(Rt));for(let Yt=0;Yt<ot.length;Yt++)m[Gt+Yt]=ot[Yt];return Gt}})();return W(),y(),{memory:z,_free:u,_malloc:G,Mesh:class{constructor(){this.ptr=F()}destroy(){R(this.ptr)}},Decoder:class{constructor(){this.ptr=N()}destroy(){Q(this.ptr)}DecodeArrayToMesh(et,it,at){let $=P(et),ot=Y(this.ptr,$,it,at.ptr);return!!I(ot)}GetAttributeByUniqueId(et,it){return{ptr:X(this.ptr,et.ptr,it)}}GetTrianglesUInt16Array(et,it,at){J(this.ptr,et.ptr,it,at)}GetTrianglesUInt32Array(et,it,at){B(this.ptr,et.ptr,it,at)}GetAttributeDataArrayForAllPoints(et,it,at,$,ot){C(this.ptr,et.ptr,it.ptr,at,$,ot)}},DT_INT8:E(),DT_UINT8:O(),DT_INT16:f(),DT_UINT16:L(),DT_UINT32:K(),DT_FLOAT32:q()}})}(fetch(cG())),Gb.then(b=>{Ua=b,Gb=void 0}))}()),l)for(let b=0;b<l.length;b++)r.push(s2(l[b],n,b,i));return(r.length?Promise.all(r):Promise.resolve()).then(()=>{if(c&&o)for(let{primitives:b}of o)for(let m of b)o2(m,n);return n})})}function VG(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>ZG(t,0,e))}class gG{constructor(t,i,n){if(this.triangleCount=i.length/3,this.min=new H(0,0),this.max=new H(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||n===0)return;let a=t.map(c=>c.x),l=t.map(c=>c.y);this.min=new H(Math.min(...a),Math.min(...l)),this.max=new H(Math.max(...a),Math.max(...l));let o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);let d=Math.max(o.x,o.y)/n;this.cellsX=Math.max(1,Math.ceil(o.x/d)),this.cellsY=Math.max(1,Math.ceil(o.y/d)),this.xScale=1/d,this.yScale=1/d;let s=[];for(let c=0;c<this.triangleCount;c++){let b=t[i[3*c+0]].sub(this.min),m=t[i[3*c+1]].sub(this.min),h=t[i[3*c+2]].sub(this.min),W=Ol(Math.floor(Math.min(b.x,m.x,h.x)),this.xScale,this.cellsX),p=Ol(Math.floor(Math.max(b.x,m.x,h.x)),this.xScale,this.cellsX),Z=Ol(Math.floor(Math.min(b.y,m.y,h.y)),this.yScale,this.cellsY),g=Ol(Math.floor(Math.max(b.y,m.y,h.y)),this.yScale,this.cellsY),u=new H(0,0),G=new H(0,0),F=new H(0,0),R=new H(0,0);for(let I=Z;I<=g;++I){u.y=G.y=I*d,F.y=R.y=(I+1)*d;for(let N=W;N<=p;++N)u.x=F.x=N*d,G.x=R.x=(N+1)*d,(kh(b,m,h,u,G,R)||kh(b,m,h,u,R,F))&&s.push({cellIdx:I*this.cellsX+N,triIdx:c})}}if(s.length===0)return;s.sort((c,b)=>c.cellIdx-b.cellIdx||c.triIdx-b.triIdx);let r=0;for(;r<s.length;){let c=s[r].cellIdx,b={start:this.payload.length,len:0};for(;r<s.length&&s[r].cellIdx===c;)++b.len,this.payload.push(s[r++].triIdx);this.cells[c]=b}}query(t,i,n){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let s=0;s<this.lookup.length;s++)this.lookup[s]=0;let a=Ol(t.x-this.min.x,this.xScale,this.cellsX),l=Ol(i.x-this.min.x,this.xScale,this.cellsX),o=Ol(t.y-this.min.y,this.yScale,this.cellsY),d=Ol(i.y-this.min.y,this.yScale,this.cellsY);for(let s=o;s<=d;s++)for(let r=a;r<=l;r++){let c=this.cells[s*this.cellsX+r];if(c)for(let b=0;b<c.len;b++){let m=this.payload[c.start+b],h=Math.floor(m/8),W=1<<m%8;if(!(this.lookup[h]&W)&&(this.lookup[h]|=W,n.push(m),n.length===this.triangleCount))return}}}}function Ol(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function Jo(e,t){let i=e.json.bufferViews[t.bufferView];return new XW[t.componentType](e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*JW[t.type])}function r2(e,t,i){let n=e.indices,a=e.attributes,l={};l.indexArray=new yi;let o=t.json.accessors[n],d=o.count/3;l.indexArray.reserve(d);let s=Jo(t,o);for(let m=0;m<d;m++)l.indexArray.emplaceBack(s[3*m],s[3*m+1],s[3*m+2]);l.indexArray._trim(),l.vertexArray=new go;let r=t.json.accessors[a.POSITION];l.vertexArray.reserve(r.count);let c=Jo(t,r);for(let m=0;m<r.count;m++)l.vertexArray.emplaceBack(c[3*m],c[3*m+1],c[3*m+2]);if(l.vertexArray._trim(),l.aabb=new $e(r.min,r.max),l.centroid=function(m,h){let W=[0,0,0],p=m.length;if(p>0){for(let Z=0;Z<p;Z++){let g=3*m[Z];W[0]+=h[g],W[1]+=h[g+1],W[2]+=h[g+2]}W[0]/=p,W[1]/=p,W[2]/=p}return W}(s,c),a.COLOR_0!==void 0){let m=t.json.accessors[a.COLOR_0],h=JW[m.type];if(m.componentType===YW){l.colorArray=h===3?new go:new qa,l.colorArray.reserve(m.count);let W=Jo(t,m);if(h===3)for(let p=0;p<m.count;p++)l.colorArray.emplaceBack(W[3*p],W[3*p+1],W[3*p+2]);else for(let p=0;p<m.count;p++)l.colorArray.emplaceBack(W[4*p],W[4*p+1],W[4*p+2],W[4*p+3]);l.colorArray._trim()}else if(m.componentType===NW&&h===4){l.colorArray=new qa,l.colorArray.resize(m.count);let W=Jo(t,m),p=1/65535,Z=l.colorArray.float32;for(let g=0;g<4*W.length;++g)Z[g]=W[g]*p}else A("glTF color buffer parsing for accessor ".concat(JSON.stringify(m)," is not supported"))}if(a.NORMAL!==void 0){l.normalArray=new go;let m=t.json.accessors[a.NORMAL];l.normalArray.reserve(m.count);let h=Jo(t,m);for(let W=0;W<m.count;W++)l.normalArray.emplaceBack(h[3*W],h[3*W+1],h[3*W+2]);l.normalArray._trim()}if(a.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new Js;let m=t.json.accessors[a.TEXCOORD_0];l.texcoordArray.reserve(m.count);let h=Jo(t,m);for(let W=0;W<m.count;W++)l.texcoordArray.emplaceBack(h[2*W],h[2*W+1]);l.texcoordArray._trim()}let b=e.material;return l.material=function(m,h){let{emissiveFactor:W=[0,0,0],alphaMode:p="OPAQUE",alphaCutoff:Z=.5,normalTexture:g,occlusionTexture:u,emissiveTexture:G,doubleSided:F}=m,{baseColorFactor:R=[1,1,1,1],metallicFactor:I=1,roughnessFactor:N=1,baseColorTexture:Y,metallicRoughnessTexture:X}=m.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new re(...R),metallicFactor:I,roughnessFactor:N,baseColorTexture:Y?h[Y.index]:void 0,metallicRoughnessTexture:X?h[X.index]:void 0},doubleSided:F,emissiveFactor:W,alphaMode:p,alphaCutoff:Z,normalTexture:g?h[g.index]:void 0,occlusionTexture:u?h[u.index]:void 0,emissionTexture:G?h[G.index]:void 0,defined:m.defined===void 0}}(b!==void 0?t.json.materials[b]:{defined:!1},i),a._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(Jo(t,t.json.accessors[a._FEATURE_RGBA4444]).buffer)),l}function uG(e,t,i){let{matrix:n,rotation:a,translation:l,scale:o,mesh:d,extras:s,children:r}=e,c={};if(c.matrix=n||D.fromRotationTranslationScale([],a||[0,0,0,1],l||[0,0,0],o||[1,1,1]),d!==void 0){c.meshes=i[d];let b=c.anchor=[0,0];for(let m of c.meshes){let{min:h,max:W}=m.aabb;b[0]+=h[0]+W[0],b[1]+=h[1]+W[1]}b[0]=Math.floor(b[0]/c.meshes.length/2),b[1]=Math.floor(b[1]/c.meshes.length/2)}if(s&&(s.id&&(c.id=s.id),s.lights&&(c.lights=function(b){if(!b.length)return[];let m=function(g){let u=atob(g),G=new Uint8Array(u.length);for(let F=0;F<u.length;F++)G[F]=u.codePointAt(F);return G}(b),h=[],W=m.length/24,p=new Uint16Array(m.buffer),Z=new Float32Array(m.buffer);for(let g=0;g<W;g++){let u=p[2*g*6]/30,G=p[2*g*6+1]/30,F=p[2*g*6+10]/100,R=Z[6*g+1],I=Z[6*g+2],N=Z[6*g+3],Y=Z[6*g+4],X=N-R,J=Y-I,B=Math.hypot(X,J);h.push({pos:[R+.5*X,I+.5*J,G],normal:[J/B,-X/B,0],width:B,height:u,depth:F,points:[R,I,N,Y]})}return h}(s.lights))),r){let b=[];for(let m of r)b.push(uG(t.json.nodes[m],t,i));c.children=b}return c}function c2(e){if(e.vertices.length===0||e.indices.length===0)return null;let[t,i]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let o=1;o<e.vertices.length;++o){let d=e.vertices[o];t.x=Math.min(t.x,d.x),t.y=Math.min(t.y,d.y),i.x=Math.max(i.x,d.x),i.y=Math.max(i.y,d.y)}let n=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),a=Math.max(8,n),l=new gG(e.vertices,e.indices,a);return{vertices:e.vertices,indices:e.indices,grid:l,min:t,max:i}}function b2(e){if(!e.extras||!e.extras.ground)return null;let t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;let i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;let n=[];for(let o of i){if(!Array.isArray(o)||o.length!==2)continue;let d=o[0],s=o[1];typeof d=="number"&&typeof s=="number"&&n.push(new H(d,s))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let a=0;for(let o=0;o<n.length;o++){let d=n[o],s=n[(o+1)%n.length],r=n[(o+2)%n.length];a+=(d.x-s.x)*(r.y-s.y)-(r.x-s.x)*(d.y-s.y)}a>0&&n.reverse();let l=Sc(n.flatMap(o=>[o.x,o.y]),[]);return l.length===0?null:{vertices:n,indices:l}}function m2(e){let t=[],i=[],n=0;for(let a of e){n=t.length;let l=a.vertexArray.float32,o=a.indexArray.uint16;for(let d=0;d<a.vertexArray.length;d++)t.push(new H(l[3*d+0],l[3*d+1]));for(let d=0;d<3*a.indexArray.length;d++)i.push(o[d]+n)}if(i.length%3!=0)return null;for(let a=0;a<i.length;a+=3){let l=t[i[a+0]],o=t[i[a+1]],d=t[i[a+2]];(l.x-o.x)*(d.y-o.y)-(d.x-o.x)*(l.y-o.y)>0&&([i[a+1],i[a+2]]=[i[a+2],i[a+1]])}return{vertices:t,indices:i}}function BW(e){let t=function(s,r){let c=[],b=T.WebGL2RenderingContext;if(s.json.textures)for(let m of s.json.textures){let h={magFilter:b.LINEAR,minFilter:b.NEAREST,wrapS:b.REPEAT,wrapT:b.REPEAT};m.sampler!==void 0&&Object.assign(h,s.json.samplers[m.sampler]),c.push({image:r[m.source],sampler:h,uploaded:!1})}return c}(e,e.images),i=function(s,r){let c=[];for(let b of s.json.meshes){let m=[];for(let h of b.primitives)m.push(r2(h,s,r));c.push(m)}return c}(e,t),{scenes:n,scene:a,nodes:l}=e.json,o=n?n[a||0].nodes:l,d=[];for(let s of o)d.push(uG(l[s],e,i));return function(s,r,c){let b={},m=new Set;for(let h=0;h<s.length;h++){let W=c[r[h]];if(!W.extras)continue;let p=W.extras["mapbox:footprint:version"],Z=W.extras["mapbox:footprint:id"];(p||Z)&&m.add(h),p==="1.0.0"&&Z&&(b[Z]=h)}for(let h=0;h<s.length;h++){if(m.has(h))continue;let W=s[h],p=c[r[h]];if(!p.extras)continue;let Z=null;W.id in b&&(Z=m2(s[b[W.id]].meshes)),Z||(Z=b2(p)),Z&&(W.footprint=c2(Z))}if(m.size>0){let h=Array.from(m.values()).sort((W,p)=>W-p);for(let W=h.length-1;W>=0;W--)s.splice(h[W],1)}}(d,o,e.json.nodes),d}function h2(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);let t=e.vertexArray.float32,i=e.aabb.min[0]-1,n=e.aabb.min[1]-1,a=xo/(e.aabb.max[0]-i+2),l=xo/(e.aabb.max[1]-n+2);for(let o=0;o<t.length;o+=3){let d=t[o+2],s=(t[o+0]-i)*a|0,r=(t[o+1]-n)*l|0;d>e.heightmap[r*xo+s]&&(e.heightmap[r*xo+s]=d)}}function W2(e,t){let i={};i.indexArray=new yi,i.indexArray.reserve(4*e.length),i.vertexArray=new go,i.vertexArray.reserve(10*e.length),i.colorArray=new qa,i.vertexArray.reserve(10*e.length);let n=0;for(let o of e){let d=Math.min(10,Math.max(4,1.3*o.height))*t,s=[-o.normal[1],o.normal[0],0],r=Math.min(.29,.1*o.width/o.depth),c=o.width-2*o.depth*t*(r+.01),b=S.scaleAndAdd([],o.pos,s,c/2),m=S.scaleAndAdd([],o.pos,s,-c/2),h=[b[0],b[1],b[2]+o.height],W=[m[0],m[1],m[2]+o.height],p=S.scaleAndAdd([],o.normal,s,r);S.scale(p,p,d);let Z=S.scaleAndAdd([],o.normal,s,-r);S.scale(Z,Z,d),S.add(p,b,p),S.add(Z,m,Z),b[2]+=.1,m[2]+=.1,i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(m[0],m[1],m[2]),i.vertexArray.emplaceBack(h[0],h[1],h[2]),i.vertexArray.emplaceBack(W[0],W[1],W[2]),i.vertexArray.emplaceBack(b[0],b[1],b[2]),i.vertexArray.emplaceBack(m[0],m[1],m[2]),i.vertexArray.emplaceBack(p[0],p[1],p[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]);let g=c/d/2;i.colorArray.emplaceBack(-g-r,-1,g,.8),i.colorArray.emplaceBack(g+r,-1,g,.8),i.colorArray.emplaceBack(-g,0,g,1.3),i.colorArray.emplaceBack(g,0,g,1.3),i.colorArray.emplaceBack(g+r,-.8,g,.7),i.colorArray.emplaceBack(g+r,-.8,g,.7),i.colorArray.emplaceBack(0,0,g,1.3),i.colorArray.emplaceBack(0,0,g,1.3),i.colorArray.emplaceBack(g+r,-1.2,g,.8),i.colorArray.emplaceBack(g+r,-1.2,g,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}let a={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=re.white,a.pbrMetallicRoughness=l,i.material=a,i.aabb=new $e([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}kt(gG,"TriangleGridIndex");let MW={vector:rG,raster:FW,"raster-dem":class extends FW{constructor(e,t,i,n){super(e,t,i,n),this.type="raster-dem",this.maxzoom=22,this._options=Xt({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(a,l){a&&(e.state="errored",t(a)),l&&(e.dem=l,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=de(this.map._requestManager.transformRequest(i,nt.Tile),(function(a,l,o,d){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(a)e.state="errored",t(a);else if(l){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:d});let r=T.ImageBitmap&&l instanceof T.ImageBitmap&&e1(),c=1-(l.width-((s=l.width)<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))))/2;c<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));let b=r?l:ee.getImageData(l,c),m={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:b,encoding:this.encoding,padding:c};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",m,n.bind(this),void 0,!0))}var s}).bind(this))}_getNeighboringTiles(e){let t=e.canonical,i=Math.pow(2,t.z),n=(t.x-1+i)%i,a=t.x===0?e.wrap-1:e.wrap,l=(t.x+1+i)%i,o=t.x+1===i?e.wrap+1:e.wrap,d={};return d[new Xe(e.overscaledZ,a,t.z,n,t.y).key]={backfilled:!1},d[new Xe(e.overscaledZ,o,t.z,l,t.y).key]={backfilled:!1},t.y>0&&(d[new Xe(e.overscaledZ,a,t.z,n,t.y-1).key]={backfilled:!1},d[new Xe(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},d[new Xe(e.overscaledZ,o,t.z,l,t.y-1).key]={backfilled:!1}),t.y+1<i&&(d[new Xe(e.overscaledZ,a,t.z,n,t.y+1).key]={backfilled:!1},d[new Xe(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},d[new Xe(e.overscaledZ,o,t.z,l,t.y+1).key]={backfilled:!1}),d}},geojson:class extends Xi{constructor(e,t,i,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(n),this._data=t.data,this._options=Xt({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let a=tt/this.tileSize;this.workerOptions=Xt({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*a,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*a,extent:tt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:tt,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*a,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Wt("dataloading",{dataType:"source"})),this._loaded=!1;let e=Xt({},this.workerOptions);e.scope=this.scope;let t=this._data;typeof t=="string"?(e.request=this.map._requestManager.transformRequest(ee.resolveURL(t),nt.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),e,(i,n)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new $t(i));else{let a={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(a.resourceTiming=n.resourceTiming[this.id]),this.fire(new Wt("data",a)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){let i=e.actor?"reloadTile":"loadTile";e.actor=this.actor;let n={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ee.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(i,n,(a,l)=>(delete e.request,e.destroy(),e.aborted?t(null):a?t(a):(e.loadVectorData(l,this.map.painter,i==="reloadTile"),t(null))),void 0,i==="loadTile")}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Xt({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends oa{constructor(e,t,i,n){super(e,t,i,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let e=this.options;this.urls=[];for(let t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,nt.Source).url);(function(t,i){let n=T.document.createElement("video");n.muted=!0,n.onloadstart=function(){i(null,n)};for(let a=0;a<t.length;a++){let l=T.document.createElement("source");Nt(t[a])||(n.crossOrigin="Anonymous"),l.src=t[a],n.appendChild(l)}})(this.urls,(t,i)=>{this._loaded=!0,t?this.fire(new $t(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new $t(new Tt("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(t.start(0)," and ").concat(t.end(0),"-second mark.")))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new bi(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:oa,model:class extends Xi{constructor(e,t,i,n){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let e=[];for(let t in this._options.models){let i=this._options.models[t],n=VG(this.map._requestManager.transformRequest(i.uri,nt.Model).url).then(a=>{if(!a)return;let l=BW(a),o=new hR(t,i.position,i.orientation,l);o.computeBoundsAndApplyParent(),this.models.push(o)}).catch(a=>{this.fire(new $t(new Error("Could not load model ".concat(t," from ").concat(i.uri,": ").concat(a.message))))});e.push(n)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new $t(new Error("Could not load models: ".concat(t.message))))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Xi{constructor(e,t,i,n){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=RW(this._options,this.map._requestManager,t,i,(n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?(t&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(t)),i&&i.length!==2&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(i)),this.fire(new $t(n))):a&&(Xt(this,a),a.bounds&&(this.tileBounds=new Rb(a.bounds,this.minzoom,this.maxzoom)),Gm(a.tiles,this.map._requestManager._customAccessToken),this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(i,nt.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&e.state!=="expired")if(e.state==="loading")e.reloadCallback=t;else{if(e.buckets){let l=Object.values(e.buckets);for(let o of l)o.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",n,a.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",n,a.bind(this),void 0,!0);function a(l,o){return e.aborted?t(null):l&&l.status!==404?t(l):(o&&(o.resourceTiming&&(e.resourceTiming=o.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(o),e.buckets={...e.buckets,...o.buckets}),e.state="loaded",void t(null))}}serialize(){return Xt({},this._options)}},canvas:class extends oa{constructor(e,t,i,n){super(e,t,i,n),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(a=>!Array.isArray(a)||a.length!==2||a.some(l=>typeof l!="number"))||this.fire(new $t(new Tt("sources.".concat(e),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new $t(new Tt("sources.".concat(e),null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new $t(new Tt("sources.".concat(e),null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof T.HTMLCanvasElement||this.fire(new $t(new Tt("sources.".concat(e),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new $t(new Tt("sources.".concat(e),null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof T.HTMLCanvasElement?this.options.canvas:T.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new $t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof db||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new bi(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Xi{constructor(e,t,i,n){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=i,this._implementation=t,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new $t(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new $t(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new Rb(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Xt(this,Ci(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Ci(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Wt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Wt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){let{x:t,y:i,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){let{x:i,y:n,z:a}=e.tileID.canonical,l=new T.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:n,z:a},{signal:l.signal})).then((function(o){return delete e.request,e.aborted?(e.state="unloaded",t(null)):o===void 0?(e.state="errored",t(null)):o===null?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(d){return d instanceof T.ImageData||d instanceof T.HTMLCanvasElement||d instanceof T.ImageBitmap||d instanceof T.HTMLImageElement}(o)?(this.loadTileData(e,o),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}).bind(this)).catch(o=>{o.code!==20&&(e.state="errored",t(o))}),e.request.cancel=()=>l.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof bi?(e.destroy(!0),e.texture&&e.texture instanceof bi&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){let{x:i,y:n,z:a}=e.tileID.canonical;this._implementation.unloadTile({x:i,y:n,z:a})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){let e=mn(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Wt("data",{dataType:"source",sourceDataType:"content"}))}}},CW=function(e,t,i,n){let a=new MW[t.type](e,t,i,n);if(a.id!==e)throw new Error("Expected Source id to be ".concat(e," instead of ").concat(a.id));return Ni(["load","abort","unload","serialize","prepare"],a),a};function p2(e,t){let i=D.identity([]);return D.scale(i,i,[.5*e.width,.5*-e.height,1]),D.translate(i,i,[1,-1,0]),D.multiply(i,i,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(i)}function Z2(e,t,i,n,a,l,o,d=!1){let s=e.tilesIn(n,o,d);s.sort(RG);let r=[];for(let b of s)r.push({wrappedTileID:b.tile.tileID.wrapped().key,queryResults:b.tile.queryRenderedFeatures(t,i,e._state,b,a,l,p2(e.transform,b.tile.tileID),d)});let c=function(b){let m={},h={};for(let W of b){let p=W.queryResults,Z=W.wrappedTileID,g=h[Z]=h[Z]||{};for(let u in p){let G=p[u],F=g[u]=g[u]||{},R=m[u]=m[u]||[];for(let I of G)F[I.featureIndex]||(F[I.featureIndex]=!0,R.push(I))}}return m}(r);for(let b in c)c[b].forEach(m=>{let h=m.feature,W=h.layer;W&&W.type!=="background"&&W.type!=="sky"&&W.type!=="slot"&&(h.source=W.source,W["source-layer"]&&(h.sourceLayer=W["source-layer"]),h.state=h.id!==void 0?e.getFeatureState(W["source-layer"],h.id):{})});return c}function V2(e,t){let i=e.getRenderableIds().map(l=>e.getTileByID(l)),n=[],a={};for(let l=0;l<i.length;l++){let o=i[l],d=o.tileID.canonical.key;a[d]||(a[d]=!0,o.querySourceFeatures(n,t))}return n}function RG(e,t){let i=e.tileID,n=t.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}class g2{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(let t in this.style._mergedLayers){let i=this.style._mergedLayers[t];if(i.type==="fill-extrusion")this.layers.push(i);else if(i.type==="model"){let n=this.style.getLayerSource(i);n&&n.type==="batched-model"&&this.layers.push(i)}}}updateZOffset(t,i){this.currentBuildingBuckets=[];for(let a=0;a<this.layers.length;++a){let l=this.layers[a],o=this.style.getLayerSourceCache(l),d=1;l.type==="fill-extrusion"&&(d=l.paint.get("fill-extrusion-opacity")>0?l.paint.get("fill-extrusion-vertical-scale"):0);let s=o?o.getTile(i):null;if(!s&&o&&i.canonical.z>o.getSource().minzoom){let r=i.scaledTo(Math.min(o.getSource().maxzoom,i.overscaledZ-1));for(;r.overscaledZ>=o.getSource().minzoom&&(s=o.getTile(r),!s&&r.overscaledZ!==0);)r=r.scaledTo(r.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:s?s.getBucket(l):null,tileID:s?s.tileID:i,verticalScale:d})}t.hasAnyZOffset=!1;let n=!1;for(let a=0;a<t.symbolInstances.length;a++){let l=t.symbolInstances.get(a),o=l.zOffset,d=this._getHeightAtTileOffset(i,l.tileAnchorX,l.tileAnchorY);l.zOffset=d!==-1?d:o,n||o===l.zOffset||(n=!0),t.hasAnyZOffset||l.zOffset===0||(t.hasAnyZOffset=!0)}n&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,n,a){let l=i,o=n;if(t.canonical.z!==a.canonical.z){let d=a.canonical,s=1/(1<<t.canonical.z-d.z);l=(i+t.canonical.x*tt)*s-d.x*tt|0,o=(n+t.canonical.y*tt)*s-d.y*tt|0}return{tileX:l,tileY:o}}_getHeightAtTileOffset(t,i,n){let a;for(let l=0;l<this.layers.length;++l){if(this.layers[l].type!=="fill-extrusion")continue;let{bucket:o,tileID:d,verticalScale:s}=this.currentBuildingBuckets[l];if(!o)continue;let{tileX:r,tileY:c}=this._mapCoordToOverlappingTile(t,i,n,d),b=o.getHeightAtTileCoord(r,c);if(b&&b.height!==void 0){if(!b.hidden)return b.height*s;a=b.height}}for(let l=0;l<this.layers.length;++l){if(this.layers[l].type!=="model")continue;let{bucket:o,tileID:d}=this.currentBuildingBuckets[l];if(!o)continue;let{tileX:s,tileY:r}=this._mapCoordToOverlappingTile(t,i,n,d),c=o.getHeightAtTileCoord(s,r);if(c&&!c.hidden)return c.height===void 0&&a!==void 0?Math.min(c.maxHeight,a)*c.verticalScale:(c.height||0)*c.verticalScale}return-1}}var GG=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function u2(e,t){let i={};for(let n in e)n!=="ref"&&(i[n]=e[n]);return GG.forEach(n=>{n in t&&(i[n]=t[n])}),i}function FG(e){e=e.slice();let t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=u2(e[i],t[e[i].ref]));return e}let Be={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function IG(e,t,i){i.push({command:Be.addSource,args:[e,t[e]]})}function UG(e,t,i){t.push({command:Be.removeSource,args:[e]}),i[e]=!0}function R2(e,t,i,n){UG(e,i,n),IG(e,t,i)}function G2(e,t,i){let n;for(n in e[i])if(e[i].hasOwnProperty(n)&&n!=="data"&&!te(e[i][n],t[i][n]))return!1;for(n in t[i])if(t[i].hasOwnProperty(n)&&n!=="data"&&!te(e[i][n],t[i][n]))return!1;return!0}function Fb(e,t,i,n,a,l){let o;for(o in t=t||{},e=e||{})e.hasOwnProperty(o)&&(te(e[o],t[o])||i.push({command:l,args:[n,o,t[o],a]}));for(o in t)t.hasOwnProperty(o)&&!e.hasOwnProperty(o)&&(te(e[o],t[o])||i.push({command:l,args:[n,o,t[o],a]}))}function Ib(e){return e.id}function Ub(e,t){return e[t.id]=t,e}class F2{constructor(t,i){this.reset(t,i)}reset(t,i){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=Mt(t,0,1);let i=1,n=this._distances[i],a=t*this.paddedLength+this.padding;for(;n<a&&i<this._distances.length;)n=this._distances[++i];let l=i-1,o=this._distances[l],d=n-o,s=d>0?(a-o)/d:0;return this.points[l].mult(1-s).add(this.points[i].mult(s))}}class xG{constructor(t,i,n){let a=this.boxCells=[],l=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(i/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)a.push([]),l.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=i,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,i,n,a,l){this._forEachCell(i,n,a,l,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l)}insertCircle(t,i,n,a){this._forEachCell(i-a,n-a,i+a,n+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(i),this.circles.push(n),this.circles.push(a)}_insertBoxCell(t,i,n,a,l,o){this.boxCells[l].push(o)}_insertCircleCell(t,i,n,a,l,o){this.circleCells[l].push(o)}_query(t,i,n,a,l,o){if(n<0||t>this.width||a<0||i>this.height)return!l&&[];let d=[];if(t<=0&&i<=0&&this.width<=n&&this.height<=a){if(l)return!0;for(let s=0;s<this.boxKeys.length;s++)d.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(let s=0;s<this.circleKeys.length;s++){let r=this.circles[3*s],c=this.circles[3*s+1],b=this.circles[3*s+2];d.push({key:this.circleKeys[s],x1:r-b,y1:c-b,x2:r+b,y2:c+b})}return o?d.filter(o):d}return this._forEachCell(t,i,n,a,this._queryCell,d,{hitTest:l,seenUids:{box:{},circle:{}}},o),l?d.length>0:d}_queryCircle(t,i,n,a,l){let o=t-n,d=t+n,s=i-n,r=i+n;if(d<0||o>this.width||r<0||s>this.height)return!a&&[];let c=[];return this._forEachCell(o,s,d,r,this._queryCellCircle,c,{hitTest:a,circle:{x:t,y:i,radius:n},seenUids:{box:{},circle:{}}},l),a?c.length>0:c}query(t,i,n,a,l){return this._query(t,i,n,a,!1,l)}hitTest(t,i,n,a,l){return this._query(t,i,n,a,!0,l)}hitTestCircle(t,i,n,a){return this._queryCircle(t,i,n,!0,a)}_queryCell(t,i,n,a,l,o,d,s){let r=d.seenUids,c=this.boxCells[l];if(c!==null){let m=this.bboxes;for(let h of c)if(!r.box[h]){r.box[h]=!0;let W=4*h;if(t<=m[W+2]&&i<=m[W+3]&&n>=m[W+0]&&a>=m[W+1]&&(!s||s(this.boxKeys[h]))){if(d.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[h],x1:m[W],y1:m[W+1],x2:m[W+2],y2:m[W+3]})}}}let b=this.circleCells[l];if(b!==null){let m=this.circles;for(let h of b)if(!r.circle[h]){r.circle[h]=!0;let W=3*h;if(this._circleAndRectCollide(m[W],m[W+1],m[W+2],t,i,n,a)&&(!s||s(this.circleKeys[h]))){if(d.hitTest)return o.push(!0),!0;{let p=m[W],Z=m[W+1],g=m[W+2];o.push({key:this.circleKeys[h],x1:p-g,y1:Z-g,x2:p+g,y2:Z+g})}}}}}_queryCellCircle(t,i,n,a,l,o,d,s){let r=d.circle,c=d.seenUids,b=this.boxCells[l];if(b!==null){let h=this.bboxes;for(let W of b)if(!c.box[W]){c.box[W]=!0;let p=4*W;if(this._circleAndRectCollide(r.x,r.y,r.radius,h[p+0],h[p+1],h[p+2],h[p+3])&&(!s||s(this.boxKeys[W])))return o.push(!0),!0}}let m=this.circleCells[l];if(m!==null){let h=this.circles;for(let W of m)if(!c.circle[W]){c.circle[W]=!0;let p=3*W;if(this._circlesCollide(h[p],h[p+1],h[p+2],r.x,r.y,r.radius)&&(!s||s(this.circleKeys[W])))return o.push(!0),!0}}}_forEachCell(t,i,n,a,l,o,d,s){let r=this._convertToXCellCoord(t),c=this._convertToYCellCoord(i),b=this._convertToXCellCoord(n),m=this._convertToYCellCoord(a);for(let h=r;h<=b;h++)for(let W=c;W<=m;W++)if(l.call(this,t,i,n,a,this.xCellCount*W+h,o,d,s))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,i,n,a,l,o){let d=a-t,s=l-i,r=n+o;return r*r>d*d+s*s}_circleAndRectCollide(t,i,n,a,l,o,d){let s=(o-a)/2,r=Math.abs(t-(a+s));if(r>s+n)return!1;let c=(d-l)/2,b=Math.abs(i-(l+c));if(b>c+n)return!1;if(r<=s||b<=c)return!0;let m=r-s,h=b-c;return m*m+h*h<=n*n}}let fa=100;class I2{constructor(t,i,n=new xG(t.width+200,t.height+200,25),a=new xG(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=a,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+fa,this.screenBottomBoundary=t.height+fa,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=i}placeCollisionBox(t,i,n,a,l,o,d,s){let r=n.projectedAnchorX,c=n.projectedAnchorY,b=n.projectedAnchorZ,m=n.elevation,h=n.tileID,W=t.getProjection();if(m&&h){let[I,N,Y]=W.upVector(h.canonical,n.tileAnchorX,n.tileAnchorY),X=W.upVectorScale(h.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;r+=I*m*X,c+=N*m*X,b+=Y*m*X}let p=this.projectAndGetPerspectiveRatio(d,r,c,b,n.tileID,W.name==="globe"||!!m||this.transform.pitch>0,W),Z=o*p.perspectiveRatio,g=(n.x1*i+a.x-n.padding)*Z+p.point.x,u=(n.y1*i+a.y-n.padding)*Z+p.point.y,G=(n.x2*i+a.x+n.padding)*Z+p.point.x,F=(n.y2*i+a.y+n.padding)*Z+p.point.y,R=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(g,u,G,F)||!l&&this.grid.hitTest(g,u,G,F,s)||R?{box:[],offscreen:!1,occluded:p.occluded}:{box:[g,u,G,F],offscreen:this.isOffscreen(g,u,G,F),occluded:!1}}placeCollisionCircles(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p){let Z=[],g=this.transform.elevation,u=t.getProjection(),G=g?g.getAtTileOffsetFunc(p,this.transform.center.lat,this.transform.worldSize,u):null,F=new H(n.tileAnchorX,n.tileAnchorY),{x:R,y:I,z:N}=u.projectTilePoint(F.x,F.y,p.canonical);if(G){let[O,f,L]=G(F);R+=O,I+=f,N+=L}let Y=u.name==="globe",X=this.projectAndGetPerspectiveRatio(d,R,I,N,p,Y||!!g||this.transform.pitch>0,u),{perspectiveRatio:J}=X,B=(b?o/J:o*J)/_i,C=Ia(R,I,N,s),Q=X.signedDistanceFromCamera>0?nR(B,l,n.lineOffsetX*B,n.lineOffsetY*B,!1,C,F,n,a,s,{},g&&!b?G:null,b&&!!g,u,p,b):null,y=!1,z=!1,E=!0;if(Q&&!X.occluded){let O=.5*h*J+W,f=new H(-100,-100),L=new H(this.screenRightBoundary,this.screenBottomBoundary),K=new F2,{first:q,last:P}=Q,et=q.path.length,it=[];for(let ot=et-1;ot>=1;ot--)it.push(q.path[ot]);for(let ot=1;ot<P.path.length;ot++)it.push(P.path[ot]);let at=2.5*O;r&&(it=it.map(([ot,Rt,Gt],Yt)=>(G&&!Y&&(Gt=G(Yt<et-1?q.tilePath[et-1-Yt]:P.tilePath[Yt-et+2])[2]),Ia(ot,Rt,Gt,r))),it.some(ot=>ot[3]<=0)&&(it=[]));let $=[];if(it.length>0){let ot=1/0,Rt=-1/0,Gt=1/0,Yt=-1/0;for(let Bt of it)ot=Math.min(ot,Bt[0]),Gt=Math.min(Gt,Bt[1]),Rt=Math.max(Rt,Bt[0]),Yt=Math.max(Yt,Bt[1]);Rt>=f.x&&ot<=L.x&&Yt>=f.y&&Gt<=L.y&&($=[it.map(Bt=>new H(Bt[0],Bt[1]))],(ot<f.x||Rt>L.x||Gt<f.y||Yt>L.y)&&($=Nu($,f.x,f.y,L.x,L.y)))}for(let ot of $){K.reset(ot,.25*O);let Rt=0;Rt=K.length<=.5*O?1:Math.ceil(K.paddedLength/at)+1;for(let Gt=0;Gt<Rt;Gt++){let Yt=Gt/Math.max(Rt-1,1),Bt=K.lerp(Yt),Dt=Bt.x+fa,ft=Bt.y+fa;Z.push(Dt,ft,O,0);let xe=Dt-O,pe=ft-O,_t=Dt+O,jt=ft+O;if(E=E&&this.isOffscreen(xe,pe,_t,jt),z=z||this.isInsideGrid(xe,pe,_t,jt),!i&&this.grid.hitTestCircle(Dt,ft,O,m)&&(y=!0,!c))return{circles:[],offscreen:!1,collisionDetected:y,occluded:!1}}}}return{circles:!c&&y||!z?[]:Z,offscreen:E,collisionDetected:y,occluded:X.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let i=[],n=1/0,a=1/0,l=-1/0,o=-1/0;for(let c of t){let b=new H(c.x+fa,c.y+fa);n=Math.min(n,b.x),a=Math.min(a,b.y),l=Math.max(l,b.x),o=Math.max(o,b.y),i.push(b)}let d=this.grid.query(n,a,l,o).concat(this.ignoredGrid.query(n,a,l,o)),s={},r={};for(let c of d){let b=c.key;s[b.bucketInstanceId]===void 0&&(s[b.bucketInstanceId]={}),s[b.bucketInstanceId][b.featureIndex]||yg(i,[new H(c.x1,c.y1),new H(c.x2,c.y1),new H(c.x2,c.y2),new H(c.x1,c.y2)])&&(s[b.bucketInstanceId][b.featureIndex]=!0,r[b.bucketInstanceId]===void 0&&(r[b.bucketInstanceId]=[]),r[b.bucketInstanceId].push(b.featureIndex))}return r}insertCollisionBox(t,i,n,a,l){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:a,collisionGroupID:l},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,i,n,a,l){let o=i?this.ignoredGrid:this.grid,d={bucketInstanceId:n,featureIndex:a,collisionGroupID:l};for(let s=0;s<t.length;s+=4)o.insertCircle(d,t[s],t[s+1],t[s+2])}projectAndGetPerspectiveRatio(t,i,n,a,l,o,d){let s=[i,n,a,1],r=!1;a||this.transform.pitch>0?(Le.transformMat4(s,s,t),this.fogState&&l&&d.name!=="globe"&&(r=function(m,h,W,p,Z,g){let u=g.calculateFogTileMatrix(Z),G=[h,W,p];return S.transformMat4(G,G,u),ub(m,S.length(G),g.pitch,g._fov)}(this.fogState,i,n,a,l.toUnwrapped(),this.transform)>.9)):sR(s,s,t);let c=s[3];return{point:new H((s[0]/c+1)/2*this.transform.width+fa,(-s[1]/c+1)/2*this.transform.height+fa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(d)/c*.5,1.5),signedDistanceFromCamera:c,occluded:o&&s[2]>c||r}}isOffscreen(t,i,n,a){return n<fa||t>=this.screenRightBoundary||a<fa||i>this.screenBottomBoundary}isInsideGrid(t,i,n,a){return n>=0&&t<this.gridRightBoundary&&a>=0&&i<this.gridBottomBoundary}getViewportMatrix(){let t=D.identity([]);return D.translate(t,t,[-100,-100,0]),t}}function TW(e,t,i){let n=t.createTileMatrix(e,e.worldSize,i.toUnwrapped());return D.multiply(new Float32Array(16),e.projMatrix,n)}function U2(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;let n=i.clone();return n.setProjection(t.projection),TW(n,t.getProjection(),e)}function kW(e,t,i){return t.name===i.projection.name?e.projMatrix:TW(i,t,e)}class NG{constructor(t,i,n,a){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?i:-i))):a&&n?1:0,this.placed=n}isHidden(){return this.opacity===0&&!this.placed}}class sr{constructor(t,i,n,a,l,o=!1){this.text=new NG(t?t.text:null,i,n,l),this.icon=new NG(t?t.icon:null,i,a,l),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class SW{constructor(t,i,n,a=!1){this.text=t,this.icon=i,this.skipFade=n,this.clipped=a}}class x2{constructor(){this.invProjMatrix=D.create(),this.viewportMatrix=D.create(),this.circles=[]}}class N2{constructor(t,i,n,a,l){this.bucketInstanceId=t,this.featureIndex=i,this.sourceLayerIndex=n,this.bucketIndex=a,this.tileID=l}}class Y2{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let i=++this.maxGroupID;this.collisionGroups[t]={ID:i,predicate:n=>n.collisionGroupID===i}}return this.collisionGroups[t]}}function YG(e,t,i,n,a){let{horizontalAlign:l,verticalAlign:o}=Hc(e),d=-(l-.5)*t,s=-(o-.5)*i,r=$h(e,n);return new H(d+r[0]*a,s+r[1]*a)}function QW(e,t,i,n,a){let l=new H(e,t);return i&&l._rotate(n?a:-a),l}class X2{constructor(t,i,n,a,l,o){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new I2(this.transform,l),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Y2(n),this.collisionCircleArrays={},this.prevPlacement=a,a&&(a.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,n,a){let l=n.getBucket(i),o=n.latestFeatureIndex;if(!l||!o||i.fqid!==l.layerIds[0])return;let d=l.layers[0].layout,s=n.collisionBoxArray,r=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/tt,b=n.tileID.toUnwrapped();this.transform.setProjection(l.projection);let m=(h=n.tileID,W=l.getProjection(),p=this.transform,W.name===this.projection?p.calculateProjMatrix(h.toUnwrapped()):TW(p,W,h));var h,W,p;let Z=d.get("text-pitch-alignment")==="map",g=d.get("text-rotation-alignment")==="map";i.compileFilter();let u=i.dynamicFilter(),G=i.dynamicFilterNeedsFeature(),F=this.transform.calculatePixelsToTileUnitsMatrix(n),R=tR(m,n.tileID.canonical,Z,g,this.transform,l.getProjection(),F),I=null;if(Z){let X=eR(m,n.tileID.canonical,Z,g,this.transform,l.getProjection(),F);I=D.multiply([],this.transform.labelPlaneMatrix,X)}let N=null;u&&n.latestFeatureIndex&&(N={unwrappedTileID:b,dynamicFilter:u,dynamicFilterNeedsFeature:G,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[l.bucketInstanceId]=new N2(l.bucketInstanceId,o,l.sourceLayerIndex,l.index,n.tileID);let Y={bucket:l,layout:d,posMatrix:m,textLabelPlaneMatrix:R,labelToScreenMatrix:I,clippingData:N,scale:r,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:ka(l.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:ka(l.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(l.sourceID)};if(a)for(let X of l.sortKeyRanges){let{sortKey:J,symbolInstanceStart:B,symbolInstanceEnd:C}=X;t.push({sortKey:J,symbolInstanceStart:B,symbolInstanceEnd:C,parameters:Y})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:l.symbolInstances.length,parameters:Y})}attemptAnchorPlacement(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u){let{textOffset0:G,textOffset1:F,crossTileID:R}=m,I=[G,F],N=YG(t,n,a,I,l),Y=this.collisionIndex.placeCollisionBox(W,l,i,QW(N.x,N.y,o,d,this.transform.angle),b,s,r,c.predicate);if(Z){let X=W.getSymbolInstanceIconSize(u,this.transform.zoom,m.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,X,Z,QW(N.x,N.y,o,d,this.transform.angle),b,s,r,c.predicate).box.length===0)return}if(Y.box.length>0){let X;return this.prevPlacement&&this.prevPlacement.variableOffsets[R]&&this.prevPlacement.placements[R]&&this.prevPlacement.placements[R].text&&(X=this.prevPlacement.variableOffsets[R].anchor),this.variableOffsets[R]={textOffset:I,width:n,height:a,anchor:t,textScale:l,prevAnchor:X},this.markUsedJustification(W,t,m,p),W.allowVerticalPlacement&&(this.markUsedOrientation(W,p,m),this.placedOrientations[R]=p),{shift:N,placedGlyphBoxes:Y}}}placeLayerBucketPart(t,i,n,a){let{bucket:l,layout:o,posMatrix:d,textLabelPlaneMatrix:s,labelToScreenMatrix:r,clippingData:c,textPixelRatio:b,holdingForFade:m,collisionBoxArray:h,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:p,collisionGroup:Z}=t.parameters,g=o.get("text-optional"),u=o.get("icon-optional"),G=o.get("text-allow-overlap"),F=o.get("icon-allow-overlap"),R=o.get("text-rotation-alignment")==="map",I=o.get("text-pitch-alignment")==="map",N=o.get("symbol-z-order")==="viewport-y",Y=o.get("symbol-z-elevate");this.transform.setProjection(l.projection);let X=G&&(F||!l.hasIconData()||u),J=F&&(G||!l.hasTextData()||g);!l.collisionArrays&&h&&l.deserializeCollisionBoxes(h),n&&a&&l.updateCollisionDebugBuffers(this.transform.zoom,h);let B=(C,Q,y)=>{let{crossTileID:z,numVerticalGlyphVertices:E}=C;if(c){let _t={zoom:this.transform.zoom,pitch:this.transform.pitch},jt=null;if(c.dynamicFilterNeedsFeature){let zt=this.retainedQueryData[l.bucketInstanceId];jt=c.featureIndex.loadFeature({featureIndex:C.featureIndex,bucketIndex:zt.bucketIndex,sourceLayerIndex:zt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,c.dynamicFilter)(_t,jt,this.retainedQueryData[l.bucketInstanceId].tileID.canonical,new H(C.tileAnchorX,C.tileAnchorY),this.transform.calculateDistanceTileData(c.unwrappedTileID)))return this.placements[z]=new SW(!1,!1,!1,!0),void i.add(z)}if(i.has(z))return;if(m)return void(this.placements[z]=new SW(!1,!1,!1));let O=!1,f=!1,L=!0,K=!1,q=!1,P=null,et={box:null,offscreen:null,occluded:null},it={box:null,offscreen:null,occluded:null},at=null,$=null,ot=null,Rt=0,Gt=0,Yt=0;y.textFeatureIndex?Rt=y.textFeatureIndex:C.useRuntimeCollisionCircles&&(Rt=C.featureIndex),y.verticalTextFeatureIndex&&(Gt=y.verticalTextFeatureIndex);let Bt=_t=>{_t.tileID=this.retainedQueryData[l.bucketInstanceId].tileID;let jt=this.transform.elevation;_t.elevation=C.zOffset+(jt?jt.getAtTileOffset(_t.tileID,_t.tileAnchorX,_t.tileAnchorY):0)},Dt=y.textBox;if(Dt){Bt(Dt);let _t=zt=>{let ge=di.horizontal;if(l.allowVerticalPlacement&&!zt&&this.prevPlacement){let Ie=this.prevPlacement.placedOrientations[z];Ie&&(this.placedOrientations[z]=Ie,ge=Ie,this.markUsedOrientation(l,ge,C))}return ge},jt=(zt,ge)=>{if(l.allowVerticalPlacement&&E>0&&y.verticalTextBox){for(let Ie of l.writingModes)if(Ie===di.vertical?(et=ge(),it=et):et=zt(),et&&et.box&&et.box.length)break}else et=zt()};if(o.get("text-variable-anchor")){let zt=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[z]){let se=this.prevPlacement.variableOffsets[z];zt.indexOf(se.anchor)>0&&(zt=zt.filter(Oe=>Oe!==se.anchor),zt.unshift(se.anchor))}let ge=(se,Oe,Ri)=>{let Ee=l.getSymbolInstanceTextSize(W,C,this.transform.zoom,Q),ti=(se.x2-se.x1)*Ee+2*se.padding,xi=(se.y2-se.y1)*Ee+2*se.padding,Gi=C.hasIconTextFit&&!F?Oe:null;Gi&&Bt(Gi);let ai={box:[],offscreen:!1,occluded:!1},Se=G?2*zt.length:zt.length;for(let qi=0;qi<Se;++qi){let La=this.attemptAnchorPlacement(zt[qi%zt.length],se,ti,xi,Ee,R,I,b,d,Z,qi>=zt.length,C,Q,l,Ri,Gi,W,p);if(La&&(ai=La.placedGlyphBoxes,ai&&ai.box&&ai.box.length)){O=!0,P=La.shift;break}}return ai};jt(()=>ge(Dt,y.iconBox,di.horizontal),()=>{let se=y.verticalTextBox;return se&&Bt(se),l.allowVerticalPlacement&&!(et&&et.box&&et.box.length)&&E>0&&se?ge(se,y.verticalIconBox,di.vertical):{box:null,offscreen:null,occluded:null}}),et&&(O=et.box,L=et.offscreen,K=et.occluded);let Ie=_t(!(!et||!et.box));if(!O&&this.prevPlacement){let se=this.prevPlacement.variableOffsets[z];se&&(this.variableOffsets[z]=se,this.markUsedJustification(l,se.anchor,C,Ie))}}else{let zt=(ge,Ie)=>{let se=l.getSymbolInstanceTextSize(W,C,this.transform.zoom,Q),Oe=this.collisionIndex.placeCollisionBox(l,se,ge,new H(0,0),G,b,d,Z.predicate);return Oe&&Oe.box&&Oe.box.length&&(this.markUsedOrientation(l,Ie,C),this.placedOrientations[z]=Ie),Oe};jt(()=>zt(Dt,di.horizontal),()=>{let ge=y.verticalTextBox;return l.allowVerticalPlacement&&E>0&&ge?(Bt(ge),zt(ge,di.vertical)):{box:null,offscreen:null,occluded:null}}),_t(!!(et&&et.box&&et.box.length))}}if(at=et,O=at&&at.box&&at.box.length>0,L=at&&at.offscreen,K=at&&at.occluded,C.useRuntimeCollisionCircles){let _t=l.text.placedSymbolArray.get(C.centerJustifiedTextSymbolIndex>=0?C.centerJustifiedTextSymbolIndex:C.verticalPlacedTextSymbolIndex),jt=zs(l.textSizeData,W,_t),zt=o.get("text-padding");$=this.collisionIndex.placeCollisionCircles(l,G,_t,l.lineVertexArray,l.glyphOffsetArray,jt,d,s,r,n,I,Z.predicate,C.collisionCircleDiameter*jt/_i,zt,this.retainedQueryData[l.bucketInstanceId].tileID),O=G||$.circles.length>0&&!$.collisionDetected,L=L&&$.offscreen,K=$.occluded}if(y.iconFeatureIndex&&(Yt=y.iconFeatureIndex),y.iconBox){let _t=jt=>{Bt(jt);let zt=C.hasIconTextFit&&P?QW(P.x,P.y,R,I,this.transform.angle):new H(0,0),ge=l.getSymbolInstanceIconSize(p,this.transform.zoom,C.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(l,ge,jt,zt,F,b,d,Z.predicate)};it&&it.box&&it.box.length&&y.verticalIconBox?(ot=_t(y.verticalIconBox),f=ot.box.length>0):(ot=_t(y.iconBox),f=ot.box.length>0),L=L&&ot.offscreen,q=ot.occluded}let ft=g||C.numHorizontalGlyphVertices===0&&E===0,xe=u||C.numIconVertices===0;if(ft||xe?xe?ft||(f=f&&O):O=f&&O:f=O=f&&O,O&&at&&at.box&&this.collisionIndex.insertCollisionBox(at.box,o.get("text-ignore-placement"),l.bucketInstanceId,it&&it.box&&Gt?Gt:Rt,Z.ID),f&&ot&&this.collisionIndex.insertCollisionBox(ot.box,o.get("icon-ignore-placement"),l.bucketInstanceId,Yt,Z.ID),$&&(O&&this.collisionIndex.insertCollisionCircles($.circles,o.get("text-ignore-placement"),l.bucketInstanceId,Rt,Z.ID),n)){let _t=l.bucketInstanceId,jt=this.collisionCircleArrays[_t];jt===void 0&&(jt=this.collisionCircleArrays[_t]=new x2);for(let zt=0;zt<$.circles.length;zt+=4)jt.circles.push($.circles[zt+0]),jt.circles.push($.circles[zt+1]),jt.circles.push($.circles[zt+2]),jt.circles.push($.collisionDetected?1:0)}let pe=l.projection.name!=="globe";X=X&&(pe||!K),J=J&&(pe||!q),this.placements[z]=new SW(O||X,f||J,L||l.justReloaded),i.add(z)};if(Y&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,this.retainedQueryData[l.bucketInstanceId].tileID),l.updateZOffset()),N){let C=l.getSortedSymbolIndexes(this.transform.angle);for(let Q=C.length-1;Q>=0;--Q){let y=C[Q];B(l.symbolInstances.get(y),y,l.collisionArrays[y])}l.hasAnyZOffset&&A("".concat(l.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(l.hasAnyZOffset){let C=l.getSortedIndexesByZOffset();for(let Q=0;Q<C.length;++Q){let y=C[Q];B(l.symbolInstances.get(y),y,l.collisionArrays[y])}}else for(let C=t.symbolInstanceStart;C<t.symbolInstanceEnd;C++)B(l.symbolInstances.get(C),C,l.collisionArrays[C]);if(n&&l.bucketInstanceId in this.collisionCircleArrays){let C=this.collisionCircleArrays[l.bucketInstanceId];D.invert(C.invProjMatrix,d),C.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}markUsedJustification(t,i,n,a){let{leftJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:s,crossTileID:r}=n,c=tW(i),b=a===di.vertical?s:c==="left"?l:c==="center"?o:c==="right"?d:-1;l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=b>=0&&l!==b?0:r),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=b>=0&&o!==b?0:r),d>=0&&(t.text.placedSymbolArray.get(d).crossTileID=b>=0&&d!==b?0:r),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=b>=0&&s!==b?0:r)}markUsedOrientation(t,i,n){let a=i===di.horizontal||i===di.horizontalOnly?i:0,l=i===di.vertical?i:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:d,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:r}=n,c=t.text.placedSymbolArray;o>=0&&(c.get(o).placedOrientation=a),d>=0&&(c.get(d).placedOrientation=a),s>=0&&(c.get(s).placedOrientation=a),r>=0&&(c.get(r).placedOrientation=l)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let i=this.prevPlacement,n=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;let a=i?i.symbolFadeChange(t):1,l=i?i.opacities:{},o=i?i.variableOffsets:{},d=i?i.placedOrientations:{};for(let s in this.placements){let r=this.placements[s],c=l[s];c?(this.opacities[s]=new sr(c,a,r.text,r.icon,null,r.clipped),n=n||r.text!==c.text.placed||r.icon!==c.icon.placed):(this.opacities[s]=new sr(null,a,r.text,r.icon,r.skipFade,r.clipped),n=n||r.text||r.icon)}for(let s in l){let r=l[s];if(!this.opacities[s]){let c=new sr(r,a,!1,!1);c.isHidden()||(this.opacities[s]=c,n=n||r.text.placed||r.icon.placed)}}for(let s in o)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=o[s]);for(let s in d)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=d[s]);n?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:t)}updateLayerOpacities(t,i){let n=new Set;for(let a of i){let l=a.getBucket(t);l&&a.latestFeatureIndex&&t.fqid===l.layerIds[0]&&(this.updateBucketOpacities(l,n,a.collisionBoxArray),l.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(l,a.tileID),l.updateZOffset()))}}updateBucketOpacities(t,i,n){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let a=t.layers[0].layout,l=!!t.layers[0].dynamicFilter(),o=new sr(null,0,!1,!1,!0),d=a.get("text-allow-overlap"),s=a.get("icon-allow-overlap"),r=a.get("text-variable-anchor"),c=a.get("text-rotation-alignment")==="map",b=a.get("text-pitch-alignment")==="map",m=new sr(null,0,d&&(s||!t.hasIconData()||a.get("icon-optional")),s&&(d||!t.hasTextData()||a.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);let h=(p,Z,g)=>{for(let u=0;u<Z/4;u++)p.opacityVertexArray.emplaceBack(g)},W=0;for(let p=0;p<t.symbolInstances.length;p++){let Z=t.symbolInstances.get(p),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:u,crossTileID:G,numIconVertices:F}=Z,R=i.has(G),I=this.opacities[G];R?I=o:I||(I=m,this.opacities[G]=I),i.add(G);let N=g>0||u>0,Y=F>0,X=this.placedOrientations[G],J=X===di.vertical,B=X===di.horizontal||X===di.horizontalOnly;if(!N&&!Y||I.isHidden()||W++,N){let C=XG(I.text);h(t.text,g,J?Nb:C),h(t.text,u,B?Nb:C);let Q=I.text.isHidden(),{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:O}=Z,f=t.text.placedSymbolArray,L=Q||J?1:0;y>=0&&(f.get(y).hidden=L),z>=0&&(f.get(z).hidden=L),E>=0&&(f.get(E).hidden=L),O>=0&&(f.get(O).hidden=Q||B?1:0);let K=this.variableOffsets[G];K&&this.markUsedJustification(t,K.anchor,Z,X);let q=this.placedOrientations[G];q&&(this.markUsedJustification(t,"left",Z,q),this.markUsedOrientation(t,q,Z))}if(Y){let C=XG(I.icon),{placedIconSymbolIndex:Q,verticalPlacedIconSymbolIndex:y}=Z,z=t.icon.placedSymbolArray,E=I.icon.isHidden()?1:0;Q>=0&&(h(t.icon,F,J?Nb:C),z.get(Q).hidden=E),y>=0&&(h(t.icon,Z.numVerticalIconVertices,B?Nb:C),z.get(y).hidden=E)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let C=t.collisionArrays[p];if(C){let Q=new H(0,0),y=!0;if(C.textBox||C.verticalTextBox){if(r){let E=this.variableOffsets[G];E?(Q=YG(E.anchor,E.width,E.height,E.textOffset,E.textScale),c&&Q._rotate(b?this.transform.angle:-this.transform.angle)):y=!1}l&&(y=!I.clipped),C.textBox&&xb(t.textCollisionBox.collisionVertexArray,I.text.placed,!y||J,Q.x,Q.y),C.verticalTextBox&&xb(t.textCollisionBox.collisionVertexArray,I.text.placed,!y||B,Q.x,Q.y)}let z=y&&!!(!B&&C.verticalIconBox);C.iconBox&&xb(t.iconCollisionBox.collisionVertexArray,I.icon.placed,z,Z.hasIconTextFit?Q.x:0,Z.hasIconTextFit?Q.y:0),C.verticalIconBox&&xb(t.iconCollisionBox.collisionVertexArray,I.icon.placed,!z,Z.hasIconTextFit?Q.x:0,Z.hasIconTextFit?Q.y:0)}}}if(t.fullyClipped=W===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let p=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=p.invProjMatrix,t.placementViewportMatrix=p.viewportMatrix,t.collisionCircleArray=p.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,i){let n=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function xb(e,t,i,n,a){e.emplaceBack(t?1:0,i?1:0,n||0,a||0),e.emplaceBack(t?1:0,i?1:0,n||0,a||0),e.emplaceBack(t?1:0,i?1:0,n||0,a||0),e.emplaceBack(t?1:0,i?1:0,n||0,a||0)}let J2=Math.pow(2,25),y2=Math.pow(2,24),B2=Math.pow(2,17),M2=Math.pow(2,16),C2=Math.pow(2,9),T2=Math.pow(2,8),k2=Math.pow(2,1);function XG(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;let t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*J2+t*y2+i*B2+t*M2+i*C2+t*T2+i*k2+t}let Nb=0;class S2{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,i,n,a,l){let o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(i.getBucketParts(o,a,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,l())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((d,s)=>d.sortKey-s.sortKey));this._currentPartIndex<o.length;){let d=o[this._currentPartIndex];if(i.placeLayerBucketPart(d,this._seenCrossTileIDs,n,d.symbolInstanceStart===0),this._currentPartIndex++,l())return!0}return!1}}class Q2{constructor(t,i,n,a,l,o,d,s,r){this.placement=new X2(t,l,o,d,s,r),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=a,this._done=!1}isDone(){return this._done}continuePlacement(t,i,n,a){let l=ee.now(),o=()=>{let d=ee.now()-l;return!this._forceFullPlacement&&d>2};for(;this._currentPlacementIndex>=0;){let d=i[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if(d.type==="symbol"&&(!d.minzoom||d.minzoom<=s)&&(!d.maxzoom||d.maxzoom>s)){let r=d,c=r.layout.get("symbol-z-elevate"),b=this._inProgressLayer=this._inProgressLayer||new S2(r),m=mn(d.source,d.scope);if(b.continuePlacement(c?a[m]:n[m],this.placement,this._showCollisionBoxes,d,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let JG=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yb{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,n]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let a=n>>4;if(a!==1)throw new Error("Got v".concat(a," data when expected v1."));let l=JG[15&n];if(!l)throw new Error("Unrecognized array type.");let[o]=new Uint16Array(t,2,1),[d]=new Uint32Array(t,4,1);return new Yb(d,o,l,t)}constructor(t,i=64,n=Float64Array,a){if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let l=JG.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,d=t*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-d%8)%8;if(l<0)throw new Error("Unexpected typed array class: ".concat(n,"."));a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+d+s,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+d+s),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+d+s,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=i,n}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return vW(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:o,nodeSize:d}=this,s=[0,l.length-1,0],r=[];for(;s.length;){let c=s.pop()||0,b=s.pop()||0,m=s.pop()||0;if(b-m<=d){for(let Z=m;Z<=b;Z++){let g=o[2*Z],u=o[2*Z+1];g>=t&&g<=n&&u>=i&&u<=a&&r.push(l[Z])}continue}let h=m+b>>1,W=o[2*h],p=o[2*h+1];W>=t&&W<=n&&p>=i&&p<=a&&r.push(l[h]),(c===0?t<=W:i<=p)&&(s.push(m),s.push(h-1),s.push(1-c)),(c===0?n>=W:a>=p)&&(s.push(h+1),s.push(b),s.push(1-c))}return r}within(t,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:a,coords:l,nodeSize:o}=this,d=[0,a.length-1,0],s=[],r=n*n;for(;d.length;){let c=d.pop()||0,b=d.pop()||0,m=d.pop()||0;if(b-m<=o){for(let Z=m;Z<=b;Z++)BG(l[2*Z],l[2*Z+1],t,i)<=r&&s.push(a[Z]);continue}let h=m+b>>1,W=l[2*h],p=l[2*h+1];BG(W,p,t,i)<=r&&s.push(a[h]),(c===0?t-n<=W:i-n<=p)&&(d.push(m),d.push(h-1),d.push(1-c)),(c===0?t+n>=W:i+n>=p)&&(d.push(h+1),d.push(b),d.push(1-c))}return s}}function vW(e,t,i,n,a,l){if(a-n<=i)return;let o=n+a>>1;yG(e,t,o,n,a,l),vW(e,t,i,n,o-1,1-l),vW(e,t,i,o+1,a,1-l)}function yG(e,t,i,n,a,l){for(;a>n;){if(a-n>600){let r=a-n+1,c=i-n+1,b=Math.log(r),m=.5*Math.exp(2*b/3),h=.5*Math.sqrt(b*m*(r-m)/r)*(c-r/2<0?-1:1);yG(e,t,i,Math.max(n,Math.floor(i-c*m/r+h)),Math.min(a,Math.floor(i+(r-c)*m/r+h)),l)}let o=t[2*i+l],d=n,s=a;for(rr(e,t,n,i),t[2*a+l]>o&&rr(e,t,n,a);d<s;){for(rr(e,t,d,s),d++,s--;t[2*d+l]<o;)d++;for(;t[2*s+l]>o;)s--}t[2*n+l]===o?rr(e,t,n,s):(s++,rr(e,t,s,a)),s<=i&&(n=s+1),i<=s&&(a=s-1)}}function rr(e,t,i,n){fW(e,i,n),fW(t,2*i,2*n),fW(t,2*i+1,2*n+1)}function fW(e,t,i){let n=e[t];e[t]=e[i],e[i]=n}function BG(e,t,i,n){let a=e-i,l=t-n;return a*a+l*l}let zW=512/tt/2;class v2{constructor(t,i,n){this.tileID=t,this.bucketInstanceId=n,this.index=new Yb(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let a=t.canonical.x*tt,l=t.canonical.y*tt;for(let o=0;o<i.length;o++){let{key:d,crossTileID:s,tileAnchorX:r,tileAnchorY:c}=i.get(o),b=Math.floor((a+r)*zW),m=Math.floor((l+c)*zW);this.index.add(b,m),this.keys.push(d),this.crossTileIDs.push(s)}this.index.finish()}findMatches(t,i,n){let a=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),l=zW/Math.pow(2,i.canonical.z-this.tileID.canonical.z),o=i.canonical.x*tt,d=i.canonical.y*tt;for(let s=0;s<t.length;s++){let r=t.get(s);if(r.crossTileID)continue;let{key:c,tileAnchorX:b,tileAnchorY:m}=r,h=Math.floor((o+b)*l),W=Math.floor((d+m)*l),p=this.index.range(h-a,W-a,h+a,W+a);for(let Z of p){let g=this.crossTileIDs[Z];if(this.keys[Z]===c&&!n.has(g)){n.add(g),r.crossTileID=g;break}}}}}class f2{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class z2{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let i=Math.round((t-this.lng)/360);if(i!==0)for(let n in this.indexes){let a=this.indexes[n],l={};for(let o in a){let d=a[o];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+i),l[d.tileID.key]=d}this.indexes[n]=l}this.lng=t}addBucket(t,i,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let l=0;l<i.symbolInstances.length;l++)i.symbolInstances.get(l).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let a=this.usedCrossTileIDs[t.overscaledZ];for(let l in this.indexes){let o=this.indexes[l];if(Number(l)>t.overscaledZ)for(let d in o){let s=o[d];s.tileID.isChildOf(t)&&s.findMatches(i.symbolInstances,t,a)}else{let d=o[t.scaledTo(Number(l)).key];d&&d.findMatches(i.symbolInstances,t,a)}}for(let l=0;l<i.symbolInstances.length;l++){let o=i.symbolInstances.get(l);o.crossTileID||(o.crossTileID=n.generate(),a.add(o.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new v2(t,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(t,i){for(let n of i.crossTileIDs)this.usedCrossTileIDs[t].delete(n)}removeStaleBuckets(t){let i=!1;for(let n in this.indexes){let a=this.indexes[n];for(let l in a)t[a[l].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,a[l]),delete a[l],i=!0)}return i}}class L2{constructor(){this.layerIndexes={},this.crossTileIDs=new f2,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,i,n,a){let l=this.layerIndexes[t.fqid];l===void 0&&(l=this.layerIndexes[t.fqid]=new z2);let o=!1,d={};a.name!=="globe"&&l.handleWrapJump(n);for(let s of i){let r=s.getBucket(t);r&&t.fqid===r.layerIds[0]&&(r.bucketInstanceId||(r.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(s.tileID,r,this.crossTileIDs)&&(o=!0),d[r.bucketInstanceId]=!0)}return l.removeStaleBuckets(d)&&(o=!0),o}pruneUnusedLayers(t){let i={};t.forEach(n=>{i[n]=!0});for(let n in this.layerIndexes)i[n]||delete this.layerIndexes[n]}}var MG="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",CG="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",TG="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",kG="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",SG="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",QG="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)\n);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)\n);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",vG="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",fG="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";let zG=[];yb(MG,zG);let Xb={"_prelude_fog.vertex.glsl":kG,"_prelude_terrain.vertex.glsl":TG,"_prelude_shadow.vertex.glsl":vG,"_prelude_fog.fragment.glsl":SG,"_prelude_shadow.fragment.glsl":fG,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":QG},Jb={};ke("",TG),ke(SG,kG),ke(fG,vG),ke(QG,"");let LG=ke("\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif","\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}"),EG=MG;var AG={background:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:ke("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ke('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:ke("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ke("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:ke("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ke("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef RENDER_CUTOFF\ncolor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#ifdef RENDER_CUTOFF\ninvariant gl_Position;\n#endif\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),fillExtrusionDepth:ke("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:ke('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:ke("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;HANDLE_WIREFRAME_DEBUG;\n#endif\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;\n#ifdef FORCE_ABS_FL_GROUND_RADIUS\nfl_ground_radius=abs(flood_light_ground_radius);\n#endif\nfloat flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:ke("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#elif defined(PROJECTION_GLOBE_VIEW)\nin vec2 a_pos;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\nuv=a_texture_pos/8192.0;\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),symbolIcon:ke('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:ke('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:ke('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}'),terrainDepth:ke("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:ke('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',CG),skyboxGradient:ke('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',CG),skyboxCapture:ke("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:ke('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:ke('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\ntexColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(diffuse,1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:ke("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:ke("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function yb(e,t){let i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let n of i)if(n=n.trim(),n[0]==="#"&&n.includes("if")&&!n.includes("endif")){n=n.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let a=n.split(" ");for(let l of a)t.includes(l)||t.push(l)}}function ke(e,t){let i=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,a=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);a&&(a=a.map(r=>{let c=r.split(" ");return c[c.length-1]}),a=[...new Set(a)]);let l={},o=[],d=[];e=e.replace(i,(r,c)=>(d.push(c),"")),t=t.replace(i,(r,c)=>(o.push(c),""));let s=[...zG];yb(e,s),yb(t,s);for(let r of[...o,...d])Xb[r]||console.error("Undefined include: ".concat(r)),Jb[r]||(Jb[r]=[],yb(Xb[r],Jb[r])),s=[...s,...Jb[r]];return{fragmentSource:e=e.replace(n,(r,c,b,m,h)=>(l[h]=!0,c==="define"?"\n#ifndef HAS_UNIFORM_u_".concat(h,"\nin ").concat(b," ").concat(m," ").concat(h,";\n#else\nuniform ").concat(b," ").concat(m," u_").concat(h,";\n#endif\n"):c==="initialize"?"\n#ifdef HAS_UNIFORM_u_".concat(h,"\n    ").concat(b," ").concat(m," ").concat(h," = u_").concat(h,";\n#endif\n"):c==="define-attribute"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(h,"\n    in ").concat(b," ").concat(m," ").concat(h,";\n#endif\n"):c==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(n,(r,c,b,m,h)=>{let W=m==="float"?"vec2":m,p=h.match(/color/)?"color":W;return c==="define-attribute-vertex-shader-only"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(h,"\nin ").concat(b," ").concat(m," a_").concat(h,";\n#endif\n"):l[h]?c==="define"?"\n#ifndef HAS_UNIFORM_u_".concat(h,"\nuniform lowp float u_").concat(h,"_t;\nin ").concat(b," ").concat(W," a_").concat(h,";\nout ").concat(b," ").concat(m," ").concat(h,";\n#else\nuniform ").concat(b," ").concat(m," u_").concat(h,";\n#endif\n"):c==="initialize"?p==="vec4"?"\n#ifndef HAS_UNIFORM_u_".concat(h,"\n    ").concat(h," = a_").concat(h,";\n#else\n    ").concat(b," ").concat(m," ").concat(h," = u_").concat(h,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(h,"\n    ").concat(h," = unpack_mix_").concat(p,"(a_").concat(h,", u_").concat(h,"_t);\n#else\n    ").concat(b," ").concat(m," ").concat(h," = u_").concat(h,";\n#endif\n"):c==="define-attribute"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(h,"\n    in ").concat(b," ").concat(m," a_").concat(h,";\n    out ").concat(b," ").concat(m," ").concat(h,";\n#endif\n"):c==="initialize-attribute"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(h,"\n    ").concat(h," = a_").concat(h,";\n#endif\n"):void 0:c==="define"?"\n#ifndef HAS_UNIFORM_u_".concat(h,"\nuniform lowp float u_").concat(h,"_t;\nin ").concat(b," ").concat(W," a_").concat(h,";\n#else\nuniform ").concat(b," ").concat(m," u_").concat(h,";\n#endif\n"):c==="define-instanced"?p==="mat4"?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(h,"0;\nin vec4 a_").concat(h,"1;\nin vec4 a_").concat(h,"2;\nin vec4 a_").concat(h,"3;\n#else\nuniform ").concat(b," ").concat(m," u_").concat(h,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(b," ").concat(W," a_").concat(h,";\n#else\nuniform ").concat(b," ").concat(m," u_").concat(h,";\n#endif\n"):c==="initialize-attribute-custom"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(h,"\n    ").concat(b," ").concat(m," ").concat(h," = a_").concat(h,";\n#endif\n"):p==="vec4"?"\n#ifndef HAS_UNIFORM_u_".concat(h,"\n    ").concat(b," ").concat(m," ").concat(h," = a_").concat(h,";\n#else\n    ").concat(b," ").concat(m," ").concat(h," = u_").concat(h,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(h,"\n    ").concat(b," ").concat(m," ").concat(h," = unpack_mix_").concat(p,"(a_").concat(h,", u_").concat(h,"_t);\n#else\n    ").concat(b," ").concat(m," ").concat(h," = u_").concat(h,";\n#endif\n")}),staticAttributes:a,usedDefines:s,vertexIncludes:o,fragmentIncludes:d}}class E2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,i,n,a,l,o,d,s){this.context=t;let r=this.boundPaintVertexBuffers.length!==a.length;for(let b=0;!r&&b<a.length;b++)this.boundPaintVertexBuffers[b]!==a[b]&&(r=!0);let c=this.boundDynamicVertexBuffers.length!==d.length;for(let b=0;!c&&b<d.length;b++)this.boundDynamicVertexBuffers[b]!==d[b]&&(c=!0);if(!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==n||r||c||this.boundIndexBuffer!==l||this.boundVertexOffset!==o)this.freshBind(i,n,a,l,o,d,s);else{t.bindVertexArrayOES.set(this.vao);for(let b of d)b&&(b.bind(),s&&b.instanceCount&&b.setVertexAttribDivisor(t.gl,i,s));l&&l.dynamicDraw&&l.bind()}}freshBind(t,i,n,a,l,o,d){let s=t.numAttributes,r=this.context,c=r.gl;this.vao&&this.destroy(),this.vao=r.gl.createVertexArray(),r.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=a,this.boundVertexOffset=l,this.boundDynamicVertexBuffers=o,i.enableAttributes(c,t),i.bind(),i.setVertexAttribPointers(c,t,l);for(let b of n)b.enableAttributes(c,t),b.bind(),b.setVertexAttribPointers(c,t,l);for(let b of o)b&&(b.enableAttributes(c,t),b.bind(),b.setVertexAttribPointers(c,t,l),d&&b.instanceCount&&b.setVertexAttribDivisor(c,t,d));a&&a.bind(),r.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function A2(e,t){let i=Math.pow(2,t.canonical.z),n=t.canonical.y;return[new Re(0,n/i).toLngLat().lat,new Re(0,(n+1)/i).toLngLat().lat]}function w2(e,t,i,n,a,l,o){let d=e.context,s=d.gl,r=i.hillshadeFBO;if(!r)return;e.prepareDrawTile();let c=e.isTileAffectedByFog(t),b=e.getOrCreateProgram("hillshade",{overrideFog:c});d.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,r.colorAttachment.get());let m=((Z,g,u,G)=>{let F=u.paint.get("hillshade-shadow-color"),R=u.paint.get("hillshade-highlight-color"),I=u.paint.get("hillshade-accent-color"),N=u.paint.get("hillshade-emissive-strength"),Y=At(u.paint.get("hillshade-illumination-direction"));if(u.paint.get("hillshade-illumination-anchor")==="viewport")Y-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){let J=Z.style.directionalLight.properties.get("direction");Y=At(Qt(J.x,J.y,J.z)[1])}let X=!Z.options.moving;return{u_matrix:G||Z.transform.calculateProjMatrix(g.tileID.toUnwrapped(),X),u_image:0,u_latrange:A2(0,g.tileID),u_light:[u.paint.get("hillshade-exaggeration"),Y],u_shadow:F,u_highlight:R,u_emissive_strength:N,u_accent:I}})(e,i,n,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(d,b,t.toUnwrapped());let{tileBoundsBuffer:h,tileBoundsIndexBuffer:W,tileBoundsSegments:p}=e.getTileBoundsBuffers(i);b.draw(e,s.TRIANGLES,a,l,o,me.disabled,m,n.id,h,W,p)}function wG(e,t,i){if(!t.needsDEMTextureUpload)return;let n=e.context,a=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(i.stride);let l=i.getPixels();t.demTexture?t.demTexture.update(l,{premultiply:!1}):t.demTexture=new bi(n,l,a.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function j2(e,t,i){let n=e.context,a=n.gl;if(!t.dem)return;let l=t.dem;if(n.activeTexture.set(a.TEXTURE1),wG(e,t,l),!t.demTexture)return;t.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);let o=l.dim;n.activeTexture.set(a.TEXTURE0);let d=t.hillshadeFBO;if(!d){let m=new bi(n,{width:o,height:o,data:null},a.RGBA);m.bind(a.LINEAR,a.CLAMP_TO_EDGE),d=t.hillshadeFBO=n.createFramebuffer(o,o,!0,"renderbuffer"),d.colorAttachment.set(m.texture)}n.bindFramebuffer.set(d.framebuffer),n.viewport.set([0,0,o,o]);let{tileBoundsBuffer:s,tileBoundsIndexBuffer:r,tileBoundsSegments:c}=e.getMercatorTileBoundsBuffers(),b=[];e.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:b}).draw(e,a.TRIANGLES,Ot.disabled,ce.disabled,Ne.unblended,me.disabled,((m,h)=>{let W=h.stride,p=D.create();return D.ortho(p,0,tt,-tt,0,0,1),D.translate(p,p,[0,-tt,0]),{u_matrix:p,u_image:1,u_dimension:[W,W],u_zoom:m.overscaledZ}})(t.tileID,l),i.id,s,r,c),t.needsHillshadePrepare=!1}let jG=e=>({u_matrix:new ie(e),u_image0:new he(e),u_skirt_height:new st(e),u_ground_shadow_factor:new ae(e)}),HG=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),OG=(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:a,u_merc_center:l,u_image0:0,u_frustum_tl:o,u_frustum_tr:d,u_frustum_br:s,u_frustum_bl:r,u_globe_pos:c,u_globe_radius:b,u_viewport:m,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:h}),Qd=(e,t)=>{if(t>0&&e.terrain&&A("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};let i=e.transform,n=Math.max(Math.abs(i._zoom-(e.minCutoffZoom-1)),1),a=i.isLODDisabled(!1)?pn(60,45,i.pitch):pn(30,15,i.pitch),l=i._farZ-i._nearZ,o=t*i.height,d=((1-(s=a))*(.75*i.cameraToCenterDistance)+s*(i._farZ+o))*n;var s;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[i._nearZ,i._farZ,(d-i._nearZ)/l,(d-o-i._nearZ)/l]}}};function DG(e,t){return e!=null&&t!=null&&!(!e.hasData()||!t.hasData())&&e.demTexture!=null&&t.demTexture!=null&&e.tileID.key!==t.tileID.key}let vd=new class{constructor(){this.operations={}}newMorphing(e,t,i,n,a){if(e in this.operations){let l=this.operations[e];l.to.tileID.key!==i.tileID.key&&(l.queued=i)}else this.operations[e]={startTime:n,phase:0,duration:a,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;let t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(let t in this.operations){let i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},_G={0:null,1:"TERRAIN_VERTEX_MORPHING"};function KG(e,t,i){if(t===0)return 0;let n=t<1&&i===514?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*n}function H2(e,t){let i=1<<e.z;return!t&&(e.x===0||e.x===i-1)||e.y===0||e.y===i-1}let LW=e=>({u_matrix:e});function PG(e,t,i,n,a){if(a>0){let l=ee.now(),o=(l-e.timeAdded)/a,d=t?(l-t.timeAdded)/a:-1,s=i.getSource(),r=n.coveringZoomLevel({tileSize:s.tileSize,roundZoom:s.roundZoom}),c=!t||Math.abs(t.tileID.overscaledZ-r)>Math.abs(e.tileID.overscaledZ-r),b=c&&e.refreshedUponExpiration?1:Mt(c?o:1-d,0,1);return e.refreshedUponExpiration&&o>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-b}:{opacity:b,mix:0}}return{opacity:1,mix:0}}class O2 extends Fa{constructor(t){let i={type:"raster-dem",maxzoom:t.transform.maxZoom},n=new Xo(dr(),null),a=CW("mock-dem",i,n,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,i){t.state="loaded",i(null)}}class D2 extends Fa{constructor(t){let i=CW("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Xo(dr(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,n){if(t.freezeTileCoverage)return;this.transform=t;let a=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((l,o)=>{if(l[o.key]="",!this._tiles[o.key]){let d=new Ks(o,this._source.tileSize*o.overscaleFactor(),t.tileZoom);d.state="loaded",this._tiles[o.key]=d}return l},{});for(let l in this._tiles)l in a||(this.freeFBO(l),this._tiles[l].unloadVectorData(),delete this._tiles[l])}freeFBO(t){let i=this.proxyCachedFBO[t];if(i!==void 0){let n=Object.values(i);this.renderCachePool.push(...n),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qG extends Xe{constructor(t,i,n){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=i,this.projMatrix=n}}class _2 extends YY{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[n,a,l]=function(s){let r=new Mn,c=new yi,b=131;r.reserve(17161),c.reserve(33800);let m=tt/128,h=tt+m/2,W=h+m;for(let Z=-m;Z<W;Z+=m)for(let g=-m;g<W;g+=m){let u=g<0||g>h||Z<0||Z>h?24575:0,G=Mt(Math.round(g),0,tt),F=Mt(Math.round(Z),0,tt);r.emplaceBack(G+u,F)}let p=(Z,g)=>{let u=g*b+Z;c.emplaceBack(u+1,u,u+b),c.emplaceBack(u+b,u+b+1,u+1)};for(let Z=1;Z<129;Z++)for(let g=1;g<129;g++)p(g,Z);return[0,129].forEach(Z=>{for(let g=0;g<130;g++)p(g,Z),p(Z,g)}),[r,c,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(n,Ml.members),this.gridIndexBuffer=o.createIndexBuffer(a),this.gridSegments=ze.simpleSegment(0,0,n.length,a.length),this.gridNoSkirtSegments=ze.simpleSegment(0,0,n.length,l),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new D2(i.map),this.orthoMatrix=D.create(),D.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,tt,0,tt,0,1);let d=o.gl;this._overlapStencilMode=new ce({func:d.GEQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new O2(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,i,n){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let a=t.terrain.properties,l=t.terrain.drapeRenderMode===0,o=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ee.now();let d=t.terrain&&t.terrain.scope,s=a.get("source"),r=l?this._mockSourceCache:t.getSourceCache(s,d);if(!r)return void A("Couldn't find terrain source \"".concat(s,'".'));if(this.sourceCache=r,this._exaggeration=o?this.calculateExaggeration(i):a.get("exaggeration"),!i.projection.requiresDraping&&o&&this._exaggeration===0)return void this._disable();this.enabled=!0;let c=()=>{this.sourceCache.used&&A("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));let b=this.getScaledDemTileSize();this.sourceCache.update(i,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,c(),this._initializing=!0),c(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){let i=this._previousCameraAltitude,n=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=n;let a=i!=null?n-i:Number.MAX_VALUE;if(Math.abs(a)<2)return this._exaggeration;let l=t.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(l);let d=l-this._previousZoom,s=this._previousUpdateTimestamp,r=l;this._evaluationZoom!=null&&(r=this._evaluationZoom,Math.abs(l-r)>.5&&(d=.5*(l-r+d)),d*a<0&&(r+=d)),this._evaluationZoom=r;let c=o.getExaggeration(r),b=c===o.getExaggeration(Math.max(0,r-.1));if(b&&Math.abs(c-this._exaggeration)<.01)return c;let m=Math.min(.1,.00375*(this._updateTimestamp-s));return(b||c<.1||Math.abs(d)<1e-4)&&(m=Math.min(.2,4*m)),Pt(this._exaggeration,c,m)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=n._centerAltitude===0&&this.getAtPointOrZero(Re.fromLngLat(n.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let a=this.proxyCoords=i.getIds().map(s=>{let r=i.getTileByID(s).tileID;return r.projMatrix=n.calculateProjMatrix(r.toUnwrapped()),r});(function(s,r){let c=r.transform.pointCoordinate(r.transform.getCameraPoint()),b=new H(c.x,c.y);s.sort((m,h)=>{if(h.overscaledZ-m.overscaledZ)return h.overscaledZ-m.overscaledZ;let W=new H(m.canonical.x+(1<<m.canonical.z)*m.wrap,m.canonical.y),p=new H(h.canonical.x+(1<<h.canonical.z)*h.wrap,h.canonical.y),Z=b.mult(1<<m.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(W)-Z.distSqr(p)})})(a,this.painter);let l=this.proxyToSource||{};this.proxyToSource={},a.forEach(s=>{this.proxyToSource[s.key]={}}),this.terrainTileForTile={};let o=this._style._mergedSourceCaches;for(let s in o){let r=o[s];if(!r.used||(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,t[s],l),r.usedForTerrain))continue;let c=t[s];r.getSource().reparseOverscaled&&this._assignTerrainTiles(c)}this.proxiedCoords[i.id]=a.map(s=>new qG(s,s.key,this.orthoMatrix)),this._assignTerrainTiles(a),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(l),this.renderingToTexture=!1;let d={};this._visibleDemTiles=[];for(let s of this.proxyCoords){let r=this.terrainTileForTile[s.key];if(!r)continue;let c=r.tileID.key;c in d||(this._visibleDemTiles.push(r),d[c]=c)}}_assignTerrainTiles(t){this._initializing||t.forEach(i=>{if(this.terrainTileForTile[i.key])return;let n=this._findTileCoveringTileID(i,this.sourceCache);n&&(this.terrainTileForTile[i.key]=n)})}_prepareDEMTextures(){let t=this.painter.context,i=t.gl;for(let n in this.terrainTileForTile){let a=this.terrainTileForTile[n],l=a.dem;!l||a.demTexture&&!a.needsDEMTextureUpload||(t.activeTexture.set(i.TEXTURE1),wG(this.painter,a,l))}}_prepareDemTileUniforms(t,i,n,a){if(!i||i.demTexture==null)return!1;let l=t.tileID.canonical,o=Math.pow(2,i.tileID.canonical.z-l.z),d=a||"";return n["u_dem_tl".concat(d)]=[l.x*o%1,l.y*o%1],n["u_dem_scale".concat(d)]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){let n=new Yi({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new bi(t,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0,i=this._visibleDemTiles.reduce((n,a)=>{if(!a.dem)return n;let l=a.dem.tree.minimums[0];return l>0&&t++,n+l},0);return t?i/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);let n=this._getLoadedAreaMinimum(),[a,l]=(()=>{let d=new Ag({width:1,height:1},new Float32Array([n]));return[i.R32F,d]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(l,{premultiply:!1}):o=this._emptyDEMTexture=new bi(t,l,a,{premultiply:!1}),o}setupElevationDraw(t,i,n){let a=this.painter.context,l=a.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};o.u_exaggeration=this.exaggeration();let d=null,s=null,r=1;if(n&&n.morphing&&this._useVertexMorphing){let m=n.morphing.srcDemTile,h=n.morphing.dstDemTile;r=n.morphing.phase,m&&h&&(this._prepareDemTileUniforms(t,m,o,"_prev")&&(s=m),this._prepareDemTileUniforms(t,h,o)&&(d=h))}let c=m=>m&&m.demTexture&&this.painter.linearFloatFilteringSupported()?l.LINEAR:l.NEAREST,b=m=>{o.u_dem_size=m.size[0]===1?1:m.size[0]-2};if(s&&d)a.activeTexture.set(l.TEXTURE2),d.demTexture.bind(c(d),l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE4),s.demTexture.bind(c(s),l.CLAMP_TO_EDGE),d.demTexture&&b(d.demTexture),o.u_dem_lerp=r;else{d=this.terrainTileForTile[t.tileID.key],a.activeTexture.set(l.TEXTURE2);let m=this._prepareDemTileUniforms(t,d,o)?d.demTexture:this.emptyDEMTexture;m.bind(c(d),l.CLAMP_TO_EDGE),b(m)}if(a.activeTexture.set(l.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&d){let m=(1<<d.tileID.canonical.z)*He(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=m}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(a,o),this.painter.transform.projection.name==="globe"){let m=this.globeUniformValues(this.painter.transform,t.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(a,m)}}globeUniformValues(t,i,n){let a=t.projection;return{u_tile_tl_up:a.upVector(i,0,0),u_tile_tr_up:a.upVector(i,tt,0),u_tile_br_up:a.upVector(i,tt,tt),u_tile_bl_up:a.upVector(i,0,tt),u_tile_up_scale:n?Ic(1):a.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let i=this.painter,n=this.painter.context;t.length!==0&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(a,l,o,d,s){if(a.transform.projection.name==="globe")(function(r,c,b,m,h){let W=r.context,p=W.gl,Z,g,u=r.transform,G=Gg(r,W,u),F=(Q,y)=>{if(g===y)return;let z=[_G[y],"PROJECTION_GLOBE_VIEW"];G&&z.push("CUSTOM_ANTIALIASING");let E=r.isTileAffectedByFog(Q);Z=r.getOrCreateProgram("globeRaster",{defines:z,overrideFog:E}),g=y},R=r.colorModeForRenderPass(),I=new Ot(p.LEQUAL,Ot.ReadWrite,r.depthRangeFor3D);vd.update(h);let N=ug(u),Y=[Qi(u.center.lng),Li(u.center.lat)],X=r.globeSharedBuffers,J=[u.width*ee.devicePixelRatio,u.height*ee.devicePixelRatio],B=Float32Array.from(u.globeMatrix),C={useDenormalizedUpVectorScale:!0};{let Q=r.transform,y=KG(Q.zoom,c.exaggeration(),c.sourceCache._source.tileSize);g=-1;let z=p.TRIANGLES;for(let E of m){let O=b.getTile(E),f=ce.disabled,L=c.prevTerrainTileForTile[E.key],K=c.terrainTileForTile[E.key];DG(L,K)&&vd.newMorphing(E.key,L,K,h,250),W.activeTexture.set(p.TEXTURE0),O.texture&&O.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE);let q=vd.getMorphValuesForProxy(E.key),P=q?1:0;q&&Da(C,{morphing:{srcDemTile:q.from,dstDemTile:q.to,phase:xn(q.phase)}});let et=Uc(E.canonical),it=ZN(et.getCenter().lat),at=Fg(E.canonical,et,it,Q.worldSize/Q._pixelsPerMercatorPixel),$=Tl(jn(E.canonical)),ot=OG(Q.expandedFarZProjMatrix,B,N,$,Di(Q.zoom),Y,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,J,y,at);if(F(E,P),Z&&(c.setupElevationDraw(O,Z,C),r.uploadCommonUniforms(W,Z,E.toUnwrapped()),X)){let[Rt,Gt,Yt]=X.getGridBuffers(it,y!==0);Z.draw(r,z,I,f,R,me.backCCW,ot,"globe_raster",Rt,Gt,Yt)}}}if(X&&(r.renderDefaultNorthPole||r.renderDefaultSouthPole)){let Q=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];G&&Q.push("CUSTOM_ANTIALIASING"),Z=r.getOrCreateProgram("globeRaster",{defines:Q});for(let y of m){let{x:z,y:E,z:O}=y.canonical,f=E===0,L=E===(1<<O)-1,[K,q,P,et]=X.getPoleBuffers(O,!1);if(et&&(f||L)){let it=b.getTile(y);W.activeTexture.set(p.TEXTURE0),it.texture&&it.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE);let at=Rg(O,z,u),$=Tl(jn(y.canonical)),ot=(Rt,Gt)=>Rt.draw(r,p.TRIANGLES,I,ce.disabled,R,me.disabled,OG(u.expandedFarZProjMatrix,at,at,$,0,Y,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,J,0),"globe_pole_raster",Gt,P,et);c.setupElevationDraw(it,Z,C),r.uploadCommonUniforms(W,Z,y.toUnwrapped()),f&&r.renderDefaultNorthPole&&ot(Z,K),L&&r.renderDefaultSouthPole&&(at=D.scale(D.create(),at,[1,-1,1]),ot(Z,q))}}}})(a,l,o,d,s);else{let r=a.context,c=r.gl,b,m,h=a.shadowRenderer,W=Qd(a,a.longestCutoffRange),p=R=>{if(m===R)return;let I=[];I.push(_G[R]),W.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),b=a.getOrCreateProgram("terrainRaster",{defines:I}),m=R},Z=a.colorModeForRenderPass(),g=new Ot(c.LEQUAL,Ot.ReadWrite,a.depthRangeFor3D);vd.update(s);let u=a.transform,G=KG(u.zoom,l.exaggeration(),l.sourceCache._source.tileSize),F=[0,0,0];if(h){let R=a.style.directionalLight,I=a.style.ambientLight;R&&I&&(F=HW(R,I))}{m=-1;let R=c.TRIANGLES,[I,N]=[l.gridIndexBuffer,l.gridSegments];for(let Y of d){let X=o.getTile(Y),J=ce.disabled,B=l.prevTerrainTileForTile[Y.key],C=l.terrainTileForTile[Y.key];DG(B,C)&&vd.newMorphing(Y.key,B,C,s,250),r.activeTexture.set(c.TEXTURE0),X.texture&&X.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE);let Q=vd.getMorphValuesForProxy(Y.key),y=Q?1:0,z;Q&&(z={morphing:{srcDemTile:Q.from,dstDemTile:Q.to,phase:xn(Q.phase)}});let E=HG(Y.projMatrix,H2(Y.canonical,u.renderWorldCopies)?G/10:G,F);if(p(y),!b)continue;l.setupElevationDraw(X,b,z);let O=Y.toUnwrapped();h&&h.setupShadows(O,b),a.uploadCommonUniforms(r,b,O,null,W),b.draw(a,R,g,J,Z,me.backCCW,E,"terrain_raster",l.gridBuffer,I,N)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let i=this.painter,n=this.painter.context,a=this.proxySourceCache,l=this.proxiedCoords[a.id],o=this._drapedRenderBatches.shift(),d=i.style.order,s=[],r=0;for(let c of l){let b=a.getTileByID(c.proxyTileKey),m=a.proxyCachedFBO[c.key]?a.proxyCachedFBO[c.key][t]:void 0,h=m!==void 0?a.renderCache[m]:this.pool[r++],W=m!==void 0;if(b.texture=h.tex,W&&!h.dirty){s.push(b.tileID);continue}let p;n.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(n.clear({color:re.transparent,stencil:0}),h.dirty=!1);for(let Z=o.start;Z<=o.end;++Z){let g=i.style._mergedLayers[d[Z]];if(g.isHidden(i.transform.zoom))continue;let u=i.style.getLayerSourceCache(g),G=u?this.proxyToSource[c.key][u.id]:[c];if(!G)continue;let F=G;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(u?u.id:null)&&(this._setupStencil(h,G,g,u),p=u?u.id:null),i.renderLayer(i,u,g,F)}if(this._drapedRenderBatches.length===0)for(let Z of this._pendingGroundEffectLayers){let g=i.style._mergedLayers[d[Z]];if(g.isHidden(i.transform.zoom))continue;let u=i.style.getLayerSourceCache(g),G=u?this.proxyToSource[c.key][u.id]:[c];if(!G)continue;let F=G;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(u?u.id:null)&&(this._setupStencil(h,G,g,u),p=u?u.id:null),i.renderLayer(i,u,g,F)}this.renderedToTile?(h.dirty=!0,s.push(b.tileID)):W||--r,r===5&&(r=0,this.renderToBackBuffer(s))}return this.renderToBackBuffer(s),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),o.end+1}postRender(){}isLayerOrderingCorrect(t){let i=t.order.length,n=-1,a=i;for(let l=0;l<i;++l)this._style.isLayerDraped(t._mergedLayers[t.order[l]])?n=Math.max(n,l):a=Math.min(a,l);return a>n}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(i=>i.dem).forEach(i=>{t=Math.min(t,i.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,i,n){if(!this._visibleDemTiles)return null;let a=this._visibleDemTiles.filter(l=>l.dem).map(l=>{let o=l.tileID,d=1<<o.overscaledZ,{x:s,y:r}=o.canonical,c=s/d,b=(s+1)/d,m=r/d,h=(r+1)/d;return{minx:c,miny:m,maxx:b,maxy:h,t:l.dem.tree.raycastRoot(c,m,b,h,t,i,n),tile:l}});a.sort((l,o)=>(l.t!==null?l.t:Number.MAX_VALUE)-(o.t!==null?o.t:Number.MAX_VALUE));for(let l of a){if(l.t==null)return null;let o=l.tile.dem.tree.raycast(l.minx,l.miny,l.maxx,l.maxy,t,i,n);if(o!=null)return o}return null}_createFBO(){let t=this.painter.context,i=t.gl,n=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);let a=new bi(t,{width:n[0],height:n[1],data:null},i.RGBA);a.bind(i.LINEAR,i.CLAMP_TO_EDGE);let l=t.createFramebuffer(n[0],n[1],!0,null);return l.colorAttachment.set(a.texture),l.depthAttachment=new iJ(t,l.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,l.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):l.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:l,tex:a,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let i=this._style._mergedLayers[t],n=i.isHidden(this.painter.transform.zoom);return i.type==="custom"?!n&&i.shouldRedrape():!n&&i.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let n of this._style.getSources())if(n instanceof rG){t=!0;break}if(!t)return;let i={};for(let n=0;n<this._style.order.length;++n){let a=this._style._mergedLayers[this._style.order[n]],l=this._style.getLayerSourceCache(a);if(l&&!i[l.id]&&!a.isHidden(this.painter.transform.zoom)&&a.type==="line"&&a.widthExpression()instanceof Ul){i[l.id]=!0;for(let o of this.proxyCoords){let d=this.proxyToSource[o.key][l.id];if(d)for(let s of d)this._clearRenderCacheForTile(l.id,s)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n]._source instanceof FW){t=!0;break}if(!t)return;let i={};for(let n=0;n<this._style.order.length;++n){let a=this._style._mergedLayers[this._style.order[n]],l=this._style.getLayerSourceCache(a);if(!l||i[l.id]||a.isHidden(this.painter.transform.zoom)||a.type!=="raster")continue;let o=a.paint.get("raster-fade-duration");for(let d of this.proxyCoords){let s=this.proxyToSource[d.key][l.id];if(s)for(let r of s){let c=PG(l.getTile(r),l.findLoadedParent(r,0),l,this.painter.transform,o);(c.opacity!==1||c.mix!==0)&&this._clearRenderCacheForTile(l.id,r)}}}}_setupDrapedRenderBatches(){let t=this._style.order,i=t.length;if(i===0)return;let n=[];this._pendingGroundEffectLayers=[];let a,l=0,o=this._style._mergedLayers[t[l]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++l<i;)o=this._style._mergedLayers[t[l]];for(;l<i;++l){let d=this._style._mergedLayers[t[l]];d.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(d)?a===void 0&&(a=l):(d.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(l),a!==void 0&&(n.push({start:a,end:l-1}),a=void 0)))}if(a!==void 0&&n.push({start:a,end:l-1}),n.length!==0){let d=n[n.length-1];this._pendingGroundEffectLayers.every(r=>r>d.end)||A("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(t){let i=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,i.renderCache.length>i.renderCachePool.length){let o=Object.values(i.proxyCachedFBO);i.proxyCachedFBO={};for(let d=0;d<o.length;++d){let s=Object.values(o[d]);i.renderCachePool.push(...s)}}return}this._clearRasterLayersFromRenderCache();let n=this.proxyCoords,a=this._tilesDirty;for(let o=n.length-1;o>=0;o--){let d=n[o];if(i.getTileByID(d.key),i.proxyCachedFBO[d.key]!==void 0){let s=t[d.key],r=this.proxyToSource[d.key],c=0;for(let b in r){let m=r[b],h=s[b];if(!h||h.length!==m.length||m.some((W,p)=>W!==h[p]||a[b]&&a[b].hasOwnProperty(W.key))){c=-1;break}++c}for(let b in i.proxyCachedFBO[d.key])i.renderCache[i.proxyCachedFBO[d.key][b]].dirty=c<0||c!==Object.values(s).length}}let l=[...this._drapedRenderBatches];l.sort((o,d)=>d.end-d.start-(o.end-o.start));for(let o of l)for(let d of n){if(i.proxyCachedFBO[d.key])continue;let s=i.renderCachePool.pop();s===void 0&&i.renderCache.length<50&&(s=i.renderCache.length,i.renderCache.push(this._createFBO())),s!==void 0&&(i.proxyCachedFBO[d.key]={},i.proxyCachedFBO[d.key][o.start]=s,i.renderCache[s].dirty=!0)}this._tilesDirty={}}_setupStencil(t,i,n,a){if(!a||!this._sourceTilesOverlap[a.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let l=this.painter.context,o=l.gl;if(i.length<=1)return void(this._overlapStencilType=!1);let d;if(n.isTileClipped())d=i.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(i[0].overscaledZ>i[i.length-1].overscaledZ))return void(this._overlapStencilType=!1);d=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+d>255&&(l.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=d,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(i,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ce.disabled}_renderTileClippingMasks(t,i){let n=this.painter,a=this.painter.context,l=a.gl;n._tileClippingMaskIDs={},a.setColorMode(Ne.disabled),a.setDepthMode(Ot.disabled);let o=n.getOrCreateProgram("clippingMask");for(let d of t){let s=n._tileClippingMaskIDs[d.key]=--i;o.draw(n,l.TRIANGLES,Ot.disabled,new ce({func:l.ALWAYS,mask:0},s,255,l.KEEP,l.KEEP,l.REPLACE),Ne.disabled,me.disabled,LW(d.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){let i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;let n=[t.x,t.y,1,1];Le.transformMat4(n,n,i.pixelMatrixInverse),Le.scale(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;let a=i._camera.position,l=He(1,i.center.lat),o=[a[0],a[1],a[2]/l,0],d=S.subtract([],n.slice(0,3),o);S.normalize(d,d);let s=this.raycast(o,d,this._exaggeration);return s!==null&&s?(S.scaleAndAdd(o,o,d,s),o[3]=o[2],o[2]*=l,o):null}drawDepth(){let t=this.painter,i=t.context,n=this.proxySourceCache,a=Math.ceil(t.width),l=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===a&&this._depthFBO.height===l||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let o=i.gl,d=i.createFramebuffer(a,l,!0,"renderbuffer");i.activeTexture.set(o.TEXTURE0);let s=new bi(i,{width:a,height:l,data:null},o.RGBA);s.bind(o.NEAREST,o.CLAMP_TO_EDGE),d.colorAttachment.set(s.texture);let r=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,a,l);d.depthAttachment.set(r),this._depthFBO=d,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,a,l]),function(o,d,s,r){if(o.transform.projection.name==="globe")return;let c=o.context,b=c.gl;c.clear({depth:1});let m=o.getOrCreateProgram("terrainDepth"),h=new Ot(b.LESS,Ot.ReadWrite,o.depthRangeFor3D);for(let W of r){let p=s.getTile(W),Z=HG(W.projMatrix,0,[0,0,0]);d.setupElevationDraw(p,m),m.draw(o,b.TRIANGLES,h,ce.disabled,Ne.unblended,me.backCCW,Z,"terrain_depth",d.gridBuffer,d.gridIndexBuffer,d.gridNoSkirtSegments)}}(t,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,i,n){if(t.getSource()instanceof oa)return this._setupProxiedCoordsForImageSource(t,i,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let a=this.proxiedCoords[t.id]=[],l=this.proxyCoords;for(let d=0;d<l.length;d++){let s=l[d],r=this._findTileCoveringTileID(s,t);if(r){let c=this._createProxiedId(s,r,n[s.key]&&n[s.key][t.id]);a.push(c),this.proxyToSource[s.key][t.id]=[c]}}let o=!1;for(let d=0;d<i.length;d++){let s=t.getTile(i[d]);if(!s||!s.hasData())continue;let r=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(r&&r.tileID.canonical.z!==s.tileID.canonical.z){let c=this.proxyToSource[r.tileID.key][t.id],b=this._createProxiedId(r.tileID,s,n[r.tileID.key]&&n[r.tileID.key][t.id]);c?c.splice(c.length-1,0,b):this.proxyToSource[r.tileID.key][t.id]=[b],a.push(b),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(t,i,n){if(!t.getSource().loaded())return;let a=this.proxiedCoords[t.id]=[],l=this.proxyCoords,o=t.getSource(),d=o.tileID;if(!d)return;let s=new H(d.x,d.y)._div(1<<d.z),r=o.coordinates.map(Re.fromLngLat).reduce((b,m)=>(b.min.x=Math.min(b.min.x,m.x-s.x),b.min.y=Math.min(b.min.y,m.y-s.y),b.max.x=Math.max(b.max.x,m.x-s.x),b.max.y=Math.max(b.max.y,m.y-s.y),b),{min:new H(Number.MAX_VALUE,Number.MAX_VALUE),max:new H(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(b,m)=>{let h=b.wrap+b.canonical.x/(1<<b.canonical.z),W=b.canonical.y/(1<<b.canonical.z),p=tt/(1<<b.canonical.z),Z=m.wrap+m.canonical.x/(1<<m.canonical.z),g=m.canonical.y/(1<<m.canonical.z);return h+p<Z+r.min.x||h>Z+r.max.x||W+p<g+r.min.y||W>g+r.max.y};for(let b=0;b<l.length;b++){let m=l[b];for(let h=0;h<i.length;h++){let W=t.getTile(i[h]);if(!W||!W.hasData()||c(m,W.tileID))continue;let p=this._createProxiedId(m,W,n[m.key]&&n[m.key][t.id]),Z=this.proxyToSource[m.key][t.id];Z?Z.push(p):this.proxyToSource[m.key][t.id]=[p],a.push(p)}}}_createProxiedId(t,i,n){let a=this.orthoMatrix;if(n){let l=n.find(o=>o.key===i.tileID.key);if(l)return l}if(i.tileID.key!==t.key){let l=t.canonical.z-i.tileID.canonical.z,o,d,s;a=D.create();let r=i.tileID.wrap-t.wrap<<t.overscaledZ;l>0?(o=tt>>l,d=o*((i.tileID.canonical.x<<l)-t.canonical.x+r),s=o*((i.tileID.canonical.y<<l)-t.canonical.y)):(o=tt<<-l,d=tt*(i.tileID.canonical.x-(t.canonical.x+r<<-l)),s=tt*(i.tileID.canonical.y-(t.canonical.y<<-l))),D.ortho(a,0,o,0,o,0,1),D.translate(a,a,[d,s,0])}return new qG(i.tileID,t.key,a)}_findTileCoveringTileID(t,i){let n=i.getTile(t);if(n&&n.hasData())return n;let a=this._findCoveringTileCache[i.id],l=a[t.key];if(n=l?i.getTileByID(l):null,n&&n.hasData()||l===null)return n;let o=n?n.tileID:t,d=o.overscaledZ,s=i.getSource().minzoom,r=[];if(!l){let b=i.getSource().maxzoom;if(t.canonical.z>=b){let m=t.canonical.z-b;i.getSource().reparseOverscaled?(d=Math.max(t.canonical.z+2,i.transform.tileZoom),o=new Xe(d,t.wrap,b,t.canonical.x>>m,t.canonical.y>>m)):m!==0&&(d=b,o=new Xe(d,t.wrap,b,t.canonical.x>>m,t.canonical.y>>m))}o.key!==t.key&&(r.push(o.key),n=i.getTile(o))}let c=b=>{r.forEach(m=>{a[m]=b}),r.length=0};for(d-=1;d>=s&&(!n||!n.hasData());d--){n&&c(n.tileID.key);let b=o.calculateScaledKey(d);if(n=i.getTileByID(b),n&&n.hasData())break;let m=a[b];if(m===null)break;m===void 0?r.push(b):n=i.getTileByID(m)}return c(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,i){let n=this._tilesDirty[t];n||(n=this._tilesDirty[t]={}),n[i.key]=!0}}function K2(e,t,i){let n=function(d,s,r){let c=S.dot(s,d),b=S.dot(r,[.2126,.7152,.0722]),m=(W,p,Z)=>(1-Z)*W+Z*p,h=m(1-.3*Math.min(b,1),1,Math.min(c+1,1));return m(.92,1,Math.asin(Mt(s[2],-1,1))/Math.PI+.5)*h}(e,[0,0,1],t),a=[0,0,0];S.scale(a,i.slice(0,3),n);let l=[0,0,0];S.scale(l,t.slice(0,3),e[2]);let o=[0,0,0];return S.add(o,a,l),Ii(o)}let P2=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],q2=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class $G{static cacheKey(t,i,n,a){let l="".concat(i).concat(a?a.cacheKey:"");for(let o of n)t.usedDefines.includes(o)&&(l+="/".concat(o));return l}constructor(t,i,n,a,l,o){let d=t.gl;this.program=d.createProgram(),this.configuration=a,this.name=i,this.fixedDefines=[...o];let s=a?a.getBinderAttributes():[],r=(n.staticAttributes||[]).concat(s),c=a?a.defines():[];c=c.concat(o.map(Z=>"#define ".concat(Z)));let b="#version 300 es\n",m=b+c.concat("precision mediump float;",EG,LG.fragmentSource).join("\n");for(let Z of n.fragmentIncludes)m+="\n".concat(Xb[Z]);m+="\n".concat(n.fragmentSource);let h=b+c.concat("precision highp float;",EG,LG.vertexSource).join("\n");for(let Z of n.vertexIncludes)h+="\n".concat(Xb[Z]);h+="\n".concat(n.vertexSource);let W=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);d.shaderSource(W,m),d.compileShader(W),d.attachShader(this.program,W);let p=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())this.failedToCreate=!0;else{d.shaderSource(p,h),d.compileShader(p),d.attachShader(this.program,p),this.attributes={},this.numAttributes=r.length;for(let Z=0;Z<this.numAttributes;Z++)if(r[Z]){let g=r[Z].startsWith("a_")?r[Z]:"a_".concat(r[Z]);d.bindAttribLocation(this.program,Z,g),this.attributes[g]=Z}d.linkProgram(this.program),d.deleteShader(p),d.deleteShader(W),this.fixedUniforms=l(t),this.binderUniforms=a?a.getUniforms(t):[],o.includes("TERRAIN")&&(this.terrainUniforms=(Z=>({u_dem:new he(Z),u_dem_prev:new he(Z),u_dem_tl:new We(Z),u_dem_scale:new st(Z),u_dem_tl_prev:new We(Z),u_dem_scale_prev:new st(Z),u_dem_size:new st(Z),u_dem_lerp:new st(Z),u_exaggeration:new st(Z),u_depth:new he(Z),u_depth_size_inv:new We(Z),u_meter_to_dem:new st(Z),u_label_plane_matrix_inv:new ie(Z)}))(t)),o.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new ae(Z),u_tile_tr_up:new ae(Z),u_tile_br_up:new ae(Z),u_tile_bl_up:new ae(Z),u_tile_up_scale:new st(Z)}))(t)),o.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new ie(Z),u_fog_range:new We(Z),u_fog_color:new Cn(Z),u_fog_horizon_blend:new st(Z),u_fog_vertical_limit:new We(Z),u_fog_temporal_offset:new st(Z),u_frustum_tl:new ae(Z),u_frustum_tr:new ae(Z),u_frustum_br:new ae(Z),u_frustum_bl:new ae(Z),u_globe_pos:new ae(Z),u_globe_radius:new st(Z),u_globe_transition:new st(Z),u_is_globe:new he(Z),u_viewport:new We(Z)}))(t)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new Cn(Z)}))(t)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new ae(Z),u_lighting_directional_dir:new ae(Z),u_lighting_directional_color:new ae(Z),u_ground_radiance:new ae(Z)}))(t)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new ie(Z),u_light_matrix_1:new ie(Z),u_fade_range:new We(Z),u_shadow_normal_offset:new ae(Z),u_shadow_intensity:new st(Z),u_shadow_texel_size:new st(Z),u_shadow_map_resolution:new st(Z),u_shadow_direction:new ae(Z),u_shadow_bias:new ae(Z),u_shadowmap_0:new he(Z),u_shadowmap_1:new he(Z)}))(t))}}setTerrainUniformValues(t,i){if(!this.terrainUniforms)return;let n=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let a in i)n[a]&&n[a].set(this.program,a,i[a])}}setGlobeUniformValues(t,i){if(!this.globeUniforms)return;let n=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let a in i)n[a]&&n[a].set(this.program,a,i[a])}}setFogUniformValues(t,i){if(!this.fogUniforms)return;let n=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let a in i)n[a].set(this.program,a,i[a])}}setCutoffUniformValues(t,i){if(!this.cutoffUniforms)return;let n=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let a in i)n[a].set(this.program,a,i[a])}}setLightsUniformValues(t,i){if(!this.lightsUniforms)return;let n=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let a in i)n[a].set(this.program,a,i[a])}}setShadowUniformValues(t,i){if(this.failedToCreate||!this.shadowUniforms)return;let n=this.shadowUniforms;t.program.set(this.program);for(let a in i)n[a].set(this.program,a,i[a])}_drawDebugWireframe(t,i,n,a,l,o,d,s,r,c){let b=t.options.wireframe;if(b.terrain===!1&&b.layers2D===!1&&b.layers3D===!1)return;let m=t.context;if(!(!(!b.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!b.layers2D||t._terrain&&t._terrain.renderingToTexture||!P2.includes(this.name))||!(!b.layers3D||!q2.includes(this.name))))return;let h=m.gl,W=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,l,m);if(!W)return;let p=[...this.fixedDefines];p.push("DEBUG_WIREFRAME");let Z=t.getOrCreateProgram(this.name,{config:this.configuration,defines:p});m.program.set(Z.program);let g=(F,R,I)=>{if(R[F]&&I[F])for(let N in R[F])I[F][N]&&I[F][N].set(I.program,N,R[F][N].current)};r&&r.setUniforms(Z.program,m,Z.binderUniforms,d,{zoom:s}),g("fixedUniforms",this,Z),g("terrainUniforms",this,Z),g("globeUniforms",this,Z),g("fogUniforms",this,Z),g("lightsUniforms",this,Z),g("shadowUniforms",this,Z),W.bind(),m.setColorMode(new Ne([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.ZERO,h.ONE],re.transparent,[!0,!0,!0,!1])),m.setDepthMode(new Ot(i.func===h.LESS?h.LEQUAL:i.func,Ot.ReadOnly,i.range)),m.setStencilMode(ce.disabled);let u=3*o.primitiveLength*2,G=3*o.primitiveOffset*2*2;c&&c>1?h.drawElementsInstanced(h.LINES,u,h.UNSIGNED_SHORT,G,c):h.drawElements(h.LINES,u,h.UNSIGNED_SHORT,G),l.bind(),m.program.set(this.program),m.setDepthMode(i),m.setStencilMode(n),m.setColorMode(a)}draw(t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z){let g=t.context,u=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(a),g.setColorMode(l),g.setCullFace(o);for(let R of Object.keys(this.fixedUniforms))this.fixedUniforms[R].set(this.program,R,d[R]);W&&W.setUniforms(this.program,g,this.binderUniforms,m,{zoom:h});let G={[u.LINES]:2,[u.TRIANGLES]:3,[u.LINE_STRIP]:1}[i],F=Z&&Z>0?1:void 0;for(let R of b.get()){let I=R.vaos||(R.vaos={});(I[s]||(I[s]=new E2)).bind(g,this,r,W?W.getPaintVertexBuffers():[],c,R.vertexOffset,p||[],F),Z&&Z>1?u.drawElementsInstanced(i,R.primitiveLength*G,u.UNSIGNED_SHORT,R.primitiveOffset*G*2,Z):u.drawElements(i,R.primitiveLength*G,u.UNSIGNED_SHORT,R.primitiveOffset*G*2),i===u.TRIANGLES&&this._drawDebugWireframe(t,n,a,l,c,R,m,h,W,Z)}}}function tF(e,t){let i=Math.pow(2,t.tileID.overscaledZ),n=t.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=n*(t.tileID.canonical.x+t.tileID.wrap*i),l=n*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/Uo(t,1,e.transform.tileZoom),u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}let $2=D.create(),eF=(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p)=>{let Z=t.style.light,g=Z.properties.get("position"),u=[g.x,g.y,g.z],G=Rn.create();Z.properties.get("anchor")==="viewport"&&(Rn.fromRotation(G,-t.transform.angle),S.transformMat3(u,u,G));let F=Z.properties.get("color"),R=t.transform,I={u_matrix:e,u_lightpos:u,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+i,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$2,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:l,u_flood_light_color:b,u_vertical_scale:m,u_flood_light_intensity:h,u_ground_shadow_factor:W,u_emissive_strength:p};return R.projection.name==="globe"&&(I.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],I.u_zoom_transition=s,I.u_inv_rot_matrix=c,I.u_merc_center=r,I.u_up_dir=R.projection.upVector(new ia(0,0,0),r[0]*tt,r[1]*tt),I.u_height_lift=d),I},ty=(e,t,i)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:i}),ey=(e,t,i,n,a,l,o,d,s,r,c,b,m,h)=>{let W=eF(e,t,i,n,a,l,o,s,r,c,b,m,h,1,[0,0,0],0),p={u_height_factor:-Math.pow(2,o.overscaledZ)/d.tileSize/8};return Xt(W,tF(t,d),p)},iF=(e,t)=>({u_matrix:e,u_emissive_strength:t}),nF=(e,t,i,n)=>Xt(iF(e,t),tF(i,n)),iy=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),ny=(e,t,i,n,a)=>Xt(nF(e,t,i,n),{u_world:a}),ay=(e,t,i,n)=>{let a=tt/i.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(n),u_extrude_scale:[t.pixelsToGLUnits[0]/a,t.pixelsToGLUnits[1]/a]}},aF=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),ly=D.create(),oy=(e,t,i,n,a,l,o)=>{let d=e.transform,s=d.projection.name==="globe",r=s?Vg(d.zoom,t.canonical)*d._pixelsPerMercatorPixel:Uo(i,1,l),c={u_matrix:t.projMatrix,u_extrude_scale:r,u_intensity:o,u_inv_rot_matrix:ly,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(s){c.u_inv_rot_matrix=n,c.u_merc_center=a,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Di(d.zoom);let b=a[0]*tt,m=a[1]*tt;c.u_up_dir=d.projection.upVector(new ia(0,0,0),b,m)}return c},lF=(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u,G,F,R)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:a,u_tl_parent:l,u_scale_parent:c,u_fade_t:b.mix,u_opacity:b.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(N=m.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(I=m.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:dy(m.paint.get("raster-hue-rotate")),u_perspective_transform:h,u_raster_elevation:W,u_tl_br:o,u_zoom_transition:d,u_merc_center:s,u_cutoff_params:r,u_colorization_mix:sy(Z,u),u_colorization_offset:ry(g,u),u_color_ramp:p,u_texture_offset:[F/(G+2*F),G/(G+2*F)],u_texture_res:[G+2*F,G+2*F],u_emissive_strength:R};var I,N};function dy(e){e*=Math.PI/180;let t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}function sy([e,t,i,n],[a,l]){if(a===l)return[0,0,0,0];let o=259/257/(l-a);return[e*o,t*o,i*o,n*o]}function ry(e,[t,i]){return t===i?0:((e-t)/(i-t)*259-1)/257}let oF=D.create(),dF=(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g)=>{let u=a.transform,G={u_is_size_zoom_constant:+(e==="constant"||e==="source"),u_is_size_feature_constant:+(e==="constant"||e==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:u.getCameraToCenterDistance(p),u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:l,u_label_plane_matrix:o,u_coord_matrix:d,u_is_text:+s,u_pitch_with_map:+n,u_texsize:r,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:oF,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:oF,u_up_vector:[0,-1,0],u_icon_transition:g||0,u_icon_saturation:Z};return p.name==="globe"&&(G.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],G.u_zoom_transition=b,G.u_inv_rot_matrix=h,G.u_merc_center=m,G.u_camera_forward=u._camera.forward(),G.u_ecef_origin=function(F,R){let I=[0,0,0],N=Tl(jn(R.canonical));return S.transformMat4(I,I,N),S.transformMat4(I,I,F),I}(u.globeMatrix,c.toUnwrapped()),G.u_tile_matrix=Float32Array.from(u.globeMatrix),G.u_up_vector=W),G},sF=(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z)=>Xt(dF(e,t,i,n,a,l,o,d,s,r,b,m,h,W,p,Z,1),{u_gamma_scale:n?a.transform.getCameraToCenterDistance(Z)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:ee.devicePixelRatio,u_is_halo:+c,undefined:void 0}),cy=(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p)=>Xt(sF(e,t,i,n,a,l,o,d,!0,s,!0,c,b,m,h,W,p),{u_texsize_icon:r,u_texture_icon:1}),by=(e,t,i,n)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:n}),my=(e,t,i,n,a,l,o)=>Xt(function(d,s,r,c){let b=r.imageManager.getPattern(d.toString(),s),{width:m,height:h}=r.imageManager.getPixelSize(s),W=Math.pow(2,c.tileID.overscaledZ),p=c.tileSize*Math.pow(2,r.transform.tileZoom)/W,Z=p*(c.tileID.canonical.x+c.tileID.wrap*W),g=p*c.tileID.canonical.y;return{u_image:0,u_pattern_tl:b.tl,u_pattern_br:b.br,u_texsize:[m,h],u_pattern_size:b.displaySize,u_tile_units_to_pixels:1/Uo(c,1,r.transform.tileZoom),u_pixel_coord_upper:[Z>>16,g>>16],u_pixel_coord_lower:[65535&Z,65535&g]}}(a,l,n,o),{u_matrix:e,u_emissive_strength:t,u_opacity:i}),Qn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},EW=(e,t,i,n,a,l,o,d,s,r,c,b,m=[0,0,0])=>{let h=n.style.light,W=h.properties.get("position"),p=[-W.x,-W.y,W.z],Z=Rn.create();h.properties.get("anchor")==="viewport"&&(Rn.fromRotation(Z,-n.transform.angle),S.transformMat3(p,p,Z));let g=r.alphaMode==="MASK",u=h.properties.get("color"),G=b.paint.get("model-ambient-occlusion-intensity"),F=b.paint.get("model-color").constantOr(re.white),R=b.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:i,u_lightpos:p,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_camera_pos:m,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+g,u_alphaCutoff:r.alphaCutoff,u_baseColorFactor:[l.r,l.g,l.b,l.a],u_emissiveFactor:[o[0],o[1],o[2],1],u_metallicFactor:d,u_roughnessFactor:s,u_baseColorTexture:Qn.BaseColor,u_metallicRoughnessTexture:Qn.MetallicRoughness,u_normalTexture:Qn.Normal,u_occlusionTexture:Qn.Occlusion,u_emissionTexture:Qn.Emission,u_color_mix:[F.r,F.g,F.b,R],u_aoIntensity:G,u_emissive_strength:c}},rF=new Float32Array(16),cF=(e,t=rF,i=rF)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),hy={fillExtrusion:e=>({u_matrix:new ie(e),u_lightpos:new ae(e),u_lightintensity:new st(e),u_lightcolor:new ae(e),u_vertical_gradient:new st(e),u_opacity:new st(e),u_edge_radius:new st(e),u_ao:new We(e),u_tile_id:new ae(e),u_zoom_transition:new st(e),u_inv_rot_matrix:new ie(e),u_merc_center:new We(e),u_up_dir:new ae(e),u_height_lift:new st(e),u_flood_light_color:new ae(e),u_vertical_scale:new st(e),u_flood_light_intensity:new st(e),u_ground_shadow_factor:new ae(e),u_emissive_strength:new st(e)}),fillExtrusionDepth:e=>({u_matrix:new ie(e),u_edge_radius:new st(e),u_vertical_scale:new st(e)}),fillExtrusionPattern:e=>({u_matrix:new ie(e),u_lightpos:new ae(e),u_lightintensity:new st(e),u_lightcolor:new ae(e),u_vertical_gradient:new st(e),u_height_factor:new st(e),u_edge_radius:new st(e),u_ao:new We(e),u_tile_id:new ae(e),u_zoom_transition:new st(e),u_inv_rot_matrix:new ie(e),u_merc_center:new We(e),u_up_dir:new ae(e),u_height_lift:new st(e),u_image:new he(e),u_texsize:new We(e),u_pixel_coord_upper:new We(e),u_pixel_coord_lower:new We(e),u_tile_units_to_pixels:new st(e),u_opacity:new st(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new ie(e),u_opacity:new st(e),u_ao_pass:new st(e),u_meter_to_tile:new st(e),u_ao:new We(e),u_flood_light_intensity:new st(e),u_flood_light_color:new ae(e),u_attenuation:new st(e),u_edge_radius:new st(e),u_fb:new he(e),u_fb_size:new st(e)}),fill:e=>({u_matrix:new ie(e),u_emissive_strength:new st(e)}),fillPattern:e=>({u_matrix:new ie(e),u_emissive_strength:new st(e),u_image:new he(e),u_texsize:new We(e),u_pixel_coord_upper:new We(e),u_pixel_coord_lower:new We(e),u_tile_units_to_pixels:new st(e)}),fillOutline:e=>({u_matrix:new ie(e),u_emissive_strength:new st(e),u_world:new We(e)}),fillOutlinePattern:e=>({u_matrix:new ie(e),u_emissive_strength:new st(e),u_world:new We(e),u_image:new he(e),u_texsize:new We(e),u_pixel_coord_upper:new We(e),u_pixel_coord_lower:new We(e),u_tile_units_to_pixels:new st(e)}),circle:e=>({u_camera_to_center_distance:new st(e),u_extrude_scale:new ih(e),u_device_pixel_ratio:new st(e),u_matrix:new ie(e),u_inv_rot_matrix:new ie(e),u_merc_center:new We(e),u_tile_id:new ae(e),u_zoom_transition:new st(e),u_up_dir:new ae(e),u_emissive_strength:new st(e)}),collisionBox:e=>({u_matrix:new ie(e),u_camera_to_center_distance:new st(e),u_extrude_scale:new We(e)}),collisionCircle:e=>({u_matrix:new ie(e),u_inv_matrix:new ie(e),u_camera_to_center_distance:new st(e),u_viewport_size:new We(e)}),debug:e=>({u_color:new Wd(e),u_matrix:new ie(e),u_overlay:new he(e),u_overlay_scale:new st(e)}),clippingMask:e=>({u_matrix:new ie(e)}),heatmap:e=>({u_extrude_scale:new st(e),u_intensity:new st(e),u_matrix:new ie(e),u_inv_rot_matrix:new ie(e),u_merc_center:new We(e),u_tile_id:new ae(e),u_zoom_transition:new st(e),u_up_dir:new ae(e)}),heatmapTexture:e=>({u_image:new he(e),u_color_ramp:new he(e),u_opacity:new st(e)}),hillshade:e=>({u_matrix:new ie(e),u_image:new he(e),u_latrange:new We(e),u_light:new We(e),u_shadow:new Wd(e),u_highlight:new Wd(e),u_emissive_strength:new st(e),u_accent:new Wd(e)}),hillshadePrepare:e=>({u_matrix:new ie(e),u_image:new he(e),u_dimension:new We(e),u_zoom:new st(e)}),line:e=>({u_matrix:new ie(e),u_pixels_to_tile_units:new ih(e),u_device_pixel_ratio:new st(e),u_units_to_pixels:new We(e),u_dash_image:new he(e),u_gradient_image:new he(e),u_image_height:new st(e),u_texsize:new We(e),u_tile_units_to_pixels:new st(e),u_alpha_discard_threshold:new st(e),u_trim_offset:new We(e),u_emissive_strength:new st(e)}),linePattern:e=>({u_matrix:new ie(e),u_texsize:new We(e),u_pixels_to_tile_units:new ih(e),u_device_pixel_ratio:new st(e),u_image:new he(e),u_units_to_pixels:new We(e),u_tile_units_to_pixels:new st(e),u_alpha_discard_threshold:new st(e)}),raster:e=>({u_matrix:new ie(e),u_normalize_matrix:new ie(e),u_globe_matrix:new ie(e),u_merc_matrix:new ie(e),u_grid_matrix:new eh(e),u_tl_parent:new We(e),u_scale_parent:new st(e),u_fade_t:new st(e),u_opacity:new st(e),u_image0:new he(e),u_image1:new he(e),u_brightness_low:new st(e),u_brightness_high:new st(e),u_saturation_factor:new st(e),u_contrast_factor:new st(e),u_spin_weights:new ae(e),u_perspective_transform:new We(e),u_raster_elevation:new st(e),u_tl_br:new Cn(e),u_zoom_transition:new st(e),u_merc_center:new We(e),u_cutoff_params:new Cn(e),u_colorization_mix:new Cn(e),u_colorization_offset:new st(e),u_color_ramp:new he(e),u_texture_offset:new We(e),u_texture_res:new We(e),u_emissive_strength:new st(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new he(e),u_is_size_feature_constant:new he(e),u_size_t:new st(e),u_size:new st(e),u_camera_to_center_distance:new st(e),u_rotate_symbol:new he(e),u_aspect_ratio:new st(e),u_fade_change:new st(e),u_matrix:new ie(e),u_label_plane_matrix:new ie(e),u_coord_matrix:new ie(e),u_is_text:new he(e),u_pitch_with_map:new he(e),u_texsize:new We(e),u_tile_id:new ae(e),u_zoom_transition:new st(e),u_inv_rot_matrix:new ie(e),u_merc_center:new We(e),u_camera_forward:new ae(e),u_tile_matrix:new ie(e),u_up_vector:new ae(e),u_ecef_origin:new ae(e),u_texture:new he(e),u_icon_transition:new st(e),u_icon_saturation:new st(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new he(e),u_is_size_feature_constant:new he(e),u_size_t:new st(e),u_size:new st(e),u_camera_to_center_distance:new st(e),u_rotate_symbol:new he(e),u_aspect_ratio:new st(e),u_fade_change:new st(e),u_matrix:new ie(e),u_label_plane_matrix:new ie(e),u_coord_matrix:new ie(e),u_is_text:new he(e),u_pitch_with_map:new he(e),u_texsize:new We(e),u_texture:new he(e),u_gamma_scale:new st(e),u_device_pixel_ratio:new st(e),u_tile_id:new ae(e),u_zoom_transition:new st(e),u_inv_rot_matrix:new ie(e),u_merc_center:new We(e),u_camera_forward:new ae(e),u_tile_matrix:new ie(e),u_up_vector:new ae(e),u_ecef_origin:new ae(e),u_is_halo:new he(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new he(e),u_is_size_feature_constant:new he(e),u_size_t:new st(e),u_size:new st(e),u_camera_to_center_distance:new st(e),u_rotate_symbol:new he(e),u_aspect_ratio:new st(e),u_fade_change:new st(e),u_matrix:new ie(e),u_label_plane_matrix:new ie(e),u_coord_matrix:new ie(e),u_is_text:new he(e),u_pitch_with_map:new he(e),u_texsize:new We(e),u_texsize_icon:new We(e),u_texture:new he(e),u_texture_icon:new he(e),u_gamma_scale:new st(e),u_device_pixel_ratio:new st(e),u_is_halo:new he(e)}),background:e=>({u_matrix:new ie(e),u_emissive_strength:new st(e),u_opacity:new st(e),u_color:new Wd(e)}),backgroundPattern:e=>({u_matrix:new ie(e),u_emissive_strength:new st(e),u_opacity:new st(e),u_image:new he(e),u_pattern_tl:new We(e),u_pattern_br:new We(e),u_texsize:new We(e),u_pattern_size:new We(e),u_pixel_coord_upper:new We(e),u_pixel_coord_lower:new We(e),u_tile_units_to_pixels:new st(e)}),terrainRaster:jG,terrainDepth:jG,skybox:e=>({u_matrix:new ie(e),u_sun_direction:new ae(e),u_cubemap:new he(e),u_opacity:new st(e),u_temporal_offset:new st(e)}),skyboxGradient:e=>({u_matrix:new ie(e),u_color_ramp:new he(e),u_center_direction:new ae(e),u_radius:new st(e),u_opacity:new st(e),u_temporal_offset:new st(e)}),skyboxCapture:e=>({u_matrix_3f:new eh(e),u_sun_direction:new ae(e),u_sun_intensity:new st(e),u_color_tint_r:new Cn(e),u_color_tint_m:new Cn(e),u_luminance:new st(e)}),globeRaster:e=>({u_proj_matrix:new ie(e),u_globe_matrix:new ie(e),u_normalize_matrix:new ie(e),u_merc_matrix:new ie(e),u_zoom_transition:new st(e),u_merc_center:new We(e),u_image0:new he(e),u_grid_matrix:new eh(e),u_skirt_height:new st(e),u_frustum_tl:new ae(e),u_frustum_tr:new ae(e),u_frustum_br:new ae(e),u_frustum_bl:new ae(e),u_globe_pos:new ae(e),u_globe_radius:new st(e),u_viewport:new We(e)}),globeAtmosphere:e=>({u_frustum_tl:new ae(e),u_frustum_tr:new ae(e),u_frustum_br:new ae(e),u_frustum_bl:new ae(e),u_horizon:new st(e),u_transition:new st(e),u_fadeout_range:new st(e),u_color:new Cn(e),u_high_color:new Cn(e),u_space_color:new Cn(e),u_temporal_offset:new st(e),u_horizon_angle:new st(e)}),model:e=>({u_matrix:new ie(e),u_lighting_matrix:new ie(e),u_normal_matrix:new ie(e),u_lightpos:new ae(e),u_lightintensity:new st(e),u_lightcolor:new ae(e),u_camera_pos:new ae(e),u_opacity:new st(e),u_baseColorFactor:new Cn(e),u_emissiveFactor:new Cn(e),u_metallicFactor:new st(e),u_roughnessFactor:new st(e),u_baseTextureIsAlpha:new he(e),u_alphaMask:new he(e),u_alphaCutoff:new st(e),u_baseColorTexture:new he(e),u_metallicRoughnessTexture:new he(e),u_normalTexture:new he(e),u_occlusionTexture:new he(e),u_emissionTexture:new he(e),u_color_mix:new Cn(e),u_aoIntensity:new st(e),u_emissive_strength:new st(e)}),modelDepth:e=>({u_matrix:new ie(e),u_instance:new ie(e),u_node_matrix:new ie(e)}),groundShadow:e=>({u_matrix:new ie(e),u_ground_shadow_factor:new ae(e)}),stars:e=>({u_matrix:new ie(e),u_up:new ae(e),u_right:new ae(e),u_intensity_multiplier:new st(e)})},Bb;function bF(e,t,i,n,a,l,o){let d=e.context,s=d.gl,r=e.transform,c=e.getOrCreateProgram("collisionBox"),b=[],m=0,h=0;for(let F=0;F<n.length;F++){let R=n[F],I=t.getTile(R),N=I.getBucket(i);if(!N)continue;let Y=U2(R,N,r),X=Y;a[0]===0&&a[1]===0||(X=e.translatePosMatrix(Y,I,a,l));let J=o?N.textCollisionBox:N.iconCollisionBox,B=N.collisionCircleArray;if(B.length>0){let C=D.create(),Q=X;D.mul(C,N.placementInvProjMatrix,r.glCoordMatrix),D.mul(C,C,N.placementViewportMatrix),b.push({circleArray:B,circleOffset:h,transform:Q,invTransform:C,projection:N.getProjection()}),m+=B.length/4,h=m}J&&(e.terrain&&e.terrain.setupElevationDraw(I,c),c.draw(e,s.LINES,Ot.disabled,ce.disabled,e.colorModeForRenderPass(),me.disabled,ay(X,r,I,N.getProjection()),i.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,null,r.zoom,null,[J.collisionVertexBuffer,J.collisionVertexBufferExt]))}if(!o||!b.length)return;let W=e.getOrCreateProgram("collisionCircle"),p=new w0;p.resize(4*m),p._trim();let Z=0;for(let F of b)for(let R=0;R<F.circleArray.length/4;R++){let I=4*R,N=F.circleArray[I+0],Y=F.circleArray[I+1],X=F.circleArray[I+2],J=F.circleArray[I+3];p.emplace(Z++,N,Y,X,J,0),p.emplace(Z++,N,Y,X,J,1),p.emplace(Z++,N,Y,X,J,2),p.emplace(Z++,N,Y,X,J,3)}(!Bb||Bb.length<2*m)&&(Bb=function(F){let R=2*F,I=new yi;I.resize(R),I._trim();for(let N=0;N<R;N++){let Y=6*N;I.uint16[Y+0]=4*N+0,I.uint16[Y+1]=4*N+1,I.uint16[Y+2]=4*N+2,I.uint16[Y+3]=4*N+2,I.uint16[Y+4]=4*N+3,I.uint16[Y+5]=4*N+0}return I}(m));let g=d.createIndexBuffer(Bb,!0),u=d.createVertexBuffer(p,SY.members,!0);for(let F of b){let R={u_matrix:F.transform,u_inv_matrix:F.invTransform,u_camera_to_center_distance:(G=r).getCameraToCenterDistance(F.projection),u_viewport_size:[G.width,G.height]};W.draw(e,s.TRIANGLES,Ot.disabled,ce.disabled,e.colorModeForRenderPass(),me.disabled,R,i.id,u,g,ze.simpleSegment(0,2*F.circleOffset,F.circleArray.length,F.circleArray.length/2),null,r.zoom)}var G;u.destroy(),g.destroy()}let mF=D.create();function Wy({width:e,height:t,anchor:i,textOffset:n,textScale:a},l){let{horizontalAlign:o,verticalAlign:d}=Hc(i),s=-(o-.5)*e,r=-(d-.5)*t,c=$h(i,n);return new H((s/a+c[0])*l,(r/a+c[1])*l)}function py(e,t,i,n,a,l,o,d,s,r,c){let b=e.text.placedSymbolArray,m=e.text.dynamicLayoutVertexArray,h=e.icon.dynamicLayoutVertexArray,W={},p=e.getProjection(),Z=kW(d,p,l),g=l.elevation,u=p.upVectorScale(d.canonical,l.center.lat,l.worldSize).metersToTile;m.clear();for(let G=0;G<b.length;G++){let F=b.get(G),{tileAnchorX:R,tileAnchorY:I,numGlyphs:N}=F,Y=F.hidden||!F.crossTileID||e.allowVerticalPlacement&&!F.placedOrientation?null:n[F.crossTileID];if(Y){let X=0,J=0,B=0;if(g){let K=g?g.getAtTileOffset(d,R,I):0,[q,P,et]=p.upVector(d.canonical,R,I);X=K*q*u,J=K*P*u,B=K*et*u}let[C,Q,y,z]=Ia(F.projectedAnchorX+X,F.projectedAnchorY+J,F.projectedAnchorZ+B,i?Z:o),E=iR(l.getCameraToCenterDistance(p),z),O=a.evaluateSizeForFeature(e.textSizeData,r,F)*E/_i;i&&(O*=e.tilePixelRatio/s);let f=Wy(Y,O);i?({x:C,y:Q,z:y}=p.projectTilePoint(R+f.x,I+f.y,d.canonical),[C,Q,y]=Ia(C+X,Q+J,y+B,o)):(t&&f._rotate(-l.angle),C+=f.x,Q+=f.y,y=0);let L=e.allowVerticalPlacement&&F.placedOrientation===di.vertical?Math.PI/2:0;for(let K=0;K<N;K++)Md(m,C,Q,y,L);c&&F.associatedIconIndex>=0&&(W[F.associatedIconIndex]={x:C,y:Q,z:y,angle:L})}else Td(N,m)}if(c){h.clear();let G=e.icon.placedSymbolArray;for(let F=0;F<G.length;F++){let R=G.get(F),{numGlyphs:I}=R,N=W[F];if(R.hidden||!N)Td(I,h);else{let{x:Y,y:X,z:J,angle:B}=N;for(let C=0;C<I;C++)Md(h,Y,X,J,B)}}e.icon.dynamicLayoutVertexBuffer.updateData(h)}e.text.dynamicLayoutVertexBuffer.updateData(m)}function Zy(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function hF(e,t,i,n,a,l,o,d,s,r,c,b,m){let h=e.context,W=h.gl,p=e.transform,Z=d==="map",g=s==="map",u=Z&&i.layout.get("symbol-placement")!=="point",G=Z&&!g&&!u,F=i.layout.get("symbol-sort-key").constantOr(1)!==void 0,R=!1,I=e.depthModeForSublayer(0,Ot.ReadOnly),N=[Qi(p.center.lng),Li(p.center.lat)],Y=i.layout.get("text-variable-anchor"),X=p.projection.name==="globe",J=[],B=[0,-1,0],C=B;!X&&!p.mercatorFromTransition||Z||(C=function(Q){let y=Q._camera.getWorldToCamera(Q.worldSize,1),z=D.multiply([],y,Q.globeMatrix);D.invert(z,z);let E=[0,0,0],O=[0,1,0,0];return Le.transformMat4(O,O,z),E[0]=O[0],E[1]=O[1],E[2]=O[2],S.normalize(E,E),E}(p));for(let Q of n){let y=t.getTile(Q),z=y.getBucket(i);if(!z||z.projection.name==="mercator"&&X)continue;let E=a?z.text:z.icon;if(!E||z.fullyClipped||!E.segments.get().length)continue;let O=E.programConfigurations.get(i.id),f=a||z.sdfIcons,L=a?z.textSizeData:z.iconSizeData,K=g||p.pitch!==0,q=ka(L,p.zoom),P,et,it,at,$=[0,0],ot=null;if(a)et=y.glyphAtlasTexture?y.glyphAtlasTexture:null,it=W.LINEAR,P=y.glyphAtlasTexture?y.glyphAtlasTexture.size:[0,0],z.iconsInText&&($=y.imageAtlasTexture?y.imageAtlasTexture.size:[0,0],ot=y.imageAtlasTexture?y.imageAtlasTexture:null,at=K||e.options.rotating||e.options.zooming||L.kind==="composite"||L.kind==="camera"?W.LINEAR:W.NEAREST);else{let ai=i.layout.get("icon-size").constantOr(0)!==1||z.iconsNeedLinear;et=y.imageAtlasTexture?y.imageAtlasTexture:null,it=f||e.options.rotating||e.options.zooming||ai||K?W.LINEAR:W.NEAREST,P=y.imageAtlasTexture?y.imageAtlasTexture.size:[0,0]}let Rt=z.projection.name==="globe",Gt=Rt?C:B,Yt=Rt?Di(p.zoom):0,Bt=kW(Q,z.getProjection(),p),Dt=p.calculatePixelsToTileUnitsMatrix(y),ft=bb(Bt,y.tileID.canonical,g,Z,p,z.getProjection(),Dt),xe=e.terrain&&g&&u?D.invert(D.create(),ft):mF,pe=eR(Bt,y.tileID.canonical,g,Z,p,z.getProjection(),Dt),_t=Y&&z.hasTextData(),jt=z.hasIconTextFit()&&_t&&z.hasIconData();if(u){let ai=p.elevation,Se=ai?ai.getAtTileOffsetFunc(Q,p.center.lat,p.worldSize,z.getProjection()):null,qi=tR(Bt,y.tileID.canonical,g,Z,p,z.getProjection(),Dt);WJ(z,Bt,e,a,qi,pe,g,r,Se,Q)}let zt=u||a&&Y||jt,ge=e.translatePosMatrix(Bt,y,l,o),Ie=zt?mF:ft,se=e.translatePosMatrix(pe,y,l,o,!0),Oe=z.getProjection().createInversionMatrix(p,Q.canonical),Ri=i.paint.get("icon-image-cross-fade").constantOr(0),Ee=[];e.terrainRenderModeElevated()&&g&&Ee.push("PITCH_WITH_MAP_TERRAIN"),Rt&&(Ee.push("PROJECTION_GLOBE_VIEW"),zt&&Ee.push("PROJECTED_POS_ON_VIEWPORT")),Ri>0&&Ee.push("ICON_TRANSITION"),E.zOffsetVertexBuffer&&Ee.push("Z_OFFSET");let ti=f&&i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xi;f?xi=z.iconsInText?cy(L.kind,q,G,g,e,ge,Ie,se,P,$,Q,Yt,N,Oe,Gt,z.getProjection()):sF(L.kind,q,G,g,e,ge,Ie,se,a,P,!0,Q,Yt,N,Oe,Gt,z.getProjection()):(c<1&&Ee.push("SATURATION"),xi=dF(L.kind,q,G,g,e,ge,Ie,se,a,P,Q,Yt,N,Oe,Gt,z.getProjection(),c,Ri));let Gi={program:e.getOrCreateProgram(Zy(f,a,z),{config:O,defines:Ee}),buffers:E,uniformValues:xi,atlasTexture:et,atlasTextureIcon:ot,atlasInterpolation:it,atlasInterpolationIcon:at,isSDF:f,hasHalo:ti,tile:y,labelPlaneMatrixInv:xe};if(F&&z.canOverlap){R=!0;let ai=E.segments.get();for(let Se of ai)J.push({segments:new ze([Se]),sortKey:Se.sortKey,state:Gi})}else J.push({segments:E.segments,sortKey:0,state:Gi})}R&&J.sort((Q,y)=>Q.sortKey-y.sortKey);for(let Q of J){let y=Q.state;if(e.terrain&&e.terrain.setupElevationDraw(y.tile,y.program,{useDepthForOcclusion:p.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:y.labelPlaneMatrixInv}),h.activeTexture.set(W.TEXTURE0),y.atlasTexture&&y.atlasTexture.bind(y.atlasInterpolation,W.CLAMP_TO_EDGE),y.atlasTextureIcon&&(h.activeTexture.set(W.TEXTURE1),y.atlasTextureIcon&&y.atlasTextureIcon.bind(y.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,y.program),y.hasHalo){let z=y.uniformValues;z.u_is_halo=1,AW(y.buffers,Q.segments,i,e,y.program,I,b,m,z,2),z.u_is_halo=0}else{if(y.isSDF){let z=y.uniformValues;y.hasHalo&&(z.u_is_halo=1,AW(y.buffers,Q.segments,i,e,y.program,I,b,m,z,1)),z.u_is_halo=0}AW(y.buffers,Q.segments,i,e,y.program,I,b,m,y.uniformValues,1)}}}function AW(e,t,i,n,a,l,o,d,s,r){let c=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];a.draw(n,n.context.gl.TRIANGLES,l,o,d,me.disabled,s,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,n.transform.zoom,e.programConfigurations.get(i.id),c,r)}function WF(e,t,i,n,a,l,o){let d=e.context.gl,s=i.paint.get("fill-pattern"),r=s&&s.constantOr(1),c,b,m,h,W;o?(b=r&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",c=d.LINES):(b=r?"fillPattern":"fill",c=d.TRIANGLES);for(let p of n){let Z=t.getTile(p);if(r&&!Z.patternsLoaded())continue;let g=Z.getBucket(i);if(!g)continue;e.prepareDrawTile();let u=g.programConfigurations.get(i.id),G=e.isTileAffectedByFog(p),F=e.getOrCreateProgram(b,{config:u,overrideFog:G});r&&(e.context.activeTexture.set(d.TEXTURE0),Z.imageAtlasTexture&&Z.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),u.updatePaintBuffers());let R=s.constantOr(null);if(R&&Z.imageAtlas){let Y=Z.imageAtlas.patternPositions[R.toString()];Y&&u.setConstantPatternPositions(Y)}let I=e.translatePosMatrix(p.projMatrix,Z,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),N=i.paint.get("fill-emissive-strength");if(o){h=g.indexBuffer2,W=g.segments2;let Y=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[d.drawingBufferWidth,d.drawingBufferHeight];m=b==="fillOutlinePattern"&&r?ny(I,N,e,Z,Y):iy(I,N,Y)}else h=g.indexBuffer,W=g.segments,m=r?nF(I,N,e,Z):iF(I,N);e.uploadCommonUniforms(e.context,F,p.toUnwrapped()),F.draw(e,c,a,e.stencilModeForClipping(p),l,me.disabled,m,i.id,g.layoutVertexBuffer,h,W,i.paint,e.transform.zoom,u,void 0)}}function Mb(e,t,i,n,a,l,o,d){i.resetLayerRenderingStats();let s=e.context,r=s.gl,c=e.transform,b=i.paint.get("fill-extrusion-pattern"),m=b.constantOr(1),h=i.paint.get("fill-extrusion-opacity"),W=e.style.enable3dLights(),p=i.paint.get(W&&!m?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[i.paint.get("fill-extrusion-ambient-occlusion-intensity"),p],g=i.layout.get("fill-extrusion-edge-radius"),u=g>0&&!i.paint.get("fill-extrusion-rounded-roof"),G=u?0:g,F=c.projection.name==="globe"?QR():0,R=c.projection.name==="globe",I=R?Di(c.zoom):0,N=[Qi(c.center.lng),Li(c.center.lat)],Y=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),X=i.paint.get("fill-extrusion-flood-light-intensity"),J=i.paint.get("fill-extrusion-vertical-scale"),B=Qd(e,i.paint.get("fill-extrusion-cutoff-fade-range")),C=i.paint.get("fill-extrusion-emissive-strength"),Q=[],y;R&&Q.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&Q.push("FAUX_AO"),u&&Q.push("ZERO_ROOF_RADIUS"),d&&Q.push("HAS_CENTROID"),X>0&&Q.push("FLOOD_LIGHT"),B.shouldRenderCutoff&&Q.push("RENDER_CUTOFF");let z=e.renderPass==="shadow",E=e.shadowRenderer,O=z&&!!E;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let f=[0,0,0];if(E){let q=e.style.directionalLight,P=e.style.ambientLight;q&&P&&(f=HW(q,P)),y=Q.concat(["SHADOWS_SINGLE_CASCADE"])}let L=O?"fillExtrusionDepth":m?"fillExtrusionPattern":"fillExtrusion",K=i.getLayerRenderingStats();for(let q of n){let P=t.getTile(q),et=P.getBucket(i);if(!et||et.projection.name!==c.projection.name)continue;let it=!1;E&&(it=E.getMaxCascadeForTile(q.toUnwrapped())===0);let at=e.isTileAffectedByFog(q),$=et.programConfigurations.get(i.id),ot=e.getOrCreateProgram(L,{config:$,defines:it?y:Q,overrideFog:at});if(e.terrain&&e.terrain.setupElevationDraw(P,ot,{useMeterToDem:!0}),!et.centroidVertexBuffer){let ft=ot.attributes.a_centroid_pos;ft!==void 0&&r.vertexAttrib2f(ft,0,0)}!z&&E&&E.setupShadows(P.tileID.toUnwrapped(),ot,"vector-tile",P.tileID.overscaledZ),m&&(e.context.activeTexture.set(r.TEXTURE0),P.imageAtlasTexture&&P.imageAtlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),$.updatePaintBuffers());let Rt=b.constantOr(null);if(Rt&&P.imageAtlas){let ft=P.imageAtlas.patternPositions[Rt.toString()];ft&&$.setConstantPatternPositions(ft)}let Gt=i.paint.get("fill-extrusion-vertical-gradient"),Yt;if(z&&E){if(Gy(P.tileID,et,e))continue;let ft=E.calculateShadowPassMatrixFromTile(P.tileID.toUnwrapped());Yt=ty(ft,G,J)}else{let ft=e.translatePosMatrix(q.expandedProjMatrix,P,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),xe=c.projection.createInversionMatrix(c,q.canonical);Yt=m?ey(ft,e,Gt,h,Z,G,q,P,F,I,N,xe,Y,J):eF(ft,e,Gt,h,Z,G,q,F,I,N,xe,Y,J,X,f,C)}e.uploadCommonUniforms(s,ot,q.toUnwrapped(),null,B);let Bt=et.segments;if(c.projection.name==="mercator"&&!z&&(Bt=et.getVisibleSegments(P.tileID,e.terrain,e.transform.getFrustum(0)),!Bt.get().length))continue;if(K)if(z)for(let ft of Bt.get())K.numRenderedVerticesInShadowPass+=ft.primitiveLength;else for(let ft of Bt.get())K.numRenderedVerticesInTransparentPass+=ft.primitiveLength;let Dt=[];(e.terrain||d)&&Dt.push(et.centroidVertexBuffer),R&&Dt.push(et.layoutVertexExtBuffer),ot.draw(e,s.gl.TRIANGLES,a,l,o,me.backCCW,Yt,i.id,et.layoutVertexBuffer,et.indexBuffer,Bt,i.paint,e.transform.zoom,$,Dt)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function fd(e,t,i,n,a,l,o,d,s,r,c,b,m,h,W,p,Z,g,u){let G=e.context,F=G.gl,R=e.transform,I=e.transform.zoom,N=[],Y=Qd(e,i.paint.get("fill-extrusion-cutoff-fade-range"));r==="clear"?(N.push("CLEAR_SUBPASS"),u&&(N.push("CLEAR_FROM_TEXTURE"),G.activeTexture.set(F.TEXTURE0),u.bind(F.LINEAR,F.CLAMP_TO_EDGE))):r==="sdf"&&N.push("SDF_SUBPASS"),Z&&N.push("HAS_CENTROID"),Y.shouldRenderCutoff&&N.push("RENDER_CUTOFF");let X=i.layout.get("fill-extrusion-edge-radius"),J=(B,C,Q,y,z)=>{let E=C.programConfigurations.get(i.id),O=e.isTileAffectedByFog(B),f=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:E,defines:N,overrideFog:O}),L=((q,P,et,it,at,$,ot,Rt,Gt,Yt,Bt)=>({u_matrix:P,u_opacity:et,u_ao_pass:it?1:0,u_meter_to_tile:at,u_ao:$,u_flood_light_intensity:ot,u_flood_light_color:Rt,u_attenuation:Gt,u_edge_radius:Yt,u_fb:0,u_fb_size:Bt}))(0,y,c,s,z,[b,m*z],h,W,p,I>=17?0:X*z,u?u.size[0]:0),K=[];Z&&K.push(C.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(G,f,B.toUnwrapped(),null,Y),f.draw(e,G.gl.TRIANGLES,a,l,o,d,L,i.id,C.vertexBuffer,C.indexBuffer,Q,i.paint,I,E,K)};for(let B of n){let C=t.getTile(B),Q=C.getBucket(i);if(!Q||Q.projection.name!==R.projection.name||!Q.groundEffect||Q.groundEffect&&!Q.groundEffect.hasData())continue;let y=Q.groundEffect,z=1/Q.tileToMeter;{let E=e.translatePosMatrix(B.projMatrix,C,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),O=y.getDefaultSegment();J(B,y,O,E,z)}if(g)for(let E=0;E<4;E++){let O=rg[E](B),f=t.getTile(O);if(!f)continue;let L=f.getBucket(i);if(!L||L.projection.name!==R.projection.name||!L.groundEffect||L.groundEffect&&!L.groundEffect.hasData())continue;let K=L.groundEffect,q,P;E===0?(q=[-tt,0,0],P=1):E===1?(q=[tt,0,0],P=0):E===2?(q=[0,-tt,0],P=3):(q=[0,tt,0],P=2);let et=K.regionSegments[P];if(!et)continue;let it=new Float32Array(16);D.translate(it,B.projMatrix,q),J(B,K,et,e.translatePosMatrix(it,C,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),z)}}}function Vy(e,t,i,n,a,l,o){n.centroidVertexArray.length===0&&n.createCentroidsBuffer();let d=l?l.findDEMTileFor(i):null;if(!(d&&d.dem||o))return;let s=g=>{let u=t.getSource().minzoom,G=R=>{let I=t.getTileByID(R);if(I&&I.hasData())return I.getBucket(a)},F=[0,-1,1];for(let R of F){if(g.overscaledZ+R<u)continue;let I=G(g.calculateScaledKey(g.overscaledZ+R));if(I)return I}},r=[0,0,0],c=(g,u)=>(r[0]=Math.min(g.min.y,u.min.y),r[1]=Math.max(g.max.y,u.max.y),r[2]=tt-u.min.x>g.max.x?u.min.x-tt:g.max.x,r),b=(g,u)=>(r[0]=Math.min(g.min.x,u.min.x),r[1]=Math.max(g.max.x,u.max.x),r[2]=tt-u.min.y>g.max.y?u.min.y-tt:g.max.y,r),m=[(g,u)=>c(g,u),(g,u)=>c(u,g),(g,u)=>b(g,u),(g,u)=>b(u,g)],h=(g,u,G,F,R,I,N)=>{if(!l)return 0;let Y=[[I?G:g,I?g:G,0],[I?G:u,I?u:G,0]],X=N<0?tt+N:N,J=[I?X:(g+u)/2,I?(g+u)/2:X,0];return G===0&&N<0||G!==0&&N>0?l.getForTilePoints(R,[J],!0,F):Y.push(J),l.getForTilePoints(i,Y,!0,d),Math.max(Y[0][2],Y[1][2],J[2])/l.exaggeration()};for(let g=0;g<4;g++){let u=n.borderFeatureIndices[g];if(u.length===0)continue;let G=rg[g](i),F=s(G);if(!(F&&F instanceof nr)||n.borderDoneWithNeighborZ[g]===F.canonical.z)continue;F.centroidVertexArray.length===0&&F.createCentroidsBuffer();let R=l?l.findDEMTileFor(G):null;if(!(R&&R.dem||o))continue;let I=(g<2?1:5)-g,N=F.borderDoneWithNeighborZ[I]!==n.canonical.z,Y=F.borderFeatureIndices[I],X=0;if(n.canonical.z!==F.canonical.z){for(let J of u)n.showCentroid(n.featuresOnBorder[J]);if(N)for(let J of Y)F.showCentroid(F.featuresOnBorder[J]);n.borderDoneWithNeighborZ[g]=F.canonical.z,F.borderDoneWithNeighborZ[I]=n.canonical.z}for(let J of u){let B=n.featuresOnBorder[J],C=n.centroidData[B.centroidDataIndex],Q=B.borders[g],y;for(;X<Y.length;){y=F.featuresOnBorder[Y[X]];let z=y.borders[I];if(z[1]>Q[0]+3||z[0]>Q[0]-3)break;F.showCentroid(y),X++}if(y&&X<Y.length){let z=X,E=0;for(;!(y.borders[I][0]>Q[1]-3)&&(E++,++X!==Y.length);)y=F.featuresOnBorder[Y[X]];if(y=F.featuresOnBorder[Y[z]],E>1){let L=y.borders[I];Math.abs(Q[0]-L[0])<3&&Math.abs(Q[1]-L[1])<3&&(E=1,X=z+1)}else if(E===0){n.showCentroid(B);continue}let O=F.centroidData[y.centroidDataIndex];o&&E===1&&(((p=C).flags|(Z=O).flags)&va?(p.flags|=va,Z.flags|=va):(p.flags&=2147483647,Z.flags&=2147483647));let f=new H(0,0);if(E>1)X=z;else if(R&&R.dem&&!(B.intersectsCount()>1||y.intersectsCount()>1)){let L=m[g](C,O),K=g%2?tt-1:0;W=h(L[0],Math.min(tt-1,L[1]),K,R,G,g<2,L[2]),f=new H(Math.ceil(7*(W+450)),0)}C.centroidXY=O.centroidXY=f,n.writeCentroidToBuffer(C),F.writeCentroidToBuffer(O)}else n.showCentroid(B)}n.borderDoneWithNeighborZ[g]=F.canonical.z,F.borderDoneWithNeighborZ[I]=n.canonical.z}var W,p,Z;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&n.centroidVertexArray.length!==0)&&n.uploadCentroid(e)}let gy=[1,0,0],uy=[0,1,0],Ry=[0,0,1];function Gy(e,t,i){let n=i.transform,a=i.shadowRenderer;if(!a)return!0;let l=e.toUnwrapped(),o=n.tileSize*a._cascades[i.currentShadowCascade].scale,d=t.maxHeight;if(n.elevation){let p=n.elevation.getMinMaxForTile(e);p&&(d+=p.max)}let s=[...a.shadowDirection];s[2]=-s[2];let r=a.computeSimplifiedTileShadowVolume(l,d,o,s);if(!r)return!1;let c=[gy,uy,Ry,s,[s[0],0,s[2]],[0,s[1],s[2]]],b=n.projection.name==="globe",m=n.scaleZoom(o),h=ll.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,m,!b),W=a.getCurrentCascadeFrustum();return h.intersectsPrecise(r.vertices,r.planes,c)===0||W.intersectsPrecise(r.vertices,r.planes,c)===0}function Fy(e){let t=e._nearZ,i=e.projection.farthestPixelDistance(e),n=i-t,a=.2*e.height,l=t+a;return[t,i,(l-a-t)/n,(l-t)/n]}let Iy=new re(1,0,0,1),Uy=new re(0,1,0,1),xy=new re(0,0,1,1),Ny=new re(1,0,1,1),Yy=new re(0,1,1,1);function Xy(e,t,i){let n=e.context,a=e.transform,l=n.gl,o=a.projection.name==="globe",d=o?["PROJECTION_GLOBE_VIEW"]:[],s=i.projMatrix;if(o&&Di(a.zoom)>0){let J=xh(Wg(i.canonical,a));s=D.multiply(new Float32Array(16),a.globeMatrix,J),D.multiply(s,a.projMatrix,s)}let r=e.getOrCreateProgram("debug",{defines:d}),c=t.getTileByID(i.key);e.terrain&&e.terrain.setupElevationDraw(c,r);let b=Ot.disabled,m=ce.disabled,h=e.colorModeForRenderPass(),W="$debug";n.activeTexture.set(l.TEXTURE0),e.emptyTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),o?c._makeGlobeTileDebugBuffers(e.context,a):c._makeDebugTileBoundsBuffers(e.context,a.projection);let p=c._tileDebugBuffer||e.debugBuffer,Z=c._tileDebugIndexBuffer||e.debugIndexBuffer,g=c._tileDebugSegments||e.debugSegments;r.draw(e,l.LINE_STRIP,b,m,h,me.disabled,aF(s,re.red),W,p,Z,g,null,null,null,[c._globeTileDebugBorderBuffer]);let u=c.latestRawTileData,G=Math.floor((u&&u.byteLength||0)/1024),F=t.getTile(i).tileSize,R=512/Math.min(F,512)*(i.overscaledZ/a.zoom)*.5,I=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(I+=" => ".concat(i.overscaledZ)),I+=" ".concat(G,"kb"),function(J,B){J.initDebugOverlayCanvas();let C=J.debugOverlayCanvas,Q=J.context.gl,y=J.debugOverlayCanvas.getContext("2d");y.clearRect(0,0,C.width,C.height),y.shadowColor="white",y.shadowBlur=2,y.lineWidth=1.5,y.strokeStyle="white",y.textBaseline="top",y.font="bold 36px Open Sans, sans-serif",y.fillText(B,5,5),y.strokeText(B,5,5),J.debugOverlayTexture.update(C),J.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}(e,I);let N=c._tileDebugTextBuffer||e.debugBuffer,Y=c._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,X=c._tileDebugTextSegments||e.debugSegments;r.draw(e,l.TRIANGLES,b,m,Ne.alphaBlended,me.disabled,aF(s,re.transparent,R),W,N,Y,X,null,null,null,[c._globeTileDebugTextBuffer])}function pF(e,t,i,n){Cb(e,0,t+i/2,e.transform.width,i,n)}function ZF(e,t,i,n){Cb(e,t-i/2,0,i,e.transform.height,n)}function Cb(e,t,i,n,a,l){let o=e.context,d=o.gl;d.enable(d.SCISSOR_TEST),d.scissor(t*ee.devicePixelRatio,i*ee.devicePixelRatio,n*ee.devicePixelRatio,a*ee.devicePixelRatio),o.clear({color:l}),d.disable(d.SCISSOR_TEST)}let Jy=Ce([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yy}=Jy;function Dl(e,t,i,n){e.emplaceBack(t,i,n)}class VF{constructor(t){this.vertexArray=new go,this.indices=new yi,Dl(this.vertexArray,-1,-1,1),Dl(this.vertexArray,1,-1,1),Dl(this.vertexArray,-1,1,1),Dl(this.vertexArray,1,1,1),Dl(this.vertexArray,-1,-1,-1),Dl(this.vertexArray,1,-1,-1),Dl(this.vertexArray,-1,1,-1),Dl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,yy),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=ze.simpleSegment(0,0,36,12)}}function zd(e,t,i,n,a,l){let o=e.context.gl,d=t.paint.get("sky-atmosphere-color"),s=t.paint.get("sky-atmosphere-halo-color"),r=t.paint.get("sky-atmosphere-sun-intensity"),c=((b,m,h,W,p)=>({u_matrix_3f:b,u_sun_direction:m,u_sun_intensity:h,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[p.r,p.g,p.b,p.a],u_luminance:5e-5}))(Rn.fromMat4(Rn.create(),n),a,r,d,s);o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+l,t.skyboxTexture,0),i.draw(e,o.TRIANGLES,Ot.disabled,ce.disabled,Ne.unblended,me.frontCW,c,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let By=Ce([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class My{constructor(t){let i=new Vo;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);let n=new yi;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,By.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=ze.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Cy=Ce([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ty{constructor(){this.colorModeAlphaBlendedWriteRGB=new Ne([1,rb,1,rb],re.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ne([1,0,1,0],re.transparent,[!1,!1,!1,!0])}update(t){let i=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new My(i);let n=100,a=200,l=function(c){let b=V0(30),m=[];for(let h=0;h<16e3;++h){let W=2*Math.PI*b(),p=Math.acos(1-2*b())-.5*Math.PI;m.push(S.fromValues(Math.cos(p)*Math.cos(W),Math.cos(p)*Math.sin(W),Math.sin(p)))}return m}(),o=V0(300),d=new D0,s=new yi,r=0;for(let c=0;c<l.length;++c){let b=S.scale([],l[c],200),m=Math.max(0,1+.01*n*(1*o()-.5)),h=Math.max(0,1+.01*a*(1*o()-.5));d.emplaceBack(b[0],b[1],b[2],-1,-1,m,h),d.emplaceBack(b[0],b[1],b[2],1,-1,m,h),d.emplaceBack(b[0],b[1],b[2],1,1,m,h),d.emplaceBack(b[0],b[1],b[2],-1,1,m,h),s.emplaceBack(r+0,r+1,r+2),s.emplaceBack(r+0,r+2,r+3),r+=4}this.starsVx=i.createVertexBuffer(d,Cy.members),this.starsIdx=i.createIndexBuffer(s),this.starsSegments=ze.simpleSegment(0,0,d.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){let n=t.context,a=n.gl,l=t.transform,o=new Ot(a.LEQUAL,Ot.ReadOnly,[0,1]),d=Di(l.zoom),s=i.properties.get("color").toArray01(),r=i.properties.get("high-color").toArray01(),c=i.properties.get("space-color").toArray01PremultipliedAlpha(),b=5e-4,m=Mt((i.properties.get("horizon-blend")-0)/1*.2495+b,5e-4,.25),h=Gg(t,n,l)&&m===b?l.worldSize/(2*Math.PI*1.025)-1:l.globeRadius,W=t.frameCounter/1e3%1,p=S.length(l.globeCenterInViewSpace),Z=Math.sqrt(Math.pow(p,2)-Math.pow(h,2)),g=Math.acos(Z/p),u=G=>{let F=l.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];G&&F.push("ALPHA_PASS");let R=t.getOrCreateProgram("globeAtmosphere",{defines:F}),I=((Y,X,J,B,C,Q,y,z,E,O,f,L)=>({u_frustum_tl:Y,u_frustum_tr:X,u_frustum_br:J,u_frustum_bl:B,u_horizon:C,u_transition:Q,u_fadeout_range:y,u_color:z,u_high_color:E,u_space_color:O,u_temporal_offset:f,u_horizon_angle:L}))(l.frustumCorners.TL,l.frustumCorners.TR,l.frustumCorners.BR,l.frustumCorners.BL,l.frustumCorners.horizon,d,m,s,r,c,W,g);t.uploadCommonUniforms(n,R);let N=this.atmosphereBuffer;N&&R.draw(t,a.TRIANGLES,o,ce.disabled,G?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,me.backCW,I,G?"atmosphere_glow_alpha":"atmosphere_glow",N.vertexBuffer,N.indexBuffer,N.segments)};u(!1),u(!0)}drawStars(t,i){let n=Mt(i.properties.get("star-intensity"),0,1);if(n===0)return;let a=t.context,l=a.gl,o=t.transform,d=t.getOrCreateProgram("stars"),s=an.identity([]);an.rotateX(s,s,-o._pitch),an.rotateZ(s,s,-o.angle),an.rotateX(s,s,At(o._center.lat)),an.rotateY(s,s,-At(o._center.lng));let r=D.fromQuat(new Float32Array(16),s),c=D.multiply([],o.starsProjMatrix,r),b=Rn.fromMat4([],r),m=Rn.invert([],b),h=[0,1,0];S.transformMat3(h,h,m),S.scale(h,h,.15);let W=[1,0,0];S.transformMat3(W,W,m),S.scale(W,W,.15);let p=((Z,g,u,G)=>({u_matrix:Float32Array.from(Z),u_up:g,u_right:u,u_intensity_multiplier:G}))(c,h,W,n);t.uploadCommonUniforms(a,d),this.starsVx&&this.starsIdx&&d.draw(t,l.TRIANGLES,Ot.disabled,ce.disabled,this.colorModeAlphaBlendedWriteRGB,me.disabled,p,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function gF(e,t){let i=[...e],n=t.cameraWorldSizeForFog/t.worldSize,a=D.identity([]);return D.scale(a,a,[n,n,1]),D.multiply(i,a,i),D.multiply(i,t.worldToFogMatrix,i),i}function wW(e,t,i,n){let a=i.material,l=n.context,{baseColorTexture:o,metallicRoughnessTexture:d}=a.pbrMetallicRoughness,{normalTexture:s,occlusionTexture:r,emissionTexture:c}=a;function b(m,h,W){if(m&&(e.push(h),l.activeTexture.set(l.gl.TEXTURE0+W),m.gfxTexture)){let{minFilter:p,magFilter:Z,wrapS:g,wrapT:u}=m.sampler;m.gfxTexture.bindExtraParam(p,Z,g,u)}}b(o,"HAS_TEXTURE_u_baseColorTexture",Qn.BaseColor),b(d,"HAS_TEXTURE_u_metallicRoughnessTexture",Qn.MetallicRoughness),b(s,"HAS_TEXTURE_u_normalTexture",Qn.Normal),b(r,"HAS_TEXTURE_u_occlusionTexture",Qn.Occlusion),b(c,"HAS_TEXTURE_u_emissionTexture",Qn.Emission),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(i.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),a.alphaMode!=="OPAQUE"&&a.alphaMode!=="MASK"||e.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function Tb(e,t,i,n,a,l){let o=i.paint.get("model-opacity"),d=t.context,s=new Ot(t.context.gl.LEQUAL,Ot.ReadWrite,t.depthRangeFor3D),r=t.transform,c=e.mesh,b=c.material,m=b.pbrMetallicRoughness,h=t.style.fog,W;W=t.transform.projection.zAxisUnit==="pixels"?[...e.nodeModelMatrix]:D.multiply([],n.zScaleMatrix,e.nodeModelMatrix),D.multiply(W,n.negCameraPosMatrix,W);let p=D.invert([],W);D.transpose(p,p);let Z=i.paint.get("model-emissive-strength").constantOr(0),g=EW(new Float32Array(e.worldViewProjection),new Float32Array(W),new Float32Array(p),t,o,m.baseColorFactor,b.emissiveFactor,m.metallicFactor,m.roughnessFactor,b,Z,i),u={defines:[]},G=[];wW(u.defines,G,c,t);let F=t.shadowRenderer;F&&(F.useNormalOffset=!1);let R=null;if(h){let Y=gF(e.nodeModelMatrix,t.transform);if(R=new Float32Array(Y),r.projection.name!=="globe"){let X=c.aabb.min,J=c.aabb.max,[B,C]=h.getOpacityForBounds(Y,X[0],X[1],J[0],J[1]);u.overrideFog=B>=Yo||C>=Yo}}let I=Qd(t,i.paint.get("model-cutoff-fade-range"));I.shouldRenderCutoff&&u.defines.push("RENDER_CUTOFF");let N=t.getOrCreateProgram("model",u);t.uploadCommonUniforms(d,N,null,R,I),t.renderPass!=="shadow"&&F&&F.setupShadowsFromMatrix(e.nodeModelMatrix,N),N.draw(t,d.gl.TRIANGLES,s,a,l,c.material.doubleSided?me.disabled:me.backCCW,g,i.id,c.vertexBuffer,c.indexBuffer,c.segments,i.paint,t.transform.zoom,void 0,G)}function uF(e,t,i,n,a,l,o){let d;d=e.projection.name==="globe"?mR(i,e):[...i],D.multiply(d,d,t.matrix);let s=D.multiply([],n,d);if(t.meshes)for(let r of t.meshes){if(r.material.alphaMode!=="BLEND"){o.push({mesh:r,depth:0,modelIndex:a,worldViewProjection:s,nodeModelMatrix:d});continue}let c=S.transformMat4([],r.centroid,s);c[2]>0&&l.push({mesh:r,depth:c[2],modelIndex:a,worldViewProjection:s,nodeModelMatrix:d})}if(t.children)for(let r of t.children)uF(e,r,i,n,a,l,o)}function jW(e,t,i,n){let a=i.shadowRenderer;if(!a)return;let l=a.getShadowPassDepthMode(),o=a.getShadowPassColorMode(),d=a.calculateShadowPassMatrixFromMatrix(t),s=cF(d);i.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,l,ce.disabled,o,me.backCCW,s,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,i.transform.zoom,void 0,void 0)}function ky(e,t,i){let n=t.updateZoomBasedPaintProperties(),a=function(l,o,d){let s,r,c,b=l.terrain?l.terrain.exaggeration():0;if(l.terrain&&b>0){let m=l.terrain,h=m.findDEMTileFor(d);h&&h.dem?s=Nd.create(m,d,h):b=0}if(b===0&&(o.terrainElevationMin=0,o.terrainElevationMax=0),b===o.validForExaggeration&&(b===0||s&&s._demTile&&s._demTile.tileID===o.validForDEMTile.id&&s._dem._timestamp===o.validForDEMTile.timestamp))return!1;for(let m in o.instancesPerModel){let h=o.instancesPerModel[m];for(let W=0;W<h.instancedDataArray.length;++W){let p=(s?b*s.getElevationAt(0|h.instancedDataArray.float32[16*W],0|h.instancedDataArray.float32[16*W+1],!0,!0):0)+h.instancesEvaluatedElevation[W];h.instancedDataArray.float32[16*W+6]=p,r=r?Math.min(o.terrainElevationMin,p):p,c=c?Math.max(o.terrainElevationMax,p):p}}return o.terrainElevationMin=r||0,o.terrainElevationMax=c||0,o.validForExaggeration=b,o.validForDEMTile=s&&s._demTile?{id:s._demTile.tileID,timestamp:s._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,i);(n||a)&&(t.uploaded=!1,t.upload(e.context))}let za={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new $e([0,0,0],[tt,tt,0])};function Sy(e,t){let i=1<<e.canonical.z,n=t.getFreeCameraOptions().position,a=t.elevation,l=e.canonical.x/i,o=(e.canonical.x+1)/i,d=e.canonical.y/i,s=(e.canonical.y+1)/i,r=t._centerAltitude;if(a){let h=a.getMinMaxForTile(e);h&&h.max>r&&(r=h.max)}let c=Mt(n.x,l,o)-n.x,b=Mt(n.y,d,s)-n.y,m=He(r,t.center.lat)-n.z;return t._zoomFromMercatorZ(Math.sqrt(c*c+b*b+m*m))}function RF(e,t,i,n,a,l,o){let d=e.context,s=e.renderPass==="shadow",r=e.shadowRenderer,c=s&&r?r.getShadowPassDepthMode():new Ot(d.gl.LEQUAL,Ot.ReadWrite,e.depthRangeFor3D),b=e.isTileAffectedByFog(l);if(i.meshes)for(let m of i.meshes){let h=["MODEL_POSITION_ON_GPU"],W=[],p,Z,g;n.instancedDataArray.length>20&&h.push("INSTANCED_ARRAYS");let u=Qd(e,t.paint.get("model-cutoff-fade-range"));if(u.shouldRenderCutoff&&h.push("RENDER_CUTOFF"),s&&r)p=e.getOrCreateProgram("modelDepth",{defines:h}),Z=cF(o.shadowTileMatrix,o.shadowTileMatrix,Float32Array.from(i.matrix)),g=r.getShadowPassColorMode();else{wW(h,W,m,e),p=e.getOrCreateProgram("model",{defines:h,overrideFog:b});let F=m.material,R=F.pbrMetallicRoughness,I=t.paint.get("model-opacity"),N=t.paint.get("model-emissive-strength").constantOr(0);Z=EW(l.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),e,I,R.baseColorFactor,F.emissiveFactor,R.metallicFactor,R.roughnessFactor,F,N,t,a),r&&(o.shadowUniformsInitialized?p.setShadowUniformValues(d,r.getShadowUniformValues()):(r.setupShadows(l.toUnwrapped(),p,"model-tile",l.overscaledZ),o.shadowUniformsInitialized=!0)),g=u.shouldRenderCutoff||I<1||F.alphaMode!=="OPAQUE"?Ne.alphaBlended:Ne.unblended}e.uploadCommonUniforms(d,p,l.toUnwrapped(),null,u);let G=m.material.doubleSided?me.disabled:me.backCCW;if(n.instancedDataArray.length>20)W.push(n.instancedDataBuffer),p.draw(e,d.gl.TRIANGLES,c,ce.disabled,g,G,Z,t.id,m.vertexBuffer,m.indexBuffer,m.segments,t.paint,e.transform.zoom,void 0,W,n.instancedDataArray.length);else{let F=s?"u_instance":"u_normal_matrix";for(let R=0;R<n.instancedDataArray.length;++R)Z[F]=new Float32Array(n.instancedDataArray.arrayBuffer,64*R,16),p.draw(e,d.gl.TRIANGLES,c,ce.disabled,g,G,Z,t.id,m.vertexBuffer,m.indexBuffer,m.segments,t.paint,e.transform.zoom,void 0,W)}}if(i.children)for(let m of i.children)RF(e,t,m,n,a,l,o)}let Qy=[1,-1,1];function vy(e,t,i,n){if(!i.modelManager)return!0;let a=i.modelManager;if(!i.shadowRenderer)return!0;let l=i.shadowRenderer,o=t.aabb,d=!0,s=e.maxHeight;if(s===0){let c=0;for(let b in e.instancesPerModel){let m=a.getModel(b,n);m?c=Math.max(c,Math.max(Math.max(m.aabb.max[0],m.aabb.max[1]),m.aabb.max[2])):d=!1}s=e.maxScale*c*1.41+e.maxVerticalOffset,d&&(e.maxHeight=s)}o.max[2]=s,o.min[2]+=e.terrainElevationMin,o.max[2]+=e.terrainElevationMax,S.transformMat4(o.min,o.min,t.tileMatrix),S.transformMat4(o.max,o.max,t.tileMatrix);let r=o.intersects(l.getCurrentCascadeFrustum());return i.currentShadowCascade===0&&(e.isInsideFirstShadowMapFrustum=r===2),r===0}class fy{}class zy{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,n){{let b=this._storage.get(i.id);if(b)return b.lastUsedFrameIdx=t,b.buf}let a=n.gl,l=a.getBufferParameter(a.ELEMENT_ARRAY_BUFFER,a.BUFFER_SIZE),o=new ArrayBuffer(l),d=new Int16Array(o);a.getBufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));let s=new Xl;for(let b=0;b<l/2;b+=3){let m=d[b],h=d[b+1],W=d[b+2];s.emplaceBack(m,h),s.emplaceBack(h,W),s.emplaceBack(W,m)}let r=n.bindVertexArrayOES.current,c=new fy;return c.buf=new jl(n,s),c.lastUsedFrameIdx=t,this._storage.set(i.id,c),n.bindVertexArrayOES.set(r),c.buf}update(t){for(let[i,n]of this._storage)t-n.lastUsedFrameIdx>30&&(n.buf.destroy(),this._storage.delete(i))}destroy(){for(let[t,i]of this._storage)i.buf.destroy(),this._storage.delete(t)}}let GF={symbol:function(e,t,i,n,a){if(e.renderPass!=="translucent")return;let l=ce.disabled,o=e.colorModeForRenderPass();i.layout.get("text-variable-anchor")&&function(d,s,r,c,b,m,h){let W=s.transform,p=b==="map",Z=m==="map";for(let g of d){let u=c.getTile(g),G=u.getBucket(r);if(!G||!G.text||!G.text.segments.get().length)continue;let F=ka(G.textSizeData,W.zoom),R=kW(g,G.getProjection(),W),I=W.calculatePixelsToTileUnitsMatrix(u),N=bb(R,u.tileID.canonical,Z,p,W,G.getProjection(),I),Y=G.hasIconTextFit()&&G.hasIconData();if(F){let X=Math.pow(2,W.zoom-u.tileID.overscaledZ);py(G,p,Z,h,QY,W,N,g,X,F,Y)}}}(n,e,i,t,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),a),i.paint.get("icon-opacity").constantOr(1)!==0&&hF(e,t,i,n,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),i.paint.get("icon-color-saturation"),l,o),i.paint.get("text-opacity").constantOr(1)!==0&&hF(e,t,i,n,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),i.paint.get("icon-color-saturation"),l,o),t.map.showCollisionBoxes&&(bF(e,t,i,n,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),!0),bF(e,t,i,n,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,i,n){if(e.renderPass!=="translucent")return;let a=i.paint.get("circle-opacity"),l=i.paint.get("circle-stroke-width"),o=i.paint.get("circle-stroke-opacity"),d=i.layout.get("circle-sort-key").constantOr(1)!==void 0,s=i.paint.get("circle-emissive-strength");if(a.constantOr(1)===0&&(l.constantOr(1)===0||o.constantOr(1)===0))return;let r=e.context,c=r.gl,b=e.transform,m=e.depthModeForSublayer(0,Ot.ReadOnly),h=ce.disabled,W=e.colorModeForDrapableLayerRenderPass(s),p=b.projection.name==="globe",Z=[Qi(b.center.lng),Li(b.center.lat)],g=[];for(let G=0;G<n.length;G++){let F=n[G],R=t.getTile(F),I=R.getBucket(i);if(!I||I.projection.name!==b.projection.name)continue;let N=I.programConfigurations.get(i.id),Y=Qg(i),X=e.isTileAffectedByFog(F);p&&Y.push("PROJECTION_GLOBE_VIEW");let J=e.getOrCreateProgram("circle",{config:N,defines:Y,overrideFog:X}),B=I.layoutVertexBuffer,C=I.globeExtVertexBuffer,Q=I.indexBuffer,y=b.projection.createInversionMatrix(b,F.canonical),z={programConfiguration:N,program:J,layoutVertexBuffer:B,globeExtVertexBuffer:C,indexBuffer:Q,uniformValues:BN(e,F,R,y,Z,i),tile:R};if(d){let E=I.segments.get();for(let O of E)g.push({segments:new ze([O]),sortKey:O.sortKey,state:z})}else g.push({segments:I.segments,sortKey:0,state:z})}d&&g.sort((G,F)=>G.sortKey-F.sortKey);let u={useDepthForOcclusion:b.depthOcclusionForSymbolsAndCircles};for(let G of g){let{programConfiguration:F,program:R,layoutVertexBuffer:I,globeExtVertexBuffer:N,indexBuffer:Y,uniformValues:X,tile:J}=G.state,B=G.segments;e.terrain&&e.terrain.setupElevationDraw(J,R,u),e.uploadCommonUniforms(r,R,J.tileID.toUnwrapped()),R.draw(e,c.TRIANGLES,m,h,W,me.disabled,X,i.id,I,Y,B,i.paint,b.zoom,F,[N])}},heatmap:function(e,t,i,n){if(i.paint.get("heatmap-opacity")!==0)if(e.renderPass==="offscreen"){let a=e.context,l=a.gl,o=ce.disabled,d=new Ne([l.ONE,l.ONE,l.ONE,l.ONE],re.transparent,[!0,!0,!0,!0]);(function(h,W,p,Z){let g=h.gl,u=W.width*Z,G=W.height*Z;h.activeTexture.set(g.TEXTURE1),h.viewport.set([0,0,u,G]);let F=p.heatmapFbo;if(!F||F&&(F.width!==u||F.height!==G)){F&&F.destroy();let R=g.createTexture();g.bindTexture(g.TEXTURE_2D,R),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),F=p.heatmapFbo=h.createFramebuffer(u,G,!0,null),function(I,N,Y,X,J,B){let C=I.gl;C.texImage2D(C.TEXTURE_2D,0,I.extRenderToTextureHalfFloat?C.RGBA16F:C.RGBA,J,B,0,C.RGBA,I.extRenderToTextureHalfFloat?C.HALF_FLOAT:C.UNSIGNED_BYTE,null),X.colorAttachment.set(Y)}(h,0,R,F,u,G)}else g.bindTexture(g.TEXTURE_2D,F.colorAttachment.get()),h.bindFramebuffer.set(F.framebuffer)})(a,e,i,e.transform.projection.name==="globe"?.5:.25),a.clear({color:re.transparent});let s=e.transform,r=s.projection.name==="globe",c=r?["PROJECTION_GLOBE_VIEW"]:[],b=r?me.frontCCW:me.disabled,m=[Qi(s.center.lng),Li(s.center.lat)];for(let h=0;h<n.length;h++){let W=n[h];if(t.hasRenderableParent(W))continue;let p=t.getTile(W),Z=p.getBucket(i);if(!Z||Z.projection.name!==s.projection.name)continue;let g=e.isTileAffectedByFog(W),u=Z.programConfigurations.get(i.id),G=e.getOrCreateProgram("heatmap",{config:u,defines:c,overrideFog:g}),{zoom:F}=e.transform;e.terrain&&e.terrain.setupElevationDraw(p,G),e.uploadCommonUniforms(a,G,W.toUnwrapped());let R=s.projection.createInversionMatrix(s,W.canonical);G.draw(e,l.TRIANGLES,Ot.disabled,o,d,b,oy(e,W,p,R,m,F,i.paint.get("heatmap-intensity")),i.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,i.paint,e.transform.zoom,u,r?[Z.globeExtVertexBuffer]:null)}a.viewport.set([0,0,e.width,e.height])}else e.renderPass==="translucent"&&(e.context.setColorMode(e.colorModeForRenderPass()),function(a,l){let o=a.context,d=o.gl,s=l.heatmapFbo;if(!s)return;o.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,s.colorAttachment.get()),o.activeTexture.set(d.TEXTURE1);let r=l.colorRampTexture;r||(r=l.colorRampTexture=new bi(o,l.colorRamp,d.RGBA)),r.bind(d.LINEAR,d.CLAMP_TO_EDGE),a.getOrCreateProgram("heatmapTexture").draw(a,d.TRIANGLES,Ot.disabled,ce.disabled,a.colorModeForRenderPass(),me.disabled,((c,b,m,h)=>({u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")}))(0,l),l.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,l.paint,a.transform.zoom)}(e,i))},line:function(e,t,i,n){if(e.renderPass!=="translucent")return;let a=i.paint.get("line-opacity"),l=i.paint.get("line-width");if(a.constantOr(1)===0||l.constantOr(1)===0)return;let o=i.paint.get("line-emissive-strength"),d=e.depthModeForSublayer(0,Ot.ReadOnly),s=e.colorModeForDrapableLayerRenderPass(o),r=e.terrain&&e.terrain.renderingToTexture?1:ee.devicePixelRatio,c=i.paint.get("line-dasharray"),b=c.constantOr(1),m=i.layout.get("line-cap"),h=i.paint.get("line-pattern"),W=h.constantOr(1),p=i.paint.get("line-pattern").constantOr(1),Z=i.paint.get("line-opacity").constantOr(1)!==1,g=!p&&Z,u=i.paint.get("line-gradient"),G=W?"linePattern":"line",F=e.context,R=F.gl,I=wR(i);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(g=!1);for(let N of n){let Y=t.getTile(N);if(W&&!Y.patternsLoaded())continue;let X=Y.getBucket(i);if(!X)continue;e.prepareDrawTile();let J=X.programConfigurations.get(i.id),B=e.isTileAffectedByFog(N),C=e.getOrCreateProgram(G,{config:J,defines:I,overrideFog:B}),Q=h.constantOr(null);if(Q&&Y.imageAtlas){let q=Y.imageAtlas.patternPositions[Q.toString()];q&&J.setConstantPatternPositions(q)}let y=c.constantOr(null),z=m.constantOr(null);if(!W&&y&&z&&Y.lineAtlas){let q=Y.lineAtlas.getDash(y,z);q&&J.setConstantPatternPositions(q)}let[E,O]=i.paint.get("line-trim-offset");(z==="round"||z==="square")&&E!==O&&(E===0&&(E-=1),O===1&&(O+=1));let f=e.terrain?N.projMatrix:null,L=W?SJ(e,Y,i,f,r):kJ(e,Y,i,f,X.lineClipsArray.length,r,[E,O]);if(u){let q=X.gradients[i.id],P=q.texture;if(i.gradientVersion!==q.version){let et=256;if(i.stepInterpolant){let it=t.getSource().maxzoom,at=N.canonical.z===it?Math.ceil(1<<e.transform.maxZoom-N.canonical.z):1;et=Mt(gl(X.maxLineLength/tt*1024*at),256,F.maxTextureSize)}q.gradient=Bc({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:et,image:q.gradient||void 0,clips:X.lineClipsArray}),q.texture?q.texture.update(q.gradient):q.texture=new bi(F,q.gradient,R.RGBA),q.version=i.gradientVersion,P=q.texture}F.activeTexture.set(R.TEXTURE1),P.bind(i.stepInterpolant?R.NEAREST:R.LINEAR,R.CLAMP_TO_EDGE)}b&&(F.activeTexture.set(R.TEXTURE0),Y.lineAtlasTexture&&Y.lineAtlasTexture.bind(R.LINEAR,R.REPEAT),J.updatePaintBuffers()),W&&(F.activeTexture.set(R.TEXTURE0),Y.imageAtlasTexture&&Y.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),J.updatePaintBuffers()),e.uploadCommonUniforms(F,C,N.toUnwrapped());let K=q=>{C.draw(e,R.TRIANGLES,d,q,s,me.disabled,L,i.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,i.paint,e.transform.zoom,J,[X.layoutVertexBuffer2])};if(g){let q=e.stencilModeForClipping(N).ref;q===0&&e.terrain&&F.clear({stencil:0});let P={func:R.EQUAL,mask:255};L.u_alpha_discard_threshold=.8,K(new ce(P,q,255,R.KEEP,R.KEEP,R.INVERT)),L.u_alpha_discard_threshold=0,K(new ce(P,q,255,R.KEEP,R.KEEP,R.KEEP))}else K(e.stencilModeForClipping(N))}g&&(e.resetStencilClippingMasks(),e.terrain&&F.clear({stencil:0}))},fill:function(e,t,i,n){let a=i.paint.get("fill-color"),l=i.paint.get("fill-opacity");if(l.constantOr(1)===0)return;let o=i.paint.get("fill-emissive-strength"),d=e.colorModeForDrapableLayerRenderPass(o),s=i.paint.get("fill-pattern"),r=e.opaquePassEnabledForLayer()&&!s.constantOr(1)&&a.constantOr(re.transparent).a===1&&l.constantOr(0)===1?"opaque":"translucent";if(e.renderPass===r){let c=e.depthModeForSublayer(1,e.renderPass==="opaque"?Ot.ReadWrite:Ot.ReadOnly);WF(e,t,i,n,c,d,!1)}if(e.renderPass==="translucent"&&i.paint.get("fill-antialias")){let c=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Ot.ReadOnly);WF(e,t,i,n,c,d,!0)}},"fill-extrusion":function(e,t,i,n){let a=i.paint.get("fill-extrusion-opacity"),l=e.context,o=l.gl,d=e.terrain,s=d&&d.renderingToTexture,r=i.paint.get("fill-extrusion-cutoff-fade-range");if(a===0)return;let c=e.conflationActive&&e.layerUsedInConflation(i,t.getSource());if(c&&function(b,m,h,W){for(let p of W){let Z=m.getTile(p).getBucket(h);Z&&(Z.updateReplacement(p,b.replacementSource),Z.uploadCentroid(b.context))}}(e,t,i,n),d||c)for(let b of n){let m=t.getTile(b).getBucket(i);m&&Vy(e.context,t,b,m,i,d,c)}if(e.renderPass==="shadow"&&e.shadowRenderer){let b=e.shadowRenderer;if(d&&a<.65&&i._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Ul)return;let m=b.getShadowPassDepthMode(),h=b.getShadowPassColorMode();Mb(e,t,i,n,m,ce.disabled,h,c)}else if(e.renderPass==="translucent"){let b=!i.paint.get("fill-extrusion-pattern").constantOr(1);if(!s){let m=new Ot(e.context.gl.LEQUAL,Ot.ReadWrite,e.depthRangeFor3D);r===0&&a===1&&b?Mb(e,t,i,n,m,ce.disabled,Ne.unblended,c):(Mb(e,t,i,n,m,ce.disabled,Ne.disabled,c),Mb(e,t,i,n,m,e.stencilModeFor3D(),e.colorModeForRenderPass(),c),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&b&&(!d&&e.transform.projection.name!=="globe"||s)){let m=i.paint.get("fill-extrusion-opacity"),h=i.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=i.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=i.paint.get("fill-extrusion-flood-light-intensity"),Z=i.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),g=h>0&&W>0,u=p>0,G=(R,I,N)=>(1-N)*R+N*I,F=R=>{let I=e.depthModeForSublayer(1,Ot.ReadOnly,o.LEQUAL,!0),N=i.paint.get(R?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Y=G(.1,3,N),X=e._showOverdrawInspector;if(!X){let J=new ce({func:o.ALWAYS,mask:255},255,255,o.KEEP,o.KEEP,o.REPLACE),B=new Ne([o.ONE,o.ONE,o.ONE,o.ONE],re.transparent,[!1,!1,!1,!0],o.MIN);fd(e,t,i,n,I,J,B,me.disabled,R,"sdf",m,h,W,p,Z,Y,c,!1)}{let J=X?ce.disabled:new ce({func:o.EQUAL,mask:255},255,255,o.KEEP,o.DECR,o.DECR),B=X?e.colorModeForRenderPass():new Ne([o.ONE_MINUS_DST_ALPHA,o.DST_ALPHA,o.ONE,o.ONE],re.transparent,[!0,!0,!0,!0]);fd(e,t,i,n,I,J,B,me.disabled,R,"color",m,h,W,p,Z,Y,c,!1)}};if(s){let R=(I,N,Y)=>{let X=e.depthModeForSublayer(1,Ot.ReadOnly,o.LEQUAL,!1),J=i.paint.get(I?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),B=G(.1,3,J);{let C=new Ne([o.ONE,o.ONE,o.ONE,o.ONE],re.transparent,[!1,!1,!1,!0]);fd(e,t,i,n,X,ce.disabled,C,me.disabled,I,"clear",m,h,W,p,Z,B,c,N)}{let C=new ce({func:o.ALWAYS,mask:255},255,255,o.KEEP,o.KEEP,o.REPLACE),Q=new Ne([o.ONE,o.ONE,o.ONE,o.ONE],re.transparent,[!1,!1,!1,!0],o.MIN);fd(e,t,i,n,X,C,Q,me.disabled,I,"sdf",m,h,W,p,Z,B,c,N)}{let C=I?o.ZERO:o.ONE_MINUS_DST_ALPHA,Q=new ce({func:o.EQUAL,mask:255},255,255,o.KEEP,o.DECR,o.DECR),y=new Ne([C,o.DST_ALPHA,o.ONE_MINUS_DST_ALPHA,o.ZERO],re.transparent,[!0,!0,!0,!0]);fd(e,t,i,n,X,Q,y,me.disabled,I,"color",m,h,W,p,Z,B,c,N)}{let C=new Ne([o.ONE,o.ONE,o.ONE,I?o.ZERO:o.ONE],re.transparent,[!1,!1,!1,!0],I?o.FUNC_ADD:o.MAX);fd(e,t,i,n,X,ce.disabled,C,me.disabled,I,"clear",m,h,W,p,Z,B,c,N,Y)}};if(g||u){let I;if(e.prepareDrawTile(),d){let N=d.drapeBufferSize[0],Y=d.drapeBufferSize[1];I=d.framebufferCopyTexture,I&&(!I||I.size[0]===N&&I.size[1]===Y)||(I&&I.destroy(),I=d.framebufferCopyTexture=new bi(l,new Yi({width:N,height:Y}),o.RGBA)),I.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,N,Y,0)}g&&R(!0,!1,I),u&&R(!1,!0,I)}}else g&&F(!0),u&&F(!1)}}},hillshade:function(e,t,i,n){if(e.renderPass!=="offscreen"&&e.renderPass!=="translucent"||e.style.disableElevatedTerrain)return;let a=e.context,l=e.terrain&&e.terrain.renderingToTexture,[o,d]=e.renderPass!=="translucent"||l?[{},n]:e.stencilConfigForOverlap(n);for(let s of d){let r=t.getTile(s);if(r.needsHillshadePrepare&&e.renderPass==="offscreen")j2(e,r,i);else if(e.renderPass==="translucent"){let c=e.depthModeForSublayer(0,Ot.ReadOnly),b=i.paint.get("hillshade-emissive-strength"),m=e.colorModeForDrapableLayerRenderPass(b),h=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(s):o[s.overscaledZ];w2(e,s,r,i,c,h,m)}}a.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,i,n,a,l){if(e.renderPass!=="translucent"||i.paint.get("raster-opacity")===0)return;let o=e.context,d=o.gl,s=t.getSource(),r=function(N,Y,X){let J=N.paint.get("raster-color"),B=[],C=N.paint.get("raster-resampling"),Q=N.paint.get("raster-color-mix"),y=N.paint.get("raster-color-range"),z=[Q[0],Q[1],Q[2],0],E=Q[3],O=C==="nearest"?X.NEAREST:X.LINEAR;if(J&&B.push("RASTER_COLOR"),J){Y.activeTexture.set(X.TEXTURE2);let f=N.colorRampTexture;f||(f=N.colorRampTexture=new bi(Y,N.colorRamp,X.RGBA)),f.bind(X.LINEAR,X.CLAMP_TO_EDGE)}return{mix:z,range:y,offset:E,defines:B,resampling:O}}(i,o,d),c=r.defines,b=e.transform.projection.name==="globe",m=!1;if(s instanceof oa&&!n.length){if(!b)return;if(s.onNorthPole)m=!0,c.push("GLOBE_POLES");else{if(!s.onSouthPole)return;m=!0,c.push("GLOBE_POLES")}}let h=i.paint.get("raster-emissive-strength"),W=e.colorModeForDrapableLayerRenderPass(h),p=e.terrain&&e.terrain.renderingToTexture,Z=s instanceof oa&&i.paint.get("raster-elevation")!==0,g=!e.options.moving,u=i.paint.get("raster-resampling")==="nearest"?d.NEAREST:d.LINEAR;if(m){let N=t.getSource();if(!(N instanceof oa))return;let Y=N.texture;if(!Y)return;let X=e.globeSharedBuffers;if(!X)return;let J=new Ot(d.LEQUAL,Ot.ReadWrite,e.depthRangeFor3D),B=Float32Array.from(e.transform.expandedFarZProjMatrix),C=Rg(0,0,e.transform),Q=Float32Array.from(Tl(jn(new ia(0,0,0)))),y={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),o.activeTexture.set(d.TEXTURE0),Y.bind(u,d.CLAMP_TO_EDGE),o.activeTexture.set(d.TEXTURE1),Y.bind(u,d.CLAMP_TO_EDGE),Y.useMipmap&&o.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax);let[z,E,O,f]=X.getPoleBuffers(0,!0),L;N.onNorthPole?(L=z,e.renderDefaultNorthPole=!1):(C=D.scale(D.create(),C,[1,-1,1]),L=E,e.renderDefaultSouthPole=!1);let K=((P,et,it,at,$,ot,Rt,Gt,Yt,Bt,Dt,ft)=>lF(P,et,it,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,at,$,ot||[0,0],Rt,2,Yt,Bt,Dt,1,0,ft))(B,Q,C,y,i,N.perspectiveTransform||[0,0],i.paint.get("raster-elevation"),0,r.mix,r.offset,r.range,h),q=e.getOrCreateProgram("raster",{defines:r.defines});return e.uploadCommonUniforms(o,q,null),void q.draw(e,d.TRIANGLES,J,ce.disabled,W,me.disabled,K,i.id,L,O,f)}if(!n.length)return;let[G,F]=s instanceof oa||p?[{},n]:e.stencilConfigForOverlap(n),R=F[F.length-1].overscaledZ,I=Z&&b;I&&r.defines.push("PROJECTION_GLOBE_VIEW"),Z&&r.defines.push("RENDER_CUTOFF");for(let N of F){let Y=N.toUnwrapped(),X=t.getTile(N);if(p&&(!X||!X.hasData())||!X.texture)continue;let J,B;p?(J=Ot.disabled,B=N.projMatrix):Z?(J=new Ot(d.LEQUAL,Ot.ReadWrite,e.depthRangeFor3D),B=b?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(Y,g)):(J=e.depthModeForSublayer(N.overscaledZ-R,i.paint.get("raster-opacity")===1?Ot.ReadWrite:Ot.ReadOnly,d.LESS),B=e.transform.calculateProjMatrix(Y,g));let C=e.terrain&&p?e.terrain.stencilModeForRTTOverlap(N):G[N.overscaledZ],Q=l?0:i.paint.get("raster-fade-duration");X.registerFadeDuration(Q);let y=t.findLoadedParent(N,0),z=PG(X,y,t,e.transform,Q),E,O;e.terrain&&e.terrain.prepareDrawTile(),o.activeTexture.set(d.TEXTURE0),X.texture&&X.texture.bind(u,d.CLAMP_TO_EDGE),o.activeTexture.set(d.TEXTURE1),y?(y.texture&&y.texture.bind(u,d.CLAMP_TO_EDGE),E=Math.pow(2,y.tileID.overscaledZ-X.tileID.overscaledZ),O=[X.tileID.canonical.x*E%1,X.tileID.canonical.y*E%1]):X.texture&&X.texture.bind(u,d.CLAMP_TO_EDGE),X.texture&&X.texture.useMipmap&&o.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax);let f=e.transform,L=s instanceof oa?s.perspectiveTransform:[0,0],K=Z?Fy(f):[0,0,0,0],q,P,et,it,at,$;if(I&&s instanceof oa&&s.coordinates.length>3){q=Float32Array.from(Tl(jn(new ia(0,0,0)))),P=Float32Array.from(f.globeMatrix),et=Float32Array.from(ug(f)),it=[Qi(f.center.lng),Li(f.center.lat)],$=[Qi(s.coordinates[1][0]),Li(s.coordinates[1][1]),Qi(s.coordinates[3][0]),Li(s.coordinates[3][1])];let Yt=new Tn(s.coordinates[1],s.coordinates[3]);at=Float32Array.from(Fg(new ia(0,0,0),Yt,0,f.worldSize/e.transform._pixelsPerMercatorPixel))}else q=new Float32Array(16),P=new Float32Array(9),et=new Float32Array(16),it=[0,0],at=new Float32Array(16),$=[0,0,0,0];let ot=lF(B,q,P,et,at,O||[0,0],$,Di(e.transform.zoom),it,K,E||1,z,i,L,Z?i.paint.get("raster-elevation"):0,2,r.mix,r.offset,r.range,1,0,h),Rt=e.isTileAffectedByFog(N),Gt=e.getOrCreateProgram("raster",{defines:r.defines,overrideFog:Rt});if(e.uploadCommonUniforms(o,Gt,Y),s instanceof oa){if(p||!b)s.boundsBuffer&&s.boundsSegments&&Gt.draw(e,d.TRIANGLES,J,ce.disabled,W,me.disabled,ot,i.id,s.boundsBuffer,e.quadTriangleIndexBuffer,s.boundsSegments);else if(e.globeSharedBuffers){let[Yt,Bt,Dt]=e.globeSharedBuffers.getGridBuffers(0,!1);Gt.draw(e,d.TRIANGLES,J,ce.disabled,W,me.frontCCW,ot,i.id,Yt,Bt,Dt),Gt.draw(e,d.TRIANGLES,J,ce.disabled,W,me.backCCW,ot,i.id,Yt,Bt,Dt)}}else{let{tileBoundsBuffer:Yt,tileBoundsIndexBuffer:Bt,tileBoundsSegments:Dt}=e.getTileBoundsBuffers(X);Gt.draw(e,d.TRIANGLES,J,C,W,me.disabled,ot,i.id,Yt,Bt,Dt)}}e.resetStencilClippingMasks()},background:function(e,t,i,n){let a=i.paint.get("background-color"),l=i.paint.get("background-opacity"),o=i.paint.get("background-emissive-strength");if(l===0)return;let d=e.context,s=d.gl,r=e.transform,c=r.tileSize,b=i.paint.get("background-pattern");if(e.isPatternMissing(b,i.scope))return;let m=!b&&a.a===1&&l===1&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==m)return;let h=ce.disabled,W=e.depthModeForSublayer(0,m==="opaque"?Ot.ReadWrite:Ot.ReadOnly),p=e.colorModeForDrapableLayerRenderPass(o),Z=b?"backgroundPattern":"background",g,u=n;u||(g=e.getBackgroundTiles(),u=Object.values(g).map(G=>G.tileID)),b&&(d.activeTexture.set(s.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(let G of u){let F=e.isTileAffectedByFog(G),R=e.getOrCreateProgram(Z,{overrideFog:F}),I=G.toUnwrapped(),N=n?G.projMatrix:e.transform.calculateProjMatrix(I);e.prepareDrawTile();let Y=t?t.getTile(G):g?g[G.key]:new Ks(G,c,r.zoom,e),X=b?my(N,o,l,e,b,i.scope,{tileID:G,tileSize:c}):by(N,o,l,a);e.uploadCommonUniforms(d,R,I);let{tileBoundsBuffer:J,tileBoundsIndexBuffer:B,tileBoundsSegments:C}=e.getTileBoundsBuffers(Y);R.draw(e,s.TRIANGLES,W,h,p,me.disabled,X,i.id,J,B,C)}},sky:function(e,t,i){let n=e._atmosphere?Di(e.transform.zoom):1,a=i.paint.get("sky-opacity")*n;if(a===0)return;let l=e.context,o=i.paint.get("sky-type"),d=new Ot(l.gl.LEQUAL,Ot.ReadOnly,[0,1]),s=e.frameCounter/1e3%1;o==="atmosphere"?e.renderPass==="offscreen"?i.needsSkyboxCapture(e)&&(function(r,c,b,m){let h=r.context,W=h.gl,p=c.skyboxFbo;if(!p){p=c.skyboxFbo=h.createFramebuffer(32,32,!0,null),c.skyboxGeometry=new VF(h),c.skyboxTexture=h.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,c.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let G=0;G<6;++G)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+G,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}h.bindFramebuffer.set(p.framebuffer),h.viewport.set([0,0,32,32]);let Z=c.getCenter(r,!0),g=r.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);D.identity(u),D.rotateY(u,u,.5*-Math.PI),zd(r,c,g,u,Z,0),D.identity(u),D.rotateY(u,u,.5*Math.PI),zd(r,c,g,u,Z,1),D.identity(u),D.rotateX(u,u,.5*-Math.PI),zd(r,c,g,u,Z,2),D.identity(u),D.rotateX(u,u,.5*Math.PI),zd(r,c,g,u,Z,3),D.identity(u),zd(r,c,g,u,Z,4),D.identity(u),D.rotateY(u,u,Math.PI),zd(r,c,g,u,Z,5),h.viewport.set([0,0,r.width,r.height])}(e,i),i.markSkyboxValid(e)):e.renderPass==="sky"&&function(r,c,b,m,h){let W=r.context,p=W.gl,Z=r.transform,g=r.getOrCreateProgram("skybox");W.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_CUBE_MAP,c.skyboxTexture);let u=((G,F,R,I,N)=>({u_matrix:G,u_sun_direction:F,u_cubemap:0,u_opacity:I,u_temporal_offset:N}))(Z.skyboxMatrix,c.getCenter(r,!1),0,m,h);r.uploadCommonUniforms(W,g),g.draw(r,p.TRIANGLES,b,ce.disabled,r.colorModeForRenderPass(),me.backCW,u,"skybox",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}(e,i,d,a,s):o==="gradient"&&e.renderPass==="sky"&&function(r,c,b,m,h){let W=r.context,p=W.gl,Z=r.transform,g=r.getOrCreateProgram("skyboxGradient");c.skyboxGeometry||(c.skyboxGeometry=new VF(W)),W.activeTexture.set(p.TEXTURE0);let u=c.colorRampTexture;u||(u=c.colorRampTexture=new bi(W,c.colorRamp,p.RGBA)),u.bind(p.LINEAR,p.CLAMP_TO_EDGE);let G=((F,R,I,N,Y)=>({u_matrix:F,u_color_ramp:0,u_center_direction:R,u_radius:At(I),u_opacity:N,u_temporal_offset:Y}))(Z.skyboxMatrix,c.getCenter(r,!1),c.paint.get("sky-gradient-radius"),m,h);r.uploadCommonUniforms(W,g),g.draw(r,p.TRIANGLES,b,ce.disabled,r.colorModeForRenderPass(),me.backCW,G,"skyboxGradient",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}(e,i,d,a,s)},debug:function(e,t,i){for(let n=0;n<i.length;n++)Xy(e,t,i[n])},custom:function(e,t,i,n){let a=e.context,l=i.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||e.renderPass==="offscreen")&&i.isLayerDraped(t)){if(e.renderPass==="offscreen"){let o=l.prerender;if(o){if(e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),e.transform.projection.name==="globe"){let d=e.transform.pointMerc;o.call(l,a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Di(e.transform.zoom),[d.x,d.y],e.transform.pixelsPerMeterRatio)}else o.call(l,a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState()}}else if(e.renderPass==="translucent"){if(e.terrain&&e.terrain.renderingToTexture){let d=l.renderToTile;if(d){let s=n[0].canonical,r=new Re(s.x+n[0].wrap*(1<<s.z),s.y,s.z);a.setDepthMode(Ot.disabled),a.setStencilMode(ce.disabled),a.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),d.call(l,a.gl,r),a.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),a.setColorMode(e.colorModeForRenderPass()),a.setStencilMode(ce.disabled);let o=l.renderingMode==="3d"?new Ot(e.context.gl.LEQUAL,Ot.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Ot.ReadOnly);if(a.setDepthMode(o),e.transform.projection.name==="globe"){let d=e.transform.pointMerc;l.render(a.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),Di(e.transform.zoom),[d.x,d.y],e.transform.pixelsPerMeterRatio)}else l.render(a.gl,e.transform.customLayerMatrix());a.setDirty(),e.setBaseState(),a.bindFramebuffer.set(null)}}else A("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,i,n){if(e.renderPass==="opaque")return;let a=i.paint.get("model-opacity");if(a===0)return;let l=i.paint.get("model-cast-shadows");if(e.renderPass==="shadow"&&(!l||e.terrain&&a<.65&&i._transitionablePaint._values["model-opacity"].value.expression instanceof Ul))return;let o=e.shadowRenderer,d=i.paint.get("model-receive-shadows");o&&(o.useNormalOffset=!0,d||(o.enabled=!1));let s=()=>{o&&(o.useNormalOffset=!0,d||(o.enabled=!0))},r=t.getSource();if(e.renderPass==="light-beam"&&r.type!=="batched-model")return;if(r.type==="vector"||r.type==="geojson")return function(g,u,G,F){let R=g.transform;if(R.projection.name!=="mercator")return void A("Drawing 3D models for ".concat(R.projection.name," projection is not yet implemented"));let I=R.getFreeCameraOptions().position;if(!g.modelManager)return;let N=g.modelManager,Y=g.shadowRenderer;if(!G._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let X=G._unevaluatedLayout._values["model-id"],J={...G.layout.get("model-id").parameters};for(let B of F){let C=u.getTile(B).getBucket(G);if(!C||C.projection.name!==R.projection.name)continue;let Q=Sy(B,R);J.zoom=Q;let y=X.possiblyEvaluate(J);if(ky(g,C,B),za.shadowUniformsInitialized=!1,za.useSingleShadowCascade=!!Y&&Y.getMaxCascadeForTile(B.toUnwrapped())===0,g.renderPass==="shadow"&&Y){if(g.currentShadowCascade===1&&C.isInsideFirstShadowMapFrustum)continue;let O=R.calculatePosMatrix(B.toUnwrapped(),R.worldSize);if(za.tileMatrix.set(O),za.shadowTileMatrix=Float32Array.from(Y.calculateShadowPassMatrixFromMatrix(O)),za.aabb.min.fill(0),za.aabb.max[0]=za.aabb.max[1]=tt,za.aabb.max[2]=0,vy(C,za,g,G.scope))continue}let z=1<<B.canonical.z,E=[((I.x-B.wrap)*z-B.canonical.x)*tt,(I.y*z-B.canonical.y)*tt,I.z*z*tt];for(let O in C.instancesPerModel){let f=C.instancesPerModel[O];f.features.length>0&&(O=y.evaluate(f.features[0].feature,{}));let L=N.getModel(O,G.scope);if(L&&L.uploaded)for(let K of L.nodes)RF(g,G,K,f,E,B,za)}}}(e,t,i,n),void s();if(!r.loaded())return;if(r.type==="batched-model")return function(g,u,G,F){let R=g.context,I=g.transform,N=g.style.fog,Y=g.shadowRenderer;if(I.projection.name!=="mercator")return void A("Drawing 3D landmark models for ".concat(I.projection.name," projection is not yet implemented"));let X=g.transform.getFreeCameraOptions().position,J=S.scale([],[X.x,X.y,X.z],g.transform.worldSize);S.negate(J,J);let B=D.identity([]),C=Sl(I.center.lat,I.zoom),Q=D.fromScaling([],[1,1,1/C]);D.translate(B,B,J);let y=G.paint.get("model-opacity"),z=new Ot(R.gl.LEQUAL,Ot.ReadWrite,g.depthRangeFor3D),E=new Ot(R.gl.LEQUAL,Ot.ReadOnly,g.depthRangeFor3D),O=function(f,L){for(let K of F){let q=u.getTile(K).getBucket(G);if(!q||!q.uploaded)continue;let P=!1;Y&&(P=Y.getMaxCascadeForTile(K.toUnwrapped())===0);let et=I.calculatePosMatrix(K.toUnwrapped(),I.worldSize),it=q.modelTraits;for(let at of q.getNodesInfo()){if(at.hiddenByReplacement||!at.node.meshes)continue;let $=at.node,ot=g.renderPass==="light-beam",Rt=[...et],Gt=at.evaluatedScale,Yt=0;g.terrain&&$.elevation&&(Yt=$.elevation*g.terrain.exaggeration()),D.translate(Rt,Rt,[($.anchor?$.anchor[0]:0)*(Gt[0]-1),($.anchor?$.anchor[1]:0)*(Gt[1]-1),Yt]),Gt!==pJ&&D.scale(Rt,Rt,Gt),D.multiply(Rt,Rt,$.matrix);let Bt=D.multiply([],Q,Rt);D.multiply(Bt,B,Bt);let Dt=D.invert([],Bt);D.transpose(Dt,Dt),D.scale(Dt,Dt,Qy);let ft=D.multiply([],I.expandedFarZProjMatrix,Rt);for(let xe=0;xe<$.meshes.length;++xe){let pe=$.meshes[xe],_t=xe===$.lightMeshIndex;if(_t){if(!ot&&!g.terrain&&g.shadowRenderer){g.currentLayer<g.firstLightBeamLayer&&(g.firstLightBeamLayer=g.currentLayer);continue}}else if(ot)continue;let jt={defines:[]},zt=[];wW(jt.defines,zt,pe,g),4&it||jt.defines.push("DIFFUSE_SHADED"),P&&jt.defines.push("SHADOWS_SINGLE_CASCADE");let ge=g.renderPass==="shadow";if(ge){jW(pe,Rt,g,G);continue}let Ie=null;if(N){let xi=gF(Rt,g.transform);if(Ie=new Float32Array(xi),I.projection.name!=="globe"){let Gi=pe.aabb.min,ai=pe.aabb.max,[Se,qi]=N.getOpacityForBounds(xi,Gi[0],Gi[1],ai[0],ai[1]);jt.overrideFog=Se>=Yo||qi>=Yo}}let se=g.getOrCreateProgram("model",jt);!ge&&Y&&(Y.useNormalOffset=!!pe.normalBuffer,Y.setupShadowsFromMatrix(Rt,se,Y.useNormalOffset)),g.uploadCommonUniforms(R,se,K.toUnwrapped(),Ie);let Oe=pe.material,Ri=Oe.pbrMetallicRoughness;Ri.metallicFactor=.9,Ri.roughnessFactor=.5;let Ee=0,ti=EW(new Float32Array(ft),new Float32Array(Bt),new Float32Array(Dt),g,y,Ri.baseColorFactor,Oe.emissiveFactor,Ri.metallicFactor,Ri.roughnessFactor,Oe,Ee,G);se.draw(g,R.gl.TRIANGLES,L&&!_t?z:E,ce.disabled,f?_t||y<1||at.hasTranslucentParts?Ne.alphaBlended:Ne.unblended:Ne.disabled,me.backCCW,ti,G.id,pe.vertexBuffer,pe.indexBuffer,pe.segments,G.paint,g.transform.zoom,void 0,zt)}}}};(function(f,L,K,q){let P=f.terrain?f.terrain.exaggeration():0,et=f.transform.zoom;for(let it of q){let at=L.getTile(it).getBucket(K);at&&(f.conflationActive&&at.updateReplacement(it,f.replacementSource),at.evaluateScale(f,K),f.terrain&&P>0&&at.elevationUpdate(f.terrain,P,it,K.source),at.needsReEvaluation(f,et,K)&&at.evaluate(K))}})(g,u,G,F),y===1?O(!0,!0):(O(!1,!0),O(!0,!1))}(e,t,i,n),void s();let c=r.getModels(),b=[],m=e.transform.getFreeCameraOptions().position,h=S.scale([],[m.x,m.y,m.z],e.transform.worldSize);S.negate(h,h);let W=[],p=[],Z=0;for(let g of c){let u=i.paint.get("model-rotation").constantOr(null),G=i.paint.get("model-scale").constantOr(null),F=i.paint.get("model-translation").constantOr(null);g.computeModelMatrix(e,u,G,F,!0,!0,!1);let R=D.identity([]),I=Sl(g.position.lat,e.transform.zoom),N=D.fromScaling([],[1,1,1/I]);D.translate(R,R,h),b.push({zScaleMatrix:N,negCameraPosMatrix:R});for(let Y of g.nodes)uF(e.transform,Y,g.matrix,e.transform.expandedFarZProjMatrix,Z,W,p);Z++}if(W.sort((g,u)=>u.depth-g.depth),e.renderPass!=="shadow"){if(a===1)for(let g of p)Tb(g,e,i,b[g.modelIndex],ce.disabled,e.colorModeForRenderPass());else{for(let g of p)Tb(g,e,i,b[g.modelIndex],ce.disabled,Ne.disabled);for(let g of p)Tb(g,e,i,b[g.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(let g of W)Tb(g,e,i,b[g.modelIndex],ce.disabled,e.colorModeForRenderPass());s()}else{for(let g of p)jW(g.mesh,g.nodeModelMatrix,e,i);for(let g of W)jW(g.mesh,g.nodeModelMatrix,e,i);s()}}},FF={modelUpload:function(e,t,i){let n=t.getSource();if(!n.loaded())return;if(n.type==="vector"||n.type==="geojson")return void(e.modelManager&&e.modelManager.upload(e,i));if(n.type==="batched-model")return;let a=n.getModels();for(let l of a)l.upload(e.context)}};class Ly{constructor(t,i,n){this.context=new aJ(t,i),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Fa.maxUnderzooming+Fa.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new GJ,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wy(this),this._wireframeDebugCache=new zy,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,i){let n=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _2(this,t));let a=this._terrain;this.transform.elevation=n?a:null,a.update(t,this.transform,i),this.transform.elevation&&!a.enabled&&(this.transform.elevation=null)}_updateFog(t){let i=t.fog;if(!i||this.transform.projection.name==="globe"||i.getOpacity(this.transform.pitch)<1||i.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[n,a]=i.getFovAdjustedRange(this.transform._fov);if(n>a)return void(this.transform.fogCullDistSq=null);let l=n+.78*(a-n);this.transform.fogCullDistSq=l*l}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*ee.devicePixelRatio,this.height=i*ee.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let n of this.style.order)this.style._mergedLayers[n].resize()}setup(){let t=this.context,i=new Mn;i.emplaceBack(0,0),i.emplaceBack(tt,0),i.emplaceBack(0,tt),i.emplaceBack(tt,tt),this.tileExtentBuffer=t.createVertexBuffer(i,Ml.members),this.tileExtentSegments=ze.simpleSegment(0,0,4,2);let n=new Mn;n.emplaceBack(0,0),n.emplaceBack(tt,0),n.emplaceBack(0,tt),n.emplaceBack(tt,tt),this.debugBuffer=t.createVertexBuffer(n,Ml.members),this.debugSegments=ze.simpleSegment(0,0,4,5);let a=new Mn;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(-1,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,Ml.members),this.viewportSegments=ze.simpleSegment(0,0,4,2);let l=new Zo;l.emplaceBack(0,0,0,0),l.emplaceBack(tt,0,tt,0),l.emplaceBack(0,tt,0,tt),l.emplaceBack(tt,tt,tt,tt),this.mercatorBoundsBuffer=t.createVertexBuffer(l,lW.members),this.mercatorBoundsSegments=ze.simpleSegment(0,0,4,2);let o=new yi;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);let d=new Xs;for(let r of[0,1,3,2,0])d.emplaceBack(r);this.debugIndexBuffer=t.createIndexBuffer(d),this.emptyTexture=new bi(t,new Yi({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=D.create();let s=this.context.gl;this.stencilClearMode=new ce({func:s.ALWAYS,mask:0},0,255,s.ZERO,s.ZERO,s.ZERO),this.loadTimeStamps.push(T.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ot.disabled,this.stencilClearMode,Ne.disabled,me.disabled,LW(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,n){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!n||n.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let d=!1;for(let s of n)if(this._tileClippingMaskIDs[s.key]===void 0){d=!0;break}if(!d)return}this.currentStencilSource=i.id;let a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Ne.disabled),a.setDepthMode(Ot.disabled);let o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let d of n){let s=i.getTile(d),r=this._tileClippingMaskIDs[d.key]=this.nextStencilID++,{tileBoundsBuffer:c,tileBoundsIndexBuffer:b,tileBoundsSegments:m}=this.getTileBoundsBuffers(s);o.draw(this,l.TRIANGLES,Ot.disabled,new ce({func:l.ALWAYS,mask:0},r,255,l.KEEP,l.KEEP,l.REPLACE),Ne.disabled,me.disabled,LW(d.projMatrix),"$clipping",c,b,m)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,i=this.context.gl;return new ce({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let i=this.context.gl;return new ce({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){let i=this.context.gl,n=t.sort((o,d)=>d.overscaledZ-o.overscaledZ),a=n[n.length-1].overscaledZ,l=n[0].overscaledZ-a+1;if(l>1){this.currentStencilSource=void 0,this.nextStencilID+l>256&&this.clearStencil();let o={};for(let d=0;d<l;d++)o[d+a]=new ce({func:i.GEQUAL,mask:255},d+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=l,[o,n]}return[{[a]:ce.disabled},n]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new Ne([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new re(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ne.unblended:Ne.alphaBlended}colorModeForDrapableLayerRenderPass(t){let i=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ne([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new re(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,i,n,a=!1){if(!this.opaquePassEnabledForLayer()&&!a)return Ot.disabled;let l=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ot(n||this.context.gl.LEQUAL,i,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=i;let n=this.style._mergedLayers,a=this.style.order,l=a.map(R=>n[R]),o=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(ee.now()),this.imageManager.beginFrame();let d=0,s=!1;for(let R in o){let I=o[R];I.used&&(I.prepare(this.context),I.getSource().usedInConflation&&++d)}let r={},c={},b={},m={},h={};for(let R in o){let I=o[R];r[R]=I.getVisibleCoordinates(),c[R]=r[R].slice().reverse(),b[R]=I.getVisibleCoordinates(!0).reverse(),m[R]=I.getShadowCasterCoordinates(),h[R]=I.sortCoordinatesByDistance(r[R])}let W=R=>{let I=this.style.getLayerSourceCache(R);return I&&I.used?I.getSource():null};if(d){let R=[];for(let I of l)this.layerUsedInConflation(I,W(I))&&R.push(I);if(R&&R.length>1){let I=[];for(let N of R){let Y=this.style.getLayerSourceCache(N);Y&&Y.used&&Y.getSource().usedInConflation&&I.push({layer:N.fqid,cache:Y})}this.replacementSource.setSources(I),s=!0}}s||this.replacementSource.clear(),this.conflationActive=s,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let R of l){let I=R.cutoffRange();if(this.longestCutoffRange=Math.max(I,this.longestCutoffRange),I>0){let N=W(R);N&&(this.minCutoffZoom=Math.max(N.minzoom,this.minCutoffZoom)),R.minzoom&&(this.minCutoffZoom=Math.max(R.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let R=0;R<l.length;R++)if(l[R].is3D()){this.opaquePassCutoff=R;break}let p=this.style&&this.style.fog;p?(this._fogVisible=p.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=p.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(b),this.opaquePassCutoff=0);let Z=this._shadowRenderer;if(Z){Z.updateShadowParameters(this.transform,this.style.directionalLight);for(let R in o)for(let I of r[R]){let N={min:0,max:0};this.terrain&&(N=this.terrain.getMinMaxForTile(I)||N),Z.addShadowReceiver(I.toUnwrapped(),N.min,N.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new uN(this.context));for(let R of l){if(R.isHidden(this.transform.zoom))continue;let I=t.getLayerSourceCache(R);this.uploadLayer(this,R,I)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ty),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Mr.has(this.context.gl))return;this.renderPass="offscreen";for(let R of l){let I=t.getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;let N=I?c[I.id]:void 0;(R.type==="custom"||R.type==="raster"||R.isSky()||N&&N.length)&&this.renderLayer(this,I,R,N)}this.depthRangeFor3D=[0,1-(l.length+2)*this.numSublayers*this.depthEpsilon];let g=this.terrain;g&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&g.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,m)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let u=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),G=(()=>{if(i.showOverdrawInspector)return re.black;if(this.style.fog&&this.transform.projection.supportsFog&&!u){let R=this.style.fog.properties.get("color").toArray01();return new re(...R)}if(this.style.fog&&this.transform.projection.supportsFog&&u){let R=this.style.fog.properties.get("space-color").toArray01();return new re(...R)}return re.transparent})();if(this.context.clear({color:G,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&u&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){let R=l[this.currentLayer],I=t.getLayerSourceCache(R);if(R.isSky())continue;let N=I?(R.is3D()?h:c)[I.id]:void 0;this._renderTileClippingMasks(R,I,N),this.renderLayer(this,I,R,N)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&u&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Di(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){let R=l[this.currentLayer],I=t.getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,I,R,I?c[I.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let F=0;for(Z&&(F=Z.getShadowCastingLayerCount());this.currentLayer<a.length;){let R=l[this.currentLayer],I=t.getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(g&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=g.renderBatch(this.currentLayer);continue}let N;if(I&&(N=(R.type==="symbol"?b:R.is3D()?h:c)[I.id]),this._renderTileClippingMasks(R,I,I?r[I.id]:void 0),this.renderLayer(this,I,R,N),!g&&Z&&F>0&&R.hasShadowPass()&&--F==0&&(Z.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Y=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Y;this.currentLayer++){let X=l[this.currentLayer];if(!X.hasLightBeamPass())continue;let J=t.getLayerSourceCache(X);this.renderLayer(this,J,X,J?c[J.id]:void 0)}this.currentLayer=Y,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let R=null;l.forEach(I=>{let N=t.getLayerSourceCache(I);N&&!I.isHidden(this.transform.zoom)&&N.getVisibleCoordinates().length&&(!R||R.getSource().maxzoom<N.getSource().maxzoom)&&(R=N)}),R&&this.options.showTileBoundaries&&GF.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){let I=R.transform.padding;pF(R,R.transform.height-(I.top||0),3,Iy),pF(R,I.bottom||0,3,Uy),ZF(R,I.left||0,3,xy),ZF(R,R.transform.width-(I.right||0),3,Ny);let N=R.transform.centerPoint;(function(Y,X,J,B){Cb(Y,X-1,J-10,2,20,B),Cb(Y,X-10,J-1,20,2,B)})(R,N.x,R.transform.height-N.y,Yy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(T.performance.now()),this.saveCanvasCopy()),s||(this.conflationActive=!1)}uploadLayer(t,i,n){this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&i.type==="custom")&&FF["".concat(i.type,"Upload")]&&FF["".concat(i.type,"Upload")](t,n,i.scope),this.gpuTimingEnd()}renderLayer(t,i,n,a){n.isHidden(this.transform.zoom)||(n.type==="background"||n.type==="sky"||n.type==="custom"||n.type==="model"||n.type==="raster"||a&&a.length)&&(this.id=n.id,this.gpuTimingStart(n),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(n.type)||t.terrain&&n.type==="custom")&&GF[n.type](t,i,n,a,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let i=this.context.extTimerQuery,n=this.context.gl,a=this.gpuTimers[t.id];a||(a=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:n.createQuery()}),a.calls++,n.beginQuery(i.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,i=this.context.gl,n=i.createQuery();this.deferredRenderGpuTimeQueries.push(n),i.beginQuery(t.TIME_ELAPSED_EXT,n)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let i={};for(let n in t){let a=t[n],l=this.context.extTimerQuery,o=l.getQueryParameter(a.query,this.context.gl.QUERY_RESULT)/1e6;l.deleteQueryEXT(a.query),i[n]=o}return i}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let i=this.context.extTimerQuery,n=this.context.gl,a=0;for(let l of t)a+=i.getQueryParameter(l,n.QUERY_RESULT)/1e6,i.deleteQueryEXT(l);return a}translatePosMatrix(t,i,n,a,l){if(!n[0]&&!n[1])return t;let o=l?a==="map"?this.transform.angle:0:a==="viewport"?-this.transform.angle:0;if(o){let r=Math.sin(o),c=Math.cos(o);n=[n[0]*c-n[1]*r,n[0]*r+n[1]*c]}let d=[l?n[0]:Uo(i,n[0],this.transform.zoom),l?n[1]:Uo(i,n[1],this.transform.zoom),0],s=new Float32Array(16);return D.translate(s,t,d),s}saveTileTexture(t){let i=t.size[0],n=this._tileTextures[i];n?n.push(t):this._tileTextures[i]=[t]}getTileTexture(t){let i=this._tileTextures[t];return i&&i.length>0?i.pop():null}isPatternMissing(t,i){return t===null||t!==void 0&&!this.imageManager.getPattern(t.toString(),i)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,i,n){let a=n===void 0?this.terrain&&this.terrain.renderingToTexture:n,l=this.terrain&&this.terrain.exaggeration()===0,o=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):a||o.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),l&&o.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&o.push("GLOBE"),!this._fogVisible||a||i!==void 0&&!i||o.push("FOG","FOG_DITHERING"),a&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(t,i){this.cache=this.cache||{};let n=i&&i.defines||[],a=i&&i.config,l=this.currentGlobalDefines(t,i&&i.overrideFog,i&&i.overrideRtt).concat(n),o=$G.cacheKey(AG[t],t,l,a);return this.cache[o]||(this.cache[o]=new $G(this.context,t,AG[t],a,hy[t],l)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=T.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new bi(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){let n=this.style.directionalLight,a=this.style.ambientLight;if(n&&a){let l=((o,d)=>{let s=o.properties.get("direction"),r=o.properties.get("color").toArray01(),c=o.properties.get("intensity"),b=d.properties.get("color").toArray01(),m=d.properties.get("intensity"),h=[s.x,s.y,s.z],W=Wi(b,m),p=Wi(r,c);return{u_lighting_ambient_color:W,u_lighting_directional_dir:h,u_lighting_directional_color:p,u_ground_radiance:K2(h,p,W)}})(n,a);i.setLightsUniformValues(t,l)}}}uploadCommonUniforms(t,i,n,a,l){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;let o=this.style.fog;if(o){let d=o.getOpacity(this.transform.pitch),s=((r,c,b,m,h,W,p,Z,g,u,G,F)=>{let R=r.transform,I=c.properties.get("color").toArray01();I[3]=m;let N=r.frameCounter/1e3%1,[Y,X]=c.properties.get("vertical-range");return{u_fog_matrix:b?R.calculateFogTileMatrix(b):F||r.identityMat,u_fog_range:c.getFovAdjustedRange(R._fov),u_fog_color:I,u_fog_horizon_blend:c.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Y,X),X],u_fog_temporal_offset:N,u_frustum_tl:h,u_frustum_tr:W,u_frustum_br:p,u_frustum_bl:Z,u_globe_pos:g,u_globe_radius:u,u_viewport:G,u_globe_transition:Di(R.zoom),u_is_globe:+(R.projection.name==="globe")}})(this,o,n,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ee.devicePixelRatio,this.transform.height*ee.devicePixelRatio],a);i.setFogUniformValues(t,s)}l&&i.setCutoffUniformValues(t,l.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),i}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,i=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(let a of n)i[a.key]=t[a.key]||new Ks(a,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,i){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||t.sourceLayer!=="building"&&(!i||i.type!=="batched-model"))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let i=this._cachedTileFogOpacities[t.key];return i||(this._cachedTileFogOpacities[t.key]=i=this.style.fog.getOpacityForTile(t)),i[0]>=Yo||i[1]>=Yo}}let yo=2048;class Ey{constructor(t,i){this.aabb=t,this.lastCascade=i}}class Ay{add(t,i){let n=this.receivers[t.key];n!==void 0?(n.aabb.min[0]=Math.min(n.aabb.min[0],i.min[0]),n.aabb.min[1]=Math.min(n.aabb.min[1],i.min[1]),n.aabb.min[2]=Math.min(n.aabb.min[2],i.min[2]),n.aabb.max[0]=Math.max(n.aabb.max[0],i.max[0]),n.aabb.max[1]=Math.max(n.aabb.max[1],i.max[1]),n.aabb.max[2]=Math.max(n.aabb.max[2],i.max[2])):this.receivers[t.key]=new Ey(i,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,i,n){let a=$e.fromPoints(t.points),l=0;for(let o in this.receivers){let d=this.receivers[o];if(!d||!a.intersectsAabb(d.aabb))continue;d.aabb.min=a.closestPoint(d.aabb.min),d.aabb.max=a.closestPoint(d.aabb.max);let s=d.aabb.getCorners();for(let r=0;r<n.length;r++){let c=!0;for(let b of s){let m=[b[0]*i,b[1]*i,b[2]];if(S.transformMat4(m,m,n[r].matrix),m[0]<-1||m[0]>1||m[1]<-1||m[1]>1){c=!1;break}}if(d.lastCascade=r,l=Math.max(l,r),c)break}}return l+1}}class wy{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ay,this._depthMode=new Ot(t.context.gl.LEQUAL,Ot.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){let n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;let a=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||a<=0||(this._shadowLayerCount=n.style.order.reduce((h,W)=>{let p=n.style._mergedLayers[W];return h+(p.hasShadowPass()&&!p.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let l=n.context,o=yo,d=yo;if(this._cascades.length===0)for(let h=0;h<2;++h){let W=n._shadowMapDebug,p=l.gl,Z=l.createFramebuffer(o,d,W,"texture"),g=new bi(l,{width:o,height:d,data:null},p.DEPTH_COMPONENT);if(Z.depthAttachment.set(g.texture),W){let u=new bi(l,{width:o,height:d,data:null},p.RGBA);Z.colorAttachment.set(u.texture)}this._cascades.push({framebuffer:Z,texture:g,matrix:[],far:0,boundingSphereRadius:0,frustum:new ll,scale:0})}this.shadowDirection=IF(i);let s=0;if(t.elevation){let h=t.elevation,W=[1e4,-1e4];h.visibleDemTiles.filter(p=>p.dem).forEach(p=>{let Z=p.dem.tree;W[0]=Math.min(W[0],Z.minimums[0]),W[1]=Math.max(W[1],Z.maximums[0])}),W[0]!==1e4&&(s=(W[1]-W[0])*h.exaggeration())}let r=1.5*t.cameraToCenterDistance,c=3*r,b=new Float64Array(16);for(let h=0;h<2;++h){let W=this._cascades[h],p=t.height/50,Z=1;h===0?Z=r:(p=r,Z=c);let[g,u]=jy(t,this.shadowDirection,p,Z,yo,s);W.scale=t.scale,W.matrix=g,W.boundingSphereRadius=u,D.invert(b,W.matrix),W.frustum=ll.fromInvProjectionMatrix(b,1,0,!0),W.far=Z}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=a,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=yo,this._uniformValues.u_shadowmap_0=Qn.ShadowMap0,this._uniformValues.u_shadowmap_1=Qn.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let m=n.transform.elevation;for(let h of this._groundShadowTiles){let W={min:0,max:0};if(m){let p=m.getMinMaxForTile(h);p&&(W=p)}this.addShadowReceiver(h.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,i){if(!this._enabled)return;let n=this.painter,a=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),a.viewport.set([0,0,yo,yo]);for(let l=0;l<this._numCascadesToRender;++l){n.currentShadowCascade=l,a.bindFramebuffer.set(this._cascades[l].framebuffer.framebuffer),a.clear({color:re.white,depth:1});for(let o of t.order){let d=t._mergedLayers[o];if(!d.hasShadowPass()||d.isHidden(n.transform.zoom))continue;let s=t.getLayerSourceCache(d),r=s?i[s.id]:void 0;(d.type==="model"||r&&r.length)&&n.renderLayer(n,s,d,r)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let t=this.painter,i=t.style,n=t.context,a=i.directionalLight,l=i.ambientLight;if(!a||!l)return;let o=[],d=Qd(t,t.longestCutoffRange);d.shouldRenderCutoff&&o.push("RENDER_CUTOFF");let s=HW(a,l),r=new Ot(n.gl.LEQUAL,Ot.ReadOnly,t.depthRangeFor3D);for(let c of this._groundShadowTiles){let b=c.toUnwrapped(),m=t.isTileAffectedByFog(c),h=t.getOrCreateProgram("groundShadow",{defines:o,overrideFog:m});this.setupShadows(b,h),t.uploadCommonUniforms(n,h,b,null,d);let W={u_matrix:t.transform.calculateProjMatrix(b),u_ground_shadow_factor:s};h.draw(t,n.gl.TRIANGLES,r,ce.disabled,Ne.multiply,me.disabled,W,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ne.unblended:Ne.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let i=this.painter.transform,n=i.calculatePosMatrix(t,i.worldSize);return D.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(t){return D.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,n,a=0){if(!this._enabled)return;let l=this.painter.transform,o=this.painter.context,d=o.gl,s=this._uniformValues,r=new Float64Array(16),c=l.calculatePosMatrix(t,l.worldSize);for(let b=0;b<2;b++)D.multiply(r,this._cascades[b].matrix,c),s[b===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(r),o.activeTexture.set(d.TEXTURE0+Qn.ShadowMap0+b),this._cascades[b].texture.bind(d.NEAREST,d.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){let b=Ss(t.canonical),m=2/l.tileSize*tt/yo,h=m*this._cascades[0].boundingSphereRadius,W=m*this._cascades[1].boundingSphereRadius,p=(n==="vector-tile"?1:3)/Math.pow(2,a-t.canonical.z-(1-l.zoom+Math.floor(l.zoom)));s.u_shadow_normal_offset=[b,h*p,W*p],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(o,s)}setupShadowsFromMatrix(t,i,n=!1){if(!this._enabled)return;let a=this.painter.context,l=a.gl,o=this._uniformValues,d=new Float64Array(16);for(let s=0;s<2;s++)D.multiply(d,this._cascades[s].matrix,t),o[s===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(d),a.activeTexture.set(l.TEXTURE0+Qn.ShadowMap0+s),this._cascades[s].texture.bind(l.NEAREST,l.CLAMP_TO_EDGE);this.useNormalOffset=n,n?(o.u_shadow_normal_offset=[1,5,5],o.u_shadow_bias=[6e-5,.0012,.012]):o.u_shadow_bias=[36e-5,.0012,.012],i.setShadowUniformValues(a,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,n,a){if(a[2]>=0)return{};let l=function(s,r,c){let b=c/(1<<s.canonical.z);return new $e([s.canonical.x*b+s.wrap*c,s.canonical.y*b+s.wrap*c,0],[(s.canonical.x+1)*b+s.wrap*c,(s.canonical.y+1)*b+s.wrap*c,r])}(t,i,n).getCorners(),o=i/-a[2];a[0]<0?(S.add(l[0],l[0],[a[0]*o,0,0]),S.add(l[3],l[3],[a[0]*o,0,0])):a[0]>0&&(S.add(l[1],l[1],[a[0]*o,0,0]),S.add(l[2],l[2],[a[0]*o,0,0])),a[1]<0?(S.add(l[0],l[0],[0,a[1]*o,0]),S.add(l[1],l[1],[0,a[1]*o,0])):a[1]>0&&(S.add(l[2],l[2],[0,a[1]*o,0]),S.add(l[3],l[3],[0,a[1]*o,0]));let d={};return d.vertices=l,d.planes=[kb(l[1],l[0],l[4]),kb(l[2],l[1],l[5]),kb(l[3],l[2],l[6]),kb(l[0],l[3],l[7])],d}addShadowReceiver(t,i,n){this._receivers.add(t,$e.fromTileIdAndHeight(t,i,n))}getMaxCascadeForTile(t){let i=this._receivers.get(t);return i&&i.lastCascade?i.lastCascade:0}}function kb(e,t,i){let n=S.sub([],i,t),a=S.sub([],e,t),l=S.cross([],n,a),o=S.length(l);return o===0?[0,0,1,0]:(S.scale(l,l,1/o),[l[0],l[1],l[2],-S.dot(l,t)])}function IF(e){let t=e.properties.get("direction"),i=Qt(t.x,t.y,t.z);i[2]=Mt(i[2],0,75);let n=xt([i[0],i[1],i[2]]);return S.fromValues(n.x,n.y,n.z)}function HW(e,t){let i=e.properties.get("color"),n=e.properties.get("intensity"),a=e.properties.get("direction"),l=[a.x,a.y,a.z],o=t.properties.get("color"),d=t.properties.get("intensity"),s=Math.max(S.dot([0,0,1],l),0),r=[0,0,0];S.scale(r,o.toArray01Linear().slice(0,3),d);let c=[0,0,0];return S.scale(c,i.toArray01Linear().slice(0,3),s*n),Ii([r[0]>0?r[0]/(r[0]+c[0]):0,r[1]>0?r[1]/(r[1]+c[1]):0,r[2]>0?r[2]/(r[2]+c[2]):0])}function jy(e,t,i,n,a,l){let o=e.zoom,d=e.scale,s=e.worldSize,r=1/s,c=e.aspect,b=Math.sqrt(1+c*c)*Math.tan(.5*e.fovX),m=b*b,h=n-i,W=n+i,p,Z;m>h/W?(p=n,Z=n*b):(p=.5*W*(1+m),Z=.5*Math.sqrt(h*h+2*(n*n+i*i)*m+W*W*m*m));let g=e.projection.pixelsPerMeter(e.center.lat,s),u=e._camera.getCameraToWorldMercator(),G=[0,0,-p*r];S.transformMat4(G,G,u);let F=Z*r,R=e._edgeInsets;if(!(R.left===0&&R.top===0&&R.right===0&&R.bottom===0||R.left===R.right&&R.top===R.bottom)){let q=e._camera.getWorldToCamera(e.worldSize,e.projection.zAxisUnit==="meters"?g:1),P=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,i,n);P[8]=2*-e.centerOffset.x/e.width,P[9]=2*e.centerOffset.y/e.height;let et=new Float64Array(16);D.mul(et,P,q);let it=new Float64Array(16);D.invert(it,et);let at=ll.fromInvProjectionMatrix(it,s,o,!0);for(let $ of at.points){let ot=((I=$)[0]/=d,I[1]/=d,I[2]=He(I[2],e._center.lat),I);F=Math.max(F,S.len(S.subtract([],G,ot)))}}var I;F*=a/(a-1);let N=Math.acos(t[2]),Y=Math.atan2(-t[0],-t[1]),X=new cb;X.position=G,X.setPitchBearing(N,Y);let J=X.getWorldToCamera(s,g),B=F*s,C=Math.min(e._mercatorZfromZoom(17)*s*-2,-2*B),Q=X.getCameraToClipOrthographic(-B,B,-B,B,C,(B+l*g)/t[2]),y=new Float64Array(16);D.multiply(y,Q,J);let z=S.fromValues(Math.floor(1e6*G[0])/1e6*s,Math.floor(1e6*G[1])/1e6*s,0),E=.5*a,O=[0,0,0];S.transformMat4(O,z,y),S.scale(O,O,E);let f=[Math.floor(O[0]),Math.floor(O[1]),Math.floor(O[2])],L=[0,0,0];S.sub(L,O,f),S.scale(L,L,-1/E);let K=new Float64Array(16);return D.identity(K),D.translate(K,K,L),D.multiply(y,K,y),[y,B]}class Hy extends Xi{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return VG(this.requestManager.transformRequest(i,nt.Model).url).then(n=>{if(!n)return;let a=BW(n),l=new hR(t,void 0,void 0,a);return l.computeBoundsAndApplyParent(),l}).catch(n=>{this.fire(new $t(new Error("Could not load model ".concat(t," from ").concat(i,": ").concat(n.message))))})}load(t,i){this.models[i]||(this.models[i]={});let n=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+n.length;let a=[];for(let l of n)a.push(this.loadModel(l,t[l]));Promise.allSettled(a).then(l=>{for(let o=0;o<l.length;o++){let{status:d,value:s}=l[o];d==="fulfilled"&&s&&(this.models[i][n[o]]=s)}this.numModelsLoading[i]-=n.length,this.fire(new Wt("data",{dataType:"style"}))}).catch(l=>{this.fire(new $t(new Error("Could not load models: ".concat(l.message))))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,i){return!!this.getModel(t,i)}getModel(t,i){return this.models[i]||(this.models[i]={}),this.models[i][t]}addModel(t,i,n){this.models[n]||(this.models[n]={}),this.hasModel(t,n)&&this.removeModel(t,n),this.load({[t]:this.requestManager.normalizeModelURL(i)},n)}addModels(t,i){let n={};for(let a in t)n[a]=this.requestManager.normalizeModelURL(t[a]);this.load(n,i)}removeModel(t,i){this.models[i]||(this.models[i]={});let n=this.models[i][t];delete this.models[i][t],n.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,i){this.models[i]||(this.models[i]={});for(let n in this.models[i])this.models[i][n].upload(t.context)}}let cr=(e,t)=>lc(e,t&&t.filter(i=>i.identifier!=="source.canvas")),Oy=Ci(Be,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),Dy=Ci(Be,["setCenter","setZoom","setBearing","setPitch"]),UF={version:8,layers:[],sources:{}},xF={duration:300,delay:0},_y=new Set(["fill","line","background","hillshade","raster"]);class xa extends Xi{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=Xt({},xF),this._buildingIndex=new g2(this),this.crossTileSymbolIndex=new L2,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new Bx,this.dispatcher=i.dispatcher?i.dispatcher:new Xo(dr(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new OJ,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new Xd(t._requestManager,i.localFontFamily?2:i.localIdeographFontFamily?1:0,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new Hy(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",ht());let n=this;this._rtlTextPluginCallback=xa.registerForPluginStateChange(a=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a.pluginStatus,pluginURL:a.pluginURL},(l,o)=>{if(xZ(l),o&&o.every(d=>d))for(let d in n._sourceCaches){let s=n._sourceCaches[d],r=s.getSource().type;r!=="vector"&&r!=="geojson"||s.reload()}})}),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;let l=this.getOwnSource(a.sourceId);if(l&&l.vectorLayerIds)for(let o in this._layers){let d=this._layers[o];d.source===l.id&&this._validateLayer(d)}})}loadURL(t,i={}){this.fire(new Wt("dataloading",{dataType:"style"}));let n=typeof i.validate=="boolean"?i.validate:!ve(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);let a=this.importsCache.get(t);if(a)return this._load(a,n);let l=this.map._requestManager.transformRequest(t,nt.Style);this._request=gt(l,(o,d)=>{if(this._request=null,o)this.fire(new $t(o));else if(d)return this.importsCache.set(t,d),this._load(d,n)})}loadJSON(t,i={}){this.fire(new Wt("dataloading",{dataType:"style"})),this._request=ee.frame(()=>{this._request=null,this._load(t,i.validate!==!1)})}loadEmpty(){this.fire(new Wt("dataloading",{dataType:"style"})),this._load(UF,!1)}_loadImports(t,i){if(this.importDepth>=4)return A("Style doesn't support nesting deeper than 5"),Promise.resolve();let n=[];for(let a of t){let l=this._createFragmentStyle(a),o=new Promise(s=>{l.once("style.import.load",s),l.once("error",s)}).then(()=>this.mergeAll());if(n.push(o),this.resolvedImports.has(a.url)){l.loadEmpty();continue}let d=a.data||this.importsCache.get(a.url);d?l.loadJSON(d,{validate:i}):a.url?l.loadURL(a.url,{validate:i}):l.loadEmpty(),this.fragments.push({style:l,id:a.id,config:a.config})}return Promise.allSettled(n)}_createFragmentStyle(t){let i=this.scope?mn(t.id,this.scope):t.id,n=new xa(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return n.setEventedParent(this.map,{style:n}),n}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Wt(t?"style.load":"style.import.load"))}_load(t,i){let n=t.schema;if(this.isRootStyle()&&(t.fragment||n&&t.fragment!==!1)){let o=Xt({},UF,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(o,i)}if(this.setConfig(this._config,n),i&&cr(this,rd(t)))return;this._loaded=!0,this.stylesheet=k(t);for(let o in t.sources)this.addSource(o,t.sources[o],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let a=FG(this.stylesheet.layers);if(this._order=a.map(o=>o.id),this.stylesheet.light&&A("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let o=this.stylesheet.lights[0];this.light=new _R(o.properties,o.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new _R(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let o of a){let d=gb(o,this.options);d.setScope(this.scope),d.isConfigDependent&&this._configDependentLayers.add(d.fqid),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();let s=this.getOwnLayerSourceCache(d),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&d.canCastShadows()&&r&&(s.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let l=this.stylesheet.terrain;l&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=ee.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?A("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(l,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Wt("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,i).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,i,n,a,l,o,d,s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{if(r.stylesheet){if(r.light!=null&&(t=r.light),r.stylesheet.lights)for(let c of r.stylesheet.lights)c.type==="ambient"&&r.ambientLight!=null&&(i=r.ambientLight),c.type==="directional"&&r.directionalLight!=null&&(n=r.directionalLight);a=this._prioritizeTerrain(a,r.terrain,r.stylesheet.terrain),r.stylesheet.fog&&r.fog!=null&&(l=r.fog),r.stylesheet.camera!=null&&(s=r.stylesheet.camera),r.stylesheet.projection!=null&&(o=r.stylesheet.projection),r.stylesheet.transition!=null&&(d=r.stylesheet.transition)}}),this.light=t,this.ambientLight=i,this.directionalLight=n,this.fog=l,a===null?delete this.terrain:this.terrain=a,this.camera=s||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=Xt({},xF,d),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let i=n=>{for(let a of n.fragments)i(a.style);t(n)};i(this)}_prioritizeTerrain(t,i,n){let a=t&&t.drapeRenderMode===0;return n===null?i&&i.drapeRenderMode===0?i:a?t:null:i!=null&&(!t||a||i&&i.drapeRenderMode===1)?i:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(i=>{t=this._prioritizeTerrain(t,i.terrain,i.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(i=>{i.stylesheet.projection!=null&&(t=i.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},i={},n={};this.forEachFragmentStyle(a=>{for(let l in a._sourceCaches){let o=mn(l,a.scope);t[o]=a._sourceCaches[l]}for(let l in a._otherSourceCaches){let o=mn(l,a.scope);i[o]=a._otherSourceCaches[l]}for(let l in a._symbolSourceCaches){let o=mn(l,a.scope);n[o]=a._symbolSourceCaches[l]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=n}mergeLayers(){let t={},i=[],n={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(l=>{for(let o of l._order){let d=l._layers[o];if(d.type==="slot"){let s=rc(o);if(t[s])continue;t[s]=[]}d.slot&&t[d.slot]?t[d.slot].push(d):i.push(d)}}),this._mergedOrder=[];let a=(l=[])=>{for(let o of l)if(o.type==="slot"){let d=rc(o.id);t[d]&&a(t[d])}else{let d=mn(o.id,o.scope);this._mergedOrder.push(d),n[d]=o,o.is3D()&&(this._has3DLayers=!0),o.type==="circle"&&(this._hasCircleLayers=!0),o.type==="symbol"&&(this._hasSymbolLayers=!0)}};a(i),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Xt({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(i,n,a){let l,o,d,s=ee.devicePixelRatio>1?"@2x":"",r=gt(n.transformRequest(n.normalizeSpriteURL(i,s,".json"),nt.SpriteJSON),(m,h)=>{r=null,d||(d=m,l=h,b())}),c=de(n.transformRequest(n.normalizeSpriteURL(i,s,".png"),nt.SpriteImage),(m,h)=>{c=null,d||(d=m,o=h,b())});function b(){if(d)a(d);else if(l&&o){let m=ee.getImageData(o),h={};for(let W in l){let{width:p,height:Z,x:g,y:u,sdf:G,pixelRatio:F,stretchX:R,stretchY:I,content:N}=l[W],Y=new Yi({width:p,height:Z});Yi.copy(m,Y,{x:g,y:u},{x:0,y:0},{width:p,height:Z}),h[W]={data:Y,pixelRatio:F,sdf:G,stretchX:R,stretchY:I,content:N}}a(null,h)}}return{cancel(){r&&(r.cancel(),r=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(i,n)=>{if(this._spriteRequest=null,i)this.fire(new $t(i));else if(n)for(let a in n)this.imageManager.addImage(a,this.scope,n[a]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Wt("data",{dataType:"style"}))})}_validateLayer(t){let i=this.getOwnSource(t.source);if(!i)return;let n=t.sourceLayer;n&&(i.type==="geojson"||i.vectorLayerIds&&i.vectorLayerIds.indexOf(n)===-1)&&this.fire(new $t(new Error('Source layer "'.concat(n,'" does not exist on source "').concat(i.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,i)=>{let n=this.fragments[i];return n&&n.style&&(t.data=n.style.serialize()),t})}_serializeSources(){let t={};for(let i in this._sourceCaches){let n=this._sourceCaches[i].getSource();t[n.id]||(t[n.id]=n.serialize())}return t}_serializeLayers(t){let i=[];for(let n of t){let a=this._layers[n];a&&a.type!=="custom"&&i.push(a.serialize())}return i}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&(typeof t.isLayerDraped=="function"?t.isLayerDraped(this.getLayerSourceCache(t)):_y.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let i=this.getOwnLayer(t);if(i)return i;this.fire(new $t(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){let i=this.getOwnSource(t);if(i)return i;this.fire(new $t(new Error("The source '".concat(t,"' does not exist in the map's style."))))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));let n=this._changes.isDirty();if(this._changes.isDirty()){let l=this._changes.getLayerUpdatesByScope();for(let o in l){let{updatedIds:d,removedIds:s}=l[o];(d||s)&&this._updateWorkerLayers(o,d,s)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let a={};for(let l in this._mergedSourceCaches){let o=this._mergedSourceCaches[l];a[l]=o.used,o.used=!1}for(let l of this._mergedOrder){let o=this._mergedLayers[l];if(o.recalculate(t,this._availableImages),!o.isHidden(t.zoom)){let d=this.getLayerSourceCache(o);d&&(d.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let d=o.minzoom||0;d<(o.maxzoom||25.5);d++){let s=this.map.painter;if(s){let r=o.getProgramIds();if(!r)continue;for(let c of r){let b=o.getDefaultProgramParams(c,t.zoom);b&&(s.style=this,this.fog&&(s._fogVisible=!0,b.overrideFog=!0,s.getOrCreateProgram(c,b)),s._fogVisible=!1,b.overrideFog=!1,s.getOrCreateProgram(c,b),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(b.overrideRtt=!0,s.getOrCreateProgram(c,b)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let l in a){let o=this._mergedSourceCaches[l];a[l]!==o.used&&o.getSource().fire(new Wt("data",{sourceDataType:"visibility",dataType:"source",sourceId:o.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new Wt("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let i in this._sourceCaches)this._sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,i,n){let a=this.getFragmentStyle(t);a&&this.dispatcher.broadcast("updateLayers",{layers:i?a._serializeLayers(i):[],scope:t,removedIds:n||[],options:a.options})}setState(t){if(this._checkLoaded(),cr(this,rd(t)))return!1;(t=k(t)).layers=FG(t.layers);let i=function(a,l){if(!a)return[{command:Be.setStyle,args:[l]}];let o=[];try{if(!te(a.version,l.version))return[{command:Be.setStyle,args:[l]}];te(a.center,l.center)||o.push({command:Be.setCenter,args:[l.center]}),te(a.zoom,l.zoom)||o.push({command:Be.setZoom,args:[l.zoom]}),te(a.bearing,l.bearing)||o.push({command:Be.setBearing,args:[l.bearing]}),te(a.pitch,l.pitch)||o.push({command:Be.setPitch,args:[l.pitch]}),te(a.sprite,l.sprite)||o.push({command:Be.setSprite,args:[l.sprite]}),te(a.glyphs,l.glyphs)||o.push({command:Be.setGlyphs,args:[l.glyphs]}),te(a.imports,l.imports)||function(b=[],m=[],h){m=m||[];let W=(b=b||[]).map(Ib),p=m.map(Ib),Z=b.reduce(Ub,{}),g=m.reduce(Ub,{}),u=W.slice(),G,F,R,I;for(G=0,F=0;G<W.length;G++)R=W[G],g.hasOwnProperty(R)?F++:(h.push({command:Be.removeImport,args:[R]}),u.splice(u.indexOf(R,F),1));for(G=0,F=0;G<p.length;G++)R=p[p.length-1-G],u[u.length-1-G]!==R&&(Z.hasOwnProperty(R)?(h.push({command:Be.removeImport,args:[R]}),u.splice(u.lastIndexOf(R,u.length-F),1)):F++,I=u[u.length-G],h.push({command:Be.addImport,args:[g[R],I]}),u.splice(u.length-G,0,R));for(let N of m){let Y=Z[N.id];if(!Y||te(Y,N))continue;te(Y.config,N.config)||h.push({command:Be.setImportConfig,args:[N.id,N.config]}),te(Y.url,N.url)||h.push({command:Be.setImportUrl,args:[N.id,N.url]});let X=N.data;te(Y&&Y.data,X)||h.push({command:Be.setImportData,args:[N.id,X]})}}(a.imports,l.imports,o),te(a.transition,l.transition)||o.push({command:Be.setTransition,args:[l.transition]}),te(a.light,l.light)||o.push({command:Be.setLight,args:[l.light]}),te(a.fog,l.fog)||o.push({command:Be.setFog,args:[l.fog]}),te(a.projection,l.projection)||o.push({command:Be.setProjection,args:[l.projection]}),te(a.lights,l.lights)||o.push({command:Be.setLights,args:[l.lights]}),te(a.camera,l.camera)||o.push({command:Be.setCamera,args:[l.camera]});let d={},s=[];(function(b,m,h,W){let p;for(p in m=m||{},b=b||{})b.hasOwnProperty(p)&&(m.hasOwnProperty(p)||UG(p,h,W));for(p in m){if(!m.hasOwnProperty(p))continue;let Z=m[p];b.hasOwnProperty(p)?te(b[p],Z)||(b[p].type==="geojson"&&Z.type==="geojson"&&G2(b,m,p)?h.push({command:Be.setGeoJSONSourceData,args:[p,Z.data]}):R2(p,m,h,W)):IG(p,m,h)}})(a.sources,l.sources,s,d);let r=[];a.layers&&a.layers.forEach(b=>{b.source&&d[b.source]?o.push({command:Be.removeLayer,args:[b.id]}):r.push(b)});let c=a.terrain;c&&d[c.source]&&(o.push({command:Be.setTerrain,args:[void 0]}),c=void 0),o=o.concat(s),te(c,l.terrain)||o.push({command:Be.setTerrain,args:[l.terrain]}),function(b,m,h){m=m||[];let W=(b=b||[]).map(Ib),p=m.map(Ib),Z=b.reduce(Ub,{}),g=m.reduce(Ub,{}),u=W.slice(),G=Object.create(null),F,R,I,N,Y,X,J;for(F=0,R=0;F<W.length;F++)I=W[F],g.hasOwnProperty(I)?R++:(h.push({command:Be.removeLayer,args:[I]}),u.splice(u.indexOf(I,R),1));for(F=0,R=0;F<p.length;F++)I=p[p.length-1-F],u[u.length-1-F]!==I&&(Z.hasOwnProperty(I)?(h.push({command:Be.removeLayer,args:[I]}),u.splice(u.lastIndexOf(I,u.length-R),1)):R++,X=u[u.length-F],h.push({command:Be.addLayer,args:[g[I],X]}),u.splice(u.length-F,0,I),G[I]=!0);for(F=0;F<p.length;F++)if(I=p[F],N=Z[I],Y=g[I],!G[I]&&!te(N,Y))if(te(N.source,Y.source)&&te(N["source-layer"],Y["source-layer"])&&te(N.type,Y.type)){for(J in Fb(N.layout,Y.layout,h,I,null,Be.setLayoutProperty),Fb(N.paint,Y.paint,h,I,null,Be.setPaintProperty),te(N.slot,Y.slot)||h.push({command:Be.setSlot,args:[I,Y.slot]}),te(N.filter,Y.filter)||h.push({command:Be.setFilter,args:[I,Y.filter]}),te(N.minzoom,Y.minzoom)&&te(N.maxzoom,Y.maxzoom)||h.push({command:Be.setLayerZoomRange,args:[I,Y.minzoom,Y.maxzoom]}),N)N.hasOwnProperty(J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&J!=="slot"&&(J.indexOf("paint.")===0?Fb(N[J],Y[J],h,I,J.slice(6),Be.setPaintProperty):te(N[J],Y[J])||h.push({command:Be.setLayerProperty,args:[I,J,Y[J]]}));for(J in Y)Y.hasOwnProperty(J)&&!N.hasOwnProperty(J)&&J!=="layout"&&J!=="paint"&&J!=="filter"&&J!=="metadata"&&J!=="minzoom"&&J!=="maxzoom"&&J!=="slot"&&(J.indexOf("paint.")===0?Fb(N[J],Y[J],h,I,J.slice(6),Be.setPaintProperty):te(N[J],Y[J])||h.push({command:Be.setLayerProperty,args:[I,J,Y[J]]}))}else h.push({command:Be.removeLayer,args:[I]}),X=u[u.lastIndexOf(I)+1],h.push({command:Be.addLayer,args:[Y,X]})}(r,l.layers,o)}catch(d){console.warn("Unable to compute style diff:",d),o=[{command:Be.setStyle,args:[l]}]}return o}(this.serialize(),t).filter(a=>!(a.command in Dy));if(i.length===0)return!1;let n=i.filter(a=>!(a.command in Oy));if(n.length>0)throw new Error("Unimplemented: ".concat(n.map(a=>a.command).join(", "),"."));return i.forEach(a=>{this[a.command].apply(this,a.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new $t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(t,i){this.imageManager.updateImage(t,this.scope,i)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new $t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Wt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,i,n={}){return this._checkLoaded(),this._validate(Ux,"models.".concat(t),i,null,n)||(this.modelManager.addModel(t,i,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new $t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,n={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error('There is already a source with ID "'.concat(t,'".'));if(!i.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(i).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(Zx,"sources.".concat(t),i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);let a=CW(t,i,this.dispatcher,this);a.scope=this.scope,a.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a.id),source:a.serialize(),sourceId:a.id}));let l=o=>{let d=(o?"symbol:":"other:")+a.id,s=mn(d,this.scope),r=this._sourceCaches[d]=new Fa(s,a,o);(o?this._symbolSourceCaches:this._otherSourceCaches)[a.id]=r,r.onAdd(this.map)};l(!1),i.type!=="vector"&&i.type!=="geojson"||l(!0),a.onAdd&&a.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(let a in this._layers)if(this._layers[a].source===t)return this.fire(new $t(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(a,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new $t(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));let n=this.getOwnSourceCaches(t);for(let a of n){let l=rc(a.id);delete this._sourceCaches[l],this._changes.discardSourceCacheUpdate(a.id),a.fire(new Wt("data",{sourceDataType:"metadata",dataType:"source",sourceId:a.getSource().id})),a.setEventedParent(null),a.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,i){this._checkLoaded(),this.getOwnSource(t).setData(i),this._changes.setDirty()}getOwnSource(t){let i=this.getOwnSourceCache(t);return i&&i.getSource()}getOwnSources(){let t=[];for(let i in this._otherSourceCaches){let n=this.getOwnSourceCache(i);n&&t.push(n.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let i=this._getTransitionParameters();for(let a of t){if(this._validate(gx,"lights",a))return;switch(a.type){case"ambient":if(this.ambientLight){let l=this.ambientLight;l.set(a),l.updateTransitions(i)}else this.ambientLight=new iG(a,e2,this.scope,this.options);break;case"directional":if(this.directionalLight){let l=this.directionalLight;l.set(a),l.updateTransitions(i)}else this.directionalLight=new iG(a,i2,this.scope,this.options)}}let n=new si(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;let n=b=>.2126*(b[0]<=.03928?b[0]/12.92:Math.pow((b[0]+.055)/1.055,2.4))+.7152*(b[1]<=.03928?b[1]/12.92:Math.pow((b[1]+.055)/1.055,2.4))+.0722*(b[2]<=.03928?b[2]/12.92:Math.pow((b[2]+.055)/1.055,2.4)),a=t.properties.get("color").toArray01(),l=t.properties.get("intensity"),o=t.properties.get("direction"),d=1-Qt(o.x,o.y,o.z)[2]/90,s=n(a)*l*d,r=i.properties.get("color").toArray01(),c=i.properties.get("intensity");return(s+n(r)*c)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(JZ(t)){let i=function(l){let o=l.indexOf(sc);return o>=0?l.slice(o+1):""}(t),n=this.fragments.find(({id:l})=>l===i);if(!n)throw new Error("Style import not found: ".concat(t));let a=rc(t);return n.style.getFragmentStyle(a)}{let i=this.fragments.find(({id:n})=>n===t);if(!i)throw new Error("Style import not found: ".concat(t));return i.style}}getConfigProperty(t,i){let n=this.getFragmentStyle(t);if(!n)return null;let a=n.options.get(i),l=a?a.value||a.default:null;return l?l.serialize():null}setConfigProperty(t,i,n){let a=Il(n);if(a.result!=="success")return void cr(this,a.value);let l=a.value.expression,o=this.getFragmentStyle(t);if(!o)return;let d=o.options.get(i);d&&(o.options.set(i,{...d,value:l}),o.updateConfigDependencies())}setConfig(t,i){if(this._config=t,t||i)if(i){this.options.clear();for(let n in i){let a,l,o=Il(i[n].default);if(o.result==="success"&&(a=o.value.expression),t&&t[n]!==void 0){let m=Il(t[n]);m.result==="success"&&(l=m.value.expression)}let{minValue:d,maxValue:s,stepValue:r,type:c,values:b}=i[n];a?this.options.set(n,{default:a,value:l,minValue:d,maxValue:s,stepValue:r,type:c,values:b}):this.fire(new $t(new Error('No schema defined for config option "'.concat(n,'".'))))}}else this.fire(new $t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let t of this._configDependentLayers){let i=this.getLayer(t);i&&(i.possiblyEvaluateVisibility(),this._updateLayer(i))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,i,n={}){this._checkLoaded();let a=t.id;if(this._layers[a])return void this.fire(new $t(new Error('Layer with id "'.concat(a,'" already exists on this map'))));let l;if(t.type==="custom"){if(cr(this,function(c){let b=[],m=c.id;return m===void 0&&b.push({message:"layers.".concat(m,': missing required property "id"')}),c.render===void 0&&b.push({message:"layers.".concat(m,': missing required method "render"')}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&b.push({message:"layers.".concat(m,': property "renderingMode" must be either "2d" or "3d"')}),b}(t)))return;l=gb(t,this.options)}else{if(typeof t.source=="object"&&(this.addSource(a,t.source),t=Xt(t=k(t),{source:a})),this._validate(Gx,"layers.".concat(a),t,{arrayIndex:-1},n))return;l=gb(t,this.options),this._validateLayer(l),l.setEventedParent(this,{layer:{id:a}}),this._serializedLayers[l.id]=l.serialize()}l.isConfigDependent&&this._configDependentLayers.add(l.fqid),l.setScope(this.scope);let o=this._order.length;if(i){let c=this._order.indexOf(i);if(c===-1)return void this.fire(new $t(new Error('Layer with id "'.concat(i,'" does not exist on this map.'))));l.slot===this._layers[i].slot?o=c:A('Layer with id "'.concat(i,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(o,0,a),this._layerOrderChanged=!0,this._layers[a]=l;let d=this.getOwnLayerSourceCache(l),s=!!this.directionalLight&&this.directionalLight.shadowsEnabled();d&&l.canCastShadows()&&s&&(d.castsShadows=!0);let r=this._changes.getRemovedLayer(l);if(r&&l.source&&d&&l.type!=="custom"){this._changes.discardLayerRemoval(l);let c=mn(l.source,l.scope);r.type!==l.type?this._changes.updateSourceCache(c,"clear"):(this._changes.updateSourceCache(c,"reload"),d.pause())}this._updateLayer(l),l.onAdd&&l.onAdd(this.map),l.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();let n=this._checkLayer(t);if(!n||t===i)return;let a=this._order.indexOf(t);this._order.splice(a,1);let l=this._order.length;if(i){let o=this._order.indexOf(i);if(o===-1)return void this.fire(new $t(new Error('Layer with id "'.concat(i,'" does not exist on this map.'))));n.slot===this._layers[i].slot?l=o:A('Layer with id "'.concat(i,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(l,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let i=this._checkLayer(t);if(!i)return;i.setEventedParent(null);let n=this._order.indexOf(t);this._order.splice(n,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(i.fqid),this._changes.removeLayer(i);let a=this.getOwnLayerSourceCache(i);if(a&&a.castsShadows){let l=!1;for(let o in this._layers)if(this._layers[o].source===i.source&&this._layers[o].canCastShadows()){l=!0;break}a.castsShadows=l}i.onRemove&&i.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let i in this._layers)if(this._layers[i].type===t)return!0;return!1}setLayerZoomRange(t,i,n){this._checkLoaded();let a=this._checkLayer(t);a&&(a.minzoom===i&&a.maxzoom===n||(i!=null&&(a.minzoom=i),n!=null&&(a.maxzoom=n),this._updateLayer(a)))}setSlot(t,i){this._checkLoaded();let n=this._checkLayer(t);n&&n.slot!==i&&(n.slot=i,this._updateLayer(n))}setFilter(t,i,n={}){this._checkLoaded();let a=this._checkLayer(t);if(a&&!te(a.filter,i))return i==null?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(Y0,"layers.".concat(a.id,".filter"),i,{layerType:a.type},n)||(a.filter=k(i),this._updateLayer(a)))}getFilter(t){let i=this._checkLayer(t);if(i)return k(i.filter)}setLayoutProperty(t,i,n,a={}){this._checkLoaded();let l=this._checkLayer(t);l&&(te(l.getLayoutProperty(i),n)||(l.setLayoutProperty(i,n,a),l.isConfigDependent&&this._configDependentLayers.add(l.fqid),this._updateLayer(l)))}getLayoutProperty(t,i){let n=this._checkLayer(t);if(n)return n.getLayoutProperty(i)}setPaintProperty(t,i,n,a={}){this._checkLoaded();let l=this._checkLayer(t);if(!l||te(l.getPaintProperty(i),n))return;let o=l.setPaintProperty(i,n,a);l.isConfigDependent&&this._configDependentLayers.add(l.fqid),o&&this._updateLayer(l),this._changes.updatePaintProperties(l)}getPaintProperty(t,i){let n=this._checkLayer(t);if(n)return n.getPaintProperty(i)}setFeatureState(t,i){this._checkLoaded();let n=t.source,a=t.sourceLayer,l=this._checkSource(n);if(!l)return;let o=l.type;if(o==="geojson"&&a)return void this.fire(new $t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(o==="vector"&&!a)return void this.fire(new $t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new $t(new Error("The feature id parameter must be provided.")));let d=this.getOwnSourceCaches(n);for(let s of d)s.setFeatureState(a,t.id,i)}removeFeatureState(t,i){this._checkLoaded();let n=t.source,a=this._checkSource(n);if(!a)return;let l=a.type,o=l==="vector"?t.sourceLayer:void 0;if(l==="vector"&&!o)return void this.fire(new $t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new $t(new Error("A feature id is required to remove its specific state property.")));let d=this.getOwnSourceCaches(n);for(let s of d)s.removeFeatureState(o,t.id,i)}getFeatureState(t){this._checkLoaded();let i=t.source,n=t.sourceLayer,a=this._checkSource(i);if(a){if(a.type!=="vector"||n)return t.id===void 0&&this.fire(new $t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(n,t.id);this.fire(new $t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Xt({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Xt({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return pt({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},n=>n!==void 0)}_updateLayer(t){this._changes.updateLayer(t);let i=this.getLayerSourceCache(t),n=mn(t.source,t.scope),a=this._changes.getUpdatedSourceCaches();t.source&&!a[n]&&i&&i.getSource().type!=="raster"&&(this._changes.updateSourceCache(n,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let i=d=>this._mergedLayers[d].type==="fill-extrusion",n=this.order,a={},l=[];for(let d=n.length-1;d>=0;d--){let s=n[d];if(i(s)){a[s]=d;for(let r of t){let c=r[s];if(c)for(let b of c)l.push(b)}}}l.sort((d,s)=>s.intersectionZ-d.intersectionZ);let o=[];for(let d=n.length-1;d>=0;d--){let s=n[d];if(i(s))for(let r=l.length-1;r>=0;r--){let c=l[r].feature;if(a[c.layer.id]<d)break;o.push(c),l.pop()}else for(let r of t){let c=r[s];if(c)for(let b of c)o.push(b.feature)}}return o}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(Y0,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;let a={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new $t(new Error("parameters.layers must be an Array."))),[];for(let r of i.layers){let c=this._mergedLayers[r];if(!c)return this.fire(new $t(new Error("The layer '".concat(r,"' does not exist in the map's style and cannot be queried for features.")))),[];a[c.source]=!0}}let l=[],o=i.serializedLayers||{},d=i&&i.layers?i.layers.some(r=>{let c=this.getLayer(r);return c&&c.is3D()}):this.has3DLayers(),s=gW.createFromScreenPoints(t,n);for(let r in this._mergedSourceCaches){let c=this._mergedSourceCaches[r].getSource();if(!c||c.scope!==i.scope)continue;let b=this._mergedSourceCaches[r].getSource().id;i.layers&&!a[b]||l.push(Z2(this._mergedSourceCaches[r],this._mergedLayers,o,s,i,n,d,!!this.map._showQueryGeometry))}return this.placement&&l.push(function(r,c,b,m,h,W,p){let Z={},g=W.queryRenderedSymbols(m),u=[];for(let G of Object.keys(g).map(Number))u.push(p[G]);u.sort(RG);for(let G of u){let F=G.featureIndex.lookupSymbolFeatures(g[G.bucketInstanceId],c,G.bucketIndex,G.sourceLayerIndex,h.filter,h.layers,h.availableImages,r);for(let R in F){let I=Z[R]=Z[R]||[],N=F[R];N.sort((Y,X)=>{let J=G.featureSortOrder;if(J){let B=J.indexOf(Y.featureIndex);return J.indexOf(X.featureIndex)-B}return X.featureIndex-Y.featureIndex});for(let Y of N)I.push(Y)}}for(let G in Z)Z[G].forEach(F=>{let R=F.feature,I=b(r[G]);if(!I)return;let N=I.getFeatureState(R.layer["source-layer"],R.id);R.source=R.layer.source,R.layer["source-layer"]&&(R.sourceLayer=R.layer["source-layer"]),R.state=N});return Z}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),s.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)}querySourceFeatures(t,i){i&&i.filter&&this._validate(Y0,"querySourceFeatures.filter",i.filter,null,i);let n=this.getOwnSourceCaches(t),a=[];for(let l of n)a=a.concat(V2(l,i));return a}addSourceType(t,i,n){return xa.getSourceType(t)?n(new Error('A source type called "'.concat(t,'" already exists.'))):(xa.setSourceType(t,i),i.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:i.workerSourceURL},n):n(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,n={}){this._checkLoaded();let a=this.light.getLight(),l=!1;for(let d in t)if(!te(t[d],a[d])){l=!0;break}if(!l)return;let o=this._getTransitionParameters();this.light.setLight(t,i,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,i=1){if(this._checkLoaded(),!t)return delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=t,a=t.source==null;if(i===1){if(typeof n.source=="object"){let d="terrain-dem-src";this.addSource(d,n.source),n=k(n),n=Xt(n,{source:d})}let l=Xt({},n),o={};if(this.terrain&&a){l.source=this.terrain.get().source;let d=this.terrain?this.getFragmentStyle(this.terrain.scope):null;d&&(o.style=d.serialize())}if(this._validate(ux,"terrain",l,o))return}if(!this.terrain||this.terrain.scope!==this.scope&&!a||this.terrain&&i!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,i),this.fire(new Wt("data",{dataType:"style"}))}else{let l=this.terrain,o=l.get();for(let d of Object.keys(_.terrain))!n.hasOwnProperty(d)&&_.terrain[d].default&&(n[d]=_.terrain[d].default);for(let d in t)if(!te(t[d],o[d])){l.set(t,this.options),this.stylesheet.terrain=t;let s=this._getTransitionParameters({duration:0});l.updateTransitions(s),this.fire(new Wt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let i=this.fog=new qJ(t,this.map.transform);this.stylesheet.fog=i.get();let n=this._getTransitionParameters({duration:0});i.updateTransitions(n)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let i=this.fog;if(!te(i.get(),t)){i.set(t),this.stylesheet.fog=i.get();let n=this._getTransitionParameters({duration:0});i.updateTransitions(n)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:ee.now(),transition:Xt(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],i=[];for(let n in this._mergedLayers)this.isLayerDraped(this._mergedLayers[n])?t.push(n):i.push(n);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...i)}_createTerrain(t,i){let n=this.terrain=new KJ(t,i,this.scope,this.options);i===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let a=this._getTransitionParameters({duration:0});n.updateTransitions(a)}_force3DLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="fill-extrusion"&&this._updateLayer(i)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let i=this._layers[t];i.type==="symbol"&&this._updateLayer(i)}}_validate(t,i,n,a,l={}){if(l&&l.validate===!1)return!1;let o=Xt({},this.serialize());return cr(this,t.call(rd,Xt({key:i,style:o,value:n,styleSpec:_},a)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),k0.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let i=this.getSourceCaches(t);for(let n of i)n.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let i=this.getSourceCaches(t);for(let n of i)n.resume(),n.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let i;this.directionalLight&&(i=IF(this.directionalLight));for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].update(t,void 0,void 0,i)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let i=this._sourceCaches[t];i.resume(),i.reload()}}_updatePlacement(t,i,n,a,l=!1){let o=!1,d=!1,s={},r={};for(let c of this._mergedOrder){let b=this._mergedLayers[c];if(b.type!=="symbol")continue;let m=mn(b.source,b.scope),h=s[m];if(!h){let p=this.getLayerSourceCache(b);if(!p)continue;let Z=p.getRenderableIds(!0).map(g=>p.getTileByID(g));r[m]=Z.slice(),h=s[m]=Z.sort((g,u)=>u.tileID.overscaledZ-g.tileID.overscaledZ||(g.tileID.isLessThan(u.tileID)?-1:1))}let W=this.crossTileSymbolIndex.addLayer(b,h,t.center.lng,t.projection);o=o||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),l=l||this._layerOrderChanged||n===0,this._layerOrderChanged&&this.fire(new Wt("neworder")),(l||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ee.now(),t.zoom))&&(this.pauseablePlacement=new Q2(t,this._mergedOrder,l,i,n,a,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,s,r),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ee.now()),d=!0),o&&this.pauseablePlacement.placement.setStale()),d||o)for(let c of this._mergedOrder){let b=this._mergedLayers[c];b.type==="symbol"&&this.placement.updateLayerOpacities(b,s[mn(b.source,b.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ee.now())}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();let i=this.stylesheet.imports=this.stylesheet.imports||[];return i.findIndex(({id:a})=>a===t.id)!==-1?this.fire(new $t(new Error("Import with id '".concat(t.id,"' already exists in the map's style.")))):(i.push(t),this._loadImports([t],!0),this)}setImportUrl(t,i){this._checkLoaded();let n=this.stylesheet.imports||[],a=this.getImportIndex(t);if(a===-1)return this;n[a].url=i;let l=this.fragments[a];return l.style=this._createFragmentStyle(n[a]),l.style.on("style.import.load",()=>this.mergeAll()),l.style.loadURL(i),this}setImportData(t,i){this._checkLoaded();let n=this.getImportIndex(t),a=this.stylesheet.imports||[];return n===-1?this:i?(this.fragments[n].style.setState(i),this._reloadImports(),this):(delete a[n].data,this.setImportUrl(t,a[n].url))}setImportConfig(t,i){this._checkLoaded();let n=this.getImportIndex(t),a=this.stylesheet.imports||[];if(n===-1)return this;i?a[n].config=i:delete a[n].config;let l=this.fragments[n],o=l.style.stylesheet&&l.style.stylesheet.schema;return l.config=i,l.style.setConfig(i,o),l.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let i=this.stylesheet.imports||[],n=this.getImportIndex(t);return n===-1||(i.splice(n,1),this.fragments[n].style._remove(),this.fragments.splice(n,1),this._reloadImports()),this}getImportIndex(t){let i=(this.stylesheet.imports||[]).findIndex(n=>n.id===t);return i===-1&&this.fire(new $t(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),i}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let i in this._mergedOtherSourceCaches){let n=this._mergedOtherSourceCaches[i];n&&t.push(n.getSource())}return t}getSource(t,i){let n=this.getSourceCache(t,i);return n&&n.getSource()}getLayerSource(t){let i=this.getLayerSourceCache(t);return i&&i.getSource()}getSourceCache(t,i){let n=mn(t,i);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(t){let i=mn(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){let i=[];return this._mergedOtherSourceCaches[t]&&i.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&i.push(this._mergedSymbolSourceCaches[t]),i}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let i in t){let n=t[i];n==="reload"?this.reloadSource(i):n==="clear"&&this.clearSource(i)}}updateLayers(t){let i=this._changes.getUpdatedPaintProperties();for(let n of i){let a=this.getLayer(n);a&&a.updateTransitions(t)}}getImages(t,i,n){this.imageManager.getImages(i.icons,i.scope,n),this._updateTilesForChangedImages();let a=l=>{l&&l.setDependencies(i.tileID.key,i.type,i.icons)};a(this._otherSourceCaches[i.source]),a(this._symbolSourceCaches[i.source])}getGlyphs(t,i,n){this.glyphManager.getGlyphs(i.stacks,i.scope,n)}getResource(t,i,n){return Vt(i,n)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let i=[];return this._otherSourceCaches[t]&&i.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&i.push(this._symbolSourceCaches[t]),i}_isSourceCacheLoaded(t){let i=this.getOwnSourceCaches(t);return i.length===0?(this.fire(new $t(new Error("There is no source with ID '".concat(t,"'")))),!1):i.every(n=>n.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function NF(e,t){let i=!1,n=null,a=()=>{n=null,i&&(e(),n=setTimeout(a,t),i=!1)};return()=>(i=!0,n||a(),n)}xa.getSourceType=function(e){return MW[e]},xa.setSourceType=function(e,t){MW[e]=t},xa.registerForPluginStateChange=function(e){return e({pluginStatus:Bn,pluginURL:Nl}),k0.on("pluginStateChange",e),e};class Ky{constructor(t){this._hashName=t&&encodeURIComponent(t),Ni(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=NF(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,T.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),T.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let i=YF(t);if(this._hashName){let n=this._hashName,a=!1,l=T.location.hash.slice(1).split("&").map(o=>{let d=o.split("=")[0];return d===n?(a=!0,"".concat(d,"=").concat(i)):o}).filter(o=>o);return a||l.push("".concat(n,"=").concat(i)),"#".concat(l.join("&"))}return"#".concat(i)}_getCurrentHash(){let t=T.location.hash.replace("#","");if(this._hashName){let i;return t.split("&").map(n=>n.split("=")).forEach(n=>{n[0]===this._hashName&&(i=n)}),(i&&i[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let i=this._getCurrentHash();if(i.length>=3&&!i.some(n=>isNaN(n))){let n=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(i[3]||0):t.getBearing();return t.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:n,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){let t=T.location.href.replace(/(#.+)?$/,this.getHashString());T.history.replaceState(T.history.state,null,t)}}function YF(e,t){let i=e.getCenter(),n=Math.round(100*e.getZoom())/100,a=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,a),o=Math.round(i.lng*l)/l,d=Math.round(i.lat*l)/l,s=e.getBearing(),r=e.getPitch(),c=t?"/".concat(o,"/").concat(d,"/").concat(n):"".concat(n,"/").concat(d,"/").concat(o);return(s||r)&&(c+="/"+Math.round(10*s)/10),r&&(c+="/".concat(Math.round(r))),c}let Sb={linearity:.3,easing:en(0,0,.3,1)},Py=Xt({deceleration:2500,maxSpeed:1400},Sb),qy=Xt({deceleration:20,maxSpeed:1400},Sb),$y=Xt({deceleration:1e3,maxSpeed:360},Sb),tB=Xt({deceleration:1e3,maxSpeed:90},Sb);class eB{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ee.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,i=ee.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let i={zoom:0,bearing:0,pitch:0,pan:new H(0,0),pinchAround:void 0,around:void 0};for(let{settings:l}of this._inertiaBuffer)i.zoom+=l.zoomDelta||0,i.bearing+=l.bearingDelta||0,i.pitch+=l.pitchDelta||0,l.panDelta&&i.pan._add(l.panDelta),l.around&&(i.around=l.around),l.pinchAround&&(i.pinchAround=l.pinchAround);let n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(i.pan.mag()){let l=vb(i.pan.mag(),n,Xt({},Py,t||{}));a.offset=i.pan.mult(l.amount/i.pan.mag()),a.center=this._map.transform.center,Qb(a,l)}if(i.zoom){let l=vb(i.zoom,n,qy);a.zoom=this._map.transform.zoom+l.amount,Qb(a,l)}if(i.bearing){let l=vb(i.bearing,n,$y);a.bearing=this._map.transform.bearing+Mt(l.amount,-179,179),Qb(a,l)}if(i.pitch){let l=vb(i.pitch,n,tB);a.pitch=this._map.transform.pitch+l.amount,Qb(a,l)}if(a.zoom||a.bearing){let l=i.pinchAround===void 0?i.around:i.pinchAround;a.around=l?this._map.unproject(l):this._map.getCenter()}return this.clear(),a.noMoveStart=!0,a}}function Qb(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function vb(e,t,i){let{maxSpeed:n,linearity:a,deceleration:l}=i,o=Mt(e*a/(t/1e3),-n,n),d=Math.abs(o)/(l*a);return{easing:i.easing,duration:1e3*d,amount:o*(d/2)}}class Hn extends Wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,a={}){let l=os(i.getCanvasContainer(),n);super(t,Xt({point:l,lngLat:i.unproject(l),originalEvent:n},a)),this._defaultPrevented=!1,this.target=i}}class fb extends Wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){let a=t==="touchend"?n.changedTouches:n.touches,l=Sr(i.getCanvasContainer(),a),o=l.map(s=>i.unproject(s)),d=l.reduce((s,r,c,b)=>s.add(r.div(b.length)),new H(0,0));super(t,{points:l,point:d,lngLats:o,lngLat:i.unproject(d),originalEvent:n}),this._defaultPrevented=!1}}class iB extends Wt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}}class nB{constructor(t,i){this._map=t,this._clickTolerance=i.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new iB(t.type,this._map,t))}mousedown(t,i){return this._mousedownPos=i,this._firePreventable(new Hn(t.type,this._map,t))}mouseup(t){this._map.fire(new Hn(t.type,this._map,t))}preclick(t){let i=Xt({},t);i.type="preclick",this._map.fire(new Hn(i.type,this._map,i))}click(t,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Hn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Hn(t.type,this._map,t))}mouseover(t){this._map.fire(new Hn(t.type,this._map,t))}mouseout(t){this._map.fire(new Hn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new fb(t.type,this._map,t))}touchmove(t){this._map.fire(new fb(t.type,this._map,t))}touchend(t){this._map.fire(new fb(t.type,this._map,t))}touchcancel(t){this._map.fire(new fb(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class aB{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Hn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Hn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lB{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,i){this.isEnabled()&&t.shiftKey&&t.button===0&&(n1(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(t,i){if(!this._active)return;let n=i,a=this._startPos,l=this._lastPos;if(!a||!l||l.equals(n)||!this._box&&n.dist(a)<this._clickTolerance)return;this._lastPos=n,this._box||(this._box=qe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let o=Math.min(a.x,n.x),d=Math.max(a.x,n.x),s=Math.min(a.y,n.y),r=Math.max(a.y,n.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(o,"px,").concat(s,"px)"),this._box.style.width=d-o+"px",this._box.style.height=r-s+"px")})}mouseupWindow(t,i){if(!this._active)return;let n=this._startPos,a=i;if(n&&t.button===0){if(this.reset(),Ym(),n.x!==a.x||n.y!==a.y)return this._map.fire(new Wt("boxzoomend",{originalEvent:t})),{cameraAnimation:l=>l.fitScreenCoordinates(n,a,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),a1(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new Wt(t,{originalEvent:i}))}}function OW(e,t){let i={};for(let n=0;n<e.length;n++)i[e[n].identifier]=t[n];return i}class oB{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(a){let l=new H(0,0);for(let o of a)l._add(o);return l.div(a.length)}(i),this.touches=OW(n,i)))}touchmove(t,i,n){if(this.aborted||!this.centroid)return;let a=OW(n,i);for(let l in this.touches){let o=a[l];(!o||o.dist(this.touches[l])>30)&&(this.aborted=!0)}}touchend(t,i,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),n.length===0){let a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}class DW{constructor(t){this.singleTap=new oB(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,i,n){this.singleTap.touchstart(t,i,n)}touchmove(t,i,n){this.singleTap.touchmove(t,i,n)}touchend(t,i,n){let a=this.singleTap.touchend(t,i,n);if(a){let l=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(a)<30;if(l&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}class dB{constructor(){this._zoomIn=new DW({numTouches:1,numTaps:2}),this._zoomOut=new DW({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,i,n){this._zoomIn.touchstart(t,i,n),this._zoomOut.touchstart(t,i,n)}touchmove(t,i,n){this._zoomIn.touchmove(t,i,n),this._zoomOut.touchmove(t,i,n)}touchend(t,i,n){let a=this._zoomIn.touchend(t,i,n),l=this._zoomOut.touchend(t,i,n);return a?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:o=>o.easeTo({duration:300,zoom:o.getZoom()+1,around:o.unproject(a)},{originalEvent:t})}):l?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:o=>o.easeTo({duration:300,zoom:o.getZoom()-1,around:o.unproject(l)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let sB={0:1,2:2};class _W{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,i){return!1}_move(t,i){return{}}mousedown(t,i){if(this._lastPoint)return;let n=l1(t);this._correctButton(t,n)&&(this._lastPoint=i,this._eventButton=n)}mousemoveWindow(t,i){let n=this._lastPoint;if(n){if(t.preventDefault(),this._eventButton!=null&&function(a,l){let o=sB[l];return a.buttons===void 0||(a.buttons&o)!==o}(t,this._eventButton))this.reset();else if(this._moved||!(i.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(n,i)}}mouseupWindow(t){this._lastPoint&&l1(t)===this._eventButton&&(this._moved&&Ym(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rB extends _W{mousedown(t,i){super.mousedown(t,i),this._lastPoint&&(this._active=!0)}_correctButton(t,i){return i===0&&!t.ctrlKey}_move(t,i){return{around:i,panDelta:i.sub(t)}}}class XF extends _W{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let n=.8*(i.x-t.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(t){t.preventDefault()}}class JF extends _W{_correctButton(t,i){return i===0&&t.ctrlKey||i===2}_move(t,i){let n=-.5*(i.y-t.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(t){t.preventDefault()}}class cB{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),Ni(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new H(0,0)}touchstart(t,i,n){return this._calculateTransform(t,i,n)}touchmove(t,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(n.length===1&&!Kt())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,n)}}touchend(t,i,n){this._calculateTransform(t,i,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);let a=OW(n,i),l=new H(0,0),o=new H(0,0),d=0;for(let r in a){let c=a[r],b=this._touches[r];b&&(l._add(c),o._add(c.sub(b)),d++,a[r]=c)}if(this._touches=a,d<this._minTouches||!o.mag())return;let s=o.div(d);return this._sum._add(s),this._sum.mag()<this._clickTolerance?void 0:{around:l.div(d),panDelta:s}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=qe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class KW{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,i,n){return{}}touchstart(t,i,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([i[0],i[1]]))}touchmove(t,i,n){let a=this._firstTwoTouches;if(!a)return;t.preventDefault();let[l,o]=a,d=zb(n,i,l),s=zb(n,i,o);if(!d||!s)return;let r=this._aroundCenter?null:d.add(s).div(2);return this._move([d,s],r,t)}touchend(t,i,n){if(!this._firstTwoTouches)return;let[a,l]=this._firstTwoTouches,o=zb(n,i,a),d=zb(n,i,l);o&&d||(this._active&&Ym(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zb(e,t,i){for(let n=0;n<e.length;n++)if(e[n].identifier===i)return t[n]}function yF(e,t){return Math.log(e/t)/Math.LN2}class bB extends KW{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,i){let n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(yF(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yF(this._distance,n),pinchAround:i}}}function BF(e,t){return 180*e.angleWith(t)/Math.PI}class mB extends KW{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,i){let n=this._vector;if(this._vector=t[0].sub(t[1]),n&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:BF(this._vector,n),pinchAround:i}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let i=25/(Math.PI*this._minDiameter)*360,n=this._startVector;if(!n)return!1;let a=BF(t,n);return Math.abs(a)<i}}function PW(e){return Math.abs(e.y)>Math.abs(e.x)}class hB extends KW{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,PW(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,i,n){let a=this._lastPoints;if(!a)return;let l=t[0].sub(a[0]),o=t[1].sub(a[1]);return this._map._cooperativeGestures&&!Kt()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(l,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(l.y+o.y)/2*-.5})}gestureBeginsVertically(t,i,n){if(this._valid!==void 0)return this._valid;let a=t.mag()>=2,l=i.mag()>=2;if(!a&&!l)return;if(!a||!l)return this._firstMove==null&&(this._firstMove=n),n-this._firstMove<100&&void 0;let o=t.y>0==i.y>0;return PW(t)&&PW(i)&&o}}let WB={panStep:100,bearingStep:15,pitchStep:10};class pB{constructor(){let t=WB;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let i=0,n=0,a=0,l=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),l=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),l=1);break;case 38:t.shiftKey?a=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?a=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,a=0),{cameraAnimation:d=>{let s=d.getZoom();d.easeTo({duration:300,easeId:"keyboardHandler",easing:ZB,zoom:i?Math.round(s)+i*(t.shiftKey?2:1):s,bearing:d.getBearing()+n*this._bearingStep,pitch:d.getPitch()+a*this._pitchStep,offset:[-l*this._panStep,-o*this._panStep],center:d.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ZB(e){return e*(2-e)}let MF=4.000244140625;class VB{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Ni(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||Kt()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===T.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=ee.now(),a=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,i!==0&&i%MF==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":a>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(a*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let i=os(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:i,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let r=this._type==="wheel"&&Math.abs(this._delta)>MF?this._wheelZoomRate:this._defaultZoomRate,c=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&c!==0&&(c=1/c);let b=i(),m=Math.pow(2,b),h=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):m;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(h*c))),this._type==="wheel"&&(this._startZoom=b,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let n=typeof this._targetZoom=="number"?this._targetZoom:i(),a=this._startZoom,l=this._easing,o,d=!1;if(this._type==="wheel"&&a&&l){let r=Math.min((ee.now()-this._lastWheelEventTime)/200,1);o=Pt(a,n,l(r)),r<1?this._frameId||(this._frameId=!0):d=!0}else o=n,d=!0;this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let s=o-i();return s*this._lastDelta<0&&(s=0),{noInertia:!0,needsRenderFrame:!d,zoomDelta:s,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=sn;if(this._prevEase){let n=this._prevEase,a=(ee.now()-n.start)/n.duration,l=n.easing(a+.01)-n.easing(a),o=.27/Math.sqrt(l*l+1e-4)*.01;i=en(o,Math.sqrt(.0729-o*o),.25,1)}return this._prevEase={start:ee.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=qe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(T.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class gB{constructor(t,i){this._clickZoom=t,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class uB{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,i){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(i)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class RB{constructor(){this._tap=new DW({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,i,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=i[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,i,n))}touchmove(t,i,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;let a=i[0],l=a.y-this._swipePoint.y;return this._swipePoint=a,t.preventDefault(),this._active=!0,{zoomDelta:l/128}}}else this._tap.touchmove(t,i,n)}touchend(t,i,n){this._tapTime?this._swipePoint&&n.length===0&&this.reset():this._tap.touchend(t,i,n)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class GB{constructor(t,i,n){this._el=t,this._mousePan=i,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class FB{constructor(t,i,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=i,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class IB{constructor(t,i,n,a){this._el=t,this._touchZoom=i,this._touchRotate=n,this._tapDragZoom=a,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Lb=e=>e.zoom||e.drag||e.pitch||e.rotate;class UB extends Wt{}class xB{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){let n=S.sub([],i,t);this.radius=S.length(n[2]<0?S.div([],n,this.constants):[n[0],n[1],0])}projectRay(t){S.div(t,t,this.constants),S.normalize(t,t),S.mul(t,t,this.constants);let i=S.scale([],t,this.radius);if(i[2]>0){let n=S.scale([],[0,0,1],S.dot(i,[0,0,1])),a=S.scale([],S.normalize([],[i[0],i[1],0]),this.radius),l=S.add([],i,S.scale([],S.sub([],S.add([],a,n),i),2));i[0]=l[0],i[1]=l[1]}return i}}function Eb(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class NB{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new eB(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xB,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),Ni(["handleEvent","handleWindowEvent"],this);let n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[T.document,"mousemove",{capture:!0}],[T.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[T,"blur",void 0]];for(let[a,l,o]of this._listeners)a.addEventListener(l,a===T.document?this.handleWindowEvent:this.handleEvent,o)}destroy(){for(let[t,i,n]of this._listeners)t.removeEventListener(i,t===T.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){let i=this._map,n=i.getCanvasContainer();this._add("mapEvent",new nB(i,t));let a=i.boxZoom=new lB(i,t);this._add("boxZoom",a);let l=new dB,o=new uB;i.doubleClickZoom=new gB(o,l),this._add("tapZoom",l),this._add("clickZoom",o);let d=new RB;this._add("tapDragZoom",d);let s=i.touchPitch=new hB(i);this._add("touchPitch",s);let r=new XF(t),c=new JF(t);i.dragRotate=new FB(t,r,c),this._add("mouseRotate",r,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);let b=new rB(t),m=new cB(i,t);i.dragPan=new GB(n,b,m),this._add("mousePan",b),this._add("touchPan",m,["touchZoom","touchRotate"]);let h=new mB,W=new bB;i.touchZoomRotate=new IB(n,W,h,d),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new aB(i));let p=i.scrollZoom=new VB(i,this);this._add("scrollZoom",p,["mousePan"]);let Z=i.keyboard=new pB;this._add("keyboard",Z);for(let g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&i[g].enable(t[g])}_add(t,i,n){this._handlers.push({handlerName:t,handler:i,allowed:n}),this._handlersById[t]=i}stop(t){if(!this._updatingCamera){for(let{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lb(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,i,n){for(let a in t)if(a!==n&&(!i||i.indexOf(a)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,"".concat(t.type,"Window"))}_getMapTouches(t){let i=[];for(let n of t)this._el.contains(n.target)&&i.push(n);return i}handleEvent(t,i){this._updatingCamera=!0;let n=t.type==="renderFrame",a=n?void 0:t,l={needsRenderFrame:!1},o={},d={},s=t.touches?this._getMapTouches(t.touches):void 0,r=s?Sr(this._el,s):n?void 0:os(this._el,t);for(let{handlerName:m,handler:h,allowed:W}of this._handlers){if(!h.isEnabled())continue;let p;this._blockedByActive(d,W,m)?h.reset():h[i||t.type]&&(p=h[i||t.type](t,r,s),this.mergeHandlerResult(l,o,p,m,a),p&&p.needsRenderFrame&&this._triggerRenderFrame()),(p||h.isActive())&&(d[m]=h)}let c={};for(let m in this._previousActiveHandlers)d[m]||(c[m]=a);this._previousActiveHandlers=d,(Object.keys(c).length||Eb(l))&&(this._changes.push([l,o,c]),this._triggerRenderFrame()),(Object.keys(d).length||Eb(l))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:b}=l;b&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],b(this._map))}mergeHandlerResult(t,i,n,a,l){if(!n)return;Xt(t,n);let o={handlerName:a,originalEvent:n.originalEvent||l};n.zoomDelta!==void 0&&(i.zoom=o),n.panDelta!==void 0&&(i.drag=o),n.pitchDelta!==void 0&&(i.pitch=o),n.bearingDelta!==void 0&&(i.rotate=o)}_applyChanges(){let t={},i={},n={};for(let[a,l,o]of this._changes)a.panDelta&&(t.panDelta=(t.panDelta||new H(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),a.around!==void 0&&(t.around=a.around),a.aroundCoord!==void 0&&(t.aroundCoord=a.aroundCoord),a.pinchAround!==void 0&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),Xt(i,l),Xt(n,o);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,i,n){let a=this._map,l=a.transform,o=u=>[u.x,u.y,u.z];if((u=>{let G=this._eventsInProgress.drag;return G&&!this._handlersById[G.handlerName].isActive()})()&&!Eb(t)){let u=l.zoom;l.cameraElevationReference="sea",this._originalZoom!=null&&l._orthographicProjectionAtLowPitch&&l.projection.name!=="globe"&&l.pitch===0?(l.cameraElevationReference="ground",l.zoom=this._originalZoom):(l.recenterOnTerrain(),l.cameraElevationReference="ground"),u!==l.zoom&&this._map._update(!0)}if(l._isCameraConstrained&&a._stop(!0),!Eb(t))return void this._fireEvents(i,n,!0);let{panDelta:d,zoomDelta:s,bearingDelta:r,pitchDelta:c,around:b,aroundCoord:m,pinchAround:h}=t;l._isCameraConstrained&&(s>0&&(s=0),l._isCameraConstrained=!1),h!==void 0&&(b=h),(s||(u=>i[u]&&!this._eventsInProgress[u])("drag"))&&b&&(this._dragOrigin=o(l.pointCoordinate3D(b)),this._originalZoom=l.zoom,this._trackingEllipsoid.setup(l._camera.position,this._dragOrigin)),l.cameraElevationReference="sea",a._stop(!0),b=b||a.transform.centerPoint,r&&(l.bearing+=r),c&&(l.pitch+=c),l._updateCameraState();let W=[0,0,0];if(d)if(l.projection.name==="mercator"){let u=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(b).dir),G=this._trackingEllipsoid.projectRay(l.screenPointToMercatorRay(b.sub(d)).dir);W[0]=G[0]-u[0],W[1]=G[1]-u[1]}else{let u=l.pointCoordinate(b);if(l.projection.name==="globe"){d=d.rotate(-l.angle);let G=l._pixelsPerMercatorPixel/l.worldSize;W[0]=-d.x*Xh(Bi(u.y))*G,W[1]=-d.y*Xh(l.center.lat)*G}else{let G=l.pointCoordinate(b.sub(d));u&&G&&(W[0]=G.x-u.x,W[1]=G.y-u.y)}}let p=l.zoom,Z=[0,0,0];if(s){let u=o(m||l.pointCoordinate3D(b)),G={dir:S.normalize([],S.sub([],u,l._camera.position))};if(G.dir[2]<0){let F=l.zoomDeltaToMovement(u,s);S.scale(Z,G.dir,F)}}let g=S.add(W,W,Z);l._translateCameraConstrained(g),s&&Math.abs(l.zoom-p)>1e-4&&l.recenterOnTerrain(),l.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,n,!0)}_fireEvents(t,i,n){let a=Lb(this._eventsInProgress),l=Lb(t),o={};for(let c in t){let{originalEvent:b}=t[c];this._eventsInProgress[c]||(o["".concat(c,"start")]=b),this._eventsInProgress[c]=t[c]}!a&&l&&this._fireEvent("movestart",l.originalEvent);for(let c in o)this._fireEvent(c,o[c]);l&&this._fireEvent("move",l.originalEvent);for(let c in t){let{originalEvent:b}=t[c];this._fireEvent(c,b)}let d={},s;for(let c in this._eventsInProgress){let{handlerName:b,originalEvent:m}=this._eventsInProgress[c];this._handlersById[b].isActive()||(delete this._eventsInProgress[c],s=i[b]||m,d["".concat(c,"end")]=s)}for(let c in d)this._fireEvent(c,d[c]);let r=Lb(this._eventsInProgress);if(n&&(a||l)&&!r){this._updatingCamera=!0;let c=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=m=>m!==0&&-this._bearingSnap<m&&m<this._bearingSnap;c?(b(c.bearing||this._map.getBearing())&&(c.bearing=0),this._map.easeTo(c,{originalEvent:s})):(this._map.fire(new Wt("moveend",{originalEvent:s})),b(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new Wt(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new UB("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let CF="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class YB extends Xi{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=i.respectPrefersReducedMotion!==!1,Ni(["_renderFrameCallback"],this)}getCenter(){return new qt(this.transform.center.lng,this.transform.center.lat)}setCenter(t,i){return this.jumpTo({center:t},i)}panBy(t,i,n){return t=H.convert(t).mult(-1),this.panTo(this.transform.center,Xt({offset:t},i),n)}panTo(t,i,n){return this.easeTo(Xt({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(t,i){return this.jumpTo({zoom:t},i),this}zoomTo(t,i,n){return this.easeTo(Xt({zoom:t},i),n)}zoomIn(t,i){return this.zoomTo(this.getZoom()+1,t,i),this}zoomOut(t,i){return this.zoomTo(this.getZoom()-1,t,i),this}getBearing(){return this.transform.bearing}setBearing(t,i){return this.jumpTo({bearing:t},i),this}getPadding(){return this.transform.padding}setPadding(t,i){return this.jumpTo({padding:t},i),this}rotateTo(t,i,n){return this.easeTo(Xt({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,Xt({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(Xt({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(t,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,i):this}getPitch(){return this.transform.pitch}setPitch(t,i){return this.jumpTo({pitch:t},i),this}cameraForBounds(t,i){t=Tn.convert(t);let n=i&&i.bearing||0,a=i&&i.pitch||0,l=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,l,o,n,a,i)}_extendCameraOptions(t){let i={top:0,bottom:0,right:0,left:0};if(typeof(t=Xt({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){let n=t.padding;t.padding={top:n,bottom:n,right:n,left:n}}return t.padding=Xt(i,t.padding),t}_minimumAABBFrustumDistance(t,i){let n=i.max[0]-i.min[0],a=i.max[1]-i.min[1];return n/a>t.aspect?n/(2*Math.tan(.5*t.fovX)*t.aspect):a/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,i,n,a,l,o){let d=t.clone(),s=this._extendCameraOptions(o);d.bearing=a,d.pitch=l;let r=qt.convert(i),c=qt.convert(n),b=.5*(r.lat+c.lat),m=.5*(r.lng+c.lng),h=Gn(b,m),W=S.normalize([],h),p=S.normalize([],S.cross([],W,[0,1,0])),Z=S.cross([],p,W),g=[p[0],p[1],p[2],0,Z[0],Z[1],Z[2],0,W[0],W[1],W[2],0,0,0,0,1],u=[h,Gn(r.lat,r.lng),Gn(c.lat,r.lng),Gn(c.lat,c.lng),Gn(r.lat,c.lng),Gn(b,r.lng),Gn(b,c.lng),Gn(r.lat,m),Gn(c.lat,m)],G=$e.fromPoints(u.map(L=>[S.dot(p,L),S.dot(Z,L),S.dot(W,L)])),F=S.transformMat4([],G.center,g);S.squaredLength(F)===0&&S.set(F,0,0,1),S.normalize(F,F),S.scale(F,F,Wn),d.center=function([L,K,q]){let P=Math.hypot(L,K,q),et=Math.atan2(L,q),it=.5*Math.PI-Math.acos(-K/P);return new qt(ei(et),ei(it))}(F);let R=d.getWorldToCameraMatrix(),I=D.invert(new Float64Array(16),R);G=$e.applyTransform(G,D.multiply([],R,g)),S.transformMat4(F,F,R);let N=.5*(G.max[2]-G.min[2]),Y=this._minimumAABBFrustumDistance(d,G),X=S.scale([],[0,0,1],N),J=S.add(X,F,X),B=Y+(d.pitch===0?0:S.distance(F,J)),C=d.globeCenterInViewSpace,Q=S.sub([],F,[C[0],C[1],C[2]]);S.normalize(Q,Q),S.scale(Q,Q,B);let y=S.add([],F,Q);S.transformMat4(y,y,I);let z=ud/Wn,E=S.length(y),O=He(Math.max(E*z-ud,Number.EPSILON),0),f=Math.min(d.zoomFromMercatorZAdjusted(O),s.maxZoom);return f>.5*(Ts+Cl)?(d.setProjection({name:"mercator"}),d.zoom=f,this._cameraForBounds(d,i,n,a,l,o)):{center:d.center,zoom:f,bearing:a,pitch:l}}queryTerrainElevation(t,i){let n=this.transform.elevation;return n?(i=Xt({},{exaggerated:!0},i),n.getAtPoint(Re.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,n,a,l,o){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,i,n,a,l,o);let d=t.clone(),s=this._extendCameraOptions(o),r=d.padding;d.bearing=a,d.pitch=l;let c=qt.convert(i),b=qt.convert(n),m=new qt(c.lng,b.lat),h=new qt(b.lng,c.lat),W=d.project(c),p=d.project(b),Z=this.queryTerrainElevation(c),g=this.queryTerrainElevation(b),u=this.queryTerrainElevation(m),G=this.queryTerrainElevation(h),F=[[W.x,W.y,Math.min(Z||0,g||0,u||0,G||0)],[p.x,p.y,Math.max(Z||0,g||0,u||0,G||0)]],R=$e.fromPoints(F),I=d.getWorldToCameraMatrix(),N=D.invert(new Float64Array(16),I);R=$e.applyTransform(R,I);let Y=S.sub([],R.max,R.min),X=r.left||0,J=r.right||0,B=r.bottom||0,C=r.top||0,{left:Q,right:y,top:z,bottom:E}=s.padding,O=.5*(X+J),f=.5*(C+B),L=Math.min(d.scaleZoom(d.scale*Math.min((d.width-(X+J+Q+y))/Y[0],(d.height-(B+C+E+z))/Y[1])),s.maxZoom),K=d.scale/d.zoomScale(L);R=new $e([R.min[0]-(Q+O)*K,R.min[1]-(E+f)*K,R.min[2]],[R.max[0]+(y+O)*K,R.max[1]+(z+f)*K,R.max[2]]);let q=.5*Y[2],P=this._minimumAABBFrustumDistance(d,R),et=[0,0,1,0];Le.transformMat4(et,et,I),Le.normalize(et,et);let it=S.scale([],et,P+q),at=S.add([],R.center,it),$=(typeof s.offset.x=="number"&&typeof s.offset.y=="number"?new H(s.offset.x,s.offset.y):H.convert(s.offset)).rotate(-At(a));R.center[0]-=$.x*K,R.center[1]+=$.y*K,S.transformMat4(R.center,R.center,N),S.transformMat4(at,at,N);let ot=[R.center[0],R.center[1],at[2]*d.pixelsPerMeter];S.scale(ot,ot,1/d.worldSize);let Rt=kn(ot[0]),Gt=Bi(ot[1]),Yt=Math.min(d._zoomFromMercatorZ(ot[2]),s.maxZoom),Bt=new qt(Rt,Gt);return d.mercatorFromTransition&&Yt<.5*(Ts+Cl)?(d.setProjection({name:"globe"}),d.zoom=Yt,this._cameraForBounds(d,i,n,a,l,o)):{center:Bt,zoom:Yt,bearing:a,pitch:l}}fitBounds(t,i,n){let a=this.cameraForBounds(t,i);return this._fitInternal(a,i,n)}fitScreenCoordinates(t,i,n,a,l){let o=H.convert(t),d=H.convert(i),s=new H(Math.min(o.x,d.x),Math.min(o.y,d.y)),r=new H(Math.max(o.x,d.x),Math.max(o.y,d.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(o,d))return this;let c=this.transform.pointLocation3D(s),b=this.transform.pointLocation3D(r),m=this.transform.pointLocation3D(new H(s.x,r.y)),h=this.transform.pointLocation3D(new H(r.x,s.y)),W=[Math.min(c.lng,b.lng,m.lng,h.lng),Math.min(c.lat,b.lat,m.lat,h.lat)],p=[Math.max(c.lng,b.lng,m.lng,h.lng),Math.max(c.lat,b.lat,m.lat,h.lat)],Z=a&&a.pitch?a.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,W,p,n,Z,a);return this._fitInternal(g,a,l)}_fitInternal(t,i,n){return t?(delete(i=Xt(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();let n=t.preloadOnly?this.transform.clone():this.transform,a=!1,l=!1,o=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(a=!0,n.zoom=+t.zoom),t.center!==void 0&&(n.center=qt.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(l=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),t.padding==null||n.isPaddingEqual(t.padding)||(n.padding=t.padding),t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new Wt("movestart",i)).fire(new Wt("move",i)),a&&this.fire(new Wt("zoomstart",i)).fire(new Wt("zoom",i)).fire(new Wt("zoomend",i)),l&&this.fire(new Wt("rotatestart",i)).fire(new Wt("rotate",i)).fire(new Wt("rotateend",i)),o&&this.fire(new Wt("pitchstart",i)).fire(new Wt("pitch",i)).fire(new Wt("pitchend",i)),this.fire(new Wt("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||A(CF),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){let n=this.transform;if(!n.projection.supportsFreeCamera)return A(CF),this;this.stop();let a=n.zoom,l=n.pitch,o=n.bearing;n.setFreeCameraOptions(t);let d=a!==n.zoom,s=l!==n.pitch,r=o!==n.bearing;return this.fire(new Wt("movestart",i)).fire(new Wt("move",i)),d&&this.fire(new Wt("zoomstart",i)).fire(new Wt("zoom",i)).fire(new Wt("zoomend",i)),r&&this.fire(new Wt("rotatestart",i)).fire(new Wt("rotate",i)).fire(new Wt("rotateend",i)),s&&this.fire(new Wt("pitchstart",i)).fire(new Wt("pitch",i)).fire(new Wt("pitchend",i)),this.fire(new Wt("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),((t=Xt({offset:[0,0],duration:500,easing:sn},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let n=this.transform,a=this.getZoom(),l=this.getBearing(),o=this.getPitch(),d=this.getPadding(),s="zoom"in t?+t.zoom:a,r="bearing"in t?this._normalizeBearing(t.bearing,l):l,c="pitch"in t?+t.pitch:o,b="padding"in t?t.padding:n.padding,m=H.convert(t.offset),h,W,p;if(n.projection.name==="globe"){let X=Re.fromLngLat(n.center),J=m.rotate(-n.angle);X.x+=J.x/n.worldSize,X.y+=J.y/n.worldSize;let B=X.toLngLat(),C=qt.convert(t.center||B);this._normalizeCenter(C),h=n.centerPoint.add(J),W=new H(X.x,X.y).mult(n.worldSize),p=new H(Qi(C.lng),Li(C.lat)).mult(n.worldSize).sub(W)}else{h=n.centerPoint.add(m);let X=n.pointLocation(h),J=qt.convert(t.center||X);this._normalizeCenter(J),W=n.project(X),p=n.project(J).sub(W)}let Z=n.zoomScale(s-a),g,u;t.around&&(g=qt.convert(t.around),u=n.locationPoint(g));let G=this._zooming||s!==a,F=this._rotating||l!==r,R=this._pitching||c!==o,I=!n.isPaddingEqual(b),N=X=>J=>{if(G&&(X.zoom=Pt(a,s,J)),F&&(X.bearing=Pt(l,r,J)),R&&(X.pitch=Pt(o,c,J)),I&&(X.interpolatePadding(d,b,J),h=X.centerPoint.add(m)),g)X.setLocationAtPoint(g,u);else{let B=X.zoomScale(X.zoom-a),C=s>a?Math.min(2,Z):Math.max(.5,Z),Q=Math.pow(C,1-J),y=X.unproject(W.add(p.mult(J*Q)).mult(B));X.setLocationAtPoint(X.renderWorldCopies?y.wrap():y,h)}return t.preloadOnly||this._fireMoveEvents(i),X};if(t.preloadOnly){let X=this._emulate(N,t.duration,n);return this._preloadTiles(X),this}let Y={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=G,this._rotating=F,this._pitching=R,this._padding=I,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,Y),this._ease(N(n),X=>{n.cameraElevationReference==="sea"&&n.recenterOnTerrain(),this._afterEase(i,X)},t),this}_prepareEase(t,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),i||n.moving||this.fire(new Wt("movestart",t)),this._zooming&&!n.zooming&&this.fire(new Wt("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new Wt("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new Wt("pitchstart",t))}_fireMoveEvents(t){this.fire(new Wt("move",t)),this._zooming&&this.fire(new Wt("zoom",t)),this._rotating&&this.fire(new Wt("rotate",t)),this._pitching&&this.fire(new Wt("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let n=this._zooming,a=this._rotating,l=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new Wt("zoomend",t)),a&&this.fire(new Wt("rotateend",t)),l&&this.fire(new Wt("pitchend",t)),this.fire(new Wt("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){let L=Ci(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(L,i)}this.stop(),t=Xt({offset:[0,0],speed:1.2,curve:1.42,easing:sn},t);let n=this.transform,a=this.getZoom(),l=this.getBearing(),o=this.getPitch(),d=this.getPadding(),s="zoom"in t?Mt(+t.zoom,n.minZoom,n.maxZoom):a,r="bearing"in t?this._normalizeBearing(t.bearing,l):l,c="pitch"in t?+t.pitch:o,b="padding"in t?t.padding:n.padding,m=n.zoomScale(s-a),h=H.convert(t.offset),W=n.centerPoint.add(h),p=n.pointLocation(W),Z=qt.convert(t.center||p);this._normalizeCenter(Z);let g=n.project(p),u=n.project(Z).sub(g),G=t.curve,F=Math.max(n.width,n.height),R=F/m,I=u.mag();if("minZoom"in t){let L=Mt(Math.min(t.minZoom,a,s),n.minZoom,n.maxZoom),K=F/n.zoomScale(L-a);G=Math.sqrt(K/I*2)}let N=G*G;function Y(L){let K=(R*R-F*F+(L?-1:1)*N*N*I*I)/(2*(L?R:F)*N*I);return Math.log(Math.sqrt(K*K+1)-K)}function X(L){return(Math.exp(L)-Math.exp(-L))/2}function J(L){return(Math.exp(L)+Math.exp(-L))/2}let B=Y(0),C=function(L){return J(B)/J(B+G*L)},Q=function(L){return F*((J(B)*(X(K=B+G*L)/J(K))-X(B))/N)/I;var K},y=(Y(1)-B)/G;if(Math.abs(I)<1e-6||!isFinite(y)){if(Math.abs(F-R)<1e-6)return this.easeTo(t,i);let L=R<F?-1:1;y=Math.abs(Math.log(R/F))/G,Q=function(){return 0},C=function(K){return Math.exp(L*G*K)}}t.duration="duration"in t?+t.duration:1e3*y/("screenSpeed"in t?+t.screenSpeed/G:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let z=l!==r,E=c!==o,O=!n.isPaddingEqual(b),f=L=>K=>{let q=K*y,P=1/C(q);L.zoom=K===1?s:a+L.scaleZoom(P),z&&(L.bearing=Pt(l,r,K)),E&&(L.pitch=Pt(o,c,K)),O&&(L.interpolatePadding(d,b,K),W=L.centerPoint.add(h));let et=K===1?Z:L.unproject(g.add(u.mult(Q(q))).mult(P));return L.setLocationAtPoint(L.renderWorldCopies?et.wrap():et,W),L._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),L};if(t.preloadOnly){let L=this._emulate(f,t.duration,n);return this._preloadTiles(L),this}return this._zooming=!0,this._rotating=z,this._pitching=E,this._padding=O,this._prepareEase(i,!1),this._ease(f(n),()=>this._afterEase(i),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,i){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let n=this._onEaseEnd;this._onEaseEnd=void 0,n.call(this,i)}if(!t){let n=this.handlers;n&&n.stop(!1)}return this}_ease(t,i,n){n.animate===!1||n.duration===0?(t(1),i()):(this._easeStart=ee.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((ee.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=Nn(t,-180,180);let n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}_normalizeCenter(t){let i=this.transform;if(i.maxBounds||i.projection.name!=="globe"&&!i.renderWorldCopies)return;let n=t.lng-i.center.lng;t.lng+=n>180?-360:n<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&ee.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,i,n){let a=Math.ceil(15*i/1e3),l=[],o=t(n.clone());for(let d=0;d<=a;d++){let s=o(d/a);l.push(s.clone())}return l}}class TF{constructor(t={}){this.options=t,Ni(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let i=this.options&&this.options.compact;return this._map=t,this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=qe("button","mapboxgl-ctrl-attrib-button",this._container),qe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=qe("div","mapboxgl-ctrl-attrib-inner",this._container),i&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),i===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,i){let n=this._map._getUIString("AttributionControl.".concat(i));t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||Zt.ACCESS_TOKEN}];if(t){let n=i.reduce((a,l,o)=>(l.value&&(a+="".concat(l.key,"=").concat(l.value).concat(o<i.length-1?"&":"")),a),"?");t.href="".concat(Zt.FEEDBACK_URL,"/").concat(n,"#").concat(YF(this._map,!0)),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let a=this._map.style.stylesheet;this.styleOwner=a.owner,this.styleId=a.id}let i=this._map.style._mergedSourceCaches;for(let a in i){let l=i[a];if(l.used){let o=l.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((a,l)=>a.length-l.length),t=t.filter((a,l)=>{for(let o=l+1;o<t.length;o++)if(t[o].indexOf(a)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class kF{constructor(){Ni(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=qe("div","mapboxgl-ctrl");let i=qe("a","mapboxgl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://www.mapbox.com/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let i in t){let n=t[i].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let i=t[0];this._map.getCanvasContainer().offsetWidth<250?i.classList.add("mapboxgl-compact"):i.classList.remove("mapboxgl-compact")}}}class SF{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let i=++this._id;return this._queue.push({callback:t,id:i,cancelled:!1}),i}remove(t){let i=this._currentlyRunning,n=i?this._queue.concat(i):this._queue;for(let a of n)if(a.id===t)return void(a.cancelled=!0)}run(t=0){let i=this._currentlyRunning=this._queue;this._queue=[];for(let n of i)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function QF(e,t,i){if(e=new qt(e.lng,e.lat),t){let n=new qt(e.lng-360,e.lat),a=new qt(e.lng+360,e.lat),l=360*Math.ceil(Math.abs(e.lng-i.center.lng)/360),o=i.locationPoint(e).distSqr(t),d=t.x<0||t.y<0||t.x>i.width||t.y>i.height;i.locationPoint(n).distSqr(t)<o&&(d||Math.abs(n.lng-i.center.lng)<l)?e=n:i.locationPoint(a).distSqr(t)<o&&(d||Math.abs(a.lng-i.center.lng)<l)&&(e=a)}for(;Math.abs(e.lng-i.center.lng)>180;){let n=i.locationPoint(e);if(n.x>=0&&n.y>=0&&n.x<=i.width&&n.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}let qW={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $W extends Xi{constructor(t,i){if(super(),(t instanceof T.HTMLElement||i)&&(t=Xt({element:t},i)),Ni(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=H.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=qe("div");let l=41,o=27,d=Oa("svg",{display:"block",height:l*this._scale+"px",width:o*this._scale+"px",viewBox:"0 0 ".concat(o," ").concat(l)},this._element),s=Oa("radialGradient",{id:"shadowGradient"},Oa("defs",{},d));Oa("stop",{offset:"10%","stop-opacity":.4},s),Oa("stop",{offset:"100%","stop-opacity":.05},s),Oa("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},d),Oa("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},d),Oa("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},d),Oa("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},d),this._offset=H.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()});let n=this._element.classList;for(let l in qW)n.remove("mapboxgl-marker-anchor-".concat(l));n.add("mapboxgl-marker-anchor-".concat(this._anchor));let a=t&&t.className?t.className.trim().split(/\s+/):[];n.add(...a),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=qt.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let a=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(38.1-13.5+a)],"bottom-right":[-a,-1*(38.1-13.5+a)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let i=t.code,n=t.charCode||t.keyCode;i!=="Space"&&i!=="Enter"&&n!==32&&n!==13||this.togglePopup()}_onMapClick(t){let i=t.originalEvent.target,n=this._element;this._popup&&(i===n||n.contains(i))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,i=this._pos;if(!t||!i)return!1;let n=t.unproject(i),a=t.getFreeCameraOptions();if(!a.position)return!1;let l=a.position.toLngLat();return l.distanceTo(n)<.9*l.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();let n=t.unproject(i),a;t._showingGlobe()&&Nc(t.transform,this._lngLat)?a=0:(a=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(a*=this._occludedOpacity)),this._element.style.opacity="".concat(a),this._element.style.pointerEvents=a>0?"auto":"none",this._popup&&this._popup._setOpacity(a),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let i=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(t.x,"px,").concat(t.y,"px)\n            ").concat(qW[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(i.x,"px,").concat(i.y,"px)\n        ")}_calculateXYTransform(){let t=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!t||n!=="map")return"";if(!i._showingGlobe()){let s=i.getPitch();return s?"rotateX(".concat(s,"deg)"):""}let a=ei(Ug(i.transform,this._lngLat)),l=t.sub(Ig(i.transform)),o=Math.abs(l.x)+Math.abs(l.y);if(o===0)return"";let d=a/o;return"rotateX(".concat(-l.y*d,"deg) rotateY(").concat(l.x*d,"deg)")}_calculateZTransform(){let t=this._pos,i=this._map;if(!i||!t)return"";let n=0,a=this.getRotationAlignment();if(a==="map")if(i._showingGlobe()){let l=i.project(new qt(this._lngLat.lng,this._lngLat.lat+.001)),o=i.project(new qt(this._lngLat.lng,this._lngLat.lat-.001)).sub(l);n=ei(Math.atan2(o.y,o.x))-90}else n=-i.getBearing();else if(a==="horizon"){let l=pn(4,6,i.getZoom()),o=Ig(i.transform);o.y+=l*i.transform.height;let d=t.sub(o),s=ei(Math.atan2(d.y,d.x));n=(s>90?s-270:s+90)*(1-l)}return n+=this._rotation,n?"rotateZ(".concat(n,"deg)"):""}_update(t){T.cancelAnimationFrame(this._updateFrameId);let i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=QF(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),t===!0?this._updateFrameId=T.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),i._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._showingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=H.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let i=this._map;if(!i)return;let n=this._pointerdownPos,a=this._positionDelta;if(n&&a){if(!this._isDragging){let l=this._clickTolerance||i._clickTolerance;if(t.point.dist(n)<l)return;this._isDragging=!0}this._pos=t.point.sub(a),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Wt("dragstart"))),this.fire(new Wt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Wt("dragend")),this._state="inactive"}_addDragHandler(t){let i=this._map,n=this._pos;i&&n&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(n),this._pointerdownPos=t.point,this._state="pending",i.on("mousemove",this._onMove),i.on("touchmove",this._onMove),i.once("mouseup",this._onUp),i.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let i=this._map;return i&&(t?(i.on("mousedown",this._addDragHandler),i.on("touchstart",this._addDragHandler)):(i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let XB={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},JB=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vF(e=new H(0,0),t="bottom"){if(typeof e=="number"){let i=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new H(0,e);case"top-left":return new H(i,i);case"top-right":return new H(-i,i);case"bottom":return new H(0,-e);case"bottom-left":return new H(i,-i);case"bottom-right":return new H(-i,-i);case"left":return new H(e,0);case"right":return new H(-e,0)}return new H(0,0)}return e instanceof H||Array.isArray(e)?H.convert(e):H.convert(e[t]||[0,0])}class yB{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let i=xn((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,i,n){this._start=this.getValue(i),this._end=t,this._startTime=i,this._endTime=i+n}}let BB={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},MB={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},CB={showCompass:!0,showZoom:!0,visualizePitch:!1};class TB{constructor(t,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new XF({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new JF({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),Ni(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,i){this.mouseRotate.mousedown(t,i),this.mousePitch&&this.mousePitch.mousedown(t,i),n1()}move(t,i){let n=this.map,a=this.mouseRotate.mousemoveWindow(t,i),l=a&&a.bearingDelta;if(l&&n.setBearing(n.getBearing()+l),this.mousePitch){let o=this.mousePitch.mousemoveWindow(t,i),d=o&&o.pitchDelta;d&&n.setPitch(n.getPitch()+d)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){a1(),T.removeEventListener("mousemove",this.mousemove),T.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Xt({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),os(this.element,t)),T.addEventListener("mousemove",this.mousemove),T.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,os(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Sr(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Sr(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let kB={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},SB={maxWidth:100,unit:"metric"},QB={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ab={version:bt,supported:t1,setRTLTextPlugin:function(e,t,i=!1){if(Bn===y0||Bn===B0||Bn===M0)throw new Error("setRTLTextPlugin cannot be called multiple times.");Nl=ee.resolveURL(e),Bn=y0,C0=t,T0(),i||NZ()},getRTLTextPluginStatus:S0,Map:class extends YB{constructor(e){qp.mark(Cr.create);let t=e;if((e=Xt({},MB,e)).minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(i){let n=i.navigator?i.navigator.userAgent:null;return!!function(a){if(Ht==null){let l=a.navigator?a.navigator.userAgent:null;Ht=!!a.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ht}(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(T)&&(e.antialias=!1,A("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new hW(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new SF,this._domRenderTaskQueue=new SF,this._controls=[],this._markers=[],this._popups=[],this._mapId=Wa(),this._locale=Xt({},BB,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new yB(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new wt(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},typeof e.container=="string"){if(this._container=T.document.getElementById(e.container),!this._container)throw new Error("Container '".concat(e.container.toString(),"' not found."))}else{if(!(e.container instanceof T.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&A("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),Ni(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),T!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in T.document?"fullscreenchange":"webkitfullscreenchange",T.addEventListener("online",this._onWindowOnline,!1),T.addEventListener("resize",this._onWindowResize,!1),T.addEventListener("orientationchange",this._onWindowResize,!1),T.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),T.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new NB(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||Zt.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new Ky(typeof e.hash=="string"&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});let i=e.bounds;i&&(this.resize(),this.fitBounds(i,Xt({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new TF({customAttribution:e.customAttribution})),this._logoControl=new kF,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new Wt("".concat(i.dataType,"data"),i))}),this.on("dataloading",i=>{this.fire(new Wt("".concat(i.dataType,"dataloading"),i))})}_getMapId(){return this._mapId}addControl(e,t){if(t===void 0&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new $t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let i=e.onAdd(this);this._controls.push(e);let n=this._controlPositions[t];return t.indexOf("bottom")!==-1?n.insertBefore(i,n.firstChild):n.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new $t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new Wt("movestart",e)).fire(new Wt("move",e)),this.fire(new Wt("resize",e)),t&&this.fire(new Wt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(Tn.convert(e)),this._update()}setMinZoom(e){if((e=e==null?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Wt("zoomstart")).fire(new Wt("zoom")).fire(new Wt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e==null?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Wt("zoomstart")).fire(new Wt("zoom")).fire(new Wt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e==null?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Wt("pitchstart")).fire(new Wt("pitch")).fire(new Wt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e==null?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Wt("pitchstart")).fire(new Wt("pitch")).fire(new Wt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return e==="auto"?T.navigator.language:Array.isArray(e)?e.length===0?void 0:e.map(t=>t==="auto"?T.navigator.language:t):e}setLanguage(e){let t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(e){return this._lazyInitEmptyStyle(),e?typeof e=="string"&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let e=this.transform,t=e.projection.name,i;t==="globe"&&e.zoom>=Cl?(e.setMercatorFromTransition(),i=!0):t==="mercator"&&e.zoom<Cl&&(e.setProjection({name:"globe"}),i=!0),i&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t=e.name==="globe"&&this.transform.zoom>=Cl?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(qt.convert(e))}unproject(e){return this.transform.pointLocation3D(H.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if(e==="mouseenter"||e==="mouseover"){let n=!1,a=o=>{let d=t.filter(r=>this.getLayer(r)),s=d.length?this.queryRenderedFeatures(o.point,{layers:d}):[];s.length?n||(n=!0,i.call(this,new Hn(e,this,o.originalEvent,{features:s}))):n=!1},l=()=>{n=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:a,mouseout:l}}}if(e==="mouseleave"||e==="mouseout"){let n=!1,a=o=>{let d=t.filter(s=>this.getLayer(s));(d.length?this.queryRenderedFeatures(o.point,{layers:d}):[]).length?n=!0:n&&(n=!1,i.call(this,new Hn(e,this,o.originalEvent)))},l=o=>{n&&(n=!1,i.call(this,new Hn(e,this,o.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:a,mouseout:l}}}{let n=a=>{let l=t.filter(d=>this.getLayer(d)),o=l.length?this.queryRenderedFeatures(a.point,{layers:l}):[];o.length&&(a.features=o,i.call(this,a),delete a.features)};return{layers:new Set(t),listener:i,delegates:{[e]:n}}}}on(e,t,i){if(i===void 0)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t){for(let a of t)if(!this._isValidId(a))return this}let n=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(let a in n.delegates)this.on(a,n.delegates[a]);return this}once(e,t,i){if(i===void 0)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t){for(let a of t)if(!this._isValidId(a))return this}let n=this._createDelegatedListener(e,t,i);for(let a in n.delegates)this.once(a,n.delegates[a]);return this}off(e,t,i){if(i===void 0)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(let l of t)if(!this._isValidId(l))return this;let n=(l,o)=>{if(l.size!==o.size)return!1;for(let d of l)if(!o.has(d))return!1;return!0},a=this._delegatedListeners?this._delegatedListeners[e]:void 0;return a&&(l=>{for(let o=0;o<l.length;o++){let d=l[o];if(d.listener===i&&n(d.layers,t)){for(let s in d.delegates)this.off(s,d.delegates[s]);return l.splice(o,1),this}}})(a),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(t!==void 0||e===void 0||e instanceof H||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(let i of t.layers)if(!this._isValidId(i))return[]}return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&A("".concat(t," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(H.convert(e))}setStyle(e,t){return(t=Xt({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){let t=this._locale[e];if(t==null)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new xa(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e=="string"?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if(typeof e=="string"){let i=this._requestManager.normalizeStyleURL(e),n=this._requestManager.transformRequest(i,nt.Style);gt(n,(a,l)=>{a?this.fire(new $t(a)):l&&this._updateDiff(l,t)})}else typeof e=="object"&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(i){A("Unable to perform style diff: ".concat(i.message||i.error||i,".  Rebuilding the style from scratch.")),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(A("There is no style added to the map."),!1)}_isValidId(e){return e==null?(this.fire(new $t(new Error("IDs can't be empty."))),!1):!JZ(e)||(this.fire(new $t(new Error("IDs can't contain special symbols: \"".concat(e,'".')))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){let e=this.style&&this.style._sourceCaches;for(let t in e){let i=e[t]._tiles;for(let n in i){let a=i[n];if(a.state!=="loaded"&&a.state!=="errored")return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:i=1,sdf:n=!1,stretchX:a,stretchY:l,content:o}={}){if(this._lazyInitEmptyStyle(),t instanceof T.HTMLImageElement||T.ImageBitmap&&t instanceof T.ImageBitmap){let{width:d,height:s,data:r}=ee.getImageData(t);this.style.addImage(e,{data:new Yi({width:d,height:s},r),pixelRatio:i,stretchX:a,stretchY:l,content:o,sdf:n,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new $t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:d,height:s}=t,r=t;this.style.addImage(e,{data:new Yi({width:d,height:s},new Uint8Array(r.data)),pixelRatio:i,stretchX:a,stretchY:l,content:o,sdf:n,version:0,userImage:r}),r.onAdd&&r.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();let i=this.style.getImage(e);if(!i)return void this.fire(new $t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let n=t instanceof T.HTMLImageElement||T.ImageBitmap&&t instanceof T.ImageBitmap?ee.getImageData(t):t,{width:a,height:l}=n;a!==void 0&&l!==void 0?a===i.data.width&&l===i.data.height?(i.data.replace(n.data,!(t instanceof T.HTMLImageElement||T.ImageBitmap&&t instanceof T.ImageBitmap)),this.style.updateImage(e,i)):this.fire(new $t(new Error("The width and height of the updated image (".concat(a,", ").concat(l,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")")))):this.fire(new $t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new $t(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){de(this._requestManager.transformRequest(e,nt.Image),(i,n)=>{t(i,n instanceof T.HTMLImageElement?ee.getImageData(n):n)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new $t(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,n={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,n),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,n={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,n),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&e.length===1&&e[0].type==="flat"){let t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let e=this.style.getLights()||[];return e.length===0&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch(e["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(qt.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;let e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,i,n,a,l=this._container;for(;l&&(!n||!a);){let o=T.getComputedStyle(l).transform;o&&o!=="none"&&(i=o.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&i[0]!=="0"&&i[0]!=="1"&&(n=i[0]),i[3]&&i[3]!=="0"&&i[3]!=="1"&&(a=i[3])),l=l.parentElement}this._containerWidth=n?Math.abs(e/n):e,this._containerHeight=a?Math.abs(t/a):t}_detectMissingCSS(){T.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&A("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=qe("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=qe("div","mapboxgl-canvas-container",e);this._canvas=qe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let i=this._controlContainer=qe("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{n[a]=qe("div","mapboxgl-ctrl-".concat(a),i)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){let i=ee.devicePixelRatio||1;this._canvas.width=i*Math.ceil(e),this._canvas.height=i*Math.ceil(t),this._canvas.style.width="".concat(e,"px"),this._canvas.style.height="".concat(t,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){let t=this._markers.indexOf(e);t!==-1&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){let t=this._popups.indexOf(e);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let e=Xt({},t1.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(Pp(t,!0),this.painter=new Ly(t,this._contextCreateOptions,this.transform),this.on("data",i=>{i.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),Ct.testSupport(t)):this.fire(new $t(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Wt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Wt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Wt("renderstart"));let i=this.painter.context.extTimerQuery,n=ee.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=a.createQuery(),a.beginQuery(i.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],T.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],T.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();let l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let s=this.transform.zoom,r=this.transform.pitch,c=ee.now(),b=new si(s,{now:c,fadeDuration:l,pitch:r,transition:this.style.transition});this.style.update(b)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let o=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),o=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):o=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Wt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Wt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let s=ee.now()-n;a.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{let r=a.getQueryParameter(t,a.QUERY_RESULT)/1e6;a.deleteQuery(t),this.fire(new Wt("gpu-timing-frame",{cpuTime:s,gpuTime:r})),T.performance.mark("frame-gpu",{startTime:n,detail:{gpuTime:r}})},50)}if(this.listens("gpu-timing-layer")){let s=this.painter.collectGpuTimers();setTimeout(()=>{let r=this.painter.queryGpuTimers(s);this.fire(new Wt("gpu-timing-layer",{layerTimes:r}))},50)}if(this.listens("gpu-timing-deferred-render")){let s=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let r=this.painter.queryGpuTimeDeferredRender(s);this.fire(new Wt("gpu-timing-deferred-render",{gpuTime:r}))},50)}let d=this._sourcesDirty||this._styleDirty||this._placementDirty||o;if(d||this._repaint)this.triggerRepaint();else{let s=!this.isMoving()&&this.loaded();if(s&&(o=this._updateAverageElevation(n,!0)),o)this.triggerRepaint();else if(this._triggerFrame(!1),s&&(this.fire(new Wt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let r=this._calculateSpeedIndex();this.fire(new Wt("speedindexcompleted",{speedIndex:r})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,qp.mark(Cr.fullLoad),this._performanceMetricsCollection&&FU(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(let t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){let i=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&i(0);let n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){let a=this.transform.averageElevation,l=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(l)?l=0:this._averageElevationLastSampledAt=e;let o=Math.abs(a-l);if(o>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(l),i(l);this._averageElevation.easeTo(l,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(l),i(l)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){IU(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===je||e.status===401)){let t=this.painter.context.gl;Pp(t,!1),this._logoControl instanceof kF&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new $t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),GU(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){let e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let i=this.painter.context.gl,n=i.createFramebuffer();function a(l){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,l,0);let o=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,o),o}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(a(e),t.canvasCopies.map(a),t.timeStamps)}_canvasPixelComparison(e,t,i){let n=i[1]-i[0],a=e.length/4;for(let l=0;l<t.length;l++){let o=t[l],d=0;for(let s=0;s<o.length;s+=4)o[s]===e[s]&&o[s+1]===e[s+1]&&o[s+2]===e[s+2]&&o[s+3]===e[s+3]&&(d+=1);n+=(i[l+2]-i[l+1])*(1-d/a)}return n}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),T!==void 0&&(T.removeEventListener("resize",this._onWindowResize,!1),T.removeEventListener("orientationchange",this._onWindowResize,!1),T.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),T.removeEventListener("online",this._onWindowOnline,!1),T.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Mr.delete(this.painter.context.gl),this._removed=!0,this.fire(new Wt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ee.frame(t=>{let i=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,i&&this._render(t)}))}_preloadTiles(e){return Ln(this.style?Object.values(this.style._sourceCaches):[],(t,i)=>t._preloadTiles(e,i),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){T.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){(function(i,n){rn=i,Zn=n})(e,t)}get version(){return bt}},NavigationControl:class{constructor(e){this.options=Xt({},CB,e),this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(Ni(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),qe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),qe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Ni(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let i=this._map;i&&(this.options.visualizePitch?i.resetNorthPitch({},{originalEvent:t}):i.resetNorth({},{originalEvent:t}))}),this._compassIcon=qe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let e=this._map;if(!e)return;let t=e.getZoom(),i=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){let e=this._map;if(!e)return;let t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new TB(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){let e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){let i=qe("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;let i=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends Xi{constructor(e){super(),this.options=Xt({geolocation:T.navigator.geolocation},kB,e),Ni(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=NF(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){let t=(i=!!this.options.geolocation)=>{this._supportsGeolocation=i,e(i)};this._supportsGeolocation!==void 0?e(this._supportsGeolocation):T.navigator.permissions!==void 0?T.navigator.permissions.query({name:"geolocation"}).then(i=>t(i.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){let t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Wt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Wt("geolocate",e)),this._finish()}}_updateCamera(e){let t=new qt(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,n=Xt({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(i),n,{geolocateSource:!0})}_updateMarker(e){if(e){let t=new qt(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let e=this._map.transform,t=He(1,e._center.lat)*e.worldSize,i=Math.ceil(2*this._accuracy*t);this._circleElement.style.width="".concat(i,"px"),this._circleElement.style.height="".concat(i,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Wt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=qe("button","mapboxgl-ctrl-geolocate",this._container),qe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){A("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=qe("div","mapboxgl-user-location"),this._dotElement.appendChild(qe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(qe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $W({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=qe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $W({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Wt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:e.absolute===!0&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return A("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Wt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Wt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Wt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let e=()=>{T.addEventListener("ondeviceorientationabsolute"in T?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};T.DeviceMotionEvent!==void 0&&typeof T.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),T.removeEventListener("deviceorientation",this._onDeviceOrientation),T.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:TF,ScaleControl:class{constructor(e){this.options=Xt({},SB,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Ni(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,n=t._containerWidth/2-e/2,a=t.unproject([n,i]),l=t.unproject([n+e,i]),o=a.distanceTo(l);if(this.options.unit==="imperial"){let d=3.2808*o;d>5280?this._setScale(e,d/5280,"mile"):this._setScale(e,d,"foot")}else this.options.unit==="nautical"?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}_setScale(e,t,i){this._map._requestDomTask(()=>{let n=function(l){let o=Math.pow(10,"".concat(Math.floor(l)).length-1),d=l/o;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(s){let r=Math.pow(10,Math.ceil(-Math.log(s)/Math.LN10));return Math.round(s*r)/r}(d),o*d}(t),a=n/t;this._container.innerHTML=this._isNumberFormatSupported&&i!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(n):"".concat(n,"&nbsp;").concat(QB[i]),this._container.style.width=e*a+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof T.HTMLElement?this._container=e.container:A("Full screen control 'container' must be a DOM element.")),Ni(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in T.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in T.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",A("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,T.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!T.document.fullscreenEnabled&&!T.document.webkitFullscreenEnabled)}_setupUI(){let e=this._fullscreenButton=qe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);qe("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),T.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(T.document.fullscreenElement||T.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?T.document.exitFullscreen?T.document.exitFullscreen():T.document.webkitCancelFullScreen&&T.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Xi{constructor(e){super(),this.options=Xt(Object.create(XB),e),Ni(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Wt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Wt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=qt.convert(e),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(T.document.createTextNode(e))}setHTML(e){let t=T.document.createDocumentFragment(),i=T.document.createElement("body"),n;for(i.innerHTML=e;n=i.firstChild,n;)t.appendChild(n);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=qe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){let i=this._closeButton=qe("button","mapboxgl-popup-close-button",t);i.type="button",i.setAttribute("aria-label","Close popup"),i.setAttribute("aria-hidden","true"),i.innerHTML="&#215;",i.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;let t=this._map,i=this._container,n=this._pos;if(!t||!i||!n)return"bottom";let a=i.offsetWidth,l=i.offsetHeight,o=n.x<a/2,d=n.x>t.transform.width-a/2;if(n.y+e<l)return o?"top-left":d?"top-right":"top";if(n.y>t.transform.height-l){if(o)return"bottom-left";if(d)return"bottom-right"}return o?"left":d?"right":"bottom"}_updateClassList(){let e=this._container;if(!e)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){let t=this._map,i=this._content;if(!t||!this._lngLat&&!this._trackPointer||!i)return;let n=this._container;if(n||(n=this._container=qe("div","mapboxgl-popup",t.getContainer()),this._tip=qe("div","mapboxgl-popup-tip",n),n.appendChild(i)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=QF(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){let a=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),l=vF(this.options.offset),o=this._anchor=this._getAnchor(l.y),d=vF(this.options.offset,o),s=a.add(d).round();t._requestDomTask(()=>{this._container&&o&&(this._container.style.transform="".concat(qW[o]," translate(").concat(s.x,"px,").concat(s.y,"px)"))})}if(!this._marker&&t._showingGlobe()){let a=Nc(t.transform,this._lngLat)?0:1;this._setOpacity(a)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let e=this._container.querySelector(JB);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:$W,Style:xa,LngLat:qt,LngLatBounds:Tn,Point:H,MercatorCoordinate:Re,FreeCameraOptions:_u,Evented:Xi,config:Zt,prewarm:function(){dr().acquire(IW)},clearPrewarmedResources:function(){let e=or;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(IW),or=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return Zt.ACCESS_TOKEN},set accessToken(e){Zt.ACCESS_TOKEN=e},get baseApiUrl(){return Zt.API_URL},set baseApiUrl(e){Zt.API_URL=e},get workerCount(){return Sd.workerCount},set workerCount(e){Sd.workerCount=e},get maxParallelImageRequests(){return Zt.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){Zt.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){(function(t){if(!Do())return;let i=T.caches.delete(ii);t&&i.catch(t).then(()=>t())})(e)},workerUrl:"",workerClass:null,get dracoUrl(){return cG()},set dracoUrl(e){(function(t){UW=ee.resolveURL(t),xW||(xW=new Xo(dr(),new Xi)),xW.broadcast("setDracoUrl",UW)})(e)},setNow:ee.setNow,restoreNow:ee.restoreNow};j.A=eG,j.D=wc,j.E=tt,j.F=Hh,j.K=Yb,j.O=Xe,j.P=H,j.T=RR,j.V=fc,j.a=vc,j.b=qg,j.c=gb,j.d=class extends Xi{constructor(e,t,i,n,a,l){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=a||sG,this.loading={},this.loaded={},this.deduped=new dG(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler,this.brightness=l}loadTile(e,t){let i=e.uid,n=e&&e.request,a=n&&n.collectResourceTiming,l=this.loading[i]=new n2(e);l.abort=this.loadVectorData(e,(o,d)=>{let s=!this.loading[i];if(delete this.loading[i],s||o||!d)return l.status="done",s||(this.loaded[i]=l),t(o);let r=d.rawData,c={};d.expires&&(c.expires=d.expires),d.cacheControl&&(c.cacheControl=d.cacheControl),l.vectorTile=d.vectorTile||new wh(new Ac(r));let b=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,(m,h)=>{if(m||!h)return t(m);let W={};if(a){let p=$p(n);p.length>0&&(W.resourceTiming=JSON.parse(JSON.stringify(p)))}t(null,Xt({rawTileData:r.slice(0)},h,c,W))})};this.isSpriteLoaded?b():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(b,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):b()}),this.loaded=this.loaded||{},this.loaded[i]=l})}reloadTile(e,t){let i=this.loaded,n=e.uid,a=this;if(i&&i[n]){let l=i[n];l.showCollisionBoxes=e.showCollisionBoxes,l.projection=e.projection,l.brightness=e.brightness,l.tileTransform=Io(e.tileID.canonical,e.projection),l.extraShadowCaster=e.extraShadowCaster;let o=(d,s)=>{let r=l.reloadCallback;r&&(delete l.reloadCallback,l.parse(l.vectorTile,a.layerIndex,this.availableImages,a.actor,r)),t(d,s)};l.status==="parsing"?l.reloadCallback=o:l.status==="done"&&(l.vectorTile?l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}else t(null,void 0)}abortTile(e,t){let i=e.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),t()}removeTile(e,t){let i=this.loaded,n=e.uid;i&&i[n]&&delete i[n],t()}},j.e=Il,j.f=$p,j.g=we,j.h=gt,j.i=Ft,j.j=function(e,t){let i=BW(e);for(let n of i){for(let a of n.meshes)h2(a);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(W2(n.lights,t)))}return i},j.k=si,j.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==mG){let i=new Uint32Array(e,0,7),[,,n,a,l,o]=i;t=i.byteLength+a+l+o+l,(n!==e.byteLength||t>=e.byteLength)&&A("Invalid b3dm header information.")}return ZG(e,t)},j.m=$c,j.n=ta,j.o=Wt,j.p=Pe,j.q=function(e){Yn(),Vn&&Vn.then(t=>{t.keys().then(i=>{for(let n=0;n<i.length-e;n++)t.delete(i[n])})})},j.r=GG,j.s=Ab,j.t=Ss,j.v=Dn,j.w=T}),M(["./shared"],function(j){"use strict";function T(pt){if(typeof pt=="number"||typeof pt=="boolean"||typeof pt=="string"||pt==null)return JSON.stringify(pt);if(Array.isArray(pt)){let v="[";for(let A of pt)v+="".concat(T(A),",");return"".concat(v,"]")}let k="{";for(let v of Object.keys(pt).sort())k+="".concat(v,":").concat(T(pt[v]),",");return"".concat(k,"}")}function bt(pt){let k="";for(let v of j.r)k+="/".concat(T(pt[v]));return k}class Ut{constructor(k){this.keyCache={},this._layers={},this._layerConfigs={},k&&this.replace(k)}replace(k,v){this._layerConfigs={},this._layers={},this.update(k,[],v)}update(k,v,A){this._options=A;for(let ct of k){this._layerConfigs[ct.id]=ct;let xt=this._layers[ct.id]=j.c(ct,this._options);xt.setScope(this.scope),xt.compileFilter(),this.keyCache[ct.id]&&delete this.keyCache[ct.id]}for(let ct of v)delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct];this.familiesBySource={};let dt=function(ct,xt){let Qt={};for(let Lt=0;Lt<ct.length;Lt++){let Ht=xt&&xt[ct[Lt].id]||bt(ct[Lt]);xt&&(xt[ct[Lt].id]=Ht);let Kt=Qt[Ht];Kt||(Kt=Qt[Ht]=[]),Kt.push(ct[Lt])}let rt=[];for(let Lt in Qt)rt.push(Qt[Lt]);return rt}(j.v(this._layerConfigs),this.keyCache);for(let ct of dt){let xt=ct.map(De=>this._layers[De.id]),Qt=xt[0];if(Qt.visibility==="none")continue;let rt=Qt.source||"",Lt=this.familiesBySource[rt];Lt||(Lt=this.familiesBySource[rt]={});let Ht=Qt.sourceLayer||"_geojsonTileLayer",Kt=Lt[Ht];Kt||(Kt=Lt[Ht]=[]),Kt.push(xt)}}}class Zt{loadTile(k,v){let{uid:A,encoding:dt,rawImageData:ct,padding:xt}=k,Qt=j.w.ImageBitmap&&ct instanceof j.w.ImageBitmap?this.getImageData(ct,xt):ct;v(null,new j.D(A,Qt,dt,xt<1))}getImageData(k,v){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);let A=this.offscreenCanvasContext.getImageData(-v,-v,k.width+2*v,k.height+2*v);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),A}}function Ct(pt,k){if(pt.length!==0){Ge(pt[0],k);for(var v=1;v<pt.length;v++)Ge(pt[v],!k)}}function Ge(pt,k){for(var v=0,A=0,dt=0,ct=pt.length,xt=ct-1;dt<ct;xt=dt++){var Qt=(pt[dt][0]-pt[xt][0])*(pt[xt][1]+pt[dt][1]),rt=v+Qt;A+=Math.abs(v)>=Math.abs(Qt)?v-rt+Qt:Qt-rt+v,v=rt}v+A>=0!=!!k&&pt.reverse()}var Ue=j.g(function pt(k,v){var A,dt=k&&k.type;if(dt==="FeatureCollection")for(A=0;A<k.features.length;A++)pt(k.features[A],v);else if(dt==="GeometryCollection")for(A=0;A<k.geometries.length;A++)pt(k.geometries[A],v);else if(dt==="Feature")pt(k.geometry,v);else if(dt==="Polygon")Ct(k.coordinates,v);else if(dt==="MultiPolygon")for(A=0;A<k.coordinates.length;A++)Ct(k.coordinates[A],v);return k});let ue=j.V.prototype.toGeoJSON;var Ke={exports:{}},ye=j.p,Ae=j.a.VectorTileFeature,we=Fi;function Fi(pt,k){this.options=k||{},this.features=pt,this.length=pt.length}function mi(pt,k){this.id=typeof pt.id=="number"?pt.id:void 0,this.type=pt.type,this.rawGeometry=pt.type===1?[pt.geometry]:pt.geometry,this.properties=pt.tags,this.extent=k||4096}Fi.prototype.feature=function(pt){return new mi(this.features[pt],this.options.extent)},mi.prototype.loadGeometry=function(){var pt=this.rawGeometry;this.geometry=[];for(var k=0;k<pt.length;k++){for(var v=pt[k],A=[],dt=0;dt<v.length;dt++)A.push(new ye(v[dt][0],v[dt][1]));this.geometry.push(A)}return this.geometry},mi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var pt=this.geometry,k=1/0,v=-1/0,A=1/0,dt=-1/0,ct=0;ct<pt.length;ct++)for(var xt=pt[ct],Qt=0;Qt<xt.length;Qt++){var rt=xt[Qt];k=Math.min(k,rt.x),v=Math.max(v,rt.x),A=Math.min(A,rt.y),dt=Math.max(dt,rt.y)}return[k,A,v,dt]},mi.prototype.toGeoJSON=Ae.prototype.toGeoJSON;var Te=j.b,Pe=we;function Qe(pt){var k=new Te;return function(v,A){for(var dt in v.layers)A.writeMessage(3,H,v.layers[dt])}(pt,k),k.finish()}function H(pt,k){var v;k.writeVarintField(15,pt.version||1),k.writeStringField(1,pt.name||""),k.writeVarintField(5,pt.extent||4096);var A={keys:[],values:[],keycache:{},valuecache:{}};for(v=0;v<pt.length;v++)A.feature=pt.feature(v),k.writeMessage(2,te,A);var dt=A.keys;for(v=0;v<dt.length;v++)k.writeStringField(3,dt[v]);var ct=A.values;for(v=0;v<ct.length;v++)k.writeMessage(4,tn,ct[v])}function te(pt,k){var v=pt.feature;v.id!==void 0&&k.writeVarintField(1,v.id),k.writeMessage(2,zi,pt),k.writeVarintField(3,v.type),k.writeMessage(4,ei,v)}function zi(pt,k){var v=pt.feature,A=pt.keys,dt=pt.values,ct=pt.keycache,xt=pt.valuecache;for(var Qt in v.properties){var rt=v.properties[Qt],Lt=ct[Qt];if(rt!==null){Lt===void 0&&(A.push(Qt),ct[Qt]=Lt=A.length-1),k.writeVarint(Lt);var Ht=typeof rt;Ht!=="string"&&Ht!=="boolean"&&Ht!=="number"&&(rt=JSON.stringify(rt));var Kt=Ht+":"+rt,De=xt[Kt];De===void 0&&(dt.push(rt),xt[Kt]=De=dt.length-1),k.writeVarint(De)}}}function Vi(pt,k){return(k<<3)+(7&pt)}function At(pt){return pt<<1^pt>>31}function ei(pt,k){for(var v=pt.loadGeometry(),A=pt.type,dt=0,ct=0,xt=v.length,Qt=0;Qt<xt;Qt++){var rt=v[Qt],Lt=1;A===1&&(Lt=rt.length),k.writeVarint(Vi(1,Lt));for(var Ht=A===3?rt.length-1:rt.length,Kt=0;Kt<Ht;Kt++){Kt===1&&A!==1&&k.writeVarint(Vi(2,Ht-1));var De=rt[Kt].x-dt,li=rt[Kt].y-ct;k.writeVarint(At(De)),k.writeVarint(At(li)),dt+=De,ct+=li}A===3&&k.writeVarint(Vi(7,1))}}function tn(pt,k){var v=typeof pt;v==="string"?k.writeStringField(1,pt):v==="boolean"?k.writeBooleanField(7,pt):v==="number"&&(pt%1!=0?k.writeDoubleField(3,pt):pt<0?k.writeSVarintField(6,pt):k.writeVarintField(5,pt))}Ke.exports=Qe,Ke.exports.fromVectorTileJs=Qe,Ke.exports.fromGeojsonVt=function(pt,k){k=k||{};var v={};for(var A in pt)v[A]=new Pe(pt[A].features,k),v[A].name=A,v[A].version=k.version,v[A].extent=k.extent;return Qe({layers:v})},Ke.exports.GeoJSONWrapper=Pe;var xn=j.g(Ke.exports);let ha={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pt=>pt},Ai=Math.fround||(en=new Float32Array(1),pt=>(en[0]=+pt,en[0]));var en;let sn=3,Mt=5,pn=6;class Nn{constructor(k){this.options=Object.assign(Object.create(ha),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){let{log:v,minZoom:A,maxZoom:dt}=this.options;v&&console.time("total time");let ct="prepare ".concat(k.length," points");v&&console.time(ct),this.points=k;let xt=[];for(let rt=0;rt<k.length;rt++){let Lt=k[rt];if(!Lt.geometry)continue;let[Ht,Kt]=Lt.geometry.coordinates,De=Ai(Xt(Ht)),li=Ai(Ci(Kt));xt.push(De,li,1/0,rt,-1,1),this.options.reduce&&xt.push(0)}let Qt=this.trees[dt+1]=this._createTree(xt);v&&console.timeEnd(ct);for(let rt=dt;rt>=A;rt--){let Lt=+Date.now();Qt=this.trees[rt]=this._createTree(this._cluster(Qt,rt)),v&&console.log("z%d: %d clusters in %dms",rt,Qt.numItems,+Date.now()-Lt)}return v&&console.timeEnd("total time"),this}getClusters(k,v){let A=((k[0]+180)%360+360)%360-180,dt=Math.max(-90,Math.min(90,k[1])),ct=k[2]===180?180:((k[2]+180)%360+360)%360-180,xt=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)A=-180,ct=180;else if(A>ct){let Kt=this.getClusters([A,dt,180,xt],v),De=this.getClusters([-180,dt,ct,xt],v);return Kt.concat(De)}let Qt=this.trees[this._limitZoom(v)],rt=Qt.range(Xt(A),Ci(xt),Xt(ct),Ci(dt)),Lt=Qt.data,Ht=[];for(let Kt of rt){let De=this.stride*Kt;Ht.push(Lt[De+Mt]>1?Ln(Lt,De,this.clusterProps):this.points[Lt[De+sn]])}return Ht}getChildren(k){let v=this._getOriginId(k),A=this._getOriginZoom(k),dt="No cluster with the specified id.",ct=this.trees[A];if(!ct)throw new Error(dt);let xt=ct.data;if(v*this.stride>=xt.length)throw new Error(dt);let Qt=this.options.radius/(this.options.extent*Math.pow(2,A-1)),rt=ct.within(xt[v*this.stride],xt[v*this.stride+1],Qt),Lt=[];for(let Ht of rt){let Kt=Ht*this.stride;xt[Kt+4]===k&&Lt.push(xt[Kt+Mt]>1?Ln(xt,Kt,this.clusterProps):this.points[xt[Kt+sn]])}if(Lt.length===0)throw new Error(dt);return Lt}getLeaves(k,v,A){let dt=[];return this._appendLeaves(dt,k,v=v||10,A=A||0,0),dt}getTile(k,v,A){let dt=this.trees[this._limitZoom(k)],ct=Math.pow(2,k),{extent:xt,radius:Qt}=this.options,rt=Qt/xt,Lt=(A-rt)/ct,Ht=(A+1+rt)/ct,Kt={features:[]};return this._addTileFeatures(dt.range((v-rt)/ct,Lt,(v+1+rt)/ct,Ht),dt.data,v,A,ct,Kt),v===0&&this._addTileFeatures(dt.range(1-rt/ct,Lt,1,Ht),dt.data,ct,A,ct,Kt),v===ct-1&&this._addTileFeatures(dt.range(0,Lt,rt/ct,Ht),dt.data,-1,A,ct,Kt),Kt.features.length?Kt:null}getClusterExpansionZoom(k){let v=this._getOriginZoom(k)-1;for(;v<=this.options.maxZoom;){let A=this.getChildren(k);if(v++,A.length!==1)break;k=A[0].properties.cluster_id}return v}_appendLeaves(k,v,A,dt,ct){let xt=this.getChildren(v);for(let Qt of xt){let rt=Qt.properties;if(rt&&rt.cluster?ct+rt.point_count<=dt?ct+=rt.point_count:ct=this._appendLeaves(k,rt.cluster_id,A,dt,ct):ct<dt?ct++:k.push(Qt),k.length===A)break}return ct}_createTree(k){let v=new j.K(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let A=0;A<k.length;A+=this.stride)v.add(k[A],k[A+1]);return v.finish(),v.data=k,v}_addTileFeatures(k,v,A,dt,ct,xt){for(let Qt of k){let rt=Qt*this.stride,Lt=v[rt+Mt]>1,Ht,Kt,De;if(Lt)Ht=Dn(v,rt,this.clusterProps),Kt=v[rt],De=v[rt+1];else{let Wi=this.points[v[rt+sn]];Ht=Wi.properties;let[Ii,ii]=Wi.geometry.coordinates;Kt=Xt(Ii),De=Ci(ii)}let li={type:1,geometry:[[Math.round(this.options.extent*(Kt*ct-A)),Math.round(this.options.extent*(De*ct-dt))]],tags:Ht},Ti;Ti=Lt||this.options.generateId?v[rt+sn]:this.points[v[rt+sn]].id,Ti!==void 0&&(li.id=Ti),xt.features.push(li)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,v){let{radius:A,extent:dt,reduce:ct,minPoints:xt}=this.options,Qt=A/(dt*Math.pow(2,v)),rt=k.data,Lt=[],Ht=this.stride;for(let Kt=0;Kt<rt.length;Kt+=Ht){if(rt[Kt+2]<=v)continue;rt[Kt+2]=v;let De=rt[Kt],li=rt[Kt+1],Ti=k.within(rt[Kt],rt[Kt+1],Qt),Wi=rt[Kt+Mt],Ii=Wi;for(let ii of Ti){let rn=ii*Ht;rt[rn+2]>v&&(Ii+=rt[rn+Mt])}if(Ii>Wi&&Ii>=xt){let ii,rn=De*Wi,Zn=li*Wi,Vn=-1,pa=((Kt/Ht|0)<<5)+(v+1)+this.points.length;for(let Do of Ti){let Yn=Do*Ht;if(rt[Yn+2]<=v)continue;rt[Yn+2]=v;let Ha=rt[Yn+Mt];rn+=rt[Yn]*Ha,Zn+=rt[Yn+1]*Ha,rt[Yn+4]=pa,ct&&(ii||(ii=this._map(rt,Kt,!0),Vn=this.clusterProps.length,this.clusterProps.push(ii)),ct(ii,this._map(rt,Yn)))}rt[Kt+4]=pa,Lt.push(rn/Ii,Zn/Ii,1/0,pa,-1,Ii),ct&&Lt.push(Vn)}else{for(let ii=0;ii<Ht;ii++)Lt.push(rt[Kt+ii]);if(Ii>1)for(let ii of Ti){let rn=ii*Ht;if(!(rt[rn+2]<=v)){rt[rn+2]=v;for(let Zn=0;Zn<Ht;Zn++)Lt.push(rt[rn+Zn])}}}}return Lt}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,v,A){if(k[v+Mt]>1){let xt=this.clusterProps[k[v+pn]];return A?Object.assign({},xt):xt}let dt=this.points[k[v+sn]].properties,ct=this.options.map(dt);return A&&ct===dt?Object.assign({},ct):ct}}function Ln(pt,k,v){return{type:"Feature",id:pt[k+sn],properties:Dn(pt,k,v),geometry:{type:"Point",coordinates:[(A=pt[k],360*(A-.5)),wa(pt[k+1])]}};var A}function Dn(pt,k,v){let A=pt[k+Mt],dt=A>=1e4?"".concat(Math.round(A/1e3),"k"):A>=1e3?Math.round(A/100)/10+"k":A,ct=pt[k+pn],xt=ct===-1?{}:Object.assign({},v[ct]);return Object.assign(xt,{cluster:!0,cluster_id:pt[k+sn],point_count:A,point_count_abbreviated:dt})}function Xt(pt){return pt/360+.5}function Ci(pt){let k=Math.sin(pt*Math.PI/180),v=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return v<0?0:v>1?1:v}function wa(pt){let k=(180-360*pt)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}var Wa={exports:{}};Wa.exports=function(){function pt(nt,lt,ht,Vt){for(var gt,Ft=Vt,Nt=ht-lt>>1,ut=ht-lt,St=nt[lt],It=nt[lt+1],de=nt[ht],je=nt[ht+1],wt=lt+3;wt<ht;wt+=3){var ve=k(nt[wt],nt[wt+1],St,It,de,je);if(ve>Ft)gt=wt,Ft=ve;else if(ve===Ft){var pi=Math.abs(wt-Nt);pi<ut&&(gt=wt,ut=pi)}}Ft>Vt&&(gt-lt>3&&pt(nt,lt,gt,Vt),nt[gt+2]=Ft,ht-gt>3&&pt(nt,gt,ht,Vt))}function k(nt,lt,ht,Vt,gt,Ft){var Nt=gt-ht,ut=Ft-Vt;if(Nt!==0||ut!==0){var St=((nt-ht)*Nt+(lt-Vt)*ut)/(Nt*Nt+ut*ut);St>1?(ht=gt,Vt=Ft):St>0&&(ht+=Nt*St,Vt+=ut*St)}return(Nt=nt-ht)*Nt+(ut=lt-Vt)*ut}function v(nt,lt,ht,Vt){var gt={id:nt===void 0?null:nt,type:lt,geometry:ht,tags:Vt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ft){var Nt=Ft.geometry,ut=Ft.type;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")A(Ft,Nt);else if(ut==="Polygon"||ut==="MultiLineString")for(var St=0;St<Nt.length;St++)A(Ft,Nt[St]);else if(ut==="MultiPolygon")for(St=0;St<Nt.length;St++)for(var It=0;It<Nt[St].length;It++)A(Ft,Nt[St][It])}(gt),gt}function A(nt,lt){for(var ht=0;ht<lt.length;ht+=3)nt.minX=Math.min(nt.minX,lt[ht]),nt.minY=Math.min(nt.minY,lt[ht+1]),nt.maxX=Math.max(nt.maxX,lt[ht]),nt.maxY=Math.max(nt.maxY,lt[ht+1])}function dt(nt,lt,ht,Vt){if(lt.geometry){var gt=lt.geometry.coordinates,Ft=lt.geometry.type,Nt=Math.pow(ht.tolerance/((1<<ht.maxZoom)*ht.extent),2),ut=[],St=lt.id;if(ht.promoteId?St=lt.properties[ht.promoteId]:ht.generateId&&(St=Vt||0),Ft==="Point")ct(gt,ut);else if(Ft==="MultiPoint")for(var It=0;It<gt.length;It++)ct(gt[It],ut);else if(Ft==="LineString")xt(gt,ut,Nt,!1);else if(Ft==="MultiLineString"){if(ht.lineMetrics){for(It=0;It<gt.length;It++)xt(gt[It],ut=[],Nt,!1),nt.push(v(St,"LineString",ut,lt.properties));return}Qt(gt,ut,Nt,!1)}else if(Ft==="Polygon")Qt(gt,ut,Nt,!0);else{if(Ft!=="MultiPolygon"){if(Ft==="GeometryCollection"){for(It=0;It<lt.geometry.geometries.length;It++)dt(nt,{id:St,geometry:lt.geometry.geometries[It],properties:lt.properties},ht,Vt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(It=0;It<gt.length;It++){var de=[];Qt(gt[It],de,Nt,!0),ut.push(de)}}nt.push(v(St,Ft,ut,lt.properties))}}function ct(nt,lt){lt.push(rt(nt[0])),lt.push(Lt(nt[1])),lt.push(0)}function xt(nt,lt,ht,Vt){for(var gt,Ft,Nt=0,ut=0;ut<nt.length;ut++){var St=rt(nt[ut][0]),It=Lt(nt[ut][1]);lt.push(St),lt.push(It),lt.push(0),ut>0&&(Nt+=Vt?(gt*It-St*Ft)/2:Math.sqrt(Math.pow(St-gt,2)+Math.pow(It-Ft,2))),gt=St,Ft=It}var de=lt.length-3;lt[2]=1,pt(lt,0,de,ht),lt[de+2]=1,lt.size=Math.abs(Nt),lt.start=0,lt.end=lt.size}function Qt(nt,lt,ht,Vt){for(var gt=0;gt<nt.length;gt++){var Ft=[];xt(nt[gt],Ft,ht,Vt),lt.push(Ft)}}function rt(nt){return nt/360+.5}function Lt(nt){var lt=Math.sin(nt*Math.PI/180),ht=.5-.25*Math.log((1+lt)/(1-lt))/Math.PI;return ht<0?0:ht>1?1:ht}function Ht(nt,lt,ht,Vt,gt,Ft,Nt,ut){if(Vt/=lt,Ft>=(ht/=lt)&&Nt<Vt)return nt;if(Nt<ht||Ft>=Vt)return null;for(var St=[],It=0;It<nt.length;It++){var de=nt[It],je=de.geometry,wt=de.type,ve=gt===0?de.minX:de.minY,pi=gt===0?de.maxX:de.maxY;if(ve>=ht&&pi<Vt)St.push(de);else if(!(pi<ht||ve>=Vt)){var Ui=[];if(wt==="Point"||wt==="MultiPoint")Kt(je,Ui,ht,Vt,gt);else if(wt==="LineString")De(je,Ui,ht,Vt,gt,!1,ut.lineMetrics);else if(wt==="MultiLineString")Ti(je,Ui,ht,Vt,gt,!1);else if(wt==="Polygon")Ti(je,Ui,ht,Vt,gt,!0);else if(wt==="MultiPolygon")for(var ki=0;ki<je.length;ki++){var cn=[];Ti(je[ki],cn,ht,Vt,gt,!0),cn.length&&Ui.push(cn)}if(Ui.length){if(ut.lineMetrics&&wt==="LineString"){for(ki=0;ki<Ui.length;ki++)St.push(v(de.id,wt,Ui[ki],de.tags));continue}wt!=="LineString"&&wt!=="MultiLineString"||(Ui.length===1?(wt="LineString",Ui=Ui[0]):wt="MultiLineString"),wt!=="Point"&&wt!=="MultiPoint"||(wt=Ui.length===3?"Point":"MultiPoint"),St.push(v(de.id,wt,Ui,de.tags))}}}return St.length?St:null}function Kt(nt,lt,ht,Vt,gt){for(var Ft=0;Ft<nt.length;Ft+=3){var Nt=nt[Ft+gt];Nt>=ht&&Nt<=Vt&&(lt.push(nt[Ft]),lt.push(nt[Ft+1]),lt.push(nt[Ft+2]))}}function De(nt,lt,ht,Vt,gt,Ft,Nt){for(var ut,St,It=li(nt),de=gt===0?Ii:ii,je=nt.start,wt=0;wt<nt.length-3;wt+=3){var ve=nt[wt],pi=nt[wt+1],Ui=nt[wt+2],ki=nt[wt+3],cn=nt[wt+4],Kn=gt===0?ve:pi,wi=gt===0?ki:cn,gn=!1;Nt&&(ut=Math.sqrt(Math.pow(ve-ki,2)+Math.pow(pi-cn,2))),Kn<ht?wi>ht&&(St=de(It,ve,pi,ki,cn,ht),Nt&&(It.start=je+ut*St)):Kn>Vt?wi<Vt&&(St=de(It,ve,pi,ki,cn,Vt),Nt&&(It.start=je+ut*St)):Wi(It,ve,pi,Ui),wi<ht&&Kn>=ht&&(St=de(It,ve,pi,ki,cn,ht),gn=!0),wi>Vt&&Kn<=Vt&&(St=de(It,ve,pi,ki,cn,Vt),gn=!0),!Ft&&gn&&(Nt&&(It.end=je+ut*St),lt.push(It),It=li(nt)),Nt&&(je+=ut)}var bn=nt.length-3;ve=nt[bn],pi=nt[bn+1],Ui=nt[bn+2],(Kn=gt===0?ve:pi)>=ht&&Kn<=Vt&&Wi(It,ve,pi,Ui),bn=It.length-3,Ft&&bn>=3&&(It[bn]!==It[0]||It[bn+1]!==It[1])&&Wi(It,It[0],It[1],It[2]),It.length&&lt.push(It)}function li(nt){var lt=[];return lt.size=nt.size,lt.start=nt.start,lt.end=nt.end,lt}function Ti(nt,lt,ht,Vt,gt,Ft){for(var Nt=0;Nt<nt.length;Nt++)De(nt[Nt],lt,ht,Vt,gt,Ft,!1)}function Wi(nt,lt,ht,Vt){nt.push(lt),nt.push(ht),nt.push(Vt)}function Ii(nt,lt,ht,Vt,gt,Ft){var Nt=(Ft-lt)/(Vt-lt);return nt.push(Ft),nt.push(ht+(gt-ht)*Nt),nt.push(1),Nt}function ii(nt,lt,ht,Vt,gt,Ft){var Nt=(Ft-ht)/(gt-ht);return nt.push(lt+(Vt-lt)*Nt),nt.push(Ft),nt.push(1),Nt}function rn(nt,lt){for(var ht=[],Vt=0;Vt<nt.length;Vt++){var gt,Ft=nt[Vt],Nt=Ft.type;if(Nt==="Point"||Nt==="MultiPoint"||Nt==="LineString")gt=Zn(Ft.geometry,lt);else if(Nt==="MultiLineString"||Nt==="Polygon"){gt=[];for(var ut=0;ut<Ft.geometry.length;ut++)gt.push(Zn(Ft.geometry[ut],lt))}else if(Nt==="MultiPolygon")for(gt=[],ut=0;ut<Ft.geometry.length;ut++){for(var St=[],It=0;It<Ft.geometry[ut].length;It++)St.push(Zn(Ft.geometry[ut][It],lt));gt.push(St)}ht.push(v(Ft.id,Nt,gt,Ft.tags))}return ht}function Zn(nt,lt){var ht=[];ht.size=nt.size,nt.start!==void 0&&(ht.start=nt.start,ht.end=nt.end);for(var Vt=0;Vt<nt.length;Vt+=3)ht.push(nt[Vt]+lt,nt[Vt+1],nt[Vt+2]);return ht}function Vn(nt,lt){if(nt.transformed)return nt;var ht,Vt,gt,Ft=1<<nt.z,Nt=nt.x,ut=nt.y;for(ht=0;ht<nt.features.length;ht++){var St=nt.features[ht],It=St.geometry,de=St.type;if(St.geometry=[],de===1)for(Vt=0;Vt<It.length;Vt+=2)St.geometry.push(pa(It[Vt],It[Vt+1],lt,Ft,Nt,ut));else for(Vt=0;Vt<It.length;Vt++){var je=[];for(gt=0;gt<It[Vt].length;gt+=2)je.push(pa(It[Vt][gt],It[Vt][gt+1],lt,Ft,Nt,ut));St.geometry.push(je)}}return nt.transformed=!0,nt}function pa(nt,lt,ht,Vt,gt,Ft){return[Math.round(ht*(nt*Vt-gt)),Math.round(ht*(lt*Vt-Ft))]}function Do(nt,lt,ht,Vt,gt){for(var Ft=lt===gt.maxZoom?0:gt.tolerance/((1<<lt)*gt.extent),Nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ht,y:Vt,z:lt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ut=0;ut<nt.length;ut++){Nt.numFeatures++,Yn(Nt,nt[ut],Ft,gt);var St=nt[ut].minX,It=nt[ut].minY,de=nt[ut].maxX,je=nt[ut].maxY;St<Nt.minX&&(Nt.minX=St),It<Nt.minY&&(Nt.minY=It),de>Nt.maxX&&(Nt.maxX=de),je>Nt.maxY&&(Nt.maxY=je)}return Nt}function Yn(nt,lt,ht,Vt){var gt=lt.geometry,Ft=lt.type,Nt=[];if(Ft==="Point"||Ft==="MultiPoint")for(var ut=0;ut<gt.length;ut+=3)Nt.push(gt[ut]),Nt.push(gt[ut+1]),nt.numPoints++,nt.numSimplified++;else if(Ft==="LineString")Ha(Nt,gt,nt,ht,!1,!1);else if(Ft==="MultiLineString"||Ft==="Polygon")for(ut=0;ut<gt.length;ut++)Ha(Nt,gt[ut],nt,ht,Ft==="Polygon",ut===0);else if(Ft==="MultiPolygon")for(var St=0;St<gt.length;St++){var It=gt[St];for(ut=0;ut<It.length;ut++)Ha(Nt,It[ut],nt,ht,!0,ut===0)}if(Nt.length){var de=lt.tags||null;if(Ft==="LineString"&&Vt.lineMetrics){for(var je in de={},lt.tags)de[je]=lt.tags[je];de.mapbox_clip_start=gt.start/gt.size,de.mapbox_clip_end=gt.end/gt.size}var wt={geometry:Nt,type:Ft==="Polygon"||Ft==="MultiPolygon"?3:Ft==="LineString"||Ft==="MultiLineString"?2:1,tags:de};lt.id!==null&&(wt.id=lt.id),nt.features.push(wt)}}function Ha(nt,lt,ht,Vt,gt,Ft){var Nt=Vt*Vt;if(Vt>0&&lt.size<(gt?Nt:Vt))ht.numPoints+=lt.length/3;else{for(var ut=[],St=0;St<lt.length;St+=3)(Vt===0||lt[St+2]>Nt)&&(ht.numSimplified++,ut.push(lt[St]),ut.push(lt[St+1])),ht.numPoints++;gt&&function(It,de){for(var je=0,wt=0,ve=It.length,pi=ve-2;wt<ve;pi=wt,wt+=2)je+=(It[wt]-It[pi])*(It[wt+1]+It[pi+1]);if(je>0===de)for(wt=0,ve=It.length;wt<ve/2;wt+=2){var Ui=It[wt],ki=It[wt+1];It[wt]=It[ve-2-wt],It[wt+1]=It[ve-1-wt],It[ve-2-wt]=Ui,It[ve-1-wt]=ki}}(ut,Ft),nt.push(ut)}}function Rl(nt,lt){var ht=(lt=this.options=function(gt,Ft){for(var Nt in Ft)gt[Nt]=Ft[Nt];return gt}(Object.create(this.options),lt)).debug;if(ht&&console.time("preprocess data"),lt.maxZoom<0||lt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(lt.promoteId&&lt.generateId)throw new Error("promoteId and generateId cannot be used together.");var Vt=function(gt,Ft){var Nt=[];if(gt.type==="FeatureCollection")for(var ut=0;ut<gt.features.length;ut++)dt(Nt,gt.features[ut],Ft,ut);else dt(Nt,gt.type==="Feature"?gt:{geometry:gt},Ft);return Nt}(nt,lt);this.tiles={},this.tileCoords=[],ht&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",lt.indexMaxZoom,lt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Vt=function(gt,Ft){var Nt=Ft.buffer/Ft.extent,ut=gt,St=Ht(gt,1,-1-Nt,Nt,0,-1,2,Ft),It=Ht(gt,1,1-Nt,2+Nt,0,-1,2,Ft);return(St||It)&&(ut=Ht(gt,1,-Nt,1+Nt,0,-1,2,Ft)||[],St&&(ut=rn(St,1).concat(ut)),It&&(ut=ut.concat(rn(It,-1)))),ut}(Vt,lt)).length&&this.splitTile(Vt,0,0,0),ht&&(Vt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function _o(nt,lt,ht){return 32*((1<<nt)*ht+lt)+nt}return Rl.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Rl.prototype.splitTile=function(nt,lt,ht,Vt,gt,Ft,Nt){for(var ut=[nt,lt,ht,Vt],St=this.options,It=St.debug;ut.length;){Vt=ut.pop(),ht=ut.pop(),lt=ut.pop(),nt=ut.pop();var de=1<<lt,je=_o(lt,ht,Vt),wt=this.tiles[je];if(!wt&&(It>1&&console.time("creation"),wt=this.tiles[je]=Do(nt,lt,ht,Vt,St),this.tileCoords.push({z:lt,x:ht,y:Vt}),It)){It>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",lt,ht,Vt,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));var ve="z"+lt;this.stats[ve]=(this.stats[ve]||0)+1,this.total++}if(wt.source=nt,gt){if(lt===St.maxZoom||lt===gt)continue;var pi=1<<gt-lt;if(ht!==Math.floor(Ft/pi)||Vt!==Math.floor(Nt/pi))continue}else if(lt===St.indexMaxZoom||wt.numPoints<=St.indexMaxPoints)continue;if(wt.source=null,nt.length!==0){It>1&&console.time("clipping");var Ui,ki,cn,Kn,wi,gn,bn=.5*St.buffer/St.extent,Ko=.5-bn,Gl=.5+bn,Po=1+bn;Ui=ki=cn=Kn=null,wi=Ht(nt,de,ht-bn,ht+Gl,0,wt.minX,wt.maxX,St),gn=Ht(nt,de,ht+Ko,ht+Po,0,wt.minX,wt.maxX,St),nt=null,wi&&(Ui=Ht(wi,de,Vt-bn,Vt+Gl,1,wt.minY,wt.maxY,St),ki=Ht(wi,de,Vt+Ko,Vt+Po,1,wt.minY,wt.maxY,St),wi=null),gn&&(cn=Ht(gn,de,Vt-bn,Vt+Gl,1,wt.minY,wt.maxY,St),Kn=Ht(gn,de,Vt+Ko,Vt+Po,1,wt.minY,wt.maxY,St),gn=null),It>1&&console.timeEnd("clipping"),ut.push(Ui||[],lt+1,2*ht,2*Vt),ut.push(ki||[],lt+1,2*ht,2*Vt+1),ut.push(cn||[],lt+1,2*ht+1,2*Vt),ut.push(Kn||[],lt+1,2*ht+1,2*Vt+1)}}},Rl.prototype.getTile=function(nt,lt,ht){var Vt=this.options,gt=Vt.extent,Ft=Vt.debug;if(nt<0||nt>24)return null;var Nt=1<<nt,ut=_o(nt,lt=(lt%Nt+Nt)%Nt,ht);if(this.tiles[ut])return Vn(this.tiles[ut],gt);Ft>1&&console.log("drilling down to z%d-%d-%d",nt,lt,ht);for(var St,It=nt,de=lt,je=ht;!St&&It>0;)It--,de=Math.floor(de/2),je=Math.floor(je/2),St=this.tiles[_o(It,de,je)];return St&&St.source?(Ft>1&&console.log("found parent tile z%d-%d-%d",It,de,je),Ft>1&&console.time("drilling down"),this.splitTile(St.source,It,de,je,nt,lt,ht),Ft>1&&console.timeEnd("drilling down"),this.tiles[ut]?Vn(this.tiles[ut],gt):null):null},function(nt,lt){return new Rl(nt,lt)}}();var _n=j.g(Wa.exports);function gl(pt,k){let v=pt.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);let A=this._geoJSONIndex.getTile(v.z,v.x,v.y);if(!A)return k(null,null);let dt=new class{constructor(xt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=j.E,this.length=xt.length,this._features=xt}feature(xt){return new class{constructor(Qt){this._feature=Qt,this.extent=j.E,this.type=Qt.type,this.properties=Qt.tags,"id"in Qt&&!isNaN(Qt.id)&&(this.id=parseInt(Qt.id,10))}loadGeometry(){if(this._feature.type===1){let Qt=[];for(let rt of this._feature.geometry)Qt.push([new j.P(rt[0],rt[1])]);return Qt}{let Qt=[];for(let rt of this._feature.geometry){let Lt=[];for(let Ht of rt)Lt.push(new j.P(Ht[0],Ht[1]));Qt.push(Lt)}return Qt}}toGeoJSON(Qt,rt,Lt){return ue.call(this,Qt,rt,Lt)}}(this._features[xt])}}(A.features),ct=xn(dt);ct.byteOffset===0&&ct.byteLength===ct.buffer.byteLength||(ct=new Uint8Array(ct)),k(null,{vectorTile:dt,rawData:ct.buffer})}class Oo extends j.d{constructor(k,v,A,dt,ct,xt){super(k,v,A,dt,gl,xt),ct&&(this.loadGeoJSON=ct)}loadData(k,v){let A=k&&k.request,dt=A&&A.collectResourceTiming;this.loadGeoJSON(k,(ct,xt)=>{if(ct||!xt)return v(ct);if(typeof xt!="object")return v(new Error("Input data given to '".concat(k.source,"' is not a valid GeoJSON object.")));{Ue(xt,!0);try{if(k.filter){let rt=j.e(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(Ht=>"".concat(Ht.key,": ").concat(Ht.message)).join(", "));xt={type:"FeatureCollection",features:xt.features.filter(Ht=>rt.value.evaluate({zoom:0},Ht))}}this._geoJSONIndex=k.cluster?new Nn(function({superclusterOptions:rt,clusterProperties:Lt}){if(!Lt||!rt)return rt;let Ht={},Kt={},De={accumulated:null,zoom:0},li={properties:null},Ti=Object.keys(Lt);for(let Wi of Ti){let[Ii,ii]=Lt[Wi],rn=j.e(ii),Zn=j.e(typeof Ii=="string"?[Ii,["accumulated"],["get",Wi]]:Ii);Ht[Wi]=rn.value,Kt[Wi]=Zn.value}return rt.map=Wi=>{li.properties=Wi;let Ii={};for(let ii of Ti)Ii[ii]=Ht[ii].evaluate(De,li);return Ii},rt.reduce=(Wi,Ii)=>{li.properties=Ii;for(let ii of Ti)De.accumulated=Wi[ii],Wi[ii]=Kt[ii].evaluate(De,li)},rt}(k)).load(xt.features):_n(xt,k.geojsonVtOptions)}catch(rt){return v(rt)}this.loaded={};let Qt={};if(dt){let rt=j.f(A);rt&&(Qt.resourceTiming={},Qt.resourceTiming[k.source]=JSON.parse(JSON.stringify(rt)))}v(null,Qt)}})}reloadTile(k,v){let A=this.loaded;return A&&A[k.uid]?super.reloadTile(k,v):this.loadTile(k,v)}loadGeoJSON(k,v){if(k.request)j.h(k.request,v);else{if(typeof k.data!="string")return v(new Error("Input data given to '".concat(k.source,"' is not a valid GeoJSON object.")));try{return v(null,JSON.parse(k.data))}catch{return v(new Error("Input data given to '".concat(k.source,"' is not a valid GeoJSON object.")))}}}getClusterExpansionZoom(k,v){try{v(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(A){v(A)}}getClusterChildren(k,v){try{v(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(A){v(A)}}getClusterLeaves(k,v){try{v(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(A){v(A)}}}class Ni{constructor(k,v){this.tileID=new j.O(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.tileZoom=k.tileZoom,this.uid=k.uid,this.zoom=k.zoom,this.canonical=k.tileID.canonical,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=k.projection,this.brightness=v}parse(k,v,A,dt){this.status="parsing";let ct=new j.O(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),xt={},Qt=v.familiesBySource[A.source],rt=new j.F(ct,A.promoteId);return rt.bucketLayerIDs=[],j.l(k).then(Lt=>{if(!Lt)return dt(new Error("Could not parse tile"));let Ht=j.j(Lt,1/j.t(A.tileID.canonical)),Kt=Lt.json.extensionsUsed&&Lt.json.extensionsUsed.includes("MAPBOX_mesh_features"),De=new j.k(this.zoom,{brightness:this.brightness});for(let li in Qt)for(let Ti of Qt[li]){let Wi=Ti[0],Ii=Lt.json.extensionsUsed;Wi.recalculate(De,[]);let ii=new j.T(Ht,ct,Ii&&Ii.includes("MAPBOX_mesh_features"),this.brightness);Kt||(ii.needsUpload=!0),xt[Wi.fqid]=ii,ii.evaluate(Wi)}this.status="done",dt(null,{buckets:xt,featureIndex:rt})}).catch(Lt=>dt(new Error(Lt.message)))}}class ul{constructor(k,v,A,dt,ct,xt){this.actor=k,this.layerIndex=v,this.brightness=xt,this.loading={},this.loaded={}}loadTile(k,v){let A=k.uid,dt=this.loading[A]=new Ni(k,this.brightness);j.i(k.request,(ct,xt)=>{let Qt=!this.loading[A];return delete this.loading[A],Qt||ct?(dt.status="done",Qt||(this.loaded[A]=dt),v(ct)):xt&&xt.byteLength!==0?void dt.parse(xt,this.layerIndex,k,(rt,Lt)=>{dt.status="done",this.loaded=this.loaded||{},this.loaded[A]=dt,rt||!Lt?v(rt):v(null,Lt)}):(dt.status="done",this.loaded[A]=dt,v())})}reloadTile(k,v){let A=this.loaded,dt=k.uid;if(A&&A[dt]){let ct=A[dt];ct.projection=k.projection,ct.brightness=k.brightness;let xt=(Qt,rt)=>{ct.reloadCallback&&(delete ct.reloadCallback,this.loadTile(k,v)),v(Qt,rt)};ct.status==="parsing"?ct.reloadCallback=xt:ct.status==="done"&&this.loadTile(k,v)}}abortTile(k,v){let A=k.uid;this.loading[A]&&delete this.loading[A],v()}removeTile(k,v){let A=this.loaded,dt=k.uid;A&&A[dt]&&delete A[dt],v()}}class ja{constructor(k){this.self=k,this.actor=new j.A(k,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=j.m({name:"mercator"}),this.workerSourceTypes={vector:j.d,geojson:Oo,"batched-model":ul},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(v,A)=>{if(this.workerSourceTypes[v])throw new Error('Worker source with name "'.concat(v,'" already registered.'));this.workerSourceTypes[v]=A},this.self.registerRTLTextPlugin=v=>{if(j.n.isParsed())throw new Error("RTL text plugin already registered.");j.n.applyArabicShaping=v.applyArabicShaping,j.n.processBidirectionalText=v.processBidirectionalText,j.n.processStyledBidirectionalText=v.processStyledBidirectionalText}}clearCaches(k,v,A){delete this.layerIndexes[k],delete this.availableImages[k],delete this.workerSources[k],delete this.demWorkerSources[k],A()}checkIfReady(k,v,A){A()}setReferrer(k,v){this.referrer=v}spriteLoaded(k,{scope:v,isLoaded:A}){if(this.isSpriteLoaded[k]||(this.isSpriteLoaded[k]={}),this.isSpriteLoaded[k][v]=A,this.workerSources[k]&&this.workerSources[k][v])for(let dt in this.workerSources[k][v]){let ct=this.workerSources[k][v][dt];for(let xt in ct)ct[xt]instanceof j.d&&(ct[xt].isSpriteLoaded=A,ct[xt].fire(new j.o("isSpriteLoaded")))}}setImages(k,{scope:v,images:A},dt){if(this.availableImages[k]||(this.availableImages[k]={}),this.availableImages[k][v]=A,this.workerSources[k]&&this.workerSources[k][v]){for(let ct in this.workerSources[k][v]){let xt=this.workerSources[k][v][ct];for(let Qt in xt)xt[Qt].availableImages=A}dt()}else dt()}setProjection(k,v){this.projections[k]=j.m(v)}setBrightness(k,v,A){this.brightness=v,A()}setLayers(k,v,A){this.getLayerIndex(k,v.scope).replace(v.layers,v.options),A()}updateLayers(k,v,A){this.getLayerIndex(k,v.scope).update(v.layers,v.removedIds,v.options),A()}loadTile(k,v,A){v.projection=this.projections[k]||this.defaultProjection,this.getWorkerSource(k,v.type,v.source,v.scope).loadTile(v,A)}loadDEMTile(k,v,A){this.getDEMWorkerSource(k,v.source,v.scope).loadTile(v,A)}reloadTile(k,v,A){v.projection=this.projections[k]||this.defaultProjection,this.getWorkerSource(k,v.type,v.source,v.scope).reloadTile(v,A)}abortTile(k,v,A){this.getWorkerSource(k,v.type,v.source,v.scope).abortTile(v,A)}removeTile(k,v,A){this.getWorkerSource(k,v.type,v.source,v.scope).removeTile(v,A)}removeSource(k,v,A){if(!(this.workerSources[k]&&this.workerSources[k][v.scope]&&this.workerSources[k][v.scope][v.type]&&this.workerSources[k][v.scope][v.type][v.source]))return;let dt=this.workerSources[k][v.scope][v.type][v.source];delete this.workerSources[k][v.scope][v.type][v.source],dt.removeSource!==void 0?dt.removeSource(v,A):A()}loadWorkerSource(k,v,A){try{this.self.importScripts(v.url),A()}catch(dt){A(dt.toString())}}syncRTLPluginState(k,v,A){try{j.n.setState(v);let dt=j.n.getPluginURL();if(j.n.isLoaded()&&!j.n.isParsed()&&dt!=null){this.self.importScripts(dt);let ct=j.n.isParsed();A(ct?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(dt)),ct)}}catch(dt){A(dt.toString())}}setDracoUrl(k,v){this.dracoUrl=v}getAvailableImages(k,v){this.availableImages[k]||(this.availableImages[k]={});let A=this.availableImages[k][v];return A||(A=[]),A}getLayerIndex(k,v){this.layerIndexes[k]||(this.layerIndexes[k]={});let A=this.layerIndexes[k][v];return A||(A=this.layerIndexes[k][v]=new Ut,A.scope=v),A}getWorkerSource(k,v,A,dt){if(this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][dt]||(this.workerSources[k][dt]={}),this.workerSources[k][dt][v]||(this.workerSources[k][dt][v]={}),this.isSpriteLoaded[k]||(this.isSpriteLoaded[k]={}),!this.workerSources[k][dt][v][A]){let ct={send:(xt,Qt,rt,Lt,Ht,Kt)=>{this.actor.send(xt,Qt,rt,k,Ht,Kt)},scheduler:this.actor.scheduler};this.workerSources[k][dt][v][A]=new this.workerSourceTypes[v](ct,this.getLayerIndex(k,dt),this.getAvailableImages(k,dt),this.isSpriteLoaded[k][dt],void 0,this.brightness)}return this.workerSources[k][dt][v][A]}getDEMWorkerSource(k,v,A){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][A]||(this.demWorkerSources[k][A]={}),this.demWorkerSources[k][A][v]||(this.demWorkerSources[k][A][v]=new Zt),this.demWorkerSources[k][A][v]}enforceCacheSizeLimit(k,v){j.q(v)}getWorkerPerformanceMetrics(k,v,A){A(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ja(self)),ja}),M(["./shared"],function(j){"use strict";return j.s});var w=U;return w})});var tm={};jB(tm,{afterMain:()=>$F,afterRead:()=>KF,afterWrite:()=>iI,applyStyles:()=>Ad,arrow:()=>Hb,auto:()=>hr,basePlacements:()=>ml,beforeMain:()=>PF,beforeRead:()=>DF,beforeWrite:()=>tI,bottom:()=>$i,clippingParents:()=>dp,computeStyles:()=>jd,createPopper:()=>Fr,createPopperBase:()=>bI,createPopperLite:()=>mI,detectOverflow:()=>In,end:()=>Kl,eventListeners:()=>Hd,flip:()=>Kb,hide:()=>Pb,left:()=>Ei,main:()=>qF,modifierPhases:()=>rp,offset:()=>qb,placements:()=>pr,popper:()=>Co,popperGenerator:()=>Lo,popperOffsets:()=>_d,preventOverflow:()=>$b,read:()=>_F,reference:()=>sp,right:()=>Ki,start:()=>Aa,top:()=>fi,variationPlacements:()=>jb,viewport:()=>Wr,write:()=>eI});var fi="top",$i="bottom",Ki="right",Ei="left",hr="auto",ml=[fi,$i,Ki,Ei],Aa="start",Kl="end",dp="clippingParents",Wr="viewport",Co="popper",sp="reference",jb=ml.reduce(function(x,V){return x.concat([V+"-"+Aa,V+"-"+Kl])},[]),pr=[].concat(ml,[hr]).reduce(function(x,V){return x.concat([V,V+"-"+Aa,V+"-"+Kl])},[]),DF="beforeRead",_F="read",KF="afterRead",PF="beforeMain",qF="main",$F="afterMain",tI="beforeWrite",eI="write",iI="afterWrite",rp=[DF,_F,KF,PF,qF,$F,tI,eI,iI];function on(x){return x?(x.nodeName||"").toLowerCase():null}function Mi(x){if(x==null)return window;if(x.toString()!=="[object Window]"){var V=x.ownerDocument;return V&&V.defaultView||window}return x}function da(x){var V=Mi(x).Element;return x instanceof V||x instanceof Element}function ln(x){var V=Mi(x).HTMLElement;return x instanceof V||x instanceof HTMLElement}function Ed(x){if(typeof ShadowRoot>"u")return!1;var V=Mi(x).ShadowRoot;return x instanceof V||x instanceof ShadowRoot}function DB(x){var V=x.state;Object.keys(V.elements).forEach(function(U){var M=V.styles[U]||{},w=V.attributes[U]||{},j=V.elements[U];!ln(j)||!on(j)||(Object.assign(j.style,M),Object.keys(w).forEach(function(T){var bt=w[T];bt===!1?j.removeAttribute(T):j.setAttribute(T,bt===!0?"":bt)}))})}function _B(x){var V=x.state,U={popper:{position:V.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(V.elements.popper.style,U.popper),V.styles=U,V.elements.arrow&&Object.assign(V.elements.arrow.style,U.arrow),function(){Object.keys(V.elements).forEach(function(M){var w=V.elements[M],j=V.attributes[M]||{},T=Object.keys(V.styles.hasOwnProperty(M)?V.styles[M]:U[M]),bt=T.reduce(function(Ut,Zt){return Ut[Zt]="",Ut},{});!ln(w)||!on(w)||(Object.assign(w.style,bt),Object.keys(j).forEach(function(Ut){w.removeAttribute(Ut)}))})}}var Ad={name:"applyStyles",enabled:!0,phase:"write",fn:DB,effect:_B,requires:["computeStyles"]};function dn(x){return x.split("-")[0]}var Na=Math.max,To=Math.min,hl=Math.round;function wd(){var x=navigator.userAgentData;return x!=null&&x.brands&&Array.isArray(x.brands)?x.brands.map(function(V){return V.brand+"/"+V.version}).join(" "):navigator.userAgent}function Zr(){return!/^((?!chrome|android).)*safari/i.test(wd())}function sa(x,V,U){V===void 0&&(V=!1),U===void 0&&(U=!1);var M=x.getBoundingClientRect(),w=1,j=1;V&&ln(x)&&(w=x.offsetWidth>0&&hl(M.width)/x.offsetWidth||1,j=x.offsetHeight>0&&hl(M.height)/x.offsetHeight||1);var T=da(x)?Mi(x):window,bt=T.visualViewport,Ut=!Zr()&&U,Zt=(M.left+(Ut&&bt?bt.offsetLeft:0))/w,Ct=(M.top+(Ut&&bt?bt.offsetTop:0))/j,Ge=M.width/w,Ue=M.height/j;return{width:Ge,height:Ue,top:Ct,right:Zt+Ge,bottom:Ct+Ue,left:Zt,x:Zt,y:Ct}}function ko(x){var V=sa(x),U=x.offsetWidth,M=x.offsetHeight;return Math.abs(V.width-U)<=1&&(U=V.width),Math.abs(V.height-M)<=1&&(M=V.height),{x:x.offsetLeft,y:x.offsetTop,width:U,height:M}}function Vr(x,V){var U=V.getRootNode&&V.getRootNode();if(x.contains(V))return!0;if(U&&Ed(U)){var M=V;do{if(M&&x.isSameNode(M))return!0;M=M.parentNode||M.host}while(M)}return!1}function Fn(x){return Mi(x).getComputedStyle(x)}function cp(x){return["table","td","th"].indexOf(on(x))>=0}function hn(x){return((da(x)?x.ownerDocument:x.document)||window.document).documentElement}function Wl(x){return on(x)==="html"?x:x.assignedSlot||x.parentNode||(Ed(x)?x.host:null)||hn(x)}function nI(x){return!ln(x)||Fn(x).position==="fixed"?null:x.offsetParent}function KB(x){var V=/firefox/i.test(wd()),U=/Trident/i.test(wd());if(U&&ln(x)){var M=Fn(x);if(M.position==="fixed")return null}var w=Wl(x);for(Ed(w)&&(w=w.host);ln(w)&&["html","body"].indexOf(on(w))<0;){var j=Fn(w);if(j.transform!=="none"||j.perspective!=="none"||j.contain==="paint"||["transform","perspective"].indexOf(j.willChange)!==-1||V&&j.willChange==="filter"||V&&j.filter&&j.filter!=="none")return w;w=w.parentNode}return null}function Ya(x){for(var V=Mi(x),U=nI(x);U&&cp(U)&&Fn(U).position==="static";)U=nI(U);return U&&(on(U)==="html"||on(U)==="body"&&Fn(U).position==="static")?V:U||KB(x)||V}function So(x){return["top","bottom"].indexOf(x)>=0?"x":"y"}function Qo(x,V,U){return Na(x,To(V,U))}function aI(x,V,U){var M=Qo(x,V,U);return M>U?U:M}function gr(){return{top:0,right:0,bottom:0,left:0}}function ur(x){return Object.assign({},gr(),x)}function Rr(x,V){return V.reduce(function(U,M){return U[M]=x,U},{})}var PB=function(V,U){return V=typeof V=="function"?V(Object.assign({},U.rects,{placement:U.placement})):V,ur(typeof V!="number"?V:Rr(V,ml))};function qB(x){var V,U=x.state,M=x.name,w=x.options,j=U.elements.arrow,T=U.modifiersData.popperOffsets,bt=dn(U.placement),Ut=So(bt),Zt=[Ei,Ki].indexOf(bt)>=0,Ct=Zt?"height":"width";if(!(!j||!T)){var Ge=PB(w.padding,U),Ue=ko(j),ue=Ut==="y"?fi:Ei,Ke=Ut==="y"?$i:Ki,ye=U.rects.reference[Ct]+U.rects.reference[Ut]-T[Ut]-U.rects.popper[Ct],Ae=T[Ut]-U.rects.reference[Ut],we=Ya(j),Fi=we?Ut==="y"?we.clientHeight||0:we.clientWidth||0:0,mi=ye/2-Ae/2,Te=Ge[ue],Pe=Fi-Ue[Ct]-Ge[Ke],Qe=Fi/2-Ue[Ct]/2+mi,H=Qo(Te,Qe,Pe),te=Ut;U.modifiersData[M]=(V={},V[te]=H,V.centerOffset=H-Qe,V)}}function $B(x){var V=x.state,U=x.options,M=U.element,w=M===void 0?"[data-popper-arrow]":M;w!=null&&(typeof w=="string"&&(w=V.elements.popper.querySelector(w),!w)||Vr(V.elements.popper,w)&&(V.elements.arrow=w))}var Hb={name:"arrow",enabled:!0,phase:"main",fn:qB,effect:$B,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ra(x){return x.split("-")[1]}var tM={top:"auto",right:"auto",bottom:"auto",left:"auto"};function eM(x,V){var U=x.x,M=x.y,w=V.devicePixelRatio||1;return{x:hl(U*w)/w||0,y:hl(M*w)/w||0}}function lI(x){var V,U=x.popper,M=x.popperRect,w=x.placement,j=x.variation,T=x.offsets,bt=x.position,Ut=x.gpuAcceleration,Zt=x.adaptive,Ct=x.roundOffsets,Ge=x.isFixed,Ue=T.x,ue=Ue===void 0?0:Ue,Ke=T.y,ye=Ke===void 0?0:Ke,Ae=typeof Ct=="function"?Ct({x:ue,y:ye}):{x:ue,y:ye};ue=Ae.x,ye=Ae.y;var we=T.hasOwnProperty("x"),Fi=T.hasOwnProperty("y"),mi=Ei,Te=fi,Pe=window;if(Zt){var Qe=Ya(U),H="clientHeight",te="clientWidth";if(Qe===Mi(U)&&(Qe=hn(U),Fn(Qe).position!=="static"&&bt==="absolute"&&(H="scrollHeight",te="scrollWidth")),Qe=Qe,w===fi||(w===Ei||w===Ki)&&j===Kl){Te=$i;var zi=Ge&&Qe===Pe&&Pe.visualViewport?Pe.visualViewport.height:Qe[H];ye-=zi-M.height,ye*=Ut?1:-1}if(w===Ei||(w===fi||w===$i)&&j===Kl){mi=Ki;var Vi=Ge&&Qe===Pe&&Pe.visualViewport?Pe.visualViewport.width:Qe[te];ue-=Vi-M.width,ue*=Ut?1:-1}}var At=Object.assign({position:bt},Zt&&tM),ei=Ct===!0?eM({x:ue,y:ye},Mi(U)):{x:ue,y:ye};if(ue=ei.x,ye=ei.y,Ut){var tn;return Object.assign({},At,(tn={},tn[Te]=Fi?"0":"",tn[mi]=we?"0":"",tn.transform=(Pe.devicePixelRatio||1)<=1?"translate("+ue+"px, "+ye+"px)":"translate3d("+ue+"px, "+ye+"px, 0)",tn))}return Object.assign({},At,(V={},V[Te]=Fi?ye+"px":"",V[mi]=we?ue+"px":"",V.transform="",V))}function iM(x){var V=x.state,U=x.options,M=U.gpuAcceleration,w=M===void 0?!0:M,j=U.adaptive,T=j===void 0?!0:j,bt=U.roundOffsets,Ut=bt===void 0?!0:bt,Zt={placement:dn(V.placement),variation:ra(V.placement),popper:V.elements.popper,popperRect:V.rects.popper,gpuAcceleration:w,isFixed:V.options.strategy==="fixed"};V.modifiersData.popperOffsets!=null&&(V.styles.popper=Object.assign({},V.styles.popper,lI(Object.assign({},Zt,{offsets:V.modifiersData.popperOffsets,position:V.options.strategy,adaptive:T,roundOffsets:Ut})))),V.modifiersData.arrow!=null&&(V.styles.arrow=Object.assign({},V.styles.arrow,lI(Object.assign({},Zt,{offsets:V.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Ut})))),V.attributes.popper=Object.assign({},V.attributes.popper,{"data-popper-placement":V.placement})}var jd={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:iM,data:{}};var Ob={passive:!0};function nM(x){var V=x.state,U=x.instance,M=x.options,w=M.scroll,j=w===void 0?!0:w,T=M.resize,bt=T===void 0?!0:T,Ut=Mi(V.elements.popper),Zt=[].concat(V.scrollParents.reference,V.scrollParents.popper);return j&&Zt.forEach(function(Ct){Ct.addEventListener("scroll",U.update,Ob)}),bt&&Ut.addEventListener("resize",U.update,Ob),function(){j&&Zt.forEach(function(Ct){Ct.removeEventListener("scroll",U.update,Ob)}),bt&&Ut.removeEventListener("resize",U.update,Ob)}}var Hd={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:nM,data:{}};var aM={left:"right",right:"left",bottom:"top",top:"bottom"};function Od(x){return x.replace(/left|right|bottom|top/g,function(V){return aM[V]})}var lM={start:"end",end:"start"};function Db(x){return x.replace(/start|end/g,function(V){return lM[V]})}function vo(x){var V=Mi(x),U=V.pageXOffset,M=V.pageYOffset;return{scrollLeft:U,scrollTop:M}}function fo(x){return sa(hn(x)).left+vo(x).scrollLeft}function bp(x,V){var U=Mi(x),M=hn(x),w=U.visualViewport,j=M.clientWidth,T=M.clientHeight,bt=0,Ut=0;if(w){j=w.width,T=w.height;var Zt=Zr();(Zt||!Zt&&V==="fixed")&&(bt=w.offsetLeft,Ut=w.offsetTop)}return{width:j,height:T,x:bt+fo(x),y:Ut}}function mp(x){var V,U=hn(x),M=vo(x),w=(V=x.ownerDocument)==null?void 0:V.body,j=Na(U.scrollWidth,U.clientWidth,w?w.scrollWidth:0,w?w.clientWidth:0),T=Na(U.scrollHeight,U.clientHeight,w?w.scrollHeight:0,w?w.clientHeight:0),bt=-M.scrollLeft+fo(x),Ut=-M.scrollTop;return Fn(w||U).direction==="rtl"&&(bt+=Na(U.clientWidth,w?w.clientWidth:0)-j),{width:j,height:T,x:bt,y:Ut}}function zo(x){var V=Fn(x),U=V.overflow,M=V.overflowX,w=V.overflowY;return/auto|scroll|overlay|hidden/.test(U+w+M)}function _b(x){return["html","body","#document"].indexOf(on(x))>=0?x.ownerDocument.body:ln(x)&&zo(x)?x:_b(Wl(x))}function Pl(x,V){var U;V===void 0&&(V=[]);var M=_b(x),w=M===((U=x.ownerDocument)==null?void 0:U.body),j=Mi(M),T=w?[j].concat(j.visualViewport||[],zo(M)?M:[]):M,bt=V.concat(T);return w?bt:bt.concat(Pl(Wl(T)))}function Dd(x){return Object.assign({},x,{left:x.x,top:x.y,right:x.x+x.width,bottom:x.y+x.height})}function oM(x,V){var U=sa(x,!1,V==="fixed");return U.top=U.top+x.clientTop,U.left=U.left+x.clientLeft,U.bottom=U.top+x.clientHeight,U.right=U.left+x.clientWidth,U.width=x.clientWidth,U.height=x.clientHeight,U.x=U.left,U.y=U.top,U}function oI(x,V,U){return V===Wr?Dd(bp(x,U)):da(V)?oM(V,U):Dd(mp(hn(x)))}function dM(x){var V=Pl(Wl(x)),U=["absolute","fixed"].indexOf(Fn(x).position)>=0,M=U&&ln(x)?Ya(x):x;return da(M)?V.filter(function(w){return da(w)&&Vr(w,M)&&on(w)!=="body"}):[]}function hp(x,V,U,M){var w=V==="clippingParents"?dM(x):[].concat(V),j=[].concat(w,[U]),T=j[0],bt=j.reduce(function(Ut,Zt){var Ct=oI(x,Zt,M);return Ut.top=Na(Ct.top,Ut.top),Ut.right=To(Ct.right,Ut.right),Ut.bottom=To(Ct.bottom,Ut.bottom),Ut.left=Na(Ct.left,Ut.left),Ut},oI(x,T,M));return bt.width=bt.right-bt.left,bt.height=bt.bottom-bt.top,bt.x=bt.left,bt.y=bt.top,bt}function Gr(x){var V=x.reference,U=x.element,M=x.placement,w=M?dn(M):null,j=M?ra(M):null,T=V.x+V.width/2-U.width/2,bt=V.y+V.height/2-U.height/2,Ut;switch(w){case fi:Ut={x:T,y:V.y-U.height};break;case $i:Ut={x:T,y:V.y+V.height};break;case Ki:Ut={x:V.x+V.width,y:bt};break;case Ei:Ut={x:V.x-U.width,y:bt};break;default:Ut={x:V.x,y:V.y}}var Zt=w?So(w):null;if(Zt!=null){var Ct=Zt==="y"?"height":"width";switch(j){case Aa:Ut[Zt]=Ut[Zt]-(V[Ct]/2-U[Ct]/2);break;case Kl:Ut[Zt]=Ut[Zt]+(V[Ct]/2-U[Ct]/2);break;default:}}return Ut}function In(x,V){V===void 0&&(V={});var U=V,M=U.placement,w=M===void 0?x.placement:M,j=U.strategy,T=j===void 0?x.strategy:j,bt=U.boundary,Ut=bt===void 0?dp:bt,Zt=U.rootBoundary,Ct=Zt===void 0?Wr:Zt,Ge=U.elementContext,Ue=Ge===void 0?Co:Ge,ue=U.altBoundary,Ke=ue===void 0?!1:ue,ye=U.padding,Ae=ye===void 0?0:ye,we=ur(typeof Ae!="number"?Ae:Rr(Ae,ml)),Fi=Ue===Co?sp:Co,mi=x.rects.popper,Te=x.elements[Ke?Fi:Ue],Pe=hp(da(Te)?Te:Te.contextElement||hn(x.elements.popper),Ut,Ct,T),Qe=sa(x.elements.reference),H=Gr({reference:Qe,element:mi,strategy:"absolute",placement:w}),te=Dd(Object.assign({},mi,H)),zi=Ue===Co?te:Qe,Vi={top:Pe.top-zi.top+we.top,bottom:zi.bottom-Pe.bottom+we.bottom,left:Pe.left-zi.left+we.left,right:zi.right-Pe.right+we.right},At=x.modifiersData.offset;if(Ue===Co&&At){var ei=At[w];Object.keys(Vi).forEach(function(tn){var xn=[Ki,$i].indexOf(tn)>=0?1:-1,ha=[fi,$i].indexOf(tn)>=0?"y":"x";Vi[tn]+=ei[ha]*xn})}return Vi}function Wp(x,V){V===void 0&&(V={});var U=V,M=U.placement,w=U.boundary,j=U.rootBoundary,T=U.padding,bt=U.flipVariations,Ut=U.allowedAutoPlacements,Zt=Ut===void 0?pr:Ut,Ct=ra(M),Ge=Ct?bt?jb:jb.filter(function(Ke){return ra(Ke)===Ct}):ml,Ue=Ge.filter(function(Ke){return Zt.indexOf(Ke)>=0});Ue.length===0&&(Ue=Ge);var ue=Ue.reduce(function(Ke,ye){return Ke[ye]=In(x,{placement:ye,boundary:w,rootBoundary:j,padding:T})[dn(ye)],Ke},{});return Object.keys(ue).sort(function(Ke,ye){return ue[Ke]-ue[ye]})}function sM(x){if(dn(x)===hr)return[];var V=Od(x);return[Db(x),V,Db(V)]}function rM(x){var V=x.state,U=x.options,M=x.name;if(!V.modifiersData[M]._skip){for(var w=U.mainAxis,j=w===void 0?!0:w,T=U.altAxis,bt=T===void 0?!0:T,Ut=U.fallbackPlacements,Zt=U.padding,Ct=U.boundary,Ge=U.rootBoundary,Ue=U.altBoundary,ue=U.flipVariations,Ke=ue===void 0?!0:ue,ye=U.allowedAutoPlacements,Ae=V.options.placement,we=dn(Ae),Fi=we===Ae,mi=Ut||(Fi||!Ke?[Od(Ae)]:sM(Ae)),Te=[Ae].concat(mi).reduce(function(Xt,Ci){return Xt.concat(dn(Ci)===hr?Wp(V,{placement:Ci,boundary:Ct,rootBoundary:Ge,padding:Zt,flipVariations:Ke,allowedAutoPlacements:ye}):Ci)},[]),Pe=V.rects.reference,Qe=V.rects.popper,H=new Map,te=!0,zi=Te[0],Vi=0;Vi<Te.length;Vi++){var At=Te[Vi],ei=dn(At),tn=ra(At)===Aa,xn=[fi,$i].indexOf(ei)>=0,ha=xn?"width":"height",Ai=In(V,{placement:At,boundary:Ct,rootBoundary:Ge,altBoundary:Ue,padding:Zt}),en=xn?tn?Ki:Ei:tn?$i:fi;Pe[ha]>Qe[ha]&&(en=Od(en));var sn=Od(en),Mt=[];if(j&&Mt.push(Ai[ei]<=0),bt&&Mt.push(Ai[en]<=0,Ai[sn]<=0),Mt.every(function(Xt){return Xt})){zi=At,te=!1;break}H.set(At,Mt)}if(te)for(var pn=Ke?3:1,Nn=function(Ci){var wa=Te.find(function(Wa){var _n=H.get(Wa);if(_n)return _n.slice(0,Ci).every(function(gl){return gl})});if(wa)return zi=wa,"break"},Ln=pn;Ln>0;Ln--){var Dn=Nn(Ln);if(Dn==="break")break}V.placement!==zi&&(V.modifiersData[M]._skip=!0,V.placement=zi,V.reset=!0)}}var Kb={name:"flip",enabled:!0,phase:"main",fn:rM,requiresIfExists:["offset"],data:{_skip:!1}};function dI(x,V,U){return U===void 0&&(U={x:0,y:0}),{top:x.top-V.height-U.y,right:x.right-V.width+U.x,bottom:x.bottom-V.height+U.y,left:x.left-V.width-U.x}}function sI(x){return[fi,Ki,$i,Ei].some(function(V){return x[V]>=0})}function cM(x){var V=x.state,U=x.name,M=V.rects.reference,w=V.rects.popper,j=V.modifiersData.preventOverflow,T=In(V,{elementContext:"reference"}),bt=In(V,{altBoundary:!0}),Ut=dI(T,M),Zt=dI(bt,w,j),Ct=sI(Ut),Ge=sI(Zt);V.modifiersData[U]={referenceClippingOffsets:Ut,popperEscapeOffsets:Zt,isReferenceHidden:Ct,hasPopperEscaped:Ge},V.attributes.popper=Object.assign({},V.attributes.popper,{"data-popper-reference-hidden":Ct,"data-popper-escaped":Ge})}var Pb={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:cM};function bM(x,V,U){var M=dn(x),w=[Ei,fi].indexOf(M)>=0?-1:1,j=typeof U=="function"?U(Object.assign({},V,{placement:x})):U,T=j[0],bt=j[1];return T=T||0,bt=(bt||0)*w,[Ei,Ki].indexOf(M)>=0?{x:bt,y:T}:{x:T,y:bt}}function mM(x){var V=x.state,U=x.options,M=x.name,w=U.offset,j=w===void 0?[0,0]:w,T=pr.reduce(function(Ct,Ge){return Ct[Ge]=bM(Ge,V.rects,j),Ct},{}),bt=T[V.placement],Ut=bt.x,Zt=bt.y;V.modifiersData.popperOffsets!=null&&(V.modifiersData.popperOffsets.x+=Ut,V.modifiersData.popperOffsets.y+=Zt),V.modifiersData[M]=T}var qb={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:mM};function hM(x){var V=x.state,U=x.name;V.modifiersData[U]=Gr({reference:V.rects.reference,element:V.rects.popper,strategy:"absolute",placement:V.placement})}var _d={name:"popperOffsets",enabled:!0,phase:"read",fn:hM,data:{}};function pp(x){return x==="x"?"y":"x"}function WM(x){var V=x.state,U=x.options,M=x.name,w=U.mainAxis,j=w===void 0?!0:w,T=U.altAxis,bt=T===void 0?!1:T,Ut=U.boundary,Zt=U.rootBoundary,Ct=U.altBoundary,Ge=U.padding,Ue=U.tether,ue=Ue===void 0?!0:Ue,Ke=U.tetherOffset,ye=Ke===void 0?0:Ke,Ae=In(V,{boundary:Ut,rootBoundary:Zt,padding:Ge,altBoundary:Ct}),we=dn(V.placement),Fi=ra(V.placement),mi=!Fi,Te=So(we),Pe=pp(Te),Qe=V.modifiersData.popperOffsets,H=V.rects.reference,te=V.rects.popper,zi=typeof ye=="function"?ye(Object.assign({},V.rects,{placement:V.placement})):ye,Vi=typeof zi=="number"?{mainAxis:zi,altAxis:zi}:Object.assign({mainAxis:0,altAxis:0},zi),At=V.modifiersData.offset?V.modifiersData.offset[V.placement]:null,ei={x:0,y:0};if(Qe){if(j){var tn,xn=Te==="y"?fi:Ei,ha=Te==="y"?$i:Ki,Ai=Te==="y"?"height":"width",en=Qe[Te],sn=en+Ae[xn],Mt=en-Ae[ha],pn=ue?-te[Ai]/2:0,Nn=Fi===Aa?H[Ai]:te[Ai],Ln=Fi===Aa?-te[Ai]:-H[Ai],Dn=V.elements.arrow,Xt=ue&&Dn?ko(Dn):{width:0,height:0},Ci=V.modifiersData["arrow#persistent"]?V.modifiersData["arrow#persistent"].padding:gr(),wa=Ci[xn],Wa=Ci[ha],_n=Qo(0,H[Ai],Xt[Ai]),gl=mi?H[Ai]/2-pn-_n-wa-Vi.mainAxis:Nn-_n-wa-Vi.mainAxis,Oo=mi?-H[Ai]/2+pn+_n+Wa+Vi.mainAxis:Ln+_n+Wa+Vi.mainAxis,Ni=V.elements.arrow&&Ya(V.elements.arrow),ul=Ni?Te==="y"?Ni.clientTop||0:Ni.clientLeft||0:0,ja=(tn=At==null?void 0:At[Te])!=null?tn:0,pt=en+gl-ja-ul,k=en+Oo-ja,v=Qo(ue?To(sn,pt):sn,en,ue?Na(Mt,k):Mt);Qe[Te]=v,ei[Te]=v-en}if(bt){var A,dt=Te==="x"?fi:Ei,ct=Te==="x"?$i:Ki,xt=Qe[Pe],Qt=Pe==="y"?"height":"width",rt=xt+Ae[dt],Lt=xt-Ae[ct],Ht=[fi,Ei].indexOf(we)!==-1,Kt=(A=At==null?void 0:At[Pe])!=null?A:0,De=Ht?rt:xt-H[Qt]-te[Qt]-Kt+Vi.altAxis,li=Ht?xt+H[Qt]+te[Qt]-Kt-Vi.altAxis:Lt,Ti=ue&&Ht?aI(De,xt,li):Qo(ue?De:rt,xt,ue?li:Lt);Qe[Pe]=Ti,ei[Pe]=Ti-xt}V.modifiersData[M]=ei}}var $b={name:"preventOverflow",enabled:!0,phase:"main",fn:WM,requiresIfExists:["offset"]};function Zp(x){return{scrollLeft:x.scrollLeft,scrollTop:x.scrollTop}}function Vp(x){return x===Mi(x)||!ln(x)?vo(x):Zp(x)}function pM(x){var V=x.getBoundingClientRect(),U=hl(V.width)/x.offsetWidth||1,M=hl(V.height)/x.offsetHeight||1;return U!==1||M!==1}function gp(x,V,U){U===void 0&&(U=!1);var M=ln(V),w=ln(V)&&pM(V),j=hn(V),T=sa(x,w,U),bt={scrollLeft:0,scrollTop:0},Ut={x:0,y:0};return(M||!M&&!U)&&((on(V)!=="body"||zo(j))&&(bt=Vp(V)),ln(V)?(Ut=sa(V,!0),Ut.x+=V.clientLeft,Ut.y+=V.clientTop):j&&(Ut.x=fo(j))),{x:T.left+bt.scrollLeft-Ut.x,y:T.top+bt.scrollTop-Ut.y,width:T.width,height:T.height}}function ZM(x){var V=new Map,U=new Set,M=[];x.forEach(function(j){V.set(j.name,j)});function w(j){U.add(j.name);var T=[].concat(j.requires||[],j.requiresIfExists||[]);T.forEach(function(bt){if(!U.has(bt)){var Ut=V.get(bt);Ut&&w(Ut)}}),M.push(j)}return x.forEach(function(j){U.has(j.name)||w(j)}),M}function up(x){var V=ZM(x);return rp.reduce(function(U,M){return U.concat(V.filter(function(w){return w.phase===M}))},[])}function Rp(x){var V;return function(){return V||(V=new Promise(function(U){Promise.resolve().then(function(){V=void 0,U(x())})})),V}}function Gp(x){var V=x.reduce(function(U,M){var w=U[M.name];return U[M.name]=w?Object.assign({},w,M,{options:Object.assign({},w.options,M.options),data:Object.assign({},w.data,M.data)}):M,U},{});return Object.keys(V).map(function(U){return V[U]})}var rI={placement:"bottom",modifiers:[],strategy:"absolute"};function cI(){for(var x=arguments.length,V=new Array(x),U=0;U<x;U++)V[U]=arguments[U];return!V.some(function(M){return!(M&&typeof M.getBoundingClientRect=="function")})}function Lo(x){x===void 0&&(x={});var V=x,U=V.defaultModifiers,M=U===void 0?[]:U,w=V.defaultOptions,j=w===void 0?rI:w;return function(bt,Ut,Zt){Zt===void 0&&(Zt=j);var Ct={placement:"bottom",orderedModifiers:[],options:Object.assign({},rI,j),modifiersData:{},elements:{reference:bt,popper:Ut},attributes:{},styles:{}},Ge=[],Ue=!1,ue={state:Ct,setOptions:function(we){var Fi=typeof we=="function"?we(Ct.options):we;ye(),Ct.options=Object.assign({},j,Ct.options,Fi),Ct.scrollParents={reference:da(bt)?Pl(bt):bt.contextElement?Pl(bt.contextElement):[],popper:Pl(Ut)};var mi=up(Gp([].concat(M,Ct.options.modifiers)));return Ct.orderedModifiers=mi.filter(function(Te){return Te.enabled}),Ke(),ue.update()},forceUpdate:function(){if(!Ue){var we=Ct.elements,Fi=we.reference,mi=we.popper;if(cI(Fi,mi)){Ct.rects={reference:gp(Fi,Ya(mi),Ct.options.strategy==="fixed"),popper:ko(mi)},Ct.reset=!1,Ct.placement=Ct.options.placement,Ct.orderedModifiers.forEach(function(Vi){return Ct.modifiersData[Vi.name]=Object.assign({},Vi.data)});for(var Te=0;Te<Ct.orderedModifiers.length;Te++){if(Ct.reset===!0){Ct.reset=!1,Te=-1;continue}var Pe=Ct.orderedModifiers[Te],Qe=Pe.fn,H=Pe.options,te=H===void 0?{}:H,zi=Pe.name;typeof Qe=="function"&&(Ct=Qe({state:Ct,options:te,name:zi,instance:ue})||Ct)}}}},update:Rp(function(){return new Promise(function(Ae){ue.forceUpdate(),Ae(Ct)})}),destroy:function(){ye(),Ue=!0}};if(!cI(bt,Ut))return ue;ue.setOptions(Zt).then(function(Ae){!Ue&&Zt.onFirstUpdate&&Zt.onFirstUpdate(Ae)});function Ke(){Ct.orderedModifiers.forEach(function(Ae){var we=Ae.name,Fi=Ae.options,mi=Fi===void 0?{}:Fi,Te=Ae.effect;if(typeof Te=="function"){var Pe=Te({state:Ct,name:we,instance:ue,options:mi}),Qe=function(){};Ge.push(Pe||Qe)}})}function ye(){Ge.forEach(function(Ae){return Ae()}),Ge=[]}return ue}}var bI=Lo();var VM=[Hd,_d,jd,Ad],mI=Lo({defaultModifiers:VM});var gM=[Hd,_d,jd,Ad,qb,Kb,$b,Hb,Pb],Fr=Lo({defaultModifiers:gM});var ql=new Map,Fp={set(x,V,U){ql.has(x)||ql.set(x,new Map);let M=ql.get(x);if(!M.has(V)&&M.size!==0){console.error("Bootstrap doesn't allow more than one instance per element. Bound instance: ".concat(Array.from(M.keys())[0],"."));return}M.set(V,U)},get(x,V){return ql.has(x)&&ql.get(x).get(V)||null},remove(x,V){if(!ql.has(x))return;let U=ql.get(x);U.delete(V),U.size===0&&ql.delete(x)}},uM=1e6,RM=1e3,Qp="transitionend",LI=x=>(x&&window.CSS&&window.CSS.escape&&(x=x.replace(/#([^\s"#']+)/g,(V,U)=>"#".concat(CSS.escape(U)))),x),GM=x=>x==null?"".concat(x):Object.prototype.toString.call(x).match(/\s([a-z]+)/i)[1].toLowerCase(),FM=x=>{do x+=Math.floor(Math.random()*uM);while(document.getElementById(x));return x},IM=x=>{if(!x)return 0;let{transitionDuration:V,transitionDelay:U}=window.getComputedStyle(x),M=Number.parseFloat(V),w=Number.parseFloat(U);return!M&&!w?0:(V=V.split(",")[0],U=U.split(",")[0],(Number.parseFloat(V)+Number.parseFloat(U))*RM)},EI=x=>{x.dispatchEvent(new Event(Qp))},pl=x=>!x||typeof x!="object"?!1:(typeof x.jquery<"u"&&(x=x[0]),typeof x.nodeType<"u"),$l=x=>pl(x)?x.jquery?x[0]:x:typeof x=="string"&&x.length>0?document.querySelector(LI(x)):null,ns=x=>{if(!pl(x)||x.getClientRects().length===0)return!1;let V=getComputedStyle(x).getPropertyValue("visibility")==="visible",U=x.closest("details:not([open])");if(!U)return V;if(U!==x){let M=x.closest("summary");if(M&&M.parentNode!==U||M===null)return!1}return V},to=x=>!x||x.nodeType!==Node.ELEMENT_NODE||x.classList.contains("disabled")?!0:typeof x.disabled<"u"?x.disabled:x.hasAttribute("disabled")&&x.getAttribute("disabled")!=="false",AI=x=>{if(!document.documentElement.attachShadow)return null;if(typeof x.getRootNode=="function"){let V=x.getRootNode();return V instanceof ShadowRoot?V:null}return x instanceof ShadowRoot?x:x.parentNode?AI(x.parentNode):null},rm=()=>{},Xr=x=>{x.offsetHeight},wI=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Ip=[],UM=x=>{document.readyState==="loading"?(Ip.length||document.addEventListener("DOMContentLoaded",()=>{for(let V of Ip)V()}),Ip.push(x)):x()},ca=()=>document.documentElement.dir==="rtl",ma=x=>{UM(()=>{let V=wI();if(V){let U=x.NAME,M=V.fn[U];V.fn[U]=x.jQueryInterface,V.fn[U].Constructor=x,V.fn[U].noConflict=()=>(V.fn[U]=M,x.jQueryInterface)}})},zn=(x,V=[],U=x)=>typeof x=="function"?x(...V):U,jI=(x,V,U=!0)=>{if(!U){zn(x);return}let w=IM(V)+5,j=!1,T=({target:bt})=>{bt===V&&(j=!0,V.removeEventListener(Qp,T),zn(x))};V.addEventListener(Qp,T),setTimeout(()=>{j||EI(V)},w)},Ep=(x,V,U,M)=>{let w=x.length,j=x.indexOf(V);return j===-1?!U&&M?x[w-1]:x[0]:(j+=U?1:-1,M&&(j=(j+w)%w),x[Math.max(0,Math.min(j,w-1))])},xM=/[^.]*(?=\..*)\.|.*/,NM=/\..*/,YM=/::\d+$/,Up={},hI=1,HI={mouseenter:"mouseover",mouseleave:"mouseout"},XM=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function OI(x,V){return V&&"".concat(V,"::").concat(hI++)||x.uidEvent||hI++}function DI(x){let V=OI(x);return x.uidEvent=V,Up[V]=Up[V]||{},Up[V]}function JM(x,V){return function U(M){return Ap(M,{delegateTarget:x}),U.oneOff&&Jt.off(x,M.type,V),V.apply(x,[M])}}function yM(x,V,U){return function M(w){let j=x.querySelectorAll(V);for(let{target:T}=w;T&&T!==this;T=T.parentNode)for(let bt of j)if(bt===T)return Ap(w,{delegateTarget:T}),M.oneOff&&Jt.off(x,w.type,V,U),U.apply(T,[w])}}function _I(x,V,U=null){return Object.values(x).find(M=>M.callable===V&&M.delegationSelector===U)}function KI(x,V,U){let M=typeof V=="string",w=M?U:V||U,j=PI(x);return XM.has(j)||(j=x),[M,w,j]}function WI(x,V,U,M,w){if(typeof V!="string"||!x)return;let[j,T,bt]=KI(V,U,M);V in HI&&(T=(Ke=>function(ye){if(!ye.relatedTarget||ye.relatedTarget!==ye.delegateTarget&&!ye.delegateTarget.contains(ye.relatedTarget))return Ke.call(this,ye)})(T));let Ut=DI(x),Zt=Ut[bt]||(Ut[bt]={}),Ct=_I(Zt,T,j?U:null);if(Ct){Ct.oneOff=Ct.oneOff&&w;return}let Ge=OI(T,V.replace(xM,"")),Ue=j?yM(x,U,T):JM(x,T);Ue.delegationSelector=j?U:null,Ue.callable=T,Ue.oneOff=w,Ue.uidEvent=Ge,Zt[Ge]=Ue,x.addEventListener(bt,Ue,j)}function vp(x,V,U,M,w){let j=_I(V[U],M,w);j&&(x.removeEventListener(U,j,!!w),delete V[U][j.uidEvent])}function BM(x,V,U,M){let w=V[U]||{};for(let[j,T]of Object.entries(w))j.includes(M)&&vp(x,V,U,T.callable,T.delegationSelector)}function PI(x){return x=x.replace(NM,""),HI[x]||x}var Jt={on(x,V,U,M){WI(x,V,U,M,!1)},one(x,V,U,M){WI(x,V,U,M,!0)},off(x,V,U,M){if(typeof V!="string"||!x)return;let[w,j,T]=KI(V,U,M),bt=T!==V,Ut=DI(x),Zt=Ut[T]||{},Ct=V.startsWith(".");if(typeof j<"u"){if(!Object.keys(Zt).length)return;vp(x,Ut,T,j,w?U:null);return}if(Ct)for(let Ge of Object.keys(Ut))BM(x,Ut,Ge,V.slice(1));for(let[Ge,Ue]of Object.entries(Zt)){let ue=Ge.replace(YM,"");(!bt||V.includes(ue))&&vp(x,Ut,T,Ue.callable,Ue.delegationSelector)}},trigger(x,V,U){if(typeof V!="string"||!x)return null;let M=wI(),w=PI(V),j=V!==w,T=null,bt=!0,Ut=!0,Zt=!1;j&&M&&(T=M.Event(V,U),M(x).trigger(T),bt=!T.isPropagationStopped(),Ut=!T.isImmediatePropagationStopped(),Zt=T.isDefaultPrevented());let Ct=Ap(new Event(V,{bubbles:bt,cancelable:!0}),U);return Zt&&Ct.preventDefault(),Ut&&x.dispatchEvent(Ct),Ct.defaultPrevented&&T&&T.preventDefault(),Ct}};function Ap(x,V={}){for(let[U,M]of Object.entries(V))try{x[U]=M}catch{Object.defineProperty(x,U,{configurable:!0,get(){return M}})}return x}function pI(x){if(x==="true")return!0;if(x==="false")return!1;if(x===Number(x).toString())return Number(x);if(x===""||x==="null")return null;if(typeof x!="string")return x;try{return JSON.parse(decodeURIComponent(x))}catch{return x}}function xp(x){return x.replace(/[A-Z]/g,V=>"-".concat(V.toLowerCase()))}var Zl={setDataAttribute(x,V,U){x.setAttribute("data-bs-".concat(xp(V)),U)},removeDataAttribute(x,V){x.removeAttribute("data-bs-".concat(xp(V)))},getDataAttributes(x){if(!x)return{};let V={},U=Object.keys(x.dataset).filter(M=>M.startsWith("bs")&&!M.startsWith("bsConfig"));for(let M of U){let w=M.replace(/^bs/,"");w=w.charAt(0).toLowerCase()+w.slice(1,w.length),V[w]=pI(x.dataset[M])}return V},getDataAttribute(x,V){return pI(x.getAttribute("data-bs-".concat(xp(V))))}},wo=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(V){return V=this._mergeConfigObj(V),V=this._configAfterMerge(V),this._typeCheckConfig(V),V}_configAfterMerge(V){return V}_mergeConfigObj(V,U){let M=pl(U)?Zl.getDataAttribute(U,"config"):{};return{...this.constructor.Default,...typeof M=="object"?M:{},...pl(U)?Zl.getDataAttributes(U):{},...typeof V=="object"?V:{}}}_typeCheckConfig(V,U=this.constructor.DefaultType){for(let[M,w]of Object.entries(U)){let j=V[M],T=pl(j)?"element":GM(j);if(!new RegExp(w).test(T))throw new TypeError("".concat(this.constructor.NAME.toUpperCase(),': Option "').concat(M,'" provided type "').concat(T,'" but expected type "').concat(w,'".'))}}},MM="5.3.2",On=class extends wo{constructor(V,U){super(),V=$l(V),V&&(this._element=V,this._config=this._getConfig(U),Fp.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Fp.remove(this._element,this.constructor.DATA_KEY),Jt.off(this._element,this.constructor.EVENT_KEY);for(let V of Object.getOwnPropertyNames(this))this[V]=null}_queueCallback(V,U,M=!0){jI(V,U,M)}_getConfig(V){return V=this._mergeConfigObj(V,this._element),V=this._configAfterMerge(V),this._typeCheckConfig(V),V}static getInstance(V){return Fp.get($l(V),this.DATA_KEY)}static getOrCreateInstance(V,U={}){return this.getInstance(V)||new this(V,typeof U=="object"?U:null)}static get VERSION(){return MM}static get DATA_KEY(){return"bs.".concat(this.NAME)}static get EVENT_KEY(){return".".concat(this.DATA_KEY)}static eventName(V){return"".concat(V).concat(this.EVENT_KEY)}},Np=x=>{let V=x.getAttribute("data-bs-target");if(!V||V==="#"){let U=x.getAttribute("href");if(!U||!U.includes("#")&&!U.startsWith("."))return null;U.includes("#")&&!U.startsWith("#")&&(U="#".concat(U.split("#")[1])),V=U&&U!=="#"?LI(U.trim()):null}return V},Ze={find(x,V=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(V,x))},findOne(x,V=document.documentElement){return Element.prototype.querySelector.call(V,x)},children(x,V){return[].concat(...x.children).filter(U=>U.matches(V))},parents(x,V){let U=[],M=x.parentNode.closest(V);for(;M;)U.push(M),M=M.parentNode.closest(V);return U},prev(x,V){let U=x.previousElementSibling;for(;U;){if(U.matches(V))return[U];U=U.previousElementSibling}return[]},next(x,V){let U=x.nextElementSibling;for(;U;){if(U.matches(V))return[U];U=U.nextElementSibling}return[]},focusableChildren(x){let V=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(U=>"".concat(U,':not([tabindex^="-"])')).join(",");return this.find(V,x).filter(U=>!to(U)&&ns(U))},getSelectorFromElement(x){let V=Np(x);return V&&Ze.findOne(V)?V:null},getElementFromSelector(x){let V=Np(x);return V?Ze.findOne(V):null},getMultipleElementsFromSelector(x){let V=Np(x);return V?Ze.find(V):[]}},um=(x,V="hide")=>{let U="click.dismiss".concat(x.EVENT_KEY),M=x.NAME;Jt.on(document,U,'[data-bs-dismiss="'.concat(M,'"]'),function(w){if(["A","AREA"].includes(this.tagName)&&w.preventDefault(),to(this))return;let j=Ze.getElementFromSelector(this)||this.closest(".".concat(M));x.getOrCreateInstance(j)[V]()})},CM="alert",TM="bs.alert",qI=".".concat(TM),kM="close".concat(qI),SM="closed".concat(qI),QM="fade",vM="show",cm=class x extends On{static get NAME(){return CM}close(){if(Jt.trigger(this._element,kM).defaultPrevented)return;this._element.classList.remove(vM);let U=this._element.classList.contains(QM);this._queueCallback(()=>this._destroyElement(),this._element,U)}_destroyElement(){this._element.remove(),Jt.trigger(this._element,SM),this.dispose()}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this);if(typeof V=="string"){if(U[V]===void 0||V.startsWith("_")||V==="constructor")throw new TypeError('No method named "'.concat(V,'"'));U[V](this)}})}};um(cm,"close");ma(cm);var fM="button",zM="bs.button",LM=".".concat(zM),EM=".data-api",AM="active",ZI='[data-bs-toggle="button"]',wM="click".concat(LM).concat(EM),bm=class x extends On{static get NAME(){return fM}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(AM))}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this);V==="toggle"&&U[V]()})}};Jt.on(document,wM,ZI,x=>{x.preventDefault();let V=x.target.closest(ZI);bm.getOrCreateInstance(V).toggle()});ma(bm);var jM="swipe",as=".bs.swipe",HM="touchstart".concat(as),OM="touchmove".concat(as),DM="touchend".concat(as),_M="pointerdown".concat(as),KM="pointerup".concat(as),PM="touch",qM="pen",$M="pointer-event",tC=40,eC={endCallback:null,leftCallback:null,rightCallback:null},iC={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"},mm=class x extends wo{constructor(V,U){super(),this._element=V,!(!V||!x.isSupported())&&(this._config=this._getConfig(U),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return eC}static get DefaultType(){return iC}static get NAME(){return jM}dispose(){Jt.off(this._element,as)}_start(V){if(!this._supportPointerEvents){this._deltaX=V.touches[0].clientX;return}this._eventIsPointerPenTouch(V)&&(this._deltaX=V.clientX)}_end(V){this._eventIsPointerPenTouch(V)&&(this._deltaX=V.clientX-this._deltaX),this._handleSwipe(),zn(this._config.endCallback)}_move(V){this._deltaX=V.touches&&V.touches.length>1?0:V.touches[0].clientX-this._deltaX}_handleSwipe(){let V=Math.abs(this._deltaX);if(V<=tC)return;let U=V/this._deltaX;this._deltaX=0,U&&zn(U>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Jt.on(this._element,_M,V=>this._start(V)),Jt.on(this._element,KM,V=>this._end(V)),this._element.classList.add($M)):(Jt.on(this._element,HM,V=>this._start(V)),Jt.on(this._element,OM,V=>this._move(V)),Jt.on(this._element,DM,V=>this._end(V)))}_eventIsPointerPenTouch(V){return this._supportPointerEvents&&(V.pointerType===qM||V.pointerType===PM)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}},nC="carousel",aC="bs.carousel",no=".".concat(aC),$I=".data-api",lC="ArrowLeft",oC="ArrowRight",dC=500,Ir="next",Kd="prev",qd="left",dm="right",sC="slide".concat(no),Yp="slid".concat(no),rC="keydown".concat(no),cC="mouseenter".concat(no),bC="mouseleave".concat(no),mC="dragstart".concat(no),hC="load".concat(no).concat($I),WC="click".concat(no).concat($I),tU="carousel",em="active",pC="slide",ZC="carousel-item-end",VC="carousel-item-start",gC="carousel-item-next",uC="carousel-item-prev",eU=".active",iU=".carousel-item",RC=eU+iU,GC=".carousel-item img",FC=".carousel-indicators",IC="[data-bs-slide], [data-bs-slide-to]",UC='[data-bs-ride="carousel"]',xC={[lC]:dm,[oC]:qd},NC={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},YC={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"},xr=class x extends On{constructor(V,U){super(V,U),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ze.findOne(FC,this._element),this._addEventListeners(),this._config.ride===tU&&this.cycle()}static get Default(){return NC}static get DefaultType(){return YC}static get NAME(){return nC}next(){this._slide(Ir)}nextWhenVisible(){!document.hidden&&ns(this._element)&&this.next()}prev(){this._slide(Kd)}pause(){this._isSliding&&EI(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Jt.one(this._element,Yp,()=>this.cycle());return}this.cycle()}}to(V){let U=this._getItems();if(V>U.length-1||V<0)return;if(this._isSliding){Jt.one(this._element,Yp,()=>this.to(V));return}let M=this._getItemIndex(this._getActive());if(M===V)return;let w=V>M?Ir:Kd;this._slide(w,U[V])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(V){return V.defaultInterval=V.interval,V}_addEventListeners(){this._config.keyboard&&Jt.on(this._element,rC,V=>this._keydown(V)),this._config.pause==="hover"&&(Jt.on(this._element,cC,()=>this.pause()),Jt.on(this._element,bC,()=>this._maybeEnableCycle())),this._config.touch&&mm.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let M of Ze.find(GC,this._element))Jt.on(M,mC,w=>w.preventDefault());let U={leftCallback:()=>this._slide(this._directionToOrder(qd)),rightCallback:()=>this._slide(this._directionToOrder(dm)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),dC+this._config.interval))}};this._swipeHelper=new mm(this._element,U)}_keydown(V){if(/input|textarea/i.test(V.target.tagName))return;let U=xC[V.key];U&&(V.preventDefault(),this._slide(this._directionToOrder(U)))}_getItemIndex(V){return this._getItems().indexOf(V)}_setActiveIndicatorElement(V){if(!this._indicatorsElement)return;let U=Ze.findOne(eU,this._indicatorsElement);U.classList.remove(em),U.removeAttribute("aria-current");let M=Ze.findOne('[data-bs-slide-to="'.concat(V,'"]'),this._indicatorsElement);M&&(M.classList.add(em),M.setAttribute("aria-current","true"))}_updateInterval(){let V=this._activeElement||this._getActive();if(!V)return;let U=Number.parseInt(V.getAttribute("data-bs-interval"),10);this._config.interval=U||this._config.defaultInterval}_slide(V,U=null){if(this._isSliding)return;let M=this._getActive(),w=V===Ir,j=U||Ep(this._getItems(),M,w,this._config.wrap);if(j===M)return;let T=this._getItemIndex(j),bt=ue=>Jt.trigger(this._element,ue,{relatedTarget:j,direction:this._orderToDirection(V),from:this._getItemIndex(M),to:T});if(bt(sC).defaultPrevented||!M||!j)return;let Zt=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(T),this._activeElement=j;let Ct=w?VC:ZC,Ge=w?gC:uC;j.classList.add(Ge),Xr(j),M.classList.add(Ct),j.classList.add(Ct);let Ue=()=>{j.classList.remove(Ct,Ge),j.classList.add(em),M.classList.remove(em,Ge,Ct),this._isSliding=!1,bt(Yp)};this._queueCallback(Ue,M,this._isAnimated()),Zt&&this.cycle()}_isAnimated(){return this._element.classList.contains(pC)}_getActive(){return Ze.findOne(RC,this._element)}_getItems(){return Ze.find(iU,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(V){return ca()?V===qd?Kd:Ir:V===qd?Ir:Kd}_orderToDirection(V){return ca()?V===Kd?qd:dm:V===Kd?dm:qd}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="number"){U.to(V);return}if(typeof V=="string"){if(U[V]===void 0||V.startsWith("_")||V==="constructor")throw new TypeError('No method named "'.concat(V,'"'));U[V]()}})}};Jt.on(document,WC,IC,function(x){let V=Ze.getElementFromSelector(this);if(!V||!V.classList.contains(tU))return;x.preventDefault();let U=xr.getOrCreateInstance(V),M=this.getAttribute("data-bs-slide-to");if(M){U.to(M),U._maybeEnableCycle();return}if(Zl.getDataAttribute(this,"slide")==="next"){U.next(),U._maybeEnableCycle();return}U.prev(),U._maybeEnableCycle()});Jt.on(window,hC,()=>{let x=Ze.find(UC);for(let V of x)xr.getOrCreateInstance(V)});ma(xr);var XC="collapse",JC="bs.collapse",Jr=".".concat(JC),yC=".data-api",BC="show".concat(Jr),MC="shown".concat(Jr),CC="hide".concat(Jr),TC="hidden".concat(Jr),kC="click".concat(Jr).concat(yC),Xp="show",ts="collapse",im="collapsing",SC="collapsed",QC=":scope .".concat(ts," .").concat(ts),vC="collapse-horizontal",fC="width",zC="height",LC=".collapse.show, .collapse.collapsing",fp='[data-bs-toggle="collapse"]',EC={parent:null,toggle:!0},AC={parent:"(null|element)",toggle:"boolean"},hm=class x extends On{constructor(V,U){super(V,U),this._isTransitioning=!1,this._triggerArray=[];let M=Ze.find(fp);for(let w of M){let j=Ze.getSelectorFromElement(w),T=Ze.find(j).filter(bt=>bt===this._element);j!==null&&T.length&&this._triggerArray.push(w)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return EC}static get DefaultType(){return AC}static get NAME(){return XC}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let V=[];if(this._config.parent&&(V=this._getFirstLevelChildren(LC).filter(bt=>bt!==this._element).map(bt=>x.getOrCreateInstance(bt,{toggle:!1}))),V.length&&V[0]._isTransitioning||Jt.trigger(this._element,BC).defaultPrevented)return;for(let bt of V)bt.hide();let M=this._getDimension();this._element.classList.remove(ts),this._element.classList.add(im),this._element.style[M]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;let w=()=>{this._isTransitioning=!1,this._element.classList.remove(im),this._element.classList.add(ts,Xp),this._element.style[M]="",Jt.trigger(this._element,MC)},j=M[0].toUpperCase()+M.slice(1),T="scroll".concat(j);this._queueCallback(w,this._element,!0),this._element.style[M]="".concat(this._element[T],"px")}hide(){if(this._isTransitioning||!this._isShown()||Jt.trigger(this._element,CC).defaultPrevented)return;let U=this._getDimension();this._element.style[U]="".concat(this._element.getBoundingClientRect()[U],"px"),Xr(this._element),this._element.classList.add(im),this._element.classList.remove(ts,Xp);for(let w of this._triggerArray){let j=Ze.getElementFromSelector(w);j&&!this._isShown(j)&&this._addAriaAndCollapsedClass([w],!1)}this._isTransitioning=!0;let M=()=>{this._isTransitioning=!1,this._element.classList.remove(im),this._element.classList.add(ts),Jt.trigger(this._element,TC)};this._element.style[U]="",this._queueCallback(M,this._element,!0)}_isShown(V=this._element){return V.classList.contains(Xp)}_configAfterMerge(V){return V.toggle=!!V.toggle,V.parent=$l(V.parent),V}_getDimension(){return this._element.classList.contains(vC)?fC:zC}_initializeChildren(){if(!this._config.parent)return;let V=this._getFirstLevelChildren(fp);for(let U of V){let M=Ze.getElementFromSelector(U);M&&this._addAriaAndCollapsedClass([U],this._isShown(M))}}_getFirstLevelChildren(V){let U=Ze.find(QC,this._config.parent);return Ze.find(V,this._config.parent).filter(M=>!U.includes(M))}_addAriaAndCollapsedClass(V,U){if(V.length)for(let M of V)M.classList.toggle(SC,!U),M.setAttribute("aria-expanded",U)}static jQueryInterface(V){let U={};return typeof V=="string"&&/show|hide/.test(V)&&(U.toggle=!1),this.each(function(){let M=x.getOrCreateInstance(this,U);if(typeof V=="string"){if(typeof M[V]>"u")throw new TypeError('No method named "'.concat(V,'"'));M[V]()}})}};Jt.on(document,kC,fp,function(x){(x.target.tagName==="A"||x.delegateTarget&&x.delegateTarget.tagName==="A")&&x.preventDefault();for(let V of Ze.getMultipleElementsFromSelector(this))hm.getOrCreateInstance(V,{toggle:!1}).toggle()});ma(hm);var VI="dropdown",wC="bs.dropdown",jo=".".concat(wC),wp=".data-api",jC="Escape",gI="Tab",HC="ArrowUp",uI="ArrowDown",OC=2,DC="hide".concat(jo),_C="hidden".concat(jo),KC="show".concat(jo),PC="shown".concat(jo),nU="click".concat(jo).concat(wp),aU="keydown".concat(jo).concat(wp),qC="keyup".concat(jo).concat(wp),$d="show",$C="dropup",tT="dropend",eT="dropstart",iT="dropup-center",nT="dropdown-center",Eo='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',aT="".concat(Eo,".").concat($d),sm=".dropdown-menu",lT=".navbar",oT=".navbar-nav",dT=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",sT=ca()?"top-end":"top-start",rT=ca()?"top-start":"top-end",cT=ca()?"bottom-end":"bottom-start",bT=ca()?"bottom-start":"bottom-end",mT=ca()?"left-start":"right-start",hT=ca()?"right-start":"left-start",WT="top",pT="bottom",ZT={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},VT={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"},eo=class x extends On{constructor(V,U){super(V,U),this._popper=null,this._parent=this._element.parentNode,this._menu=Ze.next(this._element,sm)[0]||Ze.prev(this._element,sm)[0]||Ze.findOne(sm,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return ZT}static get DefaultType(){return VT}static get NAME(){return VI}toggle(){return this._isShown()?this.hide():this.show()}show(){if(to(this._element)||this._isShown())return;let V={relatedTarget:this._element};if(!Jt.trigger(this._element,KC,V).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(oT))for(let M of[].concat(...document.body.children))Jt.on(M,"mouseover",rm);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add($d),this._element.classList.add($d),Jt.trigger(this._element,PC,V)}}hide(){if(to(this._element)||!this._isShown())return;let V={relatedTarget:this._element};this._completeHide(V)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(V){if(!Jt.trigger(this._element,DC,V).defaultPrevented){if("ontouchstart"in document.documentElement)for(let M of[].concat(...document.body.children))Jt.off(M,"mouseover",rm);this._popper&&this._popper.destroy(),this._menu.classList.remove($d),this._element.classList.remove($d),this._element.setAttribute("aria-expanded","false"),Zl.removeDataAttribute(this._menu,"popper"),Jt.trigger(this._element,_C,V)}}_getConfig(V){if(V=super._getConfig(V),typeof V.reference=="object"&&!pl(V.reference)&&typeof V.reference.getBoundingClientRect!="function")throw new TypeError("".concat(VI.toUpperCase(),': Option "reference" provided type "object" without a required "getBoundingClientRect" method.'));return V}_createPopper(){if(typeof tm>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let V=this._element;this._config.reference==="parent"?V=this._parent:pl(this._config.reference)?V=$l(this._config.reference):typeof this._config.reference=="object"&&(V=this._config.reference);let U=this._getPopperConfig();this._popper=Fr(V,this._menu,U)}_isShown(){return this._menu.classList.contains($d)}_getPlacement(){let V=this._parent;if(V.classList.contains(tT))return mT;if(V.classList.contains(eT))return hT;if(V.classList.contains(iT))return WT;if(V.classList.contains(nT))return pT;let U=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return V.classList.contains($C)?U?rT:sT:U?bT:cT}_detectNavbar(){return this._element.closest(lT)!==null}_getOffset(){let{offset:V}=this._config;return typeof V=="string"?V.split(",").map(U=>Number.parseInt(U,10)):typeof V=="function"?U=>V(U,this._element):V}_getPopperConfig(){let V={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Zl.setDataAttribute(this._menu,"popper","static"),V.modifiers=[{name:"applyStyles",enabled:!1}]),{...V,...zn(this._config.popperConfig,[V])}}_selectMenuItem({key:V,target:U}){let M=Ze.find(dT,this._menu).filter(w=>ns(w));M.length&&Ep(M,U,V===uI,!M.includes(U)).focus()}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(typeof U[V]>"u")throw new TypeError('No method named "'.concat(V,'"'));U[V]()}})}static clearMenus(V){if(V.button===OC||V.type==="keyup"&&V.key!==gI)return;let U=Ze.find(aT);for(let M of U){let w=x.getInstance(M);if(!w||w._config.autoClose===!1)continue;let j=V.composedPath(),T=j.includes(w._menu);if(j.includes(w._element)||w._config.autoClose==="inside"&&!T||w._config.autoClose==="outside"&&T||w._menu.contains(V.target)&&(V.type==="keyup"&&V.key===gI||/input|select|option|textarea|form/i.test(V.target.tagName)))continue;let bt={relatedTarget:w._element};V.type==="click"&&(bt.clickEvent=V),w._completeHide(bt)}}static dataApiKeydownHandler(V){let U=/input|textarea/i.test(V.target.tagName),M=V.key===jC,w=[HC,uI].includes(V.key);if(!w&&!M||U&&!M)return;V.preventDefault();let j=this.matches(Eo)?this:Ze.prev(this,Eo)[0]||Ze.next(this,Eo)[0]||Ze.findOne(Eo,V.delegateTarget.parentNode),T=x.getOrCreateInstance(j);if(w){V.stopPropagation(),T.show(),T._selectMenuItem(V);return}T._isShown()&&(V.stopPropagation(),T.hide(),j.focus())}};Jt.on(document,aU,Eo,eo.dataApiKeydownHandler);Jt.on(document,aU,sm,eo.dataApiKeydownHandler);Jt.on(document,nU,eo.clearMenus);Jt.on(document,qC,eo.clearMenus);Jt.on(document,nU,Eo,function(x){x.preventDefault(),eo.getOrCreateInstance(this).toggle()});ma(eo);var lU="backdrop",gT="fade",RI="show",GI="mousedown.bs.".concat(lU),uT={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},RT={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"},Wm=class extends wo{constructor(V){super(),this._config=this._getConfig(V),this._isAppended=!1,this._element=null}static get Default(){return uT}static get DefaultType(){return RT}static get NAME(){return lU}show(V){if(!this._config.isVisible){zn(V);return}this._append();let U=this._getElement();this._config.isAnimated&&Xr(U),U.classList.add(RI),this._emulateAnimation(()=>{zn(V)})}hide(V){if(!this._config.isVisible){zn(V);return}this._getElement().classList.remove(RI),this._emulateAnimation(()=>{this.dispose(),zn(V)})}dispose(){this._isAppended&&(Jt.off(this._element,GI),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let V=document.createElement("div");V.className=this._config.className,this._config.isAnimated&&V.classList.add(gT),this._element=V}return this._element}_configAfterMerge(V){return V.rootElement=$l(V.rootElement),V}_append(){if(this._isAppended)return;let V=this._getElement();this._config.rootElement.append(V),Jt.on(V,GI,()=>{zn(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(V){jI(V,this._getElement(),this._config.isAnimated)}},GT="focustrap",FT="bs.focustrap",pm=".".concat(FT),IT="focusin".concat(pm),UT="keydown.tab".concat(pm),xT="Tab",NT="forward",FI="backward",YT={autofocus:!0,trapElement:null},XT={autofocus:"boolean",trapElement:"element"},Zm=class extends wo{constructor(V){super(),this._config=this._getConfig(V),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return YT}static get DefaultType(){return XT}static get NAME(){return GT}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Jt.off(document,pm),Jt.on(document,IT,V=>this._handleFocusin(V)),Jt.on(document,UT,V=>this._handleKeydown(V)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Jt.off(document,pm))}_handleFocusin(V){let{trapElement:U}=this._config;if(V.target===document||V.target===U||U.contains(V.target))return;let M=Ze.focusableChildren(U);M.length===0?U.focus():this._lastTabNavDirection===FI?M[M.length-1].focus():M[0].focus()}_handleKeydown(V){V.key===xT&&(this._lastTabNavDirection=V.shiftKey?FI:NT)}},II=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",UI=".sticky-top",nm="padding-right",xI="margin-right",Nr=class{constructor(){this._element=document.body}getWidth(){let V=document.documentElement.clientWidth;return Math.abs(window.innerWidth-V)}hide(){let V=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,nm,U=>U+V),this._setElementAttributes(II,nm,U=>U+V),this._setElementAttributes(UI,xI,U=>U-V)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,nm),this._resetElementAttributes(II,nm),this._resetElementAttributes(UI,xI)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(V,U,M){let w=this.getWidth(),j=T=>{if(T!==this._element&&window.innerWidth>T.clientWidth+w)return;this._saveInitialAttribute(T,U);let bt=window.getComputedStyle(T).getPropertyValue(U);T.style.setProperty(U,"".concat(M(Number.parseFloat(bt)),"px"))};this._applyManipulationCallback(V,j)}_saveInitialAttribute(V,U){let M=V.style.getPropertyValue(U);M&&Zl.setDataAttribute(V,U,M)}_resetElementAttributes(V,U){let M=w=>{let j=Zl.getDataAttribute(w,U);if(j===null){w.style.removeProperty(U);return}Zl.removeDataAttribute(w,U),w.style.setProperty(U,j)};this._applyManipulationCallback(V,M)}_applyManipulationCallback(V,U){if(pl(V)){U(V);return}for(let M of Ze.find(V,this._element))U(M)}},JT="modal",yT="bs.modal",ba=".".concat(yT),BT=".data-api",MT="Escape",CT="hide".concat(ba),TT="hidePrevented".concat(ba),oU="hidden".concat(ba),dU="show".concat(ba),kT="shown".concat(ba),ST="resize".concat(ba),QT="click.dismiss".concat(ba),vT="mousedown.dismiss".concat(ba),fT="keydown.dismiss".concat(ba),zT="click".concat(ba).concat(BT),NI="modal-open",LT="fade",YI="show",Jp="modal-static",ET=".modal.show",AT=".modal-dialog",wT=".modal-body",jT='[data-bs-toggle="modal"]',HT={backdrop:!0,focus:!0,keyboard:!0},OT={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"},es=class x extends On{constructor(V,U){super(V,U),this._dialog=Ze.findOne(AT,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Nr,this._addEventListeners()}static get Default(){return HT}static get DefaultType(){return OT}static get NAME(){return JT}toggle(V){return this._isShown?this.hide():this.show(V)}show(V){this._isShown||this._isTransitioning||Jt.trigger(this._element,dU,{relatedTarget:V}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(NI),this._adjustDialog(),this._backdrop.show(()=>this._showElement(V)))}hide(){!this._isShown||this._isTransitioning||Jt.trigger(this._element,CT).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(YI),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Jt.off(window,ba),Jt.off(this._dialog,ba),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Wm({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Zm({trapElement:this._element})}_showElement(V){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;let U=Ze.findOne(wT,this._dialog);U&&(U.scrollTop=0),Xr(this._element),this._element.classList.add(YI);let M=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Jt.trigger(this._element,kT,{relatedTarget:V})};this._queueCallback(M,this._dialog,this._isAnimated())}_addEventListeners(){Jt.on(this._element,fT,V=>{if(V.key===MT){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Jt.on(window,ST,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Jt.on(this._element,vT,V=>{Jt.one(this._element,QT,U=>{if(!(this._element!==V.target||this._element!==U.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(NI),this._resetAdjustments(),this._scrollBar.reset(),Jt.trigger(this._element,oU)})}_isAnimated(){return this._element.classList.contains(LT)}_triggerBackdropTransition(){if(Jt.trigger(this._element,TT).defaultPrevented)return;let U=this._element.scrollHeight>document.documentElement.clientHeight,M=this._element.style.overflowY;M==="hidden"||this._element.classList.contains(Jp)||(U||(this._element.style.overflowY="hidden"),this._element.classList.add(Jp),this._queueCallback(()=>{this._element.classList.remove(Jp),this._queueCallback(()=>{this._element.style.overflowY=M},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){let V=this._element.scrollHeight>document.documentElement.clientHeight,U=this._scrollBar.getWidth(),M=U>0;if(M&&!V){let w=ca()?"paddingLeft":"paddingRight";this._element.style[w]="".concat(U,"px")}if(!M&&V){let w=ca()?"paddingRight":"paddingLeft";this._element.style[w]="".concat(U,"px")}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(V,U){return this.each(function(){let M=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(typeof M[V]>"u")throw new TypeError('No method named "'.concat(V,'"'));M[V](U)}})}};Jt.on(document,zT,jT,function(x){let V=Ze.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&x.preventDefault(),Jt.one(V,dU,w=>{w.defaultPrevented||Jt.one(V,oU,()=>{ns(this)&&this.focus()})});let U=Ze.findOne(ET);U&&es.getInstance(U).hide(),es.getOrCreateInstance(V).toggle(this)});um(es);ma(es);var DT="offcanvas",_T="bs.offcanvas",Vl=".".concat(_T),sU=".data-api",KT="load".concat(Vl).concat(sU),PT="Escape",XI="show",JI="showing",yI="hiding",qT="offcanvas-backdrop",rU=".offcanvas.show",$T="show".concat(Vl),tk="shown".concat(Vl),ek="hide".concat(Vl),BI="hidePrevented".concat(Vl),cU="hidden".concat(Vl),ik="resize".concat(Vl),nk="click".concat(Vl).concat(sU),ak="keydown.dismiss".concat(Vl),lk='[data-bs-toggle="offcanvas"]',ok={backdrop:!0,keyboard:!0,scroll:!1},dk={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"},io=class x extends On{constructor(V,U){super(V,U),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ok}static get DefaultType(){return dk}static get NAME(){return DT}toggle(V){return this._isShown?this.hide():this.show(V)}show(V){if(this._isShown||Jt.trigger(this._element,$T,{relatedTarget:V}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Nr().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(JI);let M=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(XI),this._element.classList.remove(JI),Jt.trigger(this._element,tk,{relatedTarget:V})};this._queueCallback(M,this._element,!0)}hide(){if(!this._isShown||Jt.trigger(this._element,ek).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(yI),this._backdrop.hide();let U=()=>{this._element.classList.remove(XI,yI),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Nr().reset(),Jt.trigger(this._element,cU)};this._queueCallback(U,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){let V=()=>{if(this._config.backdrop==="static"){Jt.trigger(this._element,BI);return}this.hide()},U=!!this._config.backdrop;return new Wm({className:qT,isVisible:U,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:U?V:null})}_initializeFocusTrap(){return new Zm({trapElement:this._element})}_addEventListeners(){Jt.on(this._element,ak,V=>{if(V.key===PT){if(this._config.keyboard){this.hide();return}Jt.trigger(this._element,BI)}})}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(U[V]===void 0||V.startsWith("_")||V==="constructor")throw new TypeError('No method named "'.concat(V,'"'));U[V](this)}})}};Jt.on(document,nk,lk,function(x){let V=Ze.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&x.preventDefault(),to(this))return;Jt.one(V,cU,()=>{ns(this)&&this.focus()});let U=Ze.findOne(rU);U&&U!==V&&io.getInstance(U).hide(),io.getOrCreateInstance(V).toggle(this)});Jt.on(window,KT,()=>{for(let x of Ze.find(rU))io.getOrCreateInstance(x).show()});Jt.on(window,ik,()=>{for(let x of Ze.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(x).position!=="fixed"&&io.getOrCreateInstance(x).hide()});um(io);ma(io);var sk=/^aria-[\w-]*$/i,bU={"*":["class","dir","id","lang","role",sk],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},rk=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ck=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,bk=(x,V)=>{let U=x.nodeName.toLowerCase();return V.includes(U)?rk.has(U)?!!ck.test(x.nodeValue):!0:V.filter(M=>M instanceof RegExp).some(M=>M.test(U))};function mk(x,V,U){if(!x.length)return x;if(U&&typeof U=="function")return U(x);let w=new window.DOMParser().parseFromString(x,"text/html"),j=[].concat(...w.body.querySelectorAll("*"));for(let T of j){let bt=T.nodeName.toLowerCase();if(!Object.keys(V).includes(bt)){T.remove();continue}let Ut=[].concat(...T.attributes),Zt=[].concat(V["*"]||[],V[bt]||[]);for(let Ct of Ut)bk(Ct,Zt)||T.removeAttribute(Ct.nodeName)}return w.body.innerHTML}var hk="TemplateFactory",Wk={allowList:bU,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},pk={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Zk={entry:"(string|element|function|null)",selector:"(string|element)"},zp=class extends wo{constructor(V){super(),this._config=this._getConfig(V)}static get Default(){return Wk}static get DefaultType(){return pk}static get NAME(){return hk}getContent(){return Object.values(this._config.content).map(V=>this._resolvePossibleFunction(V)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(V){return this._checkContent(V),this._config.content={...this._config.content,...V},this}toHtml(){let V=document.createElement("div");V.innerHTML=this._maybeSanitize(this._config.template);for(let[w,j]of Object.entries(this._config.content))this._setContent(V,j,w);let U=V.children[0],M=this._resolvePossibleFunction(this._config.extraClass);return M&&U.classList.add(...M.split(" ")),U}_typeCheckConfig(V){super._typeCheckConfig(V),this._checkContent(V.content)}_checkContent(V){for(let[U,M]of Object.entries(V))super._typeCheckConfig({selector:U,entry:M},Zk)}_setContent(V,U,M){let w=Ze.findOne(M,V);if(w){if(U=this._resolvePossibleFunction(U),!U){w.remove();return}if(pl(U)){this._putElementInTemplate($l(U),w);return}if(this._config.html){w.innerHTML=this._maybeSanitize(U);return}w.textContent=U}}_maybeSanitize(V){return this._config.sanitize?mk(V,this._config.allowList,this._config.sanitizeFn):V}_resolvePossibleFunction(V){return zn(V,[this])}_putElementInTemplate(V,U){if(this._config.html){U.innerHTML="",U.append(V);return}U.textContent=V.textContent}},Vk="tooltip",gk=new Set(["sanitize","allowList","sanitizeFn"]),yp="fade",uk="modal",am="show",Rk=".tooltip-inner",MI=".".concat(uk),CI="hide.bs.modal",Ur="hover",Bp="focus",Gk="click",Fk="manual",Ik="hide",Uk="hidden",xk="show",Nk="shown",Yk="inserted",Xk="click",Jk="focusin",yk="focusout",Bk="mouseenter",Mk="mouseleave",Ck={AUTO:"auto",TOP:"top",RIGHT:ca()?"left":"right",BOTTOM:"bottom",LEFT:ca()?"right":"left"},Tk={allowList:bU,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},kk={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"},is=class x extends On{constructor(V,U){if(typeof tm>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(V,U),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Tk}static get DefaultType(){return kk}static get NAME(){return Vk}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Jt.off(this._element.closest(MI),CI,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;let V=Jt.trigger(this._element,this.constructor.eventName(xk)),M=(AI(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(V.defaultPrevented||!M)return;this._disposePopper();let w=this._getTipElement();this._element.setAttribute("aria-describedby",w.getAttribute("id"));let{container:j}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(j.append(w),Jt.trigger(this._element,this.constructor.eventName(Yk))),this._popper=this._createPopper(w),w.classList.add(am),"ontouchstart"in document.documentElement)for(let bt of[].concat(...document.body.children))Jt.on(bt,"mouseover",rm);let T=()=>{Jt.trigger(this._element,this.constructor.eventName(Nk)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(T,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Jt.trigger(this._element,this.constructor.eventName(Ik)).defaultPrevented)return;if(this._getTipElement().classList.remove(am),"ontouchstart"in document.documentElement)for(let w of[].concat(...document.body.children))Jt.off(w,"mouseover",rm);this._activeTrigger[Gk]=!1,this._activeTrigger[Bp]=!1,this._activeTrigger[Ur]=!1,this._isHovered=null;let M=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Jt.trigger(this._element,this.constructor.eventName(Uk)))};this._queueCallback(M,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(V){let U=this._getTemplateFactory(V).toHtml();if(!U)return null;U.classList.remove(yp,am),U.classList.add("bs-".concat(this.constructor.NAME,"-auto"));let M=FM(this.constructor.NAME).toString();return U.setAttribute("id",M),this._isAnimated()&&U.classList.add(yp),U}setContent(V){this._newContent=V,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(V){return this._templateFactory?this._templateFactory.changeContent(V):this._templateFactory=new zp({...this._config,content:V,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[Rk]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(V){return this.constructor.getOrCreateInstance(V.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(yp)}_isShown(){return this.tip&&this.tip.classList.contains(am)}_createPopper(V){let U=zn(this._config.placement,[this,V,this._element]),M=Ck[U.toUpperCase()];return Fr(this._element,V,this._getPopperConfig(M))}_getOffset(){let{offset:V}=this._config;return typeof V=="string"?V.split(",").map(U=>Number.parseInt(U,10)):typeof V=="function"?U=>V(U,this._element):V}_resolvePossibleFunction(V){return zn(V,[this._element])}_getPopperConfig(V){let U={placement:V,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:".".concat(this.constructor.NAME,"-arrow")}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:M=>{this._getTipElement().setAttribute("data-popper-placement",M.state.placement)}}]};return{...U,...zn(this._config.popperConfig,[U])}}_setListeners(){let V=this._config.trigger.split(" ");for(let U of V)if(U==="click")Jt.on(this._element,this.constructor.eventName(Xk),this._config.selector,M=>{this._initializeOnDelegatedTarget(M).toggle()});else if(U!==Fk){let M=U===Ur?this.constructor.eventName(Bk):this.constructor.eventName(Jk),w=U===Ur?this.constructor.eventName(Mk):this.constructor.eventName(yk);Jt.on(this._element,M,this._config.selector,j=>{let T=this._initializeOnDelegatedTarget(j);T._activeTrigger[j.type==="focusin"?Bp:Ur]=!0,T._enter()}),Jt.on(this._element,w,this._config.selector,j=>{let T=this._initializeOnDelegatedTarget(j);T._activeTrigger[j.type==="focusout"?Bp:Ur]=T._element.contains(j.relatedTarget),T._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Jt.on(this._element.closest(MI),CI,this._hideModalHandler)}_fixTitle(){let V=this._element.getAttribute("title");V&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",V),this._element.setAttribute("data-bs-original-title",V),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(V,U){clearTimeout(this._timeout),this._timeout=setTimeout(V,U)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(V){let U=Zl.getDataAttributes(this._element);for(let M of Object.keys(U))gk.has(M)&&delete U[M];return V={...U,...typeof V=="object"&&V?V:{}},V=this._mergeConfigObj(V),V=this._configAfterMerge(V),this._typeCheckConfig(V),V}_configAfterMerge(V){return V.container=V.container===!1?document.body:$l(V.container),typeof V.delay=="number"&&(V.delay={show:V.delay,hide:V.delay}),typeof V.title=="number"&&(V.title=V.title.toString()),typeof V.content=="number"&&(V.content=V.content.toString()),V}_getDelegateConfig(){let V={};for(let[U,M]of Object.entries(this._config))this.constructor.Default[U]!==M&&(V[U]=M);return V.selector=!1,V.trigger="manual",V}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(typeof U[V]>"u")throw new TypeError('No method named "'.concat(V,'"'));U[V]()}})}};ma(is);var Sk="popover",Qk=".popover-header",vk=".popover-body",fk={...is.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},zk={...is.DefaultType,content:"(null|string|element|function)"},Lp=class x extends is{static get Default(){return fk}static get DefaultType(){return zk}static get NAME(){return Sk}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Qk]:this._getTitle(),[vk]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(typeof U[V]>"u")throw new TypeError('No method named "'.concat(V,'"'));U[V]()}})}};ma(Lp);var Lk="scrollspy",Ek="bs.scrollspy",jp=".".concat(Ek),Ak=".data-api",wk="activate".concat(jp),TI="click".concat(jp),jk="load".concat(jp).concat(Ak),Hk="dropdown-item",Pd="active",Ok='[data-bs-spy="scroll"]',Mp="[href]",Dk=".nav, .list-group",kI=".nav-link",_k=".nav-item",Kk=".list-group-item",Pk="".concat(kI,", ").concat(_k," > ").concat(kI,", ").concat(Kk),qk=".dropdown",$k=".dropdown-toggle",tS={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},eS={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"},Vm=class x extends On{constructor(V,U){super(V,U),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return tS}static get DefaultType(){return eS}static get NAME(){return Lk}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(let V of this._observableSections.values())this._observer.observe(V)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(V){return V.target=$l(V.target)||document.body,V.rootMargin=V.offset?"".concat(V.offset,"px 0px -30%"):V.rootMargin,typeof V.threshold=="string"&&(V.threshold=V.threshold.split(",").map(U=>Number.parseFloat(U))),V}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Jt.off(this._config.target,TI),Jt.on(this._config.target,TI,Mp,V=>{let U=this._observableSections.get(V.target.hash);if(U){V.preventDefault();let M=this._rootElement||window,w=U.offsetTop-this._element.offsetTop;if(M.scrollTo){M.scrollTo({top:w,behavior:"smooth"});return}M.scrollTop=w}}))}_getNewObserver(){let V={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(U=>this._observerCallback(U),V)}_observerCallback(V){let U=T=>this._targetLinks.get("#".concat(T.target.id)),M=T=>{this._previousScrollData.visibleEntryTop=T.target.offsetTop,this._process(U(T))},w=(this._rootElement||document.documentElement).scrollTop,j=w>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=w;for(let T of V){if(!T.isIntersecting){this._activeTarget=null,this._clearActiveClass(U(T));continue}let bt=T.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(j&&bt){if(M(T),!w)return;continue}!j&&!bt&&M(T)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;let V=Ze.find(Mp,this._config.target);for(let U of V){if(!U.hash||to(U))continue;let M=Ze.findOne(decodeURI(U.hash),this._element);ns(M)&&(this._targetLinks.set(decodeURI(U.hash),U),this._observableSections.set(U.hash,M))}}_process(V){this._activeTarget!==V&&(this._clearActiveClass(this._config.target),this._activeTarget=V,V.classList.add(Pd),this._activateParents(V),Jt.trigger(this._element,wk,{relatedTarget:V}))}_activateParents(V){if(V.classList.contains(Hk)){Ze.findOne($k,V.closest(qk)).classList.add(Pd);return}for(let U of Ze.parents(V,Dk))for(let M of Ze.prev(U,Pk))M.classList.add(Pd)}_clearActiveClass(V){V.classList.remove(Pd);let U=Ze.find("".concat(Mp,".").concat(Pd),V);for(let M of U)M.classList.remove(Pd)}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(U[V]===void 0||V.startsWith("_")||V==="constructor")throw new TypeError('No method named "'.concat(V,'"'));U[V]()}})}};Jt.on(window,jk,()=>{for(let x of Ze.find(Ok))Vm.getOrCreateInstance(x)});ma(Vm);var iS="tab",nS="bs.tab",Ho=".".concat(nS),aS="hide".concat(Ho),lS="hidden".concat(Ho),oS="show".concat(Ho),dS="shown".concat(Ho),sS="click".concat(Ho),rS="keydown".concat(Ho),cS="load".concat(Ho),bS="ArrowLeft",SI="ArrowRight",mS="ArrowUp",QI="ArrowDown",Cp="Home",vI="End",Ao="active",fI="fade",Tp="show",hS="dropdown",mU=".dropdown-toggle",WS=".dropdown-menu",kp=":not(".concat(mU,")"),pS='.list-group, .nav, [role="tablist"]',ZS=".nav-item, .list-group-item",VS=".nav-link".concat(kp,", .list-group-item").concat(kp,', [role="tab"]').concat(kp),hU='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Sp="".concat(VS,", ").concat(hU),gS=".".concat(Ao,'[data-bs-toggle="tab"], .').concat(Ao,'[data-bs-toggle="pill"], .').concat(Ao,'[data-bs-toggle="list"]'),Yr=class x extends On{constructor(V){super(V),this._parent=this._element.closest(pS),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Jt.on(this._element,rS,U=>this._keydown(U)))}static get NAME(){return iS}show(){let V=this._element;if(this._elemIsActive(V))return;let U=this._getActiveElem(),M=U?Jt.trigger(U,aS,{relatedTarget:V}):null;Jt.trigger(V,oS,{relatedTarget:U}).defaultPrevented||M&&M.defaultPrevented||(this._deactivate(U,V),this._activate(V,U))}_activate(V,U){if(!V)return;V.classList.add(Ao),this._activate(Ze.getElementFromSelector(V));let M=()=>{if(V.getAttribute("role")!=="tab"){V.classList.add(Tp);return}V.removeAttribute("tabindex"),V.setAttribute("aria-selected",!0),this._toggleDropDown(V,!0),Jt.trigger(V,dS,{relatedTarget:U})};this._queueCallback(M,V,V.classList.contains(fI))}_deactivate(V,U){if(!V)return;V.classList.remove(Ao),V.blur(),this._deactivate(Ze.getElementFromSelector(V));let M=()=>{if(V.getAttribute("role")!=="tab"){V.classList.remove(Tp);return}V.setAttribute("aria-selected",!1),V.setAttribute("tabindex","-1"),this._toggleDropDown(V,!1),Jt.trigger(V,lS,{relatedTarget:U})};this._queueCallback(M,V,V.classList.contains(fI))}_keydown(V){if(![bS,SI,mS,QI,Cp,vI].includes(V.key))return;V.stopPropagation(),V.preventDefault();let U=this._getChildren().filter(w=>!to(w)),M;if([Cp,vI].includes(V.key))M=U[V.key===Cp?0:U.length-1];else{let w=[SI,QI].includes(V.key);M=Ep(U,V.target,w,!0)}M&&(M.focus({preventScroll:!0}),x.getOrCreateInstance(M).show())}_getChildren(){return Ze.find(Sp,this._parent)}_getActiveElem(){return this._getChildren().find(V=>this._elemIsActive(V))||null}_setInitialAttributes(V,U){this._setAttributeIfNotExists(V,"role","tablist");for(let M of U)this._setInitialAttributesOnChild(M)}_setInitialAttributesOnChild(V){V=this._getInnerElement(V);let U=this._elemIsActive(V),M=this._getOuterElement(V);V.setAttribute("aria-selected",U),M!==V&&this._setAttributeIfNotExists(M,"role","presentation"),U||V.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(V,"role","tab"),this._setInitialAttributesOnTargetPanel(V)}_setInitialAttributesOnTargetPanel(V){let U=Ze.getElementFromSelector(V);U&&(this._setAttributeIfNotExists(U,"role","tabpanel"),V.id&&this._setAttributeIfNotExists(U,"aria-labelledby","".concat(V.id)))}_toggleDropDown(V,U){let M=this._getOuterElement(V);if(!M.classList.contains(hS))return;let w=(j,T)=>{let bt=Ze.findOne(j,M);bt&&bt.classList.toggle(T,U)};w(mU,Ao),w(WS,Tp),M.setAttribute("aria-expanded",U)}_setAttributeIfNotExists(V,U,M){V.hasAttribute(U)||V.setAttribute(U,M)}_elemIsActive(V){return V.classList.contains(Ao)}_getInnerElement(V){return V.matches(Sp)?V:Ze.findOne(Sp,V)}_getOuterElement(V){return V.closest(ZS)||V}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this);if(typeof V=="string"){if(U[V]===void 0||V.startsWith("_")||V==="constructor")throw new TypeError('No method named "'.concat(V,'"'));U[V]()}})}};Jt.on(document,sS,hU,function(x){["A","AREA"].includes(this.tagName)&&x.preventDefault(),!to(this)&&Yr.getOrCreateInstance(this).show()});Jt.on(window,cS,()=>{for(let x of Ze.find(gS))Yr.getOrCreateInstance(x)});ma(Yr);var uS="toast",RS="bs.toast",ao=".".concat(RS),GS="mouseover".concat(ao),FS="mouseout".concat(ao),IS="focusin".concat(ao),US="focusout".concat(ao),xS="hide".concat(ao),NS="hidden".concat(ao),YS="show".concat(ao),XS="shown".concat(ao),JS="fade",zI="hide",lm="show",om="showing",yS={animation:"boolean",autohide:"boolean",delay:"number"},BS={animation:!0,autohide:!0,delay:5e3},gm=class x extends On{constructor(V,U){super(V,U),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return BS}static get DefaultType(){return yS}static get NAME(){return uS}show(){if(Jt.trigger(this._element,YS).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(JS);let U=()=>{this._element.classList.remove(om),Jt.trigger(this._element,XS),this._maybeScheduleHide()};this._element.classList.remove(zI),Xr(this._element),this._element.classList.add(lm,om),this._queueCallback(U,this._element,this._config.animation)}hide(){if(!this.isShown()||Jt.trigger(this._element,xS).defaultPrevented)return;let U=()=>{this._element.classList.add(zI),this._element.classList.remove(om,lm),Jt.trigger(this._element,NS)};this._element.classList.add(om),this._queueCallback(U,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(lm),super.dispose()}isShown(){return this._element.classList.contains(lm)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(V,U){switch(V.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=U;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=U;break}}if(U){this._clearTimeout();return}let M=V.relatedTarget;this._element===M||this._element.contains(M)||this._maybeScheduleHide()}_setListeners(){Jt.on(this._element,GS,V=>this._onInteraction(V,!0)),Jt.on(this._element,FS,V=>this._onInteraction(V,!1)),Jt.on(this._element,IS,V=>this._onInteraction(V,!0)),Jt.on(this._element,US,V=>this._onInteraction(V,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(V){return this.each(function(){let U=x.getOrCreateInstance(this,V);if(typeof V=="string"){if(typeof U[V]>"u")throw new TypeError('No method named "'.concat(V,'"'));U[V](this)}})}};um(gm);ma(gm);var Rm=OB(pU());Rm.default.accessToken="pk.eyJ1IjoidXJzY2hyZWkiLCJhIjoiY2xzMzd6NzdnMHMxejJzbWszbHA2ZGk1ZCJ9.ovSNXA6ytYytX8zlex81iA";var RU=["base","middle","top"],Br=["ed","lea"];function ZU(x){let V=x.features[0].layer.id,U="cso-".concat(Br[1],"-polygons"),M=V===U?{county:"".concat(x.features[0].properties.COUNTY),title:"Name: ".concat(x.features[0].properties.CSO_LEA),id:"LEA ID: ".concat(x.features[0].properties.LEA_ID)}:{county:"".concat(x.features[0].properties.COUNTY_ENGLISH),title:"Name: ".concat(x.features[0].properties.ED_ENGLISH),id:"ED ID: ".concat(x.features[0].properties.ED_ID_STR)},w=x.lngLat;for(;Math.abs(x.lngLat.lng-w[0])>180;)w[0]+=x.lngLat.lng>w[0]?360:-360;let j='\n    <div class="row m-1">\n        <div class="container">\n            <div class="col">\n                  <div class="card text-bg-dark">\n                        <div class="card-body">\n                        <h5 class="card-title">'.concat(M.id,'</h5>\n                        <h6 class="card-subtitle mb-2 text-muted">').concat(M.county,'</h6>\n                              <p class="card-text">').concat(M.title,"</p>\n                        </div>\n                  </div>\n            </div>\n        </div>\n    </div>");new Rm.default.Popup().setLngLat(w).setHTML(j).addTo(Un)}function VU(x){Un.getCanvas().style.cursor="pointer"}function gU(x){Un.getCanvas().style.cursor=""}function yr(x,V){let U="cso-".concat(x,"-polygons");V?(Un.off("click",U,ZU),Un.off("mouseenter",U,VU),Un.off("mouseleave",U,gU)):(Un.on("click",U,ZU),Un.on("mouseenter",U,VU),Un.on("mouseleave",U,gU))}var Un=new Rm.default.Map({container:"map",style:"mapbox://styles/urschrei/cls285qtr00ht01qqd92g58mt",customAttribution:["Electoral boundary data provided courtesy of CSO. Some extents have been simplified"]});Un.on("load",()=>{Un.resize(),RU.forEach(x=>{Br.forEach(V=>{let U="cso-".concat(V,"-polygons-").concat(x);Un.setPaintProperty(U,"line-opacity-transition",{duration:500,delay:0})})}),yr(Br[0],!1)});function uU(x,V){RU.forEach(U=>{let M="cso-".concat(x,"-polygons-").concat(U),w="cso-".concat(V,"-polygons-").concat(U),j=U==="base"||U==="middle"?.4:1;Un.setPaintProperty(M,"line-opacity",j),Un.setPaintProperty(w,"line-opacity",0)})}function MS(x){let V=x.coords.longitude,U=x.coords.latitude;Un.flyTo({center:[V,U],zoom:14,essential:!0})}function CS(){let x=document.getElementById("locate");x.classList.add("btn-pink"),x.classList.remove("btn-outline-orange"),x.innerText="Couldn't geolocate you"}document.addEventListener("click",function(x){let V=Br[0],U=Br[1];if(x.target.id==V){let M=V,w=U;uU(M,w),yr(M,!1),yr(w,!0)}if(x.target.id==U){let M=U,w=V;uU(M,w),yr(M,!1),yr(w,!0)}x.target.id=="locate"&&navigator.geolocation.getCurrentPosition(MS,CS,{enableHighAccuracy:!0,timeout:2500})});
/*! Bundled license information:

bootstrap/dist/js/bootstrap.esm.js:
  (*!
    * Bootstrap v5.3.2 (https://getbootstrap.com/)
    * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    *)
*/
//# sourceMappingURL=index.js.map
