var OY=Object.create;var Dh=Object.defineProperty;var DY=Object.getOwnPropertyDescriptor;var _Y=Object.getOwnPropertyNames;var PY=Object.getPrototypeOf,KY=Object.prototype.hasOwnProperty;var kR=(G,g)=>()=>(G&&(g=G(G=0)),g);var Si=(G,g)=>()=>(g||G((g={exports:{}}).exports,g),g.exports),QR=(G,g)=>{for(var x in g)Dh(G,x,{get:g[x],enumerable:!0})},SR=(G,g,x,C)=>{if(g&&typeof g=="object"||typeof g=="function")for(let L of _Y(g))!KY.call(G,L)&&L!==x&&Dh(G,L,{get:()=>g[L],enumerable:!(C=DY(g,L))||C.enumerable});return G};var fR=(G,g,x)=>(x=G!=null?OY(PY(G)):{},SR(g||!G||!G.__esModule?Dh(x,"default",{value:G,enumerable:!0}):x,G)),qY=G=>SR(Dh({},"__esModule",{value:!0}),G);var oF=Si((cu,bu)=>{(function(G,g){typeof cu=="object"&&typeof bu<"u"?bu.exports=g():typeof define=="function"&&define.amd?define(g):(G=typeof globalThis<"u"?globalThis:G||self,G.mapboxgl=g())})(cu,function(){"use strict";var G,g,x;function C(o,_){if(!G)G=_;else if(!g)g=_;else{var ct="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+G+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",lt={};G(lt),x=_(lt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([ct],{type:"text/javascript"})))}}C(["exports"],function(o){"use strict";var _="3.3.0";let ct,lt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ct==null){let e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ct=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):e}catch{ct=e}}return ct},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!lt.API_URL)return null;try{let e=new URL(lt.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function Ot(e){return lt.API_URL_REGEX.test(e)}function Ut(e){return e.indexOf("mapbox:")===0}function de(e){return lt.API_CDN_URL_REGEX.test(e)}function Ze(e){return lt.API_SPRITE_REGEX.test(e)}function Fe(e){return lt.API_STYLE_REGEX.test(e)&&!Ze(e)}let qe={create:"create",load:"load",fullLoad:"fullLoad"};function Le(e){let t=e.name.split("?")[0];return de(t)&&t.includes("mapbox-gl.js")?"javascript":de(t)&&t.includes("mapbox-gl.css")?"css":function(i){return lt.API_FONTS_REGEX.test(i)}(t)?"fontRange":Ze(t)?"sprite":Fe(t)?"style":function(i){return lt.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}function Ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hi=Xi;function Xi(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=n}Xi.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,n=0;n<8;n++){var r=this.sampleCurveX(i)-e;if(Math.abs(r)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=r/s}var b=0,h=1;for(i=e,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-e)<t));n++)e>r?b=i:h=i,i=.5*(h-b)+b;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var vi=Ee(hi),Se=Zi;function Zi(e,t){this.x=e,this.y=t}Zi.prototype={clone:function(){return new Zi(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Zi.convert=function(e){return e instanceof Zi?e:Array.isArray(e)?new Zi(e[0],e[1]):e};var Nt=Ee(Se);let Yi=Math.PI/180,Pi=180/Math.PI;function ye(e){return e*Yi}function Bi(e){return e*Pi}let Ya=[[0,0],[1,0],[1,1],[0,1]];function Kt(e){if(e<=0)return 0;if(e>=1)return 1;let t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function la(e,t,i,n){let r=new vi(e,t,i,n);return function(s){return r.solve(s)}}let ua=la(.25,.1,.25,1);function ke(e,t,i){return Math.min(i,Math.max(t,e))}function Ba(e,t,i){return(i=ke((i-e)/(t-e),0,1))*i*(3-2*i)}function Ma(e,t,i){let n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function ln(e,t,i){if(!e.length)return i(null,[]);let n=e.length,r=new Array(e.length),s=null;e.forEach((b,h)=>{t(b,(W,u)=>{W&&(s=W),r[h]=u,--n==0&&i(s,r)})})}function ma(e,...t){for(let i of t)for(let n in i)e[n]=i[n];return e}let Ln=1;function ul(){return Ln++}function $n(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Zl(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function zn(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function on(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function mn(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Ra(e,t,i){let n={};for(let r in e)n[r]=t.call(i||this,e[r],r,e);return n}function Ca(e,t,i){let n={};for(let r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function tn(e){return Array.isArray(e)?e.map(tn):typeof e=="object"&&e?Ra(e,tn):e}let tr={};function ji(e){tr[e]||(typeof console<"u"&&console.warn(e),tr[e]=!0)}function Vn(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function gl(e){let t=0;for(let i,n,r=0,s=e.length,b=s-1;r<s;b=r++)i=e[r],n=e[b],t+=(n.x-i.x)*(i.y+n.y);return t}function tl([e,t,i]){let n=ye(t+90),r=ye(i);return{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r),azimuthal:t,polar:i}}function wn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vl(e){let t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,r,s)=>{let b=r||s;return t[n]=!b||b.toLowerCase(),""}),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let sa,Pl,Kl,Ta,Rn,el,Mt=null;function j(e){try{let t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function tt(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function st(e,t,i,n){for(;t<i;){let r=t+i>>1;e[r]<n?t=r+1:i=r}return t}function Yt(e,t,i,n){for(;t<i;){let r=t+i>>1;e[r]<=n?t=r+1:i=r}return t}function Tt(){return sa==null&&(sa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sa}let zt={now:()=>Ta!==void 0?Ta:performance.now(),setNow(e){Ta=e},restoreNow(){Ta=void 0},frame(e){let t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e,t=0){let{width:i,height:n}=e;Rn||(Rn=document.createElement("canvas"));let r=Rn.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(i>Rn.width||n>Rn.height)&&(Rn.width=i,Rn.height=n),r.clearRect(-t,-t,i+2*t,n+2*t),r.drawImage(e,0,0,i,n),r.getImageData(-t,-t,i+2*t,n+2*t)},resolveURL:e=>(Pl||(Pl=document.createElement("a")),Pl.href=e,Pl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Kl==null&&(Kl=window.matchMedia("(prefers-reduced-motion: reduce)")),Kl.matches)},hasCanvasFingerprintNoise(){if(el!==void 0)return el;if(!Tt())return el=!1,!1;let e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0}),i=0;for(let r=0;r<e.width;++r)t.fillStyle="rgba(".concat(i++,",").concat(i++,",").concat(i++,", 255)"),t.fillRect(r,0,1,1);let n=t.getImageData(0,0,e.width,e.height);i=0;for(let r=0;r<n.data.length;++r)if(r%4!=3&&i++!==n.data[r])return el=!0,!0;return el=!1,!1}},he="mapbox-tiles",Jt=500,We=50,re,ge;function _e(){try{return caches}catch{}}function Mi(){let e=_e();e&&!re&&(re=e.open(he))}function Oi(e){let t=e.indexOf("?");if(t<0)return e;let i=["language","worldview"],n=new URLSearchParams,r=new URLSearchParams(e.slice(t));for(let s of i){let b=r.get(s);b&&n.set(s,b)}return"".concat(e.slice(0,t),"?").concat(n.toString())}function Ci(e,t){let i=e.indexOf("?");if(i<0)return"".concat(e,"?").concat(new URLSearchParams(t).toString());let n=new URLSearchParams(e.slice(i));for(let r in t)n.set(r,t[r]);return"".concat(e.slice(0,i),"?").concat(n.toString())}let xi=1/0,Gi={supported:!1,testSupport:function(e){!ka&&wi&&(Hi?rn(e):Ji=e)}},Ji,wi,ka=!1,Hi=!1,hn=typeof self<"u"?self:{};function rn(e){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,wi),e.isContextLost())return;Gi.supported=!0}catch{}e.deleteTexture(t),ka=!0}hn.document&&(wi=hn.document.createElement("img"),wi.onload=function(){Ji&&rn(Ji),Ji=null,Hi=!0},wi.onerror=function(){ka=!0,Ji=null},wi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Gn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Gn);class Ga extends Error{constructor(t,i,n){i===401&&Ot(n)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=n}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}let Za=wn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Xt=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(Za())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(n,r){let s=new AbortController,b=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Za(),referrerPolicy:n.referrerPolicy,signal:s.signal}),h=!1,W=!1,u=(V=b.url).indexOf("sku=")>0&&Ot(V);var V;n.type==="json"&&b.headers.set("Accept","application/json");let F=(X,y,B)=>{if(W)return;if(X&&X.message!=="SecurityError"&&ji(X.toString()),y&&B)return U(y);let k=Date.now();fetch(b).then(S=>{if(S.ok){let A=u?S.clone():null;return U(S,A,k)}return r(new Ga(S.statusText,S.status,n.url))}).catch(S=>{S.name!=="AbortError"&&r(new Error("".concat(S.message," ").concat(n.url)))})},U=(X,y,B)=>{(n.type==="arrayBuffer"?X.arrayBuffer():n.type==="json"?X.json():X.text()).then(k=>{W||(y&&B&&function(S,A,D){if(Mi(),!re)return;let O=Vl(A.headers.get("Cache-Control")||"");if(O["no-store"])return;let et={status:A.status,statusText:A.statusText,headers:new Headers};A.headers.forEach((dt,ht)=>et.headers.set(ht,dt)),O["max-age"]&&et.headers.set("Expires",new Date(D+1e3*O["max-age"]).toUTCString());let $=et.headers.get("Expires");if(!$||new Date($).getTime()-D<42e4)return;let nt=Oi(S.url);if(A.status===206){let dt=S.headers.get("Range");if(!dt)return;et.status=200,nt=Ci(nt,{range:dt})}(function(dt,ht){if(ge===void 0)try{new Response(new ReadableStream),ge=!0}catch{ge=!1}ge?ht(dt.body):dt.blob().then(ht)})(A,dt=>{let ht=new Response(dt,et);Mi(),re&&re.then(gt=>gt.put(nt,ht)).catch(gt=>ji(gt.message))})}(b,y,B),h=!0,r(null,k,X.headers.get("Cache-Control"),X.headers.get("Expires")))}).catch(k=>{W||r(new Error(k.message))})};return u?function(X,y){if(Mi(),!re)return y(null);re.then(B=>{let k=Oi(X.url),S=X.headers.get("Range");S&&(k=Ci(k,{range:S})),B.match(k).then(A=>{let D=function(O){if(!O)return!1;let et=new Date(O.headers.get("Expires")||0),$=Vl(O.headers.get("Cache-Control")||"");return et>Date.now()&&!$["no-cache"]}(A);B.delete(k),D&&B.put(k,A.clone()),y(null,A,D)}).catch(y)}).catch(y)}(b,F):F(null,null),{cancel:()=>{W=!0,h||s.abort()}}}(e,t);if(wn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(n,r){let s=new XMLHttpRequest;s.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(s.responseType="arraybuffer");for(let b in n.headers)s.setRequestHeader(b,n.headers[b]);return n.type==="json"&&(s.responseType="text",s.setRequestHeader("Accept","application/json")),s.withCredentials=n.credentials==="include",s.onerror=()=>{r(new Error(s.statusText))},s.onload=()=>{if((s.status>=200&&s.status<300||s.status===0)&&s.response!==null){let b=s.response;if(n.type==="json")try{b=JSON.parse(s.response)}catch(h){return r(h)}r(null,b,s.getResponseHeader("Cache-Control"),s.getResponseHeader("Expires"))}else r(new Ga(s.statusText,s.status,n.url))},s.send(n.body),{cancel:()=>s.abort()}}(e,t)},yt=function(e,t){return Xt(ma(e,{type:"arrayBuffer"}),t)};function wt(e){let t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}let Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ht,te;Ht=[],te=0;let ee=function(e,t){if(Gi.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),te>=lt.MAX_PARALLEL_IMAGE_REQUESTS){let s={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Ht.push(s),s}te++;let i=!1,n=()=>{if(!i)for(i=!0,te--;Ht.length&&te<lt.MAX_PARALLEL_IMAGE_REQUESTS;){let s=Ht.shift(),{requestParameters:b,callback:h,cancelled:W}=s;W||(s.cancel=ee(b,h).cancel)}},r=yt(e,(s,b,h,W)=>{n(),s?t(s):b&&(self.createImageBitmap?function(u,V){let F=new Blob([new Uint8Array(u)],{type:"image/png"});createImageBitmap(F).then(U=>{V(null,U)}).catch(U=>{V(new Error("Could not load image because of ".concat(U.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(b,(u,V)=>t(u,V,h,W)):function(u,V){let F=new Image;F.onload=()=>{V(null,F),URL.revokeObjectURL(F.src),F.onload=null,requestAnimationFrame(()=>{F.src=Pt})},F.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let U=new Blob([new Uint8Array(u)],{type:"image/png"});F.src=u.byteLength?URL.createObjectURL(U):Pt}(b,(u,V)=>t(u,V,h,W)))});return{cancel:()=>{r.cancel(),n()}}},Dt="01",ae="NO_ACCESS_TOKEN",qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Be(e){let t=e.match(qt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ni(e){let t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}let Ge="mapbox.eventData";function Ti(e){if(!e)return null;let t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ki{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let i=Ti(lt.ACCESS_TOKEN),n="";return n=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(r,s)=>String.fromCharCode(+("0x"+s)))):lt.ACCESS_TOKEN||"",t?"".concat(Ge,".").concat(t,":").concat(n):"".concat(Ge,":").concat(n)}fetchEventData(){let t=j("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{let r=localStorage.getItem(i);r&&(this.eventData=JSON.parse(r));let s=localStorage.getItem(n);s&&(this.anonId=s)}catch{ji("Unable to read from LocalStorage")}}saveEventData(){let t=j("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid"),r=this.anonId;if(t&&r)try{localStorage.setItem(n,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ji("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,n,r){if(!lt.EVENTS_URL)return;let s=Be(lt.EVENTS_URL);s.params.push("access_token=".concat(r||lt.ACCESS_TOKEN||""));let b={event:this.type,created:new Date(t).toISOString()},h=i?ma(b,i):b,W={url:ni(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([h])};this.pendingRequest=function(u,V){return Xt(ma(u,{method:"POST"}),V)}(W,u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(r)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}let Li=new class extends Ki{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){lt.EVENTS_URL&&lt.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>Ut(i)||Ot(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=Ti(lt.ACCESS_TOKEN),i=t?t.u:lt.ACCESS_TOKEN,n=i!==this.eventData.tokenU;zn(this.anonId)||(this.anonId=$n(),n=!0);let r=this.queue.shift();if(this.eventData.lastSuccess){let s=new Date(this.eventData.lastSuccess),b=new Date(r),h=(r-this.eventData.lastSuccess)/864e5;n=n||h>=1||h<-1||s.getDate()!==b.getDate()}else n=!0;n?this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Dt,"enabled.telemetry":!1,userId:this.anonId},s=>{s||(this.eventData.lastSuccess=r,this.eventData.tokenU=i)},e):this.processRequests()}},Fa=Li.postTurnstileEvent.bind(Li),Oa=new class extends Ki{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,lt.EVENTS_URL&&(i||lt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(ae)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),zn(this.anonId)||(this.anonId=$n()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:_,skuId:Dt,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):t&&(this.success[t]=!0)},e))}remove(){this.errorCb=null}},Vi=Oa.postMapLoadEvent.bind(Oa),Mn=new class extends Ki{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){lt.EVENTS_URL&&(e||lt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:i}=this.queue.shift(),n=function(r){let s=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),h=function(X){let y={};if(X){for(let B in X)if(B!=="other")for(let k of X[B]){let S="".concat(B,"ResolveRangeMin"),A="".concat(B,"ResolveRangeMax"),D="".concat(B,"RequestCount"),O="".concat(B,"RequestCachedCount");y[S]=Math.min(y[S]||1/0,k.startTime),y[A]=Math.max(y[A]||-1/0,k.responseEnd);let et=$=>{y[$]===void 0&&(y[$]=0),++y[$]};k.transferSize!==void 0&&k.transferSize===0&&et(O),et(D)}}return y}(function(X,y){let B={};if(X)for(let k of X){let S=y(k);B[S]===void 0&&(B[S]=[]),B[S].push(k)}return B}(s,Le)),W=window.devicePixelRatio,u=navigator.connection||navigator.mozConnection||navigator.webkitConnection,V=u?u.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},U=(X,y,B)=>{B!=null&&X.push({name:y,value:B.toString()})};for(let X in h)U(F.counters,X,h[X]);if(r.interactionRange[0]!==1/0&&r.interactionRange[1]!==-1/0&&(U(F.counters,"interactionRangeMin",r.interactionRange[0]),U(F.counters,"interactionRangeMax",r.interactionRange[1])),b)for(let X of Object.keys(qe)){let y=qe[X],B=b.find(k=>k.name===y);B&&U(F.counters,y,B.startTime)}return U(F.counters,"visibilityHidden",r.visibilityHidden),U(F.attributes,"style",function(X){if(X)for(let y of X){let B=y.name.split("?")[0];if(Fe(B)){let k=B.split("/").slice(-2);if(k.length===2)return"mapbox://styles/".concat(k[0],"/").concat(k[1])}}}(s)),U(F.attributes,"terrainEnabled",r.terrainEnabled?"true":"false"),U(F.attributes,"fogEnabled",r.fogEnabled?"true":"false"),U(F.attributes,"projection",r.projection),U(F.attributes,"zoom",r.zoom),U(F.metadata,"devicePixelRatio",W),U(F.metadata,"connectionEffectiveType",V),U(F.metadata,"navigatorUserAgent",navigator.userAgent),U(F.metadata,"screenWidth",window.screen.width),U(F.metadata,"screenHeight",window.screen.height),U(F.metadata,"windowWidth",window.innerWidth),U(F.metadata,"windowHeight",window.innerHeight),U(F.metadata,"mapWidth",r.width/W),U(F.metadata,"mapHeight",r.height/W),U(F.metadata,"webglRenderer",r.renderer),U(F.metadata,"webglVendor",r.vendor),U(F.metadata,"sdkVersion",_),U(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(i);for(let r of n.metadata);for(let r of n.counters);for(let r of n.attributes);this.postEvent(t,n,()=>{},e)}},il=Mn.postPerformanceEvent.bind(Mn),Da=new class extends Ki{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!lt.API_URL||!lt.SESSION_PATH)return;let r=Be(lt.API_URL+lt.SESSION_PATH);r.params.push("sku=".concat(t||"")),r.params.push("access_token=".concat(n||lt.ACCESS_TOKEN||""));let s={url:ni(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(b,h){return Xt(ma(b,{method:"GET"}),h)}(s,b=>{this.pendingRequest=null,i(b),this.saveEventData(),this.processRequests(n)})}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,lt.SESSION_PATH&&lt.API_URL&&(i||lt.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(ae)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,n=>{n?this.errorCb(n):t&&(this.success[t]=!0)},e)}remove(){this.errorCb=null}},qr=Da.getSessionAPI.bind(Da),ql=new Set;function er(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function Tc(e,t,i){if(i&&i[e]){let n=i[e].indexOf(t);n!==-1&&i[e].splice(n,1)}}class xo{constructor(t,i={}){ma(this,i),this.type=t}}class kc extends xo{constructor(t,i={}){super("error",ma({error:t},i))}}class ir{on(t,i){return this._listeners=this._listeners||{},er(t,i,this._listeners),this}off(t,i){return Tc(t,i,this._listeners),Tc(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},er(t,i,this._oneTimeListeners),this):new Promise(n=>this.once(t,n))}fire(t,i){typeof t=="string"&&(t=new xo(t,i||{}));let n=t.type;if(this.listens(n)){t.target=this;let r=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let h of r)h.call(this,t);let s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let h of s)Tc(n,h,this._oneTimeListeners),h.call(this,t);let b=this._eventedParent;b&&(ma(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof kc&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}o.y=void 0;var i0={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function bd(e){return(e=Math.round(e))<0?0:e>255?255:e}function Qc(e){return bd(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function md(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Sc(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{o.y={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in i0)return i0[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=i.indexOf("("),r=i.indexOf(")");if(n!==-1&&r+1===i.length){var s=i.substr(0,n),b=i.substr(n+1,r-(n+1)).split(","),h=1;switch(s){case"rgba":if(b.length!==4)return null;h=md(b.pop());case"rgb":return b.length!==3?null:[Qc(b[0]),Qc(b[1]),Qc(b[2]),h];case"hsla":if(b.length!==4)return null;h=md(b.pop());case"hsl":if(b.length!==3)return null;var W=(parseFloat(b[0])%360+360)%360/360,u=md(b[1]),V=md(b[2]),F=V<=.5?V*(u+1):V+u-V*u,U=2*V-F;return[bd(255*Sc(U,F,W+1/3)),bd(255*Sc(U,F,W)),bd(255*Sc(U,F,W-1/3)),h];default:return null}}return null}}catch{}class Fn{constructor(t,i,n,r=1){this.r=t,this.g=i,this.b=n,this.a=r}static parse(t){if(!t)return;if(t instanceof Fn)return t;if(typeof t!="string")return;let i=o.y(t);return i?new Fn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[t,i,n,r]=this.toArray();return"rgba(".concat(Math.round(t),",").concat(Math.round(i),",").concat(Math.round(n),",").concat(r,")")}toArray(){let{r:t,g:i,b:n,a:r}=this;return r===0?[0,0,0,0]:[255*t/r,255*i/r,255*n/r,r]}toArray01(){let{r:t,g:i,b:n,a:r}=this;return r===0?[0,0,0,0]:[t/r,i/r,n/r,r]}toArray01Scaled(t){let{r:i,g:n,b:r,a:s}=this;return s===0?[0,0,0]:[i/s*t,n/s*t,r/s*t]}toArray01PremultipliedAlpha(){let{r:t,g:i,b:n,a:r}=this;return[t,i,n,r]}toArray01Linear(){let{r:t,g:i,b:n,a:r}=this;return r===0?[0,0,0,0]:[Math.pow(t/r,2.2),Math.pow(i/r,2.2),Math.pow(n/r,2.2),r]}}Fn.black=new Fn(0,0,0,1),Fn.white=new Fn(1,1,1,1),Fn.transparent=new Fn(0,0,0,0),Fn.red=new Fn(1,0,0,1),Fn.blue=new Fn(0,0,1,1);var ga=Fn;function li(e,t,i){return e*(1-i)+t*i}function a0(e,t,i){return e.map((n,r)=>li(n,t[r],i))}var hd=Object.freeze({__proto__:null,array:a0,color:function(e,t,i){return new ga(li(e.r,t.r,i),li(e.g,t.g,i),li(e.b,t.b,i),li(e.a,t.a,i))},number:li});function fc(e,...t){for(let i of t)for(let n in i)e[n]=i[n];return e}class Tp extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var Rl=Tp;class vc{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[n,r]of i)this.bindings[n]=r}concat(t){return new vc(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error("".concat(t," not found in scope."))}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var kp=vc;let ar={kind:"null"},le={kind:"number"},Fi={kind:"string"},Ii={kind:"boolean"},En={kind:"color"},nr={kind:"object"},ci={kind:"value"},pd={kind:"collator"},lr={kind:"formatted"},$r={kind:"resolvedImage"};function In(e,t){return{kind:"array",itemType:e,N:t}}function pa(e){if(e.kind==="array"){let t=pa(e.itemType);return typeof e.N=="number"?"array<".concat(t,", ").concat(e.N,">"):e.itemType.kind==="value"?"array":"array<".concat(t,">")}return e.kind}let Ne=[ar,le,Fi,Ii,En,lr,nr,In(ci),$r];function No(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!No(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(let i of Ne)if(!No(i,t))return null}}return"Expected ".concat(pa(e)," but found ").concat(pa(t)," instead.")}function Ce(e,t){return t.some(i=>i.kind===e.kind)}function $l(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}class Pe{constructor(t,i,n){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class or{constructor(t,i,n,r,s){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=n,this.fontStack=r,this.textColor=s}}class _a{constructor(t){this.sections=t}static fromString(t){return new _a([new or(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof _a?t:_a.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){let t=["format"];for(let i of this.sections){if(i.image){t.push(["image",i.image.namePrimary]);continue}t.push(i.text);let n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(n)}return t}}class Ye{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?"[".concat(this.namePrimary,",").concat(this.nameSecondary,"]"):this.namePrimary}static fromString(t,i){return t?new Ye({namePrimary:t,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function n0(e,t,i,n){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:"Invalid rgba value [".concat([e,t,i,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat((typeof n=="number"?[e,t,i,n]:[e,t,i]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Yo(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof ga||e instanceof Pe||e instanceof _a||e instanceof Ye)return!0;if(Array.isArray(e)){for(let t of e)if(!Yo(t))return!1;return!0}if(typeof e=="object"){for(let t in e)if(!Yo(e[t]))return!1;return!0}return!1}function Ia(e){if(e===null)return ar;if(typeof e=="string")return Fi;if(typeof e=="boolean")return Ii;if(typeof e=="number")return le;if(e instanceof ga)return En;if(e instanceof Pe)return pd;if(e instanceof _a)return lr;if(e instanceof Ye)return $r;if(Array.isArray(e)){let t=e.length,i;for(let n of e){let r=Ia(n);if(i){if(i===r)continue;i=ci;break}i=r}return In(i||ci,t)}return nr}function An(e){let t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof ga||e instanceof _a||e instanceof Ye?e.toString():JSON.stringify(e)}class to{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!Yo(t[1]))return i.error("invalid value");let n=t[1],r=Ia(n),s=i.expectedType;return r.kind!=="array"||r.N!==0||!s||s.kind!=="array"||typeof s.N=="number"&&s.N!==0||(r=s),new to(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ga?["rgba"].concat(this.value.toArray()):this.value instanceof _a?this.value.serialize():this.value}}var Bl=to,Ua=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};let Lc={string:Fi,number:le,boolean:Ii,object:nr};class zc{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n,r=1,s=t[0];if(s==="array"){let h,W;if(t.length>2){let u=t[1];if(typeof u!="string"||!(u in Lc)||u==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);h=Lc[u],r++}else h=ci;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);W=t[2],r++}n=In(h,W)}else n=Lc[s];let b=[];for(;r<t.length;r++){let h=i.parse(t[r],r,ci);if(!h)return null;b.push(h)}return new zc(n,b)}evaluate(t){for(let i=0;i<this.args.length;i++){let n=this.args[i].evaluate(t);if(!No(this.type,Ia(n)))return n;if(i===this.args.length-1)throw new Ua("Expected value to be of type ".concat(pa(this.type),", but found ").concat(pa(Ia(n))," instead."))}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=this.type,i=[t.kind];if(t.kind==="array"){let n=t.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){i.push(n.kind);let r=t.N;(typeof r=="number"||this.args.length>1)&&i.push(r)}}return i.concat(this.args.map(n=>n.serialize()))}}var Ml=zc;class rr{constructor(t){this.type=lr,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=t[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");let r=[],s=!1;for(let b=1;b<=t.length-1;++b){let h=t[b];if(s&&typeof h=="object"&&!Array.isArray(h)){s=!1;let W=null;if(h["font-scale"]&&(W=i.parse(h["font-scale"],1,le),!W))return null;let u=null;if(h["text-font"]&&(u=i.parse(h["text-font"],1,In(Fi)),!u))return null;let V=null;if(h["text-color"]&&(V=i.parse(h["text-color"],1,En),!V))return null;let F=r[r.length-1];F.scale=W,F.font=u,F.textColor=V}else{let W=i.parse(t[b],1,ci);if(!W)return null;let u=W.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,r.push({content:W,scale:null,font:null,textColor:null})}}return new rr(r)}evaluate(t){return new _a(this.sections.map(i=>{let n=i.content.evaluate(t);return Ia(n)===$r?new or("",n,null,null,null):new or(An(n),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){let t=["format"];for(let i of this.sections){t.push(i.content.serialize());let n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),t.push(n)}return t}}class Xo{constructor(t,i){this.type=$r,this.inputPrimary=t,this.inputSecondary=i}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");let n=i.parse(t[1],1,Fi);if(!n)return i.error("No image name provided.");if(t.length===2)return new Xo(n);let r=i.parse(t[2],1,Fi);return r?new Xo(n,r):i.error("Secondary image variant is not a string.")}evaluate(t){let i=Ye.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&t.availableImages&&(i.available=t.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function sr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}let al={"to-boolean":Ii,"to-color":En,"to-number":le,"to-string":Fi};class Wd{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let n=t[0],r=[],s=ar;if(n==="to-array"){if(!Array.isArray(t[1]))return null;let b=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error("Expected ".concat(i.expectedType.kind," but found array."));s=In(i.expectedType.itemType,b)}else{if(!(b>0&&Yo(t[1][0])))return null;s=In(Ia(t[1][0]),b)}for(let h=0;h<b;h++){let W=t[1][h],u;if(sr(W)==="array")u=i.parse(W,void 0,s.itemType);else{let V=sr(W);if(V!==s.itemType.kind)return i.error("Expected ".concat(s.itemType.kind," but found ").concat(V,"."));u=i.registry.literal.parse(["literal",W===void 0?null:W],i)}if(!u)return null;r.push(u)}}else{if((n==="to-boolean"||n==="to-string")&&t.length!==2)return i.error("Expected one argument.");s=al[n];for(let b=1;b<t.length;b++){let h=i.parse(t[b],b,ci);if(!h)return null;r.push(h)}}return new Wd(s,r)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,n;for(let r of this.args){if(i=r.evaluate(t),n=null,i instanceof ga)return i;if(typeof i=="string"){let s=t.parseColor(i);if(s)return s}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?"Invalid rbga value ".concat(JSON.stringify(i),": expected an array containing either three or four numeric values."):n0(i[0],i[1],i[2],i[3]),!n))return new ga(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ua(n||"Could not parse color from value '".concat(typeof i=="string"?i:String(JSON.stringify(i)),"'"))}if(this.type.kind==="number"){let i=null;for(let n of this.args){if(i=n.evaluate(t),i===null)return 0;let r=Number(i);if(!isNaN(r))return r}throw new Ua("Could not convert ".concat(JSON.stringify(i)," to number."))}return this.type.kind==="formatted"?_a.fromString(An(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ye.fromString(An(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):An(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new rr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xo(this.args[0]).serialize();let t=this.type.kind==="array"?[]:["to-".concat(this.type.kind)];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Cl=Wd;let ts=["Unknown","Point","LineString","Polygon"];var l0=class{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ts[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=ga.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class Jo{constructor(t,i,n,r,s){this.name=t,this.type=i,this._evaluate=n,this.args=r,this._overloadIndex=s}evaluate(t){if(!this._evaluate){let i=Jo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){let n=t[0],r=Jo.definitions[n];if(!r)return i.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0);let s=Array.isArray(r)?r[0]:r.type,b=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,h=[],W=null,u=-1;for(let[V,F]of b){if(Array.isArray(V)&&V.length!==t.length-1)continue;h.push(V),u++,W=new m0(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let U=[],X=!1;for(let y=1;y<t.length;y++){let B=t[y],k=Array.isArray(V)?V[y-1]:V.type,S=W.parse(B,1+U.length,k);if(!S){X=!0;break}U.push(S)}if(!X)if(Array.isArray(V)&&V.length!==U.length)W.error("Expected ".concat(V.length," arguments, but found ").concat(U.length," instead."));else{for(let y=0;y<U.length;y++){let B=Array.isArray(V)?V[y]:V.type,k=U[y];W.concat(y+1).checkSubtype(B,k.type)}if(W.errors.length===0)return new Jo(n,s,F,U,u)}}if(h.length===1)i.errors.push(...W.errors);else{let V=(h.length?h:b.map(([U])=>U)).map(o0).join(" | "),F=[];for(let U=1;U<t.length;U++){let X=i.parse(t[U],1+F.length);if(!X)return null;F.push(pa(X.type))}i.error("Expected arguments of type ".concat(V,", but found (").concat(F.join(", "),") instead."))}return null}static register(t,i){Jo.definitions=i;for(let n in i)t[n]=Jo}}function o0(e){return Array.isArray(e)?"(".concat(e.map(pa).join(", "),")"):"(".concat(pa(e.type),"...)")}var ri=Jo;class es{constructor(t,i,n){this.type=pd,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let n=t[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");let r=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Ii);if(!r)return null;let s=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Ii);if(!s)return null;let b=null;return n.locale&&(b=i.parse(n.locale,1,Fi),!b)?null:new es(r,s,b)}evaluate(t){return new Pe(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){let t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var wc={exports:{}};wc.exports=function(){function e(n,r,s,b,h){for(;b>s;){if(b-s>600){var W=b-s+1,u=r-s+1,V=Math.log(W),F=.5*Math.exp(2*V/3),U=.5*Math.sqrt(V*F*(W-F)/W)*(u-W/2<0?-1:1);e(n,r,Math.max(s,Math.floor(r-u*F/W+U)),Math.min(b,Math.floor(r+(W-u)*F/W+U)),h)}var X=n[r],y=s,B=b;for(t(n,s,r),h(n[b],X)>0&&t(n,s,b);y<B;){for(t(n,y,B),y++,B--;h(n[y],X)<0;)y++;for(;h(n[B],X)>0;)B--}h(n[s],X)===0?t(n,s,B):t(n,++B,b),B<=r&&(s=B+1),r<=B&&(b=B-1)}}function t(n,r,s){var b=n[r];n[r]=n[s],n[s]=b}function i(n,r){return n<r?-1:n>r?1:0}return function(n,r,s,b,h){e(n,r,s||0,b||n.length-1,h||i)}}();var Qp=Ee(wc.exports);function Sp(e){let t=0;for(let i,n,r=0,s=e.length,b=s-1;r<s;b=r++)i=e[r],n=e[b],t+=(n.x-i.x)*(i.y+n.y);return t}function eo(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function io(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ud(e,t,i){let n=e[0]-t[0],r=e[1]-t[1],s=e[0]-i[0],b=e[1]-i[1];return n*b-s*r==0&&n*s<=0&&r*b<=0}function dr(e,t,i=!1){let n=!1;for(let h=0,W=t.length;h<W;h++){let u=t[h];for(let V=0,F=u.length,U=F-1;V<F;U=V++){let X=u[U],y=u[V];if(ud(e,X,y))return i;(s=X)[1]>(r=e)[1]!=(b=y)[1]>r[1]&&r[0]<(b[0]-s[0])*(r[1]-s[1])/(b[1]-s[1])+s[0]&&(n=!n)}}var r,s,b;return n}function Ec(e,t,i,n){let r=n[0]-i[0],s=n[1]-i[1],b=(e[0]-i[0])*s-r*(e[1]-i[1]),h=(t[0]-i[0])*s-r*(t[1]-i[1]);return b>0&&h<0||b<0&&h>0}function Tl(e,t,i,n){return(r=[n[0]-i[0],n[1]-i[1]])[0]*(s=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*s[0]!=0&&!(!Ec(e,t,i,n)||!Ec(i,n,e,t));var r,s}let ao=8192;function is(e,t){let i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(i*r*ao),Math.round(n*r*ao)]}function Ac(e,t){for(let i=0;i<t.length;i++)if(dr(e,t[i]))return!0;return!1}function Hc(e,t,i){for(let n of i)for(let r=0,s=n.length,b=s-1;r<s;b=r++)if(Tl(e,t,n[b],n[r]))return!0;return!1}function Hn(e,t){for(let i=0;i<e.length;++i)if(!dr(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Hc(e[i],e[i+1],t))return!1;return!0}function r0(e,t){for(let i=0;i<t.length;i++)if(Hn(e,t[i]))return!0;return!1}function jc(e,t,i){let n=[];for(let r=0;r<e.length;r++){let s=[];for(let b=0;b<e[r].length;b++){let h=is(e[r][b],i);eo(t,h),s.push(h)}n.push(s)}return n}function Oc(e,t,i){let n=[];for(let r=0;r<e.length;r++){let s=jc(e[r],t,i);n.push(s)}return n}function Dc(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){let r=.5*n,s=e[0]-i[0]>r?-n:i[0]-e[0]>r?n:0;s===0&&(s=e[0]-i[2]>r?-n:i[2]-e[0]>r?n:0),e[0]+=s}eo(t,e)}function _c(e,t,i,n){let r=Math.pow(2,n.z)*ao,s=[n.x*ao,n.y*ao],b=[];if(!e)return b;for(let h of e)for(let W of h){let u=[W.x+s[0],W.y+s[1]];Dc(u,t,i,r),b.push(u)}return b}function Pc(e,t,i,n){let r=Math.pow(2,n.z)*ao,s=[n.x*ao,n.y*ao],b=[];if(!e)return b;for(let W of e){let u=[];for(let V of W){let F=[V.x+s[0],V.y+s[1]];eo(t,F),u.push(F)}b.push(u)}if(t[2]-t[0]<=r/2){(h=t)[0]=h[1]=1/0,h[2]=h[3]=-1/0;for(let W of b)for(let u of W)Dc(u,t,i,r)}var h;return b}class cr{constructor(t,i){this.type=Ii,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(Yo(t[1])){let n=t[1];if(n.type==="FeatureCollection")for(let r=0;r<n.features.length;++r){let s=n.features[r].geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new cr(n,n.features[r].geometry)}else if(n.type==="Feature"){let r=n.geometry.type;if(r==="Polygon"||r==="MultiPolygon")return new cr(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new cr(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,n){let r=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],b=i.canonicalID();if(!b)return!1;if(n.type==="Polygon"){let h=jc(n.coordinates,s,b),W=_c(i.geometry(),r,s,b);if(!io(r,s))return!1;for(let u of W)if(!dr(u,h))return!1}if(n.type==="MultiPolygon"){let h=Oc(n.coordinates,s,b),W=_c(i.geometry(),r,s,b);if(!io(r,s))return!1;for(let u of W)if(!Ac(u,h))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,n){let r=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],b=i.canonicalID();if(!b)return!1;if(n.type==="Polygon"){let h=jc(n.coordinates,s,b),W=Pc(i.geometry(),r,s,b);if(!io(r,s))return!1;for(let u of W)if(!Hn(u,h))return!1}if(n.type==="MultiPolygon"){let h=Oc(n.coordinates,s,b),W=Pc(i.geometry(),r,s,b);if(!io(r,s))return!1;for(let u of W)if(!r0(u,h))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Zd=cr,as={exports:{}};as.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,i=t*(2-t),n=Math.PI/180,r=function(u,V){if(u===void 0)throw new Error("No latitude given.");if(V&&!e[V])throw new Error("Unknown unit "+V+". Use one of: "+Object.keys(e).join(", "));var F=6378.137*n*(V?e[V]:1),U=Math.cos(u*n),X=1/(1-i*(1-U*U)),y=Math.sqrt(X);this.kx=F*y*U,this.ky=F*y*X*(1-i)},s={units:{configurable:!0}};function b(u,V){return u[0]===V[0]&&u[1]===V[1]}function h(u,V,F){var U=W(V[0]-u[0]);return[u[0]+U*F,u[1]+(V[1]-u[1])*F]}function W(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}return r.fromTile=function(u,V,F){var U=Math.PI*(1-2*(u+.5)/Math.pow(2,V)),X=Math.atan(.5*(Math.exp(U)-Math.exp(-U)))/n;return new r(X,F)},s.units.get=function(){return e},r.prototype.distance=function(u,V){var F=W(u[0]-V[0])*this.kx,U=(u[1]-V[1])*this.ky;return Math.sqrt(F*F+U*U)},r.prototype.bearing=function(u,V){var F=W(V[0]-u[0])*this.kx;return Math.atan2(F,(V[1]-u[1])*this.ky)/n},r.prototype.destination=function(u,V,F){var U=F*n;return this.offset(u,Math.sin(U)*V,Math.cos(U)*V)},r.prototype.offset=function(u,V,F){return[u[0]+V/this.kx,u[1]+F/this.ky]},r.prototype.lineDistance=function(u){for(var V=0,F=0;F<u.length-1;F++)V+=this.distance(u[F],u[F+1]);return V},r.prototype.area=function(u){for(var V=0,F=0;F<u.length;F++)for(var U=u[F],X=0,y=U.length,B=y-1;X<y;B=X++)V+=W(U[X][0]-U[B][0])*(U[X][1]+U[B][1])*(F?-1:1);return Math.abs(V)/2*this.kx*this.ky},r.prototype.along=function(u,V){var F=0;if(V<=0)return u[0];for(var U=0;U<u.length-1;U++){var X=u[U],y=u[U+1],B=this.distance(X,y);if((F+=B)>V)return h(X,y,(V-(F-B))/B)}return u[u.length-1]},r.prototype.pointToSegmentDistance=function(u,V,F){var U=V[0],X=V[1],y=W(F[0]-U)*this.kx,B=(F[1]-X)*this.ky,k=0;return y===0&&B===0||((k=(W(u[0]-U)*this.kx*y+(u[1]-X)*this.ky*B)/(y*y+B*B))>1?(U=F[0],X=F[1]):k>0&&(U+=y/this.kx*k,X+=B/this.ky*k)),y=W(u[0]-U)*this.kx,B=(u[1]-X)*this.ky,Math.sqrt(y*y+B*B)},r.prototype.pointOnLine=function(u,V){for(var F,U,X,y,B=1/0,k=0;k<u.length-1;k++){var S=u[k][0],A=u[k][1],D=W(u[k+1][0]-S)*this.kx,O=(u[k+1][1]-A)*this.ky,et=0;D===0&&O===0||((et=(W(V[0]-S)*this.kx*D+(V[1]-A)*this.ky*O)/(D*D+O*O))>1?(S=u[k+1][0],A=u[k+1][1]):et>0&&(S+=D/this.kx*et,A+=O/this.ky*et));var $=(D=W(V[0]-S)*this.kx)*D+(O=(V[1]-A)*this.ky)*O;$<B&&(B=$,F=S,U=A,X=k,y=et)}return{point:[F,U],index:X,t:Math.max(0,Math.min(1,y))}},r.prototype.lineSlice=function(u,V,F){var U=this.pointOnLine(F,u),X=this.pointOnLine(F,V);if(U.index>X.index||U.index===X.index&&U.t>X.t){var y=U;U=X,X=y}var B=[U.point],k=U.index+1,S=X.index;!b(F[k],B[0])&&k<=S&&B.push(F[k]);for(var A=k+1;A<=S;A++)B.push(F[A]);return b(F[S],X.point)||B.push(X.point),B},r.prototype.lineSliceAlong=function(u,V,F){for(var U=0,X=[],y=0;y<F.length-1;y++){var B=F[y],k=F[y+1],S=this.distance(B,k);if((U+=S)>u&&X.length===0&&X.push(h(B,k,(u-(U-S))/S)),U>=V)return X.push(h(B,k,(V-(U-S))/S)),X;U>u&&X.push(k)}return X},r.prototype.bufferPoint=function(u,V){var F=V/this.ky,U=V/this.kx;return[u[0]-U,u[1]-F,u[0]+U,u[1]+F]},r.prototype.bufferBBox=function(u,V){var F=V/this.ky,U=V/this.kx;return[u[0]-U,u[1]-F,u[2]+U,u[3]+F]},r.prototype.insideBBox=function(u,V){return W(u[0]-V[0])>=0&&W(u[0]-V[2])<=0&&u[1]>=V[1]&&u[1]<=V[3]},Object.defineProperties(r,s),r}();var no=Ee(as.exports),Kc={exports:{}};Kc.exports=function(){var e=function(i,n){if(i===void 0&&(i=[]),n===void 0&&(n=t),this.data=i,this.length=this.data.length,this.compare=n,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function t(i,n){return i<n?-1:i>n?1:0}return e.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var i=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),i}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(i){for(var n=this.data,r=this.compare,s=n[i];i>0;){var b=i-1>>1,h=n[b];if(r(s,h)>=0)break;n[i]=h,i=b}n[i]=s},e.prototype._down=function(i){for(var n=this.data,r=this.compare,s=this.length>>1,b=n[i];i<s;){var h=1+(i<<1),W=n[h],u=h+1;if(u<this.length&&r(n[u],W)<0&&(h=u,W=n[u]),r(W,b)>=0)break;n[i]=W,i=h}n[i]=b},e}();var jn=Ee(Kc.exports),ie=8192;function gd(e,t){return t.dist-e.dist}let qc=100,ns=50;function $c(e){let t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function lo(e){return e[1]-e[0]+1}function nl(e,t){let i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function tb(e,t){if(e[0]>e[1])return[null,null];let i=lo(e);if(t){if(i===2)return[e,null];let n=Math.floor(i/2);return[[e[0],e[0]+n],[e[0]+n,e[1]]]}{if(i===1)return[e,null];let n=Math.floor(i/2)-1;return[[e[0],e[0]+n],[e[0]+n+1,e[1]]]}}function yo(e,t){let i=[1/0,1/0,-1/0,-1/0];if(!nl(t,e.length))return i;for(let n=t[0];n<=t[1];++n)eo(i,e[n]);return i}function Vd(e){let t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let n=0;n<e[i].length;++n)eo(t,e[i][n]);return t}function Bo(e,t,i){if($c(e)||$c(t))return NaN;let n=0,r=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),i.distance([0,0],[n,r])}function eb(e){return 360*e-180}function fp(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function br(e,t){let i=Math.pow(2,t.z),n=(e.y/ie+t.y)/i;return[eb((e.x/ie+t.x)/i),fp(n)]}function vp(e,t){let i=[];for(let n=0;n<e.length;++n)i.push(br(e[n],t));return i}function s0(e,t,i){let n=i.pointOnLine(t,e).point;return i.distance(e,n)}function d0(e,t,i,n,r){let s=i.slice(n[0],n[1]+1),b=1/0;for(let h=t[0];h<=t[1];++h)if((b=Math.min(b,s0(e[h],s,r)))===0)return 0;return b}function ib(e,t,i,n,r){let s=Math.min(r.pointToSegmentDistance(e,i,n),r.pointToSegmentDistance(t,i,n)),b=Math.min(r.pointToSegmentDistance(i,e,t),r.pointToSegmentDistance(n,e,t));return Math.min(s,b)}function Lp(e,t,i,n,r){if(!nl(t,e.length)||!nl(n,i.length))return NaN;let s=1/0;for(let b=t[0];b<t[1];++b)for(let h=n[0];h<n[1];++h){if(Tl(e[b],e[b+1],i[h],i[h+1]))return 0;s=Math.min(s,ib(e[b],e[b+1],i[h],i[h+1],r))}return s}function zp(e,t,i,n,r){if(!nl(t,e.length)||!nl(n,i.length))return NaN;let s=1/0;for(let b=t[0];b<=t[1];++b)for(let h=n[0];h<=n[1];++h)if((s=Math.min(s,r.distance(e[b],i[h])))===0)return s;return s}function wp(e,t,i){if(dr(e,t,!0))return 0;let n=1/0;for(let r of t){let s=r.length;if(s<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[s-1]&&(n=Math.min(n,i.pointToSegmentDistance(e,r[s-1],r[0])))===0||(n=Math.min(n,s0(e,r,i)))===0)return n}return n}function c0(e,t,i,n){if(!nl(t,e.length))return NaN;for(let s=t[0];s<=t[1];++s)if(dr(e[s],i,!0))return 0;let r=1/0;for(let s=t[0];s<t[1];++s)for(let b of i)for(let h=0,W=b.length,u=W-1;h<W;u=h++){if(Tl(e[s],e[s+1],b[u],b[h]))return 0;r=Math.min(r,ib(e[s],e[s+1],b[u],b[h],n))}return r}function ls(e,t){for(let i of e)for(let n=0;n<=i.length-1;++n)if(dr(i[n],t,!0))return!0;return!1}function Ep(e,t,i,n=1/0){let r=Vd(e),s=Vd(t);if(n!==1/0&&Bo(r,s,i)>=n)return n;if(io(r,s)){if(ls(e,t))return 0}else if(ls(t,e))return 0;let b=n;for(let h of e)for(let W=0,u=h.length,V=u-1;W<u;V=W++)for(let F of t)for(let U=0,X=F.length,y=X-1;U<X;y=U++){if(Tl(h[V],h[W],F[y],F[U]))return 0;b=Math.min(b,ib(h[V],h[W],F[y],F[U],i))}return b}function Rd(e,t,i,n,r,s,b){if(s===null||b===null)return;let h=Bo(yo(n,s),yo(r,b),i);h<t&&e.push({dist:h,range1:s,range2:b})}function ab(e,t,i,n,r=1/0){let s=Math.min(n.distance(e[0],i[0][0]),r);if(s===0)return s;let b=new jn([{dist:0,range1:[0,e.length-1],range2:[0,0]}],gd),h=t?ns:qc,W=Vd(i);for(;b.length;){let u=b.pop();if(u.dist>=s)continue;let V=u.range1;if(lo(V)<=h){if(!nl(V,e.length))return NaN;if(t){let F=c0(e,V,i,n);if((s=Math.min(s,F))===0)return s}else for(let F=V[0];F<=V[1];++F){let U=wp(e[F],i,n);if((s=Math.min(s,U))===0)return s}}else{let F=tb(V,t);if(F[0]!==null){let U=Bo(yo(e,F[0]),W,n);U<s&&b.push({dist:U,range1:F[0],range2:[0,0]})}if(F[1]!==null){let U=Bo(yo(e,F[1]),W,n);U<s&&b.push({dist:U,range1:F[1],range2:[0,0]})}}}return s}function b0(e,t,i,n,r,s=1/0){let b=Math.min(s,r.distance(e[0],i[0]));if(b===0)return b;let h=new jn([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],gd),W=t?ns:qc,u=n?ns:qc;for(;h.length;){let V=h.pop();if(V.dist>=b)continue;let F=V.range1,U=V.range2;if(lo(F)<=W&&lo(U)<=u){if(!nl(F,e.length)||!nl(U,i.length))return NaN;if(t&&n?b=Math.min(b,Lp(e,F,i,U,r)):t||n?t&&!n?b=Math.min(b,d0(i,U,e,F,r)):!t&&n&&(b=Math.min(b,d0(e,F,i,U,r))):b=Math.min(b,zp(e,F,i,U,r)),b===0)return b}else{let X=tb(F,t),y=tb(U,n);Rd(h,b,r,e,i,X[0],y[0]),Rd(h,b,r,e,i,X[0],y[1]),Rd(h,b,r,e,i,X[1],y[0]),Rd(h,b,r,e,i,X[1],y[1])}}return b}function nb(e,t,i,n,r=1/0){let s=r,b=yo(e,[0,e.length-1]);for(let h of i)if(!(s!==1/0&&Bo(b,yo(h,[0,h.length-1]),n)>=s)&&(s=Math.min(s,b0(e,t,h,!0,n,s)),s===0))return s;return s}function Gd(e,t,i,n,r=1/0){let s=r,b=yo(e,[0,e.length-1]);for(let h of i){if(s!==1/0&&Bo(b,Vd(h),n)>=s)continue;let W=ab(e,t,h,n,s);if(isNaN(W))return W;if((s=Math.min(s,W))===0)return s}return s}function lb(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class Mo{constructor(t,i){this.type=le,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error("'distance' expression requires either one argument, but found ' ".concat(t.length-1," instead."));if(Yo(t[1])){let n=t[1];if(n.type==="FeatureCollection"){for(let r=0;r<n.features.length;++r)if(lb(n.features[r].geometry.type))return new Mo(n,n.features[r].geometry)}else if(n.type==="Feature"){if(lb(n.geometry.type))return new Mo(n,n.geometry)}else if(lb(n.type))return new Mo(n,n)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){let i=t.geometry(),n=t.canonicalID();if(i!=null&&n!=null){if(t.geometryType()==="Point")return function(r,s,b){let h=[];for(let u of r)for(let V of u)h.push(br(V,s));let W=new no(h[0][1],"meters");return b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString"?b0(h,!1,b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",W):b.type==="MultiLineString"?nb(h,!1,b.coordinates,W):b.type==="Polygon"||b.type==="MultiPolygon"?Gd(h,!1,b.type==="Polygon"?[b.coordinates]:b.coordinates,W):null}(i,n,this.geometries);if(t.geometryType()==="LineString")return function(r,s,b){let h=[];for(let u of r){let V=[];for(let F of u)V.push(br(F,s));h.push(V)}let W=new no(h[0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return nb(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",h,W);if(b.type==="MultiLineString"){let u=1/0;for(let V=0;V<b.coordinates.length;V++){let F=nb(b.coordinates[V],!0,h,W,u);if(isNaN(F))return F;if((u=Math.min(u,F))===0)return u}return u}if(b.type==="Polygon"||b.type==="MultiPolygon"){let u=1/0;for(let V=0;V<h.length;V++){let F=Gd(h[V],!0,b.type==="Polygon"?[b.coordinates]:b.coordinates,W,u);if(isNaN(F))return F;if((u=Math.min(u,F))===0)return u}return u}return null}(i,n,this.geometries);if(t.geometryType()==="Polygon")return function(r,s,b){let h=[];for(let u of function(V,F){let U=V.length;if(U<=1)return[V];let X=[],y,B;for(let k=0;k<U;k++){let S=Sp(V[k]);S!==0&&(V[k].area=Math.abs(S),B===void 0&&(B=S<0),B===S<0?(y&&X.push(y),y=[V[k]]):y.push(V[k]))}return y&&X.push(y),X}(r)){let V=[];for(let F=0;F<u.length;++F)V.push(vp(u[F],s));h.push(V)}let W=new no(h[0][0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return Gd(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",h,W);if(b.type==="MultiLineString"){let u=1/0;for(let V=0;V<b.coordinates.length;V++){let F=Gd(b.coordinates[V],!0,h,W,u);if(isNaN(F))return F;if((u=Math.min(u,F))===0)return u}return u}return b.type==="Polygon"||b.type==="MultiPolygon"?function(u,V,F){let U=1/0;for(let X of u)for(let y of V){let B=Ep(X,y,F,U);if(isNaN(B))return B;if((U=Math.min(U,B))===0)return U}return U}(b.type==="Polygon"?[b.coordinates]:b.coordinates,h,W):null}(i,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Fd=Mo;function os(e,t){switch(e){case"string":return An(t);case"number":return+t;case"boolean":return!!t;case"color":return ga.parse(t);case"formatted":return _a.fromString(An(t));case"resolvedImage":return Ye.fromString(An(t))}return t}function ob(e,t,i,n){return n!==void 0&&(e=n*Math.round(e/n)),t!==void 0&&e<t&&(e=t),i!==void 0&&e>i&&(e=i),e}class rs{constructor(t,i,n){this.type=t,this.key=i,this.scope=n}static parse(t,i){let n=i.expectedType;if(n==null&&(n=ci),t.length<2||t.length>3)return i.error("Invalid number of arguments for 'config' expression.");let r=i.parse(t[1],1);if(!(r instanceof Bl))return i.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){let s=i.parse(t[2],2);return s instanceof Bl?new rs(n,An(r.value),An(s.value)):i.error("Scope of 'config' expression must be a string literal.")}return new rs(n,An(r.value))}evaluate(t){let i=[this.key,this.scope,t.scope].filter(Boolean).join(""),n=t.getConfig(i);if(!n)return null;let{type:r,value:s,values:b,minValue:h,maxValue:W,stepValue:u}=n,V=n.default.evaluate(t),F=V;if(s){let U=t.scope;t.scope=(U||"").split("").slice(1).join(""),F=s.evaluate(t),t.scope=U}return r&&(F=os(r,F)),F===void 0||h===void 0&&W===void 0&&u===void 0||(typeof F=="number"?F=ob(F,h,W,u):Array.isArray(F)&&(F=F.map(U=>typeof U=="number"?ob(U,h,W,u):U))),s!==void 0&&F!==void 0&&b&&!b.includes(F)&&(F=V,r&&(F=os(r,F))),(r&&r!==this.type||F!==void 0&&Ia(F)!==this.type)&&(F=os(this.type.kind,F)),F}eachChild(){}outputDefined(){return!1}serialize(){let t=["config",this.key];return this.scope&&t.concat(this.key),t}}var mr=rs;function hr(e){if(e instanceof ri&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Zd||e instanceof Fd)return!1;let t=!0;return e.eachChild(i=>{t&&!hr(i)&&(t=!1)}),t}function ss(e){if(e instanceof ri&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!ss(i)&&(t=!1)}),t}function ds(e){if(e instanceof mr)return!1;let t=!0;return e.eachChild(i=>{t&&!ds(i)&&(t=!1)}),t}function Pa(e,t){if(e instanceof ri&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(n=>{i&&!Pa(n,t)&&(i=!1)}),i}class oo{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let n=t[1];return i.scope.has(n)?new oo(n,i.scope.get(n)):i.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var pn=oo;class rb{constructor(t,i=[],n,r=new kp,s=[],b,h){this.registry=t,this.path=i,this.key=i.map(W=>"[".concat(W,"]")).join(""),this.scope=r,this.errors=s,this.expectedType=n,this._scope=b,this.options=h}parse(t,i,n,r,s={}){return i||n?this.concat(i,n,r)._parse(t,s):this._parse(t,s)}_parse(t,i){function n(r,s,b){return b==="assert"?new Ml(s,[r]):b==="coerce"?new Cl(s,[r]):r}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let r=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(r){let s=r.parse(t,this);if(!s)return null;if(this.expectedType){let b=this.expectedType,h=s.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||h.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||h.kind!=="value"&&h.kind!=="string"){if(this.checkSubtype(b,h))return null}else s=n(s,b,i.typeAnnotation||"coerce");else s=n(s,b,i.typeAnnotation||"assert")}if(!(s instanceof Bl)&&s.type.kind!=="resolvedImage"&&sb(s)){let b=new l0(this._scope,this.options);try{s=new Bl(s.type,s.evaluate(b))}catch(h){return this.error(h.message),null}}return s}return Cl.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof t," instead."))}concat(t,i,n){let r=typeof t=="number"?this.path.concat(t):this.path,s=n?this.scope.concat(n):this.scope;return new rb(this.registry,r,i||null,s,this.errors,this._scope,this.options)}error(t,...i){let n="".concat(this.key).concat(i.map(r=>"[".concat(r,"]")).join(""));this.errors.push(new Rl(n,t))}checkSubtype(t,i){let n=No(t,i);return n&&this.error(n),n}}var m0=rb;function sb(e){if(e instanceof pn)return sb(e.boundExpression);if(e instanceof ri&&e.name==="error"||e instanceof es||e instanceof Zd||e instanceof Fd||e instanceof mr)return!1;let t=e instanceof Cl||e instanceof Ml,i=!0;return e.eachChild(n=>{i=t?i&&sb(n):i&&n instanceof Bl}),!!i&&hr(e)&&Pa(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Co(e,t){let i=e.length-1,n,r,s=0,b=i,h=0;for(;s<=b;)if(h=Math.floor((s+b)/2),n=e[h],r=e[h+1],n<=t){if(h===i||t<r)return h;s=h+1}else{if(!(n>t))throw new Ua("Input is not a number.");b=h-1}return 0}class Id{constructor(t,i,n){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[r,s]of n)this.labels.push(r),this.outputs.push(s)}static parse(t,i){if(t.length-1<4)return i.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let n=i.parse(t[1],1,le);if(!n)return null;let r=[],s=null;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);for(let b=1;b<t.length;b+=2){let h=b===1?-1/0:t[b],W=t[b+1],u=b,V=b+1;if(typeof h!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=h)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);let F=i.parse(W,V,s);if(!F)return null;s=s||F.type,r.push([h,F])}return new Id(s,n,r)}evaluate(t){let i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(t);let r=this.input.evaluate(t);if(r<=i[0])return n[0].evaluate(t);let s=i.length;return r>=i[s-1]?n[s-1].evaluate(t):n[Co(i,r)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var cs=Id;let h0=.95047,ro=1.08883,p0=4/29,pr=6/29,db=3*pr*pr,W0=pr*pr*pr,Ap=Math.PI/180,ll=180/Math.PI;function Ud(e){return e>W0?Math.pow(e,1/3):e/db+p0}function xd(e){return e>pr?e*e*e:db*(e-p0)}function Nd(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Yd(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function cb(e){let t=Yd(e.r),i=Yd(e.g),n=Yd(e.b),r=Ud((.4124564*t+.3575761*i+.1804375*n)/h0),s=Ud((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*s-16,a:500*(r-s),b:200*(s-Ud((.0193339*t+.119192*i+.9503041*n)/ro)),alpha:e.a}}function bb(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*xd(t),i=h0*xd(i),n=ro*xd(n),new ga(Nd(3.2404542*i-1.5371385*t-.4985314*n),Nd(-.969266*i+1.8760108*t+.041556*n),Nd(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function u0(e,t,i){let n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}let Wr={forward:cb,reverse:bb,interpolate:function(e,t,i){return{l:li(e.l,t.l,i),a:li(e.a,t.a,i),b:li(e.b,t.b,i),alpha:li(e.alpha,t.alpha,i)}}},ur={forward:function(e){let{l:t,a:i,b:n}=cb(e),r=Math.atan2(n,i)*ll;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){let t=e.h*Ap,i=e.c;return bb({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:u0(e.h,t.h,i),c:li(e.c,t.c,i),l:li(e.l,t.l,i),alpha:li(e.alpha,t.alpha,i)}}};var mb=Object.freeze({__proto__:null,hcl:ur,lab:Wr});class bs{constructor(t,i,n,r,s){this.type=t,this.operator=i,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(let[b,h]of s)this.labels.push(b),this.outputs.push(h)}static interpolationFactor(t,i,n,r){let s=0;if(t.name==="exponential")s=Zr(i,t.base,n,r);else if(t.name==="linear")s=Zr(i,1,n,r);else if(t.name==="cubic-bezier"){let b=t.controlPoints;s=new vi(b[0],b[1],b[2],b[3]).solve(Zr(i,1,n,r))}return s}static parse(t,i){let[n,r,s,...b]=t;if(!Array.isArray(r)||r.length===0)return i.error("Expected an interpolation type expression.",1);if(r[0]==="linear")r={name:"linear"};else if(r[0]==="exponential"){let u=r[1];if(typeof u!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:u}}else{if(r[0]!=="cubic-bezier")return i.error("Unknown interpolation type ".concat(String(r[0])),1,0);{let u=r.slice(1);if(u.length!==4||u.some(V=>typeof V!="number"||V<0||V>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:u}}}if(t.length-1<4)return i.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(s=i.parse(s,2,le),!s)return null;let h=[],W=null;n==="interpolate-hcl"||n==="interpolate-lab"?W=En:i.expectedType&&i.expectedType.kind!=="value"&&(W=i.expectedType);for(let u=0;u<b.length;u+=2){let V=b[u],F=b[u+1],U=u+3,X=u+4;if(typeof V!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(h.length&&h[h.length-1][0]>=V)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);let y=i.parse(F,X,W);if(!y)return null;W=W||y.type,h.push([V,y])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new bs(W,n,r,s,h):i.error("Type ".concat(pa(W)," is not interpolatable."))}evaluate(t){let i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(t);let r=this.input.evaluate(t);if(r<=i[0])return n[0].evaluate(t);let s=i.length;if(r>=i[s-1])return n[s-1].evaluate(t);let b=Co(i,r),h=bs.interpolationFactor(this.interpolation,r,i[b],i[b+1]),W=n[b].evaluate(t),u=n[b+1].evaluate(t);return this.operator==="interpolate"?hd[this.type.kind.toLowerCase()](W,u,h):this.operator==="interpolate-hcl"?ur.reverse(ur.interpolate(ur.forward(W),ur.forward(u),h)):Wr.reverse(Wr.interpolate(Wr.forward(W),Wr.forward(u),h))}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)i.push(this.labels[n],this.outputs[n].serialize());return i}}function Zr(e,t,i,n){let r=n-i,s=e-i;return r===0?0:t===1?s/r:(Math.pow(t,s)-1)/(Math.pow(t,r)-1)}var Cn=bs;class gr{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let n=null,r=i.expectedType;r&&r.kind!=="value"&&(n=r);let s=[];for(let h of t.slice(1)){let W=i.parse(h,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!W)return null;n=n||W.type,s.push(W)}let b=r&&s.some(h=>No(r,h.type));return new gr(b?ci:n,s)}evaluate(t){let i,n=null,r=0;for(let s of this.args){if(r++,n=s.evaluate(t),n&&n instanceof Ye&&!n.available&&(i||(i=n),n=null,r===this.args.length))return i;if(n!==null)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){let t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var hb=gr;class Xd{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));let n=[];for(let s=1;s<t.length-1;s+=2){let b=t[s];if(typeof b!="string")return i.error("Expected string, but found ".concat(typeof b," instead."),s);if(/[^a-zA-Z0-9_]/.test(b))return i.error("Variable names must contain only alphanumeric characters or '_'.",s);let h=i.parse(t[s+1],s+1);if(!h)return null;n.push([b,h])}let r=i.parse(t[t.length-1],t.length-1,i.expectedType,n);return r?new Xd(n,r):null}outputDefined(){return this.result.outputDefined()}serialize(){let t=["let"];for(let[i,n]of this.bindings)t.push(i,n.serialize());return t.push(this.result.serialize()),t}}var pb=Xd;class so{constructor(t,i,n){this.type=t,this.index=i,this.input=n}static parse(t,i){if(t.length!==3)return i.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,le),r=i.parse(t[2],2,In(i.expectedType||ci));return n&&r?new so(r.type.itemType,n,r):null}evaluate(t){let i=this.index.evaluate(t),n=this.input.evaluate(t);if(i<0)throw new Ua("Array index out of bounds: ".concat(i," < 0."));if(i>=n.length)throw new Ua("Array index out of bounds: ".concat(i," > ").concat(n.length-1,"."));if(i!==Math.floor(i))throw new Ua("Array index must be an integer, but found ".concat(i," instead."));return n[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var bi=so;class Wb{constructor(t,i){this.type=Ii,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,ci),r=i.parse(t[2],2,ci);return n&&r?Ce(n.type,[Ii,Fi,le,ar,ci])?new Wb(n,r):i.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(pa(n.type)," instead")):null}evaluate(t){let i=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(n==null)return!1;if(!$l(i,["boolean","string","number","null"]))throw new Ua("Expected first argument to be of type boolean, string, number or null, but found ".concat(pa(Ia(i))," instead."));if(!$l(n,["string","array"]))throw new Ua("Expected second argument to be of type array or string, but found ".concat(pa(Ia(n))," instead."));return n.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Hp=Wb;class Jd{constructor(t,i,n){this.type=le,this.needle=t,this.haystack=i,this.fromIndex=n}static parse(t,i){if(t.length<=2||t.length>=5)return i.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,ci),r=i.parse(t[2],2,ci);if(!n||!r)return null;if(!Ce(n.type,[Ii,Fi,le,ar,ci]))return i.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(pa(n.type)," instead"));if(t.length===4){let s=i.parse(t[3],3,le);return s?new Jd(n,r,s):null}return new Jd(n,r)}evaluate(t){let i=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!$l(i,["boolean","string","number","null"]))throw new Ua("Expected first argument to be of type boolean, string, number or null, but found ".concat(pa(Ia(i))," instead."));if(!$l(n,["string","array"]))throw new Ua("Expected second argument to be of type array or string, but found ".concat(pa(Ia(n))," instead."));if(this.fromIndex){let r=this.fromIndex.evaluate(t);return n.indexOf(i,r)}return n.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Z0=Jd;class ub{constructor(t,i,n,r,s,b){this.inputType=t,this.type=i,this.input=n,this.cases=r,this.outputs=s,this.otherwise=b}static parse(t,i){if(t.length<5)return i.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return i.error("Expected an even number of arguments.");let n,r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);let s={},b=[];for(let u=2;u<t.length-1;u+=2){let V=t[u],F=t[u+1];Array.isArray(V)||(V=[V]);let U=i.concat(u);if(V.length===0)return U.error("Expected at least one branch label.");for(let y of V){if(typeof y!="number"&&typeof y!="string")return U.error("Branch labels must be numbers or strings.");if(typeof y=="number"&&Math.abs(y)>Number.MAX_SAFE_INTEGER)return U.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if(typeof y=="number"&&Math.floor(y)!==y)return U.error("Numeric branch labels must be integer values.");if(n){if(U.checkSubtype(n,Ia(y)))return null}else n=Ia(y);if(s[String(y)]!==void 0)return U.error("Branch labels must be unique.");s[String(y)]=b.length}let X=i.parse(F,u,r);if(!X)return null;r=r||X.type,b.push(X)}let h=i.parse(t[1],1,ci);if(!h)return null;let W=i.parse(t[t.length-1],t.length-1,r);return W?h.type.kind!=="value"&&i.concat(1).checkSubtype(n,h.type)?null:new ub(n,r,h,s,b,W):null}evaluate(t){let i=this.input.evaluate(t);return(Ia(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),n=[],r={};for(let b of i){let h=r[this.cases[b]];h===void 0?(r[this.cases[b]]=n.length,n.push([this.cases[b],[b]])):n[h][1].push(b)}let s=b=>this.inputType.kind==="number"?Number(b):b;for(let[b,h]of n)t.push(h.length===1?s(h[0]):h.map(s)),t.push(this.outputs[b].serialize());return t.push(this.otherwise.serialize()),t}}var g0=ub;class yd{constructor(t,i,n){this.type=t,this.branches=i,this.otherwise=n}static parse(t,i){if(t.length<4)return i.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);let r=[];for(let b=1;b<t.length-1;b+=2){let h=i.parse(t[b],b,Ii);if(!h)return null;let W=i.parse(t[b+1],b+1,n);if(!W)return null;r.push([h,W]),n=n||W.type}let s=i.parse(t[t.length-1],t.length-1,n);return s?new yd(n,r,s):null}evaluate(t){for(let[i,n]of this.branches)if(i.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,n]of this.branches)t(i),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var V0=yd;class ms{constructor(t,i,n,r){this.type=t,this.input=i,this.beginIndex=n,this.endIndex=r}static parse(t,i){if(t.length<=2||t.length>=5)return i.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1,ci),r=i.parse(t[2],2,le);if(!n||!r)return null;if(!Ce(n.type,[In(ci),Fi,ci]))return i.error("Expected first argument to be of type array or string, but found ".concat(pa(n.type)," instead"));if(t.length===4){let s=i.parse(t[3],3,le);return s?new ms(n.type,n,r,s):null}return new ms(n.type,n,r)}evaluate(t){let i=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!$l(i,["string","array"]))throw new Ua("Expected first argument to be of type array or string, but found ".concat(pa(Ia(i))," instead."));if(this.endIndex){let r=this.endIndex.evaluate(t);return i.slice(n,r)}return i.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Vr=ms;function Zb(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function gb(e,t,i,n){return n.compare(t,i)===0}function Rr(e,t,i){let n=e!=="=="&&e!=="!=";return class lF{constructor(s,b,h){this.type=Ii,this.lhs=s,this.rhs=b,this.collator=h,this.hasUntypedArgument=s.type.kind==="value"||b.type.kind==="value"}static parse(s,b){if(s.length!==3&&s.length!==4)return b.error("Expected two or three arguments.");let h=s[0],W=b.parse(s[1],1,ci);if(!W)return null;if(!Zb(h,W.type))return b.concat(1).error('"'.concat(h,"\" comparisons are not supported for type '").concat(pa(W.type),"'."));let u=b.parse(s[2],2,ci);if(!u)return null;if(!Zb(h,u.type))return b.concat(2).error('"'.concat(h,"\" comparisons are not supported for type '").concat(pa(u.type),"'."));if(W.type.kind!==u.type.kind&&W.type.kind!=="value"&&u.type.kind!=="value")return b.error("Cannot compare types '".concat(pa(W.type),"' and '").concat(pa(u.type),"'."));n&&(W.type.kind==="value"&&u.type.kind!=="value"?W=new Ml(u.type,[W]):W.type.kind!=="value"&&u.type.kind==="value"&&(u=new Ml(W.type,[u])));let V=null;if(s.length===4){if(W.type.kind!=="string"&&u.type.kind!=="string"&&W.type.kind!=="value"&&u.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(V=b.parse(s[3],3,pd),!V)return null}return new lF(W,u,V)}evaluate(s){let b=this.lhs.evaluate(s),h=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){let W=Ia(b),u=Ia(h);if(W.kind!==u.kind||W.kind!=="string"&&W.kind!=="number")throw new Ua('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(W.kind,", ").concat(u.kind,") instead."))}if(this.collator&&!n&&this.hasUntypedArgument){let W=Ia(b),u=Ia(h);if(W.kind!=="string"||u.kind!=="string")return t(s,b,h)}return this.collator?i(s,b,h,this.collator.evaluate(s)):t(s,b,h)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){let s=[e];return this.eachChild(b=>{s.push(b.serialize())}),s}}}let Vb=Rr("==",function(e,t,i){return t===i},gb),Rb=Rr("!=",function(e,t,i){return t!==i},function(e,t,i,n){return!gb(0,t,i,n)}),jp=Rr("<",function(e,t,i){return t<i},function(e,t,i,n){return n.compare(t,i)<0}),Op=Rr(">",function(e,t,i){return t>i},function(e,t,i,n){return n.compare(t,i)>0}),R0=Rr("<=",function(e,t,i){return t<=i},function(e,t,i,n){return n.compare(t,i)<=0}),Dp=Rr(">=",function(e,t,i){return t>=i},function(e,t,i,n){return n.compare(t,i)>=0});class Gb{constructor(t,i,n,r,s,b){this.type=Fi,this.number=t,this.locale=i,this.currency=n,this.unit=r,this.minFractionDigits=s,this.maxFractionDigits=b}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let n=i.parse(t[1],1,le);if(!n)return null;let r=t[2];if(typeof r!="object"||Array.isArray(r))return i.error("NumberFormat options argument must be an object.");let s=null;if(r.locale&&(s=i.parse(r.locale,1,Fi),!s))return null;let b=null;if(r.currency&&(b=i.parse(r.currency,1,Fi),!b))return null;let h=null;if(r.unit&&(h=i.parse(r.unit,1,Fi),!h))return null;let W=null;if(r["min-fraction-digits"]&&(W=i.parse(r["min-fraction-digits"],1,le),!W))return null;let u=null;return r["max-fraction-digits"]&&(u=i.parse(r["max-fraction-digits"],1,le),!u)?null:new Gb(n,s,b,h,W,u)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Fb{constructor(t){this.type=le,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected 1 argument, but found ".concat(t.length-1," instead."));let n=i.parse(t[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error("Expected argument of type string or array, but found ".concat(pa(n.type)," instead.")):new Fb(n):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ua("Expected value to be of type string or array, but found ".concat(pa(Ia(i))," instead."))}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){let t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function G0(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}let Ib={"==":Vb,"!=":Rb,">":Op,"<":jp,">=":Dp,"<=":R0,array:Ml,at:bi,boolean:Ml,case:V0,coalesce:hb,collator:es,format:rr,image:Xo,in:Hp,"index-of":Z0,interpolate:Cn,"interpolate-hcl":Cn,"interpolate-lab":Cn,length:Fb,let:pb,literal:Bl,match:g0,number:Ml,"number-format":Gb,object:Ml,slice:Vr,step:cs,string:Ml,"to-boolean":Cl,"to-color":Cl,"to-number":Cl,"to-string":Cl,var:pn,within:Zd,distance:Fd,config:mr};function Ub(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);let s=r?r.evaluate(e):1,b=n0(t,i,n,s);if(b)throw new Ua(b);return new ga(t/255*s,i/255*s,n/255*s,s)}function F0(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);let s=r?r.evaluate(e):1,b=function(u,V,F,U){return typeof u=="number"&&u>=0&&u<=360?typeof V=="number"&&V>=0&&V<=100&&typeof F=="number"&&F>=0&&F<=100?U===void 0||typeof U=="number"&&U>=0&&U<=1?null:"Invalid hsla value [".concat([u,V,F,U].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat((typeof U=="number"?[u,V,F,U]:[u,V,F]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat((typeof U=="number"?[u,V,F,U]:[u,V,F]).join(", "),"]: 'h' must be between 0 and 360.")}(t,i,n,s);if(b)throw new Ua(b);let h="hsla(".concat(t,", ").concat(i,"%, ").concat(n,"%, ").concat(s,")"),W=ga.parse(h);if(!W)throw new Ua("Failed to parse HSLA color: ".concat(h));return W}function xb(e,t){return e in t}function Nb(e,t){let i=t[e];return i===void 0?null:i}function To(e){return{type:e}}ri.register(Ib,{error:[{kind:"error"},[Fi],(e,[t])=>{throw new Ua(t.evaluate(e))}],typeof:[Fi,[ci],(e,[t])=>pa(Ia(t.evaluate(e)))],"to-rgba":[In(le,4),[En],(e,[t])=>t.evaluate(e).toArray()],rgb:[En,[le,le,le],Ub],rgba:[En,[le,le,le,le],Ub],hsl:[En,[le,le,le],F0],hsla:[En,[le,le,le,le],F0],has:{type:Ii,overloads:[[[Fi],(e,[t])=>xb(t.evaluate(e),e.properties())],[[Fi,nr],(e,[t,i])=>xb(t.evaluate(e),i.evaluate(e))]]},get:{type:ci,overloads:[[[Fi],(e,[t])=>Nb(t.evaluate(e),e.properties())],[[Fi,nr],(e,[t,i])=>Nb(t.evaluate(e),i.evaluate(e))]]},"feature-state":[ci,[Fi],(e,[t])=>Nb(t.evaluate(e),e.featureState||{})],properties:[nr,[],e=>e.properties()],"geometry-type":[Fi,[],e=>e.geometryType()],id:[ci,[],e=>e.id()],zoom:[le,[],e=>e.globals.zoom],pitch:[le,[],e=>e.globals.pitch||0],"distance-from-center":[le,[],e=>e.distanceFromCenter()],"measure-light":[le,[Fi],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[le,[],e=>e.globals.heatmapDensity||0],"line-progress":[le,[],e=>e.globals.lineProgress||0],"raster-value":[le,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[le,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[le,[],e=>e.globals.skyRadialProgress||0],accumulated:[ci,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[le,To(le),(e,t)=>{let i=0;for(let n of t)i+=n.evaluate(e);return i}],"*":[le,To(le),(e,t)=>{let i=1;for(let n of t)i*=n.evaluate(e);return i}],"-":{type:le,overloads:[[[le,le],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[le],(e,[t])=>-t.evaluate(e)]]},"/":[le,[le,le],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[le,[le,le],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[le,[],()=>Math.LN2],pi:[le,[],()=>Math.PI],e:[le,[],()=>Math.E],"^":[le,[le,le],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[le,[le],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[le,[le],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[le,[le],(e,[t])=>Math.log(t.evaluate(e))],log2:[le,[le],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[le,[le],(e,[t])=>Math.sin(t.evaluate(e))],cos:[le,[le],(e,[t])=>Math.cos(t.evaluate(e))],tan:[le,[le],(e,[t])=>Math.tan(t.evaluate(e))],asin:[le,[le],(e,[t])=>Math.asin(t.evaluate(e))],acos:[le,[le],(e,[t])=>Math.acos(t.evaluate(e))],atan:[le,[le],(e,[t])=>Math.atan(t.evaluate(e))],min:[le,To(le),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[le,To(le),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[le,[le],(e,[t])=>Math.abs(t.evaluate(e))],round:[le,[le],(e,[t])=>{let i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[le,[le],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[le,[le],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Ii,[Fi,ci],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Ii,[ci],(e,[t])=>e.id()===t.value],"filter-type-==":[Ii,[Fi],(e,[t])=>e.geometryType()===t.value],"filter-<":[Ii,[Fi,ci],(e,[t,i])=>{let n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[Ii,[ci],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[Ii,[Fi,ci],(e,[t,i])=>{let n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[Ii,[ci],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[Ii,[Fi,ci],(e,[t,i])=>{let n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[Ii,[ci],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[Ii,[Fi,ci],(e,[t,i])=>{let n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[Ii,[ci],(e,[t])=>{let i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[Ii,[ci],(e,[t])=>t.value in e.properties()],"filter-has-id":[Ii,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Ii,[In(Fi)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Ii,[In(ci)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Ii,[Fi,In(ci)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Ii,[Fi,In(ci)],(e,[t,i])=>function(n,r,s,b){for(;s<=b;){let h=s+b>>1;if(r[h]===n)return!0;r[h]>n?b=h-1:s=h+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Ii,overloads:[[[Ii,Ii],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[To(Ii),(e,t)=>{for(let i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[To(Ii),(e,t)=>{for(let i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Ii,[Ii],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Ii,[Fi],(e,[t])=>{let i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Fi,[Fi],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Fi,[Fi],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Fi,To(ci),(e,t)=>t.map(i=>An(i.evaluate(e))).join("")],"resolved-locale":[Fi,[pd],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[le,[le,le,ci],(e,t)=>{let[i,n,r]=t.map(b=>b.evaluate(e));if(i>n||i===n)return i;let s;if(typeof r=="string")s=function(b){let h=0;if(b.length===0)return h;for(let W=0;W<b.length;W++)h=(h<<5)-h+b.charCodeAt(W),h|=0;return h}(r);else{if(typeof r!="number")throw new Ua("Invalid seed input: ".concat(r));s=r}return i+G0(s)()*(n-i)}]});var Gr=Ib;function Yb(e){return{result:"success",value:e}}function ko(e){return{result:"error",value:e}}function I0(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Bd(e){return e["property-type"]==="data-driven"}function Xb(e){return I0(e.expression,"measure-light")}function U0(e){return I0(e.expression,"zoom")}function Jb(e){return!!e.expression&&e.expression.interpolated}function Md(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function x0(e){return e}function yb(e,t){let i=t.type==="color",n=e.stops&&typeof e.stops[0][0]=="object",r=n||!(n||e.property!==void 0),s=e.type||(Jb(t)?"exponential":"interval");if(i&&((e=fc({},e)).stops&&(e.stops=e.stops.map(u=>[u[0],ga.parse(u[1])])),e.default=ga.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!mb[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let b,h,W;if(s==="exponential")b=N0;else if(s==="interval")b=Pp;else if(s==="categorical"){b=_p,h=Object.create(null);for(let u of e.stops)h[u[0]]=u[1];W=typeof e.stops[0][0]}else{if(s!=="identity")throw new Error('Unknown function type "'.concat(s,'"'));b=Y0}if(n){let u={},V=[];for(let X=0;X<e.stops.length;X++){let y=e.stops[X],B=y[0].zoom;u[B]===void 0&&(u[B]={zoom:B,type:e.type,property:e.property,default:e.default,stops:[]},V.push(B)),u[B].stops.push([y[0].value,y[1]])}let F=[];for(let X of V)F.push([u[X].zoom,yb(u[X],t)]);let U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:Cn.interpolationFactor.bind(void 0,U),zoomStops:F.map(X=>X[0]),evaluate:({zoom:X},y)=>N0({stops:F,base:e.base},t,X).evaluate(X,y)}}if(r){let u=s==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:u,interpolationFactor:Cn.interpolationFactor.bind(void 0,u),zoomStops:e.stops.map(V=>V[0]),evaluate:({zoom:V})=>b(e,t,V,h,W)}}return{kind:"source",evaluate(u,V){let F=V&&V.properties?V.properties[e.property]:void 0;return F===void 0?hs(e.default,t.default):b(e,t,F,h,W)}}}function hs(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function _p(e,t,i,n,r){return hs(typeof i===r?n[i]:void 0,e.default,t.default)}function Pp(e,t,i){if(sr(i)!=="number")return hs(e.default,t.default);let n=e.stops.length;if(n===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];let r=Co(e.stops.map(s=>s[0]),i);return e.stops[r][1]}function N0(e,t,i){let n=e.base!==void 0?e.base:1;if(sr(i)!=="number")return hs(e.default,t.default);let r=e.stops.length;if(r===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];let s=Co(e.stops.map(V=>V[0]),i),b=function(V,F,U,X){let y=X-U,B=V-U;return y===0?0:F===1?B/y:(Math.pow(F,B)-1)/(Math.pow(F,y)-1)}(i,n,e.stops[s][0],e.stops[s+1][0]),h=e.stops[s][1],W=e.stops[s+1][1],u=hd[t.type]||x0;if(e.colorSpace&&e.colorSpace!=="rgb"){let V=mb[e.colorSpace];u=(F,U)=>V.reverse(V.interpolate(V.forward(F),V.forward(U),b))}return typeof h.evaluate=="function"?{evaluate(...V){let F=h.evaluate.apply(void 0,V),U=W.evaluate.apply(void 0,V);if(F!==void 0&&U!==void 0)return u(F,U,b)}}:u(h,W,b)}function Y0(e,t,i){return t.type==="color"?i=ga.parse(i):t.type==="formatted"?i=_a.fromString(i.toString()):t.type==="resolvedImage"?i=Ye.fromString(i.toString()):sr(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),hs(i,e.default,t.default)}class Cd{constructor(t,i,n,r){this.expression=t,this._warningHistory={},this._evaluator=new l0(n,r),this._defaultValue=i?function(s){return s.type==="color"&&(Md(s.default)||Array.isArray(s.default))?new ga(0,0,0,0):s.type==="color"?ga.parse(s.default)||null:s.default===void 0?null:s.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,n,r,s,b,h,W){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=r||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=W||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,n,r,s,b,h,W){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=h||null,this._evaluator.featureDistanceData=W||null;try{let u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new Ua("Expected value to be one of ".concat(Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", "),", but found ").concat(JSON.stringify(u)," instead."));return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function ps(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Gr}function Td(e,t,i,n){let r=new m0(Gr,[],t?function(b){let h={color:En,string:Fi,number:le,enum:Fi,boolean:Ii,formatted:lr,resolvedImage:$r};return b.type==="array"?In(h[b.value]||ci,b.length):h[b.type]}(t):void 0,void 0,void 0,i,n),s=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Yb(new Cd(s,t,i,n)):ko(r.errors)}class Bb{constructor(t,i,n){this.kind=t,this._styleExpression=i,this.isLightConstant=n,this.isStateDependent=t!=="constant"&&!ss(i.expression),this.isConfigDependent=!ds(i.expression)}evaluateWithoutErrorHandling(t,i,n,r,s,b){return this._styleExpression.evaluateWithoutErrorHandling(t,i,n,r,s,b)}evaluate(t,i,n,r,s,b){return this._styleExpression.evaluate(t,i,n,r,s,b)}}class Ws{constructor(t,i,n,r,s){this.kind=t,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!ss(i.expression),this.isLightConstant=s,this.isConfigDependent=!ds(i.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,i,n,r,s,b){return this._styleExpression.evaluateWithoutErrorHandling(t,i,n,r,s,b)}evaluate(t,i,n,r,s,b){return this._styleExpression.evaluate(t,i,n,r,s,b)}interpolationFactor(t,i,n){return this.interpolationType?Cn.interpolationFactor(this.interpolationType,t,i,n):0}}function kd(e,t,i,n){if((e=Td(e,t,i,n)).result==="error")return e;let r=e.value.expression,s=hr(r);if(!s&&!Bd(t))return ko([new Rl("","data expressions not supported")]);let b=Pa(r,["zoom","pitch","distance-from-center"]);if(!b&&!U0(t))return ko([new Rl("","zoom expressions not supported")]);let h=Pa(r,["measure-light"]);if(!h&&!Xb(t))return ko([new Rl("","measure-light expression not supported")]);let W=t.expression&&t.expression.relaxZoomRestriction,u=Zs(r);return u||b||W?u instanceof Rl?ko([u]):u instanceof Cn&&!Jb(t)?ko([new Rl("",'"interpolate" expressions cannot be used with this property')]):Yb(u?new Ws(s?"camera":"composite",e.value,u.labels,u instanceof Cn?u.interpolation:void 0,h):new Bb(s?"constant":"source",e.value,h)):ko([new Rl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class us{constructor(t,i){this._parameters=t,this._specification=i,fc(this,yb(this._parameters,this._specification))}static deserialize(t){return new us(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Zs(e){let t=null;if(e instanceof pb)t=Zs(e.result);else if(e instanceof hb){for(let i of e.args)if(t=Zs(i),t)break}else(e instanceof cs||e instanceof Cn)&&e.input instanceof ri&&e.input.name==="zoom"&&(t=e);return t instanceof Rl||e.eachChild(i=>{let n=Zs(i);n instanceof Rl?t=n:t&&n&&t!==n&&(t=new Rl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Kp=rl,ol=3;function rl(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var s=0;s<this.d*this.d;s++){var b=r[ol+s],h=r[ol+s+1];n.push(b===h?null:r.subarray(b,h))}var W=r[ol+n.length+1];this.keys=r.subarray(r[ol+n.length],W),this.bboxes=r.subarray(W),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var V=i/t*e;this.min=-V,this.max=e+V}rl.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},rl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},rl.prototype._insertCell=function(e,t,i,n,r,s){this.cells[r].push(s)},rl.prototype.query=function(e,t,i,n,r){var s=this.min,b=this.max;if(e<=s&&t<=s&&b<=i&&b<=n&&!r)return Array.prototype.slice.call(this.keys);var h=[];return this._forEachCell(e,t,i,n,this._queryCell,h,{},r),h},rl.prototype._queryCell=function(e,t,i,n,r,s,b,h){var W=this.cells[r];if(W!==null)for(var u=this.keys,V=this.bboxes,F=0;F<W.length;F++){var U=W[F];if(b[U]===void 0){var X=4*U;(h?h(V[X+0],V[X+1],V[X+2],V[X+3]):e<=V[X+2]&&t<=V[X+3]&&i>=V[X+0]&&n>=V[X+1])?(b[U]=!0,s.push(u[U])):b[U]=!1}}},rl.prototype._forEachCell=function(e,t,i,n,r,s,b,h){for(var W=this._convertToCellCoord(e),u=this._convertToCellCoord(t),V=this._convertToCellCoord(i),F=this._convertToCellCoord(n),U=W;U<=V;U++)for(var X=u;X<=F;X++){var y=this.d*X+U;if((!h||h(this._convertFromCellCoord(U),this._convertFromCellCoord(X),this._convertFromCellCoord(U+1),this._convertFromCellCoord(X+1)))&&r.call(this,e,t,i,n,y,s,b,h))return}},rl.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},rl.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},rl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=ol+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var s=t,b=0;b<e.length;b++){var h=e[b];r[ol+b]=s,r.set(h,s),s+=h.length}return r[ol+e.length]=s,r.set(this.keys,s),r[ol+e.length+1]=s+=this.keys.length,r.set(this.bboxes,s),s+=this.bboxes.length,r.buffer};var kl=Ee(Kp);let gs={};function se(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),gs[t]={klass:e,omit:i.omit||[]}}se(Object,"Object"),kl.serialize=function(e,t){let i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},kl.deserialize=function(e){return new kl(e.buffer)},Object.defineProperty(kl,"name",{value:"Grid"}),se(kl,"Grid"),se(ga,"Color"),se(Error,"Error"),se(_a,"Formatted"),se(or,"FormattedSection"),se(Ga,"AJAXError"),se(Ye,"ResolvedImage"),se(us,"StylePropertyFunction"),se(Cd,"StyleExpression",{omit:["_evaluator"]}),se(Ws,"ZoomDependentExpression"),se(Bb,"ZoomConstantExpression"),se(ri,"CompoundExpression",{omit:["_evaluate"]});for(let e in Gr)gs[Gr[e]._classRegistryKey]||se(Gr[e],"Expression".concat(e));function X0(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Qd(e){return self.ImageBitmap&&e instanceof ImageBitmap}function co(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(X0(e)||Qd(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){let i=e;return t&&t.add(i.buffer),i}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){let i=[];for(let n of e)i.push(co(n,t));return i}if(e instanceof Map){let i={$name:"Map"};for(let[n,r]of e.entries())i[n]=co(r);return i}if(typeof e=="object"){let i=e.constructor,n=i._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class ".concat(n));let r=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(let s in e)e.hasOwnProperty(s)&&(gs[n].omit.indexOf(s)>=0||(r[s]=co(e[s],t)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof e)}function Qo(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||X0(e)||Qd(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Qo);if(typeof e=="object"){let t=e.$name||"Object";if(t==="Map"){let r=new Map;for(let s of Object.keys(e))s!=="$name"&&r.set(s,Qo(e[s]));return r}let{klass:i}=gs[t];if(!i)throw new Error("can't deserialize unregistered class ".concat(t));if(i.deserialize)return i.deserialize(e);let n=Object.create(i.prototype);for(let r of Object.keys(e))r!=="$name"&&(n[r]=Qo(e[r]));return n}throw new Error("can't deserialize object of type "+typeof e)}let pe={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function bo(e){for(let t of e)if(Mb(t.charCodeAt(0)))return!0;return!1}function qp(e){for(let t of e)if(!$p(t.charCodeAt(0)))return!1;return!0}function $p(e){return!(pe.Arabic(e)||pe["Arabic Supplement"](e)||pe["Arabic Extended-A"](e)||pe["Arabic Presentation Forms-A"](e)||pe["Arabic Presentation Forms-B"](e))}function Mb(e){return!(e!==746&&e!==747&&(e<4352||!(pe["Bopomofo Extended"](e)||pe.Bopomofo(e)||pe["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||pe["CJK Compatibility Ideographs"](e)||pe["CJK Compatibility"](e)||pe["CJK Radicals Supplement"](e)||pe["CJK Strokes"](e)||!(!pe["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||pe["CJK Unified Ideographs Extension A"](e)||pe["CJK Unified Ideographs"](e)||pe["Enclosed CJK Letters and Months"](e)||pe["Hangul Compatibility Jamo"](e)||pe["Hangul Jamo Extended-A"](e)||pe["Hangul Jamo Extended-B"](e)||pe["Hangul Jamo"](e)||pe["Hangul Syllables"](e)||pe.Hiragana(e)||pe["Ideographic Description Characters"](e)||pe.Kanbun(e)||pe["Kangxi Radicals"](e)||pe["Katakana Phonetic Extensions"](e)||pe.Katakana(e)&&e!==12540||!(!pe["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!pe["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||pe["Unified Canadian Aboriginal Syllabics"](e)||pe["Unified Canadian Aboriginal Syllabics Extended"](e)||pe["Vertical Forms"](e)||pe["Yijing Hexagram Symbols"](e)||pe["Yi Syllables"](e)||pe["Yi Radicals"](e))))}function J0(e){return!(Mb(e)||function(t){return!!(pe["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||pe["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||pe["Letterlike Symbols"](t)||pe["Number Forms"](t)||pe["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||pe["Control Pictures"](t)&&t!==9251||pe["Optical Character Recognition"](t)||pe["Enclosed Alphanumerics"](t)||pe["Geometric Shapes"](t)||pe["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||pe["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||pe["CJK Symbols and Punctuation"](t)||pe.Katakana(t)||pe["Private Use Area"](t)||pe["CJK Compatibility Forms"](t)||pe["Small Form Variants"](t)||pe["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function y0(e){return e>=1424&&e<=2303||pe["Arabic Presentation Forms-A"](e)||pe["Arabic Presentation Forms-B"](e)}function B0(e,t){return!(!t&&y0(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||pe.Khmer(e))}function Cb(e){for(let t of e)if(y0(t.charCodeAt(0)))return!0;return!1}let Tb="deferred",kb="loading",Qb="loaded",Sb=null,Un="unavailable",mo=null,M0=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Un="error"),Sb&&Sb(e)};function fb(){vb.fire(new xo("pluginStateChange",{pluginStatus:Un,pluginURL:mo}))}let vb=new ir,ho=function(){return Un},Lb=function(){if(Un!==Tb||!mo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Un=kb,fb(),mo&&yt({url:mo},e=>{e?M0(e):(Un=Qb,fb())})},Tn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Un===Qb||Tn.applyArabicShaping!=null,isLoading:()=>Un===kb,setState(e){Un=e.pluginStatus,mo=e.pluginURL},isParsed:()=>Tn.applyArabicShaping!=null&&Tn.processBidirectionalText!=null&&Tn.processStyledBidirectionalText!=null,getPluginURL:()=>mo};class ta{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,n){for(let r of i)if(!B0(r.charCodeAt(0),n))return!1;return!0}(t,Tn.isLoaded())}}class Sd{constructor(t,i,n,r){this.property=t,this.value=i,this.expression=function(s,b,h,W){if(Md(s))return new us(s,b);if(ps(s)||Array.isArray(s)&&s.length>0){let u=kd(s,b,h,W);if(u.result==="error")throw new Error(u.value.map(V=>"".concat(V.key,": ").concat(V.message)).join(", "));return u.value}{let u=s;return typeof s=="string"&&b.type==="color"&&(u=ga.parse(s)),{kind:"constant",isConfigDependent:!1,evaluate:()=>u}}}(i===void 0?t.specification.default:i,t.specification,n,r)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,n){return this.property.possiblyEvaluate(this,t,i,n)}}class zb{constructor(t,i,n){this.property=t,this.value=new Sd(t,void 0,i,n)}transitioned(t,i){return new wb(this.property,this.value,i,ma({},t.transition,this.transition),t.now)}untransitioned(){return new wb(this.property,this.value,null,{},0)}}class Ql{constructor(t,i,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=i,this._options=n,this.isConfigDependent=!1}getValue(t){return tn(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new zb(this._values[t].property,this._scope,this._options)),this._values[t].value=new Sd(this._values[t].property,i===null?void 0:tn(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,i){i&&(this._options=i);let n=this._properties.properties;if(t)for(let r in t){let s=t[r];if(mn(r,"-transition")){let b=r.slice(0,-11);n[b]&&this.setTransition(b,s)}else n[r]&&this.setValue(r,s)}}getTransition(t){return tn(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new zb(this._values[t].property)),this._values[t].transition=tn(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let n=this.getValue(i);n!==void 0&&(t[i]=n);let r=this.getTransition(i);r!==void 0&&(t["".concat(i,"-transition")]=r)}return t}transitioned(t,i){let n=new So(this._properties);for(let r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(t,i._values[r]);return n}untransitioned(){let t=new So(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class wb{constructor(t,i,n,r,s){let b=r.delay||0,h=r.duration||0;s=s||0,this.property=t,this.value=i,this.begin=s+b,this.end=this.begin+h,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(t,i,n){let r=t.now||0,s=this.value.possiblyEvaluate(t,i,n),b=this.prior;if(b){if(r>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(r<this.begin)return b.possiblyEvaluate(t,i,n);{let h=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,i,n),s,Kt(h))}}return s}}class So{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,n){let r=new Vs(this._properties);for(let s of Object.keys(this._values))r._values[s]=this._values[s].possiblyEvaluate(t,i,n);return r}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class tW{constructor(t,i,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=i,this._options=n,this.isConfigDependent=!1}getValue(t){return tn(this._values[t].value)}setValue(t,i){this._values[t]=new Sd(this._values[t].property,i===null?void 0:tn(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){let t={};for(let i of Object.keys(this._values)){let n=this.getValue(i);n!==void 0&&(t[i]=n)}return t}possiblyEvaluate(t,i,n){let r=new Vs(this._properties);for(let s of Object.keys(this._values))r._values[s]=this._values[s].possiblyEvaluate(t,i,n);return r}}class Fr{constructor(t,i,n){this.property=t,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,n,r){return this.property.evaluate(this.value,this.parameters,t,i,n,r)}}class Vs{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class jt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,n){let r=hd[this.specification.type];return r?r(t,i,n):t}}class Ue{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,n,r){return new Fr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},n,r)}:t.expression,i)}interpolate(t,i,n){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new Fr(this,{kind:"constant",value:void 0},t.parameters);let r=hd[this.specification.type];return r?new Fr(this,{kind:"constant",value:r(t.value.value,i.value.value,n)},t.parameters):t}evaluate(t,i,n,r,s,b){return t.kind==="constant"?t.value:t.evaluate(i,n,r,s,b)}}class fo{constructor(t){this.specification=t}possiblyEvaluate(t,i,n,r){return!!t.expression.evaluate(i,null,{},n,r)}interpolate(){return!1}}class ea{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new ta(0,{});for(let n in t){let r=t[n];r.specification.overridable&&this.overridableProperties.push(n);let s=this.defaultPropertyValues[n]=new Sd(r,void 0),b=this.defaultTransitionablePropertyValues[n]=new zb(r);this.defaultTransitioningPropertyValues[n]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=s.possiblyEvaluate(i)}}}function Rs(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Gs(e){if(Array.isArray(e))return e.map(Gs);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){let t={};for(let i in e)t[i]=Gs(e[i]);return t}return Rs(e)}se(Ue,"DataDrivenProperty"),se(jt,"DataConstantProperty"),se(fo,"ColorRampProperty");var ut=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Eb(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(let t of e.slice(1))if(!Eb(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function kn(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Eb(e)||(e=Fs(e));let i=e,n=!0;try{n=function(u){if(!Ir(u))return u;let V=Gs(u);return Ab(V),V=C0(V),V}(i)}catch{console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(i,null,2),"\n        "))}let r=ut["filter_".concat(t)],s=Td(n,r),b=null;if(s.result==="error")throw new Error(s.value.map(u=>"".concat(u.key,": ").concat(u.message)).join(", "));b=(u,V,F)=>s.value.evaluate(u,V,{},F);let h=null,W=null;if(n!==i){let u=Td(i,r);if(u.result==="error")throw new Error(u.value.map(V=>"".concat(V.key,": ").concat(V.message)).join(", "));h=(V,F,U,X,y)=>u.value.evaluate(V,F,{},U,void 0,void 0,X,y),W=!hr(u.value.expression)}return{filter:b,dynamicFilter:h||void 0,needGeometry:T0(n),needFeature:!!W}}function C0(e){if(!Array.isArray(e))return e;let t=function(i){if(eW.has(i[0])){for(let n=1;n<i.length;n++)if(Ir(i[n]))return!0}return i}(e);return t===!0?t:t.map(i=>C0(i))}function Ab(e){let t=!1,i=[];if(e[0]==="case"){for(let n=1;n<e.length-1;n+=2)t=t||Ir(e[n]),i.push(e[n+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||Ir(e[1]);for(let n=2;n<e.length-1;n+=2)i.push(e[n+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||Ir(e[1]);for(let n=1;n<e.length-1;n+=2)i.push(e[n+1])}t&&(e.length=0,e.push("any",...i));for(let n=1;n<e.length;n++)Ab(e[n])}function Ir(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(Ir(e[i]))return!0;return!1}let eW=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function iW(e,t){return e<t?-1:e>t?1:0}function T0(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(T0(e[t]))return!0;return!1}function Fs(e){if(!e)return!0;let t=e[0];return e.length<=1?t!=="any":t==="=="?Is(e[1],e[2],"=="):t==="!="?Us(Is(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Is(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(Fs))):t==="all"?["all"].concat(e.slice(1).map(Fs)):t==="none"?["all"].concat(e.slice(1).map(Fs).map(Us)):t==="in"?Hb(e[1],e.slice(2)):t==="!in"?Us(Hb(e[1],e.slice(2))):t==="has"?k0(e[1]):t!=="!has"||Us(k0(e[1]));var i}function Is(e,t,i){switch(e){case"$type":return["filter-type-".concat(i),t];case"$id":return["filter-id-".concat(i),t];default:return["filter-".concat(i),e,t]}}function Hb(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(iW)]]:["filter-in-small",e,["literal",t]]}}function k0(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Us(e){return["!",e]}let fd="";function jb(e,t){return t?"".concat(e).concat(fd).concat(t):e}let xs="-transition";class xn extends ir{constructor(t,i,n,r){if(super(),this.id=t.id,this.fqid=jb(this.id,n),this.type=t.type,this.scope=n,this.options=r,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new tW(i.layout,this.scope,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new Ql(i.paint,this.scope,r);for(let s in t.paint)this.setPaintProperty(s,t.paint[s]);for(let s in t.layout)this.setLayoutProperty(s,t.layout[s]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vs(i.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i){if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);let n=this._unevaluatedLayout;n._properties.properties[t]&&(n.setValue(t,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return mn(t,xs)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i){let n=this._transitionablePaint,r=n._properties.properties;if(mn(t,xs)){let F=t.slice(0,-11);return r[F]&&n.setTransition(F,i||void 0),!1}if(!r[t])return!1;let s=n._values[t],b=s.value.isDataDriven(),h=s.value;n.setValue(t,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);let W=n._values[t].value,u=W.isDataDriven(),V=mn(t,"pattern")||t==="line-dasharray";return u||b||V||this._handleOverridablePaintPropertyUpdate(t,h,W)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i){return null}_handleOverridablePaintPropertyUpdate(t,i,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return Ca({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof Fr&&Bd(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=kn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}let aW={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vd{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Di{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ni(e,t=1){let i=0,n=0;return{members:e.map(r=>{let s=aW[r.type].BYTES_PER_ELEMENT,b=i=Ns(i,Math.max(t,s)),h=r.components||1;return n=Math.max(n,s),i+=s*h,{name:r.name,type:r.type,components:h,offset:b}}),size:Ns(i,Math.max(n,t)),alignment:t}}function Ns(e,t){return Math.ceil(e/t)*t}class sl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let r=2*t;return this.int16[r+0]=i,this.int16[r+1]=n,t}}sl.prototype.bytesPerElement=4,se(sl,"StructArrayLayout2i4");class Wn extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n){let r=this.length;return this.resize(r+1),this.emplace(r,t,i,n)}emplace(t,i,n,r){let s=3*t;return this.int16[s+0]=i,this.int16[s+1]=n,this.int16[s+2]=r,t}}Wn.prototype.bytesPerElement=6,se(Wn,"StructArrayLayout3i6");class Sl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,r){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,r)}emplace(t,i,n,r,s){let b=4*t;return this.int16[b+0]=i,this.int16[b+1]=n,this.int16[b+2]=r,this.int16[b+3]=s,t}}Sl.prototype.bytesPerElement=8,se(Sl,"StructArrayLayout4i8");class Ob extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s){let b=this.length;return this.resize(b+1),this.emplace(b,t,i,n,r,s)}emplace(t,i,n,r,s,b){let h=5*t;return this.int16[h+0]=i,this.int16[h+1]=n,this.int16[h+2]=r,this.int16[h+3]=s,this.int16[h+4]=b,t}}Ob.prototype.bytesPerElement=10,se(Ob,"StructArrayLayout5i10");class Db extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h){let W=this.length;return this.resize(W+1),this.emplace(W,t,i,n,r,s,b,h)}emplace(t,i,n,r,s,b,h,W){let u=6*t,V=12*t,F=3*t;return this.int16[u+0]=i,this.int16[u+1]=n,this.uint8[V+4]=r,this.uint8[V+5]=s,this.uint8[V+6]=b,this.uint8[V+7]=h,this.float32[F+2]=W,t}}Db.prototype.bytesPerElement=12,se(Db,"StructArrayLayout2i4ub1f12");class po extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,r)}emplace(t,i,n,r,s){let b=4*t;return this.float32[b+0]=i,this.float32[b+1]=n,this.float32[b+2]=r,this.float32[b+3]=s,t}}po.prototype.bytesPerElement=16,se(po,"StructArrayLayout4f16");class Wo extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s){let b=this.length;return this.resize(b+1),this.emplace(b,t,i,n,r,s)}emplace(t,i,n,r,s,b){let h=6*t,W=3*t;return this.uint16[h+0]=i,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=s,this.float32[W+2]=b,t}}Wo.prototype.bytesPerElement=12,se(Wo,"StructArrayLayout4ui1f12");class Ur extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,r){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,r)}emplace(t,i,n,r,s){let b=4*t;return this.uint16[b+0]=i,this.uint16[b+1]=n,this.uint16[b+2]=r,this.uint16[b+3]=s,t}}Ur.prototype.bytesPerElement=8,se(Ur,"StructArrayLayout4ui8");class Ld extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,r,s,b)}emplace(t,i,n,r,s,b,h){let W=6*t;return this.int16[W+0]=i,this.int16[W+1]=n,this.int16[W+2]=r,this.int16[W+3]=s,this.int16[W+4]=b,this.int16[W+5]=h,t}}Ld.prototype.bytesPerElement=12,se(Ld,"StructArrayLayout6i12");class Ys extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h,W,u,V,F,U){let X=this.length;return this.resize(X+1),this.emplace(X,t,i,n,r,s,b,h,W,u,V,F,U)}emplace(t,i,n,r,s,b,h,W,u,V,F,U,X){let y=12*t;return this.int16[y+0]=i,this.int16[y+1]=n,this.int16[y+2]=r,this.int16[y+3]=s,this.uint16[y+4]=b,this.uint16[y+5]=h,this.uint16[y+6]=W,this.uint16[y+7]=u,this.int16[y+8]=V,this.int16[y+9]=F,this.int16[y+10]=U,this.int16[y+11]=X,t}}Ys.prototype.bytesPerElement=24,se(Ys,"StructArrayLayout4i4ui4i24");class _b extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b){let h=this.length;return this.resize(h+1),this.emplace(h,t,i,n,r,s,b)}emplace(t,i,n,r,s,b,h){let W=10*t,u=5*t;return this.int16[W+0]=i,this.int16[W+1]=n,this.int16[W+2]=r,this.float32[u+2]=s,this.float32[u+3]=b,this.float32[u+4]=h,t}}_b.prototype.bytesPerElement=20,se(_b,"StructArrayLayout3i3f20");class Pb extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Pb.prototype.bytesPerElement=4,se(Pb,"StructArrayLayout1ul4");class Gl extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let r=2*t;return this.uint16[r+0]=i,this.uint16[r+1]=n,t}}Gl.prototype.bytesPerElement=4,se(Gl,"StructArrayLayout2ui4");class Kb extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h,W,u,V,F,U,X){let y=this.length;return this.resize(y+1),this.emplace(y,t,i,n,r,s,b,h,W,u,V,F,U,X)}emplace(t,i,n,r,s,b,h,W,u,V,F,U,X,y){let B=20*t,k=10*t;return this.int16[B+0]=i,this.int16[B+1]=n,this.int16[B+2]=r,this.int16[B+3]=s,this.int16[B+4]=b,this.float32[k+3]=h,this.float32[k+4]=W,this.float32[k+5]=u,this.float32[k+6]=V,this.int16[B+14]=F,this.uint32[k+8]=U,this.uint16[B+18]=X,this.uint16[B+19]=y,t}}Kb.prototype.bytesPerElement=40,se(Kb,"StructArrayLayout5i4f1i1ul2ui40");class Xs extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h){let W=this.length;return this.resize(W+1),this.emplace(W,t,i,n,r,s,b,h)}emplace(t,i,n,r,s,b,h,W){let u=8*t;return this.int16[u+0]=i,this.int16[u+1]=n,this.int16[u+2]=r,this.int16[u+4]=s,this.int16[u+5]=b,this.int16[u+6]=h,this.int16[u+7]=W,t}}Xs.prototype.bytesPerElement=16,se(Xs,"StructArrayLayout3i2i2i16");class zd extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s){let b=this.length;return this.resize(b+1),this.emplace(b,t,i,n,r,s)}emplace(t,i,n,r,s,b){let h=4*t,W=8*t;return this.float32[h+0]=i,this.float32[h+1]=n,this.float32[h+2]=r,this.int16[W+6]=s,this.int16[W+7]=b,t}}zd.prototype.bytesPerElement=16,se(zd,"StructArrayLayout2f1f2i16");class qb extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,r)}emplace(t,i,n,r,s){let b=12*t,h=3*t;return this.uint8[b+0]=i,this.uint8[b+1]=n,this.float32[h+1]=r,this.float32[h+2]=s,t}}qb.prototype.bytesPerElement=12,se(qb,"StructArrayLayout2ub2f12");class Qa extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n){let r=this.length;return this.resize(r+1),this.emplace(r,t,i,n)}emplace(t,i,n,r){let s=3*t;return this.uint16[s+0]=i,this.uint16[s+1]=n,this.uint16[s+2]=r,t}}Qa.prototype.bytesPerElement=6,se(Qa,"StructArrayLayout3ui6");class xr extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et){let $=this.length;return this.resize($+1),this.emplace($,t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et)}emplace(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et,$){let nt=30*t,dt=15*t,ht=60*t;return this.int16[nt+0]=i,this.int16[nt+1]=n,this.int16[nt+2]=r,this.float32[dt+2]=s,this.float32[dt+3]=b,this.uint16[nt+8]=h,this.uint16[nt+9]=W,this.uint32[dt+5]=u,this.uint32[dt+6]=V,this.uint32[dt+7]=F,this.uint16[nt+16]=U,this.uint16[nt+17]=X,this.uint16[nt+18]=y,this.float32[dt+10]=B,this.float32[dt+11]=k,this.uint8[ht+48]=S,this.uint8[ht+49]=A,this.uint8[ht+50]=D,this.uint32[dt+13]=O,this.int16[nt+28]=et,this.uint8[ht+58]=$,t}}xr.prototype.bytesPerElement=60,se(xr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class wd extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et,$,nt,dt,ht,gt,pt,xt,kt,Ft,Ct,Rt){let Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et,$,nt,dt,ht,gt,pt,xt,kt,Ft,Ct,Rt)}emplace(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et,$,nt,dt,ht,gt,pt,xt,kt,Ft,Ct,Rt,Bt){let _t=20*t,Qt=40*t,be=80*t;return this.float32[_t+0]=i,this.float32[_t+1]=n,this.int16[Qt+4]=r,this.int16[Qt+5]=s,this.int16[Qt+6]=b,this.int16[Qt+7]=h,this.int16[Qt+8]=W,this.int16[Qt+9]=u,this.int16[Qt+10]=V,this.int16[Qt+11]=F,this.int16[Qt+12]=U,this.uint16[Qt+13]=X,this.uint16[Qt+14]=y,this.uint16[Qt+15]=B,this.uint16[Qt+16]=k,this.uint16[Qt+17]=S,this.uint16[Qt+18]=A,this.uint16[Qt+19]=D,this.uint16[Qt+20]=O,this.uint16[Qt+21]=et,this.uint16[Qt+22]=$,this.uint16[Qt+23]=nt,this.uint16[Qt+24]=dt,this.uint16[Qt+25]=ht,this.uint16[Qt+26]=gt,this.uint16[Qt+27]=pt,this.uint32[_t+14]=xt,this.float32[_t+15]=kt,this.float32[_t+16]=Ft,this.float32[_t+17]=Ct,this.float32[_t+18]=Rt,this.uint8[be+76]=Bt,t}}wd.prototype.bytesPerElement=80,se(wd,"StructArrayLayout2f9i15ui1ul4f1ub80");class Js extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Js.prototype.bytesPerElement=4,se(Js,"StructArrayLayout1f4");class uo extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s){let b=this.length;return this.resize(b+1),this.emplace(b,t,i,n,r,s)}emplace(t,i,n,r,s,b){let h=5*t;return this.float32[h+0]=i,this.float32[h+1]=n,this.float32[h+2]=r,this.float32[h+3]=s,this.float32[h+4]=b,t}}uo.prototype.bytesPerElement=20,se(uo,"StructArrayLayout5f20");class $b extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h){let W=this.length;return this.resize(W+1),this.emplace(W,t,i,n,r,s,b,h)}emplace(t,i,n,r,s,b,h,W){let u=7*t;return this.float32[u+0]=i,this.float32[u+1]=n,this.float32[u+2]=r,this.float32[u+3]=s,this.float32[u+4]=b,this.float32[u+5]=h,this.float32[u+6]=W,t}}$b.prototype.bytesPerElement=28,se($b,"StructArrayLayout7f28");class ys extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,n,r){let s=this.length;return this.resize(s+1),this.emplace(s,t,i,n,r)}emplace(t,i,n,r,s){let b=6*t;return this.uint32[3*t+0]=i,this.uint16[b+2]=n,this.uint16[b+3]=r,this.uint16[b+4]=s,t}}ys.prototype.bytesPerElement=12,se(ys,"StructArrayLayout1ul3ui12");class tm extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}tm.prototype.bytesPerElement=2,se(tm,"StructArrayLayout1ui2");class vo extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n){let r=this.length;return this.resize(r+1),this.emplace(r,t,i,n)}emplace(t,i,n,r){let s=3*t;return this.float32[s+0]=i,this.float32[s+1]=n,this.float32[s+2]=r,t}}vo.prototype.bytesPerElement=12,se(vo,"StructArrayLayout3f12");class Bs extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let n=this.length;return this.resize(n+1),this.emplace(n,t,i)}emplace(t,i,n){let r=2*t;return this.float32[r+0]=i,this.float32[r+1]=n,t}}Bs.prototype.bytesPerElement=8,se(Bs,"StructArrayLayout2f8");class em extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k){let S=this.length;return this.resize(S+1),this.emplace(S,t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k)}emplace(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S){let A=16*t;return this.float32[A+0]=i,this.float32[A+1]=n,this.float32[A+2]=r,this.float32[A+3]=s,this.float32[A+4]=b,this.float32[A+5]=h,this.float32[A+6]=W,this.float32[A+7]=u,this.float32[A+8]=V,this.float32[A+9]=F,this.float32[A+10]=U,this.float32[A+11]=X,this.float32[A+12]=y,this.float32[A+13]=B,this.float32[A+14]=k,this.float32[A+15]=S,t}}em.prototype.bytesPerElement=64,se(em,"StructArrayLayout16f64");class Ms extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,n,r,s,b,h){let W=this.length;return this.resize(W+1),this.emplace(W,t,i,n,r,s,b,h)}emplace(t,i,n,r,s,b,h,W){let u=10*t,V=5*t;return this.uint16[u+0]=i,this.uint16[u+1]=n,this.uint16[u+2]=r,this.uint16[u+3]=s,this.float32[V+2]=b,this.float32[V+3]=h,this.float32[V+4]=W,t}}Ms.prototype.bytesPerElement=20,se(Ms,"StructArrayLayout4ui3f20");class im extends Di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}im.prototype.bytesPerElement=1,se(im,"StructArrayLayout1ub1");class Q0 extends vd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Q0.prototype.size=40;class S0 extends Kb{get(t){return new Q0(this,t)}}se(S0,"CollisionBoxArray");class f0 extends vd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}f0.prototype.size=60;class v0 extends xr{get(t){return new f0(this,t)}}se(v0,"PlacedSymbolArray");class L0 extends vd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}L0.prototype.size=80;class z0 extends wd{get(t){return new L0(this,t)}}se(z0,"SymbolInstanceArray");class w0 extends Js{getoffsetX(t){return this.float32[1*t+0]}}se(w0,"GlyphOffsetArray");class Cs extends sl{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}se(Cs,"SymbolLineVertexArray");class E0 extends vd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}E0.prototype.size=12;class A0 extends ys{get(t){return new E0(this,t)}}se(A0,"FeatureIndexArray");class Ts extends Gl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}se(Ts,"FillExtrusionCentroidArray");let nW=Ni([{name:"a_pos",components:2,type:"Int16"}],4),H0=Ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class da{constructor(t=[]){this.segments=t}_prepareSegment(t,i,n,r){let s=this.segments[this.segments.length-1];return t>da.MAX_VERTEX_ARRAY_LENGTH&&ji("Max vertices per segment is ".concat(da.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t)),(!s||s.vertexLength+t>da.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==r)&&(s={vertexOffset:i,primitiveOffset:n,vertexLength:0,primitiveLength:0},r!==void 0&&(s.sortKey=r),this.segments.push(s)),s}prepareSegment(t,i,n,r){return this._prepareSegment(t,i.length,n.length,r)}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,n,r){return new da([{vertexOffset:t,primitiveOffset:i,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}function am(e,t){return 256*(e=ke(Math.floor(e),0,255))+ke(Math.floor(t),0,255)}da.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,se(da,"SegmentVector");let j0=Ni([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),O0=Ni([{name:"a_dash",components:4,type:"Uint16"}]);var ks={exports:{}},Ed={exports:{}};(function(e){e.exports=function(t,i){var n,r,s,b,h,W,u,V;for(r=t.length-(n=3&t.length),s=i,h=3432918353,W=461845907,V=0;V<r;)u=255&t.charCodeAt(V)|(255&t.charCodeAt(++V))<<8|(255&t.charCodeAt(++V))<<16|(255&t.charCodeAt(++V))<<24,++V,s=27492+(65535&(b=5*(65535&(s=(s^=u=(65535&(u=(u=(65535&u)*h+(((u>>>16)*h&65535)<<16)&4294967295)<<15|u>>>17))*W+(((u>>>16)*W&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(V+2))<<16;case 2:u^=(255&t.charCodeAt(V+1))<<8;case 1:s^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(V)))*h+(((u>>>16)*h&65535)<<16)&4294967295)<<15|u>>>17))*W+(((u>>>16)*W&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}})(Ed);var nm=Ed.exports,D0={exports:{}};(function(e){e.exports=function(t,i){for(var n,r=t.length,s=i^r,b=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(b)|(255&t.charCodeAt(++b))<<8|(255&t.charCodeAt(++b))<<16|(255&t.charCodeAt(++b))<<24))+((1540483477*(n>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++b;switch(r){case 3:s^=(255&t.charCodeAt(b+2))<<16;case 2:s^=(255&t.charCodeAt(b+1))<<8;case 1:s=1540483477*(65535&(s^=255&t.charCodeAt(b)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}})(D0);var _0=nm,P0=D0.exports;ks.exports=_0,ks.exports.murmur3=_0,ks.exports.murmur2=P0;var lm=Ee(ks.exports);class Qs{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,n,r){this.ids.push(K0(t)),this.positions.push(i,n,r)}eachPosition(t,i){let n=K0(t),r=0,s=this.ids.length-1;for(;r<s;){let b=r+s>>1;this.ids[b]>=n?s=b:r=b+1}for(;this.ids[r]===n;)i(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(t,i){let n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return om(n,r,0,n.length-1),i&&(i.add(n.buffer),i.add(r.buffer)),{ids:n,positions:r}}static deserialize(t){let i=new Qs,n;i.ids=t.ids,i.positions=t.positions;for(let r of i.ids)r!==n&&i.uniqueIds.push(r),n=r;return i.indexed=!0,i}}function K0(e){let t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:lm(String(e))}function om(e,t,i,n){for(;i<n;){let r=e[i+n>>1],s=i-1,b=n+1;for(;;){do s++;while(e[s]<r);do b--;while(e[b]>r);if(s>=b)break;Ad(e,s,b),Ad(t,3*s,3*b),Ad(t,3*s+1,3*b+1),Ad(t,3*s+2,3*b+2)}b-i<n-b?(om(e,t,i,b),i=b+1):(om(e,t,b+1,n),n=b)}}function Ad(e,t,i){let n=e[t];e[t]=e[i],e[i]=n}se(Qs,"FeaturePositionMap");class fl{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class Hd extends fl{constructor(t){super(t),this.current=0}set(t,i,n){this.fetchUniformLocation(t,i)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class sn extends fl{constructor(t){super(t),this.current=0}set(t,i,n){this.fetchUniformLocation(t,i)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Zo extends fl{constructor(t){super(t),this.current=[0,0]}set(t,i,n){this.fetchUniformLocation(t,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class q0 extends fl{constructor(t){super(t),this.current=[0,0,0]}set(t,i,n){this.fetchUniformLocation(t,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class d extends fl{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,n){this.fetchUniformLocation(t,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class a extends fl{constructor(t){super(t),this.current=ga.transparent}set(t,i,n){this.fetchUniformLocation(t,i)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}let l=new Float32Array(16);class c extends fl{constructor(t){super(t),this.current=l}set(t,i,n){if(this.fetchUniformLocation(t,i)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let r=1;r<16;r++)if(n[r]!==this.current[r]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}let m=new Float32Array(9),p=new Float32Array(4);class Z extends fl{constructor(t){super(t),this.current=p}set(t,i,n){if(this.fetchUniformLocation(t,i)){for(let r=0;r<4;r++)if(n[r]!==this.current[r]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}}function R(e){return[am(255*e.r,255*e.g),am(255*e.b,255*e.a)]}class I{constructor(t,i,n){this.value=t,this.uniformNames=i.map(r=>"u_".concat(r)),this.type=n}setUniform(t,i,n,r,s){i.set(t,s,r.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new a(t):new sn(t)}}class N{constructor(t,i){this.uniformNames=i.map(n=>"u_".concat(n)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,n,r,s){let b=s==="u_pattern"||s==="u_dash"?this.pattern:s==="u_pixel_ratio"?this.pixelRatio:null;b&&i.set(t,s,b)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new d(t):new sn(t)}}class Y{constructor(t,i,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map(s=>({name:"a_".concat(s),type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(t,i,n,r,s,b,h){let W=this.paintVertexArray.length,u=this.expression.evaluate(new ta(0,{brightness:b}),i,{},s,r,h);this.paintVertexArray.resize(t),this._setPaintValue(W,t,u)}updatePaintArray(t,i,n,r,s,b,h){let W=this.expression.evaluate({zoom:0,brightness:h},n,r,void 0,s);this._setPaintValue(t,i,W)}_setPaintValue(t,i,n){if(this.type==="color"){let r=R(n);for(let s=t;s<i;s++)this.paintVertexArray.emplace(s,r[0],r[1])}else{for(let r=t;r<i;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class J{constructor(t,i,n,r,s,b){this.expression=t,this.uniformNames=i.map(h=>"u_".concat(h,"_t")),this.type=n,this.useIntegerZoom=r,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:"a_".concat(h),type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(t,i,n,r,s,b,h){let W=this.expression.evaluate(new ta(this.zoom,{brightness:b}),i,{},s,r,h),u=this.expression.evaluate(new ta(this.zoom+1,{brightness:b}),i,{},s,r,h),V=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(V,t,W,u)}updatePaintArray(t,i,n,r,s,b,h){let W=this.expression.evaluate({zoom:this.zoom,brightness:h},n,r,void 0,s),u=this.expression.evaluate({zoom:this.zoom+1,brightness:h},n,r,void 0,s);this._setPaintValue(t,i,W,u)}_setPaintValue(t,i,n,r){if(this.type==="color"){let s=R(n),b=R(r);for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,s[0],s[1],b[0],b[1])}else{for(let s=t;s<i;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,n,r,s){let b=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=ke(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);i.set(t,s,h)}getBinding(t,i){return new sn(t)}}class M{constructor(t,i,n,r,s){this.expression=t,this.layerId=s,this.paintVertexAttributes=(n==="array"?O0:j0).members;for(let b=0;b<i.length;++b);this.paintVertexArray=new r}populatePaintArray(t,i,n){let r=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(r,t,i.patterns&&i.patterns[this.layerId],n)}updatePaintArray(t,i,n,r,s,b,h){this._setPaintValues(t,i,n.patterns&&n.patterns[this.layerId],b)}_setPaintValues(t,i,n,r){if(!r||!n)return;let s=r[n];if(!s)return;let{tl:b,br:h,pixelRatio:W}=s;for(let u=t;u<i;u++)this.paintVertexArray.emplace(u,b[0],b[1],h[0],h[1],W)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class T{constructor(t,i,n=()=>!0){this.binders={},this._buffers=[];let r=[];for(let s in t.paint._values){let b=t.paint.get(s);if(!n(s)||!(b instanceof Fr&&Bd(b.property.specification)))continue;let h=z(s,t.type),W=b.value,u=b.property.specification.type,V=!!b.property.useIntegerZoom,F=s==="line-dasharray"||s.endsWith("pattern"),U=s==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(W.kind!=="constant"||U)if(W.kind==="source"||U||F){let X=P(s,u,"source");this.binders[s]=F?new M(W,h,u,X,t.id):new Y(W,h,u,X),r.push("/a_".concat(s))}else{let X=P(s,u,"composite");this.binders[s]=new J(W,h,u,V,i,X),r.push("/z_".concat(s))}else this.binders[s]=F?new N(W.value,h):new I(W.value,h,u),r.push("/u_".concat(s))}this.cacheKey=r.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof Y||i instanceof J?i.maxValue:0}populatePaintArrays(t,i,n,r,s,b,h){for(let W in this.binders){let u=this.binders[W];(u instanceof Y||u instanceof J||u instanceof M)&&u.populatePaintArray(t,i,n,r,s,b,h)}}setConstantPatternPositions(t){for(let i in this.binders){let n=this.binders[i];n instanceof N&&n.setConstantPatternPositions(t)}}updatePaintArrays(t,i,n,r,s,b,h,W){let u=!1,V=Object.keys(t),F=V.length!==0,U=F?V:i.uniqueIds;for(let X in this.binders){let y=this.binders[X];if((y instanceof Y||y instanceof J||y instanceof M)&&(y.expression.isStateDependent===!0||y.expression.isLightConstant===!1)){let B=s.paint.get(X);y.expression=B.value;for(let k of U){let S=t[k.toString()];i.eachPosition(k,(A,D,O)=>{let et=r.feature(A);y.updatePaintArray(D,O,et,S,b,h,W)})}if(!F)for(let k of n.uniqueIds){let S=t[k.toString()];n.eachPosition(k,(A,D,O)=>{let et=r.feature(A);y.updatePaintArray(D,O,et,S,b,h,W)})}u=!0}}return u}defines(){let t=[];for(let i in this.binders){let n=this.binders[i];(n instanceof I||n instanceof N)&&t.push(...n.uniformNames.map(r=>"#define HAS_UNIFORM_".concat(r)))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let n=this.binders[i];if(n instanceof Y||n instanceof J||n instanceof M)for(let r=0;r<n.paintVertexAttributes.length;r++)t.push(n.paintVertexAttributes[r].name)}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let n=this.binders[i];if(n instanceof I||n instanceof N||n instanceof J)for(let r of n.uniformNames)t.push(r)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){let i=[];for(let n in this.binders){let r=this.binders[n];if(r instanceof I||r instanceof N||r instanceof J)for(let s of r.uniformNames)i.push({name:s,property:n,binding:r.getBinding(t,s)})}return i}setUniforms(t,i,n,r,s){for(let{name:b,property:h,binding:W}of n)this.binders[h].setUniform(t,W,s,r.get(h),b)}updatePaintBuffers(){this._buffers=[];for(let t in this.binders){let i=this.binders[t];(i instanceof Y||i instanceof J||i instanceof M)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(let i in this.binders){let n=this.binders[i];(n instanceof Y||n instanceof J||n instanceof M)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof Y||i instanceof J||i instanceof M)&&i.destroy()}}}class v{constructor(t,i,n=()=>!0){this.programConfigurations={};for(let r of t)this.programConfigurations[r.id]=new T(r,i,n);this.needsUpload=!1,this._featureMap=new Qs,this._featureMapWithoutIds=new Qs,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,n,r,s,b,h,W){for(let u in this.programConfigurations)this.programConfigurations[u].populatePaintArrays(t,i,r,s,b,h,W);i.id!==void 0?this._featureMap.add(i.id,n,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,n,r,s,b){for(let h of n)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,h,r,s,b||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}let f={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function z(e,t){return f[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}let Q={"line-pattern":{source:Wo,composite:Wo},"fill-pattern":{source:Wo,composite:Wo},"fill-extrusion-pattern":{source:Wo,composite:Wo},"line-dasharray":{source:Ur,composite:Ur}},E={color:{source:Bs,composite:po},number:{source:Js,composite:Bs}};function P(e,t,i){let n=Q[e];return n&&n[i]||E[t][i]}se(I,"ConstantBinder"),se(N,"PatternConstantBinder"),se(Y,"SourceExpressionBinder"),se(M,"PatternCompositeBinder"),se(J,"CompositeExpressionBinder"),se(T,"ProgramConfiguration",{omit:["_buffers"]}),se(v,"ProgramConfigurationSet");let H=ie/Math.PI/2,K=5,w=6,q=16383,it=64,at=[it,32,16],rt=-H,Zt=H;function bt(e,t,i,n=H){return i=ye(i),[e*Math.sin(i)*n,-t*n,e*Math.cos(i)*n]}function It(e,t,i){return bt(Math.cos(ye(e)),Math.sin(ye(e)),t,i)}let Gt=63710088e-1,St=2*Math.PI*Gt;class mt{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(i,")"));if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mt(Ma(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(t){let i=Math.PI/180,n=this.lat*i,r=t.lat*i,s=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*i);return Gt*Math.acos(Math.min(s,1))}toBounds(t=0){let i=360*t/40075017,n=i/Math.cos(Math.PI/180*this.lat);return new Vt({lng:this.lng-n,lat:this.lat-i},{lng:this.lng+n,lat:this.lat+i})}toEcef(t){return It(this.lat,this.lng,H+t*H/Gt)}static convert(t){if(t instanceof mt)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new mt(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new mt(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Vt{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof mt?new mt(t.lng,t.lat):mt.convert(t),this}setSouthWest(t){return this._sw=t instanceof mt?new mt(t.lng,t.lat):mt.convert(t),this}extend(t){let i=this._sw,n=this._ne,r,s;if(t instanceof mt)r=t,s=t;else{if(!(t instanceof Vt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Vt.convert(t)):this.extend(mt.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(mt.convert(t)):this;if(r=t._sw,s=t._ne,!r||!s)return this}return i||n?(i.lng=Math.min(r.lng,i.lng),i.lat=Math.min(r.lat,i.lat),n.lng=Math.max(s.lng,n.lng),n.lat=Math.max(s.lat,n.lat)):(this._sw=new mt(r.lng,r.lat),this._ne=new mt(s.lng,s.lat)),this}getCenter(){return new mt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mt(this.getWest(),this.getNorth())}getSouthEast(){return new mt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(t){let{lng:i,lat:n}=mt.convert(t),r=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(t){return!t||t instanceof Vt?t:new Vt(t)}}var ot={};(function(e,t){(function(i){function n(s,b,h){var W=r(256*s,256*(b=Math.pow(2,h)-b-1),h),u=r(256*(s+1),256*(b+1),h);return W[0]+","+W[1]+","+u[0]+","+u[1]}function r(s,b,h){var W=2*Math.PI*6378137/256/Math.pow(2,h);return[s*W-2*Math.PI*6378137/2,b*W-2*Math.PI*6378137/2]}i.getURL=function(s,b,h,W,u,V){return V=V||{},s+"?"+["bbox="+n(h,W,u),"format="+(V.format||"image/png"),"service="+(V.service||"WMS"),"version="+(V.version||"1.1.1"),"request="+(V.request||"GetMap"),"srs="+(V.srs||"EPSG:3857"),"width="+(V.width||256),"height="+(V.height||256),"layers="+b].join("&")},i.getTileBBox=n,i.getMercCoords=r,Object.defineProperty(i,"__esModule",{value:!0})})(t)})(0,ot);var Wt=ot;class ft{constructor(t,i,n){this.z=t,this.x=i,this.y=n,this.key=$t(0,t,t,i,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){let n=Wt.getTileBBox(this.x,this.y,this.z),r=function(s,b,h){let W,u="";for(let V=s;V>0;V--)W=1<<V-1,u+=(b&W?1:0)+(h&W?2:0);return u}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",n)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class At{constructor(t,i){this.wrap=t,this.canonical=i,this.key=$t(t,i.z,i.z,i.x,i.y)}}class Et{constructor(t,i,n,r,s){this.overscaledZ=t,this.wrap=i,this.canonical=new ft(n,+r,+s),this.key=i===0&&t===n?this.canonical.key:$t(i,t,n,r,s)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){let i=this.canonical.z-t;return t>this.canonical.z?new Et(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Et(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return $t(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{let n=this.canonical.z-t;return $t(this.wrap*+i,t,t,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;let i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Et(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Et(i,this.wrap,i,n,r),new Et(i,this.wrap,i,n+1,r),new Et(i,this.wrap,i,n,r+1),new Et(i,this.wrap,i,n+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Et(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Et(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new At(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function $t(e,t,i,n,r){let s=1<<Math.min(i,22),b=s*(r%s)+n%s;return e&&i<22&&(b+=s*s*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*b+i)+(t-i)}let me=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new Et(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new Et(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new Et(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new Et(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];se(ft,"CanonicalTileID"),se(Et,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Ie=0,ue=25.5;function Re(e){return St*Math.cos(e*Math.PI/180)}function Ae(e){return(180+e)/360}function Me(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function fe(e,t){return e/Re(t)}function Qe(e){return 360*e-180}function si(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function fi(e,t){return e*Re(si(t))}let $e=85.051129;function ia(e){return Math.cos(ye(ke(e,-$e,$e)))}function ti(e,t){let i=ke(t,Ie,ue),n=Math.pow(2,i);return ia(e)*St/(512*n)}function pi(e){return 1/Math.cos(e*Math.PI/180)}function ei(e,t=0){let i=Math.exp(Math.PI*(1-(e.y+t/ie)/(1<<e.z)*2));return 80150034*i/(i*i+1)/ie/(1<<e.z)}class mi{constructor(t,i,n=0){this.x=+t,this.y=+i,this.z=+n}static fromLngLat(t,i=0){let n=mt.convert(t);return new mi(Ae(n.lng),Me(n.lat),fe(i,n.lat))}toLngLat(){return new mt(Qe(this.x),si(this.y))}toAltitude(){return fi(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/St*pi(si(this.y))}}function Ei(e,t,i,n,r,s,b,h,W){let u=(t+n)/2,V=(i+r)/2,F=new Nt(u,V);h(F),function(U,X,y,B,k,S){let A=y-k,D=B-S;return Math.abs((B-X)*A-(y-U)*D)/Math.hypot(A,D)}(F.x,F.y,s.x,s.y,b.x,b.y)>=W?(Ei(e,t,i,u,V,s,F,h,W),Ei(e,u,V,n,r,F,b,h,W)):e.push(b)}function Ri(e,t,i){let n=e[0],r=n.x,s=n.y;t(n);let b=[n];for(let h=1;h<e.length;h++){let W=e[h],{x:u,y:V}=W;t(W),Ei(b,r,s,u,V,n,W,t,i),r=u,s=V,n=W}return b}function Sa(e,t,i,n){if(n(t,i)){let r=t.add(i)._mult(.5);Sa(e,t,r,n),Sa(e,r,i,n)}else e.push(i)}function Ka(e,t){let i=e[0],n=[i];for(let r=1;r<e.length;r++){let s=e[r];Sa(n,i,s,t),i=s}return n}let Nn=Math.pow(2,14)-1,Fl=-Nn-1;function Yn(e,t){let i=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=ke(i,Fl,Nn),e.y=ke(n,Fl,Nn),(i<e.x||i>e.x+1||n<e.y||n>e.y+1)&&ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function fa(e,t,i){let n=e.loadGeometry(),r=e.extent,s=ie/r;if(t&&i&&i.projection.isReprojectedInTileSpace){let b=1<<t.z,{scale:h,x:W,y:u,projection:V}=i,F=U=>{let X=Qe((t.x+U.x/r)/b),y=si((t.y+U.y/r)/b),B=V.project(X,y);U.x=(B.x*h-W)*r,U.y=(B.y*h-u)*r};for(let U=0;U<n.length;U++)if(e.type!==1)n[U]=Ri(n[U],F,1);else{let X=[];for(let y of n[U])y.x<0||y.x>=r||y.y<0||y.y>=r||(F(y),X.push(y));n[U]=X}}for(let b of n)for(let h of b)Yn(h,s);return n}function xa(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?fa(e):[]}}function dn(e,t,i,n,r){e.emplaceBack(2*t+(n+1)/2,2*i+(r+1)/2)}function un(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Xn{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new sl,this.indexArray=new Qa,this.segments=new da,this.programConfigurations=new v(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,n,r){let s=this.layers[0],b=[],h=null;s.type==="circle"&&(h=s.layout.get("circle-sort-key"));for(let{feature:u,id:V,index:F,sourceLayerIndex:U}of t){let X=this.layers[0]._featureFilter.needGeometry,y=xa(u,X);if(!this.layers[0]._featureFilter.filter(new ta(this.zoom),y,n))continue;let B=h?h.evaluate(y,{},n):void 0,k={id:V,properties:u.properties,type:u.type,sourceLayerIndex:U,index:F,geometry:X?y.geometry:fa(u,n,r),patterns:{},sortKey:B};b.push(k)}h&&b.sort((u,V)=>u.sortKey-V.sortKey);let W=null;r.projection.name==="globe"&&(this.globeExtVertexArray=new Ld,W=r.projection);for(let u of b){let{geometry:V,index:F,sourceLayerIndex:U}=u,X=t[F].feature;this.addFeature(u,V,F,i.availableImages,n,W,i.brightness),i.featureIndex.insert(X,V,F,U,this.index)}}update(t,i,n,r,s){let b=Object.keys(t).length!==0;b&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,b?this.stateDependentLayers:this.layers,n,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nW.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,H0.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,n,r,s,b,h){for(let W of i)for(let u of W){let V=u.x,F=u.y;if(V<0||V>=ie||F<0||F>=ie)continue;if(b){let y=b.projectTilePoint(V,F,s),B=b.upVector(s,V,F),k=this.globeExtVertexArray;un(k,y,B),un(k,y,B),un(k,y,B),un(k,y,B)}let U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),X=U.vertexLength;dn(this.layoutVertexArray,V,F,-1,-1),dn(this.layoutVertexArray,V,F,1,-1),dn(this.layoutVertexArray,V,F,1,1),dn(this.layoutVertexArray,V,F,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r,s,h)}}function Il(e,t){for(let i=0;i<e.length;i++)if(vl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(vl(e,t[i]))return!0;return!!fs(e,t)}function go(e,t,i){return!!vl(e,t)||!!vs(t,e,i)}function Lo(e,t){if(e.length===1)return jd(t,e[0]);for(let i=0;i<t.length;i++){let n=t[i];for(let r=0;r<n.length;r++)if(vl(e,n[r]))return!0}for(let i=0;i<e.length;i++)if(jd(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(fs(e,t[i]))return!0;return!1}function Ss(e,t,i){if(e.length>1){if(fs(e,t))return!0;for(let n=0;n<t.length;n++)if(vs(t[n],e,i))return!0}for(let n=0;n<e.length;n++)if(vs(e[n],t,i))return!0;return!1}function fs(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){let n=e[i],r=e[i+1];for(let s=0;s<t.length-1;s++)if(rm(n,r,t[s],t[s+1]))return!0}return!1}function rm(e,t,i,n){return Vn(e,i,n)!==Vn(t,i,n)&&Vn(e,t,i)!==Vn(e,t,n)}function vs(e,t,i){let n=i*i;if(t.length===1)return e.distSqr(t[0])<n;for(let r=1;r<t.length;r++)if(Nr(e,t[r-1],t[r])<n)return!0;return!1}function Nr(e,t,i){let n=t.distSqr(i);if(n===0)return e.distSqr(t);let r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function jd(e,t){let i,n,r,s=!1;for(let b=0;b<e.length;b++){i=e[b];for(let h=0,W=i.length-1;h<i.length;W=h++)n=i[h],r=i[W],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(s=!s)}return s}function vl(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){let s=e[n],b=e[r];s.y>t.y!=b.y>t.y&&t.x<(b.x-s.x)*(t.y-s.y)/(b.y-s.y)+s.x&&(i=!i)}return i}function Ju(e,t,i,n,r){for(let b of e)if(t<=b.x&&i<=b.y&&n>=b.x&&r>=b.y)return!0;let s=[new Nt(t,i),new Nt(t,r),new Nt(n,r),new Nt(n,i)];if(e.length>2){for(let b of s)if(vl(e,b))return!0}for(let b=0;b<e.length-1;b++)if(ZU(e[b],e[b+1],s))return!0;return!1}function ZU(e,t,i){let n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return!1;let s=Vn(e,t,i[0]);return s!==Vn(e,t,i[1])||s!==Vn(e,t,i[2])||s!==Vn(e,t,i[3])}function Od(e,t,i,n,r,s){let b=t.y-e.y,h=e.x-t.x;if(s=s||0){let W=b*b+h*h;if(W===0)return!0;let u=Math.sqrt(W);b/=u,h/=u}return!((i.x-e.x)*b+(i.y-e.y)*h-s<0||(n.x-e.x)*b+(n.y-e.y)*h-s<0||(r.x-e.x)*b+(r.y-e.y)*h-s<0)}function lW(e,t,i,n,r,s,b){return!(Od(e,t,n,r,s,b)||Od(t,i,n,r,s,b)||Od(i,e,n,r,s,b)||Od(n,r,e,t,i,b)||Od(r,s,e,t,i,b)||Od(s,n,e,t,i,b))}function Dd(e,t,i){let n=t.paint.get(e).value;return n.kind==="constant"?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function $0(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function yu(e,t,i,n,r){if(!t[0]&&!t[1])return e;let s=Nt.convert(t)._mult(r);i==="viewport"&&s._rotate(-n);let b=[];for(let h=0;h<e.length;h++)b.push(e[h].sub(s));return b}function Bu(e,t,i,n){let r=Nt.convert(e)._mult(n);return t==="viewport"&&r._rotate(-i),r}se(Xn,"CircleBucket",{omit:["layers"]});let gU=new ea({"circle-sort-key":new Ue(ut.layout_circle["circle-sort-key"]),visibility:new jt(ut.layout_circle.visibility)});var VU={paint:new ea({"circle-radius":new Ue(ut.paint_circle["circle-radius"]),"circle-color":new Ue(ut.paint_circle["circle-color"]),"circle-blur":new Ue(ut.paint_circle["circle-blur"]),"circle-opacity":new Ue(ut.paint_circle["circle-opacity"]),"circle-translate":new jt(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ue(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ue(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ue(ut.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new jt(ut.paint_circle["circle-emissive-strength"])}),layout:gU},La={},za={};Object.defineProperty(za,"__esModule",{value:!0}),za.setMatrixArrayType=function(e){za.ARRAY_TYPE=Cu=e},za.toRadian=function(e){return e*GU},za.equals=function(e,t){return Math.abs(e-t)<=Mu*Math.max(1,Math.abs(e),Math.abs(t))},za.RANDOM=za.ARRAY_TYPE=za.EPSILON=void 0;var Mu=1e-6;za.EPSILON=Mu;var Cu=typeof Float32Array<"u"?Float32Array:Array;za.ARRAY_TYPE=Cu;var RU=Math.random;za.RANDOM=RU;var GU=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var aa={};function oW(e){return oW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oW(e)}Object.defineProperty(aa,"__esModule",{value:!0}),aa.create=function(){var e=new Yr.ARRAY_TYPE(4);return Yr.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},aa.clone=function(e){var t=new Yr.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},aa.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},aa.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},aa.fromValues=function(e,t,i,n){var r=new Yr.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},aa.set=function(e,t,i,n,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e},aa.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},aa.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=i*s-r*n;return b?(e[0]=s*(b=1/b),e[1]=-n*b,e[2]=-r*b,e[3]=i*b,e):null},aa.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},aa.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},aa.multiply=ku,aa.rotate=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=Math.sin(i),W=Math.cos(i);return e[0]=n*W+s*h,e[1]=r*W+b*h,e[2]=n*-h+s*W,e[3]=r*-h+b*W,e},aa.scale=function(e,t,i){var n=t[1],r=t[2],s=t[3],b=i[0],h=i[1];return e[0]=t[0]*b,e[1]=n*b,e[2]=r*h,e[3]=s*h,e},aa.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e},aa.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},aa.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},aa.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},aa.LDU=function(e,t,i,n){return e[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-e[2]*i[1],[e,t,i]},aa.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},aa.subtract=Qu,aa.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},aa.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],b=t[0],h=t[1],W=t[2],u=t[3];return Math.abs(i-b)<=Yr.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-h)<=Yr.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-W)<=Yr.EPSILON*Math.max(1,Math.abs(r),Math.abs(W))&&Math.abs(s-u)<=Yr.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},aa.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},aa.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},aa.sub=aa.mul=void 0;var Yr=function(e,t){if(e&&e.__esModule)return e;if(e===null||oW(e)!=="object"&&typeof e!="function")return{default:e};var i=Tu(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function Tu(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Tu=function(n){return n?i:t})(e)}function ku(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=i[0],W=i[1],u=i[2],V=i[3];return e[0]=n*h+s*W,e[1]=r*h+b*W,e[2]=n*u+s*V,e[3]=r*u+b*V,e}function Qu(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}aa.mul=ku,aa.sub=Qu;var oa={};function rW(e){return rW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rW(e)}Object.defineProperty(oa,"__esModule",{value:!0}),oa.create=function(){var e=new Vo.ARRAY_TYPE(6);return Vo.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},oa.clone=function(e){var t=new Vo.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},oa.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},oa.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},oa.fromValues=function(e,t,i,n,r,s){var b=new Vo.ARRAY_TYPE(6);return b[0]=e,b[1]=t,b[2]=i,b[3]=n,b[4]=r,b[5]=s,b},oa.set=function(e,t,i,n,r,s,b){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=b,e},oa.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=i*s-n*r;return W?(e[0]=s*(W=1/W),e[1]=-n*W,e[2]=-r*W,e[3]=i*W,e[4]=(r*h-s*b)*W,e[5]=(n*b-i*h)*W,e):null},oa.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},oa.multiply=fu,oa.rotate=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=Math.sin(i),V=Math.cos(i);return e[0]=n*V+s*u,e[1]=r*V+b*u,e[2]=n*-u+s*V,e[3]=r*-u+b*V,e[4]=h,e[5]=W,e},oa.scale=function(e,t,i){var n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=i[0],u=i[1];return e[0]=t[0]*W,e[1]=n*W,e[2]=r*u,e[3]=s*u,e[4]=b,e[5]=h,e},oa.translate=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=i[0],V=i[1];return e[0]=n,e[1]=r,e[2]=s,e[3]=b,e[4]=n*u+s*V+h,e[5]=r*u+b*V+W,e},oa.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e[4]=0,e[5]=0,e},oa.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},oa.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},oa.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},oa.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},oa.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},oa.subtract=vu,oa.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},oa.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e},oa.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},oa.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],b=e[4],h=e[5],W=t[0],u=t[1],V=t[2],F=t[3],U=t[4],X=t[5];return Math.abs(i-W)<=Vo.EPSILON*Math.max(1,Math.abs(i),Math.abs(W))&&Math.abs(n-u)<=Vo.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-V)<=Vo.EPSILON*Math.max(1,Math.abs(r),Math.abs(V))&&Math.abs(s-F)<=Vo.EPSILON*Math.max(1,Math.abs(s),Math.abs(F))&&Math.abs(b-U)<=Vo.EPSILON*Math.max(1,Math.abs(b),Math.abs(U))&&Math.abs(h-X)<=Vo.EPSILON*Math.max(1,Math.abs(h),Math.abs(X))},oa.sub=oa.mul=void 0;var Vo=function(e,t){if(e&&e.__esModule)return e;if(e===null||rW(e)!=="object"&&typeof e!="function")return{default:e};var i=Su(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function Su(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Su=function(n){return n?i:t})(e)}function fu(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=i[0],V=i[1],F=i[2],U=i[3],X=i[4],y=i[5];return e[0]=n*u+s*V,e[1]=r*u+b*V,e[2]=n*F+s*U,e[3]=r*F+b*U,e[4]=n*X+s*y+h,e[5]=r*X+b*y+W,e}function vu(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}oa.mul=fu,oa.sub=vu;var ki={};function sW(e){return sW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sW(e)}Object.defineProperty(ki,"__esModule",{value:!0}),ki.create=function(){var e=new dl.ARRAY_TYPE(9);return dl.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},ki.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},ki.clone=function(e){var t=new dl.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},ki.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},ki.fromValues=function(e,t,i,n,r,s,b,h,W){var u=new dl.ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=i,u[3]=n,u[4]=r,u[5]=s,u[6]=b,u[7]=h,u[8]=W,u},ki.set=function(e,t,i,n,r,s,b,h,W,u){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=b,e[6]=h,e[7]=W,e[8]=u,e},ki.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},ki.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},ki.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=t[6],u=t[7],V=t[8],F=V*b-h*u,U=-V*s+h*W,X=u*s-b*W,y=i*F+n*U+r*X;return y?(e[0]=F*(y=1/y),e[1]=(-V*n+r*u)*y,e[2]=(h*n-r*b)*y,e[3]=U*y,e[4]=(V*i-r*W)*y,e[5]=(-h*i+r*s)*y,e[6]=X*y,e[7]=(-u*i+n*W)*y,e[8]=(b*i-n*s)*y,e):null},ki.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=t[6],u=t[7],V=t[8];return e[0]=b*V-h*u,e[1]=r*u-n*V,e[2]=n*h-r*b,e[3]=h*W-s*V,e[4]=i*V-r*W,e[5]=r*s-i*h,e[6]=s*u-b*W,e[7]=n*W-i*u,e[8]=i*b-n*s,e},ki.determinant=function(e){var t=e[3],i=e[4],n=e[5],r=e[6],s=e[7],b=e[8];return e[0]*(b*i-n*s)+e[1]*(-b*t+n*r)+e[2]*(s*t-i*r)},ki.multiply=zu,ki.translate=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=t[8],U=i[0],X=i[1];return e[0]=n,e[1]=r,e[2]=s,e[3]=b,e[4]=h,e[5]=W,e[6]=U*n+X*b+u,e[7]=U*r+X*h+V,e[8]=U*s+X*W+F,e},ki.rotate=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=t[8],U=Math.sin(i),X=Math.cos(i);return e[0]=X*n+U*b,e[1]=X*r+U*h,e[2]=X*s+U*W,e[3]=X*b-U*n,e[4]=X*h-U*r,e[5]=X*W-U*s,e[6]=u,e[7]=V,e[8]=F,e},ki.scale=function(e,t,i){var n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},ki.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},ki.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},ki.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},ki.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},ki.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=i+i,h=n+n,W=r+r,u=i*b,V=n*b,F=n*h,U=r*b,X=r*h,y=r*W,B=s*b,k=s*h,S=s*W;return e[0]=1-F-y,e[3]=V-S,e[6]=U+k,e[1]=V+S,e[4]=1-u-y,e[7]=X-B,e[2]=U-k,e[5]=X+B,e[8]=1-u-F,e},ki.normalFromMat4=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=t[6],u=t[7],V=t[8],F=t[9],U=t[10],X=t[11],y=t[12],B=t[13],k=t[14],S=t[15],A=i*h-n*b,D=i*W-r*b,O=i*u-s*b,et=n*W-r*h,$=n*u-s*h,nt=r*u-s*W,dt=V*B-F*y,ht=V*k-U*y,gt=V*S-X*y,pt=F*k-U*B,xt=F*S-X*B,kt=U*S-X*k,Ft=A*kt-D*xt+O*pt+et*gt-$*ht+nt*dt;return Ft?(e[0]=(h*kt-W*xt+u*pt)*(Ft=1/Ft),e[1]=(W*gt-b*kt-u*ht)*Ft,e[2]=(b*xt-h*gt+u*dt)*Ft,e[3]=(r*xt-n*kt-s*pt)*Ft,e[4]=(i*kt-r*gt+s*ht)*Ft,e[5]=(n*gt-i*xt-s*dt)*Ft,e[6]=(B*nt-k*$+S*et)*Ft,e[7]=(k*O-y*nt-S*D)*Ft,e[8]=(y*$-B*O+S*A)*Ft,e):null},ki.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},ki.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},ki.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},ki.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},ki.subtract=wu,ki.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},ki.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e[6]=t[6]+i[6]*n,e[7]=t[7]+i[7]*n,e[8]=t[8]+i[8]*n,e},ki.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},ki.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],b=e[4],h=e[5],W=e[6],u=e[7],V=e[8],F=t[0],U=t[1],X=t[2],y=t[3],B=t[4],k=t[5],S=t[6],A=t[7],D=t[8];return Math.abs(i-F)<=dl.EPSILON*Math.max(1,Math.abs(i),Math.abs(F))&&Math.abs(n-U)<=dl.EPSILON*Math.max(1,Math.abs(n),Math.abs(U))&&Math.abs(r-X)<=dl.EPSILON*Math.max(1,Math.abs(r),Math.abs(X))&&Math.abs(s-y)<=dl.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(b-B)<=dl.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(h-k)<=dl.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(W-S)<=dl.EPSILON*Math.max(1,Math.abs(W),Math.abs(S))&&Math.abs(u-A)<=dl.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(V-D)<=dl.EPSILON*Math.max(1,Math.abs(V),Math.abs(D))},ki.sub=ki.mul=void 0;var dl=function(e,t){if(e&&e.__esModule)return e;if(e===null||sW(e)!=="object"&&typeof e!="function")return{default:e};var i=Lu(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function Lu(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Lu=function(n){return n?i:t})(e)}function zu(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=t[8],U=i[0],X=i[1],y=i[2],B=i[3],k=i[4],S=i[5],A=i[6],D=i[7],O=i[8];return e[0]=U*n+X*b+y*u,e[1]=U*r+X*h+y*V,e[2]=U*s+X*W+y*F,e[3]=B*n+k*b+S*u,e[4]=B*r+k*h+S*V,e[5]=B*s+k*W+S*F,e[6]=A*n+D*b+O*u,e[7]=A*r+D*h+O*V,e[8]=A*s+D*W+O*F,e}function wu(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}ki.mul=zu,ki.sub=wu;var je={};function dW(e){return dW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dW(e)}Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var e=new ha.ARRAY_TYPE(16);return ha.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},je.clone=function(e){var t=new ha.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},je.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},je.fromValues=function(e,t,i,n,r,s,b,h,W,u,V,F,U,X,y,B){var k=new ha.ARRAY_TYPE(16);return k[0]=e,k[1]=t,k[2]=i,k[3]=n,k[4]=r,k[5]=s,k[6]=b,k[7]=h,k[8]=W,k[9]=u,k[10]=V,k[11]=F,k[12]=U,k[13]=X,k[14]=y,k[15]=B,k},je.set=function(e,t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=b,e[6]=h,e[7]=W,e[8]=u,e[9]=V,e[10]=F,e[11]=U,e[12]=X,e[13]=y,e[14]=B,e[15]=k,e},je.identity=Au,je.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[3],s=t[6],b=t[7],h=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=r,e[13]=b,e[14]=h}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},je.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=t[6],u=t[7],V=t[8],F=t[9],U=t[10],X=t[11],y=t[12],B=t[13],k=t[14],S=t[15],A=i*h-n*b,D=i*W-r*b,O=i*u-s*b,et=n*W-r*h,$=n*u-s*h,nt=r*u-s*W,dt=V*B-F*y,ht=V*k-U*y,gt=V*S-X*y,pt=F*k-U*B,xt=F*S-X*B,kt=U*S-X*k,Ft=A*kt-D*xt+O*pt+et*gt-$*ht+nt*dt;return Ft?(e[0]=(h*kt-W*xt+u*pt)*(Ft=1/Ft),e[1]=(r*xt-n*kt-s*pt)*Ft,e[2]=(B*nt-k*$+S*et)*Ft,e[3]=(U*$-F*nt-X*et)*Ft,e[4]=(W*gt-b*kt-u*ht)*Ft,e[5]=(i*kt-r*gt+s*ht)*Ft,e[6]=(k*O-y*nt-S*D)*Ft,e[7]=(V*nt-U*O+X*D)*Ft,e[8]=(b*xt-h*gt+u*dt)*Ft,e[9]=(n*gt-i*xt-s*dt)*Ft,e[10]=(y*$-B*O+S*A)*Ft,e[11]=(F*O-V*$-X*A)*Ft,e[12]=(h*ht-b*pt-W*dt)*Ft,e[13]=(i*pt-n*ht+r*dt)*Ft,e[14]=(B*D-y*et-k*A)*Ft,e[15]=(V*et-F*D+U*A)*Ft,e):null},je.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=t[4],h=t[5],W=t[6],u=t[7],V=t[8],F=t[9],U=t[10],X=t[11],y=t[12],B=t[13],k=t[14],S=t[15];return e[0]=h*(U*S-X*k)-F*(W*S-u*k)+B*(W*X-u*U),e[1]=-(n*(U*S-X*k)-F*(r*S-s*k)+B*(r*X-s*U)),e[2]=n*(W*S-u*k)-h*(r*S-s*k)+B*(r*u-s*W),e[3]=-(n*(W*X-u*U)-h*(r*X-s*U)+F*(r*u-s*W)),e[4]=-(b*(U*S-X*k)-V*(W*S-u*k)+y*(W*X-u*U)),e[5]=i*(U*S-X*k)-V*(r*S-s*k)+y*(r*X-s*U),e[6]=-(i*(W*S-u*k)-b*(r*S-s*k)+y*(r*u-s*W)),e[7]=i*(W*X-u*U)-b*(r*X-s*U)+V*(r*u-s*W),e[8]=b*(F*S-X*B)-V*(h*S-u*B)+y*(h*X-u*F),e[9]=-(i*(F*S-X*B)-V*(n*S-s*B)+y*(n*X-s*F)),e[10]=i*(h*S-u*B)-b*(n*S-s*B)+y*(n*u-s*h),e[11]=-(i*(h*X-u*F)-b*(n*X-s*F)+V*(n*u-s*h)),e[12]=-(b*(F*k-U*B)-V*(h*k-W*B)+y*(h*U-W*F)),e[13]=i*(F*k-U*B)-V*(n*k-r*B)+y*(n*U-r*F),e[14]=-(i*(h*k-W*B)-b*(n*k-r*B)+y*(n*W-r*h)),e[15]=i*(h*U-W*F)-b*(n*U-r*F)+V*(n*W-r*h),e},je.determinant=function(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],b=e[5],h=e[6],W=e[7],u=e[8],V=e[9],F=e[10],U=e[11],X=e[12],y=e[13],B=e[14],k=e[15];return(t*b-i*s)*(F*k-U*B)-(t*h-n*s)*(V*k-U*y)+(t*W-r*s)*(V*B-F*y)+(i*h-n*b)*(u*k-U*X)-(i*W-r*b)*(u*B-F*X)+(n*W-r*h)*(u*y-V*X)},je.multiply=Hu,je.translate=function(e,t,i){var n,r,s,b,h,W,u,V,F,U,X,y,B=i[0],k=i[1],S=i[2];return t===e?(e[12]=t[0]*B+t[4]*k+t[8]*S+t[12],e[13]=t[1]*B+t[5]*k+t[9]*S+t[13],e[14]=t[2]*B+t[6]*k+t[10]*S+t[14],e[15]=t[3]*B+t[7]*k+t[11]*S+t[15]):(r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=t[8],U=t[9],X=t[10],y=t[11],e[0]=n=t[0],e[1]=r,e[2]=s,e[3]=b,e[4]=h,e[5]=W,e[6]=u,e[7]=V,e[8]=F,e[9]=U,e[10]=X,e[11]=y,e[12]=n*B+h*k+F*S+t[12],e[13]=r*B+W*k+U*S+t[13],e[14]=s*B+u*k+X*S+t[14],e[15]=b*B+V*k+y*S+t[15]),e},je.scale=function(e,t,i){var n=i[0],r=i[1],s=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},je.rotate=function(e,t,i,n){var r,s,b,h,W,u,V,F,U,X,y,B,k,S,A,D,O,et,$,nt,dt,ht,gt,pt,xt=n[0],kt=n[1],Ft=n[2],Ct=Math.hypot(xt,kt,Ft);return Ct<ha.EPSILON?null:(xt*=Ct=1/Ct,kt*=Ct,Ft*=Ct,r=Math.sin(i),s=Math.cos(i),W=t[1],u=t[2],V=t[3],U=t[5],X=t[6],y=t[7],k=t[9],S=t[10],A=t[11],D=xt*xt*(b=1-s)+s,$=xt*kt*b-Ft*r,nt=kt*kt*b+s,dt=Ft*kt*b+xt*r,ht=xt*Ft*b+kt*r,gt=kt*Ft*b-xt*r,pt=Ft*Ft*b+s,e[0]=(h=t[0])*D+(F=t[4])*(O=kt*xt*b+Ft*r)+(B=t[8])*(et=Ft*xt*b-kt*r),e[1]=W*D+U*O+k*et,e[2]=u*D+X*O+S*et,e[3]=V*D+y*O+A*et,e[4]=h*$+F*nt+B*dt,e[5]=W*$+U*nt+k*dt,e[6]=u*$+X*nt+S*dt,e[7]=V*$+y*nt+A*dt,e[8]=h*ht+F*gt+B*pt,e[9]=W*ht+U*gt+k*pt,e[10]=u*ht+X*gt+S*pt,e[11]=V*ht+y*gt+A*pt,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},je.rotateX=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[4],b=t[5],h=t[6],W=t[7],u=t[8],V=t[9],F=t[10],U=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+u*n,e[5]=b*r+V*n,e[6]=h*r+F*n,e[7]=W*r+U*n,e[8]=u*r-s*n,e[9]=V*r-b*n,e[10]=F*r-h*n,e[11]=U*r-W*n,e},je.rotateY=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[0],b=t[1],h=t[2],W=t[3],u=t[8],V=t[9],F=t[10],U=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-u*n,e[1]=b*r-V*n,e[2]=h*r-F*n,e[3]=W*r-U*n,e[8]=s*n+u*r,e[9]=b*n+V*r,e[10]=h*n+F*r,e[11]=W*n+U*r,e},je.rotateZ=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[0],b=t[1],h=t[2],W=t[3],u=t[4],V=t[5],F=t[6],U=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+u*n,e[1]=b*r+V*n,e[2]=h*r+F*n,e[3]=W*r+U*n,e[4]=u*r-s*n,e[5]=V*r-b*n,e[6]=F*r-h*n,e[7]=U*r-W*n,e},je.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},je.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromRotation=function(e,t,i){var n,r,s,b=i[0],h=i[1],W=i[2],u=Math.hypot(b,h,W);return u<ha.EPSILON?null:(b*=u=1/u,h*=u,W*=u,n=Math.sin(t),r=Math.cos(t),e[0]=b*b*(s=1-r)+r,e[1]=h*b*s+W*n,e[2]=W*b*s-h*n,e[3]=0,e[4]=b*h*s-W*n,e[5]=h*h*s+r,e[6]=W*h*s+b*n,e[7]=0,e[8]=b*W*s+h*n,e[9]=h*W*s-b*n,e[10]=W*W*s+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},je.fromXRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromYRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromZRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromRotationTranslation=ju,je.fromQuat2=function(e,t){var i=new ha.ARRAY_TYPE(3),n=-t[0],r=-t[1],s=-t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=n*n+r*r+s*s+b*b;return F>0?(i[0]=2*(h*b+V*n+W*s-u*r)/F,i[1]=2*(W*b+V*r+u*n-h*s)/F,i[2]=2*(u*b+V*s+h*r-W*n)/F):(i[0]=2*(h*b+V*n+W*s-u*r),i[1]=2*(W*b+V*r+u*n-h*s),i[2]=2*(u*b+V*s+h*r-W*n)),ju(e,t,i),e},je.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},je.getScaling=Ou,je.getRotation=function(e,t){var i=new ha.ARRAY_TYPE(3);Ou(i,t);var n=1/i[0],r=1/i[1],s=1/i[2],b=t[0]*n,h=t[1]*r,W=t[2]*s,u=t[4]*n,V=t[5]*r,F=t[6]*s,U=t[8]*n,X=t[9]*r,y=t[10]*s,B=b+V+y,k=0;return B>0?(k=2*Math.sqrt(B+1),e[3]=.25*k,e[0]=(F-X)/k,e[1]=(U-W)/k,e[2]=(h-u)/k):b>V&&b>y?(k=2*Math.sqrt(1+b-V-y),e[3]=(F-X)/k,e[0]=.25*k,e[1]=(h+u)/k,e[2]=(U+W)/k):V>y?(k=2*Math.sqrt(1+V-b-y),e[3]=(U-W)/k,e[0]=(h+u)/k,e[1]=.25*k,e[2]=(F+X)/k):(k=2*Math.sqrt(1+y-b-V),e[3]=(h-u)/k,e[0]=(U+W)/k,e[1]=(F+X)/k,e[2]=.25*k),e},je.fromRotationTranslationScale=function(e,t,i,n){var r=t[0],s=t[1],b=t[2],h=t[3],W=r+r,u=s+s,V=b+b,F=r*W,U=r*u,X=r*V,y=s*u,B=s*V,k=b*V,S=h*W,A=h*u,D=h*V,O=n[0],et=n[1],$=n[2];return e[0]=(1-(y+k))*O,e[1]=(U+D)*O,e[2]=(X-A)*O,e[3]=0,e[4]=(U-D)*et,e[5]=(1-(F+k))*et,e[6]=(B+S)*et,e[7]=0,e[8]=(X+A)*$,e[9]=(B-S)*$,e[10]=(1-(F+y))*$,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},je.fromRotationTranslationScaleOrigin=function(e,t,i,n,r){var s=t[0],b=t[1],h=t[2],W=t[3],u=s+s,V=b+b,F=h+h,U=s*u,X=s*V,y=s*F,B=b*V,k=b*F,S=h*F,A=W*u,D=W*V,O=W*F,et=n[0],$=n[1],nt=n[2],dt=r[0],ht=r[1],gt=r[2],pt=(1-(B+S))*et,xt=(X+O)*et,kt=(y-D)*et,Ft=(X-O)*$,Ct=(1-(U+S))*$,Rt=(k+A)*$,Bt=(y+D)*nt,_t=(k-A)*nt,Qt=(1-(U+B))*nt;return e[0]=pt,e[1]=xt,e[2]=kt,e[3]=0,e[4]=Ft,e[5]=Ct,e[6]=Rt,e[7]=0,e[8]=Bt,e[9]=_t,e[10]=Qt,e[11]=0,e[12]=i[0]+dt-(pt*dt+Ft*ht+Bt*gt),e[13]=i[1]+ht-(xt*dt+Ct*ht+_t*gt),e[14]=i[2]+gt-(kt*dt+Rt*ht+Qt*gt),e[15]=1,e},je.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=i+i,h=n+n,W=r+r,u=i*b,V=n*b,F=n*h,U=r*b,X=r*h,y=r*W,B=s*b,k=s*h,S=s*W;return e[0]=1-F-y,e[1]=V+S,e[2]=U-k,e[3]=0,e[4]=V-S,e[5]=1-u-y,e[6]=X+B,e[7]=0,e[8]=U+k,e[9]=X-B,e[10]=1-u-F,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.frustum=function(e,t,i,n,r,s,b){var h=1/(i-t),W=1/(r-n),u=1/(s-b);return e[0]=2*s*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*W,e[6]=0,e[7]=0,e[8]=(i+t)*h,e[9]=(r+n)*W,e[10]=(b+s)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=b*s*2*u,e[15]=0,e},je.perspectiveNO=Du,je.perspectiveZO=function(e,t,i,n,r){var s,b=1/Math.tan(t/2);return e[0]=b/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=b,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(e[10]=r*(s=1/(n-r)),e[14]=r*n*s):(e[10]=-1,e[14]=-n),e},je.perspectiveFromFieldOfView=function(e,t,i,n){var r=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),b=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),W=2/(b+h),u=2/(r+s);return e[0]=W,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(b-h)*W*.5,e[9]=(r-s)*u*.5,e[10]=n/(i-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*i/(i-n),e[15]=0,e},je.orthoNO=_u,je.orthoZO=function(e,t,i,n,r,s,b){var h=1/(t-i),W=1/(n-r),u=1/(s-b);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*W,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+i)*h,e[13]=(r+n)*W,e[14]=s*u,e[15]=1,e},je.lookAt=function(e,t,i,n){var r,s,b,h,W,u,V,F,U,X,y=t[0],B=t[1],k=t[2],S=n[0],A=n[1],D=n[2],O=i[0],et=i[1],$=i[2];return Math.abs(y-O)<ha.EPSILON&&Math.abs(B-et)<ha.EPSILON&&Math.abs(k-$)<ha.EPSILON?Au(e):(V=y-O,F=B-et,U=k-$,r=A*(U*=X=1/Math.hypot(V,F,U))-D*(F*=X),s=D*(V*=X)-S*U,b=S*F-A*V,(X=Math.hypot(r,s,b))?(r*=X=1/X,s*=X,b*=X):(r=0,s=0,b=0),h=F*b-U*s,W=U*r-V*b,u=V*s-F*r,(X=Math.hypot(h,W,u))?(h*=X=1/X,W*=X,u*=X):(h=0,W=0,u=0),e[0]=r,e[1]=h,e[2]=V,e[3]=0,e[4]=s,e[5]=W,e[6]=F,e[7]=0,e[8]=b,e[9]=u,e[10]=U,e[11]=0,e[12]=-(r*y+s*B+b*k),e[13]=-(h*y+W*B+u*k),e[14]=-(V*y+F*B+U*k),e[15]=1,e)},je.targetTo=function(e,t,i,n){var r=t[0],s=t[1],b=t[2],h=n[0],W=n[1],u=n[2],V=r-i[0],F=s-i[1],U=b-i[2],X=V*V+F*F+U*U;X>0&&(V*=X=1/Math.sqrt(X),F*=X,U*=X);var y=W*U-u*F,B=u*V-h*U,k=h*F-W*V;return(X=y*y+B*B+k*k)>0&&(y*=X=1/Math.sqrt(X),B*=X,k*=X),e[0]=y,e[1]=B,e[2]=k,e[3]=0,e[4]=F*k-U*B,e[5]=U*y-V*k,e[6]=V*B-F*y,e[7]=0,e[8]=V,e[9]=F,e[10]=U,e[11]=0,e[12]=r,e[13]=s,e[14]=b,e[15]=1,e},je.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},je.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},je.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},je.subtract=Pu,je.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},je.multiplyScalarAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e[6]=t[6]+i[6]*n,e[7]=t[7]+i[7]*n,e[8]=t[8]+i[8]*n,e[9]=t[9]+i[9]*n,e[10]=t[10]+i[10]*n,e[11]=t[11]+i[11]*n,e[12]=t[12]+i[12]*n,e[13]=t[13]+i[13]*n,e[14]=t[14]+i[14]*n,e[15]=t[15]+i[15]*n,e},je.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},je.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],b=e[4],h=e[5],W=e[6],u=e[7],V=e[8],F=e[9],U=e[10],X=e[11],y=e[12],B=e[13],k=e[14],S=e[15],A=t[0],D=t[1],O=t[2],et=t[3],$=t[4],nt=t[5],dt=t[6],ht=t[7],gt=t[8],pt=t[9],xt=t[10],kt=t[11],Ft=t[12],Ct=t[13],Rt=t[14],Bt=t[15];return Math.abs(i-A)<=ha.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(n-D)<=ha.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(r-O)<=ha.EPSILON*Math.max(1,Math.abs(r),Math.abs(O))&&Math.abs(s-et)<=ha.EPSILON*Math.max(1,Math.abs(s),Math.abs(et))&&Math.abs(b-$)<=ha.EPSILON*Math.max(1,Math.abs(b),Math.abs($))&&Math.abs(h-nt)<=ha.EPSILON*Math.max(1,Math.abs(h),Math.abs(nt))&&Math.abs(W-dt)<=ha.EPSILON*Math.max(1,Math.abs(W),Math.abs(dt))&&Math.abs(u-ht)<=ha.EPSILON*Math.max(1,Math.abs(u),Math.abs(ht))&&Math.abs(V-gt)<=ha.EPSILON*Math.max(1,Math.abs(V),Math.abs(gt))&&Math.abs(F-pt)<=ha.EPSILON*Math.max(1,Math.abs(F),Math.abs(pt))&&Math.abs(U-xt)<=ha.EPSILON*Math.max(1,Math.abs(U),Math.abs(xt))&&Math.abs(X-kt)<=ha.EPSILON*Math.max(1,Math.abs(X),Math.abs(kt))&&Math.abs(y-Ft)<=ha.EPSILON*Math.max(1,Math.abs(y),Math.abs(Ft))&&Math.abs(B-Ct)<=ha.EPSILON*Math.max(1,Math.abs(B),Math.abs(Ct))&&Math.abs(k-Rt)<=ha.EPSILON*Math.max(1,Math.abs(k),Math.abs(Rt))&&Math.abs(S-Bt)<=ha.EPSILON*Math.max(1,Math.abs(S),Math.abs(Bt))},je.sub=je.mul=je.ortho=je.perspective=void 0;var ha=function(e,t){if(e&&e.__esModule)return e;if(e===null||dW(e)!=="object"&&typeof e!="function")return{default:e};var i=Eu(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function Eu(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Eu=function(n){return n?i:t})(e)}function Au(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hu(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=t[8],U=t[9],X=t[10],y=t[11],B=t[12],k=t[13],S=t[14],A=t[15],D=i[0],O=i[1],et=i[2],$=i[3];return e[0]=D*n+O*h+et*F+$*B,e[1]=D*r+O*W+et*U+$*k,e[2]=D*s+O*u+et*X+$*S,e[3]=D*b+O*V+et*y+$*A,e[4]=(D=i[4])*n+(O=i[5])*h+(et=i[6])*F+($=i[7])*B,e[5]=D*r+O*W+et*U+$*k,e[6]=D*s+O*u+et*X+$*S,e[7]=D*b+O*V+et*y+$*A,e[8]=(D=i[8])*n+(O=i[9])*h+(et=i[10])*F+($=i[11])*B,e[9]=D*r+O*W+et*U+$*k,e[10]=D*s+O*u+et*X+$*S,e[11]=D*b+O*V+et*y+$*A,e[12]=(D=i[12])*n+(O=i[13])*h+(et=i[14])*F+($=i[15])*B,e[13]=D*r+O*W+et*U+$*k,e[14]=D*s+O*u+et*X+$*S,e[15]=D*b+O*V+et*y+$*A,e}function ju(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=n+n,W=r+r,u=s+s,V=n*h,F=n*W,U=n*u,X=r*W,y=r*u,B=s*u,k=b*h,S=b*W,A=b*u;return e[0]=1-(X+B),e[1]=F+A,e[2]=U-S,e[3]=0,e[4]=F-A,e[5]=1-(V+B),e[6]=y+k,e[7]=0,e[8]=U+S,e[9]=y-k,e[10]=1-(V+X),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Ou(e,t){var i=t[4],n=t[5],r=t[6],s=t[8],b=t[9],h=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,n,r),e[2]=Math.hypot(s,b,h),e}function Du(e,t,i,n,r){var s,b=1/Math.tan(t/2);return e[0]=b/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=b,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(e[10]=(r+n)*(s=1/(n-r)),e[14]=2*r*n*s):(e[10]=-1,e[14]=-2*n),e}function _u(e,t,i,n,r,s,b){var h=1/(t-i),W=1/(n-r),u=1/(s-b);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*W,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+i)*h,e[13]=(r+n)*W,e[14]=(b+s)*u,e[15]=1,e}function Pu(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}je.perspective=Du,je.ortho=_u,je.mul=Hu,je.sub=Pu;var ze={},He={};function cW(e){return cW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cW(e)}Object.defineProperty(He,"__esModule",{value:!0}),He.create=qu,He.clone=function(e){var t=new zo.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},He.length=$u,He.fromValues=function(e,t,i){var n=new zo.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=i,n},He.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},He.set=function(e,t,i,n){return e[0]=t,e[1]=i,e[2]=n,e},He.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},He.subtract=tZ,He.multiply=eZ,He.divide=iZ,He.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},He.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},He.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},He.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},He.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},He.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},He.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e},He.distance=aZ,He.squaredDistance=nZ,He.squaredLength=lZ,He.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},He.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},He.normalize=function(e,t){var i=t[0],n=t[1],r=t[2],s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e},He.dot=oZ,He.cross=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=i[0],h=i[1],W=i[2];return e[0]=r*W-s*h,e[1]=s*b-n*W,e[2]=n*h-r*b,e},He.lerp=function(e,t,i,n){var r=t[0],s=t[1],b=t[2];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=b+n*(i[2]-b),e},He.hermite=function(e,t,i,n,r,s){var b=s*s,h=b*(2*s-3)+1,W=b*(s-2)+s,u=b*(s-1),V=b*(3-2*s);return e[0]=t[0]*h+i[0]*W+n[0]*u+r[0]*V,e[1]=t[1]*h+i[1]*W+n[1]*u+r[1]*V,e[2]=t[2]*h+i[2]*W+n[2]*u+r[2]*V,e},He.bezier=function(e,t,i,n,r,s){var b=1-s,h=b*b,W=s*s,u=h*b,V=3*s*h,F=3*W*b,U=W*s;return e[0]=t[0]*u+i[0]*V+n[0]*F+r[0]*U,e[1]=t[1]*u+i[1]*V+n[1]*F+r[1]*U,e[2]=t[2]*u+i[2]*V+n[2]*F+r[2]*U,e},He.random=function(e,t){t=t||1;var i=2*zo.RANDOM()*Math.PI,n=2*zo.RANDOM()-1,r=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(i)*r,e[1]=Math.sin(i)*r,e[2]=n*t,e},He.transformMat4=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=i[3]*n+i[7]*r+i[11]*s+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/(b=b||1),e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/b,e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/b,e},He.transformMat3=function(e,t,i){var n=t[0],r=t[1],s=t[2];return e[0]=n*i[0]+r*i[3]+s*i[6],e[1]=n*i[1]+r*i[4]+s*i[7],e[2]=n*i[2]+r*i[5]+s*i[8],e},He.transformQuat=function(e,t,i){var n=i[0],r=i[1],s=i[2],b=t[0],h=t[1],W=t[2],u=r*W-s*h,V=s*b-n*W,F=n*h-r*b,U=r*F-s*V,X=s*u-n*F,y=n*V-r*u,B=2*i[3];return V*=B,F*=B,X*=2,y*=2,e[0]=b+(u*=B)+(U*=2),e[1]=h+V+X,e[2]=W+F+y,e},He.rotateX=function(e,t,i,n){var r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},He.rotateY=function(e,t,i,n){var r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},He.rotateZ=function(e,t,i,n){var r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e},He.angle=function(e,t){var i=e[0],n=e[1],r=e[2],s=t[0],b=t[1],h=t[2],W=Math.sqrt(i*i+n*n+r*r)*Math.sqrt(s*s+b*b+h*h),u=W&&oZ(e,t)/W;return Math.acos(Math.min(Math.max(u,-1),1))},He.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},He.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},He.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},He.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=t[0],b=t[1],h=t[2];return Math.abs(i-s)<=zo.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-b)<=zo.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-h)<=zo.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))},He.forEach=He.sqrLen=He.len=He.sqrDist=He.dist=He.div=He.mul=He.sub=void 0;var zo=function(e,t){if(e&&e.__esModule)return e;if(e===null||cW(e)!=="object"&&typeof e!="function")return{default:e};var i=Ku(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function Ku(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Ku=function(n){return n?i:t})(e)}function qu(){var e=new zo.ARRAY_TYPE(3);return zo.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function $u(e){return Math.hypot(e[0],e[1],e[2])}function tZ(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function eZ(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function iZ(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function aZ(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function nZ(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return i*i+n*n+r*r}function lZ(e){var t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n}function oZ(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}He.sub=tZ,He.mul=eZ,He.div=iZ,He.dist=aZ,He.sqrDist=nZ,He.len=$u,He.sqrLen=lZ;var wo,FU=(wo=qu(),function(e,t,i,n,r,s){var b,h;for(t||(t=3),i||(i=0),h=n?Math.min(n*t+i,e.length):e.length,b=i;b<h;b+=t)wo[0]=e[b],wo[1]=e[b+1],wo[2]=e[b+2],r(wo,wo,s),e[b]=wo[0],e[b+1]=wo[1],e[b+2]=wo[2];return e});He.forEach=FU;var ai={};function bW(e){return bW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bW(e)}Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=sZ,ai.clone=function(e){var t=new Ul.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ai.fromValues=function(e,t,i,n){var r=new Ul.ARRAY_TYPE(4);return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r},ai.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ai.set=function(e,t,i,n,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e},ai.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},ai.subtract=dZ,ai.multiply=cZ,ai.divide=bZ,ai.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},ai.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},ai.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},ai.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},ai.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},ai.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},ai.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e},ai.distance=mZ,ai.squaredDistance=hZ,ai.length=pZ,ai.squaredLength=WZ,ai.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},ai.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},ai.normalize=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=i*i+n*n+r*r+s*s;return b>0&&(b=1/Math.sqrt(b)),e[0]=i*b,e[1]=n*b,e[2]=r*b,e[3]=s*b,e},ai.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ai.cross=function(e,t,i,n){var r=i[0]*n[1]-i[1]*n[0],s=i[0]*n[2]-i[2]*n[0],b=i[0]*n[3]-i[3]*n[0],h=i[1]*n[2]-i[2]*n[1],W=i[1]*n[3]-i[3]*n[1],u=i[2]*n[3]-i[3]*n[2],V=t[0],F=t[1],U=t[2],X=t[3];return e[0]=F*u-U*W+X*h,e[1]=-V*u+U*b-X*s,e[2]=V*W-F*b+X*r,e[3]=-V*h+F*s-U*r,e},ai.lerp=function(e,t,i,n){var r=t[0],s=t[1],b=t[2],h=t[3];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=b+n*(i[2]-b),e[3]=h+n*(i[3]-h),e},ai.random=function(e,t){var i,n,r,s,b,h;t=t||1;do b=(i=2*Ul.RANDOM()-1)*i+(n=2*Ul.RANDOM()-1)*n;while(b>=1);do h=(r=2*Ul.RANDOM()-1)*r+(s=2*Ul.RANDOM()-1)*s;while(h>=1);var W=Math.sqrt((1-b)/h);return e[0]=t*i,e[1]=t*n,e[2]=t*r*W,e[3]=t*s*W,e},ai.transformMat4=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*b,e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*b,e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*b,e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*b,e},ai.transformQuat=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=i[0],h=i[1],W=i[2],u=i[3],V=u*n+h*s-W*r,F=u*r+W*n-b*s,U=u*s+b*r-h*n,X=-b*n-h*r-W*s;return e[0]=V*u+X*-b+F*-W-U*-h,e[1]=F*u+X*-h+U*-b-V*-W,e[2]=U*u+X*-W+V*-h-F*-b,e[3]=t[3],e},ai.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},ai.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ai.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},ai.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],b=t[0],h=t[1],W=t[2],u=t[3];return Math.abs(i-b)<=Ul.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-h)<=Ul.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-W)<=Ul.EPSILON*Math.max(1,Math.abs(r),Math.abs(W))&&Math.abs(s-u)<=Ul.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))},ai.forEach=ai.sqrLen=ai.len=ai.sqrDist=ai.dist=ai.div=ai.mul=ai.sub=void 0;var Ul=function(e,t){if(e&&e.__esModule)return e;if(e===null||bW(e)!=="object"&&typeof e!="function")return{default:e};var i=rZ(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function rZ(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(rZ=function(n){return n?i:t})(e)}function sZ(){var e=new Ul.ARRAY_TYPE(4);return Ul.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function dZ(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function cZ(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function bZ(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function mZ(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function hZ(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2],s=t[3]-e[3];return i*i+n*n+r*r+s*s}function pZ(e){return Math.hypot(e[0],e[1],e[2],e[3])}function WZ(e){var t=e[0],i=e[1],n=e[2],r=e[3];return t*t+i*i+n*n+r*r}ai.sub=dZ,ai.mul=cZ,ai.div=bZ,ai.dist=mZ,ai.sqrDist=hZ,ai.len=pZ,ai.sqrLen=WZ;var IU=function(){var e=sZ();return function(t,i,n,r,s,b){var h,W;for(i||(i=4),n||(n=0),W=r?Math.min(r*i+n,t.length):t.length,h=n;h<W;h+=i)e[0]=t[h],e[1]=t[h+1],e[2]=t[h+2],e[3]=t[h+3],s(e,e,b),t[h]=e[0],t[h+1]=e[1],t[h+2]=e[2],t[h+3]=e[3];return t}}();function mW(e){return mW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mW(e)}ai.forEach=IU,Object.defineProperty(ze,"__esModule",{value:!0}),ze.create=hW,ze.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},ze.setAxisAngle=ZZ,ze.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),n=Math.sin(i/2);return n>Ls.EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),i},ze.getAngle=function(e,t){var i=IZ(e,t);return Math.acos(2*i*i-1)},ze.multiply=gZ,ze.rotateX=function(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],b=t[3],h=Math.sin(i),W=Math.cos(i);return e[0]=n*W+b*h,e[1]=r*W+s*h,e[2]=s*W-r*h,e[3]=b*W-n*h,e},ze.rotateY=function(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],b=t[3],h=Math.sin(i),W=Math.cos(i);return e[0]=n*W-s*h,e[1]=r*W+b*h,e[2]=s*W+n*h,e[3]=b*W-r*h,e},ze.rotateZ=function(e,t,i){i*=.5;var n=t[0],r=t[1],s=t[2],b=t[3],h=Math.sin(i),W=Math.cos(i);return e[0]=n*W+r*h,e[1]=r*W-n*h,e[2]=s*W+b*h,e[3]=b*W-s*h,e},ze.calculateW=function(e,t){var i=t[0],n=t[1],r=t[2];return e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),e},ze.exp=VZ,ze.ln=RZ,ze.pow=function(e,t,i){return RZ(e,t),FZ(e,e,i),VZ(e,e),e},ze.slerp=eh,ze.random=function(e){var t=Ls.RANDOM(),i=Ls.RANDOM(),n=Ls.RANDOM(),r=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=r*Math.sin(2*Math.PI*i),e[1]=r*Math.cos(2*Math.PI*i),e[2]=s*Math.sin(2*Math.PI*n),e[3]=s*Math.cos(2*Math.PI*n),e},ze.invert=function(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=i*i+n*n+r*r+s*s,h=b?1/b:0;return e[0]=-i*h,e[1]=-n*h,e[2]=-r*h,e[3]=s*h,e},ze.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},ze.fromMat3=GZ,ze.fromEuler=function(e,t,i,n){var r=.5*Math.PI/180;t*=r,i*=r,n*=r;var s=Math.sin(t),b=Math.cos(t),h=Math.sin(i),W=Math.cos(i),u=Math.sin(n),V=Math.cos(n);return e[0]=s*W*V-b*h*u,e[1]=b*h*V+s*W*u,e[2]=b*W*u-s*h*V,e[3]=b*W*V+s*h*u,e},ze.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ze.setAxes=ze.sqlerp=ze.rotationTo=ze.equals=ze.exactEquals=ze.normalize=ze.sqrLen=ze.squaredLength=ze.len=ze.length=ze.lerp=ze.dot=ze.scale=ze.mul=ze.add=ze.set=ze.copy=ze.fromValues=ze.clone=void 0;var Ls=th(za),UU=th(ki),Eo=th(He),cl=th(ai);function uZ(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(uZ=function(n){return n?i:t})(e)}function th(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||mW(e)!=="object"&&typeof e!="function")return{default:e};var i=uZ(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}function hW(){var e=new Ls.ARRAY_TYPE(4);return Ls.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ZZ(e,t,i){i*=.5;var n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function gZ(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=i[0],W=i[1],u=i[2],V=i[3];return e[0]=n*V+b*h+r*u-s*W,e[1]=r*V+b*W+s*h-n*u,e[2]=s*V+b*u+n*W-r*h,e[3]=b*V-n*h-r*W-s*u,e}function VZ(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=Math.sqrt(i*i+n*n+r*r),h=Math.exp(s),W=b>0?h*Math.sin(b)/b:0;return e[0]=i*W,e[1]=n*W,e[2]=r*W,e[3]=h*Math.cos(b),e}function RZ(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],b=Math.sqrt(i*i+n*n+r*r),h=b>0?Math.atan2(b,s)/b:0;return e[0]=i*h,e[1]=n*h,e[2]=r*h,e[3]=.5*Math.log(i*i+n*n+r*r+s*s),e}function eh(e,t,i,n){var r,s,b,h,W,u=t[0],V=t[1],F=t[2],U=t[3],X=i[0],y=i[1],B=i[2],k=i[3];return(s=u*X+V*y+F*B+U*k)<0&&(s=-s,X=-X,y=-y,B=-B,k=-k),1-s>Ls.EPSILON?(r=Math.acos(s),b=Math.sin(r),h=Math.sin((1-n)*r)/b,W=Math.sin(n*r)/b):(h=1-n,W=n),e[0]=h*u+W*X,e[1]=h*V+W*y,e[2]=h*F+W*B,e[3]=h*U+W*k,e}function GZ(e,t){var i,n=t[0]+t[4]+t[8];if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var s=(r+1)%3,b=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*b+b]+1),e[r]=.5*i,e[3]=(t[3*s+b]-t[3*b+s])*(i=.5/i),e[s]=(t[3*s+r]+t[3*r+s])*i,e[b]=(t[3*b+r]+t[3*r+b])*i}return e}ze.clone=cl.clone,ze.fromValues=cl.fromValues,ze.copy=cl.copy,ze.set=cl.set,ze.add=cl.add,ze.mul=gZ;var FZ=cl.scale;ze.scale=FZ;var IZ=cl.dot;ze.dot=IZ,ze.lerp=cl.lerp;var UZ=cl.length;ze.length=UZ,ze.len=UZ;var xZ=cl.squaredLength;ze.squaredLength=xZ,ze.sqrLen=xZ;var pW=cl.normalize;ze.normalize=pW,ze.exactEquals=cl.exactEquals,ze.equals=cl.equals;var Ll,NZ,YZ,xU=(Ll=Eo.create(),NZ=Eo.fromValues(1,0,0),YZ=Eo.fromValues(0,1,0),function(e,t,i){var n=Eo.dot(t,i);return n<-.999999?(Eo.cross(Ll,NZ,t),Eo.len(Ll)<1e-6&&Eo.cross(Ll,YZ,t),Eo.normalize(Ll,Ll),ZZ(e,Ll,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Eo.cross(Ll,t,i),e[0]=Ll[0],e[1]=Ll[1],e[2]=Ll[2],e[3]=1+n,pW(e,e))});ze.rotationTo=xU;var WW,uW,NU=(WW=hW(),uW=hW(),function(e,t,i,n,r,s){return eh(WW,t,r,s),eh(uW,i,n,s),eh(e,WW,uW,2*s*(1-s)),e});ze.sqlerp=NU;var zl,YU=(zl=UU.create(),function(e,t,i,n){return zl[0]=i[0],zl[3]=i[1],zl[6]=i[2],zl[1]=n[0],zl[4]=n[1],zl[7]=n[2],zl[2]=-t[0],zl[5]=-t[1],zl[8]=-t[2],pW(e,GZ(e,zl))});ze.setAxes=YU;var di={};function ZW(e){return ZW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZW(e)}Object.defineProperty(di,"__esModule",{value:!0}),di.create=function(){var e=new Qn.ARRAY_TYPE(8);return Qn.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},di.clone=function(e){var t=new Qn.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},di.fromValues=function(e,t,i,n,r,s,b,h){var W=new Qn.ARRAY_TYPE(8);return W[0]=e,W[1]=t,W[2]=i,W[3]=n,W[4]=r,W[5]=s,W[6]=b,W[7]=h,W},di.fromRotationTranslationValues=function(e,t,i,n,r,s,b){var h=new Qn.ARRAY_TYPE(8);h[0]=e,h[1]=t,h[2]=i,h[3]=n;var W=.5*r,u=.5*s,V=.5*b;return h[4]=W*n+u*i-V*t,h[5]=u*n+V*e-W*i,h[6]=V*n+W*t-u*e,h[7]=-W*e-u*t-V*i,h},di.fromRotationTranslation=yZ,di.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},di.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},di.fromMat4=function(e,t){var i=Ao.create();XZ.getRotation(i,t);var n=new Qn.ARRAY_TYPE(3);return XZ.getTranslation(n,t),yZ(e,i,n),e},di.copy=BZ,di.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},di.set=function(e,t,i,n,r,s,b,h,W){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e[4]=s,e[5]=b,e[6]=h,e[7]=W,e},di.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},di.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},di.getTranslation=function(e,t){var i=t[4],n=t[5],r=t[6],s=t[7],b=-t[0],h=-t[1],W=-t[2],u=t[3];return e[0]=2*(i*u+s*b+n*W-r*h),e[1]=2*(n*u+s*h+r*b-i*W),e[2]=2*(r*u+s*W+i*h-n*b),e},di.translate=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=.5*i[0],W=.5*i[1],u=.5*i[2],V=t[4],F=t[5],U=t[6],X=t[7];return e[0]=n,e[1]=r,e[2]=s,e[3]=b,e[4]=b*h+r*u-s*W+V,e[5]=b*W+s*h-n*u+F,e[6]=b*u+n*W-r*h+U,e[7]=-n*h-r*W-s*u+X,e},di.rotateX=function(e,t,i){var n=-t[0],r=-t[1],s=-t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=h*b+V*n+W*s-u*r,U=W*b+V*r+u*n-h*s,X=u*b+V*s+h*r-W*n,y=V*b-h*n-W*r-u*s;return Ao.rotateX(e,t,i),e[4]=F*(b=e[3])+y*(n=e[0])+U*(s=e[2])-X*(r=e[1]),e[5]=U*b+y*r+X*n-F*s,e[6]=X*b+y*s+F*r-U*n,e[7]=y*b-F*n-U*r-X*s,e},di.rotateY=function(e,t,i){var n=-t[0],r=-t[1],s=-t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=h*b+V*n+W*s-u*r,U=W*b+V*r+u*n-h*s,X=u*b+V*s+h*r-W*n,y=V*b-h*n-W*r-u*s;return Ao.rotateY(e,t,i),e[4]=F*(b=e[3])+y*(n=e[0])+U*(s=e[2])-X*(r=e[1]),e[5]=U*b+y*r+X*n-F*s,e[6]=X*b+y*s+F*r-U*n,e[7]=y*b-F*n-U*r-X*s,e},di.rotateZ=function(e,t,i){var n=-t[0],r=-t[1],s=-t[2],b=t[3],h=t[4],W=t[5],u=t[6],V=t[7],F=h*b+V*n+W*s-u*r,U=W*b+V*r+u*n-h*s,X=u*b+V*s+h*r-W*n,y=V*b-h*n-W*r-u*s;return Ao.rotateZ(e,t,i),e[4]=F*(b=e[3])+y*(n=e[0])+U*(s=e[2])-X*(r=e[1]),e[5]=U*b+y*r+X*n-F*s,e[6]=X*b+y*s+F*r-U*n,e[7]=y*b-F*n-U*r-X*s,e},di.rotateByQuatAppend=function(e,t,i){var n=i[0],r=i[1],s=i[2],b=i[3],h=t[0],W=t[1],u=t[2],V=t[3];return e[0]=h*b+V*n+W*s-u*r,e[1]=W*b+V*r+u*n-h*s,e[2]=u*b+V*s+h*r-W*n,e[3]=V*b-h*n-W*r-u*s,e[4]=(h=t[4])*b+(V=t[7])*n+(W=t[5])*s-(u=t[6])*r,e[5]=W*b+V*r+u*n-h*s,e[6]=u*b+V*s+h*r-W*n,e[7]=V*b-h*n-W*r-u*s,e},di.rotateByQuatPrepend=function(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=i[0],W=i[1],u=i[2],V=i[3];return e[0]=n*V+b*h+r*u-s*W,e[1]=r*V+b*W+s*h-n*u,e[2]=s*V+b*u+n*W-r*h,e[3]=b*V-n*h-r*W-s*u,e[4]=n*(V=i[7])+b*(h=i[4])+r*(u=i[6])-s*(W=i[5]),e[5]=r*V+b*W+s*h-n*u,e[6]=s*V+b*u+n*W-r*h,e[7]=b*V-n*h-r*W-s*u,e},di.rotateAroundAxis=function(e,t,i,n){if(Math.abs(n)<Qn.EPSILON)return BZ(e,t);var r=Math.hypot(i[0],i[1],i[2]);n*=.5;var s=Math.sin(n),b=s*i[0]/r,h=s*i[1]/r,W=s*i[2]/r,u=Math.cos(n),V=t[0],F=t[1],U=t[2],X=t[3];e[0]=V*u+X*b+F*W-U*h,e[1]=F*u+X*h+U*b-V*W,e[2]=U*u+X*W+V*h-F*b,e[3]=X*u-V*b-F*h-U*W;var y=t[4],B=t[5],k=t[6],S=t[7];return e[4]=y*u+S*b+B*W-k*h,e[5]=B*u+S*h+k*b-y*W,e[6]=k*u+S*W+y*h-B*b,e[7]=S*u-y*b-B*h-k*W,e},di.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},di.multiply=MZ,di.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},di.lerp=function(e,t,i,n){var r=1-n;return CZ(t,i)<0&&(n=-n),e[0]=t[0]*r+i[0]*n,e[1]=t[1]*r+i[1]*n,e[2]=t[2]*r+i[2]*n,e[3]=t[3]*r+i[3]*n,e[4]=t[4]*r+i[4]*n,e[5]=t[5]*r+i[5]*n,e[6]=t[6]*r+i[6]*n,e[7]=t[7]*r+i[7]*n,e},di.invert=function(e,t){var i=ih(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},di.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},di.normalize=function(e,t){var i=ih(t);if(i>0){i=Math.sqrt(i);var n=t[0]/i,r=t[1]/i,s=t[2]/i,b=t[3]/i,h=t[4],W=t[5],u=t[6],V=t[7],F=n*h+r*W+s*u+b*V;e[0]=n,e[1]=r,e[2]=s,e[3]=b,e[4]=(h-n*F)/i,e[5]=(W-r*F)/i,e[6]=(u-s*F)/i,e[7]=(V-b*F)/i}return e},di.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},di.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},di.equals=function(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],b=e[4],h=e[5],W=e[6],u=e[7],V=t[0],F=t[1],U=t[2],X=t[3],y=t[4],B=t[5],k=t[6],S=t[7];return Math.abs(i-V)<=Qn.EPSILON*Math.max(1,Math.abs(i),Math.abs(V))&&Math.abs(n-F)<=Qn.EPSILON*Math.max(1,Math.abs(n),Math.abs(F))&&Math.abs(r-U)<=Qn.EPSILON*Math.max(1,Math.abs(r),Math.abs(U))&&Math.abs(s-X)<=Qn.EPSILON*Math.max(1,Math.abs(s),Math.abs(X))&&Math.abs(b-y)<=Qn.EPSILON*Math.max(1,Math.abs(b),Math.abs(y))&&Math.abs(h-B)<=Qn.EPSILON*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(W-k)<=Qn.EPSILON*Math.max(1,Math.abs(W),Math.abs(k))&&Math.abs(u-S)<=Qn.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))},di.sqrLen=di.squaredLength=di.len=di.length=di.dot=di.mul=di.setReal=di.getReal=void 0;var Qn=gW(za),Ao=gW(ze),XZ=gW(je);function JZ(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(JZ=function(n){return n?i:t})(e)}function gW(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ZW(e)!=="object"&&typeof e!="function")return{default:e};var i=JZ(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}function yZ(e,t,i){var n=.5*i[0],r=.5*i[1],s=.5*i[2],b=t[0],h=t[1],W=t[2],u=t[3];return e[0]=b,e[1]=h,e[2]=W,e[3]=u,e[4]=n*u+r*W-s*h,e[5]=r*u+s*b-n*W,e[6]=s*u+n*h-r*b,e[7]=-n*b-r*h-s*W,e}function BZ(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function MZ(e,t,i){var n=t[0],r=t[1],s=t[2],b=t[3],h=i[4],W=i[5],u=i[6],V=i[7],F=t[4],U=t[5],X=t[6],y=t[7],B=i[0],k=i[1],S=i[2],A=i[3];return e[0]=n*A+b*B+r*S-s*k,e[1]=r*A+b*k+s*B-n*S,e[2]=s*A+b*S+n*k-r*B,e[3]=b*A-n*B-r*k-s*S,e[4]=n*V+b*h+r*u-s*W+F*A+y*B+U*S-X*k,e[5]=r*V+b*W+s*h-n*u+U*A+y*k+X*B-F*S,e[6]=s*V+b*u+n*W-r*h+X*A+y*S+F*k-U*B,e[7]=b*V-n*h-r*W-s*u+y*A-F*B-U*k-X*S,e}di.getReal=Ao.copy,di.setReal=Ao.copy,di.mul=MZ;var CZ=Ao.dot;di.dot=CZ;var TZ=Ao.length;di.length=TZ,di.len=TZ;var ih=Ao.squaredLength;di.squaredLength=ih,di.sqrLen=ih;var Ke={};function VW(e){return VW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},VW(e)}Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.create=QZ,Ke.clone=function(e){var t=new zs.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},Ke.fromValues=function(e,t){var i=new zs.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},Ke.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},Ke.set=function(e,t,i){return e[0]=t,e[1]=i,e},Ke.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},Ke.subtract=SZ,Ke.multiply=fZ,Ke.divide=vZ,Ke.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},Ke.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},Ke.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},Ke.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},Ke.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},Ke.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},Ke.scaleAndAdd=function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e},Ke.distance=LZ,Ke.squaredDistance=zZ,Ke.length=wZ,Ke.squaredLength=EZ,Ke.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},Ke.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},Ke.normalize=function(e,t){var i=t[0],n=t[1],r=i*i+n*n;return r>0&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e},Ke.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},Ke.cross=function(e,t,i){var n=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=n,e},Ke.lerp=function(e,t,i,n){var r=t[0],s=t[1];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e},Ke.random=function(e,t){t=t||1;var i=2*zs.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},Ke.transformMat2=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e},Ke.transformMat2d=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r+i[4],e[1]=i[1]*n+i[3]*r+i[5],e},Ke.transformMat3=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e},Ke.transformMat4=function(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e},Ke.rotate=function(e,t,i,n){var r=t[0]-i[0],s=t[1]-i[1],b=Math.sin(n),h=Math.cos(n);return e[0]=r*h-s*b+i[0],e[1]=r*b+s*h+i[1],e},Ke.angle=function(e,t){var i=e[0],n=e[1],r=t[0],s=t[1],b=Math.sqrt(i*i+n*n)*Math.sqrt(r*r+s*s);return Math.acos(Math.min(Math.max(b&&(i*r+n*s)/b,-1),1))},Ke.zero=function(e){return e[0]=0,e[1]=0,e},Ke.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},Ke.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Ke.equals=function(e,t){var i=e[0],n=e[1],r=t[0],s=t[1];return Math.abs(i-r)<=zs.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=zs.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},Ke.forEach=Ke.sqrLen=Ke.sqrDist=Ke.dist=Ke.div=Ke.mul=Ke.sub=Ke.len=void 0;var zs=function(e,t){if(e&&e.__esModule)return e;if(e===null||VW(e)!=="object"&&typeof e!="function")return{default:e};var i=kZ(void 0);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}(za);function kZ(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(kZ=function(n){return n?i:t})(e)}function QZ(){var e=new zs.ARRAY_TYPE(2);return zs.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function SZ(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function fZ(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function vZ(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function LZ(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function zZ(e,t){var i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function wZ(e){return Math.hypot(e[0],e[1])}function EZ(e){var t=e[0],i=e[1];return t*t+i*i}Ke.len=wZ,Ke.sub=SZ,Ke.mul=fZ,Ke.div=vZ,Ke.dist=LZ,Ke.sqrDist=zZ,Ke.sqrLen=EZ;var XU=function(){var e=QZ();return function(t,i,n,r,s,b){var h,W;for(i||(i=2),n||(n=0),W=r?Math.min(r*i+n,t.length):t.length,h=n;h<W;h+=i)e[0]=t[h],e[1]=t[h+1],s(e,e,b),t[h]=e[0],t[h+1]=e[1];return t}}();function RW(e){return RW=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},RW(e)}Ke.forEach=XU,Object.defineProperty(La,"__esModule",{value:!0}),o.a7=La.vec4=o.N=La.vec3=La.vec2=La.quat2=o.bi=La.quat=o.a6=La.mat4=o.co=La.mat3=La.mat2d=o.b4=La.mat2=La.glMatrix=void 0;var JU=Ro(za);La.glMatrix=JU;var yU=Ro(aa);o.b4=La.mat2=yU;var BU=Ro(oa);La.mat2d=BU;var MU=Ro(ki);o.co=La.mat3=MU;var CU=Ro(je);o.a6=La.mat4=CU;var TU=Ro(ze);o.bi=La.quat=TU;var kU=Ro(di);La.quat2=kU;var QU=Ro(Ke);La.vec2=QU;var SU=Ro(He);o.N=La.vec3=SU;var fU=Ro(ai);function AZ(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(AZ=function(n){return n?i:t})(e)}function Ro(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||RW(e)!=="object"&&typeof e!="function")return{default:e};var i=AZ(t);if(i&&i.has(e))return i.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var b=r?Object.getOwnPropertyDescriptor(e,s):null;b&&(b.get||b.set)?Object.defineProperty(n,s,b):n[s]=e[s]}return n.default=e,i&&i.set(e,n),n}o.a7=La.vec4=fU;class GW{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,n){let r=o.N.dot(i,this.dir);if(Math.abs(r)<1e-6)return!1;let s=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/r;return n[0]=this.pos[0]+this.dir[0]*s,n[1]=this.pos[1]+this.dir[1]*s,n[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(t,i,n){if(o.N.equals(this.pos,t)||i===0)return n[0]=n[1]=n[2]=0,!1;let[r,s,b]=this.dir,h=this.pos[0]-t[0],W=this.pos[1]-t[1],u=this.pos[2]-t[2],V=r*r+s*s+b*b,F=2*(h*r+W*s+u*b),U=F*F-4*V*(h*h+W*W+u*u-i*i);if(U<0){let X=Math.max(-F/2,0),y=h+r*X,B=W+s*X,k=u+b*X,S=Math.hypot(y,B,k);return n[0]=y*i/S,n[1]=B*i/S,n[2]=k*i/S,!1}{let X=(-F-Math.sqrt(U))/(2*V);if(X<0){let y=Math.hypot(h,W,u);return n[0]=h*i/y,n[1]=W*i/y,n[2]=u*i/y,!1}return n[0]=h+r*X,n[1]=W+s*X,n[2]=u+b*X,!0}}}class FW{constructor(t,i,n,r,s){this.TL=t,this.TR=i,this.BR=n,this.BL=r,this.horizon=s}static fromInvProjectionMatrix(t,i,n){let r=[-1,1,1],s=[1,1,1],b=[1,-1,1],h=[-1,-1,1],W=o.N.transformMat4(r,r,t),u=o.N.transformMat4(s,s,t),V=o.N.transformMat4(b,b,t),F=o.N.transformMat4(h,h,t);return new FW(W,u,V,F,i/n)}}function sm(e,t,i){let n=1/0,r=-1/0,s=[];for(let b of e){o.N.sub(s,b,t);let h=o.N.dot(s,i);n=Math.min(n,h),r=Math.max(r,h)}return[n,r]}function HZ(e,t){let i=!0;for(let n=0;n<e.planes.length;n++){let r=e.planes[n],s=0;for(let b=0;b<t.length;b++)s+=o.N.dot(r,t[b])+r[3]>=0;if(s===0)return 0;s!==t.length&&(i=!1)}return i?2:1}function jZ(e,t){for(let i of e.projections){let n=sm(t,e.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function OZ(e,t){let i=0,n=[0,0,0,0];for(let r=0;r<e.length;r++)n[0]=e[r][0],n[1]=e[r][1],n[2]=e[r][2],n[3]=1,o.a7.dot(n,t)>=0&&i++;return i}class IW{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=ra.fromPoints(this.points),this.projections=[],this.frustumEdges=[o.N.sub([],this.points[2],this.points[3]),o.N.sub([],this.points[0],this.points[3]),o.N.sub([],this.points[4],this.points[0]),o.N.sub([],this.points[5],this.points[1]),o.N.sub([],this.points[6],this.points[2]),o.N.sub([],this.points[7],this.points[3])];for(let n of this.frustumEdges){let r=[0,-n[2],n[1]],s=[n[2],0,-n[0]];this.projections.push({axis:r,projection:sm(this.points,this.points[0],r)}),this.projections.push({axis:s,projection:sm(this.points,this.points[0],s)})}}static fromInvProjectionMatrix(t,i,n,r){let s=Math.pow(2,n),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(u=>{let V=o.a7.transformMat4([],u,t),F=1/V[3]/i*s;return o.a7.mul(V,V,[F,F,r?1/V[3]:F,F])}),h=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(u=>{let V=o.N.sub([],b[u[0]],b[u[1]]),F=o.N.sub([],b[u[2]],b[u[1]]),U=o.N.normalize([],o.N.cross([],V,F)),X=-o.N.dot(U,b[u[1]]);return U.concat(X)}),W=[];for(let u=0;u<b.length;u++)W.push([b[u][0],b[u][1],b[u][2]]);return new IW(W,h)}intersectsPrecise(t,i,n){for(let r=0;r<i.length;r++)if(!OZ(t,i[r]))return 0;for(let r=0;r<this.planes.length;r++)if(!OZ(t,this.planes[r]))return 0;for(let r of n)for(let s of this.frustumEdges){let b=o.N.cross([],r,s),h=o.N.length(b);if(h===0)continue;o.N.scale(b,b,1/h);let W=sm(this.points,this.points[0],b),u=sm(t,this.points[0],b);if(W[0]>u[1]||u[0]>W[1])return 0}return 1}}class ra{static fromPoints(t){let i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(let r of t)o.N.min(i,i,r),o.N.max(n,n,r);return new ra(i,n)}static fromTileIdAndHeight(t,i,n){let r=1<<t.canonical.z,s=t.canonical.x,b=t.canonical.y;return new ra([s/r,b/r,i],[(s+1)/r,(b+1)/r,n])}static applyTransform(t,i){let n=t.getCorners();for(let r=0;r<n.length;++r)o.N.transformMat4(n[r],n[r],i);return ra.fromPoints(n)}static projectAabbCorners(t,i){let n=t.getCorners();for(let r=0;r<n.length;++r)o.N.transformMat4(n[r],n[r],i);return n}constructor(t,i){this.min=t,this.max=i,this.center=o.N.scale([],o.N.add([],this.min,this.max),.5)}quadrant(t){let i=[t%2==0,t<2],n=o.N.clone(this.min),r=o.N.clone(this.max);for(let s=0;s<i.length;s++)n[s]=i[s]?this.min[s]:this.center[s],r[s]=i[s]?this.center[s]:this.max[s];return r[2]=this.max[2],new ra(n,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){let t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?HZ(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?HZ(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?jZ(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?jZ(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}se(ra,"Aabb");let vU=Ni([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ah}=vU,LU=Ni([{name:"a_pos_3",components:3,type:"Int16"}]);var DZ=Ni([{name:"a_pos",type:"Int16",components:2}]);function nh(e){return e*H/Gt}let zU=[new ra([rt,rt,rt],[Zt,Zt,Zt]),new ra([rt,rt,rt],[0,0,Zt]),new ra([0,rt,rt],[Zt,0,Zt]),new ra([rt,0,rt],[0,Zt,Zt]),new ra([0,0,rt],[Zt,Zt,Zt])];function _Z(e,t,i,n=!0){let r=o.N.scale([],e._camera.position,e.worldSize),s=[t,i,1,1];o.a7.transformMat4(s,s,e.pixelMatrixInverse),o.a7.scale(s,s,1/s[3]);let b=o.N.sub([],s,r),h=o.N.normalize([],b),W=e.globeMatrix,u=[W[12],W[13],W[14]],V=o.N.sub([],u,r),F=o.N.length(V),U=o.N.normalize([],V),X=e.worldSize/(2*Math.PI),y=o.N.dot(U,h),B=Math.asin(X/F);if(B<Math.acos(y)){if(!n)return null;let pt=[],xt=[];o.N.scale(pt,h,F/y),o.N.normalize(xt,o.N.sub(xt,pt,V)),o.N.normalize(h,o.N.add(h,V,o.N.scale(h,xt,Math.tan(B)*F)))}let k=[];new GW(r,h).closestPointOnSphere(u,X,k);let S=o.N.normalize([],tt(W,0)),A=o.N.normalize([],tt(W,1)),D=o.N.normalize([],tt(W,2)),O=o.N.dot(S,k),et=o.N.dot(A,k),$=o.N.dot(D,k),nt=Bi(Math.asin(-et/X)),dt=Bi(Math.atan2(O,$));dt=e.center.lng+function(pt,xt){let kt=(xt-pt+180)%360-180;return kt<-180?kt+360:kt}(e.center.lng,dt);let ht=Ae(dt),gt=ke(Me(nt),0,1);return new mi(ht,gt)}class wU{constructor(t,i,n){this.a=o.N.sub([],t,n),this.b=o.N.sub([],i,n),this.center=n;let r=o.N.normalize([],this.a),s=o.N.normalize([],this.b);this.angle=Math.acos(o.N.dot(r,s))}}function UW(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(n,r,s,b){let h=Math.sin(s);return n*(Math.sin((1-b)*s)/h)+r*(Math.sin(b*s)/h)}(e.a[t],e.b[t],e.angle,ke(i,0,1))+e.center[t]}function Go(e){if(e.z<=1)return zU[e.z+2*e.y+e.x];let t=xW(lh(e));return ra.fromPoints(t)}function Ho(e,t,i){return o.N.scale(e,e,1-i),o.N.scaleAndAdd(e,e,t,i)}function PZ(e,t,i){for(let n of e)o.N.transformMat4(n,n,t),o.N.scale(n,n,i)}function KZ(e,t,i,n){let r=t/e.worldSize,s=e.globeMatrix;if(i.z<=1){let ht=Go(i).getCorners();return PZ(ht,s,r),ra.fromPoints(ht)}let b=lh(i,n),h=xW(b,H+nh(e._tileCoverLift));PZ(h,s,r);let W=Number.MAX_VALUE,u=[-W,-W,-W],V=[W,W,W];if(b.contains(e.center)){for(let pt of h)o.N.min(V,V,pt),o.N.max(u,u,pt);u[2]=0;let ht=e.point,gt=[ht.x*r,ht.y*r,0];return o.N.min(V,V,gt),o.N.max(u,u,gt),new ra(V,u)}if(e._tileCoverLift>0){for(let ht of h)o.N.min(V,V,ht),o.N.max(u,u,ht);return new ra(V,u)}let F=[s[12]*r,s[13]*r,s[14]*r],U=b.getCenter(),X=ke(e.center.lat,-$e,$e),y=ke(U.lat,-$e,$e),B=Ae(e.center.lng),k=Me(X),S=B-Ae(U.lng),A=k-Me(y);S>.5?S-=1:S<-.5&&(S+=1);let D=0;if(Math.abs(S)>Math.abs(A))D=S>=0?1:3;else{D=A>=0?0:2;let ht=[s[4]*r,s[5]*r,s[6]*r],gt=-Math.sin(ye(A>=0?b.getSouth():b.getNorth()))*H;o.N.scaleAndAdd(F,F,ht,gt)}let O=h[D],et=h[(D+1)%4],$=new wU(O,et,F),nt=[UW($,0)||O[0],UW($,1)||O[1],UW($,2)||O[2]],dt=Xr(e.zoom);if(dt>0){let ht=function({x:pt,y:xt,z:kt},Ft,Ct,Rt,Bt){let _t=1/(1<<kt),Qt=pt*_t,be=Qt+_t,ne=xt*_t,vt=ne+_t,Xe=0,Ve=(Qt+be)/2-Rt;return Ve>.5?Xe=-1:Ve<-.5&&(Xe=1),Qt=((Qt+Xe)*Ft-(Rt*=Ft))*Ct+Rt,be=((be+Xe)*Ft-Rt)*Ct+Rt,ne=(ne*Ft-(Bt*=Ft))*Ct+Bt,vt=(vt*Ft-Bt)*Ct+Bt,[[Qt,vt,0],[be,vt,0],[be,ne,0],[Qt,ne,0]]}(i,t,e._pixelsPerMercatorPixel,B,k);for(let pt=0;pt<h.length;pt++)Ho(h[pt],ht[pt],dt);let gt=o.N.add([],ht[D],ht[(D+1)%4]);o.N.scale(gt,gt,.5),Ho(nt,gt,dt)}for(let ht of h)o.N.min(V,V,ht),o.N.max(u,u,ht);return V[2]=Math.min(O[2],et[2]),o.N.min(V,V,nt),o.N.max(u,u,nt),new ra(V,u)}function lh({x:e,y:t,z:i},n=!1){let r=1/(1<<i),s=new mt(Qe(e*r),t===(1<<i)-1&&n?-90:si((t+1)*r)),b=new mt(Qe((e+1)*r),t===0&&n?90:si(t*r));return new Vt(s,b)}function xW(e,t=H){let i=ye(e.getNorth()),n=ye(e.getSouth()),r=Math.cos(i),s=Math.cos(n),b=Math.sin(i),h=Math.sin(n),W=e.getWest(),u=e.getEast();return[bt(s,h,W,t),bt(s,h,u,t),bt(r,b,u,t),bt(r,b,W,t)]}function dm(e,t,i,n){let r=1<<i.z,s=(e/ie+i.x)/r;return It(si((t/ie+i.y)/r),Qe(s),n)}function oh({min:e,max:t}){return q/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}let qZ=new Float64Array(16);function rh(e){let t=oh(e),i=o.a6.fromScaling(qZ,[t,t,t]);return o.a6.translate(i,i,o.N.negate([],e.min))}function NW(e){let t=o.a6.fromTranslation(qZ,e.min),i=1/oh(e);return o.a6.scale(t,t,[i,i,i])}function YW(e){let t=ie/(2*Math.PI);return e/(2*Math.PI)/t}function $Z(e,t){return ie/(512*Math.pow(2,e))*oh(Go(t))}function tg(e,t,i,n,r){let s=YW(i),b=[e,t,-i/(2*Math.PI)],h=o.a6.identity(new Float64Array(16));return o.a6.translate(h,h,b),o.a6.scale(h,h,[s,s,s]),o.a6.rotateX(h,h,ye(-r)),o.a6.rotateY(h,h,ye(-n)),h}function Xr(e){return Ba(K,w,e)}function eg(e,t){let i=It(t.lat,t.lng),n=function(s){let b=It(s._center.lat,s._center.lng),h=o.N.fromValues(0,1,0),W=o.N.cross([],h,b),u=o.a6.fromRotation([],-s.angle,b);W=o.N.transformMat4(W,W,u),o.a6.fromRotation(u,-s._pitch,W);let V=o.N.normalize([],b);return o.N.scale(V,V,nh(s.cameraToCenterDistance/s.pixelsPerMeter)),o.N.transformMat4(V,V,u),o.N.add([],b,V)}(e),r=o.N.subtract([],n,i);return o.N.angle(r,i)}function XW(e,t){return eg(e,t)>Math.PI/2*1.01}let ig=ye(85),EU=Math.cos(ig),AU=Math.sin(ig),HU=o.a6.create(),ag=e=>{let t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function ng(e,t,i,n,r,s,b,h,W){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(W*=e.pixelToTileUnitsFactor);let u=e.tileID.canonical,V=i.projection.upVectorScale(u,i.center.lat,i.worldSize).metersToTile;for(let F of t)for(let U of F){let X=U.add(h),y=r&&i.elevation?i.elevation.exaggeration()*r.getElevationAt(X.x,X.y,!0):0,B=i.projection.projectTilePoint(X.x,X.y,u);if(y>0){let D=i.projection.upVector(u,X.x,X.y);B.x+=D[0]*V*y,B.y+=D[1]*V*y,B.z+=D[2]*V*y}let k=s?X:jU(B.x,B.y,B.z,n),S=s?e.tilespaceRays.map(D=>DU(D,y)):e.queryGeometry.screenGeometry,A=o.a7.transformMat4([],[B.x,B.y,B.z,1],n);if(!b&&s?W*=A[3]/i.cameraToCenterDistance:b&&!s&&(W*=i.cameraToCenterDistance/A[3]),s){let D=si((U.y/ie+u.y)/(1<<u.z));W/=i.projection.pixelsPerMeter(D,1)/fe(1,D)}if(go(S,k,W))return!0}return!1}function jU(e,t,i,n){let r=o.a7.transformMat4([],[e,t,i,1],n);return new Nt(r[0]/r[3],r[1]/r[3])}let lg=o.N.fromValues(0,0,0),OU=o.N.fromValues(0,0,1);function DU(e,t){let i=o.N.create();return lg[2]=t,e.intersectsPlane(lg,OU,i),new Nt(i[0],i[1])}class og extends Xn{}function rg(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function sg(e,t,i){let{width:n,height:r}=t;n===e.width&&r===e.height||(JW(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,r)},i),e.width=n,e.height=r,e.data=t.data)}function JW(e,t,i,n,r,s,b){if(r.width===0||r.height===0)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");let h=e.data,W=t.data,u=s===4&&b;for(let V=0;V<r.height;V++){let F=((i.y+V)*e.width+i.x)*s,U=((n.y+V)*t.width+n.x)*s;if(u)for(let X=0;X<r.width;X++){let y=F+X*s+3,B=U+X*s;W[B+0]=255,W[B+1]=255,W[B+2]=255,W[B+3]=h[y]}else for(let X=0;X<r.width*s;X++)W[U+X]=h[F+X]}return t}se(og,"HeatmapBucket",{omit:["layers"]});class Jr{constructor(t,i){rg(this,t,1,i)}resize(t){sg(this,new Jr(t),1)}clone(){return new Jr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,n,r,s){JW(t,i,n,r,s,1)}}class bl{constructor(t,i){rg(this,t,4,i)}resize(t){sg(this,new bl(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new bl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,n,r,s,b){JW(t,i,n,r,s,4,b)}}class dg{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}se(Jr,"AlphaImage"),se(bl,"RGBAImage");let _U=new ea({visibility:new jt(ut.layout_heatmap.visibility)});var PU={paint:new ea({"heatmap-radius":new Ue(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ue(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fo(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(ut.paint_heatmap["heatmap-opacity"])}),layout:_U};function cm(e){let t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new bl({width:i,height:n}),s=(b,h,W)=>{t[e.evaluationKey]=W;let u=e.expression.evaluate(t);u&&(r.data[b+h+0]=Math.floor(255*u.r/u.a),r.data[b+h+1]=Math.floor(255*u.g/u.a),r.data[b+h+2]=Math.floor(255*u.b/u.a),r.data[b+h+3]=Math.floor(255*u.a))};if(e.clips)for(let b=0,h=0;b<n;++b,h+=4*i)for(let W=0,u=0;W<i;W++,u+=4){let V=W/(i-1),{start:F,end:U}=e.clips[b];s(h,u,F*(1-V)+U*V)}else for(let b=0,h=0;b<i;b++,h+=4)s(0,h,b/(i-1));return r}let KU=new ea({visibility:new jt(ut.layout_hillshade.visibility)});var qU={paint:new ea({"hillshade-illumination-direction":new jt(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(ut.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new jt(ut.paint_hillshade["hillshade-emissive-strength"])}),layout:KU};let $U=Ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:tx}=$U;var yW={exports:{}};function sh(e,t,i){i=i||2;var n,r,s,b,h,W,u,V=t&&t.length,F=V?t[0]*i:e.length,U=cg(e,0,F,i,!0),X=[];if(!U||U.next===U.prev)return X;if(V&&(U=function(B,k,S,A){var D,O,et,$=[];for(D=0,O=k.length;D<O;D++)(et=cg(B,k[D]*A,D<O-1?k[D+1]*A:B.length,A,!1))===et.next&&(et.steiner=!0),$.push(sx(et));for($.sort(lx),D=0;D<$.length;D++)S=ox($[D],S);return S}(e,t,U,i)),e.length>80*i){n=s=e[0],r=b=e[1];for(var y=i;y<F;y+=i)(h=e[y])<n&&(n=h),(W=e[y+1])<r&&(r=W),h>s&&(s=h),W>b&&(b=W);u=(u=Math.max(s-n,b-r))!==0?32767/u:0}return bm(U,X,i,n,r,u,0),X}function cg(e,t,i,n,r){var s,b;if(r===CW(e,t,i,n)>0)for(s=t;s<i;s+=n)b=hg(s,e[s],e[s+1],b);else for(s=i-n;s>=t;s-=n)b=hg(s,e[s],e[s+1],b);return b&&dh(b,b.next)&&(hm(b),b=b.next),b}function ws(e,t){if(!e)return e;t||(t=e);var i,n=e;do if(i=!1,n.steiner||!dh(n,n.next)&&Xa(n.prev,n,n.next)!==0)n=n.next;else{if(hm(n),(n=t=n.prev)===n.next)break;i=!0}while(i||n!==t);return t}function bm(e,t,i,n,r,s,b){if(e){!b&&s&&function(V,F,U,X){var y=V;do y.z===0&&(y.z=BW(y.x,y.y,F,U,X)),y.prevZ=y.prev,y.nextZ=y.next,y=y.next;while(y!==V);y.prevZ.nextZ=null,y.prevZ=null,function(B){var k,S,A,D,O,et,$,nt,dt=1;do{for(S=B,B=null,O=null,et=0;S;){for(et++,A=S,$=0,k=0;k<dt&&($++,A=A.nextZ);k++);for(nt=dt;$>0||nt>0&&A;)$!==0&&(nt===0||!A||S.z<=A.z)?(D=S,S=S.nextZ,$--):(D=A,A=A.nextZ,nt--),O?O.nextZ=D:B=D,D.prevZ=O,O=D;S=A}O.nextZ=null,dt*=2}while(et>1)}(y)}(e,n,r,s);for(var h,W,u=e;e.prev!==e.next;)if(h=e.prev,W=e.next,s?ix(e,n,r,s):ex(e))t.push(h.i/i|0),t.push(e.i/i|0),t.push(W.i/i|0),hm(e),e=W.next,u=W.next;else if((e=W)===u){b?b===1?bm(e=ax(ws(e),t,i),t,i,n,r,s,2):b===2&&nx(e,t,i,n,r,s):bm(ws(e),t,i,n,r,s,1);break}}}function ex(e){var t=e.prev,i=e,n=e.next;if(Xa(t,i,n)>=0)return!1;for(var r=t.x,s=i.x,b=n.x,h=t.y,W=i.y,u=n.y,V=r<s?r<b?r:b:s<b?s:b,F=h<W?h<u?h:u:W<u?W:u,U=r>s?r>b?r:b:s>b?s:b,X=h>W?h>u?h:u:W>u?W:u,y=n.next;y!==t;){if(y.x>=V&&y.x<=U&&y.y>=F&&y.y<=X&&_d(r,h,s,W,b,u,y.x,y.y)&&Xa(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function ix(e,t,i,n){var r=e.prev,s=e,b=e.next;if(Xa(r,s,b)>=0)return!1;for(var h=r.x,W=s.x,u=b.x,V=r.y,F=s.y,U=b.y,X=h<W?h<u?h:u:W<u?W:u,y=V<F?V<U?V:U:F<U?F:U,B=h>W?h>u?h:u:W>u?W:u,k=V>F?V>U?V:U:F>U?F:U,S=BW(X,y,t,i,n),A=BW(B,k,t,i,n),D=e.prevZ,O=e.nextZ;D&&D.z>=S&&O&&O.z<=A;){if(D.x>=X&&D.x<=B&&D.y>=y&&D.y<=k&&D!==r&&D!==b&&_d(h,V,W,F,u,U,D.x,D.y)&&Xa(D.prev,D,D.next)>=0||(D=D.prevZ,O.x>=X&&O.x<=B&&O.y>=y&&O.y<=k&&O!==r&&O!==b&&_d(h,V,W,F,u,U,O.x,O.y)&&Xa(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;D&&D.z>=S;){if(D.x>=X&&D.x<=B&&D.y>=y&&D.y<=k&&D!==r&&D!==b&&_d(h,V,W,F,u,U,D.x,D.y)&&Xa(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;O&&O.z<=A;){if(O.x>=X&&O.x<=B&&O.y>=y&&O.y<=k&&O!==r&&O!==b&&_d(h,V,W,F,u,U,O.x,O.y)&&Xa(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function ax(e,t,i){var n=e;do{var r=n.prev,s=n.next.next;!dh(r,s)&&bg(r,n,n.next,s)&&mm(r,s)&&mm(s,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(s.i/i|0),hm(n),hm(n.next),n=e=s),n=n.next}while(n!==e);return ws(n)}function nx(e,t,i,n,r,s){var b=e;do{for(var h=b.next.next;h!==b.prev;){if(b.i!==h.i&&dx(b,h)){var W=mg(b,h);return b=ws(b,b.next),W=ws(W,W.next),bm(b,t,i,n,r,s,0),void bm(W,t,i,n,r,s,0)}h=h.next}b=b.next}while(b!==e)}function lx(e,t){return e.x-t.x}function ox(e,t){var i=function(r,s){var b,h=s,W=r.x,u=r.y,V=-1/0;do{if(u<=h.y&&u>=h.next.y&&h.next.y!==h.y){var F=h.x+(u-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(F<=W&&F>V&&(V=F,b=h.x<h.next.x?h:h.next,F===W))return b}h=h.next}while(h!==s);if(!b)return null;var U,X=b,y=b.x,B=b.y,k=1/0;h=b;do W>=h.x&&h.x>=y&&W!==h.x&&_d(u<B?W:V,u,y,B,u<B?V:W,u,h.x,h.y)&&(U=Math.abs(u-h.y)/(W-h.x),mm(h,r)&&(U<k||U===k&&(h.x>b.x||h.x===b.x&&rx(b,h)))&&(b=h,k=U)),h=h.next;while(h!==X);return b}(e,t);if(!i)return t;var n=mg(i,e);return ws(n,n.next),ws(i,i.next)}function rx(e,t){return Xa(e.prev,e,t.prev)<0&&Xa(t.next,e,e.next)<0}function BW(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function sx(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function _d(e,t,i,n,r,s,b,h){return(r-b)*(t-h)>=(e-b)*(s-h)&&(e-b)*(n-h)>=(i-b)*(t-h)&&(i-b)*(s-h)>=(r-b)*(n-h)}function dx(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,n){var r=i;do{if(r.i!==i.i&&r.next.i!==i.i&&r.i!==n.i&&r.next.i!==n.i&&bg(r,r.next,i,n))return!0;r=r.next}while(r!==i);return!1}(e,t)&&(mm(e,t)&&mm(t,e)&&function(i,n){var r=i,s=!1,b=(i.x+n.x)/2,h=(i.y+n.y)/2;do r.y>h!=r.next.y>h&&r.next.y!==r.y&&b<(r.next.x-r.x)*(h-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next;while(r!==i);return s}(e,t)&&(Xa(e.prev,e,t.prev)||Xa(e,t.prev,t))||dh(e,t)&&Xa(e.prev,e,e.next)>0&&Xa(t.prev,t,t.next)>0)}function Xa(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function dh(e,t){return e.x===t.x&&e.y===t.y}function bg(e,t,i,n){var r=bh(Xa(e,t,i)),s=bh(Xa(e,t,n)),b=bh(Xa(i,n,e)),h=bh(Xa(i,n,t));return r!==s&&b!==h||!(r!==0||!ch(e,i,t))||!(s!==0||!ch(e,n,t))||!(b!==0||!ch(i,e,n))||!(h!==0||!ch(i,t,n))}function ch(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function bh(e){return e>0?1:e<0?-1:0}function mm(e,t){return Xa(e.prev,e,e.next)<0?Xa(e,t,e.next)>=0&&Xa(e,e.prev,t)>=0:Xa(e,t,e.prev)<0||Xa(e,e.next,t)<0}function mg(e,t){var i=new MW(e.i,e.x,e.y),n=new MW(t.i,t.x,t.y),r=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function hg(e,t,i,n){var r=new MW(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function hm(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function MW(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function CW(e,t,i,n){for(var r=0,s=t,b=i-n;s<i;s+=n)r+=(e[b]-e[s])*(e[s+1]+e[b+1]),b=s;return r}yW.exports=sh,yW.exports.default=sh,sh.deviation=function(e,t,i,n){var r=t&&t.length,s=Math.abs(CW(e,0,r?t[0]*i:e.length,i));if(r)for(var b=0,h=t.length;b<h;b++)s-=Math.abs(CW(e,t[b]*i,b<h-1?t[b+1]*i:e.length,i));var W=0;for(b=0;b<n.length;b+=3){var u=n[b]*i,V=n[b+1]*i,F=n[b+2]*i;W+=Math.abs((e[u]-e[F])*(e[V+1]-e[u+1])-(e[u]-e[V])*(e[F+1]-e[u+1]))}return s===0&&W===0?0:Math.abs((W-s)/s)},sh.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var s=0;s<e[r].length;s++)for(var b=0;b<t;b++)i.vertices.push(e[r][s][b]);r>0&&i.holes.push(n+=e[r-1].length)}return i};var mh=Ee(yW.exports);function TW(e,t){let i=e.length;if(i<=1)return[e];let n=[],r,s;for(let b=0;b<i;b++){let h=gl(e[b]);h!==0&&(e[b].area=Math.abs(h),s===void 0&&(s=h<0),s===h<0?(r&&n.push(r),r=[e[b]]):r.push(e[b]))}if(r&&n.push(r),t>1)for(let b=0;b<n.length;b++)n[b].length<=t||(Qp(n[b],t,1,n[b].length-1,cx),n[b]=n[b].slice(0,t));return n}function cx(e,t){return t.area-e.area}function kW(e,t,i){let n=i.patternDependencies,r=!1;for(let s of t){let b=s.paint.get("".concat(e,"-pattern"));b.isConstant()||(r=!0);let h=b.constantOr(null);h&&(r=!0,n[h]=!0)}return r}function QW(e,t,i,n,r){let s=r.patternDependencies;for(let b of t){let h=b.paint.get("".concat(e,"-pattern")).value;if(h.kind!=="constant"){let W=h.evaluate({zoom:n},i,{},r.availableImages);W=W&&W.name?W.name:W,s[W]=!0,i.patterns[b.id]=W}}return i}class SW{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new sl,this.indexArray=new Qa,this.indexArray2=new Gl,this.programConfigurations=new v(t.layers,t.zoom),this.segments=new da,this.segments2=new da,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,n,r){this.hasPattern=kW("fill",this.layers,i);let s=this.layers[0].layout.get("fill-sort-key"),b=[];for(let{feature:h,id:W,index:u,sourceLayerIndex:V}of t){let F=this.layers[0]._featureFilter.needGeometry,U=xa(h,F);if(!this.layers[0]._featureFilter.filter(new ta(this.zoom),U,n))continue;let X=s?s.evaluate(U,{},n,i.availableImages):void 0,y={id:W,properties:h.properties,type:h.type,sourceLayerIndex:V,index:u,geometry:F?U.geometry:fa(h,n,r),patterns:{},sortKey:X};b.push(y)}s&&b.sort((h,W)=>h.sortKey-W.sortKey);for(let h of b){let{geometry:W,index:u,sourceLayerIndex:V}=h;if(this.hasPattern){let F=QW("fill",this.layers,h,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(h,W,u,n,{},i.availableImages,i.brightness);i.featureIndex.insert(t[u].feature,W,u,V,this.index)}}update(t,i,n,r,s){let b=Object.keys(t).length!==0;b&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,b?this.stateDependentLayers:this.layers,n,r,s)}addFeatures(t,i,n,r,s,b){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,n,r,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tx),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,n,r,s,b=[],h){for(let W of TW(i,500)){let u=0;for(let B of W)u+=B.length;let V=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),F=V.vertexLength,U=[],X=[];for(let B of W){if(B.length===0)continue;B!==W[0]&&X.push(U.length/2);let k=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),S=k.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(S+B.length-1,S),U.push(B[0].x),U.push(B[0].y);for(let A=1;A<B.length;A++)this.layoutVertexArray.emplaceBack(B[A].x,B[A].y),this.indexArray2.emplaceBack(S+A-1,S+A),U.push(B[A].x),U.push(B[A].y);k.vertexLength+=B.length,k.primitiveLength+=B.length}let y=mh(U,X);for(let B=0;B<y.length;B+=3)this.indexArray.emplaceBack(F+y[B],F+y[B+1],F+y[B+2]);V.vertexLength+=u,V.primitiveLength+=y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,s,b,r,h)}}se(SW,"FillBucket",{omit:["layers","patternFeatures"]});let bx=new ea({"fill-sort-key":new Ue(ut.layout_fill["fill-sort-key"]),visibility:new jt(ut.layout_fill.visibility)});var mx={paint:new ea({"fill-antialias":new jt(ut.paint_fill["fill-antialias"]),"fill-opacity":new Ue(ut.paint_fill["fill-opacity"]),"fill-color":new Ue(ut.paint_fill["fill-color"]),"fill-outline-color":new Ue(ut.paint_fill["fill-outline-color"]),"fill-translate":new jt(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ue(ut.paint_fill["fill-pattern"]),"fill-emissive-strength":new jt(ut.paint_fill["fill-emissive-strength"])}),layout:bx};let hx=Ni([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),px=Ni([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Wx=Ni([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ux=Ni([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Zx=Ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gx}=hx;var hh={},Vx=Se,pg=Pd;function Pd(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,e.readFields(Rx,this,t)}function Rx(e,t,i){e==1?t.id=i.readVarint():e==2?function(n,r){for(var s=n.readVarint()+n.pos;n.pos<s;){var b=r._keys[n.readVarint()],h=r._values[n.readVarint()];r.properties[b]=h}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function Gx(e){for(var t,i,n=0,r=0,s=e.length,b=s-1;r<s;b=r++)n+=((i=e[b]).x-(t=e[r]).x)*(t.y+i.y);return n}Pd.types=["Unknown","Point","LineString","Polygon"],Pd.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,r=0,s=0,b=0,h=[];e.pos<i;){if(r<=0){var W=e.readVarint();n=7&W,r=W>>3}if(r--,n===1||n===2)s+=e.readSVarint(),b+=e.readSVarint(),n===1&&(t&&h.push(t),t=[]),t.push(new Vx(s,b));else{if(n!==7)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&h.push(t),h},Pd.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,n=0,r=0,s=0,b=1/0,h=-1/0,W=1/0,u=-1/0;e.pos<t;){if(n<=0){var V=e.readVarint();i=7&V,n=V>>3}if(n--,i===1||i===2)(r+=e.readSVarint())<b&&(b=r),r>h&&(h=r),(s+=e.readSVarint())<W&&(W=s),s>u&&(u=s);else if(i!==7)throw new Error("unknown command "+i)}return[b,W,h,u]},Pd.prototype.toGeoJSON=function(e,t,i){var n,r,s=this.extent*Math.pow(2,i),b=this.extent*e,h=this.extent*t,W=this.loadGeometry(),u=Pd.types[this.type];function V(X){for(var y=0;y<X.length;y++){var B=X[y];X[y]=[360*(B.x+b)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+h)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(n=0;n<W.length;n++)F[n]=W[n][0];V(W=F);break;case 2:for(n=0;n<W.length;n++)V(W[n]);break;case 3:for(W=function(X){var y=X.length;if(y<=1)return[X];for(var B,k,S=[],A=0;A<y;A++){var D=Gx(X[A]);D!==0&&(k===void 0&&(k=D<0),k===D<0?(B&&S.push(B),B=[X[A]]):B.push(X[A]))}return B&&S.push(B),S}(W),n=0;n<W.length;n++)for(r=0;r<W[n].length;r++)V(W[n][r])}W.length===1?W=W[0]:u="Multi"+u;var U={type:"Feature",geometry:{type:u,coordinates:W},properties:this.properties};return"id"in this&&(U.id=this.id),U};var Fx=pg,Wg=ug;function ug(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ix,this,t),this.length=this._features.length}function Ix(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(n){for(var r=null,s=n.readVarint()+n.pos;n.pos<s;){var b=n.readVarint()>>3;r=b===1?n.readString():b===2?n.readFloat():b===3?n.readDouble():b===4?n.readVarint64():b===5?n.readVarint():b===6?n.readSVarint():b===7?n.readBoolean():null}return r}(i))}ug.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Fx(this._pbf,t,this.extent,this._keys,this._values)};var Ux=Wg;function xx(e,t,i){if(e===3){var n=new Ux(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}var fW=hh.VectorTile=function(e,t){this.layers=e.readFields(xx,{},t)},ph=hh.VectorTileFeature=pg;function Wh(e,t,i,n){let r=[],s=n===0?(b,h,W,u,V,F)=>{b.push(new Nt(F,W+(F-h)/(u-h)*(V-W)))}:(b,h,W,u,V,F)=>{b.push(new Nt(h+(F-W)/(V-W)*(u-h),F))};for(let b of e){let h=[];for(let W of b){if(W.length<=2)continue;let u=[];for(let U=0;U<W.length-1;U++){let X=W[U].x,y=W[U].y,B=W[U+1].x,k=W[U+1].y,S=n===0?X:y,A=n===0?B:k;S<t?A>t&&s(u,X,y,B,k,t):S>i?A<i&&s(u,X,y,B,k,i):u.push(W[U]),A<t&&S>=t&&s(u,X,y,B,k,t),A>i&&S<=i&&s(u,X,y,B,k,i)}let V=W[W.length-1],F=n===0?V.x:V.y;F>=t&&F<=i&&u.push(V),u.length&&(V=u[u.length-1],u[0].x===V.x&&u[0].y===V.y||u.push(u[0]),h.push(u))}h.length&&r.push(h)}return r}function uh(e,t){return e.x-t.x||e.y-t.y}function Zg(e,t){return uh(e.min,t.min)===0&&uh(e.max,t.max)===0}function gg(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Vg(e,t,i){let n=1/ie,r=1/(1<<i.canonical.z),s=(t.x*n+i.canonical.x)*r+i.wrap,b=(t.y*n+i.canonical.y)*r;return{min:new Nt((e.x*n+i.canonical.x)*r+i.wrap,(e.y*n+i.canonical.y)*r),max:new Nt(s,b)}}function Nx(e,t,i){let n=1<<i.canonical.z,r=((t.x-i.wrap)*n-i.canonical.x)*ie,s=(t.y*n-i.canonical.y)*ie;return{min:new Nt(((e.x-i.wrap)*n-i.canonical.x)*ie,(e.y*n-i.canonical.y)*ie),max:new Nt(r,s)}}function Rg(e,t,i,n,r,s,b){let h=e.indices,W=e.vertices,u=[];for(let V=n;V<n+r;V+=3){let F=t[i[V+0]+s],U=t[i[V+1]+s],X=t[i[V+2]+s],y=Math.min(F.x,U.x,X.x),B=Math.max(F.x,U.x,X.x),k=Math.min(F.y,U.y,X.y),S=Math.max(F.y,U.y,X.y);u.length=0,e.grid.query(new Nt(y,k),new Nt(B,S),u);for(let A=0;A<u.length;A++){let D=u[A];if(lW(W[h[3*D+0]],W[h[3*D+1]],W[h[3*D+2]],F,U,X,b))return!0}}return!1}function Gg(e,t,i,n){if(!e||!i)return!1;let r=e.vertices;if(!t.canonical.equals(n.canonical)||t.wrap!==n.wrap){if(i.vertices.length<e.vertices.length)return Gg(i,n,e,t);let s=t.canonical,b=n.canonical,h=Math.pow(2,b.z-s.z);r=e.vertices.map(W=>new Nt(W.x*s.x*ie*h-b.x*ie,W.y*s.y*ie*h-b.y*ie))}return Rg(i,r,e.indices,0,e.indices.length,0,0)}hh.VectorTileLayer=Wg;class Fg{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){let n=this.toIdx(t,i);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function Ig(e,t,i,n){let r=0,s=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(n[b])<1e-15){if(i[b]<e[b]||i[b]>t[b])return null}else{let h=1/n[b],W=(e[b]-i[b])*h,u=(t[b]-i[b])*h;if(W>u){let V=W;W=u,u=V}if(W>r&&(r=W),u<s&&(s=u),r>s)return null}return r}function Ug(e,t,i,n,r,s,b,h,W,u,V){let F=n-e,U=r-t,X=s-i,y=b-e,B=h-t,k=W-i,S=V[1]*k-V[2]*B,A=V[2]*y-V[0]*k,D=V[0]*B-V[1]*y,O=F*S+U*A+X*D;if(Math.abs(O)<1e-15)return null;let et=1/O,$=u[0]-e,nt=u[1]-t,dt=u[2]-i,ht=($*S+nt*A+dt*D)*et;if(ht<0||ht>1)return null;let gt=nt*X-dt*U,pt=dt*F-$*X,xt=$*U-nt*F,kt=(V[0]*gt+V[1]*pt+V[2]*xt)*et;return kt<0||ht+kt>1?null:(y*gt+B*pt+k*xt)*et}function xg(e,t,i){return(e-t)/(i-t)}function Ng(e,t,i,n,r,s,b,h,W){let u=1<<i,V=s-n,F=b-r,U=(e+1)/u*V+n,X=(t+0)/u*F+r,y=(t+1)/u*F+r;h[0]=(e+0)/u*V+n,h[1]=X,W[0]=U,W[1]=y}class Yg{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(s){let b=Math.ceil(Math.log2(s.dim/8)),h=[],W=Math.ceil(Math.pow(2,b)),u=1/W,V=(X,y,B,k,S)=>{let A=k?1:0,D=(X+1)*B-A,O=y*B,et=(y+1)*B-A;S[0]=X*B,S[1]=O,S[2]=D,S[3]=et},F=new Fg(W),U=[];for(let X=0;X<W*W;X++){V(X%W,Math.floor(X/W),u,!1,U);let y=yr(U[0],U[1],s),B=yr(U[2],U[1],s),k=yr(U[2],U[3],s),S=yr(U[0],U[3],s);F.minimums.push(Math.min(y,B,k,S)),F.maximums.push(Math.max(y,B,k,S)),F.leaves.push(1)}for(h.push(F),W/=2;W>=1;W/=2){let X=h[h.length-1];F=new Fg(W);for(let y=0;y<W*W;y++){V(y%W,Math.floor(y/W),2,!0,U);let B=X.getElevation(U[0],U[1]),k=X.getElevation(U[2],U[1]),S=X.getElevation(U[2],U[3]),A=X.getElevation(U[0],U[3]),D=X.isLeaf(U[0],U[1]),O=X.isLeaf(U[2],U[1]),et=X.isLeaf(U[2],U[3]),$=X.isLeaf(U[0],U[3]),nt=Math.min(B.min,k.min,S.min,A.min),dt=Math.max(B.max,k.max,S.max,A.max),ht=D&&O&&et&&$;F.maximums.push(dt),F.minimums.push(nt),F.leaves.push(dt-nt<=5&&ht?1:0)}h.push(F)}return h}(this.dem),n=i.length-1,r=i[n];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(i,0,0,n,0)}raycastRoot(t,i,n,r,s,b,h=1){return Ig([t,i,-100],[n,r,this.maximums[0]*h],s,b)}raycast(t,i,n,r,s,b,h=1){if(!this.nodeCount)return null;let W=this.raycastRoot(t,i,n,r,s,b,h);if(W==null)return null;let u=[],V=[],F=[],U=[],X=[{idx:0,t:W,nodex:0,nodey:0,depth:0}];for(;X.length>0;){let{idx:y,t:B,nodex:k,nodey:S,depth:A}=X.pop();if(this.leaves[y]){Ng(k,S,A,t,i,n,r,F,U);let O=1<<A,et=(k+0)/O,$=(k+1)/O,nt=(S+0)/O,dt=(S+1)/O,ht=yr(et,nt,this.dem)*h,gt=yr($,nt,this.dem)*h,pt=yr($,dt,this.dem)*h,xt=yr(et,dt,this.dem)*h,kt=Ug(F[0],F[1],ht,U[0],F[1],gt,U[0],U[1],pt,s,b),Ft=Ug(U[0],U[1],pt,F[0],U[1],xt,F[0],F[1],ht,s,b),Ct=Math.min(kt!==null?kt:Number.MAX_VALUE,Ft!==null?Ft:Number.MAX_VALUE);if(Ct!==Number.MAX_VALUE)return Ct;{let Rt=o.N.scaleAndAdd([],s,b,B);if(Xg(ht,gt,xt,pt,xg(Rt[0],F[0],U[0]),xg(Rt[1],F[1],U[1]))>=Rt[2])return B}continue}let D=0;for(let O=0;O<this._siblingOffset.length;O++){Ng((k<<1)+this._siblingOffset[O][0],(S<<1)+this._siblingOffset[O][1],A+1,t,i,n,r,F,U),F[2]=-100,U[2]=this.maximums[this.childOffsets[y]+O]*h;let et=Ig(F,U,s,b);if(et!=null){let $=et;u[O]=$;let nt=!1;for(let dt=0;dt<D&&!nt;dt++)$>=u[V[dt]]&&(V.splice(dt,0,O),nt=!0);nt||(V[D]=O),D++}}for(let O=0;O<D;O++){let et=V[O];X.push({idx:this.childOffsets[y]+et,t:u[et],nodex:(k<<1)+this._siblingOffset[et][0],nodey:(S<<1)+this._siblingOffset[et][1],depth:A+1})}}return null}_addNode(t,i,n){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,n,r,s){if(t[r].isLeaf(i,n)===1)return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);let b=r-1,h=t[b],W=0,u=0;for(let V=0;V<this._siblingOffset.length;V++){let F=2*i+this._siblingOffset[V][0],U=2*n+this._siblingOffset[V][1],X=h.getElevation(F,U),y=h.isLeaf(F,U),B=this._addNode(X.min,X.max,y);y&&(W|=1<<V),u||(u=B)}for(let V=0;V<this._siblingOffset.length;V++)W&1<<V||this._construct(t,2*i+this._siblingOffset[V][0],2*n+this._siblingOffset[V][1],b,u+V)}}function Xg(e,t,i,n,r,s){return li(li(e,i,s),li(t,n,s),r)}function yr(e,t,i){let n=i.dim,r=ke(e*n-.5,0,n-1),s=ke(t*n-.5,0,n-1),b=Math.floor(r),h=Math.floor(s),W=Math.min(b+1,n-1),u=Math.min(h+1,n-1);return Xg(i.get(b,h),i.get(W,h),i.get(b,u),i.get(W,u),r-b,s-h)}let Yx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Xx(e,t,i){return(256*e*256+256*t+i)/10-1e4}function Jx(e,t,i){return 256*e+t+i/256-32768}class Zh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,n,r=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return ji('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=i.height;let s=this.dim=i.height-2,b=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let W=0;W<s;W++)b[this._idx(-1,W)]=b[this._idx(0,W)],b[this._idx(s,W)]=b[this._idx(s-1,W)],b[this._idx(W,-1)]=b[this._idx(W,0)],b[this._idx(W,s)]=b[this._idx(W,s-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(s,-1)]=b[this._idx(s-1,0)],b[this._idx(-1,s)]=b[this._idx(0,s-1)],b[this._idx(s,s)]=b[this._idx(s-1,s-1)]}let h=n==="terrarium"?Jx:Xx;for(let W=0;W<b.length;++W){let u=4*W;this.floatView[W]=h(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}this._timestamp=zt.now()}_buildQuadTree(){this._tree=new Yg(this)}get(t,i,n=!1){n&&(t=ke(t,-1,this.dim),i=ke(i,-1,this.dim));let r=this._idx(t,i);return this.floatView[r]}set(t,i,n){let r=this._idx(t,i),s=this.floatView[r];return this.floatView[r]=n,n-s}static getUnpackVector(t){return Yx[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){let n=[0,0,0,0],r=Zh.getUnpackVector(i),s=Math.floor((t+r[3])/r[2]);return n[2]=s%256,s=Math.floor(s/256),n[1]=s%256,s=Math.floor(s/256),n[0]=s,n}getPixels(){return new dg({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=i*this.dim,s=i*this.dim+this.dim,b=n*this.dim,h=n*this.dim+this.dim;switch(i){case-1:r=s-1;break;case 1:s=r+1}switch(n){case-1:b=h-1;break;case 1:h=b+1}let W=-i*this.dim,u=-n*this.dim;for(let V=b;V<h;V++)for(let F=r;F<s;F++){let U=4*this._idx(F,V),X=4*this._idx(F+W,V+u);this.pixels[U+0]=t.pixels[X+0],this.pixels[U+1]=t.pixels[X+1],this.pixels[U+2]=t.pixels[X+2],this.pixels[U+3]=t.pixels[X+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}se(Zh,"DEMData"),se(Yg,"DemMinMaxQuadTree",{omit:["dem"]});class Kd{constructor(t,i,n){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=n}static create(t,i,n){let r=n||t.findDEMTileFor(i);if(!r||!r.dem)return;let s=r.dem,b=r.tileID,h=1<<i.canonical.z-b.canonical.z;return new Kd(r,s.dim/ie/h,[(i.canonical.x/h-b.canonical.x)*s.dim,(i.canonical.y/h-b.canonical.y)*s.dim])}tileCoordToPixel(t,i){let n=i*this._scale+this._offset[1],r=Math.floor(t*this._scale+this._offset[0]),s=Math.floor(n);return new Nt(r,s)}getElevationAt(t,i,n,r){let s=t*this._scale+this._offset[0],b=i*this._scale+this._offset[1],h=Math.floor(s),W=Math.floor(b),u=this._dem;return r=!!r,n?li(li(u.get(h,W,r),u.get(h,W+1,r),b-W),li(u.get(h+1,W,r),u.get(h+1,W+1,r),b-W),s-h):u.get(h,W,r)}getElevationAtPixel(t,i,n){return this._dem.get(t,i,!!n)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*fe(1,t)*this._dem.stride}}let yx=ph.types,Bx=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Mx=["fill-extrusion-flood-light-ground-radius"],Cx=Math.pow(2,13),Tx=Math.pow(2,15)-1,Jg=new Nt(0,1),Br=2147483648;function pm(e,t,i,n,r,s,b,h){e.emplaceBack((t<<1)+b,(i<<1)+s,(Math.floor(n*Cx)<<1)+r,Math.round(h))}function gh(e,t,i,n,r,s){e.emplaceBack(t.x,t.y,(i.x<<1)+n,(i.y<<1)+r,s)}function Wm(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class yg{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Bg{constructor(){this.centroidXY=new Nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Mg{constructor(){this.acc=new Nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,n){this.accCount++,this.acc._add(i);let r=!!this.borders;i.x<t.min.x?(t.min.x=i.x,r=!0):i.x>t.max.x&&(t.max.x=i.x,r=!0),i.y<t.min.y?(t.min.y=i.y,r=!0):i.y>t.max.y&&(t.max.y=i.y,r=!0),((i.x===0||i.x===ie)&&i.x===n.x)!=((i.y===0||i.y===ie)&&i.y===n.y)&&this.processBorderOverlap(i,n),r&&this.checkBorderIntersection(i,n)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,li(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>ie!=t.x>ie&&this.addBorderIntersection(1,li(i.y,t.y,(ie-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,li(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>ie!=t.y>ie&&this.addBorderIntersection(3,li(i.x,t.x,(ie-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let n=this.borders[t];i<n[0]&&(n[0]=i),i>n[1]&&(n[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;let n=t.x===0?0:1;this.addBorderIntersection(n,i.y),this.addBorderIntersection(n,t.y)}else{let n=t.y===0?2:3;this.addBorderIntersection(n,i.x),this.addBorderIntersection(n,t.x)}}centroid(){return this.accCount===0?new Nt(0,0):new Nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function Cg(e,t){let i=e.add(t)._unit(),n=ke(e.x*i.x+e.y*i.y,-1,1);var r,s,b;return r=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(r)))/4*Tx*((s=e).x*(b=t).y-s.y*b.x<0?-1:1)}let kx=[e=>e.x<0,e=>e.x>ie,e=>e.y<0,e=>e.y>ie];function Qx(e,t,i,n){let r=[4];if(n===0)return r;i._mult(n);let s=e.sub(i),b=t.sub(i),h=[e,t,s,b];for(let W=0;W<4;W++)for(let u of h)if(kx[W](u)){r.push(W);break}return r}class Tg{constructor(t){this.vertexArray=new Ob,this.indexArray=new Qa,this.programConfigurations=new v(t.layers,t.zoom,i=>Mx.includes(i)),this._segments=new da,this.hiddenByLandmarkVertexArray=new im,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new da}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,n,r=!1){let s=t.length;if(s>2){let b=Math.max(0,this._segments.get().length-1),h=this._segments._prepareSegment(4*s,this.vertexArray.length,2*this._segmentToGroundQuads[b].length),W;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{let u=t[0],V=t[1];W=Cg(u.sub(t[s-1])._perp()._unit(),V.sub(u)._perp()._unit())}for(let u=0;u<s;u++){let V=u===s-1?0:u+1,F=t[u],U=t[V],X=t[V===s-1?0:V+1],y=U.sub(F)._perp()._unit(),B=Cg(y,X.sub(U)._perp()._unit()),k=W,S=B;if(vW(F,U,i)||r&&Sg(F,i)&&Sg(U,i)){W=B;continue}let A=h.vertexLength;gh(this.vertexArray,F,U,1,1,k),gh(this.vertexArray,F,U,1,0,k),gh(this.vertexArray,F,U,0,1,S),gh(this.vertexArray,F,U,0,0,S),h.vertexLength+=4;let D=Qx(F,U,y,n);for(let O of D)this._segmentToGroundQuads[b].push({id:A,region:O}),this._segmentToRegionTriCounts[b][O]+=2,h.primitiveLength+=2;W=B}}}prepareBorderSegments(){if(!this.hasData())return;let t=this._segments.get(),i=t.length;for(let n=0;n<i;n++)this._segmentToGroundQuads[n].sort((r,s)=>r.region-s.region);for(let n=0;n<i;n++){let r=this._segmentToGroundQuads[n],s=t[n],b=this._segmentToRegionTriCounts[n];b.reduce((W,u)=>W+u,0);let h=0;for(let W=0;W<=4;W++){let u=b[W];if(u!==0){let V=this.regionSegments[W];V||(V=this.regionSegments[W]=new da);let F={vertexOffset:s.vertexOffset,primitiveOffset:s.primitiveOffset+h,vertexLength:s.vertexLength,primitiveLength:u};V.get().push(F)}h+=u}for(let W=0;W<r.length;W++){let u=r[W].id;this.indexArray.emplaceBack(u,u+1,u+3),this.indexArray.emplaceBack(u,u+3,u+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,n,r,s,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,n,r,s,b)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,px.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,n,r,s,b){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,n,r,s,b)}updateHiddenByLandmark(t){if(!this.hasData())return;let i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;let n=t.flags&Br?1:0;for(let r=t.groundVertexArrayOffset;r<i;++r)this.hiddenByLandmarkVertexArray.emplace(r,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,ux.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){let i=this.regionSegments[t];i&&i.destroy()}}}}class Vh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Qa,this.footprintVertices=new sl,this.footprintSegments=[],this.layoutVertexArray=new Sl,this.centroidVertexArray=new Ts,this.indexArray=new Qa,this.programConfigurations=new v(t.layers,t.zoom,i=>Bx.includes(i)),this.segments=new da,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Tg(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,i,n,r){this.features=[],this.hasPattern=kW("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=ei(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:s,id:b,index:h,sourceLayerIndex:W}of t){let u=this.layers[0]._featureFilter.needGeometry,V=xa(s,u);if(!this.layers[0]._featureFilter.filter(new ta(this.zoom),V,n))continue;let F={id:b,sourceLayerIndex:W,index:h,geometry:u?V.geometry:fa(s,n,r),properties:s.properties,type:s.type,patterns:{}},U=this.layoutVertexArray.length;this.hasPattern?this.features.push(QW("fill-extrusion",this.layers,F,this.zoom,i)):this.addFeature(F,F.geometry,h,n,{},i.availableImages,r,i.brightness),i.featureIndex.insert(s,F.geometry,h,W,this.index,U)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,n,r,s,b){for(let h of this.features){let{geometry:W}=h;this.addFeature(h,W,h.index,i,n,r,s,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,n,r,s){let b=Object.keys(t).length!==0;if(b&&!this.stateDependentLayers.length)return;let h=b?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,i,h,n,r,s),this.groundEffect.update(t,i,h,n,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gx),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Zx.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Wx.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,n,r,s,b,h,W){let u=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,V=[new Nt(0,0),new Nt(ie,ie)],F=h.projection,U=F.name==="globe",X=yx[t.type]==="Polygon",y=new Mg;y.centroidDataIndex=this.centroidData.length;let B=new Bg,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},r)<=0,S=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},r);B.height=S,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ld);let A=TW(i,500);for(let dt=A.length-1;dt>=0;dt--){let ht=A[dt];(ht.length===0||(D=ht[0]).every(gt=>gt.x<=0)||D.every(gt=>gt.x>=ie)||D.every(gt=>gt.y<=0)||D.every(gt=>gt.y>=ie))&&A.splice(dt,1)}var D;let O;if(U)O=zg(A,V,r);else{O=[];for(let dt of A)O.push({polygon:dt,bounds:V})}let et=X?this.edgeRadius:0,$=et>0&&this.zoom<17,nt=(dt,ht)=>{if(dt.length===0)return!1;let gt=dt[dt.length-1];return ht.x===gt.x&&ht.y===gt.y};for(let{polygon:dt,bounds:ht}of O){let gt=0,pt=0;for(let Ct of dt)X&&!Ct[0].equals(Ct[Ct.length-1])&&Ct.push(Ct[0]),pt+=X?Ct.length-1:Ct.length;let xt=this.segments.prepareSegment((X?5:4)*pt,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);let kt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ft=new yg;if(Ft.vertexOffset=this.footprintVertices.length,Ft.indexOffset=3*this.footprintIndices.length,Ft.ringIndices=[],X){let Ct=[],Rt=[];gt=xt.vertexLength;for(let _t=0;_t<dt.length;_t++){let Qt=dt[_t];Qt.length&&_t!==0&&Rt.push(Ct.length/2);let be=[],ne,vt;ne=Qt[1].sub(Qt[0])._perp()._unit(),Ft.ringIndices.push(Qt.length-1);for(let Xe=1;Xe<Qt.length;Xe++){let Ve=Qt[Xe],ce=Qt[Xe===Qt.length-1?1:Xe+1],Lt=Ve.clone();if(et){vt=ce.sub(Ve)._perp()._unit();let xe=ne.add(vt)._unit(),Oe=et*Math.min(4,1/(ne.x*xe.x+ne.y*xe.y));Lt.x+=Oe*xe.x,Lt.y+=Oe*xe.y,Lt.x=Math.round(Lt.x),Lt.y=Math.round(Lt.y),ne=vt}!k||et!==0&&!$||nt(be,Lt)||be.push(Lt),pm(this.layoutVertexArray,Lt.x,Lt.y,0,0,1,1,0),xt.vertexLength++,this.footprintVertices.emplaceBack(Ve.x,Ve.y),Ct.push(Ve.x,Ve.y),U&&Wm(this.layoutVertexExtArray,F.projectTilePoint(Lt.x,Lt.y,r),F.upVector(r,Lt.x,Lt.y))}k&&(et===0||$)&&(be.length!==0&&nt(be,be[0])&&be.pop(),this.groundEffect.addData(be,ht,u))}let Bt=mh(Ct,Rt);for(let _t=0;_t<Bt.length;_t+=3)this.footprintIndices.emplaceBack(Ft.vertexOffset+Bt[_t+0],Ft.vertexOffset+Bt[_t+1],Ft.vertexOffset+Bt[_t+2]),this.indexArray.emplaceBack(gt+Bt[_t],gt+Bt[_t+2],gt+Bt[_t+1]),xt.primitiveLength++;Ft.indexCount+=Bt.length,Ft.vertexCount+=this.footprintVertices.length-Ft.vertexOffset}for(let Ct=0;Ct<dt.length;Ct++){let Rt=dt[Ct];y.startRing(B,Rt[0]);let Bt=Rt.length>4&&fg(Rt[Rt.length-2],Rt[0],Rt[1]),_t=et?Sx(Rt[Rt.length-2],Rt[0],Rt[1],et):0,Qt=[],be,ne,vt;ne=Rt[1].sub(Rt[0])._perp()._unit();let Xe=!0;for(let Ve=1,ce=0;Ve<Rt.length;Ve++){let Lt=Rt[Ve-1],xe=Rt[Ve],Oe=Rt[Ve===Rt.length-1?1:Ve+1];if(y.appendEdge(B,xe,Lt),vW(xe,Lt,ht)){et&&(ne=Oe.sub(xe)._perp()._unit(),Xe=!Xe);continue}let Je=xe.sub(Lt)._perp(),De=Je.x/(Math.abs(Je.x)+Math.abs(Je.y)),Te=Je.y>0?1:0,oi=Lt.dist(xe);if(ce+oi>32768&&(ce=0),et){vt=Oe.sub(xe)._perp()._unit();let gi=Qg(Lt,xe,Oe,kg(ne,vt),et);isNaN(gi)&&(gi=0);let Ui=xe.sub(Lt)._unit();Lt=Lt.add(Ui.mult(_t))._round(),xe=xe.add(Ui.mult(-gi))._round(),_t=gi,ne=vt,k&&this.zoom>=17&&(nt(Qt,Lt)||Qt.push(Lt),nt(Qt,xe)||Qt.push(xe))}let ve=xt.vertexLength,Qi=Rt.length>4&&fg(Lt,xe,Oe),Wi=vg(ce,Bt,Xe);if(pm(this.layoutVertexArray,Lt.x,Lt.y,De,Te,0,0,Wi),pm(this.layoutVertexArray,Lt.x,Lt.y,De,Te,0,1,Wi),ce+=oi,Wi=vg(ce,Qi,!Xe),Bt=Qi,pm(this.layoutVertexArray,xe.x,xe.y,De,Te,0,0,Wi),pm(this.layoutVertexArray,xe.x,xe.y,De,Te,0,1,Wi),xt.vertexLength+=4,this.indexArray.emplaceBack(ve+0,ve+1,ve+2),this.indexArray.emplaceBack(ve+1,ve+3,ve+2),xt.primitiveLength+=2,et){let gi=gt+(Ve===1?Rt.length-2:Ve-2),Ui=Ve===1?gt:gi+1;if(this.indexArray.emplaceBack(ve+1,gi,ve+3),this.indexArray.emplaceBack(gi,Ui,ve+3),xt.primitiveLength+=2,be===void 0&&(be=ve),!vW(Oe,Rt[Ve],ht)){let ui=Ve===Rt.length-1?be:xt.vertexLength;this.indexArray.emplaceBack(ve+2,ve+3,ui),this.indexArray.emplaceBack(ve+3,ui+1,ui),this.indexArray.emplaceBack(ve+3,Ui,ui+1),xt.primitiveLength+=3}Xe=!Xe}if(U){let gi=this.layoutVertexExtArray,Ui=F.projectTilePoint(Lt.x,Lt.y,r),ui=F.projectTilePoint(xe.x,xe.y,r),$i=F.upVector(r,Lt.x,Lt.y),yi=F.upVector(r,xe.x,xe.y);Wm(gi,Ui,$i),Wm(gi,Ui,$i),Wm(gi,ui,yi),Wm(gi,ui,yi)}}X&&(gt+=Rt.length-1),k&&et&&this.zoom>=17&&(Qt.length!==0&&nt(Qt,Qt[0])&&Qt.pop(),this.groundEffect.addData(Qt,ht,u,et>0))}this.footprintSegments.push(Ft),kt.triangleCount=this.indexArray.length-kt.triangleArrayOffset,this.polygonSegments.push(kt),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=y.borders?Jg:this.encodeCentroid(y,B),this.centroidData.push(B),y.borders){this.featuresOnBorder.push(y);let dt=this.featuresOnBorder.length-1;for(let ht=0;ht<y.borders.length;ht++)y.borders[ht][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ht].push(dt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,s,b,r,W),this.groundEffect.addPaintPropertiesData(t,n,s,b,r,W),this.maxHeight=Math.max(this.maxHeight,S)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,n)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[n].borders[t][0])}splitToSubtiles(){let t=[];for(let h=0;h<this.centroidData.length;h++){let W=this.centroidData[h],u=+(W.min.y+W.max.y>ie),V=2*u+(+(W.min.x+W.max.x>ie)^u);for(let F=0;F<W.polygonSegLen;F++){let U=W.polygonSegIdx+F;t.push({centroidIdx:h,subtile:V,polygonSegmentIdx:U,triangleSegmentIdx:this.polygonSegments[U].triangleSegIdx})}}let i=new Qa;t.sort((h,W)=>h.triangleSegmentIdx===W.triangleSegmentIdx?h.subtile-W.subtile:h.triangleSegmentIdx-W.triangleSegmentIdx);let n=0,r=0,s=0;for(let h of t){if(h.triangleSegmentIdx!==n)break;s++}let b=t.length;for(;r!==t.length;){n=t[r].triangleSegmentIdx;let h=0,W=r,u=r;for(let V=W;V<s&&t[V].subtile===h;V++)u++;for(;W!==s;){let V=t[W];h=V.subtile;let F=this.centroidData[V.centroidIdx].min.clone(),U=this.centroidData[V.centroidIdx].max.clone(),X={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let y=W;y<u;y++){let B=t[y],k=this.polygonSegments[B.polygonSegmentIdx],S=this.centroidData[B.centroidIdx].min,A=this.centroidData[B.centroidIdx].max,D=this.indexArray.uint16;for(let O=k.triangleArrayOffset;O<k.triangleArrayOffset+k.triangleCount;O++)i.emplaceBack(D[3*O],D[3*O+1],D[3*O+2]);X.primitiveLength+=k.triangleCount,F.x=Math.min(F.x,S.x),F.y=Math.min(F.y,S.y),U.x=Math.max(U.x,A.x),U.y=Math.max(U.y,A.y)}X.primitiveLength>0&&this.triangleSubSegments.push({segment:X,min:F,max:U}),W=u;for(let y=W;y<s&&t[y].subtile===t[W].subtile;y++)u++}r=s;for(let V=r;V<b&&t[V].triangleSegmentIdx===t[r].triangleSegmentIdx;V++)s++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,n){let r=0,s=0,b=1<<t.canonical.z;if(i){let B=i.getMinMaxForTile(t);B&&(r=B.min,s=B.max)}s+=this.maxHeight;let h=t.toUnwrapped(),W,u=[h.canonical.x/b+h.wrap,h.canonical.y/b],V=[(h.canonical.x+1)/b+h.wrap,(h.canonical.y+1)/b],F=new da,U=(B,k,S)=>[B[0]*(1-S[0])+k[0]*S[0],B[1]*(1-S[1])+k[1]*S[1]],X=[],y=[];for(let B of this.triangleSubSegments){X[0]=B.min.x/ie,X[1]=B.min.y/ie,y[0]=B.max.x/ie,y[1]=B.max.y/ie;let k=U(u,V,X),S=U(u,V,y);if(new ra([k[0],k[1],r],[S[0],S[1],s]).intersectsPrecise(n)===0){W&&(F.segments.push(W),W=void 0);continue}let A=B.segment;W&&W.vertexOffset!==A.vertexOffset&&(F.segments.push(W),W=void 0),W?(W.vertexLength+=A.vertexLength,W.primitiveLength+=A.primitiveLength):W={vertexOffset:A.vertexOffset,primitiveLength:A.primitiveLength,vertexLength:A.vertexLength,primitiveOffset:A.primitiveOffset,sortKey:void 0,vaos:{}}}return W&&F.segments.push(W),F}encodeCentroid(t,i){let n=t.centroid(),r=i.span(),s=Math.min(7,Math.round(r.x*this.tileToMeter/10)),b=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new Nt(ke(n.x,1,ie-1)<<3|s,ke(n.y,1,ie-1)<<3|b)}encodeBorderCentroid(t){if(!t.borders)return new Nt(0,0);let i=t.borders,n=Number.MAX_VALUE;if(i[0][0]!==n||i[1][0]!==n){let r=i[0][0]!==n?0:1;return new Nt(6|(i[0][0]!==n?0:65528),(i[r][0]+i[r][1])/2<<3|6)}{let r=i[2][0]!==n?2:3;return new Nt((i[r][0]+i[r][1])/2<<3|6,6|(i[2][0]!==n?0:65528))}}showCentroid(t){let i=this.centroidData[t.centroidDataIndex];i.flags&=Br,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);let i=t.vertexArrayOffset,n=t.vertexCount+t.vertexArrayOffset,r=t.flags&Br?Jg:t.centroidXY,s=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==r.y||s!==r.x){for(let b=i;b<n;++b)this.centroidVertexArray.emplace(b,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let n=i.getReplacementRegionsForTile(t.toUnwrapped());if(function(s,b){if(s.length!==b.length)return!1;for(let h=0;h<s.length;h++)if(s[h].sourceId!==b[h].sourceId||!Zg(s[h],b[h]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let s of this.centroidData)s.flags&=2147483647;let r=[];for(let s of this.activeReplacements){let b=Math.pow(2,s.footprintTileId.canonical.z-t.canonical.z);for(let h of this.centroidData)if(!(h.flags&Br||s.min.x>h.max.x||h.min.x>s.max.x||s.min.y>h.max.y||h.min.y>s.max.y))for(let W=0;W<h.footprintSegLen;W++){let u=this.footprintSegments[h.footprintSegIdx+W];if(r.length=0,fx(this.footprintVertices,u.vertexOffset,u.vertexCount,s.footprintTileId.canonical,t.canonical,r),Rg(s.footprint,r,this.footprintIndices.uint16,u.indexOffset,u.indexCount,-u.vertexOffset,-b)){h.flags|=Br;break}}}for(let s of this.centroidData)this.writeCentroidToBuffer(s);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,n){let r=!1;for(let s=0;s<n.footprintSegLen;s++){let b=this.footprintSegments[n.footprintSegIdx+s],h=0;for(let W of b.ringIndices){for(let u=h,V=W+h-1;u<W+h;V=u++){let F=this.footprintVertices.int16[2*(u+b.vertexOffset)+0],U=this.footprintVertices.int16[2*(u+b.vertexOffset)+1],X=this.footprintVertices.int16[2*(V+b.vertexOffset)+1];U>i!=X>i&&t<(this.footprintVertices.int16[2*(V+b.vertexOffset)+0]-F)*(i-U)/(X-U)+F&&(r=!r)}h=W}}return r}getHeightAtTileCoord(t,i){let n=Number.NEGATIVE_INFINITY,r=!0,s=4*(t+ie)*ie+(i+ie);if(this.partLookup.hasOwnProperty(s)){let b=this.partLookup[s];return b?{height:b.height,hidden:!!(b.flags&Br)}:void 0}for(let b of this.centroidData)t>b.max.x||b.min.x>t||i>b.max.y||b.min.y>i||this.footprintContainsPoint(t,i,b)&&b&&b.height>n&&(n=b.height,this.partLookup[s]=b,r=!!(b.flags&Br));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:r};this.partLookup[s]=void 0}}function kg(e,t){let i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function Sx(e,t,i,n){let r=t.sub(e)._perp()._unit(),s=i.sub(t)._perp()._unit();return Qg(e,t,i,kg(r,s),n)}function Qg(e,t,i,n,r){let s=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(i)/3,r*s/n)}function vW(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function Sg(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function fg(e,t,i){if(e.x<0||e.x>=ie||t.x<0||t.x>=ie||i.x<0||i.x>=ie)return!1;let n=i.sub(t),r=n.perp(),s=e.sub(t);return(n.x*s.x+n.y*s.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(s.x*s.x+s.y*s.y))>-.866&&r.x*s.x+r.y*s.y<0}function vg(e,t,i){let n=t?2|e:-3&e;return i?1|n:-2&n}function Lg(){let e=Math.PI/32,t=Math.tan(e),i=Gt;return i*Math.sqrt(1+2*t*t)-i}function zg(e,t,i){let n=1<<i.z,r=Qe(i.x/n),s=Qe((i.x+1)/n),b=si(i.y/n),h=si((i.y+1)/n);return function(W,u,V,F,U=0,X){let y=[];if(!W.length||!V||!F)return y;let B=($,nt)=>{for(let dt of $)y.push({polygon:dt,bounds:nt})},k=Math.ceil(Math.log2(V)),S=Math.ceil(Math.log2(F)),A=k-S,D=[];for(let $=0;$<Math.abs(A);$++)D.push(A>0?0:1);for(let $=0;$<Math.min(k,S);$++)D.push(0),D.push(1);let O=W;if(O=Wh(O,u[0].y-U,u[1].y+U,1),O=Wh(O,u[0].x-U,u[1].x+U,0),!O.length)return y;let et=[];for(D.length?et.push({polygons:O,bounds:u,depth:0}):B(O,u);et.length;){let $=et.pop(),nt=$.depth,dt=D[nt],ht=$.bounds[0],gt=$.bounds[1],pt=dt===0?ht.x:ht.y,xt=dt===0?gt.x:gt.y,kt=X?X(dt,pt,xt):.5*(pt+xt),Ft=Wh($.polygons,pt-U,kt+U,dt),Ct=Wh($.polygons,kt-U,xt+U,dt);if(Ft.length){let Rt=[ht,new Nt(dt===0?kt:gt.x,dt===1?kt:gt.y)];D.length>nt+1?et.push({polygons:Ft,bounds:Rt,depth:nt+1}):B(Ft,Rt)}if(Ct.length){let Rt=[new Nt(dt===0?kt:ht.x,dt===1?kt:ht.y),gt];D.length>nt+1?et.push({polygons:Ct,bounds:Rt,depth:nt+1}):B(Ct,Rt)}}return y}(e,t,Math.ceil((s-r)/11.25),Math.ceil((b-h)/11.25),1,(W,u,V)=>{if(W===0)return .5*(u+V);{let F=si((i.y+u/ie)/n);return(Me(.5*(si((i.y+V/ie)/n)+F))*n-i.y)*ie}})}function fx(e,t,i,n,r,s){let b=Math.pow(2,n.z-r.z);for(let h=0;h<i;h++){let W=e.int16[2*(h+t)+0],u=e.int16[2*(h+t)+1];W=(W+r.x*ie)*b-n.x*ie,u=(u+r.y*ie)*b-n.y*ie,s.push(new Nt(W,u))}}se(Vh,"FillExtrusionBucket",{omit:["layers","features"]}),se(Bg,"PartData"),se(yg,"FootprintSegment"),se(Mg,"BorderCentroidData"),se(Tg,"GroundEffect");let vx=new ea({visibility:new jt(ut["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new jt(ut["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Lx={paint:new ea({"fill-extrusion-opacity":new jt(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ue(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ue(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ue(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ue(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new jt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new jt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new jt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new jt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new jt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new jt(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new jt(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ue(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ue(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new jt(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new jt(ut["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new jt(ut["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new jt(ut["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new jt(ut["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:vx};class qd extends Nt{constructor(t,i,n){super(t,i),this.z=n}}function um(e,t){return e.x*t.x+e.y*t.y}function wg(e,t){if(e.length===1){let i=0,n=t[i++],r;for(;!r||n.equals(r);)if(r=t[i++],!r)return 1/0;for(;i<t.length;i++){let s=t[i],b=e[0],h=r.sub(n),W=s.sub(n),u=b.sub(n),V=um(h,h),F=um(h,W),U=um(W,W),X=um(u,h),y=um(u,W),B=V*U-F*F,k=(U*X-F*y)/B,S=(V*y-F*X)/B,A=n.z*(1-k-S)+r.z*k+s.z*S;if(isFinite(A))return A}return 1/0}{let i=1/0;for(let n of t)i=Math.min(i,n.z);return i}}function Eg(e,t,i,n,r,s,b,h){let W=b*r.getElevationAt(e,t,!0,!0),u=s[0]!==0,V=u?s[1]===0?b*(s[0]/7-450):b*function(F,U,X){let y=Math.floor(U[0]/8),B=Math.floor(U[1]/8),k=10*(U[0]-8*y),S=10*(U[1]-8*B),A=F.getElevationAt(y,B,!0,!0),D=F.getMeterToDEM(X),O=Math.floor(.5*(k*D-1)),et=Math.floor(.5*(S*D-1)),$=F.tileCoordToPixel(y,B),nt=2*O+1,dt=2*et+1,ht=function(Ct,Rt,Bt,_t,Qt){return[Ct.getElevationAtPixel(Rt,Bt,!0),Ct.getElevationAtPixel(Rt+Qt,Bt,!0),Ct.getElevationAtPixel(Rt,Bt+Qt,!0),Ct.getElevationAtPixel(Rt+_t,Bt+Qt,!0)]}(F,$.x-O,$.y-et,nt,dt),gt=Math.abs(ht[0]-ht[1]),pt=Math.abs(ht[2]-ht[3]),xt=Math.abs(ht[0]-ht[2])+Math.abs(ht[1]-ht[3]),kt=Math.min(.25,.5*D*(gt+pt)/nt),Ft=Math.min(.25,.5*D*xt/dt);return A+Math.max(kt*k,Ft*S)}(r,s,h):W;return{base:W+(i===0)?-1:i,top:u?Math.max(V+n,W+i+2):W+n}}let zx=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wx}=zx,Ex=Ni([{name:"a_packed",components:4,type:"Float32"}]),{members:Ax}=Ex;class Ag{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Jr({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){let n=this.getKey(t,i);return this.positions[n]}trim(){let t=this.width,i=this.height=Zl(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,n){let r=[],s=t.length%2==1?-t[t.length-1]*n:0,b=t[0]*n,h=!0;r.push({left:s,right:b,isDash:h,zeroLength:t[0]===0});let W=t[0];for(let u=1;u<t.length;u++){h=!h;let V=t[u];s=W*n,W+=V,b=W*n,r.push({left:s,right:b,isDash:h,zeroLength:V===0})}return r}addRoundDash(t,i,n){let r=i/2;for(let s=-n;s<=n;s++){let b=this.width*(this.nextRow+n+s),h=0,W=t[h];for(let u=0;u<this.width;u++){u/W.right>1&&(W=t[++h]);let V=Math.abs(u-W.left),F=Math.abs(u-W.right),U=Math.min(V,F),X,y=s/n*(r+1);if(W.isDash){let B=r-Math.abs(y);X=Math.sqrt(U*U+B*B)}else X=r-Math.sqrt(U*U+y*y);this.image.data[b+u]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t,i){for(let W=t.length-1;W>=0;--W){let u=t[W],V=t[W+1];u.zeroLength?t.splice(W,1):V&&V.isDash===u.isDash&&(V.left=u.left,t.splice(W,1))}let n=t[0],r=t[t.length-1];n.isDash===r.isDash&&(n.left=r.left-this.width,r.right=n.right+this.width);let s=this.width*this.nextRow,b=0,h=t[b];for(let W=0;W<this.width;W++){W/h.right>1&&(h=t[++b]);let u=Math.abs(W-h.left),V=Math.abs(W-h.right),F=Math.min(u,V);this.image.data[s+W]=Math.max(0,Math.min(255,(h.isDash?F:-F)+i+128))}}addDash(t,i){let n=this.getKey(t,i);if(this.positions[n])return this.positions[n];let r=i==="round",s=r?7:0,b=2*s+1;if(this.nextRow+b>this.height)return ji("LineAtlas out of space"),null;t.length===0&&t.push(1);let h=0;for(let V=0;V<t.length;V++)t[V]<0&&(ji("Negative value is found in line dasharray, replacing values with 0"),t[V]=0),h+=t[V];if(h!==0){let V=this.width/h,F=this.getDashRanges(t,this.width,V);r?this.addRoundDash(F,V,s):this.addRegularDash(F,i==="square"?.5*V:0)}let W=this.nextRow+s;this.nextRow+=b;let u={tl:[W,s],br:[h,0]};return this.positions[n]=u,u}}se(Ag,"LineAtlas");let Hx=ph.types,jx=Math.cos(Math.PI/180*37.5);class LW{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Db,this.layoutVertexArray2=new po,this.indexArray=new Qa,this.programConfigurations=new v(t.layers,t.zoom),this.segments=new da,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,n,r){this.hasPattern=kW("line",this.layers,i);let s=this.layers[0].layout.get("line-sort-key"),b=[];for(let{feature:V,id:F,index:U,sourceLayerIndex:X}of t){let y=this.layers[0]._featureFilter.needGeometry,B=xa(V,y);if(!this.layers[0]._featureFilter.filter(new ta(this.zoom),B,n))continue;let k=s?s.evaluate(B,{},n):void 0,S={id:F,properties:V.properties,type:V.type,sourceLayerIndex:X,index:U,geometry:y?B.geometry:fa(V,n,r),patterns:{},sortKey:k};b.push(S)}s&&b.sort((V,F)=>V.sortKey-F.sortKey);let{lineAtlas:h,featureIndex:W}=i,u=this.addConstantDashes(h);for(let V of b){let{geometry:F,index:U,sourceLayerIndex:X}=V;if(u&&this.addFeatureDashes(V,h),this.hasPattern){let y=QW("line",this.layers,V,this.zoom,i);this.patternFeatures.push(y)}else this.addFeature(V,F,U,n,h.positions,i.availableImages,i.brightness);W.insert(t[U].feature,F,U,X,this.index)}}addConstantDashes(t){let i=!1;for(let n of this.layers){let r=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if(r.kind!=="constant"||s.kind!=="constant")i=!0;else{let b=s.value,h=r.value;if(!h)continue;t.addDash(h,b)}}return i}addFeatureDashes(t,i){let n=this.zoom;for(let r of this.layers){let s=r.paint.get("line-dasharray").value,b=r.layout.get("line-cap").value;if(s.kind==="constant"&&b.kind==="constant")continue;let h,W;if(s.kind==="constant"){if(h=s.value,!h)continue}else h=s.evaluate({zoom:n},t);W=b.kind==="constant"?b.value:b.evaluate({zoom:n},t),i.addDash(h,W),t.patterns[r.id]=i.getKey(h,W)}}update(t,i,n,r,s){let b=Object.keys(t).length!==0;b&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,b?this.stateDependentLayers:this.layers,n,r,s)}addFeatures(t,i,n,r,s,b){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,n,r,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ax)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wx),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,n,r,s,b,h){let W=this.layers[0].layout,u=W.get("line-join").evaluate(t,{}),V=W.get("line-cap").evaluate(t,{}),F=W.get("line-miter-limit"),U=W.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let X of i)this.addLine(X,t,u,V,F,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,s,b,r,h)}addLine(t,i,n,r,s,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let h=Hx[i.type]==="Polygon",W=t.length;for(;W>=2&&t[W-1].equals(t[W-2]);)W--;let u=0;for(;u<W-1&&t[u].equals(t[u+1]);)u++;if(W<(h?3:2))return;n==="bevel"&&(s=1.05);let V=this.overscaling<=16?15*ie/(512*this.overscaling):0,F=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray),U,X,y,B,k;this.e1=this.e2=-1,h&&(U=t[W-2],k=t[u].sub(U)._unit()._perp());for(let S=u;S<W;S++){if(y=S===W-1?h?t[u+1]:void 0:t[S+1],y&&t[S].equals(y))continue;k&&(B=k),U&&(X=U),U=t[S],k=y?y.sub(U)._unit()._perp():B,B=B||k;let A=B.add(k);A.x===0&&A.y===0||A._unit();let D=B.x*k.x+B.y*k.y,O=A.x*k.x+A.y*k.y,et=O!==0?1/O:1/0,$=2*Math.sqrt(2-2*O),nt=O<jx&&X&&y,dt=B.x*k.y-B.y*k.x>0;if(nt&&S>u){let pt=U.dist(X);if(pt>2*V){let xt=U.sub(U.sub(X)._mult(V/pt)._round());this.updateDistance(X,xt),this.addCurrentVertex(xt,B,0,0,F),X=xt}}let ht=X&&y,gt=ht?n:h?"butt":r;if(ht&&gt==="round"&&(et<b?gt="miter":et<=2&&(gt="fakeround")),gt==="miter"&&et>s&&(gt="bevel"),gt==="bevel"&&(et>2&&(gt="flipbevel"),et<s&&(gt="miter")),X&&this.updateDistance(X,U),gt==="miter")A._mult(et),this.addCurrentVertex(U,A,0,0,F);else if(gt==="flipbevel"){if(et>100)A=k.mult(-1);else{let pt=et*B.add(k).mag()/B.sub(k).mag();A._perp()._mult(pt*(dt?-1:1))}this.addCurrentVertex(U,A,0,0,F),this.addCurrentVertex(U,A.mult(-1),0,0,F)}else if(gt==="bevel"||gt==="fakeround"){let pt=-Math.sqrt(et*et-1),xt=dt?pt:0,kt=dt?0:pt;if(X&&this.addCurrentVertex(U,B,xt,kt,F),gt==="fakeround"){let Ft=Math.round(180*$/Math.PI/20);for(let Ct=1;Ct<Ft;Ct++){let Rt=Ct/Ft;if(Rt!==.5){let _t=Rt-.5;Rt+=Rt*_t*(Rt-1)*((1.0904+D*(D*(3.55645-1.43519*D)-3.2452))*_t*_t+(.848013+D*(.215638*D-1.06021)))}let Bt=k.sub(B)._mult(Rt)._add(B)._unit()._mult(dt?-1:1);this.addHalfVertex(U,Bt.x,Bt.y,!1,dt,0,F)}}y&&this.addCurrentVertex(U,k,-xt,-kt,F)}else if(gt==="butt")this.addCurrentVertex(U,A,0,0,F);else if(gt==="square"){let pt=X?1:-1;X||this.addCurrentVertex(U,A,pt,pt,F),this.addCurrentVertex(U,A,0,0,F),X&&this.addCurrentVertex(U,A,pt,pt,F)}else gt==="round"&&(X&&(this.addCurrentVertex(U,B,0,0,F),this.addCurrentVertex(U,B,1,1,F,!0)),y&&(this.addCurrentVertex(U,k,-1,-1,F,!0),this.addCurrentVertex(U,k,0,0,F)));if(nt&&S<W-1){let pt=U.dist(y);if(pt>2*V){let xt=U.add(y.sub(U)._mult(V/pt)._round());this.updateDistance(U,xt),this.addCurrentVertex(xt,k,0,0,F),U=xt}}}}addCurrentVertex(t,i,n,r,s,b=!1){let h=i.y*r-i.x,W=-i.y-i.x*r;this.addHalfVertex(t,i.x+i.y*n,i.y-i.x*n,b,!1,n,s),this.addHalfVertex(t,h,W,b,!0,-r,s)}addHalfVertex({x:t,y:i},n,r,s,b,h,W){this.layoutVertexArray.emplaceBack((t<<1)+(s?1:0),(i<<1)+(b?1:0),Math.round(63*n)+128,Math.round(63*r)+128,1+(h===0?0:h<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let u=W.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),W.primitiveLength++),b?this.e2=u:this.e1=u}updateScaledDistance(){if(this.lineClips){let t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}se(LW,"LineBucket",{omit:["layers","patternFeatures"]});let Ox=new ea({"line-cap":new Ue(ut.layout_line["line-cap"]),"line-join":new Ue(ut.layout_line["line-join"]),"line-miter-limit":new jt(ut.layout_line["line-miter-limit"]),"line-round-limit":new jt(ut.layout_line["line-round-limit"]),"line-sort-key":new Ue(ut.layout_line["line-sort-key"]),visibility:new jt(ut.layout_line.visibility)});var Hg={paint:new ea({"line-opacity":new Ue(ut.paint_line["line-opacity"]),"line-color":new Ue(ut.paint_line["line-color"]),"line-translate":new jt(ut.paint_line["line-translate"]),"line-translate-anchor":new jt(ut.paint_line["line-translate-anchor"]),"line-width":new Ue(ut.paint_line["line-width"]),"line-gap-width":new Ue(ut.paint_line["line-gap-width"]),"line-offset":new Ue(ut.paint_line["line-offset"]),"line-blur":new Ue(ut.paint_line["line-blur"]),"line-dasharray":new Ue(ut.paint_line["line-dasharray"]),"line-pattern":new Ue(ut.paint_line["line-pattern"]),"line-gradient":new fo(ut.paint_line["line-gradient"]),"line-trim-offset":new jt(ut.paint_line["line-trim-offset"]),"line-emissive-strength":new jt(ut.paint_line["line-emissive-strength"]),"line-border-width":new Ue(ut.paint_line["line-border-width"]),"line-border-color":new Ue(ut.paint_line["line-border-color"])}),layout:Ox};function jg(e,t,i){return t*(ie/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function Og(e,t){return 1/jg(e,1,t.tileZoom)}function Dg(e,t,i,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let _g=e=>{let t=[];Pg(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");let i=e.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function Pg(e){let t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Kg=new class extends Ue{possiblyEvaluate(e,t){return t=new ta(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=ma({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(Hg.paint.properties["line-width"].specification);function qg(e,t){return t>0?t+2*e:e}Kg.useIntegerZoom=!0;let Dx=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_x=Ni([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Px=Ni([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Kx=Ni([{name:"a_z_offset",components:1,type:"Float32"}],4),qx=Ni([{name:"a_texb",components:2,type:"Uint16"}]),$x=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tN=Ni([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let $g=Ni([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eN=Ni([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ni([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var en=24;let wl=128;function zW(e,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ta(e+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:n,interpolationType:r}=i,s=0;for(;s<n.length&&n[s]<=e;)s++;s=Math.max(0,s-1);let b=s;for(;b<n.length&&n[b]<e+1;)b++;b=Math.min(n.length-1,b);let h=n[s],W=n[b];return i.kind==="composite"?{kind:"composite",minZoom:h,maxZoom:W,interpolationType:r}:{kind:"camera",minZoom:h,maxZoom:W,minSize:i.evaluate(new ta(h)),maxSize:i.evaluate(new ta(W)),interpolationType:r}}}function Rh(e,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:r}){return e.kind==="source"?n/wl:e.kind==="composite"?li(n/wl,r/wl,i):t}function $d(e,t){let i=0,n=0;if(e.kind==="constant")n=e.layoutSize;else if(e.kind!=="source"){let{interpolationType:r,minZoom:s,maxZoom:b}=e,h=r?ke(Cn.interpolationFactor(r,t,s,b),0,1):0;e.kind==="camera"?n=li(e.minSize,e.maxSize,h):i=h}return{uSizeT:i,uSize:n}}var iN=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:wl,evaluateSizeForFeature:Rh,evaluateSizeForZoom:$d,getSizeData:zW});function aN(e,t,i){return e.sections.forEach(n=>{n.text=function(r,s,b){let h=s.layout.get("text-transform").evaluate(b,{});return h==="uppercase"?r=r.toLocaleUpperCase():h==="lowercase"&&(r=r.toLocaleLowerCase()),Tn.applyArabicShaping&&(r=Tn.applyArabicShaping(r)),r}(n.text,t,i)}),e}let Zm={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function nN(e){return e==="\uFE36"||e==="\uFE48"||e==="\uFE38"||e==="\uFE44"||e==="\uFE42"||e==="\uFE3E"||e==="\uFE3C"||e==="\uFE3A"||e==="\uFE18"||e==="\uFE40"||e==="\uFE10"||e==="\uFE13"||e==="\uFE14"||e==="\uFF40"||e==="\uFFE3"||e==="\uFE11"||e==="\uFE12"}function lN(e){return e==="\uFE35"||e==="\uFE47"||e==="\uFE37"||e==="\uFE43"||e==="\uFE41"||e==="\uFE3D"||e==="\uFE3B"||e==="\uFE39"||e==="\uFE17"||e==="\uFE3F"}var oN={read:function(e,t,i,n,r){var s,b,h=8*r-n-1,W=(1<<h)-1,u=W>>1,V=-7,F=i?r-1:0,U=i?-1:1,X=e[t+F];for(F+=U,s=X&(1<<-V)-1,X>>=-V,V+=h;V>0;s=256*s+e[t+F],F+=U,V-=8);for(b=s&(1<<-V)-1,s>>=-V,V+=n;V>0;b=256*b+e[t+F],F+=U,V-=8);if(s===0)s=1-u;else{if(s===W)return b?NaN:1/0*(X?-1:1);b+=Math.pow(2,n),s-=u}return(X?-1:1)*b*Math.pow(2,s-n)},write:function(e,t,i,n,r,s){var b,h,W,u=8*s-r-1,V=(1<<u)-1,F=V>>1,U=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=n?0:s-1,y=n?1:-1,B=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(h=isNaN(t)?1:0,b=V):(b=Math.floor(Math.log(t)/Math.LN2),t*(W=Math.pow(2,-b))<1&&(b--,W*=2),(t+=b+F>=1?U/W:U*Math.pow(2,1-F))*W>=2&&(b++,W/=2),b+F>=V?(h=0,b=V):b+F>=1?(h=(t*W-1)*Math.pow(2,r),b+=F):(h=t*Math.pow(2,F-1)*Math.pow(2,r),b=0));r>=8;e[i+X]=255&h,X+=y,h/=256,r-=8);for(b=b<<r|h,u+=r;u>0;e[i+X]=255&b,X+=y,b/=256,u-=8);e[i+X-y]|=128*B}},tV=qi,Gh=oN;function qi(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}qi.Varint=0,qi.Fixed64=1,qi.Bytes=2,qi.Fixed32=5;var wW=4294967296,eV=1/wW,iV=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jo(e){return e.type===qi.Bytes?e.readVarint()+e.pos:e.pos+1}function tc(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function aV(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r]}function rN(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function sN(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function dN(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function cN(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function bN(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function mN(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function hN(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function pN(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function WN(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Fh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function ec(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function nV(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}qi.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,s=this.pos;this.type=7&n,e(r,t,this),this.pos===s&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Fh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=nV(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Fh(this.buf,this.pos)+Fh(this.buf,this.pos+4)*wW;return this.pos+=8,e},readSFixed64:function(){var e=Fh(this.buf,this.pos)+nV(this.buf,this.pos+4)*wW;return this.pos+=8,e},readFloat:function(){var e=Gh.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Gh.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(r,s,b){var h,W,u=b.buf;if(h=(112&(W=u[b.pos++]))>>4,W<128||(h|=(127&(W=u[b.pos++]))<<3,W<128)||(h|=(127&(W=u[b.pos++]))<<10,W<128)||(h|=(127&(W=u[b.pos++]))<<17,W<128)||(h|=(127&(W=u[b.pos++]))<<24,W<128)||(h|=(1&(W=u[b.pos++]))<<31,W<128))return tc(r,h,s);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&iV?function(i,n,r){return iV.decode(i.subarray(n,r))}(this.buf,t,e):function(i,n,r){for(var s="",b=n;b<r;){var h,W,u,V=i[b],F=null,U=V>239?4:V>223?3:V>191?2:1;if(b+U>r)break;U===1?V<128&&(F=V):U===2?(192&(h=i[b+1]))==128&&(F=(31&V)<<6|63&h)<=127&&(F=null):U===3?(W=i[b+2],(192&(h=i[b+1]))==128&&(192&W)==128&&((F=(15&V)<<12|(63&h)<<6|63&W)<=2047||F>=55296&&F<=57343)&&(F=null)):U===4&&(W=i[b+2],u=i[b+3],(192&(h=i[b+1]))==128&&(192&W)==128&&(192&u)==128&&((F=(15&V)<<18|(63&h)<<12|(63&W)<<6|63&u)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,U=1):F>65535&&(F-=65536,s+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),s+=String.fromCharCode(F),b+=U}return s}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==qi.Bytes)return e.push(this.readVarint(t));var i=jo(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==qi.Bytes)return e.push(this.readSVarint());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==qi.Bytes)return e.push(this.readBoolean());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==qi.Bytes)return e.push(this.readFloat());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==qi.Bytes)return e.push(this.readDouble());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==qi.Bytes)return e.push(this.readFixed32());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==qi.Bytes)return e.push(this.readSFixed32());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==qi.Bytes)return e.push(this.readFixed64());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==qi.Bytes)return e.push(this.readSFixed64());var t=jo(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===qi.Varint)for(;this.buf[this.pos++]>127;);else if(t===qi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===qi.Fixed32)this.pos+=4;else{if(t!==qi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),ec(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),ec(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),ec(this.buf,-1&e,this.pos),ec(this.buf,Math.floor(e*eV),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),ec(this.buf,-1&e,this.pos),ec(this.buf,Math.floor(e*eV),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(s,b,h){h.buf[h.pos++]=127&s|128,s>>>=7,h.buf[h.pos++]=127&s|128,s>>>=7,h.buf[h.pos++]=127&s|128,s>>>=7,h.buf[h.pos++]=127&s|128,h.buf[h.pos]=127&(s>>>=7)}(n,0,i),function(s,b){var h=(7&s)<<4;b.buf[b.pos++]|=h|((s>>>=3)?128:0),s&&(b.buf[b.pos++]=127&s|((s>>>=7)?128:0),s&&(b.buf[b.pos++]=127&s|((s>>>=7)?128:0),s&&(b.buf[b.pos++]=127&s|((s>>>=7)?128:0),s&&(b.buf[b.pos++]=127&s|((s>>>=7)?128:0),s&&(b.buf[b.pos++]=127&s)))))}(r,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(n,r,s){for(var b,h,W=0;W<r.length;W++){if((b=r.charCodeAt(W))>55295&&b<57344){if(!h){b>56319||W+1===r.length?(n[s++]=239,n[s++]=191,n[s++]=189):h=b;continue}if(b<56320){n[s++]=239,n[s++]=191,n[s++]=189,h=b;continue}b=h-55296<<10|b-56320|65536,h=null}else h&&(n[s++]=239,n[s++]=191,n[s++]=189,h=null);b<128?n[s++]=b:(b<2048?n[s++]=b>>6|192:(b<65536?n[s++]=b>>12|224:(n[s++]=b>>18|240,n[s++]=b>>12&63|128),n[s++]=b>>6&63|128),n[s++]=63&b|128)}return s}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&aV(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Gh.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Gh.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&aV(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,qi.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,rN,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,sN,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,bN,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,dN,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,cN,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,mN,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,hN,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,pN,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,WN,t)},writeBytesField:function(e,t){this.writeTag(e,qi.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,qi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,qi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,qi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,qi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,qi.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,qi.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,qi.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,qi.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,qi.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var ic=Ee(tV);let EW=3;function uN(e,t,i){t.glyphs=[],e===1&&i.readMessage(ZN,t)}function ZN(e,t,i){if(e===3){let{id:n,bitmap:r,width:s,height:b,left:h,top:W,advance:u}=i.readMessage(gN,{});t.glyphs.push({id:n,bitmap:new Jr({width:s+2*EW,height:b+2*EW},r),metrics:{width:s,height:b,left:h,top:W,advance:u}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function gN(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}let lV=EW,ml={horizontal:1,vertical:2,horizontalOnly:3};class gm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){let n=new gm;return n.scale=t||1,n.fontStack=i,n}static forImage(t){let i=new gm;return i.imageName=t,i}}class ac{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){let n=new ac;for(let r=0;r<t.sections.length;r++){let s=t.sections[r];s.image?n.addImageSection(s):n.addTextSection(s,i)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,n){let r="";for(let s=0;s<i.length;s++){let b=i.charCodeAt(s+1)||null,h=i.charCodeAt(s-1)||null;r+=!n&&(b&&J0(b)&&!Zm[i[s+1]]||h&&J0(h)&&!Zm[i[s-1]])||!Zm[i[s]]?i[s]:Zm[i[s]]}return r}(this.text,t)}trim(){let t=0;for(let n=0;n<this.text.length&&Ih[this.text.charCodeAt(n)];n++)t++;let i=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&Ih[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){let n=new ac;return n.text=this.text.substring(t,i),n.sectionIndex=this.sectionIndex.slice(t,i),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(gm.forText(t.scale,t.fontStack||i));let n=this.sections.length-1;for(let r=0;r<t.text.length;++r)this.sectionIndex.push(n)}addImageSection(t){let i=t.image?t.image.namePrimary:"";if(i.length===0)return void ji("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(gm.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function AW(e,t,i,n,r,s,b,h,W,u,V,F,U,X,y){let B=ac.fromFeature(e,r);F===ml.vertical&&B.verticalizePunctuation(U);let k=[],S=function($,nt,dt,ht,gt,pt){if(!$)return[];let xt=[],kt=function(Bt,_t,Qt,be,ne,vt){let Xe=0;for(let Ve=0;Ve<Bt.length();Ve++){let ce=Bt.getSection(Ve);Xe+=oV(Bt.getCodePoint(Ve),ce,be,ne,_t,vt)}return Xe/Math.max(1,Math.ceil(Xe/Qt))}($,nt,dt,ht,gt,pt),Ft=$.text.indexOf("\u200B")>=0,Ct=0;for(let Bt=0;Bt<$.length();Bt++){let _t=$.getSection(Bt),Qt=$.getCodePoint(Bt);if(Ih[Qt]||(Ct+=oV(Qt,_t,ht,gt,nt,pt)),Bt<$.length()-1){let be=!((Rt=Qt)<11904||!(pe["Bopomofo Extended"](Rt)||pe.Bopomofo(Rt)||pe["CJK Compatibility Forms"](Rt)||pe["CJK Compatibility Ideographs"](Rt)||pe["CJK Compatibility"](Rt)||pe["CJK Radicals Supplement"](Rt)||pe["CJK Strokes"](Rt)||pe["CJK Symbols and Punctuation"](Rt)||pe["CJK Unified Ideographs Extension A"](Rt)||pe["CJK Unified Ideographs"](Rt)||pe["Enclosed CJK Letters and Months"](Rt)||pe["Halfwidth and Fullwidth Forms"](Rt)||pe.Hiragana(Rt)||pe["Ideographic Description Characters"](Rt)||pe["Kangxi Radicals"](Rt)||pe["Katakana Phonetic Extensions"](Rt)||pe.Katakana(Rt)||pe["Vertical Forms"](Rt)||pe["Yi Radicals"](Rt)||pe["Yi Syllables"](Rt)));(VN[Qt]||be||_t.imageName)&&xt.push(sV(Bt+1,Ct,kt,xt,RN(Qt,$.getCodePoint(Bt+1),be&&Ft),!1))}}var Rt;return dV(sV($.length(),Ct,kt,xt,0,!0))}(B,u,s,t,n,X),{processBidirectionalText:A,processStyledBidirectionalText:D}=Tn;if(A&&B.sections.length===1){let $=A(B.toString(),S);for(let nt of $){let dt=new ac;dt.text=nt,dt.sections=B.sections;for(let ht=0;ht<nt.length;ht++)dt.sectionIndex.push(0);k.push(dt)}}else if(D){let $=D(B.text,B.sectionIndex,S);for(let nt of $){let dt=new ac;dt.text=nt[0],dt.sectionIndex=nt[1],dt.sections=B.sections,k.push(dt)}}else k=function($,nt){let dt=[],ht=$.text,gt=0;for(let pt of nt)dt.push($.substring(gt,pt)),gt=pt;return gt<ht.length&&dt.push($.substring(gt,ht.length)),dt}(B,S);let O=[],et={positionedLines:O,text:B.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function($,nt,dt,ht,gt,pt,xt,kt,Ft,Ct,Rt,Bt){let _t=0,Qt=0,be=0,ne=kt==="right"?1:kt==="left"?0:.5,vt=!1;for(let Oe of gt){let Je=Oe.getSections();for(let De of Je){if(De.imageName)continue;let Te=nt[De.fontStack];if(Te&&(vt=Te.ascender!==void 0&&Te.descender!==void 0,!vt))break}if(!vt)break}let Xe=0;for(let Oe of gt){Oe.trim();let Je=Oe.getMaxScale(),De=(Je-1)*en,Te={positionedGlyphs:[],lineOffset:0};$.positionedLines[Xe]=Te;let oi=Te.positionedGlyphs,ve=0;if(!Oe.length()){Qt+=pt,++Xe;continue}let Qi=0,Wi=0;for(let Ui=0;Ui<Oe.length();Ui++){let ui=Oe.getSection(Ui),$i=Oe.getSectionIndex(Ui),yi=Oe.getCodePoint(Ui),ca=ui.scale,Ja=null,qa=null,_i=null,na=en,wa=0,Ea=!(Ft===ml.horizontal||!Rt&&!Mb(yi)||Rt&&(Ih[yi]||(Ve=yi,pe.Arabic(Ve)||pe["Arabic Supplement"](Ve)||pe["Arabic Extended-A"](Ve)||pe["Arabic Presentation Forms-A"](Ve)||pe["Arabic Presentation Forms-B"](Ve))));if(ui.imageName){let Aa=ht[ui.imageName];if(!Aa)continue;_i=ui.imageName,$.iconsInText=$.iconsInText||!0,qa=Aa.paddedRect;let Ai=Aa.displaySize;ca=ca*en/Bt,Ja={width:Ai[0],height:Ai[1],left:0,top:-lV,advance:Ea?Ai[1]:Ai[0],localGlyph:!1},wa=vt?-Ja.height*ca:Je*en-17-Ai[1]*ca,na=Ja.advance;let Dn=(Ea?Ai[0]:Ai[1])*ca-en*Je;Dn>0&&Dn>ve&&(ve=Dn)}else{let Aa=dt[ui.fontStack];if(!Aa)continue;Aa[yi]&&(qa=Aa[yi]);let Ai=nt[ui.fontStack];if(!Ai)continue;let Dn=Ai.glyphs[yi];if(!Dn)continue;if(Ja=Dn.metrics,na=yi!==8203?en:0,vt){let fr=Ai.ascender!==void 0?Math.abs(Ai.ascender):0,Jn=Ai.descender!==void 0?Math.abs(Ai.descender):0,Zn=(fr+Jn)*ca;Qi<Zn&&(Qi=Zn,Wi=(fr-Jn)/2*ca),wa=-fr*ca}else wa=(Je-ca)*en-17}Ea?($.verticalizable=!0,oi.push({glyph:yi,imageName:_i,x:_t,y:Qt+wa,vertical:Ea,scale:ca,localGlyph:Ja.localGlyph,fontStack:ui.fontStack,sectionIndex:$i,metrics:Ja,rect:qa}),_t+=na*ca+Ct):(oi.push({glyph:yi,imageName:_i,x:_t,y:Qt+wa,vertical:Ea,scale:ca,localGlyph:Ja.localGlyph,fontStack:ui.fontStack,sectionIndex:$i,metrics:Ja,rect:qa}),_t+=Ja.advance*ca+Ct)}oi.length!==0&&(be=Math.max(_t-Ct,be),vt?cV(oi,ne,ve,Wi,pt*Je/2):cV(oi,ne,ve,0,pt/2)),_t=0;let gi=pt*Je+ve;Te.lineOffset=Math.max(ve,De),Qt+=gi,++Xe}var Ve;let ce=Qt,{horizontalAlign:Lt,verticalAlign:xe}=HW(xt);(function(Oe,Je,De,Te,oi,ve){let Qi=(Je-De)*oi,Wi=-ve*Te;for(let gi of Oe)for(let Ui of gi.positionedGlyphs)Ui.x+=Qi,Ui.y+=Wi})($.positionedLines,ne,Lt,xe,be,ce),$.top+=-xe*ce,$.bottom=$.top+ce,$.left+=-Lt*be,$.right=$.left+be,$.hasBaseline=vt}(et,t,i,n,k,b,h,W,F,u,U,y),!function($){for(let nt of $)if(nt.positionedGlyphs.length!==0)return!1;return!0}(O)&&et}let Ih={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},VN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oV(e,t,i,n,r,s){if(t.imageName){let b=n[t.imageName];return b?b.displaySize[0]*t.scale*en/s+r:0}{let b=i[t.fontStack],h=b&&b.glyphs[e];return h?h.metrics.advance*t.scale+r:0}}function rV(e,t,i,n){let r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function RN(e,t,i){let n=0;return e===10&&(n-=1e4),i&&(n+=150),e!==40&&e!==65288||(n+=50),t!==41&&t!==65289||(n+=50),n}function sV(e,t,i,n,r,s){let b=null,h=rV(t,i,r,s);for(let W of n){let u=rV(t-W.x,i,r,s)+W.badness;u<=h&&(b=W,h=u)}return{index:e,x:t,priorBreak:b,badness:h}}function dV(e){return e?dV(e.priorBreak).concat(e.index):[]}function HW(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function cV(e,t,i,n,r){if(!(t||i||n||r))return;let s=e.length-1,b=e[s],h=(b.x+b.metrics.advance*b.scale)*t;for(let W=0;W<=s;W++)e[W].x-=h,e[W].y+=i+n+r}function GN(e,t,i,n){let{horizontalAlign:r,verticalAlign:s}=HW(n),b=i[0]-e.displaySize[0]*r,h=i[1]-e.displaySize[1]*s;return{imagePrimary:e,imageSecondary:t,top:h,bottom:h+e.displaySize[1],left:b,right:b+e.displaySize[0]}}function bV(e,t,i,n,r,s){let b=e.imagePrimary,h;if(b.content){let k=b.content,S=b.pixelRatio||1;h=[k[0]/S,k[1]/S,b.displaySize[0]-k[2]/S,b.displaySize[1]-k[3]/S]}let W=t.left*s,u=t.right*s,V,F,U,X;i==="width"||i==="both"?(X=r[0]+W-n[3],F=r[0]+u+n[1]):(X=r[0]+(W+u-b.displaySize[0])/2,F=X+b.displaySize[0]);let y=t.top*s,B=t.bottom*s;return i==="height"||i==="both"?(V=r[1]+y-n[0],U=r[1]+B+n[2]):(V=r[1]+(y+B-b.displaySize[1])/2,U=V+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:V,right:F,bottom:U,left:X,collisionPadding:h}}class Oo extends Nt{constructor(t,i,n,r,s){super(t,i),this.angle=r,this.z=n,s!==void 0&&(this.segment=s)}clone(){return new Oo(this.x,this.y,this.z,this.angle,this.segment)}}function mV(e,t,i,n,r){if(t.segment===void 0)return!0;let s=t,b=t.segment+1,h=0;for(;h>-i/2;){if(b--,b<0)return!1;h-=e[b].dist(s),s=e[b]}h+=e[b].dist(e[b+1]),b++;let W=[],u=0;for(;h<i/2;){let V=e[b],F=e[b+1];if(!F)return!1;let U=e[b-1].angleTo(V)-V.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),W.push({distance:h,angleDelta:U}),u+=U;h-W[0].distance>n;)u-=W.shift().angleDelta;if(u>r)return!1;b++,h+=V.dist(F)}return!0}function hV(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function pV(e,t,i){return e?.6*t*i:0}function WV(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function FN(e,t,i,n,r,s){let b=pV(i,r,s),h=WV(i,n)*s,W=0,u=hV(e)/2;for(let V=0;V<e.length-1;V++){let F=e[V],U=e[V+1],X=F.dist(U);if(W+X>u){let y=(u-W)/X,B=li(F.x,U.x,y),k=li(F.y,U.y,y),S=new Oo(B,k,0,U.angleTo(F),V);return!b||mV(e,S,h,b,t)?S:void 0}W+=X}}function IN(e,t,i,n,r,s,b,h,W){let u=pV(n,s,b),V=WV(n,r),F=V*b,U=e[0].x===0||e[0].x===W||e[0].y===0||e[0].y===W;return t-F<t/4&&(t=F+t/4),uV(e,U?t/2*h%t:(V/2+2*s)*b*h%t,t,u,i,F,U,!1,W)}function uV(e,t,i,n,r,s,b,h,W){let u=s/2,V=hV(e),F=0,U=t-i,X=[];for(let y=0;y<e.length-1;y++){let B=e[y],k=e[y+1],S=B.dist(k),A=k.angleTo(B);for(;U+i<F+S;){U+=i;let D=(U-F)/S,O=li(B.x,k.x,D),et=li(B.y,k.y,D);if(O>=0&&O<W&&et>=0&&et<W&&U-u>=0&&U+u<=V){let $=new Oo(O,et,0,A,y);n&&!mV(e,$,s,n,r)||X.push($)}}F+=S}return h||X.length||b||(X=uV(e,F/2,i,n,r,s,b,!0,W)),X}function ZV(e,t,i,n,r){let s=[];for(let b=0;b<e.length;b++){let h=e[b],W;for(let u=0;u<h.length-1;u++){let V=h[u],F=h[u+1];V.x<t&&F.x<t||(V.x<t?V=new Nt(t,V.y+(t-V.x)/(F.x-V.x)*(F.y-V.y))._round():F.x<t&&(F=new Nt(t,V.y+(t-V.x)/(F.x-V.x)*(F.y-V.y))._round()),V.y<i&&F.y<i||(V.y<i?V=new Nt(V.x+(i-V.y)/(F.y-V.y)*(F.x-V.x),i)._round():F.y<i&&(F=new Nt(V.x+(i-V.y)/(F.y-V.y)*(F.x-V.x),i)._round()),V.x>=n&&F.x>=n||(V.x>=n?V=new Nt(n,V.y+(n-V.x)/(F.x-V.x)*(F.y-V.y))._round():F.x>=n&&(F=new Nt(n,V.y+(n-V.x)/(F.x-V.x)*(F.y-V.y))._round()),V.y>=r&&F.y>=r||(V.y>=r?V=new Nt(V.x+(r-V.y)/(F.y-V.y)*(F.x-V.x),r)._round():F.y>=r&&(F=new Nt(V.x+(r-V.y)/(F.y-V.y)*(F.x-V.x),r)._round()),W&&V.equals(W[W.length-1])||(W=[V],s.push(W)),W.push(F)))))}}return s}function gV(e){let t=0,i=0;for(let b of e)t+=b.w*b.h,i=Math.max(i,b.w);e.sort((b,h)=>h.h-b.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],r=0,s=0;for(let b of e)for(let h=n.length-1;h>=0;h--){let W=n[h];if(!(b.w>W.w||b.h>W.h)){if(b.x=W.x,b.y=W.y,s=Math.max(s,b.y+b.h),r=Math.max(r,b.x+b.w),b.w===W.w&&b.h===W.h){let u=n.pop();h<n.length&&(n[h]=u)}else b.h===W.h?(W.x+=b.w,W.w-=b.w):b.w===W.w?(W.y+=b.h,W.h-=b.h):(n.push({x:W.x+b.w,y:W.y,w:W.w-b.w,h:b.h}),W.y+=b.h,W.h-=b.h);break}}return{w:r,h:s,fill:t/(r*s)||0}}se(Oo,"Anchor");let On=1;class jW{constructor(t,{pixelRatio:i,version:n,stretchX:r,stretchY:s,content:b}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=r,this.stretchY=s,this.content=b,this.version=n}get tl(){return[this.paddedRect.x+On,this.paddedRect.y+On]}get br(){return[this.paddedRect.x+this.paddedRect.w-On,this.paddedRect.y+this.paddedRect.h-On]}get displaySize(){return[(this.paddedRect.w-2*On)/this.pixelRatio,(this.paddedRect.h-2*On)/this.pixelRatio]}}class VV{constructor(t,i){let n={},r={};this.haveRenderCallbacks=[];let s=[];this.addImages(t,n,s),this.addImages(i,r,s);let{w:b,h}=gV(s),W=new bl({width:b||1,height:h||1});for(let u in t){let V=t[u],F=n[u].paddedRect;bl.copy(V.data,W,{x:0,y:0},{x:F.x+On,y:F.y+On},V.data,V.sdf)}for(let u in i){let V=i[u],F=r[u].paddedRect,U=F.x+On,X=F.y+On,y=V.data.width,B=V.data.height;bl.copy(V.data,W,{x:0,y:0},{x:U,y:X},V.data),bl.copy(V.data,W,{x:0,y:B-1},{x:U,y:X-1},{width:y,height:1}),bl.copy(V.data,W,{x:0,y:0},{x:U,y:X+B},{width:y,height:1}),bl.copy(V.data,W,{x:y-1,y:0},{x:U-1,y:X},{width:1,height:B}),bl.copy(V.data,W,{x:0,y:0},{x:U+y,y:X},{width:1,height:B})}this.image=W,this.iconPositions=n,this.patternPositions=r}addImages(t,i,n){for(let r in t){let s=t[r],b={x:0,y:0,w:s.data.width+2*On,h:s.data.height+2*On};n.push(b),i[r]=new jW(b,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,i,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>t.hasImage(r,n)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(let r in t.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[r],t.getImage(r,n),i),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r,n),i)}patchUpdatedImage(t,i,n){if(!t||!i||t.version===i.version)return;t.version=i.version;let[r,s]=t.tl,b=!!Object.keys(this.patternPositions).length;n.update(i.data,{useMipmap:b},{x:r,y:s})}}se(jW,"ImagePosition"),se(VV,"ImageAtlas");let Vm=1e20;function RV(e,t,i,n,r,s,b,h,W){for(let u=t;u<t+n;u++)GV(e,i*s+u,s,r,b,h,W);for(let u=i;u<i+r;u++)GV(e,u*s+t,1,n,b,h,W)}function GV(e,t,i,n,r,s,b){s[0]=0,b[0]=-Vm,b[1]=Vm,r[0]=e[t];for(let h=1,W=0,u=0;h<n;h++){r[h]=e[t+h*i];let V=h*h;do{let F=s[W];u=(r[h]-r[F]+V-F*F)/(h-F)/2}while(u<=b[W]&&--W>-1);W++,s[W]=h,b[W]=u,b[W+1]=Vm}for(let h=0,W=0;h<n;h++){for(;b[W+1]<h;)W++;let u=s[W],V=h-u;e[t+h*i]=r[u]+V*V}}let El=2,OW={none:0,ideographs:1,all:2};class nc{constructor(t,i,n){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,n){let r=[],s=this.urls[i]||lt.GLYPHS_URL;for(let b in t)for(let h of t[b])r.push({stack:b,id:h});ln(r,({stack:b,id:h},W)=>{let u=this.entries[b];u||(u=this.entries[b]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let V=u.glyphs[h];if(V!==void 0)return void W(null,{stack:b,id:h,glyph:V});if(V=this._tinySDF(u,b,h),V)return u.glyphs[h]=V,void W(null,{stack:b,id:h,glyph:V});let F=Math.floor(h/256);if(256*F>65535)return void W(new Error("glyphs > 65535 not supported"));if(u.ranges[F])return void W(null,{stack:b,id:h,glyph:V});let U=u.requests[F];U||(U=u.requests[F]=[],nc.loadGlyphRange(b,F,s,this.requestManager,(X,y)=>{if(y){u.ascender=y.ascender,u.descender=y.descender;for(let B in y.glyphs)this._doesCharSupportLocalGlyph(+B)||(u.glyphs[+B]=y.glyphs[+B]);u.ranges[F]=!0}for(let B of U)B(X,y);delete u.requests[F]})),U.push((X,y)=>{X?W(X):y&&W(null,{stack:b,id:h,glyph:y.glyphs[h]||null})})},(b,h)=>{if(b)n(b);else if(h){let W={};for(let{stack:u,id:V,glyph:F}of h)W[u]===void 0&&(W[u]={}),W[u].glyphs===void 0&&(W[u].glyphs={}),W[u].glyphs[V]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},W[u].ascender=this.entries[u].ascender,W[u].descender=this.entries[u].descender;n(null,W)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==OW.none&&(this.localGlyphMode===OW.all?!!this.localFontFamily:!!this.localFontFamily&&(pe["CJK Unified Ideographs"](t)||pe["Hangul Syllables"](t)||pe.Hiragana(t)||pe.Katakana(t)||pe["CJK Symbols and Punctuation"](t)||pe["CJK Unified Ideographs Extension A"](t)||pe["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,i,n){let r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(n))return;let s=t.tinySDF;if(!s){let B="400";/bold/i.test(i)?B="900":/medium/i.test(i)?B="500":/light/i.test(i)&&(B="200"),s=t.tinySDF=new nc.TinySDF({fontFamily:r,fontWeight:B,fontSize:24*El,buffer:3*El,radius:8*El}),s.fontWeight=B}if(this.localGlyphs[s.fontWeight][n])return this.localGlyphs[s.fontWeight][n];let b=String.fromCodePoint(n),{data:h,width:W,height:u,glyphWidth:V,glyphHeight:F,glyphLeft:U,glyphTop:X,glyphAdvance:y}=s.draw(b);return this.localGlyphs[s.fontWeight][n]={id:n,bitmap:new Jr({width:W,height:u},h),metrics:{width:V/El,height:F/El,left:U/El,top:X/El-27,advance:y/El,localGlyph:!0}}}}nc.loadGlyphRange=function(e,t,i,n,r){let s=256*t,b=s+255,h=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}","".concat(s,"-").concat(b)),Gn.Glyphs);yt(h,(W,u)=>{if(W)r(W);else if(u){let V={},F=function(U){return new ic(U).readFields(uN,{})}(u);for(let U of F.glyphs)V[U.id]=U;r(null,{glyphs:V,ascender:F.ascender,descender:F.descender})}})},nc.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;let h=this.size=e+4*t,W=this._createCanvas(h),u=this.ctx=W.getContext("2d",{willReadFrequently:!0});u.font="".concat(b," ").concat(s," ").concat(e,"px ").concat(r),u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:s}=this.ctx.measureText(e),b=Math.ceil(i),h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-r))),W=Math.min(this.size-this.buffer,b+Math.ceil(n)),u=h+2*this.buffer,V=W+2*this.buffer,F=Math.max(u*V,0),U=new Uint8ClampedArray(F),X={data:U,width:u,height:V,glyphWidth:h,glyphHeight:W,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(h===0||W===0)return X;let{ctx:y,buffer:B,gridInner:k,gridOuter:S}=this;y.clearRect(B,B,h,W),y.fillText(e,B,B+b);let A=y.getImageData(B,B,h,W);S.fill(Vm,0,F),k.fill(0,0,F);for(let D=0;D<W;D++)for(let O=0;O<h;O++){let et=A.data[4*(D*h+O)+3]/255;if(et===0)continue;let $=(D+B)*u+O+B;if(et===1)S[$]=0,k[$]=Vm;else{let nt=.5-et;S[$]=nt>0?nt*nt:0,k[$]=nt<0?nt*nt:0}}RV(S,0,0,u,V,u,this.f,this.v,this.z),RV(k,B,B,h,W,u,this.f,this.v,this.z);for(let D=0;D<F;D++){let O=Math.sqrt(S[D])-Math.sqrt(k[D]);U[D]=Math.round(255-255*(O/this.radius+this.cutoff))}return X}};let Mr=On;function FV(e,t,i,n){let r=[],s=e.imagePrimary,b=s.pixelRatio,h=s.paddedRect.w-2*Mr,W=s.paddedRect.h-2*Mr,u=e.right-e.left,V=e.bottom-e.top,F=s.stretchX||[[0,h]],U=s.stretchY||[[0,W]],X=(pt,xt)=>pt+xt[1]-xt[0],y=F.reduce(X,0),B=U.reduce(X,0),k=h-y,S=W-B,A=0,D=y,O=0,et=B,$=0,nt=k,dt=0,ht=S;if(s.content&&n){let pt=s.content;A=Uh(F,0,pt[0]),O=Uh(U,0,pt[1]),D=Uh(F,pt[0],pt[2]),et=Uh(U,pt[1],pt[3]),$=pt[0]-A,dt=pt[1]-O,nt=pt[2]-pt[0]-D,ht=pt[3]-pt[1]-et}let gt=(pt,xt,kt,Ft)=>{let Ct=xh(pt.stretch-A,D,u,e.left),Rt=Nh(pt.fixed-$,nt,pt.stretch,y),Bt=xh(xt.stretch-O,et,V,e.top),_t=Nh(xt.fixed-dt,ht,xt.stretch,B),Qt=xh(kt.stretch-A,D,u,e.left),be=Nh(kt.fixed-$,nt,kt.stretch,y),ne=xh(Ft.stretch-O,et,V,e.top),vt=Nh(Ft.fixed-dt,ht,Ft.stretch,B),Xe=new Nt(Ct,Bt),Ve=new Nt(Qt,Bt),ce=new Nt(Qt,ne),Lt=new Nt(Ct,ne),xe=new Nt(Rt/b,_t/b),Oe=new Nt(be/b,vt/b),Je=t*Math.PI/180;if(Je){let Wi=Math.sin(Je),gi=Math.cos(Je),Ui=[gi,-Wi,Wi,gi];Xe._matMult(Ui),Ve._matMult(Ui),Lt._matMult(Ui),ce._matMult(Ui)}let De=pt.stretch+pt.fixed,Te=kt.stretch+kt.fixed,oi=xt.stretch+xt.fixed,ve=Ft.stretch+Ft.fixed,Qi=e.imageSecondary;return{tl:Xe,tr:Ve,bl:Lt,br:ce,texPrimary:{x:s.paddedRect.x+Mr+De,y:s.paddedRect.y+Mr+oi,w:Te-De,h:ve-oi},texSecondary:Qi?{x:Qi.paddedRect.x+Mr+De,y:Qi.paddedRect.y+Mr+oi,w:Te-De,h:ve-oi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xe,pixelOffsetBR:Oe,minFontScaleX:nt/b/u,minFontScaleY:ht/b/V,isSDF:i}};if(n&&(s.stretchX||s.stretchY)){let pt=IV(F,k,y),xt=IV(U,S,B);for(let kt=0;kt<pt.length-1;kt++){let Ft=pt[kt],Ct=pt[kt+1];for(let Rt=0;Rt<xt.length-1;Rt++)r.push(gt(Ft,xt[Rt],Ct,xt[Rt+1]))}}else r.push(gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:h+1},{fixed:0,stretch:W+1}));return r}function Uh(e,t,i){let n=0;for(let r of e)n+=Math.max(t,Math.min(i,r[1]))-Math.max(t,Math.min(i,r[0]));return n}function IV(e,t,i){let n=[{fixed:-Mr,stretch:0}];for(let[r,s]of e){let b=n[n.length-1];n.push({fixed:r-b.stretch,stretch:b.stretch}),n.push({fixed:r-b.stretch,stretch:b.stretch+(s-r)})}return n.push({fixed:t+Mr,stretch:i}),n}function xh(e,t,i,n){return e/t*i+n}function Nh(e,t,i,n){return e-t*i/n}function UN(e,t,i,n){let r=t+e.positionedLines[n].lineOffset;return n===0?i+r/2:i+(r+(t+e.positionedLines[n-1].lineOffset))/2}function xN(e,t=1,i=!1){let n=1/0,r=1/0,s=-1/0,b=-1/0,h=e[0];for(let X=0;X<h.length;X++){let y=h[X];(!X||y.x<n)&&(n=y.x),(!X||y.y<r)&&(r=y.y),(!X||y.x>s)&&(s=y.x),(!X||y.y>b)&&(b=y.y)}let W=Math.min(s-n,b-r),u=W/2,V=new jn([],NN);if(W===0)return new Nt(n,r);for(let X=n;X<s;X+=W)for(let y=r;y<b;y+=W)V.push(new lc(X+u,y+u,u,e));let F=function(X){let y=0,B=0,k=0,S=X[0];for(let A=0,D=S.length,O=D-1;A<D;O=A++){let et=S[A],$=S[O],nt=et.x*$.y-$.x*et.y;B+=(et.x+$.x)*nt,k+=(et.y+$.y)*nt,y+=3*nt}return new lc(B/y,k/y,0,X)}(e),U=V.length;for(;V.length;){let X=V.pop();(X.d>F.d||!F.d)&&(F=X,i&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,U)),X.max-F.d<=t||(u=X.h/2,V.push(new lc(X.p.x-u,X.p.y-u,u,e)),V.push(new lc(X.p.x+u,X.p.y-u,u,e)),V.push(new lc(X.p.x-u,X.p.y+u,u,e)),V.push(new lc(X.p.x+u,X.p.y+u,u,e)),U+=4)}return i&&(console.log("num probes: ".concat(U)),console.log("best distance: ".concat(F.d))),F.p}function NN(e,t){return t.max-e.max}class lc{constructor(t,i,n,r){this.p=new Nt(t,i),this.h=n,this.d=function(s,b){let h=!1,W=1/0;for(let u=0;u<b.length;u++){let V=b[u];for(let F=0,U=V.length,X=U-1;F<U;X=F++){let y=V[F],B=V[X];y.y>s.y!=B.y>s.y&&s.x<(B.x-y.x)*(s.y-y.y)/(B.y-y.y)+y.x&&(h=!h),W=Math.min(W,Nr(s,y,B))}}return(h?1:-1)*Math.sqrt(W)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}let DW=Number.POSITIVE_INFINITY,YN=Math.sqrt(2);function UV(e,[t,i]){let n=0,r=0;if(i===DW){t<0&&(t=0);let s=t/YN;switch(e){case"top-right":case"top-left":r=s-7;break;case"bottom-right":case"bottom-left":r=7-s;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-s;break;case"top-left":case"bottom-left":n=s;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,r]}function _W(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function XN(e,t,i,n,r,s,b,h,W,u,V,F,U,X,y){let B=s.textMaxSize.evaluate(t,{},F);B===void 0&&(B=b);let k=e.layers[0].layout,S=k.get("icon-offset").evaluate(t,{},F),A=NV(i.horizontal)||i.vertical,D=U.name==="globe",O=en,et=b/O,$=e.tilePixelRatio*B/O,nt=(Ct=e.overscaling,e.zoom>18&&Ct>2&&(Ct>>=1),Math.max(ie/(512*Ct),1)*k.get("symbol-spacing")),dt=k.get("text-padding")*e.tilePixelRatio,ht=k.get("icon-padding")*e.tilePixelRatio,gt=ye(k.get("text-max-angle")),pt=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",xt=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",kt=k.get("symbol-placement"),Ft=nt/2;var Ct;let Rt=k.get("icon-text-fit").evaluate(t,{},F),Bt=k.get("icon-text-fit-padding").evaluate(t,{},F),_t=Rt!=="none",Qt;e.hasAnyIconTextFit===!1&&_t&&(e.hasAnyIconTextFit=!0),n&&_t&&(e.allowVerticalPlacement&&i.vertical&&(Qt=bV(n,i.vertical,Rt,Bt,S,et)),A&&(n=bV(n,A,Rt,Bt,S,et)));let be=(ne,vt,Xe)=>{if(vt.x<0||vt.x>=ie||vt.y<0||vt.y>=ie)return;let Ve=null;if(D){let{x:ce,y:Lt,z:xe}=U.projectTilePoint(vt.x,vt.y,Xe);Ve={anchor:new Oo(ce,Lt,xe,0,void 0),up:U.upVector(Xe,vt.x,vt.y)}}(function(ce,Lt,xe,Oe,Je,De,Te,oi,ve,Qi,Wi,gi,Ui,ui,$i,yi,ca,Ja,qa,_i,na,wa,Ea,Aa,Ai,Dn,fr){let Jn=ce.addToLineVertexArray(Lt,Oe),Zn,pl,km,Oh,NR,YR,XR,JR=0,yR=0,BR=0,MR=0,V1=-1,R1=-1,Fo={},CR=lm(""),js=xe?xe.anchor:Lt,G1=ve.layout.get("icon-text-fit").evaluate(na,{},Ai)!=="none",F1=0,I1=0;if(ve._unevaluatedLayout.getValue("text-radial-offset")===void 0?[F1,I1]=ve.layout.get("text-offset").evaluate(na,{},Ai).map(_n=>_n*en):(F1=ve.layout.get("text-radial-offset").evaluate(na,{},Ai)*en,I1=DW),ce.allowVerticalPlacement&&Je.vertical){let _n=Je.vertical;if($i)YR=PW(_n),oi&&(XR=PW(oi));else{let Pn=ve.layout.get("text-rotate").evaluate(na,{},Ai)+90;km=Yh(Qi,js,Lt,Wi,gi,Ui,_n,ui,Pn,yi),oi&&(Oh=Yh(Qi,js,Lt,Wi,gi,Ui,oi,Ja,Pn))}}if(De){let _n=ve.layout.get("icon-rotate").evaluate(na,{},Ai),Pn=FV(De,_n,Ea,G1),hc=oi?FV(oi,_n,Ea,G1):void 0;pl=Yh(Qi,js,Lt,Wi,gi,Ui,De,Ja,_n),JR=4*Pn.length;let TR=ce.iconSizeData,Os=null;TR.kind==="source"?(Os=[wl*ve.layout.get("icon-size").evaluate(na,{},Ai)],Os[0]>Cr&&ji("".concat(ce.layerIds[0],': Value for "icon-size" is >= ').concat(Rm,'. Reduce your "icon-size".'))):TR.kind==="composite"&&(Os=[wl*wa.compositeIconSizes[0].evaluate(na,{},Ai),wl*wa.compositeIconSizes[1].evaluate(na,{},Ai)],(Os[0]>Cr||Os[1]>Cr)&&ji("".concat(ce.layerIds[0],': Value for "icon-size" is >= ').concat(Rm,'. Reduce your "icon-size".'))),ce.addSymbols(ce.icon,Pn,Os,_i,qa,na,!1,xe,Lt,Jn.lineStartIndex,Jn.lineLength,-1,Aa,Ai,Dn,fr),V1=ce.icon.placedSymbolArray.length-1,hc&&(yR=4*hc.length,ce.addSymbols(ce.icon,hc,Os,_i,qa,na,ml.vertical,xe,Lt,Jn.lineStartIndex,Jn.lineLength,-1,Aa,Ai,Dn,fr),R1=ce.icon.placedSymbolArray.length-1)}for(let _n in Je.horizontal){let Pn=Je.horizontal[_n];Zn||(CR=lm(Pn.text),$i?NR=PW(Pn):Zn=Yh(Qi,js,Lt,Wi,gi,Ui,Pn,ui,ve.layout.get("text-rotate").evaluate(na,{},Ai),yi));let hc=Pn.positionedLines.length===1;if(BR+=xV(ce,xe,Lt,Pn,Te,ve,$i,na,yi,Jn,Je.vertical?ml.horizontal:ml.horizontalOnly,hc?Object.keys(Je.horizontal):[_n],Fo,V1,wa,Aa,Ai,Dn),hc)break}Je.vertical&&(MR+=xV(ce,xe,Lt,Je.vertical,Te,ve,$i,na,yi,Jn,ml.vertical,["vertical"],Fo,R1,wa,Aa,Ai,Dn));let vr=-1,U1=(_n,Pn)=>_n?Math.max(_n,Pn):Pn;vr=U1(NR,vr),vr=U1(YR,vr),vr=U1(XR,vr);let jY=vr>-1?1:0;ce.glyphOffsetArray.length>=65535&&ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),na.sortKey!==void 0&&ce.addToSortKeyRanges(ce.symbolInstances.length,na.sortKey),ce.symbolInstances.emplaceBack(Lt.x,Lt.y,js.x,js.y,js.z,Fo.right>=0?Fo.right:-1,Fo.center>=0?Fo.center:-1,Fo.left>=0?Fo.left:-1,Fo.vertical>=0?Fo.vertical:-1,V1,R1,CR,Zn!==void 0?Zn:ce.collisionBoxArray.length,Zn!==void 0?Zn+1:ce.collisionBoxArray.length,km!==void 0?km:ce.collisionBoxArray.length,km!==void 0?km+1:ce.collisionBoxArray.length,pl!==void 0?pl:ce.collisionBoxArray.length,pl!==void 0?pl+1:ce.collisionBoxArray.length,Oh||ce.collisionBoxArray.length,Oh?Oh+1:ce.collisionBoxArray.length,Wi,BR,MR,JR,yR,jY,0,F1,I1,vr,0,G1?1:0)})(e,vt,Ve,ne,i,n,r,Qt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,dt,pt,W,0,ht,xt,S,t,s,u,V,F,X,y)};if(kt==="line")for(let ne of ZV(t.geometry,0,0,ie,ie)){let vt=IN(ne,nt,gt,i.vertical||A,n,O,$,e.overscaling,ie);for(let Xe of vt)A&&JN(e,A.text,Ft,Xe)||be(ne,Xe,F)}else if(kt==="line-center"){for(let ne of t.geometry)if(ne.length>1){let vt=FN(ne,gt,i.vertical||A,n,O,$);vt&&be(ne,vt,F)}}else if(t.type==="Polygon")for(let ne of TW(t.geometry,0)){let vt=xN(ne,16);be(ne[0],new Oo(vt.x,vt.y,0,0,void 0),F)}else if(t.type==="LineString")for(let ne of t.geometry)be(ne,new Oo(ne[0].x,ne[0].y,0,0,void 0),F);else if(t.type==="Point")for(let ne of t.geometry)for(let vt of ne)be([vt],new Oo(vt.x,vt.y,0,0,void 0),F)}let Rm=255,Cr=Rm*wl;function xV(e,t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k,S){let A=function(et,$,nt,dt,ht,gt,pt,xt){let kt=[];if($.positionedLines.length===0)return kt;let Ft=dt.layout.get("text-rotate").evaluate(gt,{})*Math.PI/180,Ct=function(be){let ne=be[0],vt=be[1],Xe=ne*vt;return Xe>0?[ne,-vt]:Xe<0?[-ne,vt]:ne===0?[vt,ne]:[vt,-ne]}(nt),Rt=Math.abs($.top-$.bottom);for(let be of $.positionedLines)Rt-=be.lineOffset;let Bt=$.positionedLines.length,_t=Rt/Bt,Qt=$.top-nt[1];for(let be=0;be<Bt;++be){let ne=$.positionedLines[be];Qt=UN($,_t,Qt,be);for(let vt of ne.positionedGlyphs){if(!vt.rect)continue;let Xe=vt.rect||{},Ve=lV+1,ce=!0,Lt=1,xe=0;if(vt.imageName){let _i=pt[vt.imageName];if(!_i)continue;if(_i.sdf){ji("SDF images are not supported in formatted text and will be ignored.");continue}ce=!1,Lt=_i.pixelRatio,Ve=On/Lt}let Oe=(ht||xt)&&vt.vertical,Je=vt.metrics.advance*vt.scale/2,De=vt.metrics,Te=vt.rect;if(Te===null)continue;xt&&$.verticalizable&&(xe=vt.imageName?Je-vt.metrics.width*vt.scale/2:0);let oi=ht?[vt.x+Je,vt.y]:[0,0],ve=[0,0],Qi=[0,0],Wi=!1;ht||(Oe?(Qi=[vt.x+Je+Ct[0],vt.y+Ct[1]-xe],Wi=!0):ve=[vt.x+Je+nt[0],vt.y+nt[1]-xe]);let gi=Te.w*vt.scale/(Lt*(vt.localGlyph?El:1)),Ui=Te.h*vt.scale/(Lt*(vt.localGlyph?El:1)),ui,$i,yi,ca;if(Oe){let _i=vt.y-Qt,na=new Nt(-Je,Je-_i),wa=-Math.PI/2,Ea=new Nt(...Qi);ui=new Nt(-Je+ve[0],ve[1]),ui._rotateAround(wa,na)._add(Ea),ui.x+=-_i+Je,ui.y-=(De.left-Ve)*vt.scale;let Aa=vt.imageName?De.advance*vt.scale:en*vt.scale,Ai=String.fromCodePoint(vt.glyph);nN(Ai)?ui.x+=(1-Ve)*vt.scale:lN(Ai)?ui.x+=Aa-De.height*vt.scale+(-Ve-1)*vt.scale:ui.x+=vt.imageName||De.width+2*Ve===Te.w&&De.height+2*Ve===Te.h?(Aa-Ui)/2:(Aa-(De.height+2*Ve)*vt.scale)/2,$i=new Nt(ui.x,ui.y-gi),yi=new Nt(ui.x+Ui,ui.y),ca=new Nt(ui.x+Ui,ui.y-gi)}else{let _i=(De.left-Ve)*vt.scale-Je+ve[0],na=(-De.top-Ve)*vt.scale+ve[1],wa=_i+gi,Ea=na+Ui;ui=new Nt(_i,na),$i=new Nt(wa,na),yi=new Nt(_i,Ea),ca=new Nt(wa,Ea)}if(Ft){let _i;_i=ht?new Nt(0,0):Wi?new Nt(Ct[0],Ct[1]):new Nt(nt[0],nt[1]),ui._rotateAround(Ft,_i),$i._rotateAround(Ft,_i),yi._rotateAround(Ft,_i),ca._rotateAround(Ft,_i)}let Ja=new Nt(0,0),qa=new Nt(0,0);kt.push({tl:ui,tr:$i,bl:yi,br:ca,texPrimary:Xe,texSecondary:void 0,writingMode:$.writingMode,glyphOffset:oi,sectionIndex:vt.sectionIndex,isSDF:ce,pixelOffsetTL:Ja,pixelOffsetBR:qa,minFontScaleX:0,minFontScaleY:0})}}return kt}(0,n,W,s,b,h,r,e.allowVerticalPlacement),D=e.textSizeData,O=null;D.kind==="source"?(O=[wl*s.layout.get("text-size").evaluate(h,{},k)],O[0]>Cr&&ji("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Rm,'. Reduce your "text-size".'))):D.kind==="composite"&&(O=[wl*y.compositeTextSizes[0].evaluate(h,{},k),wl*y.compositeTextSizes[1].evaluate(h,{},k)],(O[0]>Cr||O[1]>Cr)&&ji("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Rm,'. Reduce your "text-size".'))),e.addSymbols(e.text,A,O,W,b,h,V,t,i,u.lineStartIndex,u.lineLength,X,B,k,S,!1);for(let et of F)U[et]=e.text.placedSymbolArray.length-1;return 4*A.length}function NV(e){for(let t in e)return e[t];return null}function Yh(e,t,i,n,r,s,b,h,W,u){let V=b.top,F=b.bottom,U=b.left,X=b.right,y=b.collisionPadding;if(y&&(U-=y[0],V-=y[1],X+=y[2],F+=y[3]),W){let B=new Nt(U,V),k=new Nt(X,V),S=new Nt(U,F),A=new Nt(X,F),D=ye(W),O=new Nt(0,0);u&&(O=new Nt(u[0],u[1])),B._rotateAround(D,O),k._rotateAround(D,O),S._rotateAround(D,O),A._rotateAround(D,O),U=Math.min(B.x,k.x,S.x,A.x),X=Math.max(B.x,k.x,S.x,A.x),V=Math.min(B.y,k.y,S.y,A.y),F=Math.max(B.y,k.y,S.y,A.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,U,V,X,F,h,n,r,s),e.length-1}function PW(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);let t=e.bottom-e.top;return t>0?Math.max(10,t):null}function JN(e,t,i,n){let r=e.compareText;if(t in r){let s=r[t];for(let b=s.length-1;b>=0;b--)if(n.dist(s[b])<i)return!0}else r[t]=[];return r[t].push(n),!1}function YV(e,t){let i=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),s=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),b=Math.sin(e._pitch)*s+r;return Math.min(1.01*b,r*(1/e._horizonShift))}function Gm(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};let i=Math.pow(2,-e.z),n=e.x*i,r=(e.x+1)*i,s=e.y*i,b=(e.y+1)*i,h=Qe(n),W=Qe(r),u=si(s),V=si(b),F=t.project(h,u),U=t.project(W,u),X=t.project(W,V),y=t.project(h,V),B=Math.min(F.x,U.x,X.x,y.x),k=Math.min(F.y,U.y,X.y,y.y),S=Math.max(F.x,U.x,X.x,y.x),A=Math.max(F.y,U.y,X.y,y.y),D=i/16;function O($,nt,dt,ht,gt,pt){let xt=(dt+gt)/2,kt=(ht+pt)/2,Ft=t.project(Qe(xt),si(kt)),Ct=Math.max(0,B-Ft.x,k-Ft.y,Ft.x-S,Ft.y-A);B=Math.min(B,Ft.x),S=Math.max(S,Ft.x),k=Math.min(k,Ft.y),A=Math.max(A,Ft.y),Ct>D&&(O($,Ft,dt,ht,xt,kt),O(Ft,nt,xt,kt,gt,pt))}O(F,U,n,s,r,s),O(U,X,r,s,r,b),O(X,y,r,b,n,b),O(y,F,n,b,n,s),B-=D,k-=D,S+=D,A+=D;let et=1/Math.max(S-B,A-k);return{scale:et,x:B*et,y:k*et,x2:S*et,y2:A*et,projection:t}}function XV(e,{x:t,y:i},n=0){return new Nt(((t-n)*e.scale-e.x)*ie,(i*e.scale-e.y)*ie)}let yN=o.a6.identity(new Float32Array(16));class Tr{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new mt(0,0)}projectTilePoint(t,i,n){return{x:t,y:i,z:0}}locationPoint(t,i,n=!0){return t._coordinatePoint(t.locationCoordinate(i),n)}pixelsPerMeter(t,i){return fe(1,t)*i}pixelSpaceConversion(t,i,n){return 1}farthestPixelDistance(t){return YV(t,t.pixelsPerMeter)}pointCoordinate(t,i,n,r){let s=t.horizonLineFromTop(!1),b=new Nt(i,Math.max(s,n));return t.rayIntersectionCoordinate(t.pointRayIntersection(b,r))}pointCoordinate3D(t,i,n){let r=new Nt(i,n);if(t.elevation)return t.elevation.pointCoordinate(r);{let s=this.pointCoordinate(t,r.x,r.y,0);return[s.x,s.y,s.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);let n=t.horizonLineFromTop();return i.y<n}createInversionMatrix(t,i){return yN}createTileMatrix(t,i,n){let r,s,b,h=n.canonical,W=o.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let u=Gm(h,this);r=1,s=u.x+n.wrap*u.scale,b=u.y,o.a6.scale(W,W,[r/u.scale,r/u.scale,t.pixelsPerMeter/i])}else r=i/t.zoomScale(h.z),s=(h.x+Math.pow(2,h.z)*n.wrap)*r,b=h.y*r;return o.a6.translate(W,W,[s,b,0]),o.a6.scale(W,W,[r/ie,r/ie,1]),W}upVector(t,i,n){return[0,0,1]}upVectorScale(t,i,n){return{metersToTile:1}}}class BN extends Tr{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];let[i,n]=this.parallels=t.parallels||[29.5,45.5],r=Math.sin(ye(i));this.n=(r+Math.sin(ye(n)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(t,i){let{n,c:r,r0:s}=this,b=ye(t-this.center[0]),h=ye(i),W=Math.sqrt(r-2*n*Math.sin(h))/n;return{x:W*Math.sin(b*n),y:W*Math.cos(b*n)-s,z:0}}unproject(t,i){let{n,c:r,r0:s}=this,b=s+i,h=Math.atan2(t,Math.abs(b))*Math.sign(b);b*n<0&&(h-=Math.PI*Math.sign(t)*Math.sign(b));let W=ye(this.center[0])*n;h=Ma(h,-Math.PI-W,Math.PI-W);let u=ke(Bi(h/n)+this.center[0],-180,180),V=Math.asin(ke((r-(t*t+b*b)*n*n)/(2*n),-1,1)),F=ke(Bi(V),-$e,$e);return new mt(u,F)}}let Fm=1.340264,Im=-.081106,Um=893e-6,xm=.003796,Xh=Math.sqrt(3)/2;class MN extends Tr{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;let n=Math.asin(Xh*Math.sin(i)),r=n*n,s=r*r*r;return{x:.5*(t*Math.cos(n)/(Xh*(Fm+3*Im*r+s*(7*Um+9*xm*r)))/Math.PI+.5),y:1-.5*(n*(Fm+Im*r+s*(Um+xm*r))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,r=n*n,s=r*r*r;for(let V,F,U,X=0;X<12&&(F=n*(Fm+Im*r+s*(Um+xm*r))-i,U=Fm+3*Im*r+s*(7*Um+9*xm*r),V=F/U,n=ke(n-V,-Math.PI/3,Math.PI/3),r=n*n,s=r*r*r,!(Math.abs(V)<1e-12));++X);let b=Xh*t*(Fm+3*Im*r+s*(7*Um+9*xm*r))/Math.cos(n),h=Math.asin(Math.sin(n)/Xh),W=ke(180*b/Math.PI,-180,180),u=ke(180*h/Math.PI,-$e,$e);return new mt(W,u)}}class CN extends Tr{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){let n=360*(t-.5),r=ke(360*(.5-i),-$e,$e);return new mt(n,r)}}let oc=Math.PI/2;function Jh(e){return Math.tan((oc+e)/2)}class TN extends Tr{constructor(t){super(t),this.center=t.center||[0,30];let[i,n]=this.parallels=t.parallels||[30,30],r=ye(i),s=ye(n);this.southernCenter=r+s<0,this.southernCenter&&(r=-r,s=-s);let b=Math.cos(r),h=Jh(r);this.n=r===s?Math.sin(r):Math.log(b/Math.cos(s))/Math.log(Jh(s)/h),this.f=b*Math.pow(Jh(r),this.n)/this.n}project(t,i){i=ye(i),this.southernCenter&&(i=-i),t=ye(t-this.center[0]);let n=1e-6,{n:r,f:s}=this;s>0?i<-oc+n&&(i=-oc+n):i>oc-n&&(i=oc-n);let b=s/Math.pow(Jh(i),r),h=b*Math.sin(r*t),W=s-b*Math.cos(r*t);return h=.5*(h/Math.PI+.5),W=.5*(W/Math.PI+.5),{x:h,y:this.southernCenter?W:1-W,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n,f:r}=this,s=r-i,b=Math.sign(s),h=Math.sign(n)*Math.sqrt(t*t+s*s),W=Math.atan2(t,Math.abs(s))*b;s*n<0&&(W-=Math.PI*Math.sign(t)*b);let u=ke(Bi(W/n)+this.center[0],-180,180),V=ke(Bi(2*Math.atan(Math.pow(r/h,1/n))-oc),-$e,$e);return new mt(u,this.southernCenter?-V:V)}}class JV extends Tr{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:Ae(t),y:Me(i),z:0}}unproject(t,i){let n=Qe(t),r=si(i);return new mt(n,r)}}let yV=ye($e);class kN extends Tr{project(t,i){let n=(i=ye(i))*i,r=n*n;return{x:.5*((t=ye(t))*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,r=25,s=0,b=n*n;do{b=n*n;let u=b*b;s=(n*(1.007226+b*(.015085+u*(.028874*b-.044475-.005916*u)))-i)/(1.007226+b*(.045255+u*(.259866*b-.311325-.005916*11*u))),n=ke(n-s,-yV,yV)}while(Math.abs(s)>1e-6&&--r>0);b=n*n;let h=ke(Bi(t/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),W=Bi(n);return new mt(h,W)}}let BV=ye($e);class QN extends Tr{project(t,i){i=ye(i),t=ye(t);let n=Math.cos(i),r=2/Math.PI,s=Math.acos(n*Math.cos(t/2)),b=Math.sin(s)/s,h=.5*(t*r+2*n*Math.sin(t/2)/b)||0,W=.5*(i+Math.sin(i)/b)||0;return{x:.5*(h/Math.PI+.5),y:1-.5*(W/Math.PI+1),z:0}}unproject(t,i){let n=t=(2*t-.5)*Math.PI,r=i=(2*(1-i)-1)*Math.PI,s=25,b=1e-6,h=0,W=0;do{let u=Math.cos(r),V=Math.sin(r),F=2*V*u,U=V*V,X=u*u,y=Math.cos(n/2),B=Math.sin(n/2),k=2*y*B,S=B*B,A=1-X*y*y,D=A?1/A:0,O=A?Math.acos(u*y)*Math.sqrt(1/A):0,et=.5*(2*O*u*B+2*n/Math.PI)-t,$=.5*(O*V+r)-i,nt=.5*D*(X*S+O*u*y*U)+1/Math.PI,dt=D*(k*F/4-O*V*B),ht=.125*D*(F*B-O*V*X*k),gt=.5*D*(U*y+O*S*u)+.5,pt=dt*ht-gt*nt;h=($*dt-et*gt)/pt,W=(et*ht-$*nt)/pt,n=ke(n-h,-Math.PI,Math.PI),r=ke(r-W,-BV,BV)}while((Math.abs(h)>b||Math.abs(W)>b)&&--s>0);return new mt(Bi(n),Bi(r))}}class MV extends Tr{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ye(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){let{scale:n,cosPhi:r}=this;return{x:ye(t)*r*n+.5,y:-Math.sin(ye(i))/r*n+.5,z:0}}unproject(t,i){let{scale:n,cosPhi:r}=this,s=-(i-.5)/n,b=ke(Bi((t-.5)/n)/r,-180,180),h=Math.asin(ke(s*r,-1,1)),W=ke(Bi(h),-$e,$e);return new mt(b,W)}}class SN extends JV{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,n){let r=dm(t,i,n),s=rh(Go(n));return o.N.transformMat4(r,r,s),{x:r[0],y:r[1],z:r[2]}}locationPoint(t,i){let n=It(i.lat,i.lng),r=o.N.normalize([],n),s=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,b=fe(1,0)*ie*s;o.N.scaleAndAdd(n,n,r,b);let h=o.a6.identity(new Float64Array(16));return o.a6.multiply(h,t.pixelMatrix,t.globeMatrix),o.N.transformMat4(n,n,h),new Nt(n[0],n[1])}pixelsPerMeter(t,i){return fe(1,0)*i}pixelSpaceConversion(t,i,n){let r=fe(1,t)*i,s=li(fe(1,45)*i,r,n);return this.pixelsPerMeter(t,i)/s}createTileMatrix(t,i,n){let r=NW(Go(n.canonical));return o.a6.multiply(new Float64Array(16),t.globeMatrix,r)}createInversionMatrix(t,i){let{center:n}=t,r=rh(Go(i));return o.a6.rotateY(r,r,ye(n.lng)),o.a6.rotateX(r,r,ye(n.lat)),o.a6.scale(r,r,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(t,i,n,r){return _Z(t,i,n,!0)||new mi(0,0)}pointCoordinate3D(t,i,n){let r=this.pointCoordinate(t,i,n,0);return[r.x,r.y,r.z]}isPointAboveHorizon(t,i){return!_Z(t,i.x,i.y,!1)}farthestPixelDistance(t){let i=function(r,s){let b=r.cameraToCenterDistance,h=r._centerAltitude*s,W=r._camera,u=r._camera.forward(),V=o.N.add([],o.N.scale([],u,-b),[0,0,h]),F=r.worldSize/(2*Math.PI),U=[0,0,-F],X=r.width/r.height,y=Math.tan(r.fovAboveCenter),B=o.N.scale([],W.up(),y),k=o.N.scale([],W.right(),y*X),S=o.N.normalize([],o.N.add([],o.N.add([],u,B),k)),A=[],D;if(new GW(V,S).closestPointOnSphere(U,F,A)){let O=o.N.add([],A,U),et=o.N.sub([],O,V);D=Math.cos(r.fovAboveCenter)*o.N.length(et)}else{let O=o.N.sub([],V,U),et=o.N.sub([],U,V);o.N.normalize(et,et);let $=o.N.length(O)-F;D=Math.sqrt($*($+2*F));let nt=Math.acos(D/(F+$))-Math.acos(o.N.dot(u,et));D*=Math.cos(nt)}return 1.01*D}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),n=Xr(t.zoom);if(n>0){let r=YV(t,fe(1,t.center.lat)*t.worldSize),s=t.worldSize/(2*Math.PI),b=Math.max(t.width,t.height)/t.worldSize*Math.PI;return li(i,r+s*(1-Math.cos(b)),Math.pow(n,10))}return i}upVector(t,i,n){return dm(i,n,t,1)}upVectorScale(t){return{metersToTile:nh(oh(Go(t)))}}}function CV(e){let t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new JV(e);case"equirectangular":return new CN(e);case"naturalEarth":return new kN(e);case"equalEarth":return new MN(e);case"winkelTripel":return new QN(e);case"albers":return i?new MV(e):new BN(e);case"lambertConformalConic":return i?new MV(e):new TN(e);case"globe":return new SN(e)}throw new Error("Invalid projection name: ".concat(e.name))}let fN=ph.types,vN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yh(e,t,i,n,r,s,b,h,W,u,V,F,U){let X=h?Math.min(Cr,Math.round(h[0])):0,y=h?Math.min(Cr,Math.round(h[1])):0;e.emplaceBack(t,i,Math.round(32*n),Math.round(32*r),s,b,(X<<1)+(W?1:0),y,16*u,16*V,256*F,256*U)}function Bh(e,t,i){e.emplaceBack(t,i)}function Mh(e,t,i,n,r,s,b){e.emplaceBack(t,i,n,r,s,b)}function Ch(e,t,i,n,r){e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r)}function LN(e){for(let t of e.sections)if(Cb(t.text))return!0;return!1}class KW{constructor(t){this.layoutVertexArray=new Ys,this.indexArray=new Qa,this.programConfigurations=t,this.segments=new da,this.dynamicLayoutVertexArray=new po,this.opacityVertexArray=new Pb,this.placedSymbolArray=new v0,this.iconTransitioningVertexArray=new Gl,this.globeExtVertexArray=new _b,this.zOffsetVertexArray=new Js}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,n,r,s){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Px.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,vN,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,qx.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,_x.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||s)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Kx.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}se(KW,"SymbolBuffers");class qW{constructor(t,i,n){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new n,this.segments=new da,this.collisionVertexArray=new qb,this.collisionVertexArrayExt=new po}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$x.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,tN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}se(qW,"CollisionBuffers");class Th{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.a6.identity([]),this.placementViewportMatrix=o.a6.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zW(this.zoom,i["text-size"]),this.iconSizeData=zW(this.zoom,i["icon-size"]);let n=this.layers[0].layout,r=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=s!=="viewport-y"&&r.constantOr(1)!==void 0,this.sortFeaturesByY=(s==="viewport-y"||s==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(b=>ml[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new KW(new v(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new KW(new v(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new w0,this.lineVertexArray=new Cs,this.symbolInstances=new z0}calculateGlyphDependencies(t,i,n,r,s){for(let b=0;b<t.length;b++){let h=t.codePointAt(b);if(h===void 0)break;if(i[h]=!0,r&&s&&h<=65535){let W=Zm[t.charAt(b)];W&&(i[W.charCodeAt(0)]=!0)}}}populate(t,i,n,r){let s=this.layers[0],b=s.layout,h=this.projection.name==="globe",W=b.get("text-font"),u=b.get("text-field"),V=b.get("icon-image"),F=(u.value.kind!=="constant"||u.value.value instanceof _a&&!u.value.value.isEmpty()||u.value.value.toString().length>0)&&(W.value.kind!=="constant"||W.value.value.length>0),U=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,X=b.get("symbol-sort-key");if(this.features=[],!F&&!U)return;let y=i.iconDependencies,B=i.glyphDependencies,k=i.availableImages,S=new ta(this.zoom);for(let{feature:A,id:D,index:O,sourceLayerIndex:et}of t){let $=s._featureFilter.needGeometry,nt=xa(A,$);if(!s._featureFilter.filter(S,nt,n))continue;if($||(nt.geometry=fa(A,n,r)),h&&A.type!==1&&n.z<=5){let pt=nt.geometry,xt=.98078528056,kt=(Ft,Ct)=>{let Rt=dm(Ft.x,Ft.y,n,1),Bt=dm(Ct.x,Ct.y,n,1);return o.N.dot(Rt,Bt)<xt};for(let Ft=0;Ft<pt.length;Ft++)pt[Ft]=Ka(pt[Ft],kt)}let dt,ht;if(F){let pt=s.getValueAndResolveTokens("text-field",nt,n,k),xt=_a.factory(pt);LN(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||ho()==="unavailable"||this.hasRTLText&&Tn.isParsed())&&(dt=aN(xt,s,nt))}if(U){let pt=s.getValueAndResolveTokens("icon-image",nt,n,k);ht=pt instanceof Ye?pt:Ye.fromString(pt)}if(!dt&&!ht)continue;let gt=this.sortFeaturesByKey?X.evaluate(nt,{},n):void 0;if(this.features.push({id:D,text:dt,icon:ht,index:O,sourceLayerIndex:et,geometry:nt.geometry,properties:A.properties,type:fN[A.type],sortKey:gt}),ht&&(y[ht.namePrimary]=!0,ht.nameSecondary&&(y[ht.nameSecondary]=!0)),dt){let pt=W.evaluate(nt,{},n).join(","),xt=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ml.vertical)>=0;for(let kt of dt.sections)if(kt.image)y[kt.image.namePrimary]=!0;else{let Ft=bo(dt.toString()),Ct=kt.fontStack||pt,Rt=B[Ct]=B[Ct]||{};this.calculateGlyphDependencies(kt.text,Rt,xt,this.allowVerticalPlacement,Ft)}}}b.get("symbol-placement")==="line"&&(this.features=function(A){let D={},O={},et=[],$=0;function nt(pt){et.push(A[pt]),$++}function dt(pt,xt,kt){let Ft=O[pt];return delete O[pt],O[xt]=Ft,et[Ft].geometry[0].pop(),et[Ft].geometry[0]=et[Ft].geometry[0].concat(kt[0]),Ft}function ht(pt,xt,kt){let Ft=D[xt];return delete D[xt],D[pt]=Ft,et[Ft].geometry[0].shift(),et[Ft].geometry[0]=kt[0].concat(et[Ft].geometry[0]),Ft}function gt(pt,xt,kt){let Ft=kt?xt[0][xt[0].length-1]:xt[0][0];return"".concat(pt,":").concat(Ft.x,":").concat(Ft.y)}for(let pt=0;pt<A.length;pt++){let xt=A[pt],kt=xt.geometry,Ft=xt.text?xt.text.toString():null;if(!Ft){nt(pt);continue}let Ct=gt(Ft,kt),Rt=gt(Ft,kt,!0);if(Ct in O&&Rt in D&&O[Ct]!==D[Rt]){let Bt=ht(Ct,Rt,kt),_t=dt(Ct,Rt,et[Bt].geometry);delete D[Ct],delete O[Rt],O[gt(Ft,et[_t].geometry,!0)]=_t,et[Bt].geometry=null}else Ct in O?dt(Ct,Rt,kt):Rt in D?ht(Ct,Rt,kt):(nt(pt),D[Ct]=$-1,O[Rt]=$-1)}return et.filter(pt=>pt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((A,D)=>A.sortKey-D.sortKey)}update(t,i,n,r,s){let b=Object.keys(t).length!==0;if(b&&!this.stateDependentLayers.length)return;let h=b?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,i,h,n,r,s),this.icon.programConfigurations.updatePaintArrays(t,i,h,n,r,s)}updateZOffset(){let t=(s,b,h)=>{n+=b,n>s.length&&s.resize(n);for(let W=-b;W<0;W++)s.emplace(W+n,h)},i=(s,b,h)=>{r+=b,r>s.length&&s.resize(r);for(let W=-b;W<0;W++)s.emplace(W+r,h)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,r=0;for(let s=0;s<this.symbolInstances.length;s++){let b=this.symbolInstances.get(s),{numHorizontalGlyphVertices:h,numVerticalGlyphVertices:W,numIconVertices:u}=b,V=b.zOffset,F=u>0;if((h>0||W>0)&&(t(this.text.zOffsetVertexArray,h,V),t(this.text.zOffsetVertexArray,W,V)),F){let{placedIconSymbolIndex:U,verticalPlacedIconSymbolIndex:X}=b;U>=0&&i(this.icon.zOffsetVertexArray,u,V),X>=0&&i(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,V)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=CV(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let n=this.lineVertexArray.length;if(t.segment!==void 0)for(let{x:r,y:s}of i)this.lineVertexArray.emplaceBack(r,s);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,i,n,r,s,b,h,W,u,V,F,U,X,y,B,k){let S=t.indexArray,A=t.layoutVertexArray,D=t.globeExtVertexArray,O=t.segments.prepareSegment(4*i.length,A,S,this.canOverlap?b.sortKey:void 0),et=this.glyphOffsetArray.length,$=O.vertexLength,nt=this.allowVerticalPlacement&&h===ml.vertical?Math.PI/2:0,dt=b.text&&b.text.sections;for(let gt=0;gt<i.length;gt++){let{tl:pt,tr:xt,bl:kt,br:Ft,texPrimary:Ct,texSecondary:Rt,pixelOffsetTL:Bt,pixelOffsetBR:_t,minFontScaleX:Qt,minFontScaleY:be,glyphOffset:ne,isSDF:vt,sectionIndex:Xe}=i[gt],Ve=O.vertexLength,ce=ne[1];if(yh(A,u.x,u.y,pt.x,ce+pt.y,Ct.x,Ct.y,n,vt,Bt.x,Bt.y,Qt,be),yh(A,u.x,u.y,xt.x,ce+xt.y,Ct.x+Ct.w,Ct.y,n,vt,_t.x,Bt.y,Qt,be),yh(A,u.x,u.y,kt.x,ce+kt.y,Ct.x,Ct.y+Ct.h,n,vt,Bt.x,_t.y,Qt,be),yh(A,u.x,u.y,Ft.x,ce+Ft.y,Ct.x+Ct.w,Ct.y+Ct.h,n,vt,_t.x,_t.y,Qt,be),W){let{x:Lt,y:xe,z:Oe}=W.anchor,[Je,De,Te]=W.up;Mh(D,Lt,xe,Oe,Je,De,Te),Mh(D,Lt,xe,Oe,Je,De,Te),Mh(D,Lt,xe,Oe,Je,De,Te),Mh(D,Lt,xe,Oe,Je,De,Te),Ch(t.dynamicLayoutVertexArray,Lt,xe,Oe,nt)}else Ch(t.dynamicLayoutVertexArray,u.x,u.y,u.z,nt);if(k){let Lt=Rt||Ct;Bh(t.iconTransitioningVertexArray,Lt.x,Lt.y),Bh(t.iconTransitioningVertexArray,Lt.x+Lt.w,Lt.y),Bh(t.iconTransitioningVertexArray,Lt.x,Lt.y+Lt.h),Bh(t.iconTransitioningVertexArray,Lt.x+Lt.w,Lt.y+Lt.h)}S.emplaceBack(Ve,Ve+1,Ve+2),S.emplaceBack(Ve+1,Ve+2,Ve+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ne[0]),gt!==i.length-1&&Xe===i[gt+1].sectionIndex||t.programConfigurations.populatePaintArrays(A.length,b,b.index,{},X,y,B,dt&&dt[Xe])}let ht=W?W.anchor:u;t.placedSymbolArray.emplaceBack(ht.x,ht.y,ht.z,u.x,u.y,et,this.glyphOffsetArray.length-et,$,V,F,u.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],h,0,!1,0,U,0)}_commitLayoutVertex(t,i,n,r,s,b,h){t.emplaceBack(i,n,r,s,b,Math.round(h.x),Math.round(h.y))}_addCollisionDebugVertices(t,i,n,r,s,b,h){let W=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),u=W.vertexLength,V=h.tileAnchorX,F=h.tileAnchorY;for(let X=0;X<4;X++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,i,t.padding,h.zOffset),this._commitLayoutVertex(n.layoutVertexArray,r,s,b,V,F,new Nt(t.x1,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,s,b,V,F,new Nt(t.x2,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,s,b,V,F,new Nt(t.x2,t.y2)),this._commitLayoutVertex(n.layoutVertexArray,r,s,b,V,F,new Nt(t.x1,t.y2)),W.vertexLength+=4;let U=n.indexArray;U.emplaceBack(u,u+1),U.emplaceBack(u+1,u+2),U.emplaceBack(u+2,u+3),U.emplaceBack(u+3,u),W.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,n,r,s,b){for(let h=r;h<s;h++){let W=n.get(h),u=this.getSymbolInstanceTextSize(t,b,i,h);this._addCollisionDebugVertices(W,u,this.textCollisionBox,W.projectedAnchorX,W.projectedAnchorY,W.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(t,i,n,r,s,b){for(let h=r;h<s;h++){let W=n.get(h),u=this.getSymbolInstanceIconSize(t,i,b.placedIconSymbolIndex);this._addCollisionDebugVertices(W,u,this.iconCollisionBox,W.projectedAnchorX,W.projectedAnchorY,W.projectedAnchorZ,b)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qW(Xs,$g.members,Gl),this.iconCollisionBox=new qW(Xs,$g.members,Gl);let n=$d(this.iconSizeData,t),r=$d(this.textSizeData,t);for(let s=0;s<this.symbolInstances.length;s++){let b=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(r,t,i,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(r,t,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(n,t,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(n,t,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(t,i,n,r){let s=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:r),b=Rh(this.textSizeData,t,s)/en;return this.tilePixelRatio*b}getSymbolInstanceIconSize(t,i,n){let r=this.icon.placedSymbolArray.get(n),s=Rh(this.iconSizeData,t,r);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(t,i,n,r){t.emplaceBack(i,-n,-n,r),t.emplaceBack(i,n,-n,r),t.emplaceBack(i,n,n,r),t.emplaceBack(i,-n,n,r)}_updateTextDebugCollisionBoxes(t,i,n,r,s,b){for(let h=r;h<s;h++){let W=n.get(h),u=this.getSymbolInstanceTextSize(t,b,i,h);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,u,W.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(t,i,n,r,s,b){for(let h=r;h<s;h++){let W=n.get(h),u=this.getSymbolInstanceIconSize(t,i,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,u,W.padding,b.zOffset)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let n=$d(this.iconSizeData,t),r=$d(this.textSizeData,t);for(let s=0;s<this.symbolInstances.length;s++){let b=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(r,t,i,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(r,t,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(n,t,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._updateIconDebugCollisionBoxes(n,t,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,n,r,s,b,h,W,u){let V={};if(i<n){let{x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O,featureIndex:et}=t.get(i);V.textBox={x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O},V.textFeatureIndex=et}if(r<s){let{x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O,featureIndex:et}=t.get(r);V.verticalTextBox={x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O},V.verticalTextFeatureIndex=et}if(b<h){let{x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O,featureIndex:et}=t.get(b);V.iconBox={x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O},V.iconFeatureIndex=et}if(W<u){let{x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O,featureIndex:et}=t.get(W);V.verticalIconBox={x1:F,y1:U,x2:X,y2:y,padding:B,projectedAnchorX:k,projectedAnchorY:S,projectedAnchorZ:A,tileAnchorX:D,tileAnchorY:O},V.verticalIconFeatureIndex=et}return V}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){let n=t.placedSymbolArray.get(i),r=n.vertexStartIndex+4*n.numGlyphs;for(let s=n.vertexStartIndex;s<r;s+=4)t.indexArray.emplaceBack(s,s+1,s+2),t.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),n=Math.cos(t),r=[],s=[],b=[];for(let h=0;h<this.symbolInstances.length;++h){b.push(h);let W=this.symbolInstances.get(h);r.push(0|Math.round(i*W.tileAnchorX+n*W.tileAnchorY)),s.push(W.featureIndex)}return b.sort((h,W)=>r[h]-r[W]||s[W]-s[h]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex);let{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:s,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:h,placedIconSymbolIndex:W,verticalPlacedIconSymbolIndex:u}=n;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),s>=0&&s!==r&&this.addIndicesForPlacedSymbol(this.text,s),b>=0&&b!==s&&b!==r&&this.addIndicesForPlacedSymbol(this.text,b),h>=0&&this.addIndicesForPlacedSymbol(this.text,h),W>=0&&this.addIndicesForPlacedSymbol(this.icon,W),u>=0&&this.addIndicesForPlacedSymbol(this.icon,u)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}se(Th,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Th.addDynamicAttributes=Ch;let zN=new ea({"symbol-placement":new jt(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ue(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(ut.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new jt(ut.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new jt(ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jt(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ue(ut.layout_symbol["icon-size"]),"icon-text-fit":new Ue(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ue(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ue(ut.layout_symbol["icon-image"]),"icon-rotate":new Ue(ut.layout_symbol["icon-rotate"]),"icon-padding":new jt(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new Ue(ut.layout_symbol["icon-offset"]),"icon-anchor":new Ue(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(ut.layout_symbol["text-rotation-alignment"]),"text-field":new Ue(ut.layout_symbol["text-field"]),"text-font":new Ue(ut.layout_symbol["text-font"]),"text-size":new Ue(ut.layout_symbol["text-size"]),"text-max-width":new Ue(ut.layout_symbol["text-max-width"]),"text-line-height":new Ue(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new Ue(ut.layout_symbol["text-letter-spacing"]),"text-justify":new Ue(ut.layout_symbol["text-justify"]),"text-radial-offset":new Ue(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(ut.layout_symbol["text-variable-anchor"]),"text-anchor":new Ue(ut.layout_symbol["text-anchor"]),"text-max-angle":new jt(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(ut.layout_symbol["text-writing-mode"]),"text-rotate":new Ue(ut.layout_symbol["text-rotate"]),"text-padding":new jt(ut.layout_symbol["text-padding"]),"text-keep-upright":new jt(ut.layout_symbol["text-keep-upright"]),"text-transform":new Ue(ut.layout_symbol["text-transform"]),"text-offset":new Ue(ut.layout_symbol["text-offset"]),"text-allow-overlap":new jt(ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jt(ut.layout_symbol["text-ignore-placement"]),"text-optional":new jt(ut.layout_symbol["text-optional"]),visibility:new jt(ut.layout_symbol.visibility)});var $W={paint:new ea({"icon-opacity":new Ue(ut.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Ue(ut.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ue(ut.paint_symbol["text-emissive-strength"]),"icon-color":new Ue(ut.paint_symbol["icon-color"]),"icon-halo-color":new Ue(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ue(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ue(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(ut.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ue(ut.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ue(ut.paint_symbol["text-opacity"]),"text-color":new Ue(ut.paint_symbol["text-color"],{runtimeType:En,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ue(ut.paint_symbol["text-halo-color"]),"text-halo-width":new Ue(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new Ue(ut.paint_symbol["text-halo-blur"]),"text-translate":new jt(ut.paint_symbol["text-translate"]),"text-translate-anchor":new jt(ut.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new jt(ut.paint_symbol["icon-color-saturation"])}),layout:zN};class TV{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ar,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}se(TV,"FormatSectionOverride",{omit:["defaultValue"]});class kh extends xn{constructor(t,i,n){super(t,$W,i,n)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let n=this.layout.get("text-writing-mode");if(n){let r=[];for(let s of n)r.indexOf(s)<0&&r.push(s);this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,n,r){let s=this.layout.get(t).evaluate(i,{},n,r),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||ps(b.value)||!s?s:function(h,W){return W.replace(/{([^{}]+)}/g,(u,V)=>V in h?String(h[V]):"")}(i.properties,s)}createBucket(t){return new Th(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let t of $W.paint.overridableProperties){if(!kh.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),n=new TV(i),r=new Cd(n,i.property.specification,this.scope,this.options),s=null;s=i.value.kind==="constant"||i.value.kind==="source"?new Bb("source",r):new Ws("composite",r,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new Fr(i.property,s,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&kh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let n=t.get("text-field"),r=$W.paint.properties[i],s=!1,b=h=>{for(let W of h)if(r.overrides&&r.overrides.hasOverride(W))return void(s=!0)};if(n.value.kind==="constant"&&n.value.value instanceof _a)b(n.value.value.sections);else if(n.value.kind==="source"){let h=u=>{s||(u instanceof Bl&&Ia(u.value)===lr?b(u.value.sections):u instanceof rr?b(u.sections):u.eachChild(h))},W=n.value;W._styleExpression&&h(W._styleExpression.expression)}return s}getProgramIds(){let t=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,n=[];return t&&n.push("symbolIcon"),i&&n.push("symbolSDF"),n}getDefaultProgramParams(t,i){return{config:new T(this,i),overrideFog:!1}}}let wN=new ea({visibility:new jt(ut.layout_background.visibility)});var EN={paint:new ea({"background-color":new jt(ut.paint_background["background-color"]),"background-pattern":new jt(ut.paint_background["background-pattern"]),"background-opacity":new jt(ut.paint_background["background-opacity"]),"background-emissive-strength":new jt(ut.paint_background["background-emissive-strength"])}),layout:wN};let AN=new ea({visibility:new jt(ut.layout_raster.visibility)});var HN={paint:new ea({"raster-opacity":new jt(ut.paint_raster["raster-opacity"]),"raster-color":new fo(ut.paint_raster["raster-color"]),"raster-color-mix":new jt(ut.paint_raster["raster-color-mix"]),"raster-color-range":new jt(ut.paint_raster["raster-color-range"]),"raster-hue-rotate":new jt(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(ut.paint_raster["raster-saturation"]),"raster-contrast":new jt(ut.paint_raster["raster-contrast"]),"raster-resampling":new jt(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(ut.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new jt(ut.paint_raster["raster-emissive-strength"]),"raster-array-band":new jt(ut.paint_raster["raster-array-band"]),"raster-elevation":new jt(ut.paint_raster["raster-elevation"])}),layout:AN},t1=Ni([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class e1{constructor(t,i,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(i,r)}update(t,i,n){let{width:r,height:s}=t,{context:b}=this,{gl:h}=b;if(h.bindTexture(h.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA&&(!i||i.premultiply!==!1)),n||this.size&&this.size[0]===r&&this.size[1]===s){let{x:W,y:u}=n||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)h.texSubImage2D(h.TEXTURE_2D,0,W,u,h.RGBA,h.UNSIGNED_BYTE,t);else{let V=this.format,F=h.UNSIGNED_BYTE;this.format===h.R32F&&(V=h.RED,F=h.FLOAT),h.texSubImage2D(h.TEXTURE_2D,0,W,u,r,s,V,F,t.data)}}else if(this.size=[r,s],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let W=this.format;this.format===h.R8&&(W=h.RED),h.texImage2D(h.TEXTURE_2D,0,this.format,W,h.UNSIGNED_BYTE,t)}else{let W=this.format,u=this.format,V=h.UNSIGNED_BYTE;this.format===h.DEPTH_COMPONENT&&(W=h.DEPTH_COMPONENT16,V=h.UNSIGNED_SHORT),this.format===h.R8&&(u=h.RED),this.format===h.R32F&&(V=h.FLOAT,u=h.RED),h.texImage2D(h.TEXTURE_2D,0,W,r,s,0,u,V,t.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(t,i,n=!1){let{context:r}=this,{gl:s}=r;s.bindTexture(s.TEXTURE_2D,this.texture),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap&&!n?t===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,n,r){let{context:s}=this,{gl:b}=s;b.bindTexture(b.TEXTURE_2D,this.texture),i!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?t===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),n!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,n),this.wrapS=n),r!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Qh{constructor(t,i){this.context=t,this.texture=i}bind(t,i){let{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Sh(e,t,i,n,r,s,b,h){let W=[e,t,1,i,n,1,r,s,1],u=[b,h,1],V=o.co.adjoint([],W),[F,U,X]=o.N.transformMat3(u,u,V);return o.co.multiply(W,W,[F,0,0,0,U,0,0,0,X])}function kV(e,t,i,n,r,s,b,h){let W=function(u,V,F,U,X,y,B,k){let S=Sh(0,0,1,0,1,1,0,1),A=Sh(u,V,F,U,X,y,B,k),D=o.co.adjoint([],S);return o.co.multiply(A,A,D)}(e,t,i,n,r,s,b,h);return[W[2]/W[8]/ie,W[5]/W[8]/ie]}function fh(e){return[e[0],Math.min(Math.max(e[1],-$e),$e)]}class QV extends ir{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new xo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=ee(this.map._requestManager.transformRequest(this.url,Gn.Image),(n,r)=>{this._imageRequest=null,this._loaded=!0,n?this.fire(new kc(n)):r&&(this.image=r instanceof HTMLImageElement?zt.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Qh(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new xo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Qh||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],n=t[0][1];for(let s of t)s[1]>n&&(n=s[1]),s[1]<i&&(i=s[1]);let r=(n+i)/2;if(r>$e?this.onNorthPole=!0:r<-$e&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let s=t.map(mi.fromLngLat);this.tileID=function(b){let h=1/0,W=1/0,u=-1/0,V=-1/0;for(let B of b)h=Math.min(h,B.x),W=Math.min(W,B.y),u=Math.max(u,B.x),V=Math.max(V,B.y);let F=Math.max(u-h,V-W),U=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),X=Math.pow(2,U),y=Math.floor((h+u)/2*X);return y>1&&(y-=1),new ft(U,y,Math.floor((W+V)/2*X))}(s),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new xo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(let S in this.tiles){let A=this.tiles[S];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=Gm(new ft(0,0,0),this.map.transform.projection),n=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(S){let A=S[1].x-S[0].x,D=S[1].y-S[0].y,O=S[2].x-S[1].x,et=S[2].y-S[1].y,$=S[3].x-S[2].x,nt=S[3].y-S[2].y,dt=S[0].x-S[3].x,ht=S[0].y-S[3].y,gt=A*et-O*D,pt=O*nt-$*et,xt=$*ht-dt*nt,kt=dt*D-A*ht;return gt>0&&pt>0&&xt>0&&kt>0||gt<0&&pt<0&&xt<0&&kt<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let r=Gm(this.tileID,this.map.transform.projection),[s,b,h,W]=this.coordinates.map(S=>{let A=r.projection.project(S[0],S[1]);return XV(r,A)._round()});this.perspectiveTransform=kV(s.x,s.y,b.x,b.y,h.x,h.y,W.x,W.y);let u=this._boundsArray=new Sl;u.emplaceBack(s.x,s.y,0,0),u.emplaceBack(b.x,b.y,ie,0),u.emplaceBack(W.x,W.y,0,ie),u.emplaceBack(h.x,h.y,ie,ie),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(u,t1.members),this.boundsSegments=da.simpleSegment(0,0,4,2);let V=[],F=[fh((U=this.coordinates)[0]),fh(U[1]),fh(U[2]),fh(U[3])];var U;let[X,y,B,k]=function(S){let A=S[0][0],D=A,O=S[0][1],et=O;for(let $=1;$<S.length;$++)S[$][0]<A?A=S[$][0]:S[$][0]>D&&(D=S[$][0]),S[$][1]<O?O=S[$][1]:S[$][1]>et&&(et=S[$][1]);return[A,O,D-A,et-O]}(F);{let S=new Sl,[A,D,O,et]=function(Bt){let _t=Bt[0].x,Qt=_t,be=Bt[0].y,ne=be;for(let vt=1;vt<Bt.length;vt++)Bt[vt].x<_t?_t=Bt[vt].x:Bt[vt].x>Qt&&(Qt=Bt[vt].x),Bt[vt].y<be?be=Bt[vt].y:Bt[vt].y>ne&&(ne=Bt[vt].y);return[_t,be,Qt-_t,ne-be]}(n),$=Bt=>[(Bt.x-A)/O,(Bt.y-D)/et],[nt,dt,ht,gt]=n.map($),pt=function(Bt,_t,Qt,be,ne,vt,Xe,Ve){let ce=Sh(0,0,1,0,1,1,0,1),Lt=Sh(Bt,_t,Qt,be,ne,vt,Xe,Ve),xe=o.co.adjoint([],Lt);return o.co.multiply(ce,ce,xe)}(nt[0],nt[1],dt[0],dt[1],ht[0],ht[1],gt[0],gt[1]);this.elevatedGlobePerspectiveTransform=kV(nt[0],nt[1],dt[0],dt[1],ht[0],ht[1],gt[0],gt[1]);let xt=(Bt,_t)=>{V.push(Bt.lng);let Qt=Math.round((Bt.lng-X)/B*ie),be=Math.round((Bt.lat-y)/k*ie),ne=$(_t),vt=o.N.transformMat3([],[ne[0],ne[1],1],pt),Xe=Math.round(vt[0]/vt[2]*ie),Ve=Math.round(vt[1]/vt[2]*ie);S.emplaceBack(Qt,be,Xe,Ve)},kt=n[3].x-n[0].x,Ft=n[3].y-n[0].y,Ct=n[2].x-n[1].x,Rt=n[2].y-n[1].y;for(let Bt=0;Bt<65;Bt++){let _t=Bt/64,Qt=[n[0].x+_t*kt,n[0].y+_t*Ft],be=[n[1].x+_t*Ct,n[1].y+_t*Rt],ne=be[0]-Qt[0],vt=be[1]-Qt[1];for(let Xe=0;Xe<65;Xe++){let Ve=Xe/64,ce={x:Qt[0]+ne*Ve,y:Qt[1]+vt*Ve,z:0};xt(i.projection.unproject(ce.x,ce.y),ce)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(S,t1.members)}{this.maxLongitudeTriangleSize=0;let S=[],A=new Qa,D=(O,et,$)=>{A.emplaceBack(O,et,$);let nt=V[O],dt=V[et],ht=V[$],gt=Math.min(Math.min(nt,dt),ht),pt=Math.max(Math.max(nt,dt),ht)-gt;pt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pt),S.push(gt+pt/2)};for(let O=0;O<64;O++)for(let et=0;et<64;et++){let $=65*O+et,nt=$+1,dt=$+65,ht=dt+1;D($,dt,nt),D(nt,dt,ht)}[S,A]=function(O,et){let $=Array.from({length:O.length},(ht,gt)=>gt);$.sort((ht,gt)=>O[ht]-O[gt]);let nt=[],dt=new Qa;for(let ht=0;ht<$.length;ht++){let gt=$[ht];nt.push(O[gt]);let pt=3*gt,xt=pt+1;dt.emplaceBack(et.uint16[pt],et.uint16[xt],et.uint16[xt+1])}return[nt,dt]}(S,A),this.elevatedGlobeTrianglesCenterLongitudes=S,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(A)}this.elevatedGlobeSegments=da.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/ie,0,k/ie,0,0,y,X,0])}prepare(){let t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;let i=this.map.painter.context,n=i.gl;!this._dirty||this.texture instanceof Qh||(this.texture?this.texture.update(this.image):(this.texture=new e1(i,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let n=this.elevatedGlobeTrianglesCenterLongitudes,r=((V,F)=>V+360*Math.round((F-V)/360))(t+180,n[0]),s=new da,b=(V,F)=>{s.segments.push({vertexOffset:0,primitiveOffset:V,vertexLength:i.segments[0].vertexLength,primitiveLength:F,sortKey:void 0,vaos:{}})},h=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-r)<=h){let V=Yt(n,0,n.length,r+h);return V===n.length||b(V,st(n,V+1,n.length,r+360-h)-V),s}r<n[0]&&(r+=360);let W=st(n,0,n.length,r-h);if(W===n.length)return b(0,n.length),s;b(0,W-0);let u=Yt(n,W+1,n.length,r+h);return u!==n.length&&b(u,n.length-u),s}}let jN=(Math.pow(256,2)-1)/16907520;class SV extends xn{constructor(t,i,n){super(t,HN,i,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(t){return!(t&&t._source instanceof QV&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[n,r]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(r)||n===this._curRampRange[0]&&r===this._curRampRange[1]||(this.colorRamp=cm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:r}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,r])}}let ON=new ea({visibility:new jt(ut["layout_raster-particle"].visibility)});var DN={paint:new ea({"raster-particle-array-band":new jt(ut["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new jt(ut["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new fo(ut["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new jt(ut["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new jt(ut["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new jt(ut["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new jt(ut["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:ON};class fV extends xn{constructor(t,i,n){super(t,DN,i,n),this._updateColorRamp(),this.onRemove=r=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&r.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=zt.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let t=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=cm({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=zt.now()}}class _N extends xn{constructor(t,i){super(t,{},i),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}let PN=new ea({visibility:new jt(ut.layout_sky.visibility)});var KN={paint:new ea({"sky-type":new jt(ut.paint_sky["sky-type"]),"sky-atmosphere-sun":new jt(ut.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jt(ut.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jt(ut.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jt(ut.paint_sky["sky-gradient-radius"]),"sky-gradient":new fo(ut.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jt(ut.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jt(ut.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jt(ut.paint_sky["sky-opacity"])}),layout:PN};function i1(e,t,i){let n=[0,0,1],r=o.bi.identity([]);return o.bi.rotateY(r,r,i?-ye(e)+Math.PI:ye(e)),o.bi.rotateX(r,r,-ye(t)),o.N.transformQuat(n,n,r),o.N.normalize(n,n)}var qN={paint:new ea({})};function vV(e,t){let i=vh(e.projection,e.zoom,e.width,e.height),n=function(s,b,h,W,u){let V=new mt(h.lng-180*kr,h.lat),F=new mt(h.lng+180*kr,h.lat),U=s.project(V.lng,V.lat),X=s.project(F.lng,F.lat),y=-Math.atan2(X.y-U.y,X.x-U.x),B=mi.fromLngLat(h);B.y=ke(B.y,-1+kr,1-kr);let k=B.toLngLat(),S=s.project(k.lng,k.lat),A=mi.fromLngLat(k);A.x+=kr;let D=A.toLngLat(),O=s.project(D.lng,D.lat),et=wV(O.x-S.x,O.y-S.y,y),$=mi.fromLngLat(k);$.y+=kr;let nt=$.toLngLat(),dt=s.project(nt.lng,nt.lat),ht=wV(dt.x-S.x,dt.y-S.y,y),gt=Math.abs(et.x)/Math.abs(ht.y),pt=o.a6.identity([]);o.a6.rotateZ(pt,pt,-y*(1-(u?0:W)));let xt=o.a6.identity([]);return o.a6.scale(xt,xt,[1,1-(1-gt)*W,1]),xt[4]=-ht.x/ht.y*W,o.a6.rotateZ(xt,xt,y),o.a6.multiply(xt,pt,xt),xt}(e.projection,0,e.center,i,t),r=LV(e);return o.a6.scale(n,n,[r,r,1]),n}function LV(e){let t=e.projection,i=vh(e.projection,e.zoom,e.width,e.height),n=zV(t,e.center),r=zV(t,mt.convert(t.center));return Math.pow(2,n*i+(1-i)*r)}function vh(e,t,i,n,r=1/0){let s=e.range;if(!s)return 0;let b=Math.min(r,Math.max(i,n)),h=Math.log(b/1024)/Math.LN2;return Ba(s[0]+h,s[1]+h,t)}let kr=1/4e4;function zV(e,t){let i=ke(t.lat,-$e,$e),n=new mt(t.lng-180*kr,i),r=new mt(t.lng+180*kr,i),s=e.project(n.lng,i),b=e.project(r.lng,i),h=mi.fromLngLat(n),W=mi.fromLngLat(r),u=b.x-s.x,V=b.y-s.y,F=W.x-h.x,U=W.y-h.y,X=Math.sqrt((F*F+U*U)/(u*u+V*V));return Math.log(X)/Math.LN2}function wV(e,t,i){let n=Math.cos(i),r=Math.sin(i);return{x:e*n-t*r,y:e*r+t*n}}function EV(e,t,i){o.a6.identity(e),o.a6.rotateZ(e,e,ye(t[2])),o.a6.rotateX(e,e,ye(t[0])),o.a6.rotateY(e,e,ye(t[1])),o.a6.scale(e,e,i),o.a6.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Lh(e,t,i,n,r,s,b,h){let W=[i[0]-t[0],i[1]-t[1],0],u=[n[0]-t[0],n[1]-t[1],0];if(o.N.length(W)<1e-12||o.N.length(u)<1e-12)return o.bi.identity(e);let V=o.N.cross([],W,u);o.N.normalize(V,V),o.N.subtract(u,n,t),W[2]=(s-r)*h,u[2]=(b-r)*h;let F=W;return o.N.cross(F,W,u),o.N.normalize(F,F),o.bi.rotationTo(e,V,F)}function a1(e,t,i=!1){let n=Xr(t.zoom),r=function(s,b,h){let W=b.worldSize,u=[s[12],s[13],s[14]],V=si(u[1]/W),F=Qe(u[0]/W),U=o.a6.identity([]),X=fe(1,V)*W,y=fe(1,0)*W*ti(V,b.zoom),B=1/YW(W),k=y*B;if(h){let O=vh(b.projection,b.zoom,b.width,b.height,1024);k=B*b.projection.pixelSpaceConversion(b.center.lat,W,O)}let S=It(V,F);o.N.add(S,S,o.N.scale([],o.N.normalize([],S),X*k*u[2]));let A=function(O){let et=[O[0],O[1],O[2]],$=[0,1,0],nt=o.N.cross([],$,et);return o.N.cross($,et,nt),o.N.squaredLength($)===0&&($=[0,1,0],o.N.cross(nt,et,$)),o.N.normalize(nt,nt),o.N.normalize($,$),o.N.normalize(et,et),[nt[0],nt[1],nt[2],0,$[0],$[1],$[2],0,et[0],et[1],et[2],0,O[0],O[1],O[2],1]}(S);o.a6.scale(U,U,[k,k,k*X]),o.a6.translate(U,U,[-u[0],-u[1],-u[2]]);let D=o.a6.multiply([],b.globeMatrix,A);return o.a6.multiply(D,D,U),o.a6.multiply(D,D,s),D}(e,t,i);if(n>0){let s=function(b,h){let W=h.worldSize,u=fe(1,0)*W*ti(h.center.lat,h.zoom)/YW(W),V=fe(1,h.center.lat)*W,F=o.a6.identity([]);return o.a6.rotateY(F,F,ye(h.center.lng)),o.a6.rotateX(F,F,ye(h.center.lat)),o.a6.translate(F,F,[0,0,H]),o.a6.scale(F,F,[u,u,u*V]),o.a6.translate(F,F,[h.point.x-.5*W,h.point.y-.5*W,0]),o.a6.multiply(F,F,b),o.a6.multiply(F,h.globeMatrix,F)}(e,t);return function(b,h,W){let u=(y,B,k)=>{let S=o.N.length(y),A=o.N.length(B),D=Ho(y,B,k);return o.N.scale(D,D,1/o.N.length(D)*li(S,A,k))},V=u([b[0],b[1],b[2]],[h[0],h[1],h[2]],W),F=u([b[4],b[5],b[6]],[h[4],h[5],h[6]],W),U=u([b[8],b[9],b[10]],[h[8],h[9],h[10]],W),X=Ho([b[12],b[13],b[14]],[h[12],h[13],h[14]],W);return[V[0],V[1],V[2],0,F[0],F[1],F[2],0,U[0],U[1],U[2],0,X[0],X[1],X[2],1]}(r,s,n)}return r}function AV(e,t,i,n){let r=ra.projectAabbCorners(n,i),s=Number.MAX_VALUE,b=-1;for(let u=0;u<r.length;++u){let V=r[u];V[0]=(.5*V[0]+.5)*t.width,V[1]=(.5-.5*V[1])*t.height,V[2]<s&&(b=u,s=V[2])}let h=u=>new Nt(r[u][0],r[u][1]),W;switch(b){case 0:case 6:W=[h(1),h(5),h(4),h(7),h(3),h(2),h(1)];break;case 1:case 7:W=[h(0),h(4),h(5),h(6),h(2),h(3),h(0)];break;case 3:case 5:W=[h(1),h(0),h(4),h(7),h(6),h(2),h(1)];break;default:W=[h(1),h(5),h(6),h(7),h(3),h(0),h(1)]}if(Il(e,W))return s}let $N=Ni([{name:"a_pos_3f",components:3,type:"Float32"}]),tY=Ni([{name:"a_color_3f",components:3,type:"Float32"}]),eY=Ni([{name:"a_color_4f",components:4,type:"Float32"}]),iY=Ni([{name:"a_uv_2f",components:2,type:"Float32"}]),aY=Ni([{name:"a_normal_3f",components:3,type:"Float32"}]),nY=Ni([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),lY=Ni([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class HV{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class jV{constructor(){this.instancedDataArray=new em,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class n1{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,i,n,r){this.tileToMeter=ei(n);let s=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:b,id:h,index:W,sourceLayerIndex:u}of t){let V=xa(b,s);if(!this.layers[0]._featureFilter.filter(new ta(this.zoom),V,n))continue;let F={id:h,sourceLayerIndex:u,index:W,geometry:s?V.geometry:fa(b,n,r),properties:b.properties,type:b.type,patterns:{}},U=this.addFeature(F,F.geometry,V);U&&i.featureIndex.insert(b,F.geometry,W,u,this.index,this.instancesPerModel[U].instancedDataArray.length,ie/32)}this.lookup=null}update(t,i,n,r){for(let s in this.instancesPerModel){let b=this.instancesPerModel[s];for(let h in t)b.idToFeaturesIndex.hasOwnProperty(h)&&this.evaluate(b.features[b.idToFeaturesIndex[h]],t[h],b,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(let i in this.instancesPerModel){let n=this.instancesPerModel[i];for(let r of n.features){let s=this.layers[0],b=r.feature,h=this.canonical,W=s.paint.get("model-rotation").evaluate(b,{},h),u=s.paint.get("model-scale").evaluate(b,{},h),V=s.paint.get("model-translation").evaluate(b,{},h);o.N.exactEquals(r.rotation,W)&&o.N.exactEquals(r.scale,u)&&o.N.exactEquals(r.translation,V)||(this.evaluate(r,r.featureStates,n,!0),t=!0)}}return t}isEmpty(){for(let t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(let i in this.instancesPerModel){let n=this.instancesPerModel[i];n.instancedDataArray.length<0||n.instancedDataArray.length===0||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=t.createVertexBuffer(n.instancedDataArray,nY.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let t in this.instancesPerModel){let i=this.instancesPerModel[t];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(t,i,n){let r=this.layers[0],s=r.layout.get("model-id").evaluate(n,{},this.canonical);if(!s)return ji("modelId is not evaluated for layer ".concat(r.id," and it is not going to get rendered.")),s;this.instancesPerModel[s]||(this.instancesPerModel[s]=new jV);let b=this.instancesPerModel[s],h=b.instancedDataArray,W=new HV(n,h.length);for(let u of i)for(let V of u){if(V.x<0||V.x>=ie||V.y<0||V.y>=ie)continue;let F=(this.lookupDim-1)/ie,U=this.lookupDim*(V.y*F|0)+V.x*F|0;if(this.lookup){if(this.lookup[U]!==0)continue;this.lookup[U]=1}this.instanceCount++;let X=h.length;h.resize(X+1),b.instancesEvaluatedElevation.push(0),h.float32[16*X]=V.x,h.float32[16*X+1]=V.y}return W.instancedDataCount=b.instancedDataArray.length-W.instancedDataOffset,W.instancedDataCount>0&&(t.id&&(b.idToFeaturesIndex[t.id]=b.features.length),b.features.push(W),this.evaluate(W,{},b,!1)),s}evaluate(t,i,n,r){let s=this.layers[0],b=t.feature,h=this.canonical,W=t.rotation=s.paint.get("model-rotation").evaluate(b,i,h),u=t.scale=s.paint.get("model-scale").evaluate(b,i,h),V=t.translation=s.paint.get("model-translation").evaluate(b,i,h),F=s.paint.get("model-color").evaluate(b,i,h);F.a=s.paint.get("model-color-mix-intensity").evaluate(b,i,h);let U=[];this.maxVerticalOffset<V[2]&&(this.maxVerticalOffset=V[2]),this.maxScale=Math.max(Math.max(this.maxScale,u[0]),Math.max(u[1],u[2])),EV(U,W,u);let X=Math.round(100*F.a)+F.b/1.05;for(let y=0;y<t.instancedDataCount;++y){let B=t.instancedDataOffset+y,k=16*B,S=n.instancedDataArray.float32,A=0;r&&(A=S[k+6]-n.instancesEvaluatedElevation[B]);let D=0|S[k+1];S[k]=(0|S[k])+F.r/1.05,S[k+1]=D+F.g/1.05,S[k+2]=X,S[k+3]=1/(h.z>10?this.tileToMeter:ei(h,D)),S[k+4]=V[0],S[k+5]=V[1],S[k+6]=V[2]+A,S[k+7]=U[0],S[k+8]=U[1],S[k+9]=U[2],S[k+10]=U[4],S[k+11]=U[5],S[k+12]=U[6],S[k+13]=U[8],S[k+14]=U[9],S[k+15]=U[10],n.instancesEvaluatedElevation[B]=V[2]}}}se(n1,"ModelBucket",{omit:["layers"]}),se(jV,"PerModelAttributes"),se(HV,"ModelFeature");let oY=new ea({visibility:new jt(ut.layout_model.visibility),"model-id":new Ue(ut.layout_model["model-id"])});var rY={paint:new ea({"model-opacity":new jt(ut.paint_model["model-opacity"]),"model-rotation":new Ue(ut.paint_model["model-rotation"]),"model-scale":new Ue(ut.paint_model["model-scale"]),"model-translation":new Ue(ut.paint_model["model-translation"]),"model-color":new Ue(ut.paint_model["model-color"]),"model-color-mix-intensity":new Ue(ut.paint_model["model-color-mix-intensity"]),"model-type":new jt(ut.paint_model["model-type"]),"model-cast-shadows":new jt(ut.paint_model["model-cast-shadows"]),"model-receive-shadows":new jt(ut.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new jt(ut.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ue(ut.paint_model["model-emissive-strength"]),"model-roughness":new Ue(ut.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ue(ut.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new jt(ut.paint_model["model-cutoff-fade-range"])}),layout:oY};let Es=64,rc={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function OV(e,t,i,n,r,s,b,h,W,u=!1){let V=i.zoom,F=i.project(n),U=ti(n.lat,V),X=1/U;o.a6.identity(e),o.a6.translate(e,e,[F.x+b[0]*X,F.y+b[1]*X,b[2]]);let y=1,B=1,k=i.worldSize;if(u){if(i.projection.name==="mercator"){let O=0;i.elevation&&(O=i.elevation.getAtPointOrZero(new mi(F.x/k,F.y/k),0));let et=o.a7.transformMat4([],[F.x,F.y,O,1],i.projMatrix)[3]/i.cameraToCenterDistance;y=et,B=et*ti(i.center.lat,V)}else if(i.projection.name==="globe"){let O=a1(e,i),et=o.a6.multiply([],i.projMatrix,O),$=[0,0,0,1];o.a7.transformMat4($,$,et);let nt=$[3]/i.cameraToCenterDistance,dt=Xr(V),ht=i.projection.pixelsPerMeter(n.lat,k)*ti(n.lat,V),gt=i.projection.pixelsPerMeter(i.center.lat,k)*ti(i.center.lat,V);y=nt/li(ht,ia(i.center.lat),dt),B=nt*U/ht,y*=gt,B*=gt}}else y=X;o.a6.scale(e,e,[y,y,B]);let S=[...e],A=t.orientation,D=[];if(EV(D,[A[0]+r[0],A[1]+r[1],A[2]+r[2]],s),o.a6.multiply(e,S,D),h&&i.elevation){let O=0,et=[];if(W&&i.elevation){O=function(dt,ht,gt,pt,xt){let kt=ht.elevation;if(!kt)return 0;let Ft=ra.projectAabbCorners(gt,pt),Ct=fe(1,xt.lat)*ht.worldSize,Rt=function(xe,Oe){let Je=[0,0,1],De=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Te of De){let oi=xe[Te.corners[0]],ve=xe[Te.corners[1]],Qi=xe[Te.corners[2]],Wi=[ve[0]-oi[0],ve[1]-oi[1],Oe*(ve[2]-oi[2])],gi=o.N.cross(Wi,Wi,[Qi[0]-oi[0],Qi[1]-oi[1],Oe*(Qi[2]-oi[2])]);o.N.normalize(gi,gi),Te.dotProductWithUp=o.N.dot(gi,Je)}return De.sort((Te,oi)=>Te.dotProductWithUp-oi.dotProductWithUp),De[0].corners}(Ft,Ct),Bt=Ft[Rt[0]],_t=Ft[Rt[1]],Qt=Ft[Rt[2]],be=Ft[Rt[3]],ne=kt.getAtPointOrZero(new mi(Bt[0]/ht.worldSize,Bt[1]/ht.worldSize),0),vt=kt.getAtPointOrZero(new mi(_t[0]/ht.worldSize,_t[1]/ht.worldSize),0),Xe=kt.getAtPointOrZero(new mi(Qt[0]/ht.worldSize,Qt[1]/ht.worldSize),0),Ve=kt.getAtPointOrZero(new mi(be[0]/ht.worldSize,be[1]/ht.worldSize),0),ce=(ne+Ve)/2,Lt=(vt+Xe)/2;return ce>Lt?vt<Xe?Lh(dt,_t,be,Bt,vt,Ve,ne,Ct):Lh(dt,Qt,Bt,be,Xe,ne,Ve,Ct):ne<Ve?Lh(dt,Bt,_t,Qt,ne,vt,Xe,Ct):Lh(dt,be,Qt,_t,Ve,Xe,vt,Ct),Math.max(ce,Lt)}(et,i,t.aabb,e,n);let $=o.a6.fromQuat([],et),nt=o.a6.multiply([],$,D);o.a6.multiply(e,S,nt)}else O=i.elevation.getAtPointOrZero(new mi(F.x/k,F.y/k),0);O!==0&&(e[14]+=O)}}function Nm(e,t,i=!1){e.uploaded||(e.gfxTexture=new e1(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function sY(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,$N.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,aY.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,iY.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?tY:eY).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,lY.members,!0)),e.segments=da.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);let n=e.material;n.pbrMetallicRoughness.baseColorTexture&&Nm(n.pbrMetallicRoughness.baseColorTexture,t),n.pbrMetallicRoughness.metallicRoughnessTexture&&Nm(n.pbrMetallicRoughness.metallicRoughnessTexture,t),n.normalTexture&&Nm(n.normalTexture,t),n.occlusionTexture&&Nm(n.occlusionTexture,t,i),n.emissionTexture&&Nm(n.emissionTexture,t)}function l1(e,t,i){if(e.meshes)for(let n of e.meshes)sY(n,t,i);if(e.children)for(let n of e.children)l1(n,t,i)}function zh(e){if(e.meshes)for(let t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(let t of e.children)zh(t)}function o1(e){if(e.meshes)for(let i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(let i of e.children)o1(i)}class dY{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class cY{constructor(){this.tasks={},this.taskQueue=[],on(["process"],this),this.invoker=new dY(this.process),this.nextId=0}add(t,i){let n=this.nextId++,r=function({type:s,isSymbolTile:b,zoom:h}){return h=h||0,s==="message"?0:s!=="maybePrepare"||b?s!=="parseTile"||b?s==="parseTile"&&b?300-h:s==="maybePrepare"&&b?400-h:500:200-h:100-h}(i);if(r===0){wn();try{t()}finally{}return null}return this.tasks[n]={fn:t,metadata:i,priority:r,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){wn();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;let t=this.pick();if(t===null)return;let i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let r=0;r<this.taskQueue.length;r++){let s=this.tasks[this.taskQueue[r]];s.priority<i&&(i=s.priority,t=r)}if(t===null)return null;let n=this.taskQueue[t];return this.taskQueue.splice(t,1),n}remove(){this.invoker.remove()}}class DV{constructor(t,i,n){this.target=t,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},on(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new cY}send(t,i,n,r,s=!1,b){let h=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=b,this.callbacks[h]=n);let W=new Set;return this.target.postMessage({id:h,type:t,hasCallback:!!n,targetMapId:r,mustQueue:s,sourceMapId:this.mapId,data:co(i,W)},W),{cancel:()=>{n&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){let i=t.data,n=i.id;if(n&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r.cancel()}else if(i.mustQueue||wn()){let r=this.callbacks[n],s=this.scheduler.add(()=>this.processTask(n,i),r&&r.metadata||{type:"message"});s&&(this.cancelCallbacks[n]=s)}else this.processTask(n,i)}processTask(t,i){if(delete this.cancelCallbacks[t],i.type==="<response>"){let n=this.callbacks[t];delete this.callbacks[t],n&&(i.error?n(Qo(i.error)):n(null,Qo(i.data)))}else{let n=new Set,r=i.hasCallback?(b,h)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:b?co(b):null,data:co(h,n)},n)}:b=>{},s=Qo(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,s,r);else if(this.parent.getWorkerSource){let b=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,b[0],s.source,s.scope)[b[1]](s,r)}else r(new Error("Could not find function ".concat(i.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class sc{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=ul();let n=this.workerPool.acquire(this.id);for(let r=0;r<n.length;r++){let s=new sc.Actor(n[r],i,this.id);s.name="Worker ".concat(r),this.actors.push(s)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,i,n){ln(this.actors,(r,s)=>{r.send(t,i,s)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}sc.Actor=DV;var Ym={workerUrl:"",workerClass:null,workerParams:void 0};function bY(){return Ym.workerClass!=null?new Ym.workerClass:new self.Worker(Ym.workerUrl,Ym.workerParams)}let r1="mapboxgl_preloaded_worker_pool";class Xm{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Xm.workerCount;)this.workers.push(new bY);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[r1]}numActive(){return Object.keys(this.active).length}}let Jm;function wh(){return Jm||(Jm=new Xm),Jm}Xm.workerCount=2;let Eh,s1,Al,dc,d1,cc=null;function _V(){return wn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:s1||lt.DRACO_URL}function PV(){if(wn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(dc)return dc;let e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return dc=WebAssembly.validate(e)?lt.MESHOPT_SIMD_URL:lt.MESHOPT_URL,dc}let Ah={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mY={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ym={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function KV(e,t,i){let n=i.json.bufferViews.length,r=i.buffers.length;t.bufferView=n,i.json.bufferViews[n]={buffer:r,byteLength:e.byteLength},i.buffers[r]=e}let c1="KHR_draco_mesh_compression";function hY(e,t){let i=e.extensions&&e.extensions[c1];if(!i)return;let n=new Al.Decoder,r=eR(t,i.bufferView),s=new Al.Mesh;if(!n.DecodeArrayToMesh(r,r.byteLength,s))throw new Error("Failed to decode Draco mesh");let b=t.json.accessors[e.indices],h=Ah[b.componentType],W=b.count*h.BYTES_PER_ELEMENT,u=Al._malloc(W);h===Uint16Array?n.GetTrianglesUInt16Array(s,W,u):n.GetTrianglesUInt32Array(s,W,u),KV(Al.memory.buffer.slice(u,u+W),b,t),Al._free(u);for(let V of Object.keys(i.attributes)){let F=n.GetAttributeByUniqueId(s,i.attributes[V]),U=t.json.accessors[e.attributes[V]],X=mY[U.componentType],y=U.count*ym[U.type]*Ah[U.componentType].BYTES_PER_ELEMENT,B=Al._malloc(y);n.GetAttributeDataArrayForAllPoints(s,F,Al[X],y,B),KV(Al.memory.buffer.slice(B,B+y),U,t),Al._free(B)}n.destroy(),s.destroy(),delete e.extensions[c1]}let Hh="EXT_meshopt_compression";function pY(e,t){if(!e.extensions||!e.extensions[Hh])return;let i=e.extensions[Hh],n=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),r=new Uint8Array(i.count*i.byteStride);d1.decodeGltfBuffer(r,i.count,i.byteStride,n,i.mode,i.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=r.buffer,delete e.extensions[Hh]}let qV=1179937895,$V=new TextDecoder("utf8");function tR(e,t){return new URL(e,t).href}function WY(e,t,i,n){return fetch(tR(e.uri,n)).then(r=>r.arrayBuffer()).then(r=>{t.buffers[i]=r})}function eR(e,t){let i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function uY(e,t,i,n){if(e.uri){let r=tR(e.uri,n);return fetch(r).then(s=>s.blob()).then(s=>createImageBitmap(s)).then(s=>{t.images[i]=s})}if(e.bufferView!==void 0){let r=eR(t,e.bufferView),s=new Blob([r],{type:e.mimeType});return createImageBitmap(s).then(b=>{t.images[i]=b})}}function iR(e,t=0,i){let n={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===qV){let V=new Uint32Array(e,t),F=2,U=(V[F++]>>2)-3,X=V[F++]>>2;if(F++,n.json=JSON.parse($V.decode(V.subarray(F,F+X))),F+=X,F<U){let y=V[F++];F++;let B=t+(F<<2);n.buffers[0]=e.slice(B,B+y)}}else n.json=JSON.parse($V.decode(new Uint8Array(e,t)));let{buffers:r,images:s,meshes:b,extensionsUsed:h,bufferViews:W}=n.json,u=Promise.resolve();if(r){let V=[];for(let F=0;F<r.length;F++){let U=r[F];U.uri?V.push(WY(U,n,F,i)):n.buffers[F]||(n.buffers[F]=null)}u=Promise.all(V)}return u.then(()=>{let V=[],F=h&&h.includes(c1),U=h&&h.includes(Hh);if(F&&V.push(function(){if(!Al)return Eh||(Eh=function(X){let y,B=null;function k(){y=new Uint8Array(B.buffer)}function S(){throw new Error("Unexpected Draco error.")}let A={a:{a:S,d:function(D,O,et){return y.copyWithin(D,O,O+et)},c:function(D){let O=y.length,et=Math.max(D>>>0,Math.ceil(1.2*O)),$=Math.ceil((et-O)/65536);try{return B.grow($),k(),!0}catch{return!1}},b:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(X,A):X.then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,A))).then(D=>{let{Rb:O,Qb:et,P:$,T:nt,X:dt,Ja:ht,La:gt,Qa:pt,Va:xt,Wa:kt,eb:Ft,jb:Ct,f:Rt,e:Bt,yb:_t,zb:Qt,Ab:be,Bb:ne,Db:vt,Gb:Xe}=D.instance.exports;B=Bt;let Ve=(()=>{let ce=0,Lt=0,xe=0,Oe=0;return Je=>{xe&&(O(Oe),O(ce),Lt+=xe,xe=ce=0),ce||(Lt+=128,ce=et(Lt));let De=Je.length+7&-8,Te=ce;De>=Lt&&(xe=De,Te=Oe=et(De));for(let oi=0;oi<Je.length;oi++)y[Te+oi]=Je[oi];return Te}})();return k(),Rt(),{memory:Bt,_free:O,_malloc:et,Mesh:class{constructor(){this.ptr=$()}destroy(){nt(this.ptr)}},Decoder:class{constructor(){this.ptr=ht()}destroy(){Ct(this.ptr)}DecodeArrayToMesh(ce,Lt,xe){let Oe=Ve(ce),Je=gt(this.ptr,Oe,Lt,xe.ptr);return!!dt(Je)}GetAttributeByUniqueId(ce,Lt){return{ptr:pt(this.ptr,ce.ptr,Lt)}}GetTrianglesUInt16Array(ce,Lt,xe){xt(this.ptr,ce.ptr,Lt,xe)}GetTrianglesUInt32Array(ce,Lt,xe){kt(this.ptr,ce.ptr,Lt,xe)}GetAttributeDataArrayForAllPoints(ce,Lt,xe,Oe,Je){Ft(this.ptr,ce.ptr,Lt.ptr,xe,Oe,Je)}},DT_INT8:_t(),DT_UINT8:Qt(),DT_INT16:be(),DT_UINT16:ne(),DT_UINT32:vt(),DT_FLOAT32:Xe()}})}(fetch(_V())),Eh.then(X=>{Al=X,Eh=void 0}))}()),U&&V.push(function(){if(d1)return;let X=function(y){let B,k=WebAssembly.instantiateStreaming(y,{}).then(D=>{B=D.instance,B.exports.__wasm_call_ctors()}),S={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},A={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer(D,O,et,$,nt,dt){(function(ht,gt,pt,xt,kt,Ft,Ct){let Rt=ht.exports.sbrk,Bt=xt+3&-4,_t=Rt(Bt*kt),Qt=Rt(Ft.length),be=new Uint8Array(ht.exports.memory.buffer);be.set(Ft,Qt);let ne=gt(_t,xt,kt,Qt,Ft.length);if(ne===0&&Ct&&Ct(_t,Bt,kt),pt.set(be.subarray(_t,_t+xt*kt)),Rt(_t-Rt(0)),ne!==0)throw new Error("Malformed buffer data: ".concat(ne))})(B,B.exports[A[nt]],D,O,et,$,B.exports[S[dt]])}}}(fetch(PV()));return X.ready.then(()=>{d1=X})}()),s)for(let X=0;X<s.length;X++)V.push(uY(s[X],n,X,i));return(V.length?Promise.all(V):Promise.resolve()).then(()=>{if(F&&b)for(let{primitives:X}of b)for(let y of X)hY(y,n);if(U&&b&&W)for(let X of W)pY(X,n);return n})})}class aR{constructor(t,i,n){if(this.triangleCount=i.length/3,this.min=new Nt(0,0),this.max=new Nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||n===0)return;let r=t.map(V=>V.x),s=t.map(V=>V.y);this.min=new Nt(Math.min(...r),Math.min(...s)),this.max=new Nt(Math.max(...r),Math.max(...s));let b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);let h=Math.max(b.x,b.y)/n;this.cellsX=Math.max(1,Math.ceil(b.x/h)),this.cellsY=Math.max(1,Math.ceil(b.y/h)),this.xScale=1/h,this.yScale=1/h;let W=[];for(let V=0;V<this.triangleCount;V++){let F=t[i[3*V+0]].sub(this.min),U=t[i[3*V+1]].sub(this.min),X=t[i[3*V+2]].sub(this.min),y=Qr(Math.floor(Math.min(F.x,U.x,X.x)),this.xScale,this.cellsX),B=Qr(Math.floor(Math.max(F.x,U.x,X.x)),this.xScale,this.cellsX),k=Qr(Math.floor(Math.min(F.y,U.y,X.y)),this.yScale,this.cellsY),S=Qr(Math.floor(Math.max(F.y,U.y,X.y)),this.yScale,this.cellsY),A=new Nt(0,0),D=new Nt(0,0),O=new Nt(0,0),et=new Nt(0,0);for(let $=k;$<=S;++$){A.y=D.y=$*h,O.y=et.y=($+1)*h;for(let nt=y;nt<=B;++nt)A.x=O.x=nt*h,D.x=et.x=(nt+1)*h,(lW(F,U,X,A,D,et)||lW(F,U,X,A,et,O))&&W.push({cellIdx:$*this.cellsX+nt,triIdx:V})}}if(W.length===0)return;W.sort((V,F)=>V.cellIdx-F.cellIdx||V.triIdx-F.triIdx);let u=0;for(;u<W.length;){let V=W[u].cellIdx,F={start:this.payload.length,len:0};for(;u<W.length&&W[u].cellIdx===V;)++F.len,this.payload.push(W[u++].triIdx);this.cells[V]=F}}query(t,i,n){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let W=0;W<this.lookup.length;W++)this.lookup[W]=0;let r=Qr(t.x-this.min.x,this.xScale,this.cellsX),s=Qr(i.x-this.min.x,this.xScale,this.cellsX),b=Qr(t.y-this.min.y,this.yScale,this.cellsY),h=Qr(i.y-this.min.y,this.yScale,this.cellsY);for(let W=b;W<=h;W++)for(let u=r;u<=s;u++){let V=this.cells[W*this.cellsX+u];if(V)for(let F=0;F<V.len;F++){let U=this.payload[V.start+F],X=Math.floor(U/8),y=1<<U%8;if(!(this.lookup[X]&y)&&(this.lookup[X]|=y,n.push(U),n.length===this.triangleCount))return}}}}function Qr(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function As(e,t){let i=e.json.bufferViews[t.bufferView],n=Ah[t.componentType];return new n(e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==ym[t.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:ym[t.type]))}function b1(e,t,i,n){let r=Ah[t.componentType],s=function(V){switch(V){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(r),b=e.json.bufferViews[t.bufferView],h=b.byteStride?b.byteStride/r.BYTES_PER_ELEMENT:ym[t.type],W=i.float32,u=W.length/i.capacity;for(let V=0,F=0;V<t.count*h;V+=h,F+=u)for(let U=0;U<u;U++)W[F+U]=n[V+U]*s;i._trim()}function ZY(e,t,i){let n=e.indices,r=e.attributes,s={};s.indexArray=new Qa;let b=t.json.accessors[n],h=b.count/3;s.indexArray.reserve(h);let W=As(t,b);for(let U=0;U<h;U++)s.indexArray.emplaceBack(W[3*U],W[3*U+1],W[3*U+2]);s.indexArray._trim(),s.vertexArray=new vo;let u=t.json.accessors[r.POSITION];s.vertexArray.reserve(u.count);let V=As(t,u);for(let U=0;U<u.count;U++)s.vertexArray.emplaceBack(V[3*U],V[3*U+1],V[3*U+2]);if(s.vertexArray._trim(),s.aabb=new ra(u.min,u.max),s.centroid=function(U,X){let y=[0,0,0],B=U.length;if(B>0){for(let k=0;k<B;k++){let S=3*U[k];y[0]+=X[S],y[1]+=X[S+1],y[2]+=X[S+2]}y[0]/=B,y[1]/=B,y[2]/=B}return y}(W,V),r.COLOR_0!==void 0){let U=t.json.accessors[r.COLOR_0],X=ym[U.type],y=As(t,U);s.colorArray=X===3?new vo:new po,s.colorArray.resize(U.count),b1(t,U,s.colorArray,y)}if(r.NORMAL!==void 0){s.normalArray=new vo;let U=t.json.accessors[r.NORMAL];s.normalArray.resize(U.count);let X=As(t,U);b1(t,U,s.normalArray,X)}if(r.TEXCOORD_0!==void 0&&i.length>0){s.texcoordArray=new Bs;let U=t.json.accessors[r.TEXCOORD_0];s.texcoordArray.resize(U.count);let X=As(t,U);b1(t,U,s.texcoordArray,X)}if(r._FEATURE_ID_RGBA4444!==void 0){let U=t.json.accessors[r._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(s.featureData=As(t,U))}r._FEATURE_RGBA4444!==void 0&&(s.featureData=new Uint32Array(As(t,t.json.accessors[r._FEATURE_RGBA4444]).buffer));let F=e.material;return s.material=function(U,X){let{emissiveFactor:y=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:k=.5,normalTexture:S,occlusionTexture:A,emissiveTexture:D,doubleSided:O}=U,{baseColorFactor:et=[1,1,1,1],metallicFactor:$=1,roughnessFactor:nt=1,baseColorTexture:dt,metallicRoughnessTexture:ht}=U.pbrMetallicRoughness||{},gt=A?X[A.index]:void 0;if(A&&A.extensions&&A.extensions.KHR_texture_transform&&gt){let pt=A.extensions.KHR_texture_transform;gt.offsetScale=[pt.offset[0],pt.offset[1],pt.scale[0],pt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ga(...et),metallicFactor:$,roughnessFactor:nt,baseColorTexture:dt?X[dt.index]:void 0,metallicRoughnessTexture:ht?X[ht.index]:void 0},doubleSided:O,emissiveFactor:y,alphaMode:B,alphaCutoff:k,normalTexture:S?X[S.index]:void 0,occlusionTexture:gt,emissionTexture:D?X[D.index]:void 0,defined:U.defined===void 0}}(F!==void 0?t.json.materials[F]:{defined:!1},i),s}function nR(e,t,i){let{matrix:n,rotation:r,translation:s,scale:b,mesh:h,extras:W,children:u}=e,V={};if(V.matrix=n||o.a6.fromRotationTranslationScale([],r||[0,0,0,1],s||[0,0,0],b||[1,1,1]),h!==void 0){V.meshes=i[h];let F=V.anchor=[0,0];for(let U of V.meshes){let{min:X,max:y}=U.aabb;F[0]+=X[0]+y[0],F[1]+=X[1]+y[1]}F[0]=Math.floor(F[0]/V.meshes.length/2),F[1]=Math.floor(F[1]/V.meshes.length/2)}if(W&&(W.id&&(V.id=W.id),W.lights&&(V.lights=function(F){if(!F.length)return[];let U=function(S){let A=atob(S),D=new Uint8Array(A.length);for(let O=0;O<A.length;O++)D[O]=A.codePointAt(O);return D}(F),X=[],y=U.length/24,B=new Uint16Array(U.buffer),k=new Float32Array(U.buffer);for(let S=0;S<y;S++){let A=B[2*S*6]/30,D=B[2*S*6+1]/30,O=B[2*S*6+10]/100,et=k[6*S+1],$=k[6*S+2],nt=k[6*S+3],dt=k[6*S+4],ht=nt-et,gt=dt-$,pt=Math.hypot(ht,gt);X.push({pos:[et+.5*ht,$+.5*gt,D],normal:[gt/pt,-ht/pt,0],width:pt,height:A,depth:O,points:[et,$,nt,dt]})}return X}(W.lights))),u){let F=[];for(let U of u)F.push(nR(t.json.nodes[U],t,i));V.children=F}return V}function gY(e){if(e.vertices.length===0||e.indices.length===0)return null;let[t,i]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let b=1;b<e.vertices.length;++b){let h=e.vertices[b];t.x=Math.min(t.x,h.x),t.y=Math.min(t.y,h.y),i.x=Math.max(i.x,h.x),i.y=Math.max(i.y,h.y)}let n=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),r=Math.max(8,n),s=new aR(e.vertices,e.indices,r);return{vertices:e.vertices,indices:e.indices,grid:s,min:t,max:i}}function VY(e){if(!e.extras||!e.extras.ground)return null;let t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;let i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;let n=[];for(let b of i){if(!Array.isArray(b)||b.length!==2)continue;let h=b[0],W=b[1];typeof h=="number"&&typeof W=="number"&&n.push(new Nt(h,W))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let r=0;for(let b=0;b<n.length;b++){let h=n[b],W=n[(b+1)%n.length],u=n[(b+2)%n.length];r+=(h.x-W.x)*(u.y-W.y)-(u.x-W.x)*(h.y-W.y)}r>0&&n.reverse();let s=mh(n.flatMap(b=>[b.x,b.y]),[]);return s.length===0?null:{vertices:n,indices:s}}function RY(e){let t=[],i=[],n=0;for(let r of e){n=t.length;let s=r.vertexArray.float32,b=r.indexArray.uint16;for(let h=0;h<r.vertexArray.length;h++)t.push(new Nt(s[3*h+0],s[3*h+1]));for(let h=0;h<3*r.indexArray.length;h++)i.push(b[h]+n)}if(i.length%3!=0)return null;for(let r=0;r<i.length;r+=3){let s=t[i[r+0]],b=t[i[r+1]],h=t[i[r+2]];(s.x-b.x)*(h.y-b.y)-(h.x-b.x)*(s.y-b.y)>0&&([i[r+1],i[r+2]]=[i[r+2],i[r+1]])}return{vertices:t,indices:i}}function lR(e){let t=function(W,u){let V=[],F=WebGL2RenderingContext;if(W.json.textures)for(let U of W.json.textures){let X={magFilter:F.LINEAR,minFilter:F.NEAREST,wrapS:F.REPEAT,wrapT:F.REPEAT};U.sampler!==void 0&&Object.assign(X,W.json.samplers[U.sampler]),V.push({image:u[U.source],sampler:X,uploaded:!1})}return V}(e,e.images),i=function(W,u){let V=[];for(let F of W.json.meshes){let U=[];for(let X of F.primitives)U.push(ZY(X,W,u));V.push(U)}return V}(e,t),{scenes:n,scene:r,nodes:s}=e.json,b=n?n[r||0].nodes:s,h=[];for(let W of b)h.push(nR(s[W],e,i));return function(W,u,V){let F={},U=new Set;for(let X=0;X<W.length;X++){let y=V[u[X]];if(!y.extras)continue;let B=y.extras["mapbox:footprint:version"],k=y.extras["mapbox:footprint:id"];(B||k)&&U.add(X),B==="1.0.0"&&k&&(F[k]=X)}for(let X=0;X<W.length;X++){if(U.has(X))continue;let y=W[X],B=V[u[X]];if(!B.extras)continue;let k=null;y.id in F&&(k=RY(W[F[y.id]].meshes)),k||(k=VY(B)),k&&(y.footprint=gY(k))}if(U.size>0){let X=Array.from(U.values()).sort((y,B)=>y-B);for(let y=X.length-1;y>=0;y--)W.splice(X[y],1)}}(h,b,e.json.nodes),h}function GY(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);let t=e.vertexArray.float32,i=e.aabb.min[0]-1,n=e.aabb.min[1]-1,r=Es/(e.aabb.max[0]-i+2),s=Es/(e.aabb.max[1]-n+2);for(let b=0;b<t.length;b+=3){let h=t[b+2],W=(t[b+0]-i)*r|0,u=(t[b+1]-n)*s|0;h>e.heightmap[u*Es+W]&&(e.heightmap[u*Es+W]=h)}}function FY(e,t){let i={};i.indexArray=new Qa,i.indexArray.reserve(4*e.length),i.vertexArray=new vo,i.vertexArray.reserve(10*e.length),i.colorArray=new po,i.vertexArray.reserve(10*e.length);let n=0;for(let b of e){let h=Math.min(10,Math.max(4,1.3*b.height))*t,W=[-b.normal[1],b.normal[0],0],u=Math.min(.29,.1*b.width/b.depth),V=b.width-2*b.depth*t*(u+.01),F=o.N.scaleAndAdd([],b.pos,W,V/2),U=o.N.scaleAndAdd([],b.pos,W,-V/2),X=[F[0],F[1],F[2]+b.height],y=[U[0],U[1],U[2]+b.height],B=o.N.scaleAndAdd([],b.normal,W,u);o.N.scale(B,B,h);let k=o.N.scaleAndAdd([],b.normal,W,-u);o.N.scale(k,k,h),o.N.add(B,F,B),o.N.add(k,U,k),F[2]+=.1,U[2]+=.1,i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(U[0],U[1],U[2]),i.vertexArray.emplaceBack(X[0],X[1],X[2]),i.vertexArray.emplaceBack(y[0],y[1],y[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(U[0],U[1],U[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]);let S=V/h/2;i.colorArray.emplaceBack(-S-u,-1,S,.8),i.colorArray.emplaceBack(S+u,-1,S,.8),i.colorArray.emplaceBack(-S,0,S,1.3),i.colorArray.emplaceBack(S,0,S,1.3),i.colorArray.emplaceBack(S+u,-.8,S,.7),i.colorArray.emplaceBack(S+u,-.8,S,.7),i.colorArray.emplaceBack(0,0,S,1.3),i.colorArray.emplaceBack(0,0,S,1.3),i.colorArray.emplaceBack(S+u,-1.2,S,.8),i.colorArray.emplaceBack(S+u,-1.2,S,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}let r={defined:!0,emissiveFactor:[0,0,0]},s={};return s.baseColorFactor=ga.white,r.pbrMetallicRoughness=s,i.material=r,i.aabb=new ra([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}se(aR,"TriangleGridIndex");class oR{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let n=t[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}let IY=["tile","layer","source","sourceLayer","state"];class rR{constructor(t,i,n,r,s){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=n,this._y=r,this.properties=t.properties,this.id=s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(let i of IY)this[i]!==void 0&&(t[i]=this[i]);return t}}class sR{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new kl(ie,16,0),this.featureIndexArray=new A0,this.promoteId=i,this.is3DTile=!1}insert(t,i,n,r,s,b=0,h=0){let W=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,s,b);let u=this.grid;for(let V=0;V<i.length;V++){let F=i[V],U=[1/0,1/0,-1/0,-1/0];for(let X=0;X<F.length;X++){let y=F[X];U[0]=Math.min(U[0],y.x),U[1]=Math.min(U[1],y.y),U[2]=Math.max(U[2],y.x),U[3]=Math.max(U[3],y.y)}h!==0&&(U[0]-=h,U[1]-=h,U[2]+=h,U[3]+=h),U[0]<ie&&U[1]<ie&&U[2]>=0&&U[3]>=0&&u.insert(W,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fW(new ic(this.rawTileData)).layers,this.sourceLayerCoder=new oR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,n,r){this.loadVTLayers();let s=t.params||{},b=kn(s.filter),h=t.tileResult,W=t.transform,u=h.bufferedTilespaceBounds,V=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(y,B,k,S)=>Ju(h.bufferedTilespaceGeometry,y,B,k,S));V.sort(UY);let F=null;W.elevation&&V.length>0&&(F=Kd.create(W.elevation,this.tileID));let U={},X;for(let y=0;y<V.length;y++){let B=V[y];if(B===X)continue;X=B;let k=this.featureIndexArray.get(B),S=null;if(this.is3DTile){let A=this.bucketLayerIDs[0][0],D=i[A];if(D.type!=="model")continue;let{queryFeature:O,intersectionZ:et}=D.queryIntersectsMatchingFeature(h,k.featureIndex,b,W);O&&this.appendToResult(U,A,k.featureIndex,O,et)}else this.loadMatchingFeature(U,k,b,s.layers,s.availableImages,i,n,r,(A,D,O,et=0)=>(S||(S=fa(A,this.tileID.canonical,t.tileTransform)),D.queryIntersectsFeature(h,A,O,S,this.z,t.transform,t.pixelPosMatrix,F,et)))}return U}loadMatchingFeature(t,i,n,r,s,b,h,W,u){let{featureIndex:V,bucketIndex:F,sourceLayerIndex:U,layoutVertexArrayOffset:X}=i,y=this.bucketLayerIDs[F];if(r&&!function(A,D){for(let O=0;O<A.length;O++)if(D.indexOf(A[O])>=0)return!0;return!1}(r,y))return;let B=this.sourceLayerCoder.decode(U),k=this.vtLayers[B].feature(V);if(n.needGeometry){let A=xa(k,!0);if(!n.filter(new ta(this.tileID.overscaledZ),A,this.tileID.canonical))return}else if(!n.filter(new ta(this.tileID.overscaledZ),k))return;let S=this.getId(k,B);for(let A=0;A<y.length;A++){let D=y[A];if(r&&r.indexOf(D)<0)continue;let O=b[D];if(!O)continue;let et={};S!==void 0&&W&&(et=W.getState(O.sourceLayer||"_geojsonTileLayer",S));let $=!u||u(k,O,et,X);if(!$)continue;let nt=new rR(k,this.z,this.x,this.y,S),dt=ma({},h[D]);dt.paint=dR(dt.paint,O.paint,k,et,s),dt.layout=dR(dt.layout,O.layout,k,et,s),nt.layer=dt,this.appendToResult(t,D,V,nt,$)}}appendToResult(t,i,n,r,s){let b=t[i];b===void 0&&(b=t[i]=[]),b.push({featureIndex:n,feature:r,intersectionZ:s})}lookupSymbolFeatures(t,i,n,r,s,b,h,W){let u={};this.loadVTLayers();let V=kn(s);for(let F of t)this.loadMatchingFeature(u,{bucketIndex:n,sourceLayerIndex:r,featureIndex:F,layoutVertexArrayOffset:0},V,b,h,W,i);return u}loadFeature(t){let{featureIndex:i,sourceLayerIndex:n}=t;this.loadVTLayers();let r=this.sourceLayerCoder.decode(n),s=this.vtFeatures[r];if(s[i])return s[i];let b=this.vtLayers[r].feature(i);return s[i]=b,b}hasLayer(t){for(let i of this.bucketLayerIDs)for(let n of i)if(t===n)return!0;return!1}getId(t,i){let n=t.id;if(this.promoteId){let r=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];r!=null&&(n=t.properties[r]),typeof n=="boolean"&&(n=Number(n))}return n}}function dR(e,t,i,n,r){return Ra(e,(s,b)=>{let h=t instanceof Vs?t.get(b):null;return h&&h.evaluate?h.evaluate(i,n,r):h})}function UY(e,t){return t-e}se(sR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let m1=new Float32Array(262144),Hs=new Uint8Array(262144);function cR(e){let t=0;if(e.meshes)for(let i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(let i of e.children)t=Math.max(t,cR(i));return t}function bR(e,t,i){if(e.meshes)for(let n of e.meshes)n.aabb.min[0]!==1/0&&i.insert(t,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(e.children)for(let n of e.children)bR(n,t,i)}let mR=["","wall","door","roof","window","lamp","logo"];class hR{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:cR(t)}}}getLocalBounds(){if(!this.node.meshes)return new ra([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0,i=new ra([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let n of this.node.meshes)this.node.lightMeshIndex!==t&&i.encapsulate(n.aabb),t++;this.aabb=i}return this.aabb}}class jh{constructor(t,i,n,r,s,b){this.id=i,this.modelTraits|=rc.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=rc.HasMapboxMeshFeatures),r&&(this.modelTraits|=rc.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let h of t)this.nodesInfo.push(new hR(h)),bR(h,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let n of i){let r=n.node;this.uploaded?this.updatePbrBuffer(r):l1(r,t,!0)}for(let n of i)zh(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(let n of t.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),i=!0);return i}needsReEvaluation(t,i,n){let r=t.transform.projectionOptions,s=t.style.getBrightness(),b=this.brightness!==s;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||Bm(n.paint.get("model-color").value,b)||Bm(n.paint.get("model-color-mix-intensity").value,b)||Bm(n.paint.get("model-roughness").value,b)||Bm(n.paint.get("model-emissive-strength").value,b)||Bm(n.paint.get("model-height-based-emissive-strength-multiplier").value,b))&&(this.projection=r,this.brightness=s,!0)}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;let n=this.getNodesInfo(),r=this.id.canonical;for(let s of n){let b=s.feature;s.evaluatedScale=i.paint.get("model-scale").evaluate(b,{},r)}}evaluate(t){let i=this.getNodesInfo();for(let n of i){if(!n.node.meshes)continue;let r=n.feature,s=n.node.meshes&&n.node.meshes[0].featureData,b=n.evaluatedColor[2],h=n.evaluatedRMEA[2],W=this.id.canonical;if(n.hasTranslucentParts=!1,s){for(let u=0;u<mR.length;u++){let V=mR[u];V.length&&(r.properties.part=V);let F=t.paint.get("model-color").evaluate(r,{},W),U=t.paint.get("model-color-mix-intensity").evaluate(r,{},W);n.evaluatedColor[u]=[F.r,F.g,F.b,U],n.evaluatedRMEA[u][0]=t.paint.get("model-roughness").evaluate(r,{},W),n.evaluatedRMEA[u][2]=t.paint.get("model-emissive-strength").evaluate(r,{},W),n.evaluatedRMEA[u][3]=F.a,n.emissionHeightBasedParams[u]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(r,{},W),!n.hasTranslucentParts&&F.a<1&&(n.hasTranslucentParts=!0)}delete r.properties.part,NY(n,b!==n.evaluatedColor[2]||h!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(r,{},W);n.evaluatedScale=t.paint.get("model-scale").evaluate(r,{},W),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,n,r){let s=t.findDEMTileFor(n);if(s&&(s.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(s.dem&&s.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=s.tileID.overscaledZ;let b=Kd.create(t,n,s);if(!b)return;this.modelTraits&rc.HasMapboxMeshFeatures&&this.updateDEM(t,b,n,r);for(let h of this.getNodesInfo()){let W=h.node;if(!W.footprint||!W.footprint.vertices||!W.footprint.vertices.length)continue;let u=W.footprint.vertices,V=b.getElevationAt(u[0].x,u[0].y,!0,!0);for(let F=1;F<u.length;F++)V=Math.min(V,b.getElevationAt(u[F].x,u[F].y,!0,!0));W.elevation=V}}this.terrainTile=s.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,n,r){let s=i._dem._modifiedForSources[r];if(s===void 0&&(i._dem._modifiedForSources[r]=[],s=i._dem._modifiedForSources[r]),s.includes(n.canonical))return;let b=i._dem.dim;s.push(n.canonical);let h=!1;for(let W of this.getNodesInfo()){let u=W.node;if(!u.footprint||!u.footprint.grid)continue;let V=u.footprint.grid,F=i.tileCoordToPixel(V.min.x,V.min.y),U=i.tileCoordToPixel(V.max.x,V.max.y),X=Math.min(Math.min(b-U.y,F.x),Math.min(F.y,b-U.x));if(X<0)continue;let y=ke(X,2,5),B=Math.max(0,F.x-y),k=Math.max(0,F.y-y),S=Math.min(U.x+y,b-1),A=Math.min(U.y+y,b-1);for(let $=k;$<=A;++$)for(let nt=B;nt<=S;++nt)Hs[$*b+nt]=255;let D=0,O=0;for(let $=0;$<V.cellsY;++$)for(let nt=0;nt<V.cellsX;++nt){if(!V.cells[$*V.cellsX+nt])continue;let dt=i.tileCoordToPixel(V.min.x+nt/V.xScale,V.min.y+$/V.yScale),ht=i.tileCoordToPixel(V.min.x+(nt+1)/V.xScale,V.min.y+($+1)/V.yScale);for(let gt=dt.y;gt<=Math.min(ht.y+1,b-1);++gt)for(let pt=dt.x;pt<=Math.min(ht.x+1,b-1);++pt)Hs[gt*b+pt]===255&&(Hs[gt*b+pt]=0,D+=i.getElevationAtPixel(pt,gt),O++)}let et=D/O;B=Math.max(1,F.x-y),k=Math.max(1,F.y-y),S=Math.min(U.x+y,b-2),A=Math.min(U.y+y,b-2),h=!0;for(let $=k;$<=A;++$)for(let nt=B;nt<=S;++nt)Hs[$*b+nt]===0&&(m1[$*b+nt]=i._dem.set(nt,$,et));for(let $=1;$<y;++$){B=Math.max(1,F.x-$),k=Math.max(1,F.y-$),S=Math.min(U.x+$,b-2),A=Math.min(U.y+$,b-2);for(let nt=k;nt<=A;++nt)for(let dt=B;dt<=S;++dt){let ht=nt*b+dt;if(Hs[ht]===255){let gt=0,pt=0,xt=-1,kt=-1;for(let Ft=-1;Ft<=1;++Ft)for(let Ct=-1;Ct<=1;++Ct){let Rt=(nt+Ft)*b+dt+Ct;if(Hs[Rt]>=$)continue;let Bt=m1[Rt],_t=Math.abs(Bt);_t>pt&&(gt=Bt,pt=_t,xt=Ct,kt=Ft)}if(pt>.1){let Ft=1-($+.5*Math.abs(xt*kt))/y,Ct=i._dem.get(dt,nt)+gt*Ft,Rt=i._dem.get(dt+xt,nt+kt),Bt=i._dem.get(dt-xt,nt-kt,!0);(Ct-Rt)*(Ct-Bt)>0&&(Ct=(Rt+Bt)/2),m1[ht]=i._dem.set(dt,nt,Ct),Hs[ht]=$}}}}}h&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=zt.now())}getNodesInfo(){return this.nodesInfo}destroy(){let t=this.getNodesInfo();for(let i of t)zh(i.node),o1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let n=i.getReplacementRegionsForTile(t.toUnwrapped()),r=this.getNodesInfo();for(let s=0;s<this.nodesInfo.length;s++){let b=r[s].node;r[s].hiddenByReplacement=!!b.footprint&&!n.find(h=>h.footprint===b.footprint)}}getHeightAtTileCoord(t,i){let n=this.getNodesInfo(),r=[];for(let s=0;s<this.nodesInfo.length;s++){let b=n[s],h=b.node.meshes[0];if(t<h.aabb.min[0]||i<h.aabb.min[1]||t>h.aabb.max[0]||i>h.aabb.max[1])continue;let W=(t-h.aabb.min[0])/(h.aabb.max[0]-h.aabb.min[0])*Es|0,u=Math.min(63,(i-h.aabb.min[1])/(h.aabb.max[1]-h.aabb.min[1])*Es|0)*Es+Math.min(63,W);if(!(h.heightmap[u]<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:h.heightmap[u],maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Nt(t,i),new Nt(t,i),r),r.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Bm(e,t){return!e.isLightConstant&&t}function xY(e,t,i,n,r,s,b,h){let W=(61440&t|(61440&t)>>4)>>8,u=(3840&t|(3840&t)>>4)>>4,V=240&t|(240&t)>>4;i[3]>0&&(W=li(W,255*i[0],i[3]),u=li(u,255*i[1],i[3]),V=li(V,255*i[2],i[3]));let F=W<<8|u,U=V<<8|Math.floor(255*n[3]),X=function($){let nt=ke($,0,2);return Math.min(Math.round(.5*nt*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],y=ke(r[0],0,1),B=ke(r[1],0,1),k=ke(r[2],0,1),S=ke(r[3],0,1),A,D,O,et;if(y!==B&&b!==s&&B!==y){let $=b-s;D=1/($*(B-y)),O=-(s+$*y)/($*(B-y));let nt=ke(r[4],-1,1);et=Math.pow(10,nt),A=255*k<<8|255*S}else A=65535,D=0,O=1,et=1;if(e.emplaceBack(F,U,X,A,D,O,et),h){let $=h.length;h.clear();for(let nt=0;nt<$;nt++)h.emplaceBack(F,U,X,A,D,O,et)}}function NY(e,t,i){let n=e.node,r=0,s=i&rc.HasMeshoptCompression;for(let b of n.meshes){if(n.lights&&n.lightMeshIndex===r||!b.featureData)continue;b.featureArray=new Ms,b.featureArray.reserve(b.featureData.length);let h=t;for(let W of b.featureData){let u=s?65535&W:W>>16&65535,V=s?W>>16&65535:65535&W,F=(15&V)<8?15&V:0,U=e.evaluatedRMEA[F],X=e.evaluatedColor[F],y=e.emissionHeightBasedParams[F],B;if(h&&F===2&&n.lights&&(B=new Ms,B.resize(10*n.lights.length)),xY(b.featureArray,u,X,U,y,b.aabb.min[2],b.aabb.max[2],B),B&&h){h=!1;let k=n.meshes[n.lightMeshIndex];k.featureArray=B,k.featureArray._trim()}}b.featureArray._trim(),r++}}function pR(e,t,i,n){let r=1<<e.z;t.lat=si((n/ie+e.y)/r),t.lng=Qe((i/ie+e.x)/r)}se(jh,"Tiled3dModelBucket",{omit:["layers"]}),se(hR,"Tiled3dModelFeature");let YY={circle:class extends xn{constructor(e,t,i){super(e,VU,t,i)}createBucket(e){return new Xn(e)}queryRadius(e){let t=e;return Dd("circle-radius",this,t)+Dd("circle-stroke-width",this,t)+$0(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,n,r,s,b,h){let W=Bu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return ng(e,n,s,b,h,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",W,u)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){let i=ag(this);return{config:new T(this,t),defines:i,overrideFog:!1}}},heatmap:class extends xn{createBucket(e){return new og(e)}constructor(e,t,i){super(e,PU,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Dd("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,n,r,s,b,h){let W=this.paint.get("heatmap-radius").evaluate(t,i);return ng(e,n,s,b,h,!0,!0,new Nt(0,0),W)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new T(this,t),overrideFog:!1}:{}}},hillshade:class extends xn{constructor(e,t,i){super(e,qU,t,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends xn{constructor(e,t,i){super(e,mx,t,i)}getProgramIds(){let e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new T(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new SW(e)}queryRadius(){return $0(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,n,r,s){return!e.queryGeometry.isAboveHorizon&&Lo(yu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends xn{constructor(e,t,i){super(e,Lx,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Vh(e)}queryRadius(){return $0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,i,n,r,s,b,h,W){let u=Bu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),V=this.paint.get("fill-extrusion-height").evaluate(t,i),F=this.paint.get("fill-extrusion-base").evaluate(t,i),U=[0,0],X=h&&s.elevation,y=s.elevation?s.elevation.exaggeration():1,B=e.tile.getBucket(this);if(X&&B instanceof Vh){let O=B.centroidVertexArray,et=W+1;et<O.length&&(U[0]=O.geta_centroid_pos0(et),U[1]=O.geta_centroid_pos1(et))}if(U[0]===0&&U[1]===1)return!1;s.projection.name==="globe"&&(n=zg([n],[new Nt(0,0),new Nt(ie,ie)],e.tileID.canonical).map(O=>O.polygon).flat());let k=X?h:null,[S,A]=function(O,et,$,nt,dt,ht,gt,pt,xt,kt,Ft){return O.projection.name==="globe"?function(Ct,Rt,Bt,_t,Qt,be,ne,vt,Xe,Ve,ce){let Lt=[],xe=[],Oe=Ct.projection.upVectorScale(ce,Ct.center.lat,Ct.worldSize).metersToTile,Je=[0,0,0,1],De=[0,0,0,1],Te=(ve,Qi,Wi,gi)=>{ve[0]=Qi,ve[1]=Wi,ve[2]=gi,ve[3]=1},oi=Lg();Bt>0&&(Bt+=oi),_t+=oi;for(let ve of Rt){let Qi=[],Wi=[];for(let gi of ve){let Ui=gi.x+Qt.x,ui=gi.y+Qt.y,$i=Ct.projection.projectTilePoint(Ui,ui,ce),yi=Ct.projection.upVector(ce,gi.x,gi.y),ca=Bt,Ja=_t;if(ne){let qa=Eg(Ui,ui,Bt,_t,ne,vt,Xe,Ve);ca+=qa.base,Ja+=qa.top}Bt!==0?Te(Je,$i.x+yi[0]*Oe*ca,$i.y+yi[1]*Oe*ca,$i.z+yi[2]*Oe*ca):Te(Je,$i.x,$i.y,$i.z),Te(De,$i.x+yi[0]*Oe*Ja,$i.y+yi[1]*Oe*Ja,$i.z+yi[2]*Oe*Ja),o.N.transformMat4(Je,Je,be),o.N.transformMat4(De,De,be),Qi.push(new qd(Je[0],Je[1],Je[2])),Wi.push(new qd(De[0],De[1],De[2]))}Lt.push(Qi),xe.push(Wi)}return[Lt,xe]}(O,et,$,nt,dt,ht,gt,pt,xt,kt,Ft):gt?function(Ct,Rt,Bt,_t,Qt,be,ne,vt,Xe){let Ve=[],ce=[],Lt=[0,0,0,1];for(let xe of Ct){let Oe=[],Je=[];for(let De of xe){let Te=De.x+_t.x,oi=De.y+_t.y,ve=Eg(Te,oi,Rt,Bt,be,ne,vt,Xe);Lt[0]=Te,Lt[1]=oi,Lt[2]=ve.base,Lt[3]=1,o.a7.transformMat4(Lt,Lt,Qt),Lt[3]=Math.max(Lt[3],1e-5);let Qi=new qd(Lt[0]/Lt[3],Lt[1]/Lt[3],Lt[2]/Lt[3]);Lt[0]=Te,Lt[1]=oi,Lt[2]=ve.top,Lt[3]=1,o.a7.transformMat4(Lt,Lt,Qt),Lt[3]=Math.max(Lt[3],1e-5);let Wi=new qd(Lt[0]/Lt[3],Lt[1]/Lt[3],Lt[2]/Lt[3]);Oe.push(Qi),Je.push(Wi)}Ve.push(Oe),ce.push(Je)}return[Ve,ce]}(et,$,nt,dt,ht,gt,pt,xt,kt):function(Ct,Rt,Bt,_t,Qt){let be=[],ne=[],vt=Qt[8]*Rt,Xe=Qt[9]*Rt,Ve=Qt[10]*Rt,ce=Qt[11]*Rt,Lt=Qt[8]*Bt,xe=Qt[9]*Bt,Oe=Qt[10]*Bt,Je=Qt[11]*Bt;for(let De of Ct){let Te=[],oi=[];for(let ve of De){let Qi=ve.x+_t.x,Wi=ve.y+_t.y,gi=Qt[0]*Qi+Qt[4]*Wi+Qt[12],Ui=Qt[1]*Qi+Qt[5]*Wi+Qt[13],ui=Qt[2]*Qi+Qt[6]*Wi+Qt[14],$i=Qt[3]*Qi+Qt[7]*Wi+Qt[15],yi=gi+vt,ca=Ui+Xe,Ja=ui+Ve,qa=Math.max($i+ce,1e-5),_i=gi+Lt,na=Ui+xe,wa=ui+Oe,Ea=Math.max($i+Je,1e-5);Te.push(new qd(yi/qa,ca/qa,Ja/qa)),oi.push(new qd(_i/Ea,na/Ea,wa/Ea))}be.push(Te),ne.push(oi)}return[be,ne]}(et,$,nt,dt,ht)}(s,n,F,V,u,b,k,U,y,s.center.lat,e.tileID.canonical),D=e.queryGeometry;return function(O,et,$){let nt=1/0;Lo($,et)&&(nt=wg($,et[0]));for(let dt=0;dt<et.length;dt++){let ht=et[dt],gt=O[dt];for(let pt=0;pt<ht.length-1;pt++){let xt=ht[pt],kt=[xt,ht[pt+1],gt[pt+1],gt[pt],xt];Il($,kt)&&(nt=Math.min(nt,wg($,kt)))}}return nt!==1/0&&nt}(S,A,D.isPointQuery()?D.screenBounds:D.screenGeometry)}},line:class extends xn{constructor(e,t,i){super(e,Hg,t,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){let t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof cs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Kg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new LW(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){let i=_g(this);return{config:new T(this,t),defines:i,overrideFog:!1}}queryRadius(e){let t=e,i=qg(Dd("line-width",this,t),Dd("line-gap-width",this,t)),n=Dd("line-offset",this,t);return i/2+Math.abs(n)+$0(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,r,s){if(e.queryGeometry.isAboveHorizon)return!1;let b=yu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),h=e.pixelToTileUnitsFactor/2*qg(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),W=this.paint.get("line-offset").evaluate(t,i);return W&&(n=function(u,V){let F=[],U=new Nt(0,0);for(let X=0;X<u.length;X++){let y=u[X],B=[];for(let k=0;k<y.length;k++){let S=y[k],A=y[k+1],D=k===0?U:S.sub(y[k-1])._unit()._perp(),O=k===y.length-1?U:A.sub(S)._unit()._perp(),et=D._add(O)._unit();et._mult(1/(et.x*O.x+et.y*O.y)),B.push(et._mult(V)._add(S))}F.push(B)}return F}(n,W*e.pixelToTileUnitsFactor)),function(u,V,F){for(let U=0;U<V.length;U++){let X=V[U];if(u.length>=3){for(let y=0;y<X.length;y++)if(vl(u,X[y]))return!0}if(Ss(u,X,F))return!0}return!1}(b,n,h)}isTileClipped(){return!0}},symbol:kh,background:class extends xn{constructor(e,t,i){super(e,EN,t,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:SV,"raster-particle":fV,sky:class extends xn{constructor(e,t,i){super(e,KN,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){let n=this.paint.get("sky-atmosphere-sun"),r=!n,s=e.style.light,b=s.properties.get("position");return r&&s.properties.get("anchor")==="viewport"&&ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?i1(b.azimuthal,90-b.polar,t):i1(n[0],90-n[1],t)}let i=this.paint.get("sky-gradient-center");return i1(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends xn{constructor(e,t,i){super(e,qN,t)}},model:class extends xn{constructor(e,t,i){super(e,rY,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new n1(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof jh?ie-1:0}queryIntersectsFeature(e,t,i,n,r,s){if(!this.modelManager)return!1;let b=this.modelManager,h=e.tile.getBucket(this);if(!(h&&h instanceof n1))return!1;let W=h;for(let u in W.instancesPerModel){let V=W.instancesPerModel[u];if(V.idToFeaturesIndex.hasOwnProperty(t.id)){let F=V.features[V.idToFeaturesIndex[t.id]],U=b.getModel(u,this.scope);if(!U)return!1;let X=o.a6.create(),y=new mt(0,0),B=W.canonical,k=Number.MAX_VALUE;for(let S=0;S<F.instancedDataCount;++S){let A=16*(F.instancedDataOffset+S),D=V.instancedDataArray.float32,O=[D[A+4],D[A+5],D[A+6]];pR(B,y,D[A],0|D[A+1]),OV(X,U,s,y,F.rotation,F.scale,O,!1,!1,!1),s.projection.name==="globe"&&(X=a1(X,s));let et=o.a6.multiply([],s.projMatrix,X),$=e.queryGeometry,nt=AV($.isPointQuery()?$.screenBounds:$.screenGeometry,s,et,U.aabb);nt!=null&&(k=Math.min(nt,k))}return k!==Number.MAX_VALUE&&k}}return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){let t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Ws}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(e,t,i,n){let r=e.tile,s=r.getBucket(this),b=null,h=Number.MAX_VALUE;if(!(s&&s instanceof jh))return{queryFeature:b,intersectionZ:h};let W=s.getNodesInfo()[t];if(W.hiddenByReplacement||!W.node.meshes||!i.filter(new ta(r.tileID.overscaledZ),W.feature,r.tileID.canonical))return{queryFeature:b,intersectionZ:h};let u=W.node,V=n.calculatePosMatrix(r.tileID.toUnwrapped(),n.worldSize),F=W.evaluatedScale,U=0;n.elevation&&u.elevation&&(U=u.elevation*n.elevation.exaggeration()),o.a6.translate(V,V,[(u.anchor?u.anchor[0]:0)*(F[0]-1),(u.anchor?u.anchor[1]:0)*(F[1]-1),U]),o.a6.scale(V,V,F),o.a6.multiply(V,V,u.matrix);let X=e.queryGeometry,y=X.isPointQuery()?X.screenBounds:X.screenGeometry,B=function(S){let A=o.a6.multiply([],V,S.matrix),D=o.a6.multiply(A,n.expandedFarZProjMatrix,A);for(let O=0;O<S.meshes.length;++O){let et=S.meshes[O];if(O===S.lightMeshIndex)continue;let $=AV(y,n,D,et.aabb);$!=null&&(h=Math.min($,h))}if(S.children)for(let O of S.children)B(O)};if(B(u),h===Number.MAX_VALUE)return{queryFeature:b,intersectionZ:h};let k=new mt(0,0);return pR(r.tileID.canonical,k,W.node.anchor[0],W.node.anchor[1]),b={type:"Feature",geometry:{type:"Point",coordinates:[k.lng,k.lat]},properties:W.feature.properties,id:W.feature.id,state:{},layer:this.serialize()},{queryFeature:b,intersectionZ:h}}}},we={read:function(e,t){return e.readFields(we._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(e,t,i){e===1?t.header_length=i.readFixed32():e===2?t.x=i.readVarint():e===3?t.y=i.readVarint():e===4?t.z=i.readVarint():e===5&&t.layers.push(we.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};we.Filter.read=function(e,t){return e.readFields(we.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},we.Filter._readField=function(e,t,i){e===1?(t.delta_filter=we.Filter.Delta.read(i,i.readVarint()+i.pos),t.filter="delta_filter"):e===2?(t.zigzag_filter=we.Filter.Zigzag.read(i,i.readVarint()+i.pos),t.filter="zigzag_filter"):e===3?(t.bitshuffle_filter=we.Filter.BitShuffle.read(i,i.readVarint()+i.pos),t.filter="bitshuffle_filter"):e===4&&(t.byteshuffle_filter=we.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),t.filter="byteshuffle_filter")},we.Filter.Delta={},we.Filter.Delta.read=function(e,t){return e.readFields(we.Filter.Delta._readField,{block_size:0},t)},we.Filter.Delta._readField=function(e,t,i){e===1&&(t.block_size=i.readVarint())},we.Filter.Zigzag={},we.Filter.Zigzag.read=function(e,t){return e.readFields(we.Filter.Zigzag._readField,{},t)},we.Filter.Zigzag._readField=function(e,t,i){},we.Filter.BitShuffle={},we.Filter.BitShuffle.read=function(e,t){return e.readFields(we.Filter.BitShuffle._readField,{},t)},we.Filter.BitShuffle._readField=function(e,t,i){},we.Filter.ByteShuffle={},we.Filter.ByteShuffle.read=function(e,t){return e.readFields(we.Filter.ByteShuffle._readField,{},t)},we.Filter.ByteShuffle._readField=function(e,t,i){},we.Codec={},we.Codec.read=function(e,t){return e.readFields(we.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},we.Codec._readField=function(e,t,i){e===1?(t.gzip_data=we.Codec.GzipData.read(i,i.readVarint()+i.pos),t.codec="gzip_data"):e===2?(t.jpeg_image=we.Codec.JpegImage.read(i,i.readVarint()+i.pos),t.codec="jpeg_image"):e===3?(t.webp_image=we.Codec.WebpImage.read(i,i.readVarint()+i.pos),t.codec="webp_image"):e===4&&(t.png_image=we.Codec.PngImage.read(i,i.readVarint()+i.pos),t.codec="png_image")},we.Codec.GzipData={},we.Codec.GzipData.read=function(e,t){return e.readFields(we.Codec.GzipData._readField,{},t)},we.Codec.GzipData._readField=function(e,t,i){},we.Codec.JpegImage={},we.Codec.JpegImage.read=function(e,t){return e.readFields(we.Codec.JpegImage._readField,{},t)},we.Codec.JpegImage._readField=function(e,t,i){},we.Codec.WebpImage={},we.Codec.WebpImage.read=function(e,t){return e.readFields(we.Codec.WebpImage._readField,{},t)},we.Codec.WebpImage._readField=function(e,t,i){},we.Codec.PngImage={},we.Codec.PngImage.read=function(e,t){return e.readFields(we.Codec.PngImage._readField,{},t)},we.Codec.PngImage._readField=function(e,t,i){},we.DataIndexEntry={},we.DataIndexEntry.read=function(e,t){return e.readFields(we.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},we.DataIndexEntry._readField=function(e,t,i){e===1?t.first_byte=i.readFixed64():e===2?t.last_byte=i.readFixed64():e===3?t.filters.push(we.Filter.read(i,i.readVarint()+i.pos)):e===4?t.codec=we.Codec.read(i,i.readVarint()+i.pos):e===5?t.offset=i.readFloat():e===6?t.scale=i.readFloat():e===7&&t.bands.push(i.readString())},we.Layer={},we.Layer.read=function(e,t){return e.readFields(we.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},we.Layer._readField=function(e,t,i){e===1?t.version=i.readVarint():e===2?t.name=i.readString():e===3?t.units=i.readString():e===4?t.tilesize=i.readVarint():e===5?t.buffer=i.readVarint():e===6?t.pixel_format=i.readVarint():e===7&&t.data_index.push(we.DataIndexEntry.read(i,i.readVarint()+i.pos))};let Hl={read:function(e,t){return e.readFields(Hl._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(e,t,i){e===2?(t.uint32_values=Hl.Uint32Values.read(i,i.readVarint()+i.pos),t.values="uint32_values"):e===3&&(t.fixed32_values=Hl.Fixed32Values.read(i,i.readVarint()+i.pos),t.values="fixed32_values")},Uint32Values:{}};Hl.Uint32Values.read=function(e,t){return e.readFields(Hl.Uint32Values._readField,{values:[]},t)},Hl.Uint32Values._readField=function(e,t,i){e===1&&(t.readValuesInto=function(n){if(n.type!==2)throw new Error('Unsupported pbf type "'.concat(n.type,'"'));let r=function(b){return b.type===2?b.readVarint()+b.pos:b.pos+1}(n),s=n.pos;return n.pos=r,function(b){n.pos=s;let h=0;for(;n.pos<r;){let W=n.readVarint();b[h++]=W}return b}}(i))},Hl.Fixed32Values={},Hl.Fixed32Values.read=function(e,t){return e.readFields(Hl.Fixed32Values._readField,{values:[]},t)},Hl.Fixed32Values._readField=function(e,t,i){throw new Error("Not implemented")};class XY{constructor(t=0,i=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=n,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){let i=this.items[t];delete this.items[t],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(t=this.keys()){return t.map(i=>[i,this.get(i)])}evict(t=!1){if(t||this.size>0){let i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(t){let i;return this.has(t)&&(i=this.items[t].expiry),i}get(t){let i;if(this.has(t)){let n=this.items[t];this.ttl>0&&n.expiry<=Date.now()?this.delete(t):(i=n.value,this.set(t,i,!0))}return i}has(t){return t in this.items}keys(){let t=[],i=this.first;for(;i!==null;)t.push(i.key),i=i.next;return t}set(t,i,n=!1,r=this.resetTtl){let s;if(n||this.has(t)){if(s=this.items[t],s.value=i,n===!1&&r&&(s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==s){let b=this.last,h=s.next,W=s.prev;this.first===s&&(this.first=s.next),s.next=null,s.prev=this.last,b.next=s,W!==null&&(W.next=h),h!==null&&(h.prev=W)}}else this.max>0&&this.size===this.max&&this.evict(!0),s=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:i},++this.size==1?this.first=s:this.last.next=s;return this.last=s,this}values(t=this.keys()){return t.map(i=>this.get(i))}}function JY(e,t){if(t.length!==4)throw new Error("Expected data of dimension 4 but got ".concat(t.length,"."));let i=t[3];for(let n=2;n>=1;n--){let r=n===1?1:0,s=n===2?1:0;for(let b=0;b<t[0];b++){let h=t[1]*b;for(let W=r;W<t[1];W++){let u=t[2]*(W+h);for(let V=s;V<t[2];V++){let F=t[3]*(V+u);for(let U=0;U<t[3];U++){let X=F+U;e[X]+=e[X-i]}}}}i*=t[n]}return e}function yY(e){for(let t=0,i=e.length;t<i;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function BY(e,t){switch(t){case"uint32":return e;case"uint16":for(let i=0;i<e.length;i+=2){let n=e[i],r=e[i+1];e[i]=(240&n)>>4|(61440&n)>>8|(240&r)<<4|61440&r,e[i+1]=15&n|(3840&n)>>4|(15&r)<<8|(3840&r)<<4}return e;case"uint8":for(let i=0;i<e.length;i+=4){let n=e[i],r=e[i+1],s=e[i+2],b=e[i+3];e[i+0]=(192&n)>>6|(192&r)>>4|(192&s)>>2|192&b,e[i+1]=(48&n)>>4|(48&r)>>2|48&s|(48&b)<<2,e[i+2]=(12&n)>>2|12&r|(12&s)<<2|(12&b)<<4,e[i+3]=3&n|(3&r)<<2|(3&s)<<4|(3&b)<<6}return e;default:throw new Error('Invalid pixel format, "'.concat(t,'"'))}}class Sr extends Error{constructor(t){super(t),this.name="MRTError"}}var hl=Uint8Array,bc=Uint16Array,MY=Int32Array,WR=new hl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),uR=new hl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),CY=new hl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ZR=function(e,t){for(var i=new bc(31),n=0;n<31;++n)i[n]=t+=1<<e[n-1];var r=new MY(i[30]);for(n=1;n<30;++n)for(var s=i[n];s<i[n+1];++s)r[s]=s-i[n]<<5|n;return{b:i,r}},gR=ZR(WR,2),VR=gR.b,TY=gR.r;VR[28]=258,TY[258]=28;for(var kY=ZR(uR,0).b,h1=new bc(32768),Va=0;Va<32768;++Va){var mc=(43690&Va)>>1|(21845&Va)<<1;h1[Va]=((65280&(mc=(61680&(mc=(52428&mc)>>2|(13107&mc)<<2))>>4|(3855&mc)<<4))>>8|(255&mc)<<8)>>1}var Mm=function(e,t,i){for(var n=e.length,r=0,s=new bc(t);r<n;++r)e[r]&&++s[e[r]-1];var b,h=new bc(t);for(r=1;r<t;++r)h[r]=h[r-1]+s[r-1]<<1;if(i){b=new bc(1<<t);var W=15-t;for(r=0;r<n;++r)if(e[r])for(var u=r<<4|e[r],V=t-e[r],F=h[e[r]-1]++<<V,U=F|(1<<V)-1;F<=U;++F)b[h1[F]>>W]=u}else for(b=new bc(n),r=0;r<n;++r)e[r]&&(b[r]=h1[h[e[r]-1]++]>>15-e[r]);return b},Cm=new hl(288);for(Va=0;Va<144;++Va)Cm[Va]=8;for(Va=144;Va<256;++Va)Cm[Va]=9;for(Va=256;Va<280;++Va)Cm[Va]=7;for(Va=280;Va<288;++Va)Cm[Va]=8;var RR=new hl(32);for(Va=0;Va<32;++Va)RR[Va]=5;var QY=Mm(Cm,9,1),SY=Mm(RR,5,1),p1=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},jl=function(e,t,i){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&i},W1=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},fY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ol=function(e,t,i){var n=new Error(t||fY[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,Ol),!i)throw n;return n},vY=new hl(0),LY=typeof TextDecoder<"u"&&new TextDecoder;try{LY.decode(vY,{stream:!0})}catch{}let zY={gzip_data:"gzip"},wY={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},EY={uint32:1,uint16:2,uint8:4},AY={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class GR{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){let i=new Uint8Array(t),n=new DataView(t);if(i[0]!==13)throw new Sr("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(t){let i=new Uint8Array(t),n=this.getHeaderLength(t);if(i.length<n)throw new Sr("Expected header with length >= ".concat(n," but got buffer of length ").concat(i.length));let r=new ic(i.subarray(0,n)),s=we.read(r);if(!isNaN(this.x)&&(this.x!==s.x||this.y!==s.y||this.z!==s.z))throw new Sr("Invalid attempt to parse header ".concat(s.z,"/").concat(s.x,"/").concat(s.y," for tile ").concat(this.z,"/").concat(this.x,"/").concat(this.y));this.x=s.x,this.y=s.y,this.z=s.z;for(let b of s.layers)this.layers[b.name]=new HY(b,{cacheSize:this._cacheSize});return this}createDecodingTask(t){let i=[],n=this.getLayer(t.layerName);for(let r=0;r<n.dataIndex.length;r++){let s=n.dataIndex[r],b=s.first_byte-t.firstByte,h=s.last_byte+1-t.firstByte;if(r<t.firstBlock||r>t.lastBlock||n._blocksInProgress.has(r))continue;let W={layerName:n.name,firstByte:b,lastByte:h,pixelFormat:n.pixelFormat,blockIndex:r,blockShape:[s.bands.length].concat(n.bandShape),buffer:n.buffer,codec:s.codec.codec,filters:s.filters.map(u=>u.filter)};n._blocksInProgress.add(r),i.push(W)}return new FR(i,()=>{i.forEach(r=>n._blocksInProgress.delete(r.blockIndex))},(r,s)=>{if(i.forEach(b=>n._blocksInProgress.delete(b.blockIndex)),r)throw r;s.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class HY{constructor({version:t,name:i,units:n,tilesize:r,pixel_format:s,buffer:b,data_index:h},W){if(this.version=t,this.version!==1)throw new Sr("Cannot parse raster layer encoded with MRT version ".concat(t));this.name=i,this.units=n,this.tileSize=r,this.buffer=b,this.pixelFormat=wY[s],this.dataIndex=h,this.bandShape=[r+2*b,r+2*b,EY[this.pixelFormat]],this._decodedBlocks=function(u=1e3,V=0,F=!1){if(isNaN(u)||u<0)throw new TypeError("Invalid max value");if(isNaN(V)||V<0)throw new TypeError("Invalid ttl value");if(typeof F!="boolean")throw new TypeError("Invalid resetTtl value");return new XY(u,V,F)}(W?W.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){let i=t.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,t.data)}getBlockForBand(t){let i=0;switch(typeof t){case"string":for(let[n,r]of this.dataIndex.entries()){for(let[s,b]of r.bands.entries())if(b===t)return{bandIndex:i+s,blockIndex:n,blockBandIndex:s};i+=r.bands.length}break;case"number":for(let[n,r]of this.dataIndex.entries()){if(t>=i&&t<i+r.bands.length)return{bandIndex:t,blockIndex:n,blockBandIndex:t-i};i+=r.bands.length}break;default:throw new Sr("Invalid band `".concat(JSON.stringify(t),"`. Expected string or integer."))}throw new Sr("Band not found: ".concat(JSON.stringify(t)))}getDataRange(t){let i=1/0,n=-1/0,r=1/0,s=-1/0;for(let b of t){let{blockIndex:h}=this.getBlockForBand(b);if(h<0)throw new Sr("Invalid band: ".concat(JSON.stringify(b)));let W=this.dataIndex[h];r=Math.min(r,h),s=Math.max(s,h),i=Math.min(i,W.first_byte),n=Math.max(n,W.last_byte)}return{layerName:this.name,firstByte:i,lastByte:n,firstBlock:r,lastBlock:s}}hasBand(t){let{blockIndex:i}=this.getBlockForBand(t);return i>=0}hasDataForBand(t){let{blockIndex:i}=this.getBlockForBand(t);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(t){let{blockIndex:i,blockBandIndex:n}=this.getBlockForBand(t),r=this._decodedBlocks.get(i.toString());if(!r)throw new Sr("Data for band ".concat(JSON.stringify(t),' of layer "').concat(this.name,'" not decoded.'));let s=this.dataIndex[i],b=this.bandShape.reduce((u,V)=>u*V,1),h=n*b,W=r.subarray(h,h+b);return{data:W,bytes:new Uint8Array(W.buffer).subarray(W.byteOffset,W.byteOffset+W.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:s.offset,scale:s.scale}}}class FR{constructor(t,i,n){this.tasks=t,this._onCancel=i,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,i){this._finalized||(this._onComplete(t,i),this._finalized=!0)}}GR.performDecoding=function(e,t){return Promise.all(t.tasks.map(i=>{let{layerName:n,firstByte:r,lastByte:s,pixelFormat:b,blockShape:h,blockIndex:W,filters:u,codec:V}=i,F=new Uint8Array(e).subarray(r,s+1),U=new Uint32Array(h[0]*h[1]*h[2]),X;if(V!=="gzip_data")throw new Error("Unhandled codec: ".concat(V));return X=function(y,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((D=function($){$[0]==31&&$[1]==139&&$[2]==8||Ol(6,"invalid gzip data");var nt=$[3],dt=10;4&nt&&(dt+=2+($[10]|$[11]<<8));for(var ht=(nt>>3&1)+(nt>>4&1);ht>0;ht-=!$[dt++]);return dt+(2&nt)}(A=y))+8>A.length&&Ol(6,"invalid gzip data"),function($,nt,dt,ht){var gt=$.length;if(!gt||nt.f&&!nt.l)return dt||new hl(0);var pt=!dt,xt=pt||nt.i!=2,kt=nt.i;pt&&(dt=new hl(3*gt));var Ft=function(Jn){var Zn=dt.length;if(Jn>Zn){var pl=new hl(Math.max(2*Zn,Jn));pl.set(dt),dt=pl}},Ct=nt.f||0,Rt=nt.p||0,Bt=nt.b||0,_t=nt.l,Qt=nt.d,be=nt.m,ne=nt.n,vt=8*gt;do{if(!_t){Ct=jl($,Rt,1);var Xe=jl($,Rt+1,3);if(Rt+=3,!Xe){var Ve=$[(Wi=4+((Rt+7)/8|0))-4]|$[Wi-3]<<8,ce=Wi+Ve;if(ce>gt){kt&&Ol(0);break}xt&&Ft(Bt+Ve),dt.set($.subarray(Wi,ce),Bt),nt.b=Bt+=Ve,nt.p=Rt=8*ce,nt.f=Ct;continue}if(Xe==1)_t=QY,Qt=SY,be=9,ne=5;else if(Xe==2){var Lt=jl($,Rt,31)+257,xe=jl($,Rt+10,15)+4,Oe=Lt+jl($,Rt+5,31)+1;Rt+=14;for(var Je=new hl(Oe),De=new hl(19),Te=0;Te<xe;++Te)De[CY[Te]]=jl($,Rt+3*Te,7);Rt+=3*xe;var oi=p1(De),ve=(1<<oi)-1,Qi=Mm(De,oi,1);for(Te=0;Te<Oe;){var Wi,gi=Qi[jl($,Rt,ve)];if(Rt+=15&gi,(Wi=gi>>4)<16)Je[Te++]=Wi;else{var Ui=0,ui=0;for(Wi==16?(ui=3+jl($,Rt,3),Rt+=2,Ui=Je[Te-1]):Wi==17?(ui=3+jl($,Rt,7),Rt+=3):Wi==18&&(ui=11+jl($,Rt,127),Rt+=7);ui--;)Je[Te++]=Ui}}var $i=Je.subarray(0,Lt),yi=Je.subarray(Lt);be=p1($i),ne=p1(yi),_t=Mm($i,be,1),Qt=Mm(yi,ne,1)}else Ol(1);if(Rt>vt){kt&&Ol(0);break}}xt&&Ft(Bt+131072);for(var ca=(1<<be)-1,Ja=(1<<ne)-1,qa=Rt;;qa=Rt){var _i=(Ui=_t[W1($,Rt)&ca])>>4;if((Rt+=15&Ui)>vt){kt&&Ol(0);break}if(Ui||Ol(2),_i<256)dt[Bt++]=_i;else{if(_i==256){qa=Rt,_t=null;break}var na=_i-254;_i>264&&(na=jl($,Rt,(1<<(Aa=WR[Te=_i-257]))-1)+VR[Te],Rt+=Aa);var wa=Qt[W1($,Rt)&Ja],Ea=wa>>4;if(wa||Ol(3),Rt+=15&wa,yi=kY[Ea],Ea>3){var Aa=uR[Ea];yi+=W1($,Rt)&(1<<Aa)-1,Rt+=Aa}if(Rt>vt){kt&&Ol(0);break}xt&&Ft(Bt+131072);var Ai=Bt+na;if(Bt<yi){var Dn=0-yi,fr=Math.min(yi,Ai);for(Dn+Bt<0&&Ol(3);Bt<fr;++Bt)dt[Bt]=ht[Dn+Bt]}for(;Bt<Ai;++Bt)dt[Bt]=dt[Bt-yi]}}nt.l=_t,nt.p=qa,nt.b=Bt,nt.f=Ct,_t&&(Ct=1,nt.m=be,nt.d=Qt,nt.n=ne)}while(!Ct);return Bt!=dt.length&&pt?function(Jn,Zn,pl){return(Zn==null||Zn<0)&&(Zn=0),(pl==null||pl>Jn.length)&&(pl=Jn.length),new hl(Jn.subarray(Zn,pl))}(dt,0,Bt):dt.subarray(0,Bt)}(A.subarray(D,-8),{i:2},new hl(((k=A)[(S=k.length)-4]|k[S-3]<<8|k[S-2]<<16|k[S-1]<<24)>>>0),void 0)));var k,S,A,D;let O=zY[B];if(!O)throw new Error("Unhandled codec: ".concat(B));let et=new globalThis.DecompressionStream(O);return new Response(new Blob([y]).stream().pipeThrough(et)).arrayBuffer().then($=>new Uint8Array($))}(F,V).then(y=>{let B=Hl.read(new ic(y));if(B.values==="uint32_values")return B.uint32_values.readValuesInto(U),new AY[b](U.buffer);throw new Error('Unhandled numeric data "'.concat(B.values,'"'))}),X.then(y=>{for(let B=u.length-1;B>=0;B--)switch(u[B]){case"delta_filter":JY(y,h);break;case"zigzag_filter":yY(y);break;case"bitshuffle_filter":BY(y,b);break;default:throw new Error('Unhandled filter "'.concat(u[B],'"'))}return{layerName:n,blockIndex:W,data:y}}).catch(y=>{throw y})}))},se(FR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let IR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class u1{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,n]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let r=n>>4;if(r!==1)throw new Error("Got v".concat(r," data when expected v1."));let s=IR[15&n];if(!s)throw new Error("Unrecognized array type.");let[b]=new Uint16Array(t,2,1),[h]=new Uint32Array(t,4,1);return new u1(h,b,s,t)}constructor(t,i=64,n=Float64Array,r){if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=n,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let s=IR.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,h=t*this.IndexArrayType.BYTES_PER_ELEMENT,W=(8-h%8)%8;if(s<0)throw new Error("Unexpected typed array class: ".concat(n,"."));r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+W,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+h+W),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+h+W,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=t,this.coords[this._pos++]=i,n}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return Z1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:b,nodeSize:h}=this,W=[0,s.length-1,0],u=[];for(;W.length;){let V=W.pop()||0,F=W.pop()||0,U=W.pop()||0;if(F-U<=h){for(let k=U;k<=F;k++){let S=b[2*k],A=b[2*k+1];S>=t&&S<=n&&A>=i&&A<=r&&u.push(s[k])}continue}let X=U+F>>1,y=b[2*X],B=b[2*X+1];y>=t&&y<=n&&B>=i&&B<=r&&u.push(s[X]),(V===0?t<=y:i<=B)&&(W.push(U),W.push(X-1),W.push(1-V)),(V===0?n>=y:r>=B)&&(W.push(X+1),W.push(F),W.push(1-V))}return u}within(t,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:s,nodeSize:b}=this,h=[0,r.length-1,0],W=[],u=n*n;for(;h.length;){let V=h.pop()||0,F=h.pop()||0,U=h.pop()||0;if(F-U<=b){for(let k=U;k<=F;k++)xR(s[2*k],s[2*k+1],t,i)<=u&&W.push(r[k]);continue}let X=U+F>>1,y=s[2*X],B=s[2*X+1];xR(y,B,t,i)<=u&&W.push(r[X]),(V===0?t-n<=y:i-n<=B)&&(h.push(U),h.push(X-1),h.push(1-V)),(V===0?t+n>=y:i+n>=B)&&(h.push(X+1),h.push(F),h.push(1-V))}return W}}function Z1(e,t,i,n,r,s){if(r-n<=i)return;let b=n+r>>1;UR(e,t,b,n,r,s),Z1(e,t,i,n,b-1,1-s),Z1(e,t,i,b+1,r,1-s)}function UR(e,t,i,n,r,s){for(;r>n;){if(r-n>600){let u=r-n+1,V=i-n+1,F=Math.log(u),U=.5*Math.exp(2*F/3),X=.5*Math.sqrt(F*U*(u-U)/u)*(V-u/2<0?-1:1);UR(e,t,i,Math.max(n,Math.floor(i-V*U/u+X)),Math.min(r,Math.floor(i+(u-V)*U/u+X)),s)}let b=t[2*i+s],h=n,W=r;for(Tm(e,t,n,i),t[2*r+s]>b&&Tm(e,t,n,r);h<W;){for(Tm(e,t,h,W),h++,W--;t[2*h+s]<b;)h++;for(;t[2*W+s]>b;)W--}t[2*n+s]===b?Tm(e,t,n,W):(W++,Tm(e,t,W,r)),W<=i&&(n=W+1),i<=W&&(r=W-1)}}function Tm(e,t,i,n){g1(e,i,n),g1(t,2*i,2*n),g1(t,2*i+1,2*n+1)}function g1(e,t,i){let n=e[t];e[t]=e[i],e[i]=n}function xR(e,t,i,n){let r=e-i,s=t-n;return r*r+s*s}o.$=XV,o.A=Md,o.B=Xb,o.C=ri,o.D=ut,o.E=ir,o.F=ea,o.G=jt,o.H=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return tl(e.expression.evaluate(t))}interpolate(e,t,i){return{x:li(e.x,t.x,i),y:li(e.y,t.y,i),z:li(e.z,t.z,i),azimuthal:li(e.azimuthal,t.azimuthal,i),polar:li(e.polar,t.polar,i)}}},o.I=jW,o.J=Ql,o.K=ta,o.L=mi,o.M=class{constructor(e,t,i,n){this.id=e,this.position=t!=null?new mt(t[0],t[1]):new mt(0,0),this.orientation=i!=null?i:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new ra([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){if(o.a6.multiply(e.matrix,t,e.matrix),e.meshes)for(let i of e.meshes){let n=ra.applyTransform(i.aabb,e.matrix);this.aabb.encapsulate(n)}if(e.children)for(let i of e.children)this._applyTransformations(i,e.matrix)}computeBoundsAndApplyParent(){let e=o.a6.identity([]);for(let t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,i,n,r,s,b=!1){OV(this.matrix,this,e.transform,this.position,t,i,n,r,s,b)}upload(e){if(!this.uploaded){for(let t of this.nodes)l1(t,e);for(let t of this.nodes)zh(t);this.uploaded=!0}}destroy(){for(let e of this.nodes)o1(e)}},o.O=Ba,o.P=Nt,o.Q=Vs,o.R=Gn,o.S=Xr,o.T=e1,o.U=li,o.V=ie,o.W=a0,o.X=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([i,n]){let r=tl([1,i,n]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:li(e.x,t.x,i),y:li(e.y,t.y,i),z:li(e.z,t.z,i)}}},o.Y=function(e,t,i=0,n=!0){let r=new Nt(i,i),s=e.sub(r),b=t.add(r),h=[s,new Nt(b.x,s.y),b,new Nt(s.x,b.y)];return n&&h.push(s.clone()),h},o.Z=Ws,o._=function(e,t){let i=[];for(let n=0;n<e.length;n++){let r=Ma(n-1,-1,e.length-1),s=Ma(n+1,-1,e.length-1),b=e[n],h=e[s],W=e[r].sub(b).unit(),u=h.sub(b).unit(),V=u.angleWithSep(W.x,W.y),F=W.add(u).unit().mult(-1*t/Math.sin(V/2));i.push(b.add(F))}return i},o.a=kc,o.a$=function(e){let t=[];for(let i in e)t.push(e[i]);return t},o.a0=Ju,o.a1=function(e,t,i=0){return o.N.fromValues(((t.x-i)*e.scale-e.x)*ie,(t.y*e.scale-e.y)*ie,fi(t.z,t.y))},o.a2=GW,o.a3=jg,o.a4=function(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(let s of e)t=Math.min(t,s.x),i=Math.min(i,s.y),n=Math.max(n,s.x),r=Math.max(r,s.y);return{min:new Nt(t,i),max:new Nt(n,r)}},o.a5=Ae,o.a8=vl,o.a9=Ri,o.aA=G0,o.aB=da,o.aC=ul,o.aD=S0,o.aE=Th,o.aF=function(){Tn.isLoading()||Tn.isLoaded()||ho()!=="deferred"||Lb()},o.aG=kn,o.aH=xa,o.aI=rR,o.aJ=Vl,o.aK=LW,o.aL=SW,o.aM=fa,o.aN=sl,o.aO=tm,o.aP=DZ,o.aQ=mh,o.aR=t1,o.aS=function(e,t){let i=Xr(t.zoom);if(i===0)return Go(e);let n=lh(e),r=xW(n),s=Ae(n.getWest())*t.worldSize,b=Ae(n.getEast())*t.worldSize,h=Me(n.getNorth())*t.worldSize,W=Me(n.getSouth())*t.worldSize,u=[s,h,0],V=[b,h,0],F=[s,W,0],U=[b,W,0],X=o.a6.invert([],t.globeMatrix);return o.N.transformMat4(u,u,X),o.N.transformMat4(V,V,X),o.N.transformMat4(F,F,X),o.N.transformMat4(U,U,X),r[0]=Ho(r[0],F,i),r[1]=Ho(r[1],U,i),r[2]=Ho(r[2],V,i),r[3]=Ho(r[3],u,i),ra.fromPoints(r)},o.aT=rh,o.aU=dm,o.aV=Ho,o.aW=Wn,o.aX=LU,o.aY=on,o.aZ=GR,o.a_=yt,o.aa=ke,o.ab=H,o.ac=function(e,t){let i={};for(let n=0;n<t.length;n++){let r=t[n];r in e&&(i[r]=e[r])}return i},o.ad=Vt,o.ae=Me,o.af=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,n){let r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){let[s,b]=r.result;return this.scheduler?this.scheduler.add(()=>{n(s,b)},t):n(s,b),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i((s,b)=>{r.result=[s,b];for(let h of r.callbacks)this.scheduler?this.scheduler.add(()=>{h(s,b)},t):h(s,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{r.result||(r.callbacks=r.callbacks.filter(s=>s!==n),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}},o.ag=jb,o.ah=function(e,t,i){let n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},r=>{let s=yt(e.request,(b,h,W,u)=>{b?r(b):h&&r(null,{vectorTile:i?void 0:new fW(new ic(h)),rawData:h,cacheControl:W,expires:u})});return()=>{s.cancel(),r()}},t)},o.ai=function(e){xi++,xi>We&&(e.getActor().send("enforceCacheSizeLimit",Jt),xi=0)},o.aj=Fa,o.ak=Tt,o.al=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},o.am=Et,o.an=SV,o.ao=fV,o.ap=QV,o.aq=function(e,t){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let n=0;n<e.length;n++){let r=document.createElement("source");wt(e[n])||(i.crossOrigin="Anonymous"),r.src=e[n],i.appendChild(r)}return{cancel:()=>{}}},o.ar=Qh,o.as=Gm,o.at=Qe,o.au=si,o.av=Sl,o.aw=Qa,o.ax=ga,o.ay=Ni,o.az=vo,o.b=xo,o.b$=M0,o.b0=function(e,t){let i=[];for(let n in e)n in t||i.push(n);return i},o.b1=ln,o.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.b3=function(e,t){let{x:i,y:n}=e.point,r=tg(i,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return o.a6.multiply(r,r,NW(Go(t)))},o.b5=$d,o.b6=ml,o.b7=Rh,o.b8=function(e,t,i,n,r){let s=5*t+2;e.float32[s+0]=i,e.float32[s+1]=n,e.float32[s+2]=r},o.b9=Ch,o.bA=vh,o.bB=vV,o.bC=function(e){let t=vV(e,!0);return o.b4.invert([],[t[0],t[1],t[4],t[5]])},o.bD=FW,o.bE=function(e){let{x:t,y:i}=e.point,{lng:n,lat:r}=e._center;return tg(t,i,e.worldSize,n,r)},o.bF=Bi,o.bG=K,o.bH=function(e){let t=Math.round((e+45+360)%360/90)%4;return Ya[t]},o.bI=45,o.bJ=Re,o.bK=c,o.bL=Zo,o.bM=q0,o.bN=sn,o.bO=Hd,o.bP=d,o.bQ=function(e,t,i){let n=Math.sqrt(e*e+t*t+i*i),r=n>0?Math.acos(i/n)*Pi:0,s=e!==0||t!==0?Math.atan2(-t,-e)*Pi+90:0;return s<0&&(s+=360),[n,s,r]},o.bR=ei,o.bS=ra,o.bT=tl,o.bU=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},o.bV=function(e){return e({pluginStatus:Un,pluginURL:mo}),vb.on("pluginStateChange",e),e},o.bW=sc,o.bX=wh,o.bY=nc,o.bZ=OW,o.b_=Za,o.ba=ZV,o.bb=Il,o.bc=en,o.bd=UV,o.be=_W,o.bf=HW,o.bg=u1,o.bh=Ma,o.bj=ye,o.bk=tt,o.bl=fe,o.bm=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},o.bn=mt,o.bo=CV,o.bp=At,o.bq=IW,o.br=LV,o.bs=ft,o.bt=KZ,o.bu=function(e,t,i,n,r,s,b,h,W){if(W.name==="globe")return KZ(e,t,new ft(i,n,r),!1);let u=Gm({z:i,x:n,y:r},W);return new ra([(s+u.x/u.scale)*t,t*(u.y/u.scale),b],[(s+u.x2/u.scale)*t,t*(u.y2/u.scale),h])},o.bv=function(e,t,i){let n=0;for(let r=0;r<2;++r){let s=i?i[r]:0;e[r]>s&&(n+=(e[r]-s)*(e[r]-s)),t[r]<s&&(n+=(s-t[r])*(s-t[r]))}return n},o.bw=$e,o.bx=w,o.by=function(e){let t=o.a6.identity(new Float64Array(16));o.a6.multiply(t,e.pixelMatrix,e.globeMatrix);let i=[0,rt,0],n=[0,Zt,0];return o.N.transformMat4(i,i,t),o.N.transformMat4(n,n,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!XW(e,new mt(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!XW(e,new mt(e.center.lat,-90))]},o.bz=function(e,t){let{scale:i}=e.tileTransform,n=i*ie/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return o.b4.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[n,n])},o.c=lR,o.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.c0=Ut,o.c1=tn,o.c2=function(e,t,i){return e.type==="custom"?new _N(e,t):new YY[e.type](e,t,i)},o.c3=function(e){let t=e.indexOf(fd);return t>=0?e.slice(0,t):e},o.c4=function(e){return e.indexOf(fd)>=0},o.c5=function(e){let t=e.indexOf(fd);return t>=0?e.slice(t+1):""},o.c6=function(e){let t=[],i=e.id;return i===void 0&&t.push({message:"layers.".concat(i,': missing required property "id"')}),e.render===void 0&&t.push({message:"layers.".concat(i,': missing required method "render"')}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers.".concat(i,': property "renderingMode" must be either "2d" or "3d"')}),t},o.c7=Ca,o.c8=vb,o.c9=Xt,o.cA=_g,o.cB=(e,t,i,n,r,s)=>{let b=e.transform;return{u_matrix:Dg(e,t,i,n),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:Og(t,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:s}},o.cC=(e,t,i,n,r,s,b)=>{let h=e.transform,W=h.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Dg(e,t,i,n),u_pixels_to_tile_units:W,u_device_pixel_ratio:s,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:Pg(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Og(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_emissive_strength:i.paint.get("line-emissive-strength")}},o.cD=Zl,o.cE=cm,o.cF=Lg,o.cG=me,o.cH=Vh,o.cI=Br,o.cJ=450,o.cK=7,o.cL=jN,o.cM=256,o.cN=NW,o.cO=uo,o.cP=$b,o.cQ=function(e,t,i,n,r){return ke((e-t)/(i-t)*(r-n)+n,n,r)},o.cR=ti,o.cS=a1,o.cT=[1,1,1],o.cU=Kd,o.cV=rc,o.cW=Gl,o.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=Vg(new Nt(0,0),new Nt(ie,ie),e),i=[];for(let n of this._activeRegions){if(n.hiddenByOverlap||!gg(t,n))continue;let r=Nx(n.min,n.max,e);i.push({min:r.min,max:r.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return i}setSources(e){this._setSources(e.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{let i=[];for(let n of t.cache.getVisibleCoordinates()){let r=t.cache.getTile(n).buckets[t.layer];if(r)for(let s of r.getNodesInfo()){let b=s.node;b.footprint&&i.push({footprint:b.footprint,id:n.toUnwrapped()})}}return i}})))}_addSource(e){let t=e.getFootprints();if(t.length!==0){for(let i of t){if(!i.footprint)continue;let n=Vg(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((t,i)=>t.priority-i.priority||uh(t.min,i.min)||uh(t.max,i.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,i=0;for(;!e&&t!==this._activeRegions.length;){let n=this._activeRegions[t],r=this._prevRegions[i];e=n.priority!==r.priority||!Zg(n,r),++t,++i}}if(e){++this._updateTime;let t=i=>{let n=this._activeRegions;if(i>=n.length)return i;let r=n[i].priority;for(;i<n.length&&n[i].priority===r;)++i;return i};if(this._sourceIds.length>1){let i=0,n=t(i);for(;i!==n;){let r=i,s=i;for(;r!==n;){let b=this._activeRegions[r];b.hiddenByOverlap=!1;for(let h=0;h<s;h++){let W=this._activeRegions[h];if(!W.hiddenByOverlap&&gg(b,W)&&(b.hiddenByOverlap=Gg(b.footprint,b.tileId,W.footprint,W.tileId),b.hiddenByOverlap))break}++r}i=n,n=t(i)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},o.cY=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let e of this._poleSegments)e.destroy();for(let e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){let i=new sl,n=new Qa,r=[],s=e+1+2,b=t[0]+1,h=t[0]+1+(1+t.length),W=(u,V,F)=>{let U=u===s-1?u-2:u===0?u:u-1;return U+=F?24575:0,[U,V]};for(let u=0;u<s;++u)i.emplaceBack(...W(u,0,!0));for(let u=0;u<b;++u)for(let V=0;V<s;++V)i.emplaceBack(...W(V,u,(V===0||V===s-1)&&!0));for(let u=0;u<t.length;++u){let V=t[u];for(let F=0;F<s;++F)i.emplaceBack(...W(F,V,!0))}for(let u=0;u<t.length;++u){let V=n.length,F=t[u]+1+2,U=new Qa;for(let B=0;B<F-1;B++){let k=B===F-2,S=k?s*(h-t.length+u-B):s;for(let A=0;A<s-1;A++){let D=B*s+A;B===0||k||A===0||A===s-2?(U.emplaceBack(D+1,D,D+S),U.emplaceBack(D+S,D+S+1,D+1)):(n.emplaceBack(D+1,D,D+S),n.emplaceBack(D+S,D+S+1,D+1))}}let X=da.simpleSegment(0,V,i.length,n.length-V);for(let B=0;B<U.uint16.length;B+=3)n.emplaceBack(U.uint16[B],U.uint16[B+1],U.uint16[B+2]);let y=da.simpleSegment(0,V,i.length,n.length-V);r.push({withoutSkirts:X,withSkirts:y})}return{vertices:i,indices:n,segments:r}}_createGrid(e){let t=this._fillGridMeshWithLods(it,at);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,DZ.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){let t=new Qa;for(let b=0;b<=it;b++)t.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);let i=new uo,n=new uo,r=new uo,s=new uo;this._poleSegments=[];for(let b=0,h=0;b<K;b++){let W=360/(1<<b);i.emplaceBack(0,-H,0,.5,0),n.emplaceBack(0,-H,0,.5,1),r.emplaceBack(0,-H,0,.5,.5),s.emplaceBack(0,-H,0,.5,.5);for(let u=0;u<=it;u++){let V=u/it,F=0,U=li(0,W,V),[X,y,B]=bt(EU,AU,U,H);i.emplaceBack(X,y,B,V,F),n.emplaceBack(X,y,B,V,1-F);let k=ye(U);V=.5+.5*Math.sin(k),F=.5+.5*Math.cos(k),r.emplaceBack(X,y,B,V,F),s.emplaceBack(X,y,B,V,1-F)}this._poleSegments.push(da.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,ah,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,ah,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(r,ah,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(s,ah,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},o.cZ=function(e){return ql.has(e)},o.c_=la,o.ca=a,o.cb=class extends fl{constructor(e){super(e),this.current=m}set(e,t,i){if(this.fetchUniformLocation(e,t)){for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.cc=Kt,o.cd=function(e,t,i){let n=Xr(i.zoom),r=e.style.map._antialias,s=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return n===0&&!r&&!s},o.ce=function(e){let t=e.pixelsPerMeter,i=t/fe(1,e.center.lat),n=o.a6.identity(new Float64Array(16));return o.a6.translate(n,n,[e.point.x,e.point.y,0]),o.a6.scale(n,n,[i,i,t]),Float32Array.from(n)},o.cf=lh,o.cg=function(e){let t=$e-5;e=ke(e,-t,t)/t*90;let i=Math.pow(Math.abs(Math.sin(ye(e))),3);return Math.round(i*(at.length-1))},o.ch=function(e,t,i,n){let r=t.getNorth(),s=t.getSouth(),b=t.getWest(),h=t.getEast(),W=1<<e.z,u=h-b,V=r-s,F=u/it,U=-V/at[i],X=[0,F,0,U,0,0,r,b,0];if(e.z>0){let y=180/n;o.co.multiply(X,X,[y/u+1,0,0,0,y/V+1,0,-.5*y/F,.5*y/U,1])}return X[2]=W,X[5]=e.x,X[8]=e.y,X},o.ci=Go,o.cj=function(e,t,i){let n=o.a6.identity(new Float64Array(16)),r=(t/(1<<e)-.5)*Math.PI*2;return o.a6.rotateY(n,i.globeMatrix,r),Float32Array.from(n)},o.ck=class{isDataAvailableAtPoint(e){let t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;let i=t.getSource().maxzoom,n=1<<i,r=Math.floor(e.x),s=Math.floor((e.x-r)*n),b=Math.floor(e.y*n),h=this.findDEMTileFor(new Et(i,r,i,s,b));return!(!h||!h.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);let n=this._source();if(!n||e.y<0||e.y>1)return t;let r=n.getSource().maxzoom,s=1<<r,b=Math.floor(e.x),h=e.x-b,W=new Et(r,b,r,Math.floor(h*s),Math.floor(e.y*s)),u=this.findDEMTileFor(W);if(!u||!u.dem)return t;let V=u.dem,F=1<<u.tileID.canonical.z,U=(h*F-u.tileID.canonical.x)*V.dim,X=(e.y*F-u.tileID.canonical.y)*V.dim,y=Math.floor(U),B=Math.floor(X);return(i?this.exaggeration():1)*li(li(V.get(y,B),V.get(y,B+1),X-B),li(V.get(y+1,B),V.get(y+1,B+1),X-B),U-y)}getAtTileOffset(e,t,i){let n=1<<e.canonical.z;return this.getAtPointOrZero(new mi(e.wrap+(e.canonical.x+t/ie)/n,(e.canonical.y+i/ie)/n))}getAtTileOffsetFunc(e,t,i,n){return r=>{let s=this.getAtTileOffset(e,r.x,r.y),b=n.upVector(e.canonical,r.x,r.y),h=n.upVectorScale(e.canonical,t,i).metersToTile;return o.N.scale(b,b,s*h),b}}getForTilePoints(e,t,i,n){if(this.isUsingMockSource())return!1;let r=Kd.create(this,e,n);return!!r&&(t.forEach(s=>{s[2]=this.exaggeration()*r.getElevationAt(s[0],s[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;let t=this.findDEMTileFor(e);if(!t||!t.dem)return null;let i=t.dem.tree,n=t.tileID,r=1<<e.canonical.z-n.canonical.z,s=e.canonical.x/r-n.canonical.x,b=e.canonical.y/r-n.canonical.y,h=0;for(let W=0;W<e.canonical.z-n.canonical.z&&!i.leaves[h];W++){s*=2,b*=2;let u=2*Math.floor(b)+Math.floor(s);h=i.childOffsets[h]+u,s%=1,b%=1}return{min:this.exaggeration()*i.minimums[h],max:this.exaggeration()*i.maximums[h]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let e=this.visibleDemTiles;if(e.length===0)return null;let t=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(let r of e){let s=this.getMinMaxForTile(r.tileID);s&&(i=Math.min(i,s.min),n=Math.max(n,s.max),t=!0)}return t?{min:i,max:n}:null}},o.cl=nh,o.cm=dg,o.cn=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},o.cp=$Z,o.cq=256,o.cr=function(e,t){let i=[0,0,0],n=rh(Go(t.canonical));return o.N.transformMat4(i,i,n),o.N.transformMat4(i,i,e),i},o.cs=e=>({u_camera_to_center_distance:new sn(e),u_extrude_scale:new Z(e),u_device_pixel_ratio:new sn(e),u_matrix:new c(e),u_inv_rot_matrix:new c(e),u_merc_center:new Zo(e),u_tile_id:new q0(e),u_zoom_transition:new sn(e),u_up_dir:new q0(e),u_emissive_strength:new sn(e)}),o.ct=e=>({u_matrix:new c(e),u_pixels_to_tile_units:new Z(e),u_device_pixel_ratio:new sn(e),u_units_to_pixels:new Zo(e),u_dash_image:new Hd(e),u_gradient_image:new Hd(e),u_image_height:new sn(e),u_texsize:new Zo(e),u_tile_units_to_pixels:new sn(e),u_alpha_discard_threshold:new sn(e),u_trim_offset:new Zo(e),u_emissive_strength:new sn(e)}),o.cu=e=>({u_matrix:new c(e),u_texsize:new Zo(e),u_pixels_to_tile_units:new Z(e),u_device_pixel_ratio:new sn(e),u_image:new Hd(e),u_units_to_pixels:new Zo(e),u_tile_units_to_pixels:new sn(e),u_alpha_discard_threshold:new sn(e),u_trim_offset:new Zo(e)}),o.cv=zd,o.cw=eN,o.cx=iN,o.cy=ag,o.cz=(e,t,i,n,r,s)=>{let b=e.transform,h=b.projection.name==="globe",W;if(s.paint.get("circle-pitch-alignment")==="map")if(h){let V=$Z(b.zoom,t.canonical)*b._pixelsPerMercatorPixel;W=Float32Array.from([V,0,0,V])}else W=b.calculatePixelsToTileUnitsMatrix(i);else W=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);let u={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(b.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:zt.devicePixelRatio,u_extrude_scale:W,u_inv_rot_matrix:HU,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(h){u.u_inv_rot_matrix=n,u.u_merc_center=r,u.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],u.u_zoom_transition=Xr(b.zoom);let V=r[0]*ie,F=r[1]*ie;u.u_up_dir=b.projection.upVector(new ft(0,0,0),V,F)}return u},o.d=ee,o.d0=ua,o.d1=pi,o.d2=It,o.d3=function([e,t,i]){let n=Math.hypot(e,t,i),r=Math.atan2(e,i),s=.5*Math.PI-Math.acos(-t/n);return new mt(Bi(r),Bi(s))},o.d4=Gt,o.d5=lt,o.d6=XW,o.d7=eg,o.d8=function(e){let t=[0,0,0],i=o.a6.identity(new Float64Array(16));return o.a6.multiply(i,e.pixelMatrix,e.globeMatrix),o.N.transformMat4(t,t,i),new Nt(t[0],t[1])},o.d9=function(e){let t=e.navigator?e.navigator.userAgent:null;return!!function(i){if(Mt==null){let n=i.navigator?i.navigator.userAgent:null;Mt=!!i.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Mt}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dA=El,o.dB=oR,o.dC=sR,o.dD=Ag,o.dE=Ra,o.dF=VV,o.dG=function(e,t,i,n,r,s,b,h,W,u,V){e.createArrays(),e.tilePixelRatio=ie/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;let F=e.layers[0].layout,U=e.layers[0]._unevaluatedLayout._values,X={};if(e.textSizeData.kind==="composite"){let{minZoom:S,maxZoom:A}=e.textSizeData;X.compositeTextSizes=[U["text-size"].possiblyEvaluate(new ta(S),h),U["text-size"].possiblyEvaluate(new ta(A),h)]}if(e.iconSizeData.kind==="composite"){let{minZoom:S,maxZoom:A}=e.iconSizeData;X.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new ta(S),h),U["icon-size"].possiblyEvaluate(new ta(A),h)]}X.layoutTextSize=U["text-size"].possiblyEvaluate(new ta(W+1),h),X.layoutIconSize=U["icon-size"].possiblyEvaluate(new ta(W+1),h),X.textMaxSize=U["text-size"].possiblyEvaluate(new ta(18),h);let y=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",B=F.get("text-size"),k=!1;for(let S of e.features)if(S.icon&&S.icon.nameSecondary){k=!0;break}for(let S of e.features){let A=F.get("text-font").evaluate(S,{},h).join(","),D=B.evaluate(S,{},h),O=X.layoutTextSize.evaluate(S,{},h),et=(X.layoutIconSize.evaluate(S,{},h),{horizontal:{},vertical:void 0}),$=S.text,nt,dt=[0,0];if($){let pt=$.toString(),xt=F.get("text-letter-spacing").evaluate(S,{},h)*en,kt=F.get("text-line-height").evaluate(S,{},h)*en,Ft=qp(pt)?xt:0,Ct=F.get("text-anchor").evaluate(S,{},h),Rt=F.get("text-variable-anchor");if(!Rt){let ne=F.get("text-radial-offset").evaluate(S,{},h);dt=ne?UV(Ct,[ne*en,DW]):F.get("text-offset").evaluate(S,{},h).map(vt=>vt*en)}let Bt=y?"center":F.get("text-justify").evaluate(S,{},h),_t=F.get("symbol-placement")==="point",Qt=_t?F.get("text-max-width").evaluate(S,{},h)*en:1/0,be=ne=>{e.allowVerticalPlacement&&bo(pt)&&(et.vertical=AW($,t,i,r,A,Qt,kt,Ct,ne,Ft,dt,ml.vertical,!0,O,D))};if(!y&&Rt){let ne=Bt==="auto"?Rt.map(Xe=>_W(Xe)):[Bt],vt=!1;for(let Xe=0;Xe<ne.length;Xe++){let Ve=ne[Xe];if(!et.horizontal[Ve])if(vt)et.horizontal[Ve]=et.horizontal[0];else{let ce=AW($,t,i,r,A,Qt,kt,"center",Ve,Ft,dt,ml.horizontal,!1,O,D);ce&&(et.horizontal[Ve]=ce,vt=ce.positionedLines.length===1)}}be("left")}else{if(Bt==="auto"&&(Bt=_W(Ct)),_t||F.get("text-writing-mode").indexOf("horizontal")>=0||!bo(pt)){let ne=AW($,t,i,r,A,Qt,kt,Ct,Bt,Ft,dt,ml.horizontal,!1,O,D);ne&&(et.horizontal[Bt]=ne)}be(_t?"left":Bt)}}let ht=!1;if(S.icon&&S.icon.namePrimary){let pt=n[S.icon.namePrimary];pt&&(nt=GN(r[S.icon.namePrimary],S.icon.nameSecondary?r[S.icon.nameSecondary]:void 0,F.get("icon-offset").evaluate(S,{},h),F.get("icon-anchor").evaluate(S,{},h)),ht=pt.sdf,e.sdfIcons===void 0?e.sdfIcons=pt.sdf:e.sdfIcons!==pt.sdf&&ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==e.pixelRatio||F.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}let gt=NV(et.horizontal)||et.vertical;e.iconsInText||(e.iconsInText=!!gt&&gt.iconsInText),(gt||nt)&&XN(e,S,et,nt,n,X,O,0,dt,ht,b,h,u,V,k)}s&&e.generateCollisionDebugBuffers(W,e.collisionBoxArray)},o.dH=fW,o.dI=ic,o.dJ=Zh,o.dK=Ee,o.dL=ph,o.dM=hh,o.dN=Se,o.dO=tV,o.dP=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==qV){let i=new Uint32Array(e,0,7),[,,n,r,s,b]=i;t=i.byteLength+r+s+b+s,(n!==e.byteLength||t>=e.byteLength)&&ji("Invalid b3dm header information.")}return iR(e,t)},o.dQ=function(e,t){let i=lR(e);for(let n of i){for(let r of n.meshes)GY(r);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(FY(n.lights,t)))}return i},o.dR=jh,o.dS=DV,o.dT=Tn,o.dU=function(e){Mi(),re&&re.then(t=>{t.keys().then(i=>{for(let n=0;n<i.length-e;n++)t.delete(i[n])})})},o.da=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){let e=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Dt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!Ut(e))return e;let i=Be(e);return i.params.push("sdk=js-".concat(_)),i.path="/styles/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!Ut(e))return e;let i=Be(e);return i.path="/fonts/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeModelURL(e,t){if(!Ut(e))return e;let i=Be(e);return i.path="/models/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,n){if(!Ut(e))return e;let r=Be(e);return r.path="/v4/".concat(r.authority,".json"),r.params.push("secure"),i&&r.params.push("language=".concat(i)),n&&r.params.push("worldview=".concat(n)),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,n){let r=Be(e);return Ut(e)?(r.path="/styles/v1".concat(r.path,"/sprite").concat(t).concat(i),this._makeAPIURL(r,this._customAccessToken||n)):(r.path+="".concat(t).concat(i),ni(r))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Ut(e))return e;let n=Be(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||i&&n.authority!=="raster"&&i===512?"@2x":"").concat(Gi.supported?".webp":"$1")),n.authority==="raster"?n.path="/".concat(lt.RASTER_URL_PREFIX).concat(n.path):n.authority==="rasterarrays"?n.path="/".concat(lt.RASTERARRAYS_URL_PREFIX).concat(n.path):(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/".concat(lt.TILE_URL_VERSION).concat(n.path));let r=this._customAccessToken||function(s){for(let b of s){let h=b.match(/^access_token=(.*)$/);if(h)return h[1]}return null}(n.params)||lt.ACCESS_TOKEN;return lt.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(n,r)}canonicalizeTileURL(e,t){let i=Be(e);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+="raster/".concat(i.path.replace("/".concat(lt.RASTER_URL_PREFIX,"/"),"")):i.path.match(/^\/rasterarrays\/v1\//)?n+="rasterarrays/".concat(i.path.replace("/".concat(lt.RASTERARRAYS_URL_PREFIX,"/"),"")):n+="tiles/".concat(i.path.replace("/".concat(lt.TILE_URL_VERSION,"/"),""));let r=i.params;return t&&(r=r.filter(s=>!s.match(/^access_token=/))),r.length&&(n+="?".concat(r.join("&"))),n}canonicalizeTileset(e,t){let i=!!t&&Ut(t),n=[];for(let r of e.tiles||[])Ot(r)?n.push(this.canonicalizeTileURL(r,i)):n.push(r);return n}_makeAPIURL(e,t){let i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=Be(lt.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,e.protocol==="http"){let r=e.params.indexOf("secure");r>=0&&e.params.splice(r,1)}if(n.path!=="/"&&(e.path="".concat(n.path).concat(e.path)),!lt.REQUIRE_ACCESS_TOKEN)return ni(e);if(t=t||lt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. ".concat(i));if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(i))}return e.params=e.params.filter(r=>r.indexOf("access_token")===-1),e.params.push("access_token=".concat(t||"")),ni(e)}},o.db=function(e,t){t?ql.add(e):ql.delete(e)},o.dc=Gi,o.dd=il,o.de=qr,o.df=ae,o.dg=Vi,o.dh=function(e){ql.delete(e)},o.di=Da,o.dj=Oa,o.dk=_,o.dl=function(e,t){Jt=e,We=t},o.dm=function(e,t,i=!1){if(Un===Tb||Un===kb||Un===Qb)throw new Error("setRTLTextPlugin cannot be called multiple times.");mo=zt.resolveURL(e),Un=Tb,Sb=t,fb(),i||Lb()},o.dn=ho,o.dp=function(){wh().acquire(r1)},o.dq=function(){let e=Jm;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(r1),Jm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dr=Xm,o.ds=function(e){let t=_e();if(!t)return;let i=t.delete(he);e&&i.catch(e).then(()=>e())},o.dt=Ym,o.du=_V,o.dv=function(e){s1=zt.resolveURL(e),cc||(cc=new sc(wh(),new ir)),cc.broadcast("setDracoUrl",s1)},o.dw=PV,o.dx=function(e){dc=zt.resolveURL(e),cc||(cc=new sc(wh(),new ir)),cc.broadcast("setMeshoptUrl",dc)},o.dy=se,o.dz=Jr,o.e=ma,o.f=zt,o.g=function(e,t){return Xt(ma(e,{type:"json"}),t)},o.h=bl,o.i=sr,o.j=fc,o.k=Bd,o.l=function(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>iR(t,0,e))},o.m=U0,o.n=ps,o.o=Gs,o.p=gV,o.q=kd,o.r=Td,o.s=Jb,o.t=ss,o.u=Rs,o.v=Pa,o.w=ji,o.x=hr,o.z=Eb}),C(["./shared"],function(o){"use strict";function _(Mt){let j=Mt?Mt.url.toString():void 0;return j?performance.getEntriesByName(j):[]}function ct(Mt){if(typeof Mt=="number"||typeof Mt=="boolean"||typeof Mt=="string"||Mt==null)return JSON.stringify(Mt);if(Array.isArray(Mt)){let tt="[";for(let st of Mt)tt+="".concat(ct(st),",");return"".concat(tt,"]")}let j="{";for(let tt of Object.keys(Mt).sort())j+="".concat(tt,":").concat(ct(Mt[tt]),",");return"".concat(j,"}")}function lt(Mt){let j="";for(let tt of o.b2)j+="/".concat(ct(Mt[tt]));return j}class Ot{constructor(j){this.keyCache={},this._layers={},this._layerConfigs={},j&&this.replace(j)}replace(j,tt){this._layerConfigs={},this._layers={},this.update(j,[],tt)}update(j,tt,st){this._options=st;for(let Tt of j)this._layerConfigs[Tt.id]=Tt,(this._layers[Tt.id]=o.c2(Tt,this.scope,this._options)).compileFilter(),this.keyCache[Tt.id]&&delete this.keyCache[Tt.id];for(let Tt of tt)delete this.keyCache[Tt],delete this._layerConfigs[Tt],delete this._layers[Tt];this.familiesBySource={};let Yt=function(Tt,zt){let he={};for(let We=0;We<Tt.length;We++){let re=zt&&zt[Tt[We].id]||lt(Tt[We]);zt&&(zt[Tt[We].id]=re);let ge=he[re];ge||(ge=he[re]=[]),ge.push(Tt[We])}let Jt=[];for(let We in he)Jt.push(he[We]);return Jt}(o.a$(this._layerConfigs),this.keyCache);for(let Tt of Yt){let zt=Tt.map(_e=>this._layers[_e.id]),he=zt[0];if(he.visibility==="none")continue;let Jt=he.source||"",We=this.familiesBySource[Jt];We||(We=this.familiesBySource[Jt]={});let re=he.sourceLayer||"_geojsonTileLayer",ge=We[re];ge||(ge=We[re]=[]),ge.push(zt)}}}let Ut=1*o.dA;class de{constructor(j){let tt={},st=[];for(let he in j){let Jt=j[he],We=tt[he]={};for(let re in Jt.glyphs){let ge=Jt.glyphs[+re];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;let _e=ge.metrics.localGlyph?Ut:1,Mi={x:0,y:0,w:ge.bitmap.width+2*_e,h:ge.bitmap.height+2*_e};st.push(Mi),We[re]=Mi}}let{w:Yt,h:Tt}=o.p(st),zt=new o.dz({width:Yt||1,height:Tt||1});for(let he in j){let Jt=j[he];for(let We in Jt.glyphs){let re=Jt.glyphs[+We];if(!re||re.bitmap.width===0||re.bitmap.height===0)continue;let ge=tt[he][We],_e=re.metrics.localGlyph?Ut:1;o.dz.copy(re.bitmap,zt,{x:0,y:0},{x:ge.x+_e,y:ge.y+_e},re.bitmap)}}this.image=zt,this.positions=tt}}o.dy(de,"GlyphAtlas");class Ze{constructor(j){this.tileID=new o.am(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.tileZoom=j.tileZoom,this.uid=j.uid,this.zoom=j.zoom,this.canonical=j.tileID.canonical,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.scope=j.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.promoteId=j.promoteId,this.isSymbolTile=j.isSymbolTile,this.tileTransform=o.as(j.tileID.canonical,j.projection),this.projection=j.projection,this.brightness=j.brightness,this.extraShadowCaster=!!j.extraShadowCaster}parse(j,tt,st,Yt,Tt){this.status="parsing",this.data=j,this.collisionBoxArray=new o.aD;let zt=new o.dB(Object.keys(j.layers).sort()),he=new o.dC(this.tileID,this.promoteId);he.bucketLayerIDs=[];let Jt={},We=new o.dD(256,256),re={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:We,availableImages:st,brightness:this.brightness},ge=tt.familiesBySource[this.source];for(let Ji in ge){let wi=j.layers[Ji];if(!wi)continue;let ka=!1,Hi=!1,hn=!1;for(let Ga of ge[Ji])Ga[0].type==="symbol"?ka=!0:Hi=!0,Ga[0].is3D()&&Ga[0].type!=="model"&&(hn=!0);if(this.extraShadowCaster&&!hn||this.isSymbolTile===!0&&!ka||this.isSymbolTile===!1&&!Hi)continue;wi.version===1&&o.w('Vector tile source "'.concat(this.source,'" layer "').concat(Ji,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));let rn=zt.encode(Ji),Gn=[];for(let Ga=0;Ga<wi.length;Ga++){let Za=wi.feature(Ga),Xt=he.getId(Za,Ji);Gn.push({feature:Za,id:Xt,index:Ga,sourceLayerIndex:rn})}for(let Ga of ge[Ji]){let Za=Ga[0];(!this.extraShadowCaster||Za.is3D()&&Za.type!=="model")&&(this.isSymbolTile!==void 0&&Za.type==="symbol"!==this.isSymbolTile||Za.minzoom&&this.zoom<Math.floor(Za.minzoom)||Za.maxzoom&&this.zoom>=Za.maxzoom||Za.visibility!=="none"&&(Fe(Ga,this.zoom,re.brightness,st),(Jt[Za.id]=Za.createBucket({index:he.bucketLayerIDs.length,layers:Ga,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:rn,sourceID:this.source,projection:this.projection.spec})).populate(Gn,re,this.tileID.canonical,this.tileTransform),he.bucketLayerIDs.push(Ga.map(Xt=>Xt.id))))}}let _e,Mi,Oi,Ci;We.trim();let xi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Gi=()=>{if(_e)return this.status="done",Tt(_e);if(this.extraShadowCaster)this.status="done",Tt(null,{buckets:o.a$(Jt).filter(Ji=>!Ji.isEmpty()),featureIndex:he,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:re.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Mi&&Oi&&Ci){let Ji=new de(Mi),wi=new o.dF(Oi,Ci);for(let ka in Jt){let Hi=Jt[ka];Hi instanceof o.aE?(Fe(Hi.layers,this.zoom,re.brightness,st),o.dG(Hi,Mi,Ji.positions,Oi,wi.iconPositions,this.showCollisionBoxes,st,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Hi.hasPattern&&(Hi instanceof o.aK||Hi instanceof o.aL||Hi instanceof o.cH)&&(Fe(Hi.layers,this.zoom,re.brightness,st),Hi.addFeatures(re,this.tileID.canonical,wi.patternPositions,st,this.tileTransform,this.brightness))}this.status="done",Tt(null,{buckets:o.a$(Jt).filter(ka=>!ka.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ji.image,lineAtlas:We,imageAtlas:wi,brightness:re.brightness})}};if(!this.extraShadowCaster){let Ji=o.dE(re.glyphDependencies,Hi=>Object.keys(Hi).map(Number));Object.keys(Ji).length?Yt.send("getGlyphs",{uid:this.uid,stacks:Ji,scope:this.scope},(Hi,hn)=>{_e||(_e=Hi,Mi=hn,Gi())},void 0,!1,xi):Mi={};let wi=Object.keys(re.iconDependencies);wi.length?Yt.send("getImages",{icons:wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Hi,hn)=>{_e||(_e=Hi,Oi=hn,Gi())},void 0,!1,xi):Oi={};let ka=Object.keys(re.patternDependencies);ka.length?Yt.send("getImages",{icons:ka,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Hi,hn)=>{_e||(_e=Hi,Ci=hn,Gi())},void 0,!1,xi):Ci={}}Gi()}}function Fe(Mt,j,tt,st){let Yt=new o.K(j,{brightness:tt});for(let Tt of Mt)Tt.recalculate(Yt,st)}class qe extends o.E{constructor(j,tt,st,Yt,Tt,zt){super(),this.actor=j,this.layerIndex=tt,this.availableImages=st,this.loadVectorData=Tt||o.ah,this.loading={},this.loaded={},this.deduped=new o.af(j.scheduler),this.isSpriteLoaded=Yt,this.scheduler=j.scheduler,this.brightness=zt}loadTile(j,tt){let st=j.uid,Yt=j&&j.request,Tt=Yt&&Yt.collectResourceTiming,zt=this.loading[st]=new Ze(j);zt.abort=this.loadVectorData(j,(he,Jt)=>{let We=!this.loading[st];if(delete this.loading[st],We||he||!Jt)return zt.status="done",We||(this.loaded[st]=zt),tt(he);let re=Jt.rawData,ge={};Jt.expires&&(ge.expires=Jt.expires),Jt.cacheControl&&(ge.cacheControl=Jt.cacheControl),zt.vectorTile=Jt.vectorTile||new o.dH(new o.dI(re));let _e=()=>{zt.parse(zt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Mi,Oi)=>{if(Mi||!Oi)return tt(Mi);let Ci={};if(Tt){let xi=_(Yt);xi.length>0&&(Ci.resourceTiming=JSON.parse(JSON.stringify(xi)))}tt(null,o.e({rawTileData:re.slice(0)},Oi,ge,Ci))})};this.isSpriteLoaded?_e():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_e,{type:"parseTile",isSymbolTile:j.isSymbolTile,zoom:j.tileZoom}):_e()}),this.loaded=this.loaded||{},this.loaded[st]=zt})}reloadTile(j,tt){let st=this.loaded,Yt=j.uid,Tt=this;if(st&&st[Yt]){let zt=st[Yt];zt.showCollisionBoxes=j.showCollisionBoxes,zt.projection=j.projection,zt.brightness=j.brightness,zt.tileTransform=o.as(j.tileID.canonical,j.projection),zt.extraShadowCaster=j.extraShadowCaster;let he=(Jt,We)=>{let re=zt.reloadCallback;re&&(delete zt.reloadCallback,zt.parse(zt.vectorTile,Tt.layerIndex,this.availableImages,Tt.actor,re)),tt(Jt,We)};zt.status==="parsing"?zt.reloadCallback=he:zt.status==="done"&&(zt.vectorTile?zt.parse(zt.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}else tt(null,void 0)}abortTile(j,tt){let st=j.uid,Yt=this.loading[st];Yt&&(Yt.abort&&Yt.abort(),delete this.loading[st]),tt()}removeTile(j,tt){let st=this.loaded,Yt=j.uid;st&&st[Yt]&&delete st[Yt],tt()}}class Le{loadTile(j,tt){let{uid:st,encoding:Yt,rawImageData:Tt,padding:zt}=j,he=ImageBitmap&&Tt instanceof ImageBitmap?this.getImageData(Tt,zt):Tt;tt(null,new o.dJ(st,he,Yt,zt<1))}getImageData(j,tt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(j.width,j.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=j.width,this.offscreenCanvas.height=j.height,this.offscreenCanvasContext.drawImage(j,0,0,j.width,j.height);let st=this.offscreenCanvasContext.getImageData(-tt,-tt,j.width+2*tt,j.height+2*tt);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),st}}class Ee{decodeRasterArray({task:j,buffer:tt},st){o.aZ.performDecoding(tt,j).then(Yt=>{st(null,Yt)},Yt=>{st(Yt)})}}function hi(Mt,j){if(Mt.length!==0){Xi(Mt[0],j);for(var tt=1;tt<Mt.length;tt++)Xi(Mt[tt],!j)}}function Xi(Mt,j){for(var tt=0,st=0,Yt=0,Tt=Mt.length,zt=Tt-1;Yt<Tt;zt=Yt++){var he=(Mt[Yt][0]-Mt[zt][0])*(Mt[zt][1]+Mt[Yt][1]),Jt=tt+he;st+=Math.abs(tt)>=Math.abs(he)?tt-Jt+he:he-Jt+tt,tt=Jt}tt+st>=0!=!!j&&Mt.reverse()}var vi=o.dK(function Mt(j,tt){var st,Yt=j&&j.type;if(Yt==="FeatureCollection")for(st=0;st<j.features.length;st++)Mt(j.features[st],tt);else if(Yt==="GeometryCollection")for(st=0;st<j.geometries.length;st++)Mt(j.geometries[st],tt);else if(Yt==="Feature")Mt(j.geometry,tt);else if(Yt==="Polygon")hi(j.coordinates,tt);else if(Yt==="MultiPolygon")for(st=0;st<j.coordinates.length;st++)hi(j.coordinates[st],tt);return j});let Se=o.dL.prototype.toGeoJSON,Zi=class{constructor(Mt){this._feature=Mt,this.extent=o.V,this.type=Mt.type,this.properties=Mt.tags,"id"in Mt&&!isNaN(Mt.id)&&(this.id=parseInt(Mt.id,10))}loadGeometry(){if(this._feature.type===1){let Mt=[];for(let j of this._feature.geometry)Mt.push([new o.P(j[0],j[1])]);return Mt}{let Mt=[];for(let j of this._feature.geometry){let tt=[];for(let st of j)tt.push(new o.P(st[0],st[1]));Mt.push(tt)}return Mt}}toGeoJSON(Mt,j,tt){return Se.call(this,Mt,j,tt)}},Nt=class{constructor(Mt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.V,this.length=Mt.length,this._features=Mt}feature(Mt){return new Zi(this._features[Mt])}};var Yi={exports:{}},Pi=o.dN,ye=o.dM.VectorTileFeature,Bi=Ya;function Ya(Mt,j){this.options=j||{},this.features=Mt,this.length=Mt.length}function Kt(Mt,j){this.id=typeof Mt.id=="number"?Mt.id:void 0,this.type=Mt.type,this.rawGeometry=Mt.type===1?[Mt.geometry]:Mt.geometry,this.properties=Mt.tags,this.extent=j||4096}Ya.prototype.feature=function(Mt){return new Kt(this.features[Mt],this.options.extent)},Kt.prototype.loadGeometry=function(){var Mt=this.rawGeometry;this.geometry=[];for(var j=0;j<Mt.length;j++){for(var tt=Mt[j],st=[],Yt=0;Yt<tt.length;Yt++)st.push(new Pi(tt[Yt][0],tt[Yt][1]));this.geometry.push(st)}return this.geometry},Kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Mt=this.geometry,j=1/0,tt=-1/0,st=1/0,Yt=-1/0,Tt=0;Tt<Mt.length;Tt++)for(var zt=Mt[Tt],he=0;he<zt.length;he++){var Jt=zt[he];j=Math.min(j,Jt.x),tt=Math.max(tt,Jt.x),st=Math.min(st,Jt.y),Yt=Math.max(Yt,Jt.y)}return[j,st,tt,Yt]},Kt.prototype.toGeoJSON=ye.prototype.toGeoJSON;var la=o.dO,ua=Bi;function ke(Mt){var j=new la;return function(tt,st){for(var Yt in tt.layers)st.writeMessage(3,Ba,tt.layers[Yt])}(Mt,j),j.finish()}function Ba(Mt,j){var tt;j.writeVarintField(15,Mt.version||1),j.writeStringField(1,Mt.name||""),j.writeVarintField(5,Mt.extent||4096);var st={keys:[],values:[],keycache:{},valuecache:{}};for(tt=0;tt<Mt.length;tt++)st.feature=Mt.feature(tt),j.writeMessage(2,Ma,st);var Yt=st.keys;for(tt=0;tt<Yt.length;tt++)j.writeStringField(3,Yt[tt]);var Tt=st.values;for(tt=0;tt<Tt.length;tt++)j.writeMessage(4,$n,Tt[tt])}function Ma(Mt,j){var tt=Mt.feature;tt.id!==void 0&&j.writeVarintField(1,tt.id),j.writeMessage(2,ln,Mt),j.writeVarintField(3,tt.type),j.writeMessage(4,ul,tt)}function ln(Mt,j){var tt=Mt.feature,st=Mt.keys,Yt=Mt.values,Tt=Mt.keycache,zt=Mt.valuecache;for(var he in tt.properties){var Jt=tt.properties[he],We=Tt[he];if(Jt!==null){We===void 0&&(st.push(he),Tt[he]=We=st.length-1),j.writeVarint(We);var re=typeof Jt;re!=="string"&&re!=="boolean"&&re!=="number"&&(Jt=JSON.stringify(Jt));var ge=re+":"+Jt,_e=zt[ge];_e===void 0&&(Yt.push(Jt),zt[ge]=_e=Yt.length-1),j.writeVarint(_e)}}}function ma(Mt,j){return(j<<3)+(7&Mt)}function Ln(Mt){return Mt<<1^Mt>>31}function ul(Mt,j){for(var tt=Mt.loadGeometry(),st=Mt.type,Yt=0,Tt=0,zt=tt.length,he=0;he<zt;he++){var Jt=tt[he],We=1;st===1&&(We=Jt.length),j.writeVarint(ma(1,We));for(var re=st===3?Jt.length-1:Jt.length,ge=0;ge<re;ge++){ge===1&&st!==1&&j.writeVarint(ma(2,re-1));var _e=Jt[ge].x-Yt,Mi=Jt[ge].y-Tt;j.writeVarint(Ln(_e)),j.writeVarint(Ln(Mi)),Yt+=_e,Tt+=Mi}st===3&&j.writeVarint(ma(7,1))}}function $n(Mt,j){var tt=typeof Mt;tt==="string"?j.writeStringField(1,Mt):tt==="boolean"?j.writeBooleanField(7,Mt):tt==="number"&&(Mt%1!=0?j.writeDoubleField(3,Mt):Mt<0?j.writeSVarintField(6,Mt):j.writeVarintField(5,Mt))}Yi.exports=ke,Yi.exports.fromVectorTileJs=ke,Yi.exports.fromGeojsonVt=function(Mt,j){j=j||{};var tt={};for(var st in Mt)tt[st]=new ua(Mt[st].features,j),tt[st].name=st,tt[st].version=j.version,tt[st].extent=j.extent;return ke({layers:tt})},Yi.exports.GeoJSONWrapper=ua;var Zl=o.dK(Yi.exports);let zn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Mt=>Mt},on=Math.fround||(mn=new Float32Array(1),Mt=>(mn[0]=+Mt,mn[0]));var mn;let Ra=3,Ca=5,tn=6;class tr{constructor(j){this.options=Object.assign(Object.create(zn),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){let{log:tt,minZoom:st,maxZoom:Yt}=this.options;tt&&console.time("total time");let Tt="prepare ".concat(j.length," points");tt&&console.time(Tt),this.points=j;let zt=[];for(let Jt=0;Jt<j.length;Jt++){let We=j[Jt];if(!We.geometry)continue;let[re,ge]=We.geometry.coordinates,_e=on(gl(re)),Mi=on(tl(ge));zt.push(_e,Mi,1/0,Jt,-1,1),this.options.reduce&&zt.push(0)}let he=this.trees[Yt+1]=this._createTree(zt);tt&&console.timeEnd(Tt);for(let Jt=Yt;Jt>=st;Jt--){let We=+Date.now();he=this.trees[Jt]=this._createTree(this._cluster(he,Jt)),tt&&console.log("z%d: %d clusters in %dms",Jt,he.numItems,+Date.now()-We)}return tt&&console.timeEnd("total time"),this}getClusters(j,tt){let st=((j[0]+180)%360+360)%360-180,Yt=Math.max(-90,Math.min(90,j[1])),Tt=j[2]===180?180:((j[2]+180)%360+360)%360-180,zt=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)st=-180,Tt=180;else if(st>Tt){let ge=this.getClusters([st,Yt,180,zt],tt),_e=this.getClusters([-180,Yt,Tt,zt],tt);return ge.concat(_e)}let he=this.trees[this._limitZoom(tt)],Jt=he.range(gl(st),tl(zt),gl(Tt),tl(Yt)),We=he.data,re=[];for(let ge of Jt){let _e=this.stride*ge;re.push(We[_e+Ca]>1?ji(We,_e,this.clusterProps):this.points[We[_e+Ra]])}return re}getChildren(j){let tt=this._getOriginId(j),st=this._getOriginZoom(j),Yt="No cluster with the specified id.",Tt=this.trees[st];if(!Tt)throw new Error(Yt);let zt=Tt.data;if(tt*this.stride>=zt.length)throw new Error(Yt);let he=this.options.radius/(this.options.extent*Math.pow(2,st-1)),Jt=Tt.within(zt[tt*this.stride],zt[tt*this.stride+1],he),We=[];for(let re of Jt){let ge=re*this.stride;zt[ge+4]===j&&We.push(zt[ge+Ca]>1?ji(zt,ge,this.clusterProps):this.points[zt[ge+Ra]])}if(We.length===0)throw new Error(Yt);return We}getLeaves(j,tt,st){let Yt=[];return this._appendLeaves(Yt,j,tt=tt||10,st=st||0,0),Yt}getTile(j,tt,st){let Yt=this.trees[this._limitZoom(j)],Tt=Math.pow(2,j),{extent:zt,radius:he}=this.options,Jt=he/zt,We=(st-Jt)/Tt,re=(st+1+Jt)/Tt,ge={features:[]};return this._addTileFeatures(Yt.range((tt-Jt)/Tt,We,(tt+1+Jt)/Tt,re),Yt.data,tt,st,Tt,ge),tt===0&&this._addTileFeatures(Yt.range(1-Jt/Tt,We,1,re),Yt.data,Tt,st,Tt,ge),tt===Tt-1&&this._addTileFeatures(Yt.range(0,We,Jt/Tt,re),Yt.data,-1,st,Tt,ge),ge.features.length?ge:null}getClusterExpansionZoom(j){let tt=this._getOriginZoom(j)-1;for(;tt<=this.options.maxZoom;){let st=this.getChildren(j);if(tt++,st.length!==1)break;j=st[0].properties.cluster_id}return tt}_appendLeaves(j,tt,st,Yt,Tt){let zt=this.getChildren(tt);for(let he of zt){let Jt=he.properties;if(Jt&&Jt.cluster?Tt+Jt.point_count<=Yt?Tt+=Jt.point_count:Tt=this._appendLeaves(j,Jt.cluster_id,st,Yt,Tt):Tt<Yt?Tt++:j.push(he),j.length===st)break}return Tt}_createTree(j){let tt=new o.bg(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let st=0;st<j.length;st+=this.stride)tt.add(j[st],j[st+1]);return tt.finish(),tt.data=j,tt}_addTileFeatures(j,tt,st,Yt,Tt,zt){for(let he of j){let Jt=he*this.stride,We=tt[Jt+Ca]>1,re,ge,_e;if(We)re=Vn(tt,Jt,this.clusterProps),ge=tt[Jt],_e=tt[Jt+1];else{let Ci=this.points[tt[Jt+Ra]];re=Ci.properties;let[xi,Gi]=Ci.geometry.coordinates;ge=gl(xi),_e=tl(Gi)}let Mi={type:1,geometry:[[Math.round(this.options.extent*(ge*Tt-st)),Math.round(this.options.extent*(_e*Tt-Yt))]],tags:re},Oi;Oi=We||this.options.generateId?tt[Jt+Ra]:this.points[tt[Jt+Ra]].id,Oi!==void 0&&(Mi.id=Oi),zt.features.push(Mi)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,tt){let{radius:st,extent:Yt,reduce:Tt,minPoints:zt}=this.options,he=st/(Yt*Math.pow(2,tt)),Jt=j.data,We=[],re=this.stride;for(let ge=0;ge<Jt.length;ge+=re){if(Jt[ge+2]<=tt)continue;Jt[ge+2]=tt;let _e=Jt[ge],Mi=Jt[ge+1],Oi=j.within(Jt[ge],Jt[ge+1],he),Ci=Jt[ge+Ca],xi=Ci;for(let Gi of Oi){let Ji=Gi*re;Jt[Ji+2]>tt&&(xi+=Jt[Ji+Ca])}if(xi>Ci&&xi>=zt){let Gi,Ji=_e*Ci,wi=Mi*Ci,ka=-1,Hi=(ge/re<<5)+(tt+1)+this.points.length;for(let hn of Oi){let rn=hn*re;if(Jt[rn+2]<=tt)continue;Jt[rn+2]=tt;let Gn=Jt[rn+Ca];Ji+=Jt[rn]*Gn,wi+=Jt[rn+1]*Gn,Jt[rn+4]=Hi,Tt&&(Gi||(Gi=this._map(Jt,ge,!0),ka=this.clusterProps.length,this.clusterProps.push(Gi)),Tt(Gi,this._map(Jt,rn)))}Jt[ge+4]=Hi,We.push(Ji/xi,wi/xi,1/0,Hi,-1,xi),Tt&&We.push(ka)}else{for(let Gi=0;Gi<re;Gi++)We.push(Jt[ge+Gi]);if(xi>1)for(let Gi of Oi){let Ji=Gi*re;if(!(Jt[Ji+2]<=tt)){Jt[Ji+2]=tt;for(let wi=0;wi<re;wi++)We.push(Jt[Ji+wi])}}}}return We}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,tt,st){if(j[tt+Ca]>1){let zt=this.clusterProps[j[tt+tn]];return st?Object.assign({},zt):zt}let Yt=this.points[j[tt+Ra]].properties,Tt=this.options.map(Yt);return st&&Tt===Yt?Object.assign({},Tt):Tt}}function ji(Mt,j,tt){return{type:"Feature",id:Mt[j+Ra],properties:Vn(Mt,j,tt),geometry:{type:"Point",coordinates:[(st=Mt[j],360*(st-.5)),wn(Mt[j+1])]}};var st}function Vn(Mt,j,tt){let st=Mt[j+Ca],Yt=st>=1e4?"".concat(Math.round(st/1e3),"k"):st>=1e3?Math.round(st/100)/10+"k":st,Tt=Mt[j+tn],zt=Tt===-1?{}:Object.assign({},tt[Tt]);return Object.assign(zt,{cluster:!0,cluster_id:Mt[j+Ra],point_count:st,point_count_abbreviated:Yt})}function gl(Mt){return Mt/360+.5}function tl(Mt){let j=Math.sin(Mt*Math.PI/180),tt=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return tt<0?0:tt>1?1:tt}function wn(Mt){let j=(180-360*Mt)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}var Vl={exports:{}};Vl.exports=function(){function Mt(Xt,yt,wt,Pt){for(var Ht,te=Pt,ee=wt-yt>>1,Dt=wt-yt,ae=Xt[yt],qt=Xt[yt+1],Be=Xt[wt],ni=Xt[wt+1],Ge=yt+3;Ge<wt;Ge+=3){var Ti=j(Xt[Ge],Xt[Ge+1],ae,qt,Be,ni);if(Ti>te)Ht=Ge,te=Ti;else if(Ti===te){var Ki=Math.abs(Ge-ee);Ki<Dt&&(Ht=Ge,Dt=Ki)}}te>Pt&&(Ht-yt>3&&Mt(Xt,yt,Ht,Pt),Xt[Ht+2]=te,wt-Ht>3&&Mt(Xt,Ht,wt,Pt))}function j(Xt,yt,wt,Pt,Ht,te){var ee=Ht-wt,Dt=te-Pt;if(ee!==0||Dt!==0){var ae=((Xt-wt)*ee+(yt-Pt)*Dt)/(ee*ee+Dt*Dt);ae>1?(wt=Ht,Pt=te):ae>0&&(wt+=ee*ae,Pt+=Dt*ae)}return(ee=Xt-wt)*ee+(Dt=yt-Pt)*Dt}function tt(Xt,yt,wt,Pt){var Ht={id:Xt===void 0?null:Xt,type:yt,geometry:wt,tags:Pt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(te){var ee=te.geometry,Dt=te.type;if(Dt==="Point"||Dt==="MultiPoint"||Dt==="LineString")st(te,ee);else if(Dt==="Polygon"||Dt==="MultiLineString")for(var ae=0;ae<ee.length;ae++)st(te,ee[ae]);else if(Dt==="MultiPolygon")for(ae=0;ae<ee.length;ae++)for(var qt=0;qt<ee[ae].length;qt++)st(te,ee[ae][qt])}(Ht),Ht}function st(Xt,yt){for(var wt=0;wt<yt.length;wt+=3)Xt.minX=Math.min(Xt.minX,yt[wt]),Xt.minY=Math.min(Xt.minY,yt[wt+1]),Xt.maxX=Math.max(Xt.maxX,yt[wt]),Xt.maxY=Math.max(Xt.maxY,yt[wt+1])}function Yt(Xt,yt,wt,Pt){if(yt.geometry){var Ht=yt.geometry.coordinates,te=yt.geometry.type,ee=Math.pow(wt.tolerance/((1<<wt.maxZoom)*wt.extent),2),Dt=[],ae=yt.id;if(wt.promoteId?ae=yt.properties[wt.promoteId]:wt.generateId&&(ae=Pt||0),te==="Point")Tt(Ht,Dt);else if(te==="MultiPoint")for(var qt=0;qt<Ht.length;qt++)Tt(Ht[qt],Dt);else if(te==="LineString")zt(Ht,Dt,ee,!1);else if(te==="MultiLineString"){if(wt.lineMetrics){for(qt=0;qt<Ht.length;qt++)zt(Ht[qt],Dt=[],ee,!1),Xt.push(tt(ae,"LineString",Dt,yt.properties));return}he(Ht,Dt,ee,!1)}else if(te==="Polygon")he(Ht,Dt,ee,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(qt=0;qt<yt.geometry.geometries.length;qt++)Yt(Xt,{id:ae,geometry:yt.geometry.geometries[qt],properties:yt.properties},wt,Pt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qt=0;qt<Ht.length;qt++){var Be=[];he(Ht[qt],Be,ee,!0),Dt.push(Be)}}Xt.push(tt(ae,te,Dt,yt.properties))}}function Tt(Xt,yt){yt.push(Jt(Xt[0])),yt.push(We(Xt[1])),yt.push(0)}function zt(Xt,yt,wt,Pt){for(var Ht,te,ee=0,Dt=0;Dt<Xt.length;Dt++){var ae=Jt(Xt[Dt][0]),qt=We(Xt[Dt][1]);yt.push(ae),yt.push(qt),yt.push(0),Dt>0&&(ee+=Pt?(Ht*qt-ae*te)/2:Math.sqrt(Math.pow(ae-Ht,2)+Math.pow(qt-te,2))),Ht=ae,te=qt}var Be=yt.length-3;yt[2]=1,Mt(yt,0,Be,wt),yt[Be+2]=1,yt.size=Math.abs(ee),yt.start=0,yt.end=yt.size}function he(Xt,yt,wt,Pt){for(var Ht=0;Ht<Xt.length;Ht++){var te=[];zt(Xt[Ht],te,wt,Pt),yt.push(te)}}function Jt(Xt){return Xt/360+.5}function We(Xt){var yt=Math.sin(Xt*Math.PI/180),wt=.5-.25*Math.log((1+yt)/(1-yt))/Math.PI;return wt<0?0:wt>1?1:wt}function re(Xt,yt,wt,Pt,Ht,te,ee,Dt){if(Pt/=yt,te>=(wt/=yt)&&ee<Pt)return Xt;if(ee<wt||te>=Pt)return null;for(var ae=[],qt=0;qt<Xt.length;qt++){var Be=Xt[qt],ni=Be.geometry,Ge=Be.type,Ti=Ht===0?Be.minX:Be.minY,Ki=Ht===0?Be.maxX:Be.maxY;if(Ti>=wt&&Ki<Pt)ae.push(Be);else if(!(Ki<wt||Ti>=Pt)){var Li=[];if(Ge==="Point"||Ge==="MultiPoint")ge(ni,Li,wt,Pt,Ht);else if(Ge==="LineString")_e(ni,Li,wt,Pt,Ht,!1,Dt.lineMetrics);else if(Ge==="MultiLineString")Oi(ni,Li,wt,Pt,Ht,!1);else if(Ge==="Polygon")Oi(ni,Li,wt,Pt,Ht,!0);else if(Ge==="MultiPolygon")for(var Fa=0;Fa<ni.length;Fa++){var Oa=[];Oi(ni[Fa],Oa,wt,Pt,Ht,!0),Oa.length&&Li.push(Oa)}if(Li.length){if(Dt.lineMetrics&&Ge==="LineString"){for(Fa=0;Fa<Li.length;Fa++)ae.push(tt(Be.id,Ge,Li[Fa],Be.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(Li.length===1?(Ge="LineString",Li=Li[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=Li.length===3?"Point":"MultiPoint"),ae.push(tt(Be.id,Ge,Li,Be.tags))}}}return ae.length?ae:null}function ge(Xt,yt,wt,Pt,Ht){for(var te=0;te<Xt.length;te+=3){var ee=Xt[te+Ht];ee>=wt&&ee<=Pt&&(yt.push(Xt[te]),yt.push(Xt[te+1]),yt.push(Xt[te+2]))}}function _e(Xt,yt,wt,Pt,Ht,te,ee){for(var Dt,ae,qt=Mi(Xt),Be=Ht===0?xi:Gi,ni=Xt.start,Ge=0;Ge<Xt.length-3;Ge+=3){var Ti=Xt[Ge],Ki=Xt[Ge+1],Li=Xt[Ge+2],Fa=Xt[Ge+3],Oa=Xt[Ge+4],Vi=Ht===0?Ti:Ki,Mn=Ht===0?Fa:Oa,il=!1;ee&&(Dt=Math.sqrt(Math.pow(Ti-Fa,2)+Math.pow(Ki-Oa,2))),Vi<wt?Mn>wt&&(ae=Be(qt,Ti,Ki,Fa,Oa,wt),ee&&(qt.start=ni+Dt*ae)):Vi>Pt?Mn<Pt&&(ae=Be(qt,Ti,Ki,Fa,Oa,Pt),ee&&(qt.start=ni+Dt*ae)):Ci(qt,Ti,Ki,Li),Mn<wt&&Vi>=wt&&(ae=Be(qt,Ti,Ki,Fa,Oa,wt),il=!0),Mn>Pt&&Vi<=Pt&&(ae=Be(qt,Ti,Ki,Fa,Oa,Pt),il=!0),!te&&il&&(ee&&(qt.end=ni+Dt*ae),yt.push(qt),qt=Mi(Xt)),ee&&(ni+=Dt)}var Da=Xt.length-3;Ti=Xt[Da],Ki=Xt[Da+1],Li=Xt[Da+2],(Vi=Ht===0?Ti:Ki)>=wt&&Vi<=Pt&&Ci(qt,Ti,Ki,Li),Da=qt.length-3,te&&Da>=3&&(qt[Da]!==qt[0]||qt[Da+1]!==qt[1])&&Ci(qt,qt[0],qt[1],qt[2]),qt.length&&yt.push(qt)}function Mi(Xt){var yt=[];return yt.size=Xt.size,yt.start=Xt.start,yt.end=Xt.end,yt}function Oi(Xt,yt,wt,Pt,Ht,te){for(var ee=0;ee<Xt.length;ee++)_e(Xt[ee],yt,wt,Pt,Ht,te,!1)}function Ci(Xt,yt,wt,Pt){Xt.push(yt),Xt.push(wt),Xt.push(Pt)}function xi(Xt,yt,wt,Pt,Ht,te){var ee=(te-yt)/(Pt-yt);return Xt.push(te),Xt.push(wt+(Ht-wt)*ee),Xt.push(1),ee}function Gi(Xt,yt,wt,Pt,Ht,te){var ee=(te-wt)/(Ht-wt);return Xt.push(yt+(Pt-yt)*ee),Xt.push(te),Xt.push(1),ee}function Ji(Xt,yt){for(var wt=[],Pt=0;Pt<Xt.length;Pt++){var Ht,te=Xt[Pt],ee=te.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")Ht=wi(te.geometry,yt);else if(ee==="MultiLineString"||ee==="Polygon"){Ht=[];for(var Dt=0;Dt<te.geometry.length;Dt++)Ht.push(wi(te.geometry[Dt],yt))}else if(ee==="MultiPolygon")for(Ht=[],Dt=0;Dt<te.geometry.length;Dt++){for(var ae=[],qt=0;qt<te.geometry[Dt].length;qt++)ae.push(wi(te.geometry[Dt][qt],yt));Ht.push(ae)}wt.push(tt(te.id,ee,Ht,te.tags))}return wt}function wi(Xt,yt){var wt=[];wt.size=Xt.size,Xt.start!==void 0&&(wt.start=Xt.start,wt.end=Xt.end);for(var Pt=0;Pt<Xt.length;Pt+=3)wt.push(Xt[Pt]+yt,Xt[Pt+1],Xt[Pt+2]);return wt}function ka(Xt,yt){if(Xt.transformed)return Xt;var wt,Pt,Ht,te=1<<Xt.z,ee=Xt.x,Dt=Xt.y;for(wt=0;wt<Xt.features.length;wt++){var ae=Xt.features[wt],qt=ae.geometry,Be=ae.type;if(ae.geometry=[],Be===1)for(Pt=0;Pt<qt.length;Pt+=2)ae.geometry.push(Hi(qt[Pt],qt[Pt+1],yt,te,ee,Dt));else for(Pt=0;Pt<qt.length;Pt++){var ni=[];for(Ht=0;Ht<qt[Pt].length;Ht+=2)ni.push(Hi(qt[Pt][Ht],qt[Pt][Ht+1],yt,te,ee,Dt));ae.geometry.push(ni)}}return Xt.transformed=!0,Xt}function Hi(Xt,yt,wt,Pt,Ht,te){return[Math.round(wt*(Xt*Pt-Ht)),Math.round(wt*(yt*Pt-te))]}function hn(Xt,yt,wt,Pt,Ht){for(var te=yt===Ht.maxZoom?0:Ht.tolerance/((1<<yt)*Ht.extent),ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:wt,y:Pt,z:yt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Dt=0;Dt<Xt.length;Dt++){ee.numFeatures++,rn(ee,Xt[Dt],te,Ht);var ae=Xt[Dt].minX,qt=Xt[Dt].minY,Be=Xt[Dt].maxX,ni=Xt[Dt].maxY;ae<ee.minX&&(ee.minX=ae),qt<ee.minY&&(ee.minY=qt),Be>ee.maxX&&(ee.maxX=Be),ni>ee.maxY&&(ee.maxY=ni)}return ee}function rn(Xt,yt,wt,Pt){var Ht=yt.geometry,te=yt.type,ee=[];if(te==="Point"||te==="MultiPoint")for(var Dt=0;Dt<Ht.length;Dt+=3)ee.push(Ht[Dt]),ee.push(Ht[Dt+1]),Xt.numPoints++,Xt.numSimplified++;else if(te==="LineString")Gn(ee,Ht,Xt,wt,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(Dt=0;Dt<Ht.length;Dt++)Gn(ee,Ht[Dt],Xt,wt,te==="Polygon",Dt===0);else if(te==="MultiPolygon")for(var ae=0;ae<Ht.length;ae++){var qt=Ht[ae];for(Dt=0;Dt<qt.length;Dt++)Gn(ee,qt[Dt],Xt,wt,!0,Dt===0)}if(ee.length){var Be=yt.tags||null;if(te==="LineString"&&Pt.lineMetrics){for(var ni in Be={},yt.tags)Be[ni]=yt.tags[ni];Be.mapbox_clip_start=Ht.start/Ht.size,Be.mapbox_clip_end=Ht.end/Ht.size}var Ge={geometry:ee,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:Be};yt.id!==null&&(Ge.id=yt.id),Xt.features.push(Ge)}}function Gn(Xt,yt,wt,Pt,Ht,te){var ee=Pt*Pt;if(Pt>0&&yt.size<(Ht?ee:Pt))wt.numPoints+=yt.length/3;else{for(var Dt=[],ae=0;ae<yt.length;ae+=3)(Pt===0||yt[ae+2]>ee)&&(wt.numSimplified++,Dt.push(yt[ae]),Dt.push(yt[ae+1])),wt.numPoints++;Ht&&function(qt,Be){for(var ni=0,Ge=0,Ti=qt.length,Ki=Ti-2;Ge<Ti;Ki=Ge,Ge+=2)ni+=(qt[Ge]-qt[Ki])*(qt[Ge+1]+qt[Ki+1]);if(ni>0===Be)for(Ge=0,Ti=qt.length;Ge<Ti/2;Ge+=2){var Li=qt[Ge],Fa=qt[Ge+1];qt[Ge]=qt[Ti-2-Ge],qt[Ge+1]=qt[Ti-1-Ge],qt[Ti-2-Ge]=Li,qt[Ti-1-Ge]=Fa}}(Dt,te),Xt.push(Dt)}}function Ga(Xt,yt){var wt=(yt=this.options=function(Ht,te){for(var ee in te)Ht[ee]=te[ee];return Ht}(Object.create(this.options),yt)).debug;if(wt&&console.time("preprocess data"),yt.maxZoom<0||yt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(yt.promoteId&&yt.generateId)throw new Error("promoteId and generateId cannot be used together.");var Pt=function(Ht,te){var ee=[];if(Ht.type==="FeatureCollection")for(var Dt=0;Dt<Ht.features.length;Dt++)Yt(ee,Ht.features[Dt],te,Dt);else Yt(ee,Ht.type==="Feature"?Ht:{geometry:Ht},te);return ee}(Xt,yt);this.tiles={},this.tileCoords=[],wt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",yt.indexMaxZoom,yt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Pt=function(Ht,te){var ee=te.buffer/te.extent,Dt=Ht,ae=re(Ht,1,-1-ee,ee,0,-1,2,te),qt=re(Ht,1,1-ee,2+ee,0,-1,2,te);return(ae||qt)&&(Dt=re(Ht,1,-ee,1+ee,0,-1,2,te)||[],ae&&(Dt=Ji(ae,1).concat(Dt)),qt&&(Dt=Dt.concat(Ji(qt,-1)))),Dt}(Pt,yt)).length&&this.splitTile(Pt,0,0,0),wt&&(Pt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Za(Xt,yt,wt){return 32*((1<<Xt)*wt+yt)+Xt}return Ga.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ga.prototype.splitTile=function(Xt,yt,wt,Pt,Ht,te,ee){for(var Dt=[Xt,yt,wt,Pt],ae=this.options,qt=ae.debug;Dt.length;){Pt=Dt.pop(),wt=Dt.pop(),yt=Dt.pop(),Xt=Dt.pop();var Be=1<<yt,ni=Za(yt,wt,Pt),Ge=this.tiles[ni];if(!Ge&&(qt>1&&console.time("creation"),Ge=this.tiles[ni]=hn(Xt,yt,wt,Pt,ae),this.tileCoords.push({z:yt,x:wt,y:Pt}),qt)){qt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",yt,wt,Pt,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Ti="z"+yt;this.stats[Ti]=(this.stats[Ti]||0)+1,this.total++}if(Ge.source=Xt,Ht){if(yt===ae.maxZoom||yt===Ht)continue;var Ki=1<<Ht-yt;if(wt!==Math.floor(te/Ki)||Pt!==Math.floor(ee/Ki))continue}else if(yt===ae.indexMaxZoom||Ge.numPoints<=ae.indexMaxPoints)continue;if(Ge.source=null,Xt.length!==0){qt>1&&console.time("clipping");var Li,Fa,Oa,Vi,Mn,il,Da=.5*ae.buffer/ae.extent,qr=.5-Da,ql=.5+Da,er=1+Da;Li=Fa=Oa=Vi=null,Mn=re(Xt,Be,wt-Da,wt+ql,0,Ge.minX,Ge.maxX,ae),il=re(Xt,Be,wt+qr,wt+er,0,Ge.minX,Ge.maxX,ae),Xt=null,Mn&&(Li=re(Mn,Be,Pt-Da,Pt+ql,1,Ge.minY,Ge.maxY,ae),Fa=re(Mn,Be,Pt+qr,Pt+er,1,Ge.minY,Ge.maxY,ae),Mn=null),il&&(Oa=re(il,Be,Pt-Da,Pt+ql,1,Ge.minY,Ge.maxY,ae),Vi=re(il,Be,Pt+qr,Pt+er,1,Ge.minY,Ge.maxY,ae),il=null),qt>1&&console.timeEnd("clipping"),Dt.push(Li||[],yt+1,2*wt,2*Pt),Dt.push(Fa||[],yt+1,2*wt,2*Pt+1),Dt.push(Oa||[],yt+1,2*wt+1,2*Pt),Dt.push(Vi||[],yt+1,2*wt+1,2*Pt+1)}}},Ga.prototype.getTile=function(Xt,yt,wt){var Pt=this.options,Ht=Pt.extent,te=Pt.debug;if(Xt<0||Xt>24)return null;var ee=1<<Xt,Dt=Za(Xt,yt=(yt%ee+ee)%ee,wt);if(this.tiles[Dt])return ka(this.tiles[Dt],Ht);te>1&&console.log("drilling down to z%d-%d-%d",Xt,yt,wt);for(var ae,qt=Xt,Be=yt,ni=wt;!ae&&qt>0;)qt--,Be=Math.floor(Be/2),ni=Math.floor(ni/2),ae=this.tiles[Za(qt,Be,ni)];return ae&&ae.source?(te>1&&console.log("found parent tile z%d-%d-%d",qt,Be,ni),te>1&&console.time("drilling down"),this.splitTile(ae.source,qt,Be,ni,Xt,yt,wt),te>1&&console.timeEnd("drilling down"),this.tiles[Dt]?ka(this.tiles[Dt],Ht):null):null},function(Xt,yt){return new Ga(Xt,yt)}}();var sa=o.dK(Vl.exports);function Pl(Mt,j){let tt=Mt.tileID.canonical;if(!this._geoJSONIndex)return j(null,null);let st=this._geoJSONIndex.getTile(tt.z,tt.x,tt.y);if(!st)return j(null,null);let Yt=new Nt(st.features),Tt=Zl(Yt);Tt.byteOffset===0&&Tt.byteLength===Tt.buffer.byteLength||(Tt=new Uint8Array(Tt)),j(null,{vectorTile:Yt,rawData:Tt.buffer})}class Kl extends qe{constructor(j,tt,st,Yt,Tt,zt){super(j,tt,st,Yt,Pl,zt),Tt&&(this.loadGeoJSON=Tt)}loadData(j,tt){let st=j&&j.request,Yt=st&&st.collectResourceTiming;this.loadGeoJSON(j,(Tt,zt)=>{if(Tt||!zt)return tt(Tt);if(typeof zt!="object")return tt(new Error("Input data given to '".concat(j.source,"' is not a valid GeoJSON object.")));{vi(zt,!0);try{if(j.filter){let Jt=o.r(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Jt.result==="error")throw new Error(Jt.value.map(re=>"".concat(re.key,": ").concat(re.message)).join(", "));zt={type:"FeatureCollection",features:zt.features.filter(re=>Jt.value.evaluate({zoom:0},re))}}this._geoJSONIndex=j.cluster?new tr(function({superclusterOptions:Jt,clusterProperties:We}){if(!We||!Jt)return Jt;let re={},ge={},_e={accumulated:null,zoom:0},Mi={properties:null},Oi=Object.keys(We);for(let Ci of Oi){let[xi,Gi]=We[Ci],Ji=o.r(Gi),wi=o.r(typeof xi=="string"?[xi,["accumulated"],["get",Ci]]:xi);re[Ci]=Ji.value,ge[Ci]=wi.value}return Jt.map=Ci=>{Mi.properties=Ci;let xi={};for(let Gi of Oi)xi[Gi]=re[Gi].evaluate(_e,Mi);return xi},Jt.reduce=(Ci,xi)=>{Mi.properties=xi;for(let Gi of Oi)_e.accumulated=Ci[Gi],Ci[Gi]=ge[Gi].evaluate(_e,Mi)},Jt}(j)).load(zt.features):sa(zt,j.geojsonVtOptions)}catch(Jt){return tt(Jt)}this.loaded={};let he={};if(Yt){let Jt=_(st);Jt&&(he.resourceTiming={},he.resourceTiming[j.source]=JSON.parse(JSON.stringify(Jt)))}tt(null,he)}})}reloadTile(j,tt){let st=this.loaded;return st&&st[j.uid]?super.reloadTile(j,tt):this.loadTile(j,tt)}loadGeoJSON(j,tt){if(j.request)o.g(j.request,tt);else{if(typeof j.data!="string")return tt(new Error("Input data given to '".concat(j.source,"' is not a valid GeoJSON object.")));try{return tt(null,JSON.parse(j.data))}catch{return tt(new Error("Input data given to '".concat(j.source,"' is not a valid GeoJSON object.")))}}}getClusterExpansionZoom(j,tt){try{tt(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(st){tt(st)}}getClusterChildren(j,tt){try{tt(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(st){tt(st)}}getClusterLeaves(j,tt){try{tt(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(st){tt(st)}}}class Ta{constructor(j,tt){this.tileID=new o.am(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.tileZoom=j.tileZoom,this.uid=j.uid,this.zoom=j.zoom,this.canonical=j.tileID.canonical,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=j.projection,this.brightness=tt}parse(j,tt,st,Yt){this.status="parsing";let Tt=new o.am(st.tileID.overscaledZ,st.tileID.wrap,st.tileID.canonical.z,st.tileID.canonical.x,st.tileID.canonical.y),zt={},he=tt.familiesBySource[st.source],Jt=new o.dC(Tt,st.promoteId);return Jt.bucketLayerIDs=[],Jt.is3DTile=!0,o.dP(j).then(We=>{if(!We)return Yt(new Error("Could not parse tile"));let re=o.dQ(We,1/o.bR(st.tileID.canonical)),ge=We.json.extensionsUsed&&We.json.extensionsUsed.includes("MAPBOX_mesh_features")||We.json.asset.extras&&We.json.asset.extras.MAPBOX_mesh_features,_e=We.json.extensionsUsed&&We.json.extensionsUsed.includes("EXT_meshopt_compression"),Mi=new o.K(this.zoom,{brightness:this.brightness});for(let Oi in he)for(let Ci of he[Oi]){let xi=Ci[0];Jt.bucketLayerIDs.push(Ci.map(Ji=>Ji.id)),xi.recalculate(Mi,[]);let Gi=new o.dR(re,Tt,ge,_e,this.brightness,Jt);ge||(Gi.needsUpload=!0),zt[xi.fqid]=Gi,Gi.evaluate(xi)}this.status="done",Yt(null,{buckets:zt,featureIndex:Jt})}).catch(We=>Yt(new Error(We.message)))}}class Rn{constructor(j,tt,st,Yt,Tt,zt){this.actor=j,this.layerIndex=tt,this.brightness=zt,this.loading={},this.loaded={}}loadTile(j,tt){let st=j.uid,Yt=this.loading[st]=new Ta(j,this.brightness);o.a_(j.request,(Tt,zt)=>{let he=!this.loading[st];return delete this.loading[st],he||Tt?(Yt.status="done",he||(this.loaded[st]=Yt),tt(Tt)):zt&&zt.byteLength!==0?void Yt.parse(zt,this.layerIndex,j,(Jt,We)=>{Yt.status="done",this.loaded=this.loaded||{},this.loaded[st]=Yt,Jt||!We?tt(Jt):tt(null,We)}):(Yt.status="done",this.loaded[st]=Yt,tt())})}reloadTile(j,tt){let st=this.loaded,Yt=j.uid;if(st&&st[Yt]){let Tt=st[Yt];Tt.projection=j.projection,Tt.brightness=j.brightness;let zt=(he,Jt)=>{Tt.reloadCallback&&(delete Tt.reloadCallback,this.loadTile(j,tt)),tt(he,Jt)};Tt.status==="parsing"?Tt.reloadCallback=zt:Tt.status==="done"&&this.loadTile(j,tt)}}abortTile(j,tt){let st=j.uid;this.loading[st]&&delete this.loading[st],tt()}removeTile(j,tt){let st=this.loaded,Yt=j.uid;st&&st[Yt]&&delete st[Yt],tt()}}class el{constructor(j){this.self=j,this.actor=new o.dS(j,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bo({name:"mercator"}),this.workerSourceTypes={vector:qe,geojson:Kl,"batched-model":Rn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(tt,st)=>{if(this.workerSourceTypes[tt])throw new Error('Worker source with name "'.concat(tt,'" already registered.'));this.workerSourceTypes[tt]=st},this.self.registerRTLTextPlugin=tt=>{if(o.dT.isParsed())throw new Error("RTL text plugin already registered.");o.dT.applyArabicShaping=tt.applyArabicShaping,o.dT.processBidirectionalText=tt.processBidirectionalText,o.dT.processStyledBidirectionalText=tt.processStyledBidirectionalText}}clearCaches(j,tt,st){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],delete this.rasterArrayWorkerSource,st()}checkIfReady(j,tt,st){st()}setReferrer(j,tt){this.referrer=tt}spriteLoaded(j,{scope:tt,isLoaded:st}){if(this.isSpriteLoaded[j]||(this.isSpriteLoaded[j]={}),this.isSpriteLoaded[j][tt]=st,this.workerSources[j]&&this.workerSources[j][tt])for(let Yt in this.workerSources[j][tt]){let Tt=this.workerSources[j][tt][Yt];for(let zt in Tt)Tt[zt]instanceof qe&&(Tt[zt].isSpriteLoaded=st,Tt[zt].fire(new o.b("isSpriteLoaded")))}}setImages(j,{scope:tt,images:st},Yt){if(this.availableImages[j]||(this.availableImages[j]={}),this.availableImages[j][tt]=st,this.workerSources[j]&&this.workerSources[j][tt]){for(let Tt in this.workerSources[j][tt]){let zt=this.workerSources[j][tt][Tt];for(let he in zt)zt[he].availableImages=st}Yt()}else Yt()}setProjection(j,tt){this.projections[j]=o.bo(tt)}setBrightness(j,tt,st){this.brightness=tt,st()}setLayers(j,tt,st){this.getLayerIndex(j,tt.scope).replace(tt.layers,tt.options),st()}updateLayers(j,tt,st){this.getLayerIndex(j,tt.scope).update(tt.layers,tt.removedIds,tt.options),st()}loadTile(j,tt,st){tt.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,tt.type,tt.source,tt.scope).loadTile(tt,st)}loadDEMTile(j,tt,st){this.getDEMWorkerSource(j,tt.source,tt.scope).loadTile(tt,st)}decodeRasterArray(j,tt,st){this.getRasterArrayWorkerSource().decodeRasterArray(tt,st)}reloadTile(j,tt,st){tt.projection=this.projections[j]||this.defaultProjection,this.getWorkerSource(j,tt.type,tt.source,tt.scope).reloadTile(tt,st)}abortTile(j,tt,st){this.getWorkerSource(j,tt.type,tt.source,tt.scope).abortTile(tt,st)}removeTile(j,tt,st){this.getWorkerSource(j,tt.type,tt.source,tt.scope).removeTile(tt,st)}removeSource(j,tt,st){if(!(this.workerSources[j]&&this.workerSources[j][tt.scope]&&this.workerSources[j][tt.scope][tt.type]&&this.workerSources[j][tt.scope][tt.type][tt.source]))return;let Yt=this.workerSources[j][tt.scope][tt.type][tt.source];delete this.workerSources[j][tt.scope][tt.type][tt.source],Yt.removeSource!==void 0?Yt.removeSource(tt,st):st()}loadWorkerSource(j,tt,st){try{this.self.importScripts(tt.url),st()}catch(Yt){st(Yt.toString())}}syncRTLPluginState(j,tt,st){try{o.dT.setState(tt);let Yt=o.dT.getPluginURL();if(o.dT.isLoaded()&&!o.dT.isParsed()&&Yt!=null){this.self.importScripts(Yt);let Tt=o.dT.isParsed();st(Tt?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(Yt)),Tt)}}catch(Yt){st(Yt.toString())}}setDracoUrl(j,tt){this.dracoUrl=tt}getAvailableImages(j,tt){this.availableImages[j]||(this.availableImages[j]={});let st=this.availableImages[j][tt];return st||(st=[]),st}getLayerIndex(j,tt){this.layerIndexes[j]||(this.layerIndexes[j]={});let st=this.layerIndexes[j][tt];return st||(st=this.layerIndexes[j][tt]=new Ot,st.scope=tt),st}getWorkerSource(j,tt,st,Yt){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][Yt]||(this.workerSources[j][Yt]={}),this.workerSources[j][Yt][tt]||(this.workerSources[j][Yt][tt]={}),this.isSpriteLoaded[j]||(this.isSpriteLoaded[j]={}),!this.workerSources[j][Yt][tt][st]){let Tt={send:(zt,he,Jt,We,re,ge)=>{this.actor.send(zt,he,Jt,j,re,ge)},scheduler:this.actor.scheduler};this.workerSources[j][Yt][tt][st]=new this.workerSourceTypes[tt](Tt,this.getLayerIndex(j,Yt),this.getAvailableImages(j,Yt),this.isSpriteLoaded[j][Yt],void 0,this.brightness)}return this.workerSources[j][Yt][tt][st]}getDEMWorkerSource(j,tt,st){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][st]||(this.demWorkerSources[j][st]={}),this.demWorkerSources[j][st][tt]||(this.demWorkerSources[j][st][tt]=new Le),this.demWorkerSources[j][st][tt]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ee),this.rasterArrayWorkerSource}enforceCacheSizeLimit(j,tt){o.dU(tt)}getWorkerPerformanceMetrics(j,tt,st){st(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new el(self)),el}),C(["./shared"],function(o){"use strict";function _(d,a){if(Array.isArray(d)){if(!Array.isArray(a)||d.length!==a.length)return!1;for(let l=0;l<d.length;l++)if(!_(d[l],a[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&a!==null){if(typeof a!="object"||Object.keys(d).length!==Object.keys(a).length)return!1;for(let l in d)if(!_(d[l],a[l]))return!1;return!0}return d===a}var ct=lt;function lt(d){return!function(a){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var c,m,p=new Blob([""],{type:"text/javascript"}),Z=URL.createObjectURL(p);try{m=new Worker(Z),c=!0}catch{c=!1}return m&&m.terminate(),URL.revokeObjectURL(Z),c}()?function(){var c=document.createElement("canvas");c.width=c.height=1;var m=c.getContext("2d");if(!m)return!1;var p=m.getImageData(0,0,1,1);return p&&p.width===c.width}()?(Ot[l=a&&a.failIfMajorPerformanceCaveat]===void 0&&(Ot[l]=function(c){var m,p=function(Z){var R=document.createElement("canvas"),I=Object.create(lt.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=Z,R.getContext("webgl2",I)}(c);if(!p)return!1;try{m=p.createShader(p.VERTEX_SHADER)}catch{return!1}return!(!m||p.isContextLost())&&(p.shaderSource(m,"void main() {}"),p.compileShader(m),p.getShaderParameter(m,p.COMPILE_STATUS)===!0)}(l)),Ot[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var l}(d)}var Ot={};function Ut(d,a,l){let c=document.createElement(d);return a!=null&&(c.className=a),l&&l.appendChild(c),c}function de(d,a,l){let c=document.createElementNS("http://www.w3.org/2000/svg",d);for(let m of Object.keys(a))c.setAttributeNS(null,m,String(a[m]));return l&&l.appendChild(c),c}lt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Ze=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Fe=Ze&&Ze.userSelect!==void 0?"userSelect":"WebkitUserSelect",qe;function Le(){Ze&&Fe&&(qe=Ze[Fe],Ze[Fe]="none")}function Ee(){Ze&&Fe&&(Ze[Fe]=qe)}function hi(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",hi,!0)}function Xi(){window.addEventListener("click",hi,!0),window.setTimeout(()=>{window.removeEventListener("click",hi,!0)},0)}function vi(d,a){let l=d.getBoundingClientRect();return Nt(d,l,a)}function Se(d,a){let l=d.getBoundingClientRect(),c=[];for(let m=0;m<a.length;m++)c.push(Nt(d,l,a[m]));return c}function Zi(d){return window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function Nt(d,a,l){let c=d.offsetWidth===a.width?1:d.offsetWidth/a.width;return new o.P((l.clientX-a.left)*c,(l.clientY-a.top)*c)}class Yi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(a,l){this._updatedSourceCaches[a]=l,this.setDirty()}discardSourceCacheUpdate(a){delete this._updatedSourceCaches[a]}updateLayer(a){let l=a.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(a.id),this.setDirty()}removeLayer(a){let l=a.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][a.id]=a,this._updatedLayers[l].delete(a.id),this._updatedPaintProps.delete(a.fqid),this.setDirty()}getRemovedLayer(a){return this._removedLayers[a.scope]?this._removedLayers[a.scope][a.id]:null}discardLayerRemoval(a){this._removedLayers[a.scope]&&delete this._removedLayers[a.scope][a.id]}getLayerUpdatesByScope(){let a={};for(let l in this._updatedLayers)a[l]=a[l]||{},a[l].updatedIds=Array.from(this._updatedLayers[l].values());for(let l in this._removedLayers)a[l]=a[l]||{},a[l].removedIds=Object.keys(this._removedLayers[l]);return a}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(a){this._updatedPaintProps.add(a.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(a){this._updatedImages.add(a),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Pi extends o.E{constructor(a){super(),this.requestManager=a,this.models={"":{}},this.numModelsLoading={}}loadModel(a,l){return o.l(this.requestManager.transformRequest(l,o.R.Model).url).then(c=>{if(!c)return;let m=o.c(c),p=new o.M(a,void 0,void 0,m);return p.computeBoundsAndApplyParent(),p}).catch(c=>{this.fire(new o.a(new Error("Could not load model ".concat(a," from ").concat(l,": ").concat(c.message))))})}load(a,l){this.models[l]||(this.models[l]={});let c=Object.keys(a);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+c.length;let m=[];for(let p of c)m.push(this.loadModel(p,a[p]));Promise.allSettled(m).then(p=>{for(let Z=0;Z<p.length;Z++){let{status:R,value:I}=p[Z];R==="fulfilled"&&I&&(this.models[l][c[Z]]=I)}this.numModelsLoading[l]-=c.length,this.fire(new o.b("data",{dataType:"style"}))}).catch(p=>{this.fire(new o.a(new Error("Could not load models: ".concat(p.message))))})}isLoaded(){for(let a in this.numModelsLoading)if(this.numModelsLoading[a]>0)return!1;return!0}hasModel(a,l){return!!this.getModel(a,l)}getModel(a,l){return this.models[l]||(this.models[l]={}),this.models[l][a]}addModel(a,l,c){this.models[c]||(this.models[c]={}),this.hasModel(a,c)&&this.removeModel(a,c),this.load({[a]:this.requestManager.normalizeModelURL(l)},c)}addModels(a,l){let c={};for(let m in a)c[m]=this.requestManager.normalizeModelURL(a[m]);this.load(c,l)}removeModel(a,l){this.models[l]||(this.models[l]={});let c=this.models[l][a];delete this.models[l][a],c.destroy()}listModels(a){return this.models[a]||(this.models[a]={}),Object.keys(this.models[a])}upload(a,l){this.models[l]||(this.models[l]={});for(let c in this.models[l])this.models[l][c].upload(a.context)}}class ye{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,l,c){let m=String(l);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][m]=this.stateChanges[a][m]||{},o.e(this.stateChanges[a][m],c),this.deletedStates[a]===null){this.deletedStates[a]={};for(let p in this.state[a])p!==m&&(this.deletedStates[a][p]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][m]===null){this.deletedStates[a][m]={};for(let p in this.state[a][m])c[p]||(this.deletedStates[a][m][p]=null)}else for(let p in c)this.deletedStates[a]&&this.deletedStates[a][m]&&this.deletedStates[a][m][p]===null&&delete this.deletedStates[a][m][p]}removeFeatureState(a,l,c){if(this.deletedStates[a]===null)return;let m=String(l);if(this.deletedStates[a]=this.deletedStates[a]||{},c&&l!==void 0)this.deletedStates[a][m]!==null&&(this.deletedStates[a][m]=this.deletedStates[a][m]||{},this.deletedStates[a][m][c]=null);else if(l!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][m])for(c in this.deletedStates[a][m]={},this.stateChanges[a][m])this.deletedStates[a][m][c]=null;else this.deletedStates[a][m]=null;else this.deletedStates[a]=null}getState(a,l){let c=String(l),m=o.e({},(this.state[a]||{})[c],(this.stateChanges[a]||{})[c]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){let p=this.deletedStates[a][l];if(p===null)return{};for(let Z in p)delete m[Z]}return m}initializeTileState(a,l){a.setFeatureState(this.state,l)}coalesceChanges(a,l){let c={};for(let m in this.stateChanges){this.state[m]=this.state[m]||{};let p={};for(let Z in this.stateChanges[m])this.state[m][Z]||(this.state[m][Z]={}),o.e(this.state[m][Z],this.stateChanges[m][Z]),p[Z]=this.state[m][Z];c[m]=p}for(let m in this.deletedStates){this.state[m]=this.state[m]||{};let p={};if(this.deletedStates[m]===null)for(let Z in this.state[m])p[Z]={},this.state[m][Z]={};else for(let Z in this.deletedStates[m]){if(this.deletedStates[m][Z]===null)this.state[m][Z]={};else if(this.state[m][Z])for(let R of Object.keys(this.deletedStates[m][Z]))delete this.state[m][Z][R];p[Z]=this.state[m][Z]}c[m]=c[m]||{},o.e(c[m],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let m in a)a[m].setFeatureState(c,l)}}function Bi(d){let{userImage:a}=d;return!!(a&&a.render&&a.render())&&(d.data.replace(new Uint8Array(a.data.buffer)),!0)}class Ya extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(a){this.images[a]={},this.loaded[a]=!1,this.updatedImages[a]={},this.patterns[a]={},this.callbackDispatchedThisFrame[a]={},this.atlasImage[a]=new o.h({width:1,height:1})}isLoaded(){for(let a in this.loaded)if(!this.loaded[a])return!1;return!0}setLoaded(a,l){if(this.loaded[l]!==a&&(this.loaded[l]=a,a)){for(let{ids:c,callback:m}of this.requestors)this._notify(c,l,m);this.requestors=[]}}hasImage(a,l){return!!this.getImage(a,l)}getImage(a,l){return this.images[l][a]}addImage(a,l,c){this._validate(a,c)&&(this.images[l][a]=c)}_validate(a,l){let c=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.a(new Error('Image "'.concat(a,'" has invalid "stretchX" value')))),c=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.a(new Error('Image "'.concat(a,'" has invalid "stretchY" value')))),c=!1),this._validateContent(l.content,l)||(this.fire(new o.a(new Error('Image "'.concat(a,'" has invalid "content" value')))),c=!1),c}_validateStretch(a,l){if(!a)return!0;let c=0;for(let m of a){if(m[0]<c||m[1]<m[0]||l<m[1])return!1;c=m[1]}return!0}_validateContent(a,l){return!(a&&(a.length!==4||a[0]<0||l.data.width<a[0]||a[1]<0||l.data.height<a[1]||a[2]<0||l.data.width<a[2]||a[3]<0||l.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,l,c){c.version=this.images[l][a].version+1,this.images[l][a]=c,this.updatedImages[l][a]=!0}removeImage(a,l){let c=this.images[l][a];delete this.images[l][a],delete this.patterns[l][a],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(a){return Object.keys(this.images[a])}getImages(a,l,c){let m=!0,p=!!this.loaded[l];if(!p)for(let Z of a)this.images[l][Z]||(m=!1);p||m?this._notify(a,l,c):this.requestors.push({ids:a,scope:l,callback:c})}getUpdatedImages(a){return this.updatedImages[a]}_notify(a,l,c){let m={};for(let p of a){this.images[l][p]||this.fire(new o.b("styleimagemissing",{id:p}));let Z=this.images[l][p];Z?m[p]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:!!(Z.userImage&&Z.userImage.render)}:o.w('Image "'.concat(p,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}c(null,m)}getPixelSize(a){let{width:l,height:c}=this.atlasImage[a];return{width:l,height:c}}getPattern(a,l){let c=this.patterns[l][a],m=this.getImage(a,l);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{let p={w:m.data.width+2,h:m.data.height+2,x:0,y:0},Z=new o.I(p,m);this.patterns[l][a]={bin:p,position:Z}}return this._updatePatternAtlas(l),this.patterns[l][a].position}bind(a,l){let c=a.gl,m=this.atlasTexture[l];m?this.dirty&&(m.update(this.atlasImage[l]),this.dirty=!1):(m=new o.T(a,this.atlasImage[l],c.RGBA),this.atlasTexture[l]=m),m.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(a){let l=[];for(let Z in this.patterns[a])l.push(this.patterns[a][Z].bin);let{w:c,h:m}=o.p(l),p=this.atlasImage[a];p.resize({width:c||1,height:m||1});for(let Z in this.patterns[a]){let{bin:R}=this.patterns[a][Z],I=R.x+1,N=R.y+1,Y=this.images[a][Z].data,J=Y.width,M=Y.height;o.h.copy(Y,p,{x:0,y:0},{x:I,y:N},{width:J,height:M}),o.h.copy(Y,p,{x:0,y:M-1},{x:I,y:N-1},{width:J,height:1}),o.h.copy(Y,p,{x:0,y:0},{x:I,y:N+M},{width:J,height:1}),o.h.copy(Y,p,{x:J-1,y:0},{x:I-1,y:N},{width:1,height:M}),o.h.copy(Y,p,{x:0,y:0},{x:I+J,y:N},{width:1,height:M})}this.dirty=!0}beginFrame(){for(let a in this.images)this.callbackDispatchedThisFrame[a]={}}dispatchRenderCallbacks(a,l){for(let c of a){if(this.callbackDispatchedThisFrame[l][c])continue;this.callbackDispatchedThisFrame[l][c]=!0;let m=this.images[l][c];Bi(m)&&this.updateImage(c,l,m)}}}class Kt{constructor(a,l,c,m){this.message=(a?"".concat(a,": "):"")+c,m&&(this.identifier=m),l!=null&&l.__line__&&(this.line=l.__line__)}}class la extends Kt{}function ua(d){let a=d.key,l=d.value,c=d.valueSpec||{},m=d.objectElementValidators||{},p=d.style,Z=d.styleSpec,R=[],I=o.i(l);if(I!=="object")return[new Kt(a,l,"object expected, ".concat(I," found"))];for(let N in l){let Y=N.split(".")[0],J;m[Y]?J=m[Y]:c[Y]?J=sa:m["*"]?J=m["*"]:c["*"]&&(J=sa),J?R=R.concat(J({key:(a&&"".concat(a,"."))+N,value:l[N],valueSpec:c[Y]||c["*"],style:p,styleSpec:Z,object:l,objectKey:N},l)):R.push(new la(a,l[N],'unknown property "'.concat(N,'"')))}for(let N in c)m[N]||c[N].required&&c[N].default===void 0&&l[N]===void 0&&R.push(new Kt(a,l,'missing required property "'.concat(N,'"')));return R}function ke(d){let a=d.value,l=d.valueSpec,c=d.style,m=d.styleSpec,p=d.key,Z=d.arrayElementValidator||sa;if(o.i(a)!=="array")return[new Kt(p,a,"array expected, ".concat(o.i(a)," found"))];if(l.length&&a.length!==l.length)return[new Kt(p,a,"array length ".concat(l.length," expected, length ").concat(a.length," found"))];if(l["min-length"]&&a.length<l["min-length"])return[new Kt(p,a,"array length at least ".concat(l["min-length"]," expected, length ").concat(a.length," found"))];let R={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};m.$version<7&&(R.function=l.function),o.i(l.value)==="object"&&(R=l.value);let I=[];for(let N=0;N<a.length;N++)I=I.concat(Z({array:a,arrayIndex:N,value:a[N],valueSpec:R,style:c,styleSpec:m,key:"".concat(p,"[").concat(N,"]")},!0));return I}function Ba(d){let a=d.key,l=d.value,c=d.valueSpec,m=o.i(l);if(m==="number"&&l!=l&&(m="NaN"),m!=="number")return[new Kt(a,l,"number expected, ".concat(m," found"))];if("minimum"in c){let p=c.minimum;if(o.i(c.minimum)==="array"&&(p=c.minimum[d.arrayIndex]),l<p)return[new Kt(a,l,"".concat(l," is less than the minimum value ").concat(p))]}if("maximum"in c){let p=c.maximum;if(o.i(c.maximum)==="array"&&(p=c.maximum[d.arrayIndex]),l>p)return[new Kt(a,l,"".concat(l," is greater than the maximum value ").concat(p))]}return[]}function Ma(d){let a=d.valueSpec,l=o.u(d.value.type),c,m,p,Z={},R=l!=="categorical"&&d.value.property===void 0,I=!R,N=o.i(d.value.stops)==="array"&&o.i(d.value.stops[0])==="array"&&o.i(d.value.stops[0][0])==="object",Y=ua({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(T){if(l==="identity")return[new Kt(T.key,T.value,'identity function may not have a "stops" property')];let v=[],f=T.value;return v=v.concat(ke({key:T.key,value:f,valueSpec:T.valueSpec,style:T.style,styleSpec:T.styleSpec,arrayElementValidator:J})),o.i(f)==="array"&&f.length===0&&v.push(new Kt(T.key,f,"array must have at least one stop")),v},default:function(T){return sa({key:T.key,value:T.value,valueSpec:a,style:T.style,styleSpec:T.styleSpec})}}});return l==="identity"&&R&&Y.push(new Kt(d.key,d.value,'missing required property "property"')),l==="identity"||d.value.stops||Y.push(new Kt(d.key,d.value,'missing required property "stops"')),l==="exponential"&&d.valueSpec.expression&&!o.s(d.valueSpec)&&Y.push(new Kt(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(I&&!o.k(d.valueSpec)?Y.push(new Kt(d.key,d.value,"property functions not supported")):R&&!o.m(d.valueSpec)&&Y.push(new Kt(d.key,d.value,"zoom functions not supported"))),l!=="categorical"&&!N||d.value.property!==void 0||Y.push(new Kt(d.key,d.value,'"property" property is required')),Y;function J(T){let v=[],f=T.value,z=T.key;if(o.i(f)!=="array")return[new Kt(z,f,"array expected, ".concat(o.i(f)," found"))];if(f.length!==2)return[new Kt(z,f,"array length 2 expected, length ".concat(f.length," found"))];if(N){if(o.i(f[0])!=="object")return[new Kt(z,f,"object expected, ".concat(o.i(f[0])," found"))];if(f[0].zoom===void 0)return[new Kt(z,f,"object stop key must have zoom")];if(f[0].value===void 0)return[new Kt(z,f,"object stop key must have value")];let Q=o.u(f[0].zoom);if(typeof Q!="number")return[new Kt(z,f[0].zoom,"stop zoom values must be numbers")];if(p&&p>Q)return[new Kt(z,f[0].zoom,"stop zoom values must appear in ascending order")];Q!==p&&(p=Q,m=void 0,Z={}),v=v.concat(ua({key:"".concat(z,"[0]"),value:f[0],valueSpec:{zoom:{}},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{zoom:Ba,value:M}}))}else v=v.concat(M({key:"".concat(z,"[0]"),value:f[0],valueSpec:{},style:T.style,styleSpec:T.styleSpec},f));return o.n(o.o(f[1]))?v.concat([new Kt("".concat(z,"[1]"),f[1],"expressions are not allowed in function stops.")]):v.concat(sa({key:"".concat(z,"[1]"),value:f[1],valueSpec:a,style:T.style,styleSpec:T.styleSpec}))}function M(T,v){let f=o.i(T.value),z=o.u(T.value),Q=T.value!==null?T.value:v;if(c){if(f!==c)return[new Kt(T.key,Q,"".concat(f," stop domain type must match previous stop domain type ").concat(c))]}else c=f;if(f!=="number"&&f!=="string"&&f!=="boolean"&&typeof z!="number"&&typeof z!="string"&&typeof z!="boolean")return[new Kt(T.key,Q,"stop domain value must be a number, string, or boolean")];if(f!=="number"&&l!=="categorical"){let E="number expected, ".concat(f," found");return o.k(a)&&l===void 0&&(E+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Kt(T.key,Q,E)]}return l!=="categorical"||f!=="number"||typeof z=="number"&&isFinite(z)&&Math.floor(z)===z?l!=="categorical"&&f==="number"&&typeof z=="number"&&typeof m=="number"&&m!==void 0&&z<m?[new Kt(T.key,Q,"stop domain values must appear in ascending order")]:(m=z,l==="categorical"&&z in Z?[new Kt(T.key,Q,"stop domain values must be unique")]:(Z[z]=!0,[])):[new Kt(T.key,Q,"integer expected, found ".concat(String(z)))]}}function ln(d){let a=(d.expressionContext==="property"?o.q:o.r)(o.o(d.value),d.valueSpec);if(a.result==="error")return a.value.map(c=>new Kt("".concat(d.key).concat(c.key),d.value,c.message));let l=a.value.expression||a.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!l.outputDefined())return[new Kt(d.key,d.value,'Invalid data expression for "'.concat(d.propertyKey,'". Output values must be contained as literals within the expression.'))];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!o.t(l))return[new Kt(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return ma(l,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!o.v(l,["zoom","feature-state"]))return[new Kt(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!o.x(l))return[new Kt(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ma(d,a){let l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(a.valueSpec&&a.valueSpec.expression)for(let m of a.valueSpec.expression.parameters)l.delete(m);if(l.size===0)return[];let c=[];return d instanceof o.C&&l.has(d.name)?[new Kt(a.key,a.value,'["'.concat(d.name,'"] expression is not supported in a filter for a ').concat(a.object.type," layer with id: ").concat(a.object.id))]:(d.eachChild(m=>{c.push(...ma(m,a))}),c)}function Ln(d){let a=d.key,l=d.value,c=d.valueSpec,m=[];return Array.isArray(c.values)?c.values.indexOf(o.u(l))===-1&&m.push(new Kt(a,l,"expected one of [".concat(c.values.join(", "),"], ").concat(JSON.stringify(l)," found"))):Object.keys(c.values).indexOf(o.u(l))===-1&&m.push(new Kt(a,l,"expected one of [".concat(Object.keys(c.values).join(", "),"], ").concat(JSON.stringify(l)," found"))),m}function ul(d){return o.z(o.o(d.value))?ln(o.j({},d,{expressionContext:"filter",valueSpec:d.styleSpec["filter_".concat(d.layerType||"fill")]})):$n(d)}function $n(d){let a=d.value,l=d.key;if(o.i(a)!=="array")return[new Kt(l,a,"array expected, ".concat(o.i(a)," found"))];let c=d.styleSpec,m,p=[];if(a.length<1)return[new Kt(l,a,"filter array must have at least 1 element")];switch(p=p.concat(Ln({key:"".concat(l,"[0]"),value:a[0],valueSpec:c.filter_operator,style:d.style,styleSpec:d.styleSpec})),o.u(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&o.u(a[1])==="$type"&&p.push(new Kt(l,a,'"$type" cannot be use with operator "'.concat(a[0],'"')));case"==":case"!=":a.length!==3&&p.push(new Kt(l,a,'filter array for operator "'.concat(a[0],'" must have 3 elements')));case"in":case"!in":a.length>=2&&(m=o.i(a[1]),m!=="string"&&p.push(new Kt("".concat(l,"[1]"),a[1],"string expected, ".concat(m," found"))));for(let Z=2;Z<a.length;Z++)m=o.i(a[Z]),o.u(a[1])==="$type"?p=p.concat(Ln({key:"".concat(l,"[").concat(Z,"]"),value:a[Z],valueSpec:c.geometry_type,style:d.style,styleSpec:d.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&p.push(new Kt("".concat(l,"[").concat(Z,"]"),a[Z],"string, number, or boolean expected, ".concat(m," found")));break;case"any":case"all":case"none":for(let Z=1;Z<a.length;Z++)p=p.concat($n({key:"".concat(l,"[").concat(Z,"]"),value:a[Z],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":m=o.i(a[1]),a.length!==2?p.push(new Kt(l,a,'filter array for "'.concat(a[0],'" operator must have 2 elements'))):m!=="string"&&p.push(new Kt("".concat(l,"[1]"),a[1],"string expected, ".concat(m," found")))}return p}function Zl(d,a){let l=d.key,c=d.style,m=d.layer,p=d.styleSpec,Z=d.value,R=d.objectKey,I=p["".concat(a,"_").concat(d.layerType)];if(!I)return[];let N=R.match(/^(.*)-transition$/);if(a==="paint"&&N&&I[N[1]]&&I[N[1]].transition)return sa({key:l,value:Z,valueSpec:p.transition,style:c,styleSpec:p});let Y=d.valueSpec||I[R];if(!Y)return[new la(l,Z,'unknown property "'.concat(R,'"'))];let J;if(o.i(Z)==="string"&&o.k(Y)&&!Y.tokens&&(J=/^{([^}]+)}$/.exec(Z))){let T='`{ "type": "identity", "property": '.concat(J?JSON.stringify(J[1]):'"_"'," }`");return[new Kt(l,Z,'"'.concat(R,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(T,"."))]}let M=[];if(d.layerType==="symbol")R!=="text-field"||!c||c.glyphs||c.imports||M.push(new Kt(l,Z,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&o.A(o.o(Z))&&o.u(Z.type)==="identity"&&M.push(new Kt(l,Z,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&a==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&o.k(Y)&&(o.B(Y)||o.m(Y))){let T=o.q(o.o(Z),Y),v=T.value.expression||T.value._styleExpression.expression;v&&!o.v(v,["measure-light"])&&(R==="model-emissive-strength"&&o.x(v)&&o.t(v)||M.push(new Kt(l,Z,"".concat(R," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return M.concat(sa({key:d.key,value:Z,valueSpec:Y,style:c,styleSpec:p,expressionContext:"property",propertyType:a,propertyKey:R}))}function zn(d){return Zl(d,"paint")}function on(d){return Zl(d,"layout")}function mn(d){let a=[],l=d.value,c=d.key,m=d.style,p=d.styleSpec;l.type||l.ref||a.push(new Kt(c,l,'either "type" or "ref" is required'));let Z=o.u(l.type),R=o.u(l.ref);if(l.id){let I=o.u(l.id);for(let N=0;N<d.arrayIndex;N++){let Y=m.layers[N];o.u(Y.id)===I&&a.push(new Kt(c,l.id,'duplicate layer id "'.concat(l.id,'", previously used at line ').concat(Y.id.__line__)))}}if("ref"in l){let I;["type","source","source-layer","filter","layout"].forEach(N=>{N in l&&a.push(new Kt(c,l[N],'"'.concat(N,'" is prohibited for ref layers')))}),m.layers.forEach(N=>{o.u(N.id)===R&&(I=N)}),I?I.ref?a.push(new Kt(c,l.ref,"ref cannot reference another ref layer")):Z=o.u(I.type):typeof R=="string"&&a.push(new Kt(c,l.ref,'ref layer "'.concat(R,'" not found')))}else if(Z!=="background"&&Z!=="sky"&&Z!=="slot")if(l.source){let I=m.sources&&m.sources[l.source],N=I&&o.u(I.type);I?N==="vector"&&Z==="raster"?a.push(new Kt(c,l.source,'layer "'.concat(l.id,'" requires a raster source'))):N==="raster"&&Z!=="raster"?a.push(new Kt(c,l.source,'layer "'.concat(l.id,'" requires a vector source'))):N!=="vector"||l["source-layer"]?N==="raster-dem"&&Z!=="hillshade"?a.push(new Kt(c,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(Z)?Z!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||N==="geojson"&&I.lineMetrics?Z==="raster-particle"&&N!=="raster-array"&&a.push(new Kt(c,l.source,'layer "'.concat(l.id,"\" requires a 'raster-array' source."))):a.push(new Kt(c,l,'layer "'.concat(l.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):a.push(new Kt(c,l.source,"raster-array source can only be used with layer type 'raster'.")):a.push(new Kt(c,l,'layer "'.concat(l.id,'" must specify a "source-layer"'))):a.push(new Kt(c,l.source,'source "'.concat(l.source,'" not found')))}else a.push(new Kt(c,l,'missing required property "source"'));return a=a.concat(ua({key:c,value:l,valueSpec:p.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>sa({key:"".concat(c,".type"),value:l.type,valueSpec:p.layer.type,style:d.style,styleSpec:d.styleSpec,object:l,objectKey:"type"}),filter:I=>ul(o.j({layerType:Z},I)),layout:I=>ua({layer:l,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":N=>on(o.j({layerType:Z},N))}}),paint:I=>ua({layer:l,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":N=>zn(o.j({layerType:Z,layer:l},N))}})}})),a}function Ra(d){let a=d.value,l=d.key,c=o.i(a);return c!=="string"?[new Kt(l,a,"string expected, ".concat(c," found"))]:[]}let Ca={promoteId:function({key:d,value:a}){if(o.i(a)==="string")return Ra({key:d,value:a});{let l=[];for(let c in a)l.push(...Ra({key:"".concat(d,".").concat(c),value:a[c]}));return l}}};function tn(d){let a=d.value,l=d.key,c=d.styleSpec,m=d.style;if(!a.type)return[new Kt(l,a,'"type" is required')];let p=o.u(a.type),Z=[];switch(["vector","raster","raster-dem","raster-array"].includes(p)&&(a.url||a.tiles||Z.push(new la(l,a,'Either "url" or "tiles" is required.'))),p){case"vector":case"raster":case"raster-dem":case"raster-array":return Z=Z.concat(ua({key:l,value:a,valueSpec:c["source_".concat(p.replace("-","_"))],style:d.style,styleSpec:c,objectElementValidators:Ca})),Z;case"geojson":if(Z=ua({key:l,value:a,valueSpec:c.source_geojson,style:m,styleSpec:c,objectElementValidators:Ca}),a.cluster)for(let R in a.clusterProperties){let[I,N]=a.clusterProperties[R],Y=typeof I=="string"?[I,["accumulated"],["get",R]]:I;Z.push(...ln({key:"".concat(l,".").concat(R,".map"),value:N,expressionContext:"cluster-map"})),Z.push(...ln({key:"".concat(l,".").concat(R,".reduce"),value:Y,expressionContext:"cluster-reduce"}))}return Z;case"video":return ua({key:l,value:a,valueSpec:c.source_video,style:m,styleSpec:c});case"image":return ua({key:l,value:a,valueSpec:c.source_image,style:m,styleSpec:c});case"canvas":return[new Kt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ln({key:"".concat(l,".type"),value:a.type,valueSpec:{values:tr(c)},style:m,styleSpec:c})}}function tr(d){return d.source.reduce((a,l)=>{let c=d[l];return c.type.type==="enum"&&(a=a.concat(Object.keys(c.type.values))),a},[])}function ji(d){let a=d.value,l=[];if(!a)return l;let c=o.i(a);return c!=="string"?(l=l.concat([new Kt(d.key,a,'string expected, "'.concat(c,'" found'))]),l):(function(m){let p=m.indexOf("://")===-1;try{return new URL(m,p?"http://example.com":void 0),!0}catch{return!1}}(a)||(l=l.concat([new Kt(d.key,a,'invalid url "'.concat(a,'"'))])),l)}function Vn(d){let a=d.value,l=d.styleSpec,c=l.light,m=d.style,p=[],Z=o.i(a);if(a===void 0)return p;if(Z!=="object")return p=p.concat([new Kt("light",a,"object expected, ".concat(Z," found"))]),p;for(let R in a){let I=R.match(/^(.*)-transition$/);p=p.concat(I&&c[I[1]]&&c[I[1]].transition?sa({key:R,value:a[R],valueSpec:l.transition,style:m,styleSpec:l}):c[R]?sa({key:R,value:a[R],valueSpec:c[R],style:m,styleSpec:l}):[new Kt(R,a[R],'unknown property "'.concat(R,'"'))])}return p}function gl(d){let a=d.value,l=[];if(!a)return l;let c=o.i(a);if(c!=="object")return l=l.concat([new Kt("light-3d",a,"object expected, ".concat(c," found"))]),l;let m=d.styleSpec,p=m["light-3d"],Z=d.key,R=d.style,I=d.style.lights;for(let J of["type","id"])if(!(J in a))return l=l.concat([new Kt("light-3d",a,"missing property ".concat(J," on light"))]),l;if(a.type&&I)for(let J=0;J<d.arrayIndex;J++){let M=o.u(a.type),T=I[J];o.u(T.type)===M&&l.push(new Kt(Z,a.id,'duplicate light type "'.concat(a.type,'", previously defined at line ').concat(T.id.__line__)))}let N="properties_light_".concat(a.type);if(!(N in m))return l=l.concat([new Kt("light-3d",a,"Invalid light type ".concat(a.type))]),l;let Y=m[N];for(let J in a)if(J==="properties"){let M=a[J],T=o.i(M);if(T!=="object")return l=l.concat([new Kt("properties",M,"object expected, ".concat(T," found"))]),l;for(let v in M)l=l.concat(Y[v]?sa({key:v,value:M[v],valueSpec:Y[v],style:R,styleSpec:m}):[new la(d.key,M[v],'unknown property "'.concat(v,'"'))])}else{let M=J.match(/^(.*)-transition$/);l=l.concat(M&&p[M[1]]&&p[M[1]].transition?sa({key:J,value:a[J],valueSpec:m.transition,style:R,styleSpec:m}):p[J]?sa({key:J,value:a[J],valueSpec:p[J],style:R,styleSpec:m}):[new la(J,a[J],'unknown property "'.concat(J,'"'))])}return l}function tl(d){let a=d.value,l=d.key,c=d.style,m=d.styleSpec,p=m.terrain,Z=[],R=o.i(a);if(a===void 0||R==="null")return Z;if(R!=="object")return Z=Z.concat([new Kt("terrain",a,"object expected, ".concat(R," found"))]),Z;for(let I in a){let N=I.match(/^(.*)-transition$/);Z=Z.concat(N&&p[N[1]]&&p[N[1]].transition?sa({key:I,value:a[I],valueSpec:m.transition,style:c,styleSpec:m}):p[I]?sa({key:I,value:a[I],valueSpec:p[I],style:c,styleSpec:m}):[new la(I,a[I],'unknown property "'.concat(I,'"'))])}if(a.source){let I=c.sources&&c.sources[a.source],N=I&&o.u(I.type);I?N!=="raster-dem"&&Z.push(new Kt(l,a.source,"terrain cannot be used with a source of type ".concat(String(N),', it only be used with a "raster-dem" source type'))):Z.push(new Kt(l,a.source,'source "'.concat(a.source,'" not found')))}else Z.push(new Kt(l,a,'terrain is missing required property "source"'));return Z}function wn(d){let a=d.value,l=d.style,c=d.styleSpec,m=c.fog,p=[],Z=o.i(a);if(a===void 0)return p;if(Z!=="object")return p=p.concat([new Kt("fog",a,"object expected, ".concat(Z," found"))]),p;for(let R in a){let I=R.match(/^(.*)-transition$/);p=p.concat(I&&m[I[1]]&&m[I[1]].transition?sa({key:R,value:a[R],valueSpec:c.transition,style:l,styleSpec:c}):m[R]?sa({key:R,value:a[R],valueSpec:m[R],style:l,styleSpec:c}):[new la(R,a[R],'unknown property "'.concat(R,'"'))])}return p}let Vl={"*":()=>[],array:ke,boolean:function(d){let a=d.value,l=d.key,c=o.i(a);return c!=="boolean"?[new Kt(l,a,"boolean expected, ".concat(c," found"))]:[]},number:Ba,color:function(d){let a=d.key,l=d.value,c=o.i(l);return c!=="string"?[new Kt(a,l,"color expected, ".concat(c," found"))]:o.y(l)===null?[new Kt(a,l,'color expected, "'.concat(l,'" found'))]:[]},enum:Ln,filter:ul,function:Ma,layer:mn,object:ua,source:tn,model:ji,light:Vn,"light-3d":gl,terrain:tl,fog:wn,string:Ra,formatted:function(d){return Ra(d).length===0?[]:ln(d)},resolvedImage:function(d){return Ra(d).length===0?[]:ln(d)},projection:function(d){let a=d.value,l=d.styleSpec,c=l.projection,m=d.style,p=[],Z=o.i(a);if(Z==="object")for(let R in a)p=p.concat(sa({key:R,value:a[R],valueSpec:c[R],style:m,styleSpec:l}));else Z!=="string"&&(p=p.concat([new Kt("projection",a,"object or string expected, ".concat(Z," found"))]));return p},import:function(d){let{value:a,styleSpec:l}=d,{data:c,...m}=a;Object.defineProperty(m,"__line__",{value:a.__line__,enumerable:!1});let p=ua(o.j({},d,{value:m,valueSpec:l.import}));return o.u(m.id)===""&&p.push(new Kt("".concat(d.key,".id"),m,"import id can't be an empty string")),c&&(p=p.concat(Kl(c,l,{key:"".concat(d.key,".data")}))),p}};function sa(d,a=!1){let l=d.value,c=d.valueSpec,m=d.styleSpec;if(c.expression&&o.A(o.u(l)))return Ma(d);if(c.expression&&o.n(o.o(l)))return ln(d);if(c.type&&Vl[c.type]){let p=Vl[c.type](d);return a===!0&&p.length>0&&o.i(d.value)==="array"?ln(d):p}return ua(o.j({},d,{valueSpec:c.type?m[c.type]:c}))}function Pl(d){let a=d.value,l=d.key,c=Ra(d);return c.length||(a.indexOf("{fontstack}")===-1&&c.push(new Kt(l,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&c.push(new Kt(l,a,'"glyphs" url must include a "{range}" token'))),c}function Kl(d,a=o.D,l={}){return sa({key:l.key||"",value:d,valueSpec:a.$root,styleSpec:a,style:d,objectElementValidators:{glyphs:Pl,"*":()=>[]}})}function Ta(d,a=o.D){return Jt(Kl(d,a))}let Rn=d=>Jt(tn(d)),el=d=>Jt(Vn(d)),Mt=d=>Jt(gl(d)),j=d=>Jt(tl(d)),tt=d=>Jt(wn(d)),st=d=>Jt(mn(d)),Yt=d=>Jt(ul(d)),Tt=d=>Jt(zn(d)),zt=d=>Jt(on(d)),he=d=>Jt(ji(d));function Jt(d){return d.slice().sort((a,l)=>a.line&&l.line?a.line-l.line:0)}function We(d,a){let l=!1;if(a&&a.length)for(let c of a)c instanceof la?o.w(c.message):(d.fire(new o.a(new Error(c.message))),l=!0);return l}let re=new o.F({anchor:new o.G(o.D.light.anchor),position:new o.H(o.D.light.position),color:new o.G(o.D.light.color),intensity:new o.G(o.D.light.intensity)});class ge extends o.E{constructor(a,l="flat"){super(),this._transitionable=new o.J(re),this.setLight(a,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,l,c={}){this._validate(el,a,c)||(this._transitionable.setTransitionOrValue(a),this.id=l)}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,l,c){return(!c||c.validate!==!1)&&We(this,a.call(Ta,o.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}let _e=new o.F({source:new o.G(o.D.terrain.source),exaggeration:new o.G(o.D.terrain.exaggeration)}),Mi=class extends o.E{constructor(d,a,l,c){super(),this.scope=l,this._transitionable=new o.J(_e,l,c),this._transitionable.setTransitionOrValue(d,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(d,a){this._transitionable.setTransitionOrValue(d,a)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new o.K(d)).get("exaggeration")}isZoomDependent(){let d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof o.Z}},Oi=45,Ci=65,xi=.05;function Gi(d,a,l,c){let m=o.O(Oi,Ci,l),[p,Z]=Ji(d,c),R=1-Math.min(1,Math.exp((a-p)/(Z-p)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*m*d.alpha}function Ji(d,a){let l=.5/Math.tan(.5*a);return[d.range[0]+l,d.range[1]+l]}function wi(d,a,l,c,m){let p=o.N.transformMat4([],[a,l,c],m.mercatorFogMatrix);return Gi(d,o.N.length(p),m.pitch,m._fov)}function ka(d,a,l,c,m,p,Z){let R=[[l,c,0],[m,c,0],[m,p,0],[l,p,0]],I=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let Y of R){let J=o.N.transformMat4([],Y,a),M=o.N.length(J);I=Math.min(I,M),N=Math.max(N,M)}return[Gi(d,I,Z.pitch,Z._fov),Gi(d,N,Z.pitch,Z._fov)]}let Hi=new o.F({range:new o.G(o.D.fog.range),color:new o.G(o.D.fog.color),"high-color":new o.G(o.D.fog["high-color"]),"space-color":new o.G(o.D.fog["space-color"]),"horizon-blend":new o.G(o.D.fog["horizon-blend"]),"star-intensity":new o.G(o.D.fog["star-intensity"]),"vertical-range":new o.G(o.D.fog["vertical-range"])});class hn extends o.E{constructor(a,l,c,m){super(),this._transitionable=new o.J(Hi,c,new Map(m)),this.set(a,m),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.Q(Hi)}get state(){let a=this._transform,l=a.projection.name==="globe",c=o.S(a.zoom),m=this.properties.get("range"),p=[.5,3];return{range:l?[o.U(p[0],m[0],c),o.U(p[1],m[1],c)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,l,c={}){if(this._validate(tt,a,c))return;let m=o.e({},a);for(let p of Object.keys(o.D.fog))m[p]===void 0&&(m[p]=o.D.fog[p].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;let l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.O(Oi,Ci,a))*l.a}getOpacityAtLatLng(a,l){return this._transform.projection.supportsFog?function(c,m,p){let Z=o.L.fromLngLat(m),R=p.elevation?p.elevation.getAtPointOrZero(Z):0;return wi(c,Z.x,Z.y,R,p)}(this.state,a,l):0}getOpacityForTile(a){if(!this._transform.projection.supportsFog)return[1,1];let l=this._transform.calculateFogTileMatrix(a.toUnwrapped());return ka(this.state,l,0,0,o.V,o.V,this._transform)}getOpacityForBounds(a,l,c,m,p){return this._transform.projection.supportsFog?ka(this.state,a,l,c,m,p,this._transform):[1,1]}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Ji(this.state,a):[0,1]}isVisibleOnFrustum(a){if(!this._transform.projection.supportsFog)return!1;let l=[4,5,6,7];for(let c of l){let m=a.points[c],p;if(m[2]>=0)p=m;else{let Z=a.points[c-4];p=o.W(Z,m,Z[2]/(Z[2]-m[2]))}if(wi(this.state,p[0],p[1],0,this._transform)>=xi)return!0}return!1}updateConfig(a){this._transitionable.setTransitionOrValue(this._options,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,l,c){return(!c||c.validate!==!1)&&We(this,a.call(Ta,o.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}class rn extends o.E{constructor(a,l,c,m){super(),this.scope=c,this._options=a,this.properties=new o.Q(l),this._transitionable=new o.J(l,c,new Map(m)),this._transitionable.setTransitionOrValue(a.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(a){this._transitionable.setTransitionOrValue(this._options.properties,new Map(a))}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(a,l){this._options=a,this._transitionable.setTransitionOrValue(a.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Gn=new o.F({color:new o.G(o.D.properties_light_ambient.color),intensity:new o.G(o.D.properties_light_ambient.intensity)}),Ga=new o.F({direction:new o.X(o.D.properties_light_directional.direction),color:new o.G(o.D.properties_light_directional.color),intensity:new o.G(o.D.properties_light_directional.intensity),"cast-shadows":new o.G(o.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.G(o.D.properties_light_directional["shadow-intensity"])});class Za{constructor(a,l,c,m){this.screenBounds=a,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(a,l){let c,m;if(a instanceof o.P||typeof a[0]=="number"){let p=o.P.convert(a);c=[p],m=l.isPointAboveHorizon(p)}else{let p=o.P.convert(a[0]),Z=o.P.convert(a[1]);c=[p,Z],m=o.Y(p,Z).every(R=>l.isPointAboveHorizon(R))}return new Za(c,l.getCameraPoint(),m,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){let l=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.Y(l,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<c.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?m[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(m[3]=this.cameraPoint)),o._(m,a)}bufferedCameraGeometryGlobe(a){let l=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.Y(l,c,a),p=this.cameraPoint.clone();switch(3*((p.y>l.y)+(p.y>c.y))+((p.x>l.x)+(p.x>c.x))){case 0:m[0]=p,m[4]=p.clone();break;case 1:m.splice(1,0,p);break;case 2:m[1]=p;break;case 3:m.splice(4,0,p);break;case 5:m.splice(2,0,p);break;case 6:m[3]=p;break;case 7:m.splice(3,0,p);break;case 8:m[2]=p}return m}containsTile(a,l,c,m=0){let p=a.queryPadding/l._pixelsPerMercatorPixel+1,Z=c?this._bufferedCameraMercator(p,l):this._bufferedScreenMercator(p,l),R=a.tileID.wrap+(Z.unwrapped?m:0),I=Z.polygon.map(z=>o.$(a.tileTransform,z,R));if(!o.a0(I,0,0,o.V,o.V))return;R=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);let N=this.screenGeometryMercator.polygon.map(z=>o.a1(a.tileTransform,z,R)),Y=N.map(z=>new o.P(z[0],z[1])),J=l.getFreeCameraOptions().position||new o.L(0,0,0),M=o.a1(a.tileTransform,J,R),T=N.map(z=>{let Q=o.N.sub(z,z,M);return o.N.normalize(Q,Q),new o.a2(M,Q)}),v=o.a3(a,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Y,tilespaceRays:T,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(f=o.a4(I),f.min.x=o.aa(f.min.x,0,o.V),f.min.y=o.aa(f.min.y,0,o.V),f.max.x=o.aa(f.max.x,0,o.V),f.max.y=o.aa(f.max.y,0,o.V),f),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:v};var f}_bufferedScreenMercator(a,l){let c=wt(a);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let m;return m=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(a),l):{polygon:this.bufferedScreenGeometry(a).map(p=>l.pointCoordinate3D(p)),unwrapped:!0},this._screenRaycastCache[c]=m,m}}_bufferedCameraMercator(a,l){let c=wt(a);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let m;return m=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),l):{polygon:this.bufferedCameraGeometry(a).map(p=>l.pointCoordinate3D(p)),unwrapped:!0},this._cameraRaycastCache[c]=m,m}}_projectAndResample(a,l){let c=function(p,Z){let R=o.a6.multiply([],Z.pixelMatrix,Z.globeMatrix),I=[0,-o.ab,0,1],N=[0,o.ab,0,1],Y=[0,0,0,1];o.a7.transformMat4(I,I,R),o.a7.transformMat4(N,N,R),o.a7.transformMat4(Y,Y,R);let J=new o.P(I[0]/I[3],I[1]/I[3]),M=new o.P(N[0]/N[3],N[1]/N[3]),T=o.a8(p,J)&&I[3]<Y[3],v=o.a8(p,M)&&N[3]<Y[3];if(!T&&!v)return null;let f=function(q,it,at){for(let rt=1;rt<q.length;rt++){let Zt=yt(it.pointCoordinate3D(q[rt-1]).x),bt=yt(it.pointCoordinate3D(q[rt]).x);if(at<0){if(Zt<bt)return{idx:rt,t:-Zt/(bt-1-Zt)}}else if(bt<Zt)return{idx:rt,t:(1-Zt)/(bt+1-Zt)}}return null}(p,Z,T?-1:1);if(!f)return null;let{idx:z,t:Q}=f,E=z>1?Xt(p.slice(0,z),Z):[],P=z<p.length?Xt(p.slice(z),Z):[];E=E.map(q=>new o.P(yt(q.x),q.y)),P=P.map(q=>new o.P(yt(q.x),q.y));let H=[...E];H.length===0&&H.push(P[P.length-1]);let K=o.U(H[H.length-1].y,(P.length===0?E[0]:P[0]).y,Q),w;return w=T?[new o.P(0,K),new o.P(0,0),new o.P(1,0),new o.P(1,K)]:[new o.P(1,K),new o.P(1,1),new o.P(0,1),new o.P(0,K)],H.push(...w),P.length===0?H.push(E[0]):H.push(...P),{polygon:H.map(q=>new o.L(q.x,q.y)),unwrapped:!1}}(a,l);if(c)return c;let m=function(p,Z){let R=!1,I=-1/0,N=0;for(let J=0;J<p.length-1;J++)p[J].x>I&&(I=p[J].x,N=J);for(let J=0;J<p.length-1;J++){let M=(N+J)%(p.length-1),T=p[M],v=p[M+1];Math.abs(T.x-v.x)>.5&&(T.x<v.x?(T.x+=1,M===0&&(p[p.length-1].x+=1)):(v.x+=1,M+1===p.length-1&&(p[0].x+=1)),R=!0)}let Y=o.a5(Z.center.lng);return R&&Y<Math.abs(Y-1)&&p.forEach(J=>{J.x-=1}),{polygon:p,unwrapped:R}}(Xt(a,l).map(p=>new o.P(yt(p.x),p.y)),l);return{polygon:m.polygon.map(p=>new o.L(p.x,p.y)),unwrapped:m.unwrapped}}}function Xt(d,a){return o.a9(d,l=>{let c=a.pointCoordinate3D(l);l.x=c.x,l.y=c.y},1/256)}function yt(d){return d<0?1+d%1:d%1}function wt(d){return 100*d|0}function Pt(d,a,l,c,m){let p=function(Z,R){if(Z)return m(Z);if(R){d.url&&R.tiles&&d.tiles&&delete d.tiles;let I=o.ac(o.e(R,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);R.vector_layers&&(I.vectorLayers=R.vector_layers,I.vectorLayerIds=I.vectorLayers.map(N=>N.id)),R.raster_layers&&(I.rasterLayers=R.raster_layers,I.rasterLayerIds=I.rasterLayers.map(N=>N.id)),I.tiles=a.canonicalizeTileset(I,d.url),m(null,I)}};return d.url?o.g(a.transformRequest(a.normalizeSourceURL(d.url,null,l,c),o.R.Source),p):o.f.frame(()=>p(null,d))}class Ht{constructor(a,l,c){this.bounds=o.ad.convert(this.validateBounds(a)),this.minzoom=l||0,this.maxzoom=c||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){let l=Math.pow(2,a.z),c=Math.floor(o.a5(this.bounds.getWest())*l),m=Math.floor(o.ae(this.bounds.getNorth())*l),p=Math.ceil(o.a5(this.bounds.getEast())*l),Z=Math.ceil(o.ae(this.bounds.getSouth())*l);return a.x>=c&&a.x<p&&a.y>=m&&a.y<Z}}class te extends o.E{constructor(a,l,c,m){if(super(),this.id=a,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.ac(l,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new o.af}load(a){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=Pt(this._options,this.map._requestManager,l,c,(m,p)=>{this._tileJSONRequest=null,this._loaded=!0,m?(l&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(l)),c&&c.length!==2&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(c)),this.fire(new o.a(m))):p&&(o.e(this,p),p.bounds&&(this.tileBounds=new Ht(p.bounds,this.minzoom,this.maxzoom)),o.aj(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),a&&a(m)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();let a=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}loadTile(a,l){let c=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:a.isExtraShadowCaster};if(m.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired")a.state==="loading"?a.reloadCallback=l:a.request=a.actor.send("reloadTile",m,p.bind(this));else if(a.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",m,p.bind(this),void 0,!0);else{let Z=o.ah.call({deduped:this._deduped},m,(R,I)=>{R||!I?p.call(this,R):(m.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},a.actor&&a.actor.send("loadTile",m,p.bind(this),void 0,!0))},!0);a.request={cancel:Z}}function p(Z,R){return delete a.request,a.aborted?l(null):Z&&Z.status!==404?l(Z):(R&&R.resourceTiming&&(a.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&a.setExpiryData(R),a.loadVectorData(R,this.map.painter),o.ai(this.dispatcher),l(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(a){a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id,scope:this.scope}),a.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ee extends o.E{constructor(a,l,c,m){super(),this.id=a,this.dispatcher=c,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},l),o.e(this,o.ac(l,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Pt(this._options,this.map._requestManager,null,null,(l,c)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new o.a(l)):c&&(o.e(this,c),c.bounds&&(this.tileBounds=new Ht(c.bounds,this.minzoom,this.maxzoom)),o.aj(c.tiles),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),a&&a(l)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest();let a=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(a))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,l){let c=o.f.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);a.request=o.d(this.map._requestManager.transformRequest(m,o.R.Tile),(p,Z,R,I)=>(delete a.request,a.aborted?(a.state="unloaded",l(null)):p?(a.state="errored",l(p)):Z?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:R,expires:I}),a.setTexture(Z,this.map.painter),a.state="loaded",o.ai(this.dispatcher),void l(null)):l(null)))}abortTile(a,l){a.request&&(a.request.cancel(),delete a.request),l()}unloadTile(a,l){a.texture&&a.texture instanceof o.T?(a.destroy(!0),a.texture&&a.texture instanceof o.T&&this.map.painter.saveTileTexture(a.texture)):a.destroy(),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dt extends ee{constructor(a,l,c,m){super(a,l,c,m),this.type="raster-array",this.maxzoom=22,this._options=o.e({type:"raster-array"},l)}triggerRepaint(a){let l=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);l&&l.enabled&&c&&l._clearRenderCacheForTile(c.id,a.tileID),this.map.triggerRepaint()}loadTile(a,l){let c=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(c,o.R.Tile);a.requestParams=m,a.actor||(a.actor=this.dispatcher.getActor()),a.request=a.fetchHeader(void 0,(p,Z,R,I)=>{if(delete a.request,a.aborted)return a.state="unloaded",l(null);if(p)return p.code===20?void 0:(a.state="errored",l(p));this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:R,expires:I}),a.state="empty",l(null)})}unloadTile(a){let l=a.texture;l&&l instanceof o.T?(a.destroy(!0),this.map.painter.saveTileTexture(l)):(a.destroy(),a.flushQueues(),a._isHeaderLoaded=!1,delete a._mrt,delete a.textureDescriptor),a.fbo&&(a.fbo.destroy(),delete a.fbo),delete a.request,delete a.requestParams,delete a.neighboringTiles,a.state="unloaded"}prepareTile(a,l,c){a._isHeaderLoaded&&(a.state!=="empty"&&(a.state="reloading"),a.fetchBand(l,c,(m,p)=>{if(m)return a.state="errored",this.fire(new o.a(m)),void this.triggerRepaint(a);p&&(a.setTexture(p,this.map.painter),a.state="loaded",this.triggerRepaint(a))}))}getInitialBand(a){if(!this.rasterLayers)return 0;let l=this.rasterLayers.find(({id:p})=>p===a),c=l&&l.fields,m=c&&c.bands&&c.bands;return m?m[0]:0}getTextureDescriptor(a,l,c){if(!a)return;let m=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let p=null;l instanceof o.an?p=l.paint.get("raster-array-band"):l instanceof o.ao&&(p=l.paint.get("raster-particle-array-band"));let Z=p||this.getInitialBand(m);if(Z!=null)if(a.textureDescriptor){if(!a.updateNeeded(m,Z)||c)return Object.assign({},a.textureDescriptor,{texture:a.texture})}else this.prepareTile(a,m,Z)}}let ae=32,qt=33,Be=new Uint16Array(8184);for(let d=0;d<2046;d++){let a=d+2,l=0,c=0,m=0,p=0,Z=0,R=0;for(1&a?m=p=Z=ae:l=c=R=ae;(a>>=1)>1;){let N=l+m>>1,Y=c+p>>1;1&a?(m=l,p=c,l=Z,c=R):(l=m,c=p,m=Z,p=R),Z=N,R=Y}let I=4*d;Be[I+0]=l,Be[I+1]=c,Be[I+2]=m,Be[I+3]=p}let ni=new Uint16Array(2178),Ge=new Uint8Array(1089),Ti=new Uint16Array(1089);function Ki(d){return d===0?-.03125:d===32?.03125:0}class Li{constructor(a,l,c,m){this.id=Li.uniqueIdxCounter,Li.uniqueIdxCounter++,this.context=a;let p=a.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||m||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=Li.uniqueIdxCounter,Li.uniqueIdxCounter++;let l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Li.uniqueIdxCounter=0;let Fa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Oa{constructor(a,l,c,m,p,Z){this.length=l.length,this.attributes=c,this.itemSize=l.bytesPerElement,this.dynamicDraw=m,this.instanceCount=Z,this.context=a;let R=a.gl;this.buffer=R.createBuffer(),a.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||p||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,l){for(let c=0;c<this.attributes.length;c++){let m=l.attributes[this.attributes[c].name];m!==void 0&&a.enableVertexAttribArray(m)}}setVertexAttribPointers(a,l,c){for(let m=0;m<this.attributes.length;m++){let p=this.attributes[m],Z=l.attributes[p.name];Z!==void 0&&a.vertexAttribPointer(Z,p.components,a[Fa[p.type]],!1,this.itemSize,p.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(a,l,c){for(let m=0;m<this.attributes.length;m++){let p=l.attributes[this.attributes[m].name];p!==void 0&&this.instanceCount&&this.instanceCount>0&&a.vertexAttribDivisor(p,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vi{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mn extends Vi{getDefault(){return o.ax.transparent}set(a){let l=this.current;(a.r!==l.r||a.g!==l.g||a.b!==l.b||a.a!==l.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class il extends Vi{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Da extends Vi{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class qr extends Vi{getDefault(){return[!0,!0,!0,!0]}set(a){let l=this.current;(a[0]!==l[0]||a[1]!==l[1]||a[2]!==l[2]||a[3]!==l[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ql extends Vi{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class er extends Vi{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Tc extends Vi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){let l=this.current;(a.func!==l.func||a.ref!==l.ref||a.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class xo extends Vi{getDefault(){let a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){let l=this.current;(a[0]!==l[0]||a[1]!==l[1]||a[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class kc extends Vi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;a?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=a,this.dirty=!1}}class ir extends Vi{getDefault(){return[0,1]}set(a){let l=this.current;(a[0]!==l[0]||a[1]!==l[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class i0 extends Vi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;a?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=a,this.dirty=!1}}class bd extends Vi{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Qc extends Vi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;a?l.enable(l.BLEND):l.disable(l.BLEND),this.current=a,this.dirty=!1}}class md extends Vi{getDefault(){let a=this.gl;return[a.ONE,a.ZERO,a.ONE,a.ZERO]}set(a){let l=this.current;(a[0]!==l[0]||a[1]!==l[1]||a[2]!==l[2]||a[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Sc extends Vi{getDefault(){return o.ax.transparent}set(a){let l=this.current;(a.r!==l.r||a.g!==l.g||a.b!==l.b||a.a!==l.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Fn extends Vi{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(a,a),this.current=a,this.dirty=!1)}}class ga extends Vi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;a?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=a,this.dirty=!1}}class li extends Vi{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class a0 extends Vi{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let hd=class extends Vi{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class fc extends Vi{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Tp extends Vi{getDefault(){let a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){let l=this.current;(a[0]!==l[0]||a[1]!==l[1]||a[2]!==l[2]||a[3]!==l[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Rl extends Vi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class vc extends Vi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class kp extends Vi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ar extends Vi{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class le extends Vi{getDefault(){return null}set(a){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Fi extends Vi{getDefault(){return null}set(a){this.gl&&(a!==this.current||this.dirty)&&(this.gl.bindVertexArray(a),this.current=a,this.dirty=!1)}}class Ii extends Vi{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class En extends Vi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class nr extends Vi{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class ci extends Vi{constructor(a,l){super(a),this.context=a,this.parent=l}getDefault(){return null}}class pd extends ci{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class lr extends ci{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class $r extends ci{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class In extends lr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class pa{constructor(a,l,c,m,p){this.context=a,this.width=l,this.height=c;let Z=this.framebuffer=a.gl.createFramebuffer();m&&(this.colorAttachment=new pd(a,Z)),p&&(this.depthAttachmentType=p,this.depthAttachment=p==="renderbuffer"?new lr(a,Z):new $r(a,Z))}destroy(){let a=this.context.gl;if(this.colorAttachment){let l=this.colorAttachment.get();l&&a.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let l=this.depthAttachment.get();l&&a.deleteRenderbuffer(l)}else{let l=this.depthAttachment.get();l&&a.deleteTexture(l)}a.deleteFramebuffer(this.framebuffer)}}class Ne{constructor(a,l,c){this.func=a,this.mask=l,this.range=c}}Ne.ReadOnly=!1,Ne.ReadWrite=!0,Ne.disabled=new Ne(519,Ne.ReadOnly,[0,1]);let No=7680;class Ce{constructor(a,l,c,m,p,Z){this.test=a,this.ref=l,this.mask=c,this.fail=m,this.depthFail=p,this.pass=Z}}Ce.disabled=new Ce({func:519,mask:0},0,0,No,No,No);let $l=771;class Pe{constructor(a,l,c,m){this.blendFunction=a,this.blendColor=l,this.mask=c,this.blendEquation=m}}Pe.Replace=[1,0,1,0],Pe.disabled=new Pe(Pe.Replace,o.ax.transparent,[!1,!1,!1,!1]),Pe.unblended=new Pe(Pe.Replace,o.ax.transparent,[!0,!0,!0,!0]),Pe.alphaBlended=new Pe([1,$l,1,$l],o.ax.transparent,[!0,!0,!0,!0]),Pe.multiply=new Pe([774,0,774,0],o.ax.transparent,[!0,!0,!0,!0]);let or=1029,_a=2305;class Ye{constructor(a,l,c){this.enable=a,this.mode=l,this.frontFace=c}}Ye.disabled=new Ye(!1,or,_a),Ye.backCCW=new Ye(!0,or,_a),Ye.backCW=new Ye(!0,or,2304),Ye.frontCW=new Ye(!0,1028,2304),Ye.frontCCW=new Ye(!0,1028,_a);class n0{constructor(a,l){this.gl=a,this.clearColor=new Mn(this),this.clearDepth=new il(this),this.clearStencil=new Da(this),this.colorMask=new qr(this),this.depthMask=new ql(this),this.stencilMask=new er(this),this.stencilFunc=new Tc(this),this.stencilOp=new xo(this),this.stencilTest=new kc(this),this.depthRange=new ir(this),this.depthTest=new i0(this),this.depthFunc=new bd(this),this.blend=new Qc(this),this.blendFunc=new md(this),this.blendColor=new Sc(this),this.blendEquation=new Fn(this),this.cullFace=new ga(this),this.cullFaceSide=new li(this),this.frontFace=new a0(this),this.program=new hd(this),this.activeTexture=new fc(this),this.viewport=new Tp(this),this.bindFramebuffer=new Rl(this),this.bindRenderbuffer=new vc(this),this.bindTexture=new kp(this),this.bindVertexBuffer=new ar(this),this.bindElementBuffer=new le(this),this.bindVertexArrayOES=new Fi(this),this.pixelStoreUnpack=new Ii(this),this.pixelStoreUnpackPremultiplyAlpha=new En(this),this.pixelStoreUnpackFlipY=new nr(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=a.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxPointSize=a.getParameter(a.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,l,c){return new Li(this,a,l,c)}createVertexBuffer(a,l,c,m,p){return new Oa(this,a,l,c,m,p)}createRenderbuffer(a,l,c){let m=this.gl,p=m.createRenderbuffer();return this.bindRenderbuffer.set(p),m.renderbufferStorage(m.RENDERBUFFER,a,l,c),this.bindRenderbuffer.set(null),p}createFramebuffer(a,l,c,m){return new pa(this,a,l,c,m)}clear({color:a,depth:l,stencil:c,colorMask:m}){let p=this.gl,Z=0;a&&(Z|=p.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set(m||[!0,!0,!0,!0])),l!==void 0&&(Z|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),c!==void 0&&(Z|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(Z)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){_(a.blendFunction,Pe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor),a.blendEquation?this.blendEquation.set(a.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(a.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Yo=o.ay([{name:"a_pos",type:"Float32",components:3}]);class Ia{constructor(a,l,c,m){let p={width:c[0],height:c[1],data:null},Z=a.gl;this.targetColorTexture=new o.T(a,p,Z.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(a,p,Z.RGBA,{useMipmap:!1}),this.context=a,this.setNumParticles(l,m),this.lastInvalidatedAt=0}setNumParticles(a,l){if(this.numParticles===l)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());let c=new o.az;c.reserve(Math.round(l));let m=o.aA(a.key);for(let p=0;p<l;p++)c.emplaceBack(m(),m(),m());this.particleVertices0=this.context.createVertexBuffer(c,Yo.members,!0),this.particleVertices1=this.context.createVertexBuffer(c,Yo.members,!0),this.particleSegment=o.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=l}update(a){return!(this.lastInvalidatedAt<a&&(this.lastInvalidatedAt=o.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}let An={type:2,extent:o.V,loadGeometry:()=>[[new o.P(0,0),new o.P(o.V+1,0),new o.P(o.V+1,o.V+1),new o.P(0,o.V+1),new o.P(0,0)]]};class to{constructor(a,l,c,m,p){this.tileID=a,this.uid=o.aC(),this.uses=0,this.tileSize=l,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(a){let l=a+this.timeAdded;l<o.f.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(a,l,c){if(this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(m,p){let Z={};if(!p)return Z;for(let R of m){let I=R.layerIds.map(N=>p.getLayer(N)).filter(Boolean);if(I.length!==0){R.layers=I,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(N=>I.filter(Y=>Y.id===N)[0]));for(let N of I)Z[N.fqid]=R}}return Z}(a.buckets,l.style),this.hasSymbolBuckets=!1;for(let m in this.buckets){let p=this.buckets[m];if(p instanceof o.aE){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let m in this.buckets){let p=this.buckets[m];if(p instanceof o.aE&&p.hasRTLText){this.hasRTLText=!0,o.aF();break}}this.queryPadding=0;for(let m in this.buckets){let p=this.buckets[m],Z=l.style.getOwnLayer(m);if(!Z)continue;let R=Z.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,R)}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),a.lineAtlas&&(this.lineAtlas=a.lineAtlas),this._lastUpdatedBrightness=a.brightness}else this.collisionBoxArray=new o.aD}unloadVectorData(){if(this.hasData()){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(a){return this.buckets[a.fqid]}upload(a){for(let m in this.buckets){let p=this.buckets[m];p.uploadPending()&&p.upload(a)}let l=a.gl,c=this.imageAtlas;if(c&&!c.uploaded){let m=!!Object.keys(c.patternPositions).length;this.imageAtlasTexture=new o.T(a,c.image,l.RGBA,{useMipmap:m}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(a,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(a,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(a,l,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture,c),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let m=l.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this._lastUpdatedBrightness=m,this.updateBuckets(void 0,l)))}queryRenderedFeatures(a,l,c,m,p,Z,R,I){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:R,transform:Z,params:p,tileTransform:this.tileTransform},a,l,c):{}}querySourceFeatures(a,l){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let m=c.loadVTLayers(),p=l?l.sourceLayer:"",Z=m._geojsonTileLayer||m[p];if(!Z)return;let R=o.aG(l&&l.filter),{z:I,x:N,y:Y}=this.tileID.canonical,J={z:I,x:N,y:Y};for(let M=0;M<Z.length;M++){let T=Z.feature(M);if(R.needGeometry){let z=o.aH(T,!0);if(!R.filter(new o.K(this.tileID.overscaledZ),z,this.tileID.canonical))continue}else if(!R.filter(new o.K(this.tileID.overscaledZ),T))continue;let v=c.getId(T,p),f=new o.aI(T,I,N,Y,v);f.tile=J,a.push(f)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let a in this.buckets)if(this.buckets[a].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){let l=this.expirationTime;if(a.cacheControl){let c=o.aJ(a.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){let c=Date.now(),m=!1;if(this.expirationTime>c)m=!1;else if(l)if(this.expirationTime<l)m=!0;else{let p=this.expirationTime-l;p?this.expirationTime=c+Math.max(p,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0&&l&&this.updateBuckets(a,l)}updateBuckets(a,l){if(!this.latestFeatureIndex)return;let c=this.latestFeatureIndex.loadVTLayers(),m=l.style.listImages(),p=l.style.getBrightness();for(let Z in this.buckets){if(!l.style.hasLayer(Z))continue;let R=this.buckets[Z],I=R.layers[0].sourceLayer||"_geojsonTileLayer",N=c[I],Y={};if(a&&(Y=a[I],!N||!Y||Object.keys(Y).length===0))continue;if(R.update(Y,N,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),R instanceof o.aK||R instanceof o.aL){let M=l.style.getOwnSourceCache(R.layers[0].source);l._terrain&&l._terrain.enabled&&M&&R.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(M.id,this.tileID)}let J=l&&l.style&&l.style.getOwnLayer(Z);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(R)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=o.f.now()+a}setTexture(a,l){let c=l.context,m=c.gl;this.texture=this.texture||l.getTileTexture(a.width),this.texture&&this.texture instanceof o.T?this.texture.update(a,{useMipmap:!0}):(this.texture=new o.T(c,a,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(a,l){let c={};for(let m of l)c[m]=!0;this.dependencies[a]=c}hasDependency(a,l){for(let c of a){let m=this.dependencies[c];if(m){for(let p of l)if(m[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(a,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;let c=o.aM(An,this.tileID.canonical,this.tileTransform)[0],m=new o.aN,p=new o.aO;for(let Z=0;Z<c.length;Z++){let{x:R,y:I}=c[Z];m.emplaceBack(R,I),p.emplaceBack(Z)}p.emplaceBack(0),this._tileDebugIndexBuffer=a.createIndexBuffer(p),this._tileDebugBuffer=a.createVertexBuffer(m,o.aP.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,m.length,p.length)}_makeTileBoundsBuffers(a,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;let c=o.aM(An,this.tileID.canonical,this.tileTransform)[0],m,p;if(this.isRaster){let Z=function(R,I){let N=o.as(R,I),Y=Math.pow(2,R.z);for(let z=0;z<qt;z++)for(let Q=0;Q<qt;Q++){let E=o.at((R.x+(Q+Ki(Q))/ae)/Y),P=o.au((R.y+(z+Ki(z))/ae)/Y),H=I.project(E,P),K=z*qt+Q;ni[2*K+0]=Math.round((H.x*N.scale-N.x)*o.V),ni[2*K+1]=Math.round((H.y*N.scale-N.y)*o.V)}Ge.fill(0),Ti.fill(0);for(let z=2045;z>=0;z--){let Q=4*z,E=Be[Q+0],P=Be[Q+1],H=Be[Q+2],K=Be[Q+3],w=E+H>>1,q=P+K>>1,it=w+q-P,at=q+E-w,rt=P*qt+E,Zt=K*qt+H,bt=q*qt+w,It=Math.hypot((ni[2*rt+0]+ni[2*Zt+0])/2-ni[2*bt+0],(ni[2*rt+1]+ni[2*Zt+1])/2-ni[2*bt+1])>=16;Ge[bt]=Ge[bt]||(It?1:0),z<1022&&(Ge[bt]=Ge[bt]||Ge[(P+at>>1)*qt+(E+it>>1)]||Ge[(K+at>>1)*qt+(H+it>>1)])}let J=new o.av,M=new o.aw,T=0;function v(z,Q){let E=Q*qt+z;return Ti[E]===0&&(J.emplaceBack(ni[2*E+0],ni[2*E+1],z*o.V/ae,Q*o.V/ae),Ti[E]=++T),Ti[E]-1}function f(z,Q,E,P,H,K){let w=z+E>>1,q=Q+P>>1;if(Math.abs(z-H)+Math.abs(Q-K)>1&&Ge[q*qt+w])f(H,K,z,Q,w,q),f(E,P,H,K,w,q);else{let it=v(z,Q),at=v(E,P),rt=v(H,K);M.emplaceBack(it,at,rt)}}return f(0,0,ae,ae,ae,0),f(ae,ae,0,0,0,ae),{vertices:J,indices:M}}(this.tileID.canonical,l);m=Z.vertices,p=Z.indices}else{m=new o.av,p=new o.aw;for(let{x:R,y:I}of c)m.emplaceBack(R,I,0,0);let Z=o.aQ(m.int16,void 0,4);for(let R=0;R<Z.length;R+=3)p.emplaceBack(Z[R],Z[R+1],Z[R+2])}this._tileBoundsBuffer=a.createVertexBuffer(m,o.aR.members),this._tileBoundsIndexBuffer=a.createIndexBuffer(p),this._tileBoundsSegments=o.aB.simpleSegment(0,0,m.length,p.length)}_makeGlobeTileDebugBuffers(a,l){let c=l.projection;if(!c||c.name!=="globe"||l.freezeTileCoverage)return;let m=this.tileID.canonical,p=o.aS(m,l),Z=o.aT(p),R=o.S(l.zoom),I;R>0&&(I=o.a6.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(a,m,l,Z,I,R),this._makeGlobeTileDebugTextBuffer(a,m,l,Z,I,R)}_globePoint(a,l,c,m,p,Z,R){let I=o.aU(a,l,c);if(Z){let N=1<<c.z,Y=o.a5(m.center.lng),J=o.ae(m.center.lat),M=(c.x+.5)/N-Y,T=0;M>.5?T=-1:M<-.5&&(T=1);let v=(a/o.V+c.x)/N+T,f=(l/o.V+c.y)/N;v=(v-Y)*m._pixelsPerMercatorPixel+Y,f=(f-J)*m._pixelsPerMercatorPixel+J;let z=[v*m.worldSize,f*m.worldSize,0];o.N.transformMat4(z,z,Z),I=o.aV(I,z,R)}return o.N.transformMat4(I,I,p)}_makeGlobeTileDebugBorderBuffer(a,l,c,m,p,Z){let R=new o.aN,I=new o.aO,N=new o.aW,Y=(M,T,v,f,z)=>{let Q=(v-M)/(z-1),E=(f-T)/(z-1),P=R.length;for(let H=0;H<z;H++){let K=M+H*Q,w=T+H*E;R.emplaceBack(K,w);let q=this._globePoint(K,w,l,c,m,p,Z);N.emplaceBack(q[0],q[1],q[2]),I.emplaceBack(P+H)}},J=o.V;Y(0,0,J,0,16),Y(J,0,J,J,16),Y(J,J,0,J,16),Y(0,J,0,0,16),this._tileDebugIndexBuffer=a.createIndexBuffer(I),this._tileDebugBuffer=a.createVertexBuffer(R,o.aP.members),this._globeTileDebugBorderBuffer=a.createVertexBuffer(N,o.aX.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,R.length,I.length)}_makeGlobeTileDebugTextBuffer(a,l,c,m,p,Z){let R=o.V/4,I=new o.aN,N=new o.aw,Y=new o.aW,J=25;N.reserve(32),I.reserve(J),Y.reserve(J);let M=(T,v)=>J*T+v;for(let T=0;T<J;T++){let v=T*R;for(let f=0;f<J;f++){let z=f*R;I.emplaceBack(z,v);let Q=this._globePoint(z,v,l,c,m,p,Z);Y.emplaceBack(Q[0],Q[1],Q[2])}}for(let T=0;T<4;T++)for(let v=0;v<4;v++){let f=M(T,v),z=M(T,v+1),Q=M(T+1,v),E=M(T+1,v+1);N.emplaceBack(f,z,Q),N.emplaceBack(Q,z,E)}this._tileDebugTextIndexBuffer=a.createIndexBuffer(N),this._tileDebugTextBuffer=a.createVertexBuffer(I,o.aP.members),this._globeTileDebugTextBuffer=a.createVertexBuffer(Y,o.aX.members),this._tileDebugTextSegments=o.aB.simpleSegment(0,0,J,32)}destroy(a=!1){for(let l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!a&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Bl={vector:te,raster:ee,"raster-dem":class extends ee{constructor(d,a,l,c){super(d,a,l,c),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(d,a){let l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(m,p){m&&(d.state="errored",a(m)),p&&(d.dem=p,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",a(null))}d.request=o.d(this.map._requestManager.transformRequest(l,o.R.Tile),(function(m,p,Z,R){if(delete d.request,d.aborted)d.state="unloaded",a(null);else if(m)d.state="errored",a(m);else if(p){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:Z,expires:R});let I=ImageBitmap&&p instanceof ImageBitmap&&o.ak(),N=1-(p.width-o.al(p.width))/2;N<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));let Y=I?p:o.f.getImageData(p,N),J={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:Y,encoding:this.encoding,padding:N};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",J,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){let a=d.canonical,l=Math.pow(2,a.z),c=(a.x-1+l)%l,m=a.x===0?d.wrap-1:d.wrap,p=(a.x+1+l)%l,Z=a.x+1===l?d.wrap+1:d.wrap,R={};return R[new o.am(d.overscaledZ,m,a.z,c,a.y).key]={backfilled:!1},R[new o.am(d.overscaledZ,Z,a.z,p,a.y).key]={backfilled:!1},a.y>0&&(R[new o.am(d.overscaledZ,m,a.z,c,a.y-1).key]={backfilled:!1},R[new o.am(d.overscaledZ,d.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},R[new o.am(d.overscaledZ,Z,a.z,p,a.y-1).key]={backfilled:!1}),a.y+1<l&&(R[new o.am(d.overscaledZ,m,a.z,c,a.y+1).key]={backfilled:!1},R[new o.am(d.overscaledZ,d.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},R[new o.am(d.overscaledZ,Z,a.z,p,a.y+1).key]={backfilled:!1}),R}},"raster-array":Dt,geojson:class extends o.E{constructor(d,a,l,c){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(c),this._data=a.data,this._options=o.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;let m=o.V/this.tileSize;this.workerOptions=o.e({source:this.id,scope:this.scope,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*m,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*m,extent:o.V,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.V,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*m,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},a),this}getClusterChildren(d,a){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},a),this}getClusterLeaves(d,a,l,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:a,offset:l},c),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.b("dataloading",{dataType:"source"})),this._loaded=!1;let d=o.e({},this.workerOptions);d.scope=this.scope;let a=this._data;typeof a=="string"?(d.request=this.map._requestManager.transformRequest(o.f.resolveURL(a),o.R.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(a),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),d,(l,c)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new o.a(l));else{let m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&c&&c.resourceTiming&&c.resourceTiming[this.id]&&(m.resourceTiming=c.resourceTiming[this.id]),this.fire(new o.b("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,a){let l=d.actor?"reloadTile":"loadTile";d.actor=this.actor;let c={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};d.request=this.actor.send(l,c,(m,p)=>(delete d.request,d.destroy(),d.aborted?a(null):m?a(m):(d.loadVectorData(p,this.map.painter,l==="reloadTile"),a(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.ap{constructor(d,a,l,c){super(d,a,l,c),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;let d=this.options;this.urls=[];for(let a of d.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.R.Source).url);o.aq(this.urls,(a,l)=>{this._loaded=!0,a?this.fire(new o.a(a)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){let a=this.video.seekable;d<a.start(0)||d>a.end(0)?this.fire(new o.a(new Kt("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(a.start(0)," and ").concat(a.end(0),"-second mark.")))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let d=this.map.painter.context,a=d.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(d,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.ap,model:class extends o.E{constructor(d,a,l,c){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=a}load(){let d=[];for(let a in this._options.models){let l=this._options.models[a],c=o.l(this.map._requestManager.transformRequest(l.uri,o.R.Model).url).then(m=>{if(!m)return;let p=o.c(m),Z=new o.M(a,l.position,l.orientation,p);Z.computeBoundsAndApplyParent(),this.models.push(Z)}).catch(m=>{this.fire(new o.a(new Error("Could not load model ".concat(a," from ").concat(l.uri,": ").concat(m.message))))});d.push(c)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this.fire(new o.a(new Error("Could not load models: ".concat(a.message))))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,a){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(d,a,l,c){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=a,this.tiles=this._options.tiles,this.maxzoom=a.maxzoom||19,this.minzoom=a.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(d){this.map=d,this.load()}load(d){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=Pt(this._options,this.map._requestManager,a,l,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?(a&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(a)),l&&l.length!==2&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(l)),this.fire(new o.a(c))):m&&(o.e(this,m),m.bounds&&(this.tileBounds=new Ht(m.bounds,this.minzoom,this.maxzoom)),o.aj(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),d&&d(c)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,a){let l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=a;else{if(d.buckets){let p=Object.values(d.buckets);for(let Z of p)Z.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",c,m.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",c,m.bind(this),void 0,!0);function m(p,Z){return d.aborted?a(null):p&&p.status!==404?a(p):(Z&&(Z.resourceTiming&&(d.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&d.setExpiryData(Z),d.buckets={...d.buckets,...Z.buckets},Z.featureIndex&&(d.latestFeatureIndex=Z.featureIndex)),d.state="loaded",void a(null))}}serialize(){return o.e({},this._options)}},canvas:class extends o.ap{constructor(d,a,l,c){super(d,a,l,c),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(p=>typeof p!="number"))||this.fire(new o.a(new Kt("sources.".concat(d),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.a(new Kt("sources.".concat(d),null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.a(new Kt("sources.".concat(d),null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new o.a(new Kt("sources.".concat(d),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.a(new Kt("sources.".concat(d),null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof o.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends o.E{constructor(d,a,l,c){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=a,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.a(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new o.a(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new Ht(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.e(this,o.ac(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){let{x:a,y:l,z:c}=d.canonical;return this._implementation.hasTile({x:a,y:l,z:c})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,a){let{x:l,y:c,z:m}=d.tileID.canonical,p=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:c,z:m},{signal:p.signal})).then((function(Z){return delete d.request,d.aborted?(d.state="unloaded",a(null)):Z===void 0?(d.state="errored",a(null)):Z===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",a(null)):function(R){return R instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement}(Z)?(this.loadTileData(d,Z),d.state="loaded",void a(null)):(d.state="errored",a(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}).bind(this)).catch(Z=>{Z.code!==20&&(d.state="errored",a(Z))}),d.request.cancel=()=>p.abort()}loadTileData(d,a){d.setTexture(a,this._map.painter)}unloadTile(d,a){if(d.texture&&d.texture instanceof o.T?(d.destroy(!0),d.texture&&d.texture instanceof o.T&&this._map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){let{x:l,y:c,z:m}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:c,z:m})}a()}abortTile(d,a){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){let d=o.ag(this.id,this.scope);this._map.style.clearSource(d)}_update(){this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}}},Ua=function(d,a,l,c){let m=new Bl[a.type](d,a,l,c);if(m.id!==d)throw new Error("Expected Source id to be ".concat(d," instead of ").concat(m.id));return o.aY(["load","abort","unload","serialize","prepare"],m),m};function Lc(d,a){let l=o.a6.identity([]);return o.a6.scale(l,l,[.5*d.width,.5*-d.height,1]),o.a6.translate(l,l,[1,-1,0]),o.a6.multiply(l,l,d.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(l)}function zc(d,a,l,c,m,p,Z,R=!1){let I=d.tilesIn(c,Z,R);I.sort(rr);let N=[];for(let J of I)N.push({wrappedTileID:J.tile.tileID.wrapped().key,queryResults:J.tile.queryRenderedFeatures(a,l,d._state,J,m,p,Lc(d.transform,J.tile.tileID),R)});let Y=function(J){let M={},T={};for(let v of J){let f=v.queryResults,z=v.wrappedTileID,Q=T[z]=T[z]||{};for(let E in f){let P=f[E],H=Q[E]=Q[E]||{},K=M[E]=M[E]||[];for(let w of P)H[w.featureIndex]||(H[w.featureIndex]=!0,K.push(w))}}return M}(N);for(let J in Y)Y[J].forEach(M=>{let T=M.feature,v=T.layer;v&&v.type!=="background"&&v.type!=="sky"&&v.type!=="slot"&&(T.source=v.source,v["source-layer"]&&(T.sourceLayer=v["source-layer"]),T.state=T.id!==void 0?d.getFeatureState(v["source-layer"],T.id):{})});return Y}function Ml(d,a){let l=d.getRenderableIds().map(p=>d.getTileByID(p)),c=[],m={};for(let p=0;p<l.length;p++){let Z=l[p],R=Z.tileID.canonical.key;m[R]||(m[R]=!0,Z.querySourceFeatures(c,a))}return c}function rr(d,a){let l=d.tileID,c=a.tileID;return l.overscaledZ-c.overscaledZ||l.canonical.y-c.canonical.y||l.wrap-c.wrap||l.canonical.x-c.canonical.x}class Xo extends to{constructor(a,l,c,m,p){super(a,l,c,m,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(a,l){let c=l.context,m=c.gl;this.texture=this.texture||l.getTileTexture(a.width),this.texture&&this.texture instanceof o.T?this.texture.update(a,{useMipmap:!1,premultiply:!1}):this.texture=new o.T(c,a,m.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(a=16384,l){let c=this._mrt=new o.aZ(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(a-1)}});return this.entireBuffer=null,this.request=o.a_(m,(p,Z,R,I)=>{if(p)l(p);else try{let N=c.getHeaderLength(Z);if(N>a)return void(this.request=this.fetchHeader(N,l));c.parseHeader(Z),this._isHeaderLoaded=!0;let Y=0;for(let J of Object.values(c.layers))Y=Math.max(Y,J.dataIndex[J.dataIndex.length-1].last_byte);Z.byteLength>=Y&&(this.entireBuffer=Z),l(null,this.entireBuffer||Z,R,I)}catch(N){l(N)}}),this.request}fetchBand(a,l,c){let m=this._mrt;if(!this._isHeaderLoaded||!m)return void c(new Error("Tile header is not ready"));let p=this.actor;if(!p)return void c(new Error("Can't fetch tile band without an actor"));let Z,R=(J,M)=>{Z.complete(J,M),J?c(J):(this.updateTextureDescriptor(a,l),c(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(J,M)=>{if(J)return c(J);let T=p.send("decodeRasterArray",{buffer:M,task:Z},R,void 0,!0);this._workQueue.push(()=>{T&&T.cancel(),Z.cancel()})},N=m.getLayer(a);if(!N)return void c(new Error('Unknown sourceLayer "'.concat(a,'"')));if(N.hasDataForBand(l))return this.updateTextureDescriptor(a,l),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);let Y=N.getDataRange([l]);if(Z=m.createDecodingTask(Y),!Z||Z.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(Y.firstByte,Y.lastByte+1));else{let J=Object.assign({},this.requestParams,{headers:{Range:"bytes=".concat(Y.firstByte,"-").concat(Y.lastByte)}}),M=o.a_(J,I);this._fetchQueue.push(()=>{M.cancel(),Z.cancel()})}else c(null)}updateNeeded(a,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==a)&&this.state!=="errored"}updateTextureDescriptor(a,l){if(!this._mrt)return;let c=this._mrt.getLayer(a);if(!c||!c.hasBand(l)||!c.hasDataForBand(l))return;let{bytes:m,tileSize:p,buffer:Z,offset:R,scale:I}=c.getBandView(l),N=p+2*Z,Y={data:m,width:N,height:N},J=this.texture;J&&J instanceof o.T&&J.update(Y,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:a,band:l,img:Y,buffer:Z,offset:R,tileSize:p,format:c.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class sr{constructor(a,l){this.max=a,this.onRemove=l,this.reset()}reset(){for(let a in this.data)for(let l of this.data[a])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(a,l,c){let m=a.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);let p={value:l,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(a,p)},c)),this.data[m].push(p),this.order.push(m),this.order.length>this.max){let Z=this._getAndRemoveByKey(this.order[0]);Z&&this.onRemove(Z)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){let l=this.data[a].shift();return l.timeout&&clearTimeout(l.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),l.value}getByKey(a){let l=this.data[a];return l?l[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,l){if(!this.has(a))return this;let c=a.wrapped().key,m=l===void 0?0:this.data[c].indexOf(l),p=this.data[c][m];return this.data[c].splice(m,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(a){let l=[];for(let c in this.data)for(let m of this.data[c])a(m.value)||l.push(m);for(let c of l)this.remove(c.value.tileID,c)}}class al extends o.E{constructor(a,l,c){super(),this.id=a,this._onlySymbols=c,l.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new sr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ye,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(a){this.map=a,this._minTileCacheSize=this._minTileCacheSize===void 0&&a?a._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&a?a._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let a in this._tiles){let l=this._tiles[a];if(l.state!=="errored"&&(l.state!=="loaded"||!l.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,l){return a.isSymbolTile=this._onlySymbols,a.isExtraShadowCaster=this._shadowCasterTiles[a.tileID.key],this._source.loadTile(a,l)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){if(this._source.abortTile)return this._source.abortTile(a,()=>{})}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let c=this._tiles[l];c.upload(a),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.a$(this._tiles).map(a=>a.tileID).sort(Wd).map(a=>a.key)}getRenderableIds(a,l){let c=[];for(let m in this._tiles)this._isIdRenderable(+m,a,l)&&c.push(this._tiles[m]);return a?c.sort((m,p)=>{let Z=m.tileID,R=p.tileID,I=new o.P(Z.canonical.x,Z.canonical.y)._rotate(this.transform.angle),N=new o.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return Z.overscaledZ-R.overscaledZ||N.y-I.y||N.x-I.x}).map(m=>m.tileID.key):c.map(m=>m.tileID).sort(Wd).map(m=>m.key)}hasRenderableParent(a){let l=this.findLoadedParent(a,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(a,l,c){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(l||!this._tiles[a].holdingForFade())&&(c||!this._shadowCasterTiles[a])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(+a,"reloading")}}_reloadTile(a,l){let c=this._tiles[a];c&&(c.state!=="loading"&&(c.state=l),this._loadTile(c,this._tileLoaded.bind(this,c,a,l)))}_tileLoaded(a,l,c,m){if(m)if(a.state="errored",m.status!==404)this._source.fire(new o.a(m,{tile:a}));else{if(!(a.tileID.key in this._loadedParentTiles))return void this._source.fire(new o.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else a.timeAdded=o.f.now(),c==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(l,a),this._source.type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new o.b("data",{dataType:"source",tile:a,coord:a.tileID,sourceCacheId:this.id}))}_backfillDEM(a){let l=this.getRenderableIds();for(let m=0;m<l.length;m++){let p=l[m];if(a.neighboringTiles&&a.neighboringTiles[p]){let Z=this.getTileByID(p);c(a,Z),c(Z,a)}}function c(m,p){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let Z=p.tileID.canonical.x-m.tileID.canonical.x,R=p.tileID.canonical.y-m.tileID.canonical.y,I=Math.pow(2,m.tileID.canonical.z),N=p.tileID.key;Z===0&&R===0||Math.abs(R)>1||(Math.abs(Z)>1&&(Math.abs(Z+I)===1?Z+=I:Math.abs(Z-I)===1&&(Z-=I)),p.dem&&m.dem&&(m.dem.backfillBorder(p.dem,Z,R),m.neighboringTiles&&m.neighboringTiles[N]&&(m.neighboringTiles[N].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,l,c,m){for(let p in this._tiles){let Z=this._tiles[p];if(m[p]||!Z.hasData()||Z.tileID.overscaledZ<=l||Z.tileID.overscaledZ>c)continue;let R=Z.tileID;for(;Z&&Z.tileID.overscaledZ>l+1;){let N=Z.tileID.scaledTo(Z.tileID.overscaledZ-1);Z=this._tiles[N.key],Z&&Z.hasData()&&(R=N)}let I=R;for(;I.overscaledZ>l;)if(I=I.scaledTo(I.overscaledZ-1),a[I.key]){m[R.key]=R;break}}}findLoadedParent(a,l){if(a.key in this._loadedParentTiles){let c=this._loadedParentTiles[a.key];return c&&c.tileID.overscaledZ>=l?c:null}for(let c=a.overscaledZ-1;c>=l;c--){let m=a.scaledTo(c),p=this._getLoadedTile(m);if(p)return p}}_getLoadedTile(a){let l=this._tiles[a.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?a.wrapped().key:a.canonical.key)}updateCacheSize(a,l){l=l||this._source.tileSize;let c=Math.ceil(a.width/l)+1,m=Math.ceil(a.height/l)+1,p=Math.floor(c*m*5),Z=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,Z):Z;this._cache.setMaxSize(R)}handleWrapJump(a){let l=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,l){let c={};for(let m in this._tiles){let p=this._tiles[m];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+l),c[p.tileID.key]=p}this._tiles=c;for(let m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(let m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(a,l,c,m){if(this.transform=a,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;if(this.updateCacheSize(a,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)p=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new o.am(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y));else if(this.tileCoverLift!==0){let I=a.clone();I.tileCoverLift=this.tileCoverLift,p=I.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&a.projection.name==="globe"&&(p.push(new o.am(1,0,1,0,0)),p.push(new o.am(1,0,1,1,0)),p.push(new o.am(1,0,1,0,1)),p.push(new o.am(1,0,1,1,1)))}else p=a.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(I=>this._source.hasTile(I)));else p=[];if(p.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Cl(this._source.type)){let I=a.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),N=Math.min(I,this._source.maxzoom),Y=a.extendTileCoverForShadows(p,m,N);for(let J of Y)this._shadowCasterTiles[J.key]=!0,p.push(J)}let Z=this._updateRetainedTiles(p);if(Cl(this._source.type)&&p.length!==0){let I={},N={},Y=Object.keys(Z);for(let M of Y){let T=Z[M],v=this._tiles[M];if(!v||v.fadeEndTime&&v.fadeEndTime<=o.f.now())continue;let f=this.findLoadedParent(T,Math.max(T.overscaledZ-al.maxOverzooming,this._source.minzoom));f&&(this._addTile(f.tileID),I[f.tileID.key]=f.tileID),N[M]=T}let J=p[p.length-1].overscaledZ;for(let M in this._tiles){let T=this._tiles[M];if(Z[M]||!T.hasData())continue;let v=T.tileID;for(;v.overscaledZ>J;){v=v.scaledTo(v.overscaledZ-1);let f=this._tiles[v.key];if(f&&f.hasData()&&N[v.key]){Z[M]=T.tileID;break}}}for(let M in I)Z[M]||(this._coveredTiles[M]=!0,Z[M]=I[M])}for(let I in Z)this._tiles[I].clearFadeHold();let R=o.b0(this._tiles,Z);for(let I of R){let N=this._tiles[I];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+I)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(+a)}_updateRetainedTiles(a){let l={};if(a.length===0)return l;let c={},m=a.reduce((N,Y)=>Math.min(N,Y.overscaledZ),1/0),p=a[0].overscaledZ,Z=Math.max(p-al.maxOverzooming,this._source.minzoom),R=Math.max(p+al.maxUnderzooming,this._source.minzoom),I={};for(let N of a){let Y=this._addTile(N);l[N.key]=N,Y.hasData()||m<this._source.maxzoom&&(I[N.key]=N)}this._retainLoadedChildren(I,m,R,l);for(let N of a){let Y=this._tiles[N.key];if(Y.hasData())continue;if(N.canonical.z>=this._source.maxzoom){let M=N.children(this._source.maxzoom)[0],T=this.getTile(M);if(T&&T.hasData()){l[M.key]=M;continue}}else{let M=N.children(this._source.maxzoom);if(l[M[0].key]&&l[M[1].key]&&l[M[2].key]&&l[M[3].key])continue}let J=Y.wasRequested();for(let M=N.overscaledZ-1;M>=Z;--M){let T=N.scaledTo(M);if(c[T.key]||(c[T.key]=!0,Y=this.getTile(T),!Y&&J&&(Y=this._addTile(T)),Y&&(l[T.key]=T,J=Y.wasRequested(),Y.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let a in this._tiles){let l=[],c,m=this._tiles[a].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){c=this._loadedParentTiles[m.key];break}l.push(m.key);let p=m.scaledTo(m.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;m=p}for(let p of l)this._loadedParentTiles[p]=c}}_addTile(a){let l=this._tiles[a.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[a.key]||this._reloadTile(a.key,"reloading"),l;l=this._cache.getAndRemove(a),l&&(this._setTileReloadTimer(a.key,l),l.tileID=a,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,l)));let c=!!l;if(!c){let m=this.map?this.map.painter:null,p=this._source.tileSize*a.overscaleFactor();l=this._source.type==="raster-array"?new Xo(a,p,this.transform.tileZoom,m,this._isRaster):new to(a,p,this.transform.tileZoom,m,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,a.key,l.state))}return l?(l.uses++,this._tiles[a.key]=l,c||this._source.fire(new o.b("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(a,l){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);let c=l.getExpiryTimeout();c&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},c))}_removeTile(a){let l=this._tiles[a];l&&(l.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let a in this._tiles)this._removeTile(+a);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(a,l,c){let m=[],p=this.transform;if(!p)return m;let Z=p.projection.name==="globe",R=o.a5(p.center.lng);for(let I in this._tiles){let N=this._tiles[I];if(c&&N.clearQueryDebugViz(),N.holdingForFade())continue;let Y;if(Z){let J=N.tileID.canonical;if(J.z===0){let M=[Math.abs(o.aa(R,...ts(J,-1))-R),Math.abs(o.aa(R,...ts(J,1))-R)];Y=[0,2*M.indexOf(Math.min(...M))-1]}else{let M=[Math.abs(o.aa(R,...ts(J,-1))-R),Math.abs(o.aa(R,...ts(J,0))-R),Math.abs(o.aa(R,...ts(J,1))-R)];Y=[M.indexOf(Math.min(...M))-1]}}else Y=[0];for(let J of Y){let M=a.containsTile(N,p,l,J);M&&m.push(M)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(a){return this._getRenderableCoordinates(a)}_getRenderableCoordinates(a,l){let c=this.getRenderableIds(a,l).map(p=>this._tiles[p].tileID),m=this.transform.projection.name==="globe";for(let p of c)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=m?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return c}sortCoordinatesByDistance(a){let l=a.slice(),c=this.transform._camera.position,m=this.transform._camera.forward(),p={};for(let Z of l){let R=1/(1<<Z.canonical.z);p[Z.key]=((Z.canonical.x+.5)*R+Z.wrap-c[0])*m[0]+((Z.canonical.y+.5)*R-c[1])*m[1]-c[2]*m[2]}return l.sort((Z,R)=>p[Z.key]-p[R.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Cl(this._source.type))for(let a in this._tiles){let l=this._tiles[a];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.f.now())return!0}return!1}setFeatureState(a,l,c){this._state.updateState(a=a||"_geojsonTileLayer",l,c)}removeFeatureState(a,l,c){this._state.removeFeatureState(a=a||"_geojsonTileLayer",l,c)}getFeatureState(a,l){return this._state.getState(a=a||"_geojsonTileLayer",l)}setDependencies(a,l,c){let m=this._tiles[a];m&&m.setDependencies(l,c)}reloadTilesForDependencies(a,l){for(let c in this._tiles)this._tiles[c].hasDependency(a,l)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(a,l))}_preloadTiles(a,l){if(!this._sourceLoaded){let I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(a,l))};return void this._source.on("data",I)}let c=new Map,m=Array.isArray(a)?a:[a],p=this.map.painter.terrain,Z=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(let I of m){let N=I.coveringTiles({tileSize:Z,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let Y of N)c.set(Y.key,Y);this.usedForTerrain&&I.updateElevation(!1)}let R=Array.from(c.values());o.b1(R,(I,N)=>{let Y=new to(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(Y,J=>{this._source.type==="raster-dem"&&Y.dem&&this._backfillDEM(Y),N(J,Y)})},l)}}function Wd(d,a){let l=Math.abs(2*d.wrap)-+(d.wrap<0),c=Math.abs(2*a.wrap)-+(a.wrap<0);return d.overscaledZ-a.overscaledZ||c-l||a.canonical.y-d.canonical.y||a.canonical.x-d.canonical.x}function Cl(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function ts(d,a){let l=1<<d.z;return[d.x/l+a,(d.x+1)/l+a]}al.maxOverzooming=10,al.maxUnderzooming=3;class l0{constructor(a){this.style=a,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let a=!1,l=!1;for(let c in this.style._mergedLayers){let m=this.style._mergedLayers[c];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:a,visibilityChanged:l});else if(m.type==="model"){let p=this.style.getLayerSource(m);p&&p.type==="batched-model"&&this.layers.push({layer:m,visible:a,visibilityChanged:l})}}}onNewFrame(a){this.layersGotHidden=!1;for(let l of this.layers){let c=l.layer,m=!1;c.type==="fill-extrusion"?m=!c.isHidden(a)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="model"&&(m=!c.isHidden(a)&&c.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!m&&l.visible,l.visible=m}}updateZOffset(a,l){this.currentBuildingBuckets=[];for(let m of this.layers){let p=m.layer,Z=this.style.getLayerSourceCache(p),R=1;p.type==="fill-extrusion"&&(R=m.visible?p.paint.get("fill-extrusion-vertical-scale"):0);let I=Z?Z.getTile(l):null;if(!I&&Z&&l.canonical.z>Z.getSource().minzoom){let N=l.scaledTo(Math.min(Z.getSource().maxzoom,l.overscaledZ-1));for(;N.overscaledZ>=Z.getSource().minzoom&&(I=Z.getTile(N),!I&&N.overscaledZ!==0);)N=N.scaledTo(N.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(p):null,tileID:I?I.tileID:l,verticalScale:R})}a.hasAnyZOffset=!1;let c=!1;for(let m=0;m<a.symbolInstances.length;m++){let p=a.symbolInstances.get(m),Z=p.zOffset,R=this._getHeightAtTileOffset(l,p.tileAnchorX,p.tileAnchorY);p.zOffset=R!==Number.NEGATIVE_INFINITY?R:Z,c||Z===p.zOffset||(c=!0),a.hasAnyZOffset||p.zOffset===0||(a.hasAnyZOffset=!0)}c&&(a.zOffsetBuffersNeedUpload=!0,a.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(a,l,c,m){let p=l,Z=c;if(a.canonical.z!==m.canonical.z){let R=m.canonical,I=1/(1<<a.canonical.z-R.z);p=(l+a.canonical.x*o.V)*I-R.x*o.V|0,Z=(c+a.canonical.y*o.V)*I-R.y*o.V|0}return{tileX:p,tileY:Z}}_getHeightAtTileOffset(a,l,c){let m,p;for(let Z=0;Z<this.layers.length;++Z){if(this.layers[Z].layer.type!=="fill-extrusion")continue;let{bucket:R,tileID:I,verticalScale:N}=this.currentBuildingBuckets[Z];if(!R)continue;let{tileX:Y,tileY:J}=this._mapCoordToOverlappingTile(a,l,c,I),M=R.getHeightAtTileCoord(Y,J);M&&M.height!==void 0&&(M.hidden?m=M.height:p=Math.max(M.height*N,p||0))}if(p!==void 0)return p;for(let Z=0;Z<this.layers.length;++Z){let R=this.layers[Z];if(R.layer.type!=="model"||!R.visible)continue;let{bucket:I,tileID:N}=this.currentBuildingBuckets[Z];if(!I)continue;let{tileX:Y,tileY:J}=this._mapCoordToOverlappingTile(a,l,c,N),M=I.getHeightAtTileCoord(Y,J);if(M&&!M.hidden)return M.height===void 0&&m!==void 0?Math.min(M.maxHeight,m)*M.verticalScale:(M.height||0)*M.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Jo(d,a){let l={};for(let c in d)c!=="ref"&&(l[c]=d[c]);return o.b2.forEach(c=>{c in a&&(l[c]=a[c])}),l}function o0(d){d=d.slice();let a=Object.create(null);for(let l=0;l<d.length;l++)a[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=Jo(d[l],a[d[l].ref]));return d}let ri={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function es(d,a,l){l.push({command:ri.addSource,args:[d,a[d]]})}function wc(d,a,l){a.push({command:ri.removeSource,args:[d]}),l[d]=!0}function Qp(d,a,l,c){wc(d,l,c),es(d,a,l)}function Sp(d,a,l){let c;for(c in d[l])if(d[l].hasOwnProperty(c)&&c!=="data"&&!_(d[l][c],a[l][c]))return!1;for(c in a[l])if(a[l].hasOwnProperty(c)&&c!=="data"&&!_(d[l][c],a[l][c]))return!1;return!0}function eo(d,a,l,c,m,p){let Z;for(Z in a=a||{},d=d||{})d.hasOwnProperty(Z)&&(_(d[Z],a[Z])||l.push({command:p,args:[c,Z,a[Z],m]}));for(Z in a)a.hasOwnProperty(Z)&&!d.hasOwnProperty(Z)&&(_(d[Z],a[Z])||l.push({command:p,args:[c,Z,a[Z],m]}))}function io(d){return d.id}function ud(d,a){return d[a.id]=a,d}class dr{constructor(a,l){this.reset(a,l)}reset(a,l){this.points=a||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.aa(a,0,1);let l=1,c=this._distances[l],m=a*this.paddedLength+this.padding;for(;c<m&&l<this._distances.length;)c=this._distances[++l];let p=l-1,Z=this._distances[p],R=c-Z,I=R>0?(m-Z)/R:0;return this.points[p].mult(1-I).add(this.points[l].mult(I))}}class Ec{constructor(a,l,c){let m=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(a/c),this.yCellCount=Math.ceil(l/c);for(let Z=0;Z<this.xCellCount*this.yCellCount;Z++)m.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=l,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,l,c,m,p){this._forEachCell(l,c,m,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(p)}insertCircle(a,l,c,m){this._forEachCell(l-m,c-m,l+m,c+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(l),this.circles.push(c),this.circles.push(m)}_insertBoxCell(a,l,c,m,p,Z){this.boxCells[p].push(Z)}_insertCircleCell(a,l,c,m,p,Z){this.circleCells[p].push(Z)}_query(a,l,c,m,p,Z){if(c<0||a>this.width||m<0||l>this.height)return!p&&[];let R=[];if(a<=0&&l<=0&&this.width<=c&&this.height<=m){if(p)return!0;for(let I=0;I<this.boxKeys.length;I++)R.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){let N=this.circles[3*I],Y=this.circles[3*I+1],J=this.circles[3*I+2];R.push({key:this.circleKeys[I],x1:N-J,y1:Y-J,x2:N+J,y2:Y+J})}return Z?R.filter(Z):R}return this._forEachCell(a,l,c,m,this._queryCell,R,{hitTest:p,seenUids:{box:{},circle:{}}},Z),p?R.length>0:R}_queryCircle(a,l,c,m,p){let Z=a-c,R=a+c,I=l-c,N=l+c;if(R<0||Z>this.width||N<0||I>this.height)return!m&&[];let Y=[];return this._forEachCell(Z,I,R,N,this._queryCellCircle,Y,{hitTest:m,circle:{x:a,y:l,radius:c},seenUids:{box:{},circle:{}}},p),m?Y.length>0:Y}query(a,l,c,m,p){return this._query(a,l,c,m,!1,p)}hitTest(a,l,c,m,p){return this._query(a,l,c,m,!0,p)}hitTestCircle(a,l,c,m){return this._queryCircle(a,l,c,!0,m)}_queryCell(a,l,c,m,p,Z,R,I){let N=R.seenUids,Y=this.boxCells[p];if(Y!==null){let M=this.bboxes;for(let T of Y)if(!N.box[T]){N.box[T]=!0;let v=4*T;if(a<=M[v+2]&&l<=M[v+3]&&c>=M[v+0]&&m>=M[v+1]&&(!I||I(this.boxKeys[T]))){if(R.hitTest)return Z.push(!0),!0;Z.push({key:this.boxKeys[T],x1:M[v],y1:M[v+1],x2:M[v+2],y2:M[v+3]})}}}let J=this.circleCells[p];if(J!==null){let M=this.circles;for(let T of J)if(!N.circle[T]){N.circle[T]=!0;let v=3*T;if(this._circleAndRectCollide(M[v],M[v+1],M[v+2],a,l,c,m)&&(!I||I(this.circleKeys[T]))){if(R.hitTest)return Z.push(!0),!0;{let f=M[v],z=M[v+1],Q=M[v+2];Z.push({key:this.circleKeys[T],x1:f-Q,y1:z-Q,x2:f+Q,y2:z+Q})}}}}}_queryCellCircle(a,l,c,m,p,Z,R,I){let N=R.circle,Y=R.seenUids,J=this.boxCells[p];if(J!==null){let T=this.bboxes;for(let v of J)if(!Y.box[v]){Y.box[v]=!0;let f=4*v;if(this._circleAndRectCollide(N.x,N.y,N.radius,T[f+0],T[f+1],T[f+2],T[f+3])&&(!I||I(this.boxKeys[v])))return Z.push(!0),!0}}let M=this.circleCells[p];if(M!==null){let T=this.circles;for(let v of M)if(!Y.circle[v]){Y.circle[v]=!0;let f=3*v;if(this._circlesCollide(T[f],T[f+1],T[f+2],N.x,N.y,N.radius)&&(!I||I(this.circleKeys[v])))return Z.push(!0),!0}}}_forEachCell(a,l,c,m,p,Z,R,I){let N=this._convertToXCellCoord(a),Y=this._convertToYCellCoord(l),J=this._convertToXCellCoord(c),M=this._convertToYCellCoord(m);for(let T=N;T<=J;T++)for(let v=Y;v<=M;v++)if(p.call(this,a,l,c,m,this.xCellCount*v+T,Z,R,I))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,l,c,m,p,Z){let R=m-a,I=p-l,N=c+Z;return N*N>R*R+I*I}_circleAndRectCollide(a,l,c,m,p,Z,R){let I=(Z-m)/2,N=Math.abs(a-(m+I));if(N>I+c)return!1;let Y=(R-p)/2,J=Math.abs(l-(p+Y));if(J>Y+c)return!1;if(N<=I||J<=Y)return!0;let M=N-I,T=J-Y;return M*M+T*T<=c*c}}let Tl={unknown:0,flipRequired:1,flipNotRequired:2},ao=Math.tan(85*Math.PI/180);function is(d,a,l,c,m,p,Z){let R=o.a6.create();if(l)if(p.name==="globe"){let I=o.b3(m,a);o.a6.multiply(R,R,I)}else{let I=o.b4.invert([],Z);R[0]=I[0],R[1]=I[1],R[4]=I[2],R[5]=I[3],c||o.a6.rotateZ(R,R,m.angle)}else o.a6.multiply(R,m.labelPlaneMatrix,d);return R}function Ac(d,a,l,c,m,p,Z){let R=is(d,a,l,c,m,p,Z);return p.name==="globe"&&l||(R[2]=R[6]=R[10]=R[14]=0),R}function Hc(d,a,l,c,m,p,Z){if(l){if(p.name==="globe"){let R=is(d,a,l,c,m,p,Z);return o.a6.invert(R,R),o.a6.multiply(R,d,R),R}{let R=o.a6.clone(d),I=o.a6.identity([]);return I[0]=Z[0],I[1]=Z[1],I[4]=Z[2],I[5]=Z[3],o.a6.multiply(R,R,I),c||o.a6.rotateZ(R,R,-m.angle),R}}return m.glCoordMatrix}function Hn(d,a,l,c){let m=[d,a,l,1];l?o.a7.transformMat4(m,m,c):Kc(m,m,c);let p=m[3];return m[0]/=p,m[1]/=p,m[2]/=p,m}function r0(d,a){return Math.min(.5+d/a*.5,1.5)}function jc(d,a){let l=d[0]/d[3],c=d[1]/d[3];return l>=-a[0]&&l<=a[0]&&c>=-a[1]&&c<=a[1]}function Oc(d,a,l,c,m,p,Z,R,I,N){let Y=l.transform,J=c?d.textSizeData:d.iconSizeData,M=o.b5(J,l.transform.zoom),T=Y.projection.name==="globe",v=[256/l.width*2+1,256/l.height*2+1],f=c?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;f.clear();let z=null;T&&(z=c?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);let Q=d.lineVertexArray,E=c?d.text.placedSymbolArray:d.icon.placedSymbolArray,P=l.transform.width/l.transform.height,H,K=!1;for(let w=0;w<E.length;w++){let q=E.get(w),{numGlyphs:it,writingMode:at}=q;if(at!==o.b6.vertical||K||H===o.b6.horizontal||(K=!0),H=at,(q.hidden||at===o.b6.vertical)&&!K){no(it,f);continue}K=!1;let rt=new o.P(q.tileAnchorX,q.tileAnchorY),{x:Zt,y:bt,z:It}=Y.projection.projectTilePoint(rt.x,rt.y,N.canonical);if(I){let[$t,me,Ie]=I(rt);Zt+=$t,bt+=me,It+=Ie}let Gt=[Zt,bt,It,1];if(o.a7.transformMat4(Gt,Gt,a),!jc(Gt,v)){no(it,f);continue}let St=Gt[3],mt=r0(l.transform.getCameraToCenterDistance(Y.projection),St),Vt=o.b7(J,M,q),ot=Z?Vt/mt:Vt*mt,Wt=Hn(Zt,bt,It,m);if(Wt[3]<=0){no(it,f);continue}let ft={},At=Z?null:I,Et=Pc(q,ot,!1,R,a,m,p,d.glyphOffsetArray,Q,f,z,Wt,rt,ft,P,At,Y.projection,N,Z);K=Et.useVertical,At&&Et.needsFlipping&&(ft={}),(Et.notEnoughRoom||K||Et.needsFlipping&&Pc(q,ot,!0,R,a,m,p,d.glyphOffsetArray,Q,f,z,Wt,rt,ft,P,At,Y.projection,N,Z).notEnoughRoom)&&no(it,f)}c?(d.text.dynamicLayoutVertexBuffer.updateData(f),z&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(z)):(d.icon.dynamicLayoutVertexBuffer.updateData(f),z&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(z))}function Dc(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f){let{lineStartIndex:z,glyphStartIndex:Q,segment:E}=R,P=Q+R.numGlyphs,H=z+R.lineLength,K=a.getoffsetX(Q),w=a.getoffsetX(P-1),q=as(d*K,l,c,m,p,Z,E,z,H,I,N,Y,J,M,!0,T,v,f);if(!q)return null;let it=as(d*w,l,c,m,p,Z,E,z,H,I,N,Y,J,M,!0,T,v,f);return it?{first:q,last:it}:null}function _c(d,a,l,c){return d===o.b6.horizontal&&Math.abs(c)>Math.abs(l)?{useVertical:!0}:d===o.b6.vertical?c>0?{needsFlipping:!0}:null:a!==Tl.unknown&&function(m,p){return m===0||Math.abs(p/m)>ao}(l,c)?a===Tl.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function Pc(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q,E){let P=a/24,H=d.lineOffsetX*P,K=d.lineOffsetY*P,{lineStartIndex:w,glyphStartIndex:q,numGlyphs:it,segment:at,writingMode:rt,flipState:Zt}=d,bt=w+d.lineLength,It=Gt=>{if(Y){let[ot,Wt,ft]=Gt.up,At=N.length;o.b8(Y,At+0,ot,Wt,ft),o.b8(Y,At+1,ot,Wt,ft),o.b8(Y,At+2,ot,Wt,ft),o.b8(Y,At+3,ot,Wt,ft)}let[St,mt,Vt]=Gt.point;o.b9(N,St,mt,Vt,Gt.angle)};if(it>1){let Gt=Dc(P,R,H,K,l,J,M,d,I,p,T,f,!1,z,Q,E);if(!Gt)return{notEnoughRoom:!0};if(c&&!l){let[St,mt,Vt]=Gt.first.point,[ot,Wt,ft]=Gt.last.point;[St,mt]=Hn(St,mt,Vt,Z),[ot,Wt]=Hn(ot,Wt,ft,Z);let At=_c(rt,Zt,(ot-St)*v,Wt-mt);if(d.flipState=At&&At.needsFlipping?Tl.flipRequired:Tl.flipNotRequired,At)return At}It(Gt.first);for(let St=q+1;St<q+it-1;St++){let mt=as(P*R.getoffsetX(St),H,K,l,J,M,at,w,bt,I,p,T,f,!1,!1,z,Q,E);if(!mt)return N.length-=4*(St-q),{notEnoughRoom:!0};It(mt)}It(Gt.last)}else{if(c&&!l){let St=Hn(M.x,M.y,0,m),mt=w+at+1,Vt=new o.P(I.getx(mt),I.gety(mt)),ot=Hn(Vt.x,Vt.y,0,m),Wt=ot[3]>0?ot:Zd(M,Vt,St,1,m,void 0,z,Q.canonical),ft=_c(rt,Zt,(Wt[0]-St[0])*v,Wt[1]-St[1]);if(d.flipState=ft&&ft.needsFlipping?Tl.flipRequired:Tl.flipNotRequired,ft)return ft}let Gt=as(P*R.getoffsetX(q),H,K,l,J,M,at,w,bt,I,p,T,f,!1,!1,z,Q,E);if(!Gt)return{notEnoughRoom:!0};It(Gt)}return{}}function cr(d,a,l,c,m){let{x:p,y:Z,z:R}=c.projectTilePoint(d.x,d.y,a);if(!m)return Hn(p,Z,R,l);let[I,N,Y]=m(d);return Hn(p+I,Z+N,R+Y,l)}function Zd(d,a,l,c,m,p,Z,R){let I=cr(d.sub(a)._unit()._add(d),R,m,Z,p);return o.N.sub(I,l,I),o.N.normalize(I,I),o.N.scaleAndAdd(I,l,I,c)}function as(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q){let E=c?d-a:d+a,P=E>0?1:-1,H=0;c&&(P*=-1,H=Math.PI),P<0&&(H+=Math.PI);let K=R+Z+(P>0?0:1)|0,w=m,q=m,it=0,at=0,rt=Math.abs(E),Zt=[],bt=[],It=p,Gt=It,St=()=>Zd(Gt,It,q,rt-it+1,Y,M,f,z.canonical);for(;it+at<=rt;){if(K+=P,K<R||K>=I)return null;if(q=w,Gt=It,Zt.push(q),T&&bt.push(Gt),It=new o.P(N.getx(K),N.gety(K)),w=J[K],!w){let me=cr(It,z.canonical,Y,f,M);w=me[3]>0?J[K]=me:St()}it+=at,at=o.N.distance(q,w)}v&&M&&(J[K]&&(w=St(),at=o.N.distance(q,w)),J[K]=w);let mt=(rt-it)/at,Vt=It.sub(Gt)._mult(mt)._add(Gt),ot=o.N.sub([],w,q),Wt=o.N.scaleAndAdd([],q,ot,mt),ft=[0,0,1],At=ot[0],Et=ot[1];if(Q&&(ft=f.upVector(z.canonical,Vt.x,Vt.y),ft[0]!==0||ft[1]!==0||ft[2]!==1)){let me=[ft[2],0,-ft[0]],Ie=o.N.cross([],ft,me);o.N.normalize(me,me),o.N.normalize(Ie,Ie),At=o.N.dot(ot,me),Et=o.N.dot(ot,Ie)}if(l){let me=o.N.cross([],ft,ot);o.N.normalize(me,me),o.N.scaleAndAdd(Wt,Wt,me,l*P)}let $t=H+Math.atan2(Et,At);return Zt.push(Wt),T&&bt.push(Vt),{point:Wt,angle:$t,path:Zt,tilePath:bt,up:ft}}function no(d,a){let l=a.length,c=l+4*d;a.resize(c),a.float32.fill(-1/0,4*l,4*c)}function Kc(d,a,l){let c=a[0],m=a[1];return d[0]=l[0]*c+l[4]*m+l[12],d[1]=l[1]*c+l[5]*m+l[13],d[3]=l[3]*c+l[7]*m+l[15],d}let jn=100;class ie{constructor(a,l,c=new Ec(a.width+200,a.height+200,25),m=new Ec(a.width+200,a.height+200,25)){this.transform=a,this.grid=c,this.ignoredGrid=m,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+jn,this.screenBottomBoundary=a.height+jn,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=l}placeCollisionBox(a,l,c,m,p,Z,R,I){let N=c.projectedAnchorX,Y=c.projectedAnchorY,J=c.projectedAnchorZ,M=c.elevation,T=c.tileID,v=a.getProjection();if(M&&T){let[w,q,it]=v.upVector(T.canonical,c.tileAnchorX,c.tileAnchorY),at=v.upVectorScale(T.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=w*M*at,Y+=q*M*at,J+=it*M*at}let f=this.projectAndGetPerspectiveRatio(R,N,Y,J,c.tileID,v.name==="globe"||!!M||this.transform.pitch>0,v),z=Z*f.perspectiveRatio,Q=(c.x1*l+m.x-c.padding)*z+f.point.x,E=(c.y1*l+m.y-c.padding)*z+f.point.y,P=(c.x2*l+m.x+c.padding)*z+f.point.x,H=(c.y2*l+m.y+c.padding)*z+f.point.y,K=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(Q,E,P,H)||!p&&this.grid.hitTest(Q,E,P,H,I)||K?{box:[],offscreen:!1,occluded:f.occluded}:{box:[Q,E,P,H],offscreen:this.isOffscreen(Q,E,P,H),occluded:!1}}placeCollisionCircles(a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f){let z=[],Q=this.transform.elevation,E=a.getProjection(),P=Q?Q.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,E):null,H=new o.P(c.tileAnchorX,c.tileAnchorY),{x:K,y:w,z:q}=E.projectTilePoint(H.x,H.y,f.canonical);if(P){let[Vt,ot,Wt]=P(H);K+=Vt,w+=ot,q+=Wt}let it=E.name==="globe",at=this.projectAndGetPerspectiveRatio(R,K,w,q,f,it||!!Q||this.transform.pitch>0,E),{perspectiveRatio:rt}=at,Zt=(J?Z/rt:Z*rt)/o.bc,bt=Hn(K,w,q,I),It=at.signedDistanceFromCamera>0?Dc(Zt,p,c.lineOffsetX*Zt,c.lineOffsetY*Zt,!1,bt,H,c,m,I,{},Q&&!J?P:null,J&&!!Q,E,f,J):null,Gt=!1,St=!1,mt=!0;if(It&&!at.occluded){let Vt=.5*T*rt+v,ot=new o.P(-100,-100),Wt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ft=new dr,{first:At,last:Et}=It,$t=At.path.length,me=[];for(let Re=$t-1;Re>=1;Re--)me.push(At.path[Re]);for(let Re=1;Re<Et.path.length;Re++)me.push(Et.path[Re]);let Ie=2.5*Vt;N&&(me=me.map(([Re,Ae,Me],fe)=>(P&&!it&&(Me=P(fe<$t-1?At.tilePath[$t-1-fe]:Et.tilePath[fe-$t+2])[2]),Hn(Re,Ae,Me,N))),me.some(Re=>Re[3]<=0)&&(me=[]));let ue=[];if(me.length>0){let Re=1/0,Ae=-1/0,Me=1/0,fe=-1/0;for(let Qe of me)Re=Math.min(Re,Qe[0]),Me=Math.min(Me,Qe[1]),Ae=Math.max(Ae,Qe[0]),fe=Math.max(fe,Qe[1]);Ae>=ot.x&&Re<=Wt.x&&fe>=ot.y&&Me<=Wt.y&&(ue=[me.map(Qe=>new o.P(Qe[0],Qe[1]))],(Re<ot.x||Ae>Wt.x||Me<ot.y||fe>Wt.y)&&(ue=o.ba(ue,ot.x,ot.y,Wt.x,Wt.y)))}for(let Re of ue){ft.reset(Re,.25*Vt);let Ae=0;Ae=ft.length<=.5*Vt?1:Math.ceil(ft.paddedLength/Ie)+1;for(let Me=0;Me<Ae;Me++){let fe=Me/Math.max(Ae-1,1),Qe=ft.lerp(fe),si=Qe.x+jn,fi=Qe.y+jn;z.push(si,fi,Vt,0);let $e=si-Vt,ia=fi-Vt,ti=si+Vt,pi=fi+Vt;if(mt=mt&&this.isOffscreen($e,ia,ti,pi),St=St||this.isInsideGrid($e,ia,ti,pi),!l&&this.grid.hitTestCircle(si,fi,Vt,M)&&(Gt=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:Gt,occluded:!1}}}}return{circles:!Y&&Gt||!St?[]:z,offscreen:mt,collisionDetected:Gt,occluded:at.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],c=1/0,m=1/0,p=-1/0,Z=-1/0;for(let Y of a){let J=new o.P(Y.x+jn,Y.y+jn);c=Math.min(c,J.x),m=Math.min(m,J.y),p=Math.max(p,J.x),Z=Math.max(Z,J.y),l.push(J)}let R=this.grid.query(c,m,p,Z).concat(this.ignoredGrid.query(c,m,p,Z)),I={},N={};for(let Y of R){let J=Y.key;if(I[J.bucketInstanceId]===void 0&&(I[J.bucketInstanceId]={}),I[J.bucketInstanceId][J.featureIndex])continue;let M=[new o.P(Y.x1,Y.y1),new o.P(Y.x2,Y.y1),new o.P(Y.x2,Y.y2),new o.P(Y.x1,Y.y2)];o.bb(l,M)&&(I[J.bucketInstanceId][J.featureIndex]=!0,N[J.bucketInstanceId]===void 0&&(N[J.bucketInstanceId]=[]),N[J.bucketInstanceId].push(J.featureIndex))}return N}insertCollisionBox(a,l,c,m,p){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:p},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,l,c,m,p){let Z=l?this.ignoredGrid:this.grid,R={bucketInstanceId:c,featureIndex:m,collisionGroupID:p};for(let I=0;I<a.length;I+=4)Z.insertCircle(R,a[I],a[I+1],a[I+2])}projectAndGetPerspectiveRatio(a,l,c,m,p,Z,R){let I=[l,c,m,1],N=!1;m||this.transform.pitch>0?(o.a7.transformMat4(I,I,a),this.fogState&&p&&R.name!=="globe"&&(N=function(M,T,v,f,z,Q){let E=Q.calculateFogTileMatrix(z),P=[T,v,f];return o.N.transformMat4(P,P,E),Gi(M,o.N.length(P),Q.pitch,Q._fov)}(this.fogState,l,c,m,p.toUnwrapped(),this.transform)>.9)):Kc(I,I,a);let Y=I[3];return{point:new o.P((I[0]/Y+1)/2*this.transform.width+jn,(-I[1]/Y+1)/2*this.transform.height+jn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/Y*.5,1.5),signedDistanceFromCamera:Y,occluded:Z&&I[2]>Y||N}}isOffscreen(a,l,c,m){return c<jn||a>=this.screenRightBoundary||m<jn||l>this.screenBottomBoundary}isInsideGrid(a,l,c,m){return c>=0&&a<this.gridRightBoundary&&m>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let a=o.a6.identity([]);return o.a6.translate(a,a,[-100,-100,0]),a}}function gd(d,a,l){let c=a.createTileMatrix(d,d.worldSize,l.toUnwrapped());return o.a6.multiply(new Float32Array(16),d.projMatrix,c)}function qc(d,a,l){if(a.projection.name===l.projection.name)return d.projMatrix;let c=l.clone();return c.setProjection(a.projection),gd(c,a.getProjection(),d)}function ns(d,a,l){return a.name===l.projection.name?d.projMatrix:gd(l,a,d)}class $c{constructor(a,l,c,m){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?l:-l))):m&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class lo{constructor(a,l,c,m,p,Z=!1){this.text=new $c(a?a.text:null,l,c,p),this.icon=new $c(a?a.icon:null,l,m,p),this.clipped=Z}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nl{constructor(a,l,c,m=!1){this.text=a,this.icon=l,this.skipFade=c,this.clipped=m}}class tb{constructor(){this.invProjMatrix=o.a6.create(),this.viewportMatrix=o.a6.create(),this.circles=[]}}class yo{constructor(a,l,c,m,p){this.bucketInstanceId=a,this.featureIndex=l,this.sourceLayerIndex=c,this.bucketIndex=m,this.tileID=p}}class Vd{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){let l=++this.maxGroupID;this.collisionGroups[a]={ID:l,predicate:c=>c.collisionGroupID===l}}return this.collisionGroups[a]}}function Bo(d,a,l,c,m){let{horizontalAlign:p,verticalAlign:Z}=o.bf(d),R=-(p-.5)*a,I=-(Z-.5)*l,N=o.bd(d,c);return new o.P(R+N[0]*m,I+N[1]*m)}function eb(d,a,l,c,m){let p=new o.P(d,a);return l&&p._rotate(c?m:-m),p}class fp{constructor(a,l,c,m,p,Z){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new ie(this.transform,p),this.buildingIndex=Z,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Vd(c),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,l,c,m){let p=c.getBucket(l),Z=c.latestFeatureIndex;if(!p||!Z||l.fqid!==p.layerIds[0])return;let R=p.layers[0].layout,I=c.collisionBoxArray,N=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Y=c.tileSize/o.V,J=c.tileID.toUnwrapped();this.transform.setProjection(p.projection);let M=(T=c.tileID,v=p.getProjection(),f=this.transform,v.name===this.projection?f.calculateProjMatrix(T.toUnwrapped()):gd(f,v,T));var T,v,f;let z=R.get("text-pitch-alignment")==="map",Q=R.get("text-rotation-alignment")==="map";l.compileFilter();let E=l.dynamicFilter(),P=l.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(c),K=Ac(M,c.tileID.canonical,z,Q,this.transform,p.getProjection(),H),w=null;if(z){let at=Hc(M,c.tileID.canonical,z,Q,this.transform,p.getProjection(),H);w=o.a6.multiply([],this.transform.labelPlaneMatrix,at)}let q=null;E&&c.latestFeatureIndex&&(q={unwrappedTileID:J,dynamicFilter:E,dynamicFilterNeedsFeature:P,featureIndex:c.latestFeatureIndex}),this.retainedQueryData[p.bucketInstanceId]=new yo(p.bucketInstanceId,Z,p.sourceLayerIndex,p.index,c.tileID);let it={bucket:p,layout:R,posMatrix:M,textLabelPlaneMatrix:K,labelToScreenMatrix:w,clippingData:q,scale:N,textPixelRatio:Y,holdingForFade:c.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.b5(p.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.b5(p.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(m)for(let at of p.sortKeyRanges){let{sortKey:rt,symbolInstanceStart:Zt,symbolInstanceEnd:bt}=at;a.push({sortKey:rt,symbolInstanceStart:Zt,symbolInstanceEnd:bt,parameters:it})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:it})}attemptAnchorPlacement(a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q,E){let{textOffset0:P,textOffset1:H,crossTileID:K}=M,w=[P,H],q=Bo(a,c,m,w,p),it=this.collisionIndex.placeCollisionBox(v,p,l,eb(q.x,q.y,Z,R,this.transform.angle),J,I,N,Y.predicate);if(z){let at=v.getSymbolInstanceIconSize(E,this.transform.zoom,M.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(v,at,z,eb(q.x,q.y,Z,R,this.transform.angle),J,I,N,Y.predicate).box.length===0)return}if(it.box.length>0){let at;return this.prevPlacement&&this.prevPlacement.variableOffsets[K]&&this.prevPlacement.placements[K]&&this.prevPlacement.placements[K].text&&(at=this.prevPlacement.variableOffsets[K].anchor),this.variableOffsets[K]={textOffset:w,width:c,height:m,anchor:a,textScale:p,prevAnchor:at},this.markUsedJustification(v,a,M,f),v.allowVerticalPlacement&&(this.markUsedOrientation(v,f,M),this.placedOrientations[K]=f),{shift:q,placedGlyphBoxes:it}}}placeLayerBucketPart(a,l,c,m){let{bucket:p,layout:Z,posMatrix:R,textLabelPlaneMatrix:I,labelToScreenMatrix:N,clippingData:Y,textPixelRatio:J,holdingForFade:M,collisionBoxArray:T,partiallyEvaluatedTextSize:v,partiallyEvaluatedIconSize:f,collisionGroup:z}=a.parameters,Q=Z.get("text-optional"),E=Z.get("icon-optional"),P=Z.get("text-allow-overlap"),H=Z.get("icon-allow-overlap"),K=Z.get("text-rotation-alignment")==="map",w=Z.get("text-pitch-alignment")==="map",q=Z.get("symbol-z-order")==="viewport-y",it=Z.get("symbol-z-elevate");this.transform.setProjection(p.projection);let at=P&&(H||!p.hasIconData()||E),rt=H&&(P||!p.hasTextData()||Q);!p.collisionArrays&&T&&p.deserializeCollisionBoxes(T),c&&m&&p.updateCollisionDebugBuffers(this.transform.zoom,T);let Zt=(bt,It,Gt)=>{let{crossTileID:St,numVerticalGlyphVertices:mt}=bt;if(Y){let ti={zoom:this.transform.zoom,pitch:this.transform.pitch},pi=null;if(Y.dynamicFilterNeedsFeature){let ei=this.retainedQueryData[p.bucketInstanceId];pi=Y.featureIndex.loadFeature({featureIndex:bt.featureIndex,bucketIndex:ei.bucketIndex,sourceLayerIndex:ei.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Y.dynamicFilter)(ti,pi,this.retainedQueryData[p.bucketInstanceId].tileID.canonical,new o.P(bt.tileAnchorX,bt.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[St]=new nl(!1,!1,!1,!0),void l.add(St)}if(l.has(St))return;if(M)return void(this.placements[St]=new nl(!1,!1,!1));let Vt=!1,ot=!1,Wt=!0,ft=!1,At=!1,Et=null,$t={box:null,offscreen:null,occluded:null},me={box:null,offscreen:null,occluded:null},Ie=null,ue=null,Re=null,Ae=0,Me=0,fe=0;Gt.textFeatureIndex?Ae=Gt.textFeatureIndex:bt.useRuntimeCollisionCircles&&(Ae=bt.featureIndex),Gt.verticalTextFeatureIndex&&(Me=Gt.verticalTextFeatureIndex);let Qe=ti=>{ti.tileID=this.retainedQueryData[p.bucketInstanceId].tileID;let pi=this.transform.elevation;ti.elevation=bt.zOffset+(pi?pi.getAtTileOffset(ti.tileID,ti.tileAnchorX,ti.tileAnchorY):0)},si=Gt.textBox;if(si){Qe(si);let ti=ei=>{let mi=o.b6.horizontal;if(p.allowVerticalPlacement&&!ei&&this.prevPlacement){let Ei=this.prevPlacement.placedOrientations[St];Ei&&(this.placedOrientations[St]=Ei,mi=Ei,this.markUsedOrientation(p,mi,bt))}return mi},pi=(ei,mi)=>{if(p.allowVerticalPlacement&&mt>0&&Gt.verticalTextBox){for(let Ei of p.writingModes)if(Ei===o.b6.vertical?($t=mi(),me=$t):$t=ei(),$t&&$t.box&&$t.box.length)break}else $t=ei()};if(Z.get("text-variable-anchor")){let ei=Z.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[St]){let Ri=this.prevPlacement.variableOffsets[St];ei.indexOf(Ri.anchor)>0&&(ei=ei.filter(Sa=>Sa!==Ri.anchor),ei.unshift(Ri.anchor))}let mi=(Ri,Sa,Ka)=>{let Nn=p.getSymbolInstanceTextSize(v,bt,this.transform.zoom,It),Fl=(Ri.x2-Ri.x1)*Nn+2*Ri.padding,Yn=(Ri.y2-Ri.y1)*Nn+2*Ri.padding,fa=bt.hasIconTextFit&&!H?Sa:null;fa&&Qe(fa);let xa={box:[],offscreen:!1,occluded:!1},dn=P?2*ei.length:ei.length;for(let un=0;un<dn;++un){let Xn=this.attemptAnchorPlacement(ei[un%ei.length],Ri,Fl,Yn,Nn,K,w,J,R,z,un>=ei.length,bt,It,p,Ka,fa,v,f);if(Xn&&(xa=Xn.placedGlyphBoxes,xa&&xa.box&&xa.box.length)){Vt=!0,Et=Xn.shift;break}}return xa};pi(()=>mi(si,Gt.iconBox,o.b6.horizontal),()=>{let Ri=Gt.verticalTextBox;return Ri&&Qe(Ri),p.allowVerticalPlacement&&!($t&&$t.box&&$t.box.length)&&mt>0&&Ri?mi(Ri,Gt.verticalIconBox,o.b6.vertical):{box:null,offscreen:null,occluded:null}}),$t&&(Vt=$t.box,Wt=$t.offscreen,ft=$t.occluded);let Ei=ti(!(!$t||!$t.box));if(!Vt&&this.prevPlacement){let Ri=this.prevPlacement.variableOffsets[St];Ri&&(this.variableOffsets[St]=Ri,this.markUsedJustification(p,Ri.anchor,bt,Ei))}}else{let ei=(mi,Ei)=>{let Ri=p.getSymbolInstanceTextSize(v,bt,this.transform.zoom,It),Sa=this.collisionIndex.placeCollisionBox(p,Ri,mi,new o.P(0,0),P,J,R,z.predicate);return Sa&&Sa.box&&Sa.box.length&&(this.markUsedOrientation(p,Ei,bt),this.placedOrientations[St]=Ei),Sa};pi(()=>ei(si,o.b6.horizontal),()=>{let mi=Gt.verticalTextBox;return p.allowVerticalPlacement&&mt>0&&mi?(Qe(mi),ei(mi,o.b6.vertical)):{box:null,offscreen:null,occluded:null}}),ti(!!($t&&$t.box&&$t.box.length))}}if(Ie=$t,Vt=Ie&&Ie.box&&Ie.box.length>0,Wt=Ie&&Ie.offscreen,ft=Ie&&Ie.occluded,bt.useRuntimeCollisionCircles){let ti=p.text.placedSymbolArray.get(bt.centerJustifiedTextSymbolIndex>=0?bt.centerJustifiedTextSymbolIndex:bt.verticalPlacedTextSymbolIndex),pi=o.b7(p.textSizeData,v,ti),ei=Z.get("text-padding");ue=this.collisionIndex.placeCollisionCircles(p,P,ti,p.lineVertexArray,p.glyphOffsetArray,pi,R,I,N,c,w,z.predicate,bt.collisionCircleDiameter*pi/o.bc,ei,this.retainedQueryData[p.bucketInstanceId].tileID),Vt=P||ue.circles.length>0&&!ue.collisionDetected,Wt=Wt&&ue.offscreen,ft=ue.occluded}if(Gt.iconFeatureIndex&&(fe=Gt.iconFeatureIndex),Gt.iconBox){let ti=pi=>{Qe(pi);let ei=bt.hasIconTextFit&&Et?eb(Et.x,Et.y,K,w,this.transform.angle):new o.P(0,0),mi=p.getSymbolInstanceIconSize(f,this.transform.zoom,bt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(p,mi,pi,ei,H,J,R,z.predicate)};me&&me.box&&me.box.length&&Gt.verticalIconBox?(Re=ti(Gt.verticalIconBox),ot=Re.box.length>0):(Re=ti(Gt.iconBox),ot=Re.box.length>0),Wt=Wt&&Re.offscreen,At=Re.occluded}let fi=Q||bt.numHorizontalGlyphVertices===0&&mt===0,$e=E||bt.numIconVertices===0;if(fi||$e?$e?fi||(ot=ot&&Vt):Vt=ot&&Vt:ot=Vt=ot&&Vt,Vt&&Ie&&Ie.box&&this.collisionIndex.insertCollisionBox(Ie.box,Z.get("text-ignore-placement"),p.bucketInstanceId,me&&me.box&&Me?Me:Ae,z.ID),ot&&Re&&this.collisionIndex.insertCollisionBox(Re.box,Z.get("icon-ignore-placement"),p.bucketInstanceId,fe,z.ID),ue&&(Vt&&this.collisionIndex.insertCollisionCircles(ue.circles,Z.get("text-ignore-placement"),p.bucketInstanceId,Ae,z.ID),c)){let ti=p.bucketInstanceId,pi=this.collisionCircleArrays[ti];pi===void 0&&(pi=this.collisionCircleArrays[ti]=new tb);for(let ei=0;ei<ue.circles.length;ei+=4)pi.circles.push(ue.circles[ei+0]),pi.circles.push(ue.circles[ei+1]),pi.circles.push(ue.circles[ei+2]),pi.circles.push(ue.collisionDetected?1:0)}let ia=p.projection.name!=="globe";at=at&&(ia||!ft),rt=rt&&(ia||!At),this.placements[St]=new nl(Vt||at,ot||rt,Wt||p.justReloaded),l.add(St)};if(it&&this.buildingIndex&&(this.buildingIndex.updateZOffset(p,this.retainedQueryData[p.bucketInstanceId].tileID),p.updateZOffset()),q){let bt=p.getSortedSymbolIndexes(this.transform.angle);for(let It=bt.length-1;It>=0;--It){let Gt=bt[It];Zt(p.symbolInstances.get(Gt),Gt,p.collisionArrays[Gt])}p.hasAnyZOffset&&o.w("".concat(p.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(p.hasAnyZOffset){let bt=p.getSortedIndexesByZOffset();for(let It=0;It<bt.length;++It){let Gt=bt[It];Zt(p.symbolInstances.get(Gt),Gt,p.collisionArrays[Gt])}}else for(let bt=a.symbolInstanceStart;bt<a.symbolInstanceEnd;bt++)Zt(p.symbolInstances.get(bt),bt,p.collisionArrays[bt]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){let bt=this.collisionCircleArrays[p.bucketInstanceId];o.a6.invert(bt.invProjMatrix,R),bt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(a,l,c,m){let{leftJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:Z,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:I,crossTileID:N}=c,Y=o.be(l),J=m===o.b6.vertical?I:Y==="left"?p:Y==="center"?Z:Y==="right"?R:-1;p>=0&&(a.text.placedSymbolArray.get(p).crossTileID=J>=0&&p!==J?0:N),Z>=0&&(a.text.placedSymbolArray.get(Z).crossTileID=J>=0&&Z!==J?0:N),R>=0&&(a.text.placedSymbolArray.get(R).crossTileID=J>=0&&R!==J?0:N),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=J>=0&&I!==J?0:N)}markUsedOrientation(a,l,c){let m=l===o.b6.horizontal||l===o.b6.horizontalOnly?l:0,p=l===o.b6.vertical?l:0,{leftJustifiedTextSymbolIndex:Z,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:N}=c,Y=a.text.placedSymbolArray;Z>=0&&(Y.get(Z).placedOrientation=m),R>=0&&(Y.get(R).placedOrientation=m),I>=0&&(Y.get(I).placedOrientation=m),N>=0&&(Y.get(N).placedOrientation=p)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,c=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let m=l?l.symbolFadeChange(a):1,p=l?l.opacities:{},Z=l?l.variableOffsets:{},R=l?l.placedOrientations:{};for(let I in this.placements){let N=this.placements[I],Y=p[I];Y?(this.opacities[I]=new lo(Y,m,N.text,N.icon,null,N.clipped),c=c||N.text!==Y.text.placed||N.icon!==Y.icon.placed):(this.opacities[I]=new lo(null,m,N.text,N.icon,N.skipFade,N.clipped),c=c||N.text||N.icon)}for(let I in p){let N=p[I];if(!this.opacities[I]){let Y=new lo(N,m,!1,!1);Y.isHidden()||(this.opacities[I]=Y,c=c||N.text.placed||N.icon.placed)}}for(let I in Z)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=Z[I]);for(let I in R)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=R[I]);c?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:a)}updateLayerOpacities(a,l){let c=new Set;for(let m of l){let p=m.getBucket(a);p&&m.latestFeatureIndex&&a.fqid===p.layerIds[0]&&(this.updateBucketOpacities(p,c,m.collisionBoxArray),p.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(p,m.tileID),p.updateZOffset()))}}updateBucketOpacities(a,l,c){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();let m=a.layers[0].layout,p=!!a.layers[0].dynamicFilter(),Z=new lo(null,0,!1,!1,!0),R=m.get("text-allow-overlap"),I=m.get("icon-allow-overlap"),N=m.get("text-variable-anchor"),Y=m.get("text-rotation-alignment")==="map",J=m.get("text-pitch-alignment")==="map",M=new lo(null,0,R&&(I||!a.hasIconData()||m.get("icon-optional")),I&&(R||!a.hasTextData()||m.get("text-optional")),!0);!a.collisionArrays&&c&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(c);let T=(f,z,Q)=>{for(let E=0;E<z/4;E++)f.opacityVertexArray.emplaceBack(Q)},v=0;for(let f=0;f<a.symbolInstances.length;f++){let z=a.symbolInstances.get(f),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:E,crossTileID:P,numIconVertices:H}=z,K=l.has(P),w=this.opacities[P];K?w=Z:w||(w=M,this.opacities[P]=w),l.add(P);let q=Q>0||E>0,it=H>0,at=this.placedOrientations[P],rt=at===o.b6.vertical,Zt=at===o.b6.horizontal||at===o.b6.horizontalOnly;if(!q&&!it||w.isHidden()||v++,q){let bt=c0(w.text);T(a.text,Q,rt?ls:bt),T(a.text,E,Zt?ls:bt);let It=w.text.isHidden(),{leftJustifiedTextSymbolIndex:Gt,centerJustifiedTextSymbolIndex:St,rightJustifiedTextSymbolIndex:mt,verticalPlacedTextSymbolIndex:Vt}=z,ot=a.text.placedSymbolArray,Wt=It||rt?1:0;Gt>=0&&(ot.get(Gt).hidden=Wt),St>=0&&(ot.get(St).hidden=Wt),mt>=0&&(ot.get(mt).hidden=Wt),Vt>=0&&(ot.get(Vt).hidden=It||Zt?1:0);let ft=this.variableOffsets[P];ft&&this.markUsedJustification(a,ft.anchor,z,at);let At=this.placedOrientations[P];At&&(this.markUsedJustification(a,"left",z,At),this.markUsedOrientation(a,At,z))}if(it){let bt=c0(w.icon),{placedIconSymbolIndex:It,verticalPlacedIconSymbolIndex:Gt}=z,St=a.icon.placedSymbolArray,mt=w.icon.isHidden()?1:0;It>=0&&(T(a.icon,H,rt?ls:bt),St.get(It).hidden=mt),Gt>=0&&(T(a.icon,z.numVerticalIconVertices,Zt?ls:bt),St.get(Gt).hidden=mt)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){let bt=a.collisionArrays[f];if(bt){let It=new o.P(0,0),Gt=!0;if(bt.textBox||bt.verticalTextBox){if(N){let mt=this.variableOffsets[P];mt?(It=Bo(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textScale),Y&&It._rotate(J?this.transform.angle:-this.transform.angle)):Gt=!1}p&&(Gt=!w.clipped),bt.textBox&&br(a.textCollisionBox.collisionVertexArray,w.text.placed,!Gt||rt,It.x,It.y),bt.verticalTextBox&&br(a.textCollisionBox.collisionVertexArray,w.text.placed,!Gt||Zt,It.x,It.y)}let St=Gt&&!!(!Zt&&bt.verticalIconBox);bt.iconBox&&br(a.iconCollisionBox.collisionVertexArray,w.icon.placed,St,z.hasIconTextFit?It.x:0,z.hasIconTextFit?It.y:0),bt.verticalIconBox&&br(a.iconCollisionBox.collisionVertexArray,w.icon.placed,!St,z.hasIconTextFit?It.x:0,z.hasIconTextFit?It.y:0)}}}if(a.fullyClipped=v===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){let f=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=f.invProjMatrix,a.placementViewportMatrix=f.viewportMatrix,a.collisionCircleArray=f.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,l){let c=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*c>a}setStale(){this.stale=!0}}function br(d,a,l,c,m){d.emplaceBack(a?1:0,l?1:0,c||0,m||0),d.emplaceBack(a?1:0,l?1:0,c||0,m||0),d.emplaceBack(a?1:0,l?1:0,c||0,m||0),d.emplaceBack(a?1:0,l?1:0,c||0,m||0)}let vp=Math.pow(2,25),s0=Math.pow(2,24),d0=Math.pow(2,17),ib=Math.pow(2,16),Lp=Math.pow(2,9),zp=Math.pow(2,8),wp=Math.pow(2,1);function c0(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;let a=d.placed?1:0,l=Math.floor(127*d.opacity);return l*vp+a*s0+l*d0+a*ib+l*Lp+a*zp+l*wp+a}let ls=0;class Ep{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,l,c,m,p){let Z=this._bucketParts;for(;this._currentTileIndex<a.length;)if(l.getBucketParts(Z,m,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Z.sort((R,I)=>R.sortKey-I.sortKey));this._currentPartIndex<Z.length;){let R=Z[this._currentPartIndex];if(l.placeLayerBucketPart(R,this._seenCrossTileIDs,c,R.symbolInstanceStart===0),this._currentPartIndex++,p())return!0}return!1}}class Rd{constructor(a,l,c,m,p,Z,R,I,N){this.placement=new fp(a,p,Z,R,I,N),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(a,l,c,m){let p=o.f.now(),Z=()=>{let R=o.f.now()-p;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){let R=l[a[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=I)&&(!R.maxzoom||R.maxzoom>I)){let N=R,Y=N.layout.get("symbol-z-elevate"),J=this._inProgressLayer=this._inProgressLayer||new Ep(N),M=o.ag(R.source,R.scope);if(J.continuePlacement(Y?m[M]:c[M],this.placement,this._showCollisionBoxes,R,Z))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}let ab=512/o.V/2;class b0{constructor(a,l,c){this.tileID=a,this.bucketInstanceId=c,this.index=new o.bg(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let m=a.canonical.x*o.V,p=a.canonical.y*o.V;for(let Z=0;Z<l.length;Z++){let{key:R,crossTileID:I,tileAnchorX:N,tileAnchorY:Y}=l.get(Z),J=Math.floor((m+N)*ab),M=Math.floor((p+Y)*ab);this.index.add(J,M),this.keys.push(R),this.crossTileIDs.push(I)}this.index.finish()}findMatches(a,l,c){let m=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),p=ab/Math.pow(2,l.canonical.z-this.tileID.canonical.z),Z=l.canonical.x*o.V,R=l.canonical.y*o.V;for(let I=0;I<a.length;I++){let N=a.get(I);if(N.crossTileID)continue;let{key:Y,tileAnchorX:J,tileAnchorY:M}=N,T=Math.floor((Z+J)*p),v=Math.floor((R+M)*p),f=this.index.range(T-m,v-m,T+m,v+m);for(let z of f){let Q=this.crossTileIDs[z];if(this.keys[z]===Y&&!c.has(Q)){c.add(Q),N.crossTileID=Q;break}}}}}class nb{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){let l=Math.round((a-this.lng)/360);if(l!==0)for(let c in this.indexes){let m=this.indexes[c],p={};for(let Z in m){let R=m[Z];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+l),p[R.tileID.key]=R}this.indexes[c]=p}this.lng=a}addBucket(a,l,c){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let p=0;p<l.symbolInstances.length;p++)l.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);let m=this.usedCrossTileIDs[a.overscaledZ];for(let p in this.indexes){let Z=this.indexes[p];if(Number(p)>a.overscaledZ)for(let R in Z){let I=Z[R];I.tileID.isChildOf(a)&&I.findMatches(l.symbolInstances,a,m)}else{let R=Z[a.scaledTo(Number(p)).key];R&&R.findMatches(l.symbolInstances,a,m)}}for(let p=0;p<l.symbolInstances.length;p++){let Z=l.symbolInstances.get(p);Z.crossTileID||(Z.crossTileID=c.generate(),m.add(Z.crossTileID))}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new b0(a,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(a,l){for(let c of l.crossTileIDs)this.usedCrossTileIDs[a].delete(c)}removeStaleBuckets(a){let l=!1;for(let c in this.indexes){let m=this.indexes[c];for(let p in m)a[m[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,m[p]),delete m[p],l=!0)}return l}}class lb{constructor(){this.layerIndexes={},this.crossTileIDs=new nb,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,l,c,m){let p=this.layerIndexes[a.fqid];p===void 0&&(p=this.layerIndexes[a.fqid]=new Gd);let Z=!1,R={};m.name!=="globe"&&p.handleWrapJump(c);for(let I of l){let N=I.getBucket(a);N&&a.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(I.tileID,N,this.crossTileIDs)&&(Z=!0),R[N.bucketInstanceId]=!0)}return p.removeStaleBuckets(R)&&(Z=!0),Z}pruneUnusedLayers(a){let l={};a.forEach(c=>{l[c]=!0});for(let c in this.layerIndexes)l[c]||delete this.layerIndexes[c]}}class Mo{constructor(a=0,l=0,c=0,m=0){if(isNaN(a)||a<0||isNaN(l)||l<0||isNaN(c)||c<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=l,this.left=c,this.right=m}interpolate(a,l,c){return l.top!=null&&a.top!=null&&(this.top=o.U(a.top,l.top,c)),l.bottom!=null&&a.bottom!=null&&(this.bottom=o.U(a.bottom,l.bottom,c)),l.left!=null&&a.left!=null&&(this.left=o.U(a.left,l.left,c)),l.right!=null&&a.right!=null&&(this.right=o.U(a.right,l.right,c)),this}getCenter(a,l){let c=o.aa((this.left+a-this.right)/2,0,a),m=o.aa((this.top+l-this.bottom)/2,0,l);return new o.P(c,m)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Mo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Fd(d,a){let l=o.bk(d,3);o.a6.fromQuat(d,a),o.bm(d,3,l)}function os(d,a){let l=o.bi.identity([]);return o.bi.rotateZ(l,l,-a),o.bi.rotateX(l,l,-d),l}function ob(d,a){let l=[d[0],d[1],0],c=[a[0],a[1],0];if(o.N.length(l)>=1e-15){let Z=o.N.normalize([],l);o.N.scale(c,Z,o.N.dot(c,Z)),a[0]=c[0],a[1]=c[1]}let m=o.N.cross([],a,d);if(o.N.len(m)<1e-15)return null;let p=Math.atan2(-m[1],m[0]);return os(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),p)}class rs{constructor(a,l){this.position=a,this.orientation=l}get position(){return this._position}set position(a){if(a){let l=a instanceof o.L?a:new o.L(a[0],a[1],a[2]);this._renderWorldCopies&&(l.x=o.bh(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(a,l){if(this.orientation=null,!this.position)return;let c=this.position,m=this._elevation?this._elevation.getAtPointOrZero(o.L.fromLngLat(a)):0,p=o.L.fromLngLat(a,m),Z=[p.x-c.x,p.y-c.y,p.z-c.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ob(Z,l)}setPitchBearing(a,l){this.orientation=os(o.bj(a),o.bj(-l))}}class mr{constructor(a,l){this._transform=o.a6.identity([]),this.orientation=l,this.position=a}get mercatorPosition(){let a=this.position;return new o.L(a[0],a[1],a[2])}get position(){let a=o.bk(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var l;a&&o.bm(this._transform,3,[(l=a)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.bi.identity([]),a&&Fd(this._transform,this._orientation)}getPitchBearing(){let a=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,l){this._orientation=os(a,l),Fd(this._transform,this._orientation)}forward(){let a=o.bk(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){let a=o.bk(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){let a=o.bk(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,l){let c=new Float64Array(16);return o.a6.invert(c,this.getWorldToCamera(a,l)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(a,l,c){let m=this.position;o.N.scale(m,m,-a);let p=new Float64Array(16);return o.a6.fromScaling(p,[c,c,c]),o.a6.translate(p,p,m),p[10]*=l,p}getWorldToCamera(a,l){let c=new Float64Array(16),m=new Float64Array(4),p=this.position;return o.bi.conjugate(m,this._orientation),o.N.scale(p,p,-a),o.a6.fromQuat(c,m),o.a6.translate(c,c,p),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=l,c[9]*=l,c[10]*=l,c[11]*=l,c}getCameraToClipPerspective(a,l,c,m){let p=new Float64Array(16);return o.a6.perspective(p,a,l,c,m),p}getCameraToClipOrthographic(a,l,c,m,p,Z){let R=new Float64Array(16);return o.a6.ortho(R,a,l,c,m,p,Z),R}getDistanceToElevation(a,l=!1){let c=a===0?0:o.bl(a,l?o.au(this.position[1]):this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new mr([...this.position],[...this.orientation])}}let hr=(d,a,l)=>(1-l)*d+l*a,ss=d=>d*d*d*d*d;class ds{constructor(a,l,c,m,p,Z,R){this.tileSize=512,this._renderWorldCopies=p===void 0||p,this._minZoom=a||0,this._maxZoom=l||22,this._minPitch=c==null?0:c,this._maxPitch=m==null?60:m,this.setProjection(Z),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new o.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Mo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new mr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let a=new ds(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(a,l=!1){let c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(a||c)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.ac(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};let l=this.projection?this.getProjection():void 0;this.projection=o.bo(this.projectionOptions);let c=!_(l,this.getProjection());return c&&this._calcMatrices(),this.mercatorFromTransition=!1,c}setOrthographicProjectionAtLowPitch(a){return this._orthographicProjectionAtLowPitch!==a&&(this._orthographicProjectionAtLowPitch=a,this._calcMatrices(),!0)}setMercatorFromTransition(){let a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bo({name:"mercator"});let l=a!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){let a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bh(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){let l=-a*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.b4.create(),o.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){let l=o.aa(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=o.bj(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){let l=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(a){this._tileCoverLift!==a&&(this._tileCoverLift=a)}_updateCameraOnTerrain(){let a=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&a===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||a===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let c=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=a||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let a=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop(),m=0,p=0;for(let Z=0;Z<l.length;Z++){let R=new o.P(l[Z][0]*this.width,c+l[Z][1]*(this.height-c)),I=a.pointCoordinate(R);if(!I)continue;let N=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);m+=I[3]*N,p+=N}return p===0?NaN:m/p}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let a=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*l,m=this._mercatorZfromZoom(a),p=this._mercatorZfromZoom(this._maxZoom),Z=Math.max(m-c,p);this._setZoom(this._zoomFromMercatorZ(Z))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){let l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude())),c;c=a.z<this._camera.position[2]?[l.x,l.y,l.z]:[a.x,a.y,a.z];let m=o.N.length(o.N.sub([],this._camera.position,c));return o.aa(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let l=!1;if(a.orientation&&!o.bi.exactEquals(a.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(a.orientation)),a.position){let c=[a.position.x,a.position.y,a.position.z];o.N.exactEquals(c,this._camera.position)||(this._setCameraPosition(c),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let a=this._camera.position,l=new rs;return l.position=new o.L(a[0],a[1],a[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(a){if(!o.bi.length(a))return!1;o.bi.normalize(a,a);let l=o.N.transformQuat([],[0,0,-1],a),c=o.N.transformQuat([],[0,-1,0],a);if(c[2]<0)return!1;let m=ob(l,c);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(a){let l=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;a[2]=o.aa(a[2],m/c,m/l),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,l,c){this._unmodified=!1,this._edgeInsets.interpolate(a,l,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){let l=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(a){let l=[new o.bp(0,a)];if(this.renderWorldCopies){let c=this.pointCoordinate(new o.P(0,0)),m=this.pointCoordinate(new o.P(this.width,0)),p=this.pointCoordinate(new o.P(this.width,this.height)),Z=this.pointCoordinate(new o.P(0,this.height)),R=Math.floor(Math.min(c.x,m.x,p.x,Z.x)),I=Math.floor(Math.max(c.x,m.x,p.x,Z.x)),N=1;for(let Y=R-N;Y<=I+N;Y++)Y!==0&&l.push(new o.bp(Y,a))}return l}isLODDisabled(a){return(!a||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(a,l,c){let m=[];if(l[0]===0&&l[1]===0)return m;for(let Z of a){let R=Z.canonical,I=Z.overscaledZ,N=Z.wrap,Y=1<<R.z,J=R.x+1<Y,M=R.x>0,T=R.y+1<Y,v=R.y>0,f=Z.wrap-(M?0:1),z=Z.wrap+(J?0:1),Q=M?R.x-1:Y-1,E=J?R.x+1:0;l[0]<0?(m.push(new o.am(I,z,R.z,E,R.y)),l[1]<0&&T&&(m.push(new o.am(I,N,R.z,R.x,R.y+1)),m.push(new o.am(I,z,R.z,E,R.y+1))),l[1]>0&&v&&(m.push(new o.am(I,N,R.z,R.x,R.y-1)),m.push(new o.am(I,z,R.z,E,R.y-1)))):l[0]>0?(m.push(new o.am(I,f,R.z,Q,R.y)),l[1]<0&&T&&(m.push(new o.am(I,N,R.z,R.x,R.y+1)),m.push(new o.am(I,f,R.z,Q,R.y+1))),l[1]>0&&v&&(m.push(new o.am(I,N,R.z,R.x,R.y-1)),m.push(new o.am(I,f,R.z,Q,R.y-1)))):l[1]<0&&T?m.push(new o.am(I,N,R.z,R.x,R.y+1)):v&&m.push(new o.am(I,N,R.z,R.x,R.y-1))}if(m.length>1){m.sort((I,N)=>I.overscaledZ-N.overscaledZ||I.wrap-N.wrap||I.canonical.z-N.canonical.z||I.canonical.x-N.canonical.x||I.canonical.y-N.canonical.y);let Z=0,R=0;for(;R<m.length;)m[R].equals(m[Z])?++R:m[++Z]=m[R++];m.length=Z+1}let p=[];for(let Z of m)m.some(R=>Z.isChildOf(R))||p.push(Z);return m=p.filter(Z=>!a.some(R=>!!(Z.overscaledZ<c&&R.isChildOf(Z))||Z.equals(R)||Z.isChildOf(R))),m}coveringTiles(a){let l=this.coveringZoomLevel(a),c=l,m=this.elevation&&this.elevation.exaggeration(),p=m&&!a.isTerrainDEM,Z=this.projection.name==="mercator";if(a.minzoom!==void 0&&l<a.minzoom)return[];a.maxzoom!==void 0&&l>a.maxzoom&&(l=a.maxzoom);let R=this.locationCoordinate(this.center),I=this.center.lat,N=1<<l,Y=[N*R.x,N*R.y,0],J=this.projection.name==="globe",M=!J,T=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,M),v=J?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=N*o.bl(1,this.center.lat),z=this._camera.position[2]/o.bl(1,this.center.lat),Q=[N*v.x,N*v.y,z*(M?1:f)],E=J||m,P=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),H=this.isLODDisabled(!0)?l:0,K;if(this._elevation&&a.isTerrainDEM)K=1e4*this._elevation.exaggeration();else if(this._elevation){let ot=this._elevation.getMinMaxForVisibleTiles();K=ot?ot.max:this._centerAltitude}else K=this._centerAltitude;let w=a.isTerrainDEM?-K:this._elevation?this._elevation.getMinElevationBelowMSL():0,q=this.projection.isReprojectedInTileSpace?o.br(this):1,it=ot=>{let ft=new o.L(ot.x+25e-6,ot.y,ot.z),At=new o.L(ot.x,ot.y+25e-6,ot.z),Et=ot.toLngLat(),$t=ft.toLngLat(),me=At.toLngLat(),Ie=this.locationCoordinate(Et),ue=this.locationCoordinate($t),Re=this.locationCoordinate(me),Ae=Math.hypot(ue.x-Ie.x,ue.y-Ie.y),Me=Math.hypot(Re.x-Ie.x,Re.y-Ie.y);return Math.sqrt(Ae*Me)*q/25e-6},at=ot=>{let Wt=K,ft=w;return{aabb:o.bu(this,N,0,0,0,ot,ft,Wt,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:Wt,wrap:ot,fullyVisible:!1}},rt=[],Zt=[],bt=l,It=a.reparseOverscaled?c:l,Gt=ot=>ot*ot,St=Gt((z-this._centerAltitude)*f),mt=ot=>{if(!this._elevation||!ot.tileID||!Z)return;let Wt=this._elevation.getMinMaxForTile(ot.tileID),ft=ot.aabb;Wt?(ft.min[2]=Wt.min,ft.max[2]=Wt.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(ot.shouldSplit=Vt(ot),ot.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},Vt=ot=>{if(ot.zoom<H)return!0;if(ot.zoom===bt)return!1;if(ot.shouldSplit!=null)return ot.shouldSplit;let Wt=ot.aabb.distanceX(Q),ft=ot.aabb.distanceY(Q),At=St,Et=1;if(J){At=Gt(ot.aabb.distanceZ(Q));let Ie=Math.pow(2,ot.zoom),ue=o.au((ot.y+1)/Ie),Re=o.au(ot.y/Ie),Ae=Math.min(Math.max(I,ue),Re),Me=o.bJ(Ae)/o.bJ(I);if(Et=Ae===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Me/this._mercatorScaleRatio),this.zoom<=o.bG&&ot.zoom===bt-1&&Me>=.9)return!0}else if(p&&(At=Gt(ot.aabb.distanceZ(Q)*f)),this.projection.isReprojectedInTileSpace&&c<=5){let Ie=Math.pow(2,ot.zoom),ue=it(new o.L((ot.x+.5)/Ie,(ot.y+.5)/Ie));Et=ue>.85?1:ue}let $t=Wt*Wt+ft*ft+At,me=Gt((1<<bt-ot.zoom)*P*Et*((Ie,ue)=>{if(ue*Gt(.707)<Ie)return 1;let Re=Math.sqrt(ue/Ie);return Re/(1.4144271570014144+(Math.pow(1.1,Re-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(At,St),$t));return $t<me};if(this.renderWorldCopies)for(let ot=1;ot<=3;ot++)rt.push(at(-ot)),rt.push(at(ot));for(rt.push(at(0));rt.length>0;){let ot=rt.pop(),Wt=ot.x,ft=ot.y,At=ot.fullyVisible,Et=()=>this.projection.name==="globe"&&(ot.y===0||ot.y===(1<<ot.zoom)-1);if(!At){let $t=E?ot.aabb.intersects(T):ot.aabb.intersectsFlat(T);if($t===0&&Et()){let me=new o.bs(ot.zoom,Wt,ft);$t=o.bt(this,N,me,!0).intersects(T)}if($t===0)continue;At=$t===2}if(ot.zoom!==bt&&Vt(ot))for(let $t=0;$t<4;$t++){let me=(Wt<<1)+$t%2,Ie=(ft<<1)+($t>>1),ue={aabb:Z?ot.aabb.quadrant($t):o.bu(this,N,ot.zoom+1,me,Ie,ot.wrap,ot.minZ,ot.maxZ,this.projection),zoom:ot.zoom+1,x:me,y:Ie,wrap:ot.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:ot.minZ,maxZ:ot.maxZ};p&&!J&&(ue.tileID=new o.am(ot.zoom+1===bt?It:ot.zoom+1,ot.wrap,ot.zoom+1,me,Ie),mt(ue)),rt.push(ue)}else{let $t=ot.zoom===bt?It:ot.zoom;if(a.minzoom&&a.minzoom>$t)continue;if(!At){let Re=E?ot.aabb.intersectsPrecise(T):ot.aabb.intersectsPreciseFlat(T);if(Re===0&&Et()){let Ae=new o.bs(ot.zoom,Wt,ft);Re=o.bt(this,N,Ae,!0).intersectsPrecise(T)}if(Re===0)continue}let me=Y[0]-(.5+Wt+(ot.wrap<<ot.zoom))*(1<<l-ot.zoom),Ie=Y[1]-.5-ft,ue=ot.tileID?ot.tileID:new o.am($t,ot.wrap,ot.zoom,Wt,ft);Zt.push({tileID:ue,distanceSq:me*me+Ie*Ie})}}if(this.fogCullDistSq){let ot=this.fogCullDistSq,Wt=this.horizonLineFromTop();Zt=Zt.filter(ft=>{let At=[0,0,0,1],Et=[o.V,o.V,0,1],$t=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());o.a7.transformMat4(At,At,$t),o.a7.transformMat4(Et,Et,$t);let me=o.a7.min([],At,Et),Ie=o.a7.max([],At,Et),ue=o.bv(me,Ie);if(ue===0)return!0;let Re=!1,Ae=this._elevation;if(Ae&&ue>ot&&Wt!==0){let Me=this.calculateProjMatrix(ft.tileID.toUnwrapped()),fe;a.isTerrainDEM||(fe=Ae.getMinMaxForTile(ft.tileID)),fe||(fe={min:w,max:K});let Qe=o.bH(this.rotation),si=[Qe[0]*o.V,Qe[1]*o.V,fe.max];o.N.transformMat4(si,si,Me),Re=(1-si[1])*this.height*.5<Wt}return ue<ot||Re})}return Zt.sort((ot,Wt)=>ot.distanceSq-Wt.distanceSq).map(ot=>ot.tileID)}resize(a,l){this.width=a,this.height=l,this.pixelsToGLUnits=[2/a,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){let l=o.aa(a.lat,-o.bw,o.bw),c=this.projection.project(a.lng,l);return new o.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,l){let c,m,p=this.centerPoint;if(this.projection.name==="globe"){let R=this.worldSize;c=(l.x-p.x)/R,m=(l.y-p.y)/R}else{let R=this.pointCoordinate(l),I=this.pointCoordinate(p);c=R.x-I.x,m=R.y-I.y}let Z=this.locationCoordinate(a);this.setLocation(new o.L(Z.x-c,Z.y-m))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,l){let c=l?o.bl(l,a.lat):void 0,m=this.projection.project(a.lng,a.lat);return new o.L(m.x,m.y,c)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,l){let c=l!=null?l:this._centerAltitude,m=[a.x,a.y,0,1],p=[a.x,a.y,1,1];o.a7.transformMat4(m,m,this.pixelMatrixInverse),o.a7.transformMat4(p,p,this.pixelMatrixInverse);let Z=p[3];o.a7.scale(m,m,1/m[3]),o.a7.scale(p,p,1/Z);let R=m[2],I=p[2];return{p0:m,p1:p,t:R===I?0:(c-R)/(I-R)}}screenPointToMercatorRay(a){let l=[a.x,a.y,0,1],c=[a.x,a.y,1,1];return o.a7.transformMat4(l,l,this.pixelMatrixInverse),o.a7.transformMat4(c,c,this.pixelMatrixInverse),o.a7.scale(l,l,1/l[3]),o.a7.scale(c,c,1/c[3]),l[2]=o.bl(l[2],this._center.lat)*this.worldSize,c[2]=o.bl(c[2],this._center.lat)*this.worldSize,o.a7.scale(l,l,1/this.worldSize),o.a7.scale(c,c,1/this.worldSize),new o.a2([l[0],l[1],l[2]],o.N.normalize([],o.N.sub([],c,l)))}rayIntersectionCoordinate(a){let{p0:l,p1:c,t:m}=a,p=o.bl(l[2],this._center.lat),Z=o.bl(c[2],this._center.lat);return new o.L(o.U(l[0],c[0],m)/this.worldSize,o.U(l[1],c[1],m)/this.worldSize,o.U(p,Z,m))}pointCoordinate(a,l=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,l)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let l=this.projection.pointCoordinate3D(this,a.x,a.y);if(l)return new o.L(l[0],l[1],l[2]);let c=0,m=this.horizonLineFromTop();if(a.y>m)return this.pointCoordinate(a);let p=.02*m,Z=a.clone();for(let R=0;R<10&&m-c>p;R++){Z.y=o.U(c,m,.66);let I=this.projection.pointCoordinate3D(this,Z.x,Z.y);I?(m=Z.y,l=I):c=Z.y}return l?new o.L(l[0],l[1],l[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=o.bx)return!this.isPointAboveHorizon(a);let l=this.pointCoordinate(a);return l.y>=0&&l.y<=1}_coordinatePoint(a,l){let c=l&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,m=[a.x*this.worldSize,a.y*this.worldSize,c+a.toAltitude(),1];return o.a7.transformMat4(m,m,this.pixelMatrix),m[3]>0?new o.P(m[0]/m[3],m[1]/m[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:a,left:l}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,p=this.pointLocation3D(new o.P(l,a)),Z=this.pointLocation3D(new o.P(m,a)),R=this.pointLocation3D(new o.P(m,c)),I=this.pointLocation3D(new o.P(l,c)),N=Math.min(p.lng,Z.lng,R.lng,I.lng),Y=Math.max(p.lng,Z.lng,R.lng,I.lng),J=Math.min(p.lat,Z.lat,R.lat,I.lat),M=Math.max(p.lat,Z.lat,R.lat,I.lat),T=Math.pow(2,-this.zoom)/16*270,v=this.projection.name==="globe"?1:4,f=(z,Q,E,P,H)=>{let K=(z+E)/2,w=(Q+P)/2,q=new o.P(K,w),{lng:it,lat:at}=this.pointLocation3D(q),rt=Math.max(0,N-it,J-at,it-Y,at-M);N=Math.min(N,it),Y=Math.max(Y,it),J=Math.min(J,at),M=Math.max(M,at),(H<v||rt>T)&&(f(z,Q,K,w,H+1),f(K,w,E,P,H+1))};if(f(l,a,m,a,1),f(m,a,m,c,1),f(m,c,l,c,1),f(l,c,l,a,1),this.projection.name==="globe"){let[z,Q]=o.by(this);z?(M=90,Y=180,N=-180):Q&&(J=-90,Y=180,N=-180)}return new o.ad(new o.bn(N,J),new o.bn(Y,M))}_getBoundsRectangular(a,l){let{top:c,left:m}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,Z=this.width-this._edgeInsets.right,R=new o.P(m,c),I=new o.P(Z,c),N=new o.P(Z,p),Y=new o.P(m,p),J=this.pointCoordinate(R,a),M=this.pointCoordinate(I,a),T=this.pointCoordinate(N,l),v=this.pointCoordinate(Y,l),f=(z,Q)=>(Q.y-z.y)/(Q.x-z.x);return J.y>1&&M.y>=0?J=new o.L((1-v.y)/f(v,J)+v.x,1):J.y<0&&M.y<=1&&(J=new o.L(-v.y/f(v,J)+v.x,0)),M.y>1&&J.y>=0?M=new o.L((1-T.y)/f(T,M)+T.x,1):M.y<0&&J.y<=1&&(M=new o.L(-T.y/f(T,M)+T.x,0)),new o.ad().extend(this.coordinateLocation(J)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(v)).extend(this.coordinateLocation(T))}_getBoundsRectangularTerrain(){let a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);let l=a.visibleDemTiles.reduce((c,m)=>{if(m.dem){let p=m.dem.tree;c.min=Math.min(c.min,p.minimums[0]),c.max=Math.max(c.max,p.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*a.exaggeration(),l.max*a.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){let l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-l*(1-this._horizonShift);return a?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.bw,this.maxLat=o.bw,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.a5(this.minLng)*this.tileSize,this.worldMaxX=o.a5(this.maxLng)*this.tileSize,this.worldMinY=o.ae(this.maxLat)*this.tileSize,this.worldMaxY=o.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,l){return this.projection.createTileMatrix(this,l,a)}calculateDistanceTileData(a){let l=a.key,c=this._distanceTileDataCache;if(c[l])return c[l];let m=a.canonical,p=1/this.height,Z=this.cameraWorldSize,R=Z/this.zoomScale(m.z),I=(m.x+Math.pow(2,m.z)*a.wrap)*R,N=m.y*R,Y=this.point;Y.x*=Z/this.worldSize,Y.y*=Z/this.worldSize;let J=this.angle,M=Math.sin(-J),T=-Math.cos(-J);return c[l]={bearing:[M,T],center:[(Y.x-I)*p,(Y.y-N)*p],scale:R/o.V*p},c[l]}calculateFogTileMatrix(a){let l=a.key,c=this._fogTileMatrixCache;if(c[l])return c[l];let m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return o.a6.multiply(m,this.worldToFogMatrix,m),c[l]=new Float32Array(m),c[l]}calculateProjMatrix(a,l=!1,c=!1){let m=a.key,p;if(p=c?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,p[m])return p[m];let Z=this.calculatePosMatrix(a,this.worldSize),R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.a6.multiply(Z,R,Z),p[m]=new Float32Array(Z),p[m]}calculatePixelsToTileUnitsMatrix(a){let l=a.tileID.key,c=this._pixelsToTileUnitsCache;if(c[l])return c[l];let m=o.bz(a,this);return c[l]=m,c[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let a=1/this.worldSize,l=o.a6.fromScaling([],[a,a,a]);return o.a6.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let a=this._elevation;this._updateCameraState();let l=o.bl(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(l),m=this._camera.forward(),p=o.bl(1,this._center.lat);c[2]/=p,m[2]/=p,o.N.normalize(m,m);let Z=a.raycast(c,m,a.exaggeration());if(Z){let R=o.N.scaleAndAdd([],c,m,Z),I=new o.L(R[0],R[1],o.bl(R[2],o.au(R[1]))),N=(I.z+o.N.length([I.x-c[0],I.y-c[1],I.z-c[2]*p]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;let l=this._elevation,c=o.bl(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),p=l.getAtPointOrZero(new o.L(...m)),Z=this.pixelsPerMeter/this.worldSize*p,R=this._minimumHeightOverTerrain(),I=m[2]-Z;if(I<=R)if(I<0||a){let N=this.locationCoordinate(this._center,this._centerAltitude),Y=[m[0],m[1],N.z-m[2]],J=o.N.length(Y);Y[2]-=(R-I)/this._pixelsPerMercatorPixel;let M=o.N.length(Y);if(M===0)return;o.N.scale(Y,Y,J/M*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],N.z*this._pixelsPerMercatorPixel-Y[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){let M=this.center;return M.lat=o.aa(M.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&(M.lng=o.aa(M.lng,this.minLng,this.maxLng)),this.center=M,void(this._constraining=!1)}let l=this._unmodified,{x:c,y:m}=this.point,p=0,Z=c,R=m,I=this.width/2,N=this.height/2,Y=this.worldMinY*this.scale,J=this.worldMaxY*this.scale;if(m-N<Y&&(R=Y+N),m+N>J&&(R=J-N),J-Y<this.height&&(p=Math.max(p,this.height/(J-Y)),R=(J+Y)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let M=this.worldMinX*this.scale,T=this.worldMaxX*this.scale,v=this.worldSize/2-(M+T)/2;Z=(c+v+this.worldSize)%this.worldSize-v,Z-I<M&&(Z=M+I),Z+I>T&&(Z=T-I),T-M<this.width&&(p=Math.max(p,this.width/(T-M)),Z=(T+M)/2)}Z===c&&R===m||(this.center=this.unproject(new o.P(Z,R))),p&&(this.zoom+=this.scaleZoom(p)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let a=this.centerOffset,l=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bl(1,this.center.lat)/o.bl(1,o.bI));let m=o.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let p=this.projection.zAxisUnit==="meters"?c:1,Z=this._camera.getWorldToCamera(this.worldSize,p),R,I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-a.x/this.width,I[9]=2*a.y/this.height,this.isOrthographic){let at=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),rt=at*this.aspect,Zt=-rt,bt=-at;rt-=a.x,Zt-=a.x,at+=a.y,bt+=a.y,R=this._camera.getCameraToClipOrthographic(Zt,rt,bt,at,this._nearZ,this._farZ),((It,Gt,St,mt)=>{for(let Vt=0;Vt<16;Vt++)It[Vt]=hr(Gt[Vt],St[Vt],mt)})(R,R,I,ss(this.pitch>=15?1:this.pitch/15))}else R=I;let N=o.a6.mul([],I,Z),Y=o.a6.mul([],R,Z);if(this.projection.isReprojectedInTileSpace){let at=this.locationCoordinate(this.center),rt=o.a6.identity([]);o.a6.translate(rt,rt,[at.x*this.worldSize,at.y*this.worldSize,0]),o.a6.multiply(rt,rt,o.bB(this)),o.a6.translate(rt,rt,[-at.x*this.worldSize,-at.y*this.worldSize,0]),o.a6.multiply(Y,Y,rt),o.a6.multiply(N,N,rt),this.inverseAdjustmentMatrix=o.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.scale([],Y,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=Y,this.invProjMatrix=o.a6.invert(new Float64Array(16),this.projMatrix),l){let at=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);at[8]=2*-a.x/this.width,at[9]=2*a.y/this.height,this.expandedFarZProjMatrix=o.a6.mul([],at,Z)}else this.expandedFarZProjMatrix=this.projMatrix;let J=o.a6.invert([],R);this.frustumCorners=o.bD.fromInvProjectionMatrix(J,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);let M=new Float32Array(16);o.a6.identity(M),o.a6.scale(M,M,[1,-1,1]),o.a6.rotateX(M,M,this._pitch),o.a6.rotateZ(M,M,this.angle);let T=o.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.clone(T);let v=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;T[8]=2*-a.x/this.width,T[9]=2*(a.y+v)/this.height,this.skyboxMatrix=o.a6.multiply(M,T,M);let f=this.point,z=f.x,Q=f.y,E=this.width%2/2,P=this.height%2/2,H=Math.cos(this.angle),K=Math.sin(this.angle),w=z-Math.round(z)+H*E+K*P,q=Q-Math.round(Q)+H*P+K*E,it=new Float64Array(Y);if(o.a6.translate(it,it,[w>.5?w-1:w,q>.5?q-1:q,0]),this.alignedProjMatrix=it,Y=o.a6.create(),o.a6.scale(Y,Y,[this.width/2,-this.height/2,1]),o.a6.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=o.a6.create(),o.a6.scale(Y,Y,[1,-1,1]),o.a6.translate(Y,Y,[-1,-1,0]),o.a6.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=o.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},Y=o.a6.invert(new Float64Array(16),this.pixelMatrix),!Y)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Y,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.bE(this);let at=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.N.transformMat4(at,at,Z),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Y;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let a=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,c=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,p=[a,a,l];o.N.scale(p,p,m),o.N.scale(c,c,-1),o.N.multiply(c,c,p);let Z=o.a6.create();o.a6.translate(Z,Z,c),o.a6.scale(Z,Z,p),this.mercatorFogMatrix=Z,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,l,m)}_computeCameraPosition(a){let l=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),m=this.point,p=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-a/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-c[0]*p,m.y/this.worldSize-c[1]*p,a/this.worldSize*this._centerAltitude-c[2]*p]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){let l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],m=a[2],p=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(p=Math.min((l-c)/m,1)),this._camera.position=o.N.scaleAndAdd([],this._camera.position,a,p),this._updateStateFromCamera()}_updateStateFromCamera(){let a=this._camera.position,l=this._camera.forward(),{pitch:c,bearing:m}=this._camera.getPitchBearing(),p=o.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,Z=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bj(this._maxPitch)),R=Math.max((a[2]-p)/Math.cos(c),Z),I=this._zoomFromMercatorZ(R);o.N.scaleAndAdd(a,a,l,R),this._pitch=o.aa(c,o.bj(this.minPitch),o.bj(this.maxPitch)),this.angle=o.bh(m,-Math.PI,Math.PI),this._setZoom(o.aa(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.L(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){let a=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let l=0,c=o.bx,m=0,p=1/0;for(;c-l>1e-6&&c>l;){let Z=l+.5*(c-l),R=this.tileSize*Math.pow(2,Z),I=this.getCameraToCenterDistance(this.projection,Z,R),N=this.scaleZoom(I/(a*this.tileSize)),Y=Math.abs(Z-N);Y<p&&(p=Y,m=Z),Z<N?l=Z:c=Z}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,l){let c=Math.min(a.x,l.x),m=Math.max(a.x,l.x),p=Math.min(a.y,l.y),Z=Math.max(a.y,l.y);if(p<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let R=[new o.P(c,p),new o.P(m,Z),new o.P(c,Z),new o.P(m,p)],I=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(let Y of R){let J=this.pointRayIntersection(Y);if(J.t<0)return!0;let M=this.rayIntersectionCoordinate(J);if(M.x<I||M.y<0||M.x>N||M.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(a,l){let c=o.N.length(o.N.sub([],this._camera.position,a)),m=this._zoomFromMercatorZ(c)+l;return c-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){let a=function([l,c,m],p){let Z=[l,c,m,1];o.a7.transformMat4(Z,Z,p);let R=Z[3]=Math.max(Z[3],1e-6);return Z[0]/=R,Z[1]/=R,Z[2]/=R,Z}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(a[0],a[1])}{let a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,a))}}getCameraToCenterDistance(a,l=this.zoom,c=this.worldSize){let m=o.bA(a,l,this.width,this.height,1024),p=a.pixelSpaceConversion(this.center.lat,c,m),Z=.5/Math.tan(.5*this._fov)*this.height*p;return this.isOrthographic&&(Z=hr(1,Z,ss(this.pitch>=15?1:this.pitch/15))),Z}getWorldToCameraMatrix(){let a=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.multiply(a,a,this.globeMatrix),a}getFrustum(a){return o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.zAxisUnit==="meters")}}let Pa={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},oo=(d,a)=>{if(a>0&&d.terrain&&o.w("Cutoff is currently disabled on terrain"),a<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let l=d.transform,c=Math.max(Math.abs(l._zoom-(d.minCutoffZoom-1)),1),m=l.isLODDisabled(!1)?o.O(60,45,l.pitch):o.O(30,15,l.pitch),p=l._farZ-l._nearZ,Z=a*l.height,R=((1-(I=m))*l.cameraToCenterDistance+I*(l._farZ+Z))*c;var I;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(R-l._nearZ)/p,(R-Z-l._nearZ)/p]}}},pn={cascadeCount:2,shadowMapResolution:2048};class rb{constructor(a,l){this.aabb=a,this.lastCascade=l}}class m0{add(a,l){let c=this.receivers[a.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],l.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],l.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],l.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],l.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],l.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],l.max[2])):this.receivers[a.key]=new rb(l,null)}clear(){this.receivers={}}get(a){return this.receivers[a.key]}computeRequiredCascades(a,l,c){let m=o.bS.fromPoints(a.points),p=0;for(let Z in this.receivers){let R=this.receivers[Z];if(!R||!m.intersectsAabb(R.aabb))continue;R.aabb.min=m.closestPoint(R.aabb.min),R.aabb.max=m.closestPoint(R.aabb.max);let I=R.aabb.getCorners();for(let N=0;N<c.length;N++){let Y=!0;for(let J of I){let M=[J[0]*l,J[1]*l,J[2]];if(o.N.transformMat4(M,M,c[N].matrix),M[0]<-1||M[0]>1||M[1]<-1||M[1]>1){Y=!1;break}}if(R.lastCascade=N,p=Math.max(p,N),Y)break}}return p+1}}class sb{constructor(a){this.painter=a,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new m0,this._depthMode=new Ne(a.context.gl.LEQUAL,Ne.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,a.tp.registerParameter(pn,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),a.tp.registerParameter(pn,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(let a of this._cascades)a.texture.destroy(),a.framebuffer.destroy();this._cascades=[]}updateShadowParameters(a,l){let c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;let m=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||m<=0||(this._shadowLayerCount=c.style.order.reduce((v,f)=>{let z=c.style._mergedLayers[f];return v+(z.hasShadowPass()&&!z.isHidden(a.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let p=c.context,Z=pn.shadowMapResolution,R=pn.shadowMapResolution;if(this._cascades.length===0||pn.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let v=0;v<pn.cascadeCount;++v){let f=c._shadowMapDebug,z=p.gl,Q=p.createFramebuffer(Z,R,f,"texture"),E=new o.T(p,{width:Z,height:R,data:null},z.DEPTH_COMPONENT);if(Q.depthAttachment.set(E.texture),f){let P=new o.T(p,{width:Z,height:R,data:null},z.RGBA);Q.colorAttachment.set(P.texture)}this._cascades.push({framebuffer:Q,texture:E,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bq,scale:0})}}this.shadowDirection=Id(l);let I=0;if(a.elevation){let v=a.elevation,f=[1e4,-1e4];v.visibleDemTiles.filter(z=>z.dem).forEach(z=>{let Q=z.dem.tree;f[0]=Math.min(f[0],Q.minimums[0]),f[1]=Math.max(f[1],Q.maximums[0])}),f[0]!==1e4&&(I=(f[1]-f[0])*v.exaggeration())}let N=1.5*a.cameraToCenterDistance,Y=3*N,J=new Float64Array(16);for(let v=0;v<this._cascades.length;++v){let f=this._cascades[v],z=a.height/50,Q=1;pn.cascadeCount===1?Q=Y:v===0?Q=N:(z=N,Q=Y);let[E,P]=h0(a,this.shadowDirection,z,Q,pn.shadowMapResolution,I);f.scale=a.scale,f.matrix=E,f.boundingSphereRadius=P,o.a6.invert(J,f.matrix),f.frustum=o.bq.fromInvProjectionMatrix(J,1,0,!0),f.far=Q}let M=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[M].far,this._cascades[M].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/pn.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=pn.shadowMapResolution,this._uniformValues.u_shadowmap_0=Pa.ShadowMap0,this._uniformValues.u_shadowmap_1=Pa.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let T=c.transform.elevation;for(let v of this._groundShadowTiles){let f={min:0,max:0};if(T){let z=T.getMinMaxForTile(v);z&&(f=z)}this.addShadowReceiver(v.toUnwrapped(),f.min,f.max)}}get enabled(){return this._enabled}set enabled(a){this._enabled=a}drawShadowPass(a,l){if(!this._enabled)return;let c=this.painter,m=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),m.viewport.set([0,0,pn.shadowMapResolution,pn.shadowMapResolution]);for(let p=0;p<this._numCascadesToRender;++p){c.currentShadowCascade=p,m.bindFramebuffer.set(this._cascades[p].framebuffer.framebuffer),m.clear({color:o.ax.white,depth:1});for(let Z of a.order){let R=a._mergedLayers[Z];if(!R.hasShadowPass()||R.isHidden(c.transform.zoom))continue;let I=a.getLayerSourceCache(R),N=I?l[I.id]:void 0;(R.type==="model"||N&&N.length)&&c.renderLayer(c,I,R,N)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let a=this.painter,l=a.style,c=a.context,m=l.directionalLight,p=l.ambientLight;if(!m||!p)return;let Z=[],R=oo(a,a.longestCutoffRange);R.shouldRenderCutoff&&Z.push("RENDER_CUTOFF");let I=cs(m,p),N=new Ne(c.gl.LEQUAL,Ne.ReadOnly,a.depthRangeFor3D);for(let Y of this._groundShadowTiles){let J=Y.toUnwrapped(),M=a.isTileAffectedByFog(Y),T=a.getOrCreateProgram("groundShadow",{defines:Z,overrideFog:M});this.setupShadows(J,T),a.uploadCommonUniforms(c,T,J,null,R);let v={u_matrix:a.transform.calculateProjMatrix(J),u_ground_shadow_factor:I};T.draw(a,c.gl.TRIANGLES,N,Ce.disabled,Pe.multiply,Ye.disabled,v,"ground_shadow",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments,{},a.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Pe.unblended:Pe.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(a){let l=this.painter.transform,c=l.calculatePosMatrix(a,l.worldSize);return o.a6.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(a){return o.a6.multiply(a,this._cascades[this.painter.currentShadowCascade].matrix,a),Float32Array.from(a)}setupShadows(a,l,c,m=0){if(!this._enabled)return;let p=this.painter.transform,Z=this.painter.context,R=Z.gl,I=this._uniformValues,N=new Float64Array(16),Y=p.calculatePosMatrix(a,p.worldSize);for(let J=0;J<this._cascades.length;J++)o.a6.multiply(N,this._cascades[J].matrix,Y),I[J===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),Z.activeTexture.set(R.TEXTURE0+Pa.ShadowMap0+J),this._cascades[J].texture.bind(R.NEAREST,R.CLAMP_TO_EDGE);if(this.useNormalOffset=!!c,this.useNormalOffset){let J=o.bR(a.canonical),M=2/p.tileSize*o.V/pn.shadowMapResolution,T=M*this._cascades[0].boundingSphereRadius,v=M*this._cascades[this._cascades.length-1].boundingSphereRadius,f=(c==="vector-tile"?1:3)/Math.pow(2,m-a.canonical.z-(1-p.zoom+Math.floor(p.zoom)));I.u_shadow_normal_offset=[J,T*f,v*f],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(Z,I)}setupShadowsFromMatrix(a,l,c=!1){if(!this._enabled)return;let m=this.painter.context,p=m.gl,Z=this._uniformValues,R=new Float64Array(16);for(let I=0;I<pn.cascadeCount;I++)o.a6.multiply(R,this._cascades[I].matrix,a),Z[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),m.activeTexture.set(p.TEXTURE0+Pa.ShadowMap0+I),this._cascades[I].texture.bind(p.NEAREST,p.CLAMP_TO_EDGE);this.useNormalOffset=c,c?(Z.u_shadow_normal_offset=[1,5,5],Z.u_shadow_bias=[6e-5,.0012,.012]):Z.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(m,Z)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(a,l,c,m){if(m[2]>=0)return{};let p=function(I,N,Y){let J=Y/(1<<I.canonical.z);return new o.bS([I.canonical.x*J+I.wrap*Y,I.canonical.y*J+I.wrap*Y,0],[(I.canonical.x+1)*J+I.wrap*Y,(I.canonical.y+1)*J+I.wrap*Y,N])}(a,l,c).getCorners(),Z=l/-m[2];m[0]<0?(o.N.add(p[0],p[0],[m[0]*Z,0,0]),o.N.add(p[3],p[3],[m[0]*Z,0,0])):m[0]>0&&(o.N.add(p[1],p[1],[m[0]*Z,0,0]),o.N.add(p[2],p[2],[m[0]*Z,0,0])),m[1]<0?(o.N.add(p[0],p[0],[0,m[1]*Z,0]),o.N.add(p[1],p[1],[0,m[1]*Z,0])):m[1]>0&&(o.N.add(p[2],p[2],[0,m[1]*Z,0]),o.N.add(p[3],p[3],[0,m[1]*Z,0]));let R={};return R.vertices=p,R.planes=[Co(p[1],p[0],p[4]),Co(p[2],p[1],p[5]),Co(p[3],p[2],p[6]),Co(p[0],p[3],p[7])],R}addShadowReceiver(a,l,c){this._receivers.add(a,o.bS.fromTileIdAndHeight(a,l,c))}getMaxCascadeForTile(a){let l=this._receivers.get(a);return l&&l.lastCascade?l.lastCascade:0}}function Co(d,a,l){let c=o.N.sub([],l,a),m=o.N.sub([],d,a),p=o.N.cross([],c,m),Z=o.N.length(p);return Z===0?[0,0,1,0]:(o.N.scale(p,p,1/Z),[p[0],p[1],p[2],-o.N.dot(p,a)])}function Id(d){let a=d.properties.get("direction"),l=o.bQ(a.x,a.y,a.z);l[2]=o.aa(l[2],0,75);let c=o.bT([l[0],l[1],l[2]]);return o.N.fromValues(c.x,c.y,c.z)}function cs(d,a){let l=d.properties.get("color"),c=d.properties.get("intensity"),m=d.properties.get("direction"),p=[m.x,m.y,m.z],Z=a.properties.get("color"),R=a.properties.get("intensity"),I=Math.max(o.N.dot([0,0,1],p),0),N=[0,0,0];o.N.scale(N,Z.toArray01Linear().slice(0,3),R);let Y=[0,0,0];return o.N.scale(Y,l.toArray01Linear().slice(0,3),I*c),o.bU([N[0]>0?N[0]/(N[0]+Y[0]):0,N[1]>0?N[1]/(N[1]+Y[1]):0,N[2]>0?N[2]/(N[2]+Y[2]):0])}function h0(d,a,l,c,m,p){let Z=d.zoom,R=d.scale,I=d.worldSize,N=1/I,Y=d.aspect,J=Math.sqrt(1+Y*Y)*Math.tan(.5*d.fovX),M=J*J,T=c-l,v=c+l,f,z;M>T/v?(f=c,z=c*J):(f=.5*v*(1+M),z=.5*Math.sqrt(T*T+2*(c*c+l*l)*M+v*v*M*M));let Q=d.projection.pixelsPerMeter(d.center.lat,I),E=d._camera.getCameraToWorldMercator(),P=[0,0,-f*N];o.N.transformMat4(P,P,E);let H=z*N,K=d._edgeInsets;if(!(K.left===0&&K.top===0&&K.right===0&&K.bottom===0||K.left===K.right&&K.top===K.bottom)){let At=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Q:1),Et=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,l,c);Et[8]=2*-d.centerOffset.x/d.width,Et[9]=2*d.centerOffset.y/d.height;let $t=new Float64Array(16);o.a6.mul($t,Et,At);let me=new Float64Array(16);o.a6.invert(me,$t);let Ie=o.bq.fromInvProjectionMatrix(me,I,Z,!0);for(let ue of Ie.points){let Re=((w=ue)[0]/=R,w[1]/=R,w[2]=o.bl(w[2],d._center.lat),w);H=Math.max(H,o.N.len(o.N.subtract([],P,Re)))}}var w;H*=m/(m-1);let q=Math.acos(a[2]),it=Math.atan2(-a[0],-a[1]),at=new mr;at.position=P,at.setPitchBearing(q,it);let rt=at.getWorldToCamera(I,Q),Zt=H*I,bt=Math.min(d._mercatorZfromZoom(17)*I*-2,-2*Zt),It=at.getCameraToClipOrthographic(-Zt,Zt,-Zt,Zt,bt,(Zt+p*Q)/a[2]),Gt=new Float64Array(16);o.a6.multiply(Gt,It,rt);let St=o.N.fromValues(Math.floor(1e6*P[0])/1e6*I,Math.floor(1e6*P[1])/1e6*I,0),mt=.5*m,Vt=[0,0,0];o.N.transformMat4(Vt,St,Gt),o.N.scale(Vt,Vt,mt);let ot=[Math.floor(Vt[0]),Math.floor(Vt[1]),Math.floor(Vt[2])],Wt=[0,0,0];o.N.sub(Wt,Vt,ot),o.N.scale(Wt,Wt,-1/mt);let ft=new Float64Array(16);return o.a6.identity(ft),o.a6.translate(ft,ft,Wt),o.a6.multiply(Gt,ft,Gt),[Gt,Zt]}let ro=(d,a)=>We(d,a&&a.filter(l=>l.identifier!=="source.canvas")),p0=o.ac(ri,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),pr=o.ac(ri,["setCenter","setZoom","setBearing","setPitch"]),db={version:8,layers:[],sources:{}},W0={duration:300,delay:0},Ap=new Set(["fill","line","background","hillshade","raster"]);class ll extends o.E{constructor(a,l={}){super(),this.map=a,this.scope=l.scope||"",this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=o.e({},W0),this._buildingIndex=new l0(this),this.crossTileSymbolIndex=new lb,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new Yi,this.dispatcher=l.dispatcher?l.dispatcher:new o.bW(o.bX(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Ya,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.bY(a._requestManager,l.localFontFamily?o.bZ.all:l.localIdeographFontFamily?o.bZ.ideographs:o.bZ.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Pi(a._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this.dispatcher.broadcast("setReferrer",o.b_());let c=this;this._rtlTextPluginCallback=ll.registerForPluginStateChange(m=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(p,Z)=>{if(o.b$(p),Z&&Z.every(R=>R))for(let R in c._sourceCaches){let I=c._sourceCaches[R],N=I.getSource().type;N!=="vector"&&N!=="geojson"||I.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;let p=this.getOwnSource(m.sourceId);if(p&&p.vectorLayerIds)for(let Z in this._layers){let R=this._layers[Z];R.source===p.id&&this._validateLayer(R)}})}loadURL(a,l={}){this.fire(new o.b("dataloading",{dataType:"style"}));let c=typeof l.validate=="boolean"?l.validate:!o.c0(a);a=this.map._requestManager.normalizeStyleURL(a,l.accessToken),this.resolvedImports.add(a);let m=this.importsCache.get(a);if(m)return this._load(m,c);let p=this.map._requestManager.transformRequest(a,o.R.Style);this._request=o.g(p,(Z,R)=>{if(this._request=null,Z)this.fire(new o.a(Z));else if(R)return this.importsCache.set(a,R),this._load(R,c)})}loadJSON(a,l={}){this.fire(new o.b("dataloading",{dataType:"style"})),this._request=o.f.frame(()=>{this._request=null,this._load(a,l.validate!==!1)})}loadEmpty(){this.fire(new o.b("dataloading",{dataType:"style"})),this._load(db,!1)}_loadImports(a,l,c){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let m=[];for(let p of a){let Z=this._createFragmentStyle(p),R=new Promise(Y=>{Z.once("style.import.load",Y),Z.once("error",Y)}).then(()=>this.mergeAll());if(m.push(R),this.resolvedImports.has(p.url)){Z.loadEmpty();continue}let I=p.data||this.importsCache.get(p.url);I?Z.loadJSON(I,{validate:l}):p.url?Z.loadURL(p.url,{validate:l}):Z.loadEmpty();let N={style:Z,id:p.id,config:p.config};if(c){let Y=this.fragments.findIndex(({id:J})=>J===c);this.fragments=this.fragments.slice(0,Y).concat(N).concat(this.fragments.slice(Y))}else this.fragments.push(N)}return Promise.allSettled(m)}_createFragmentStyle(a){let l=this.scope?o.ag(a.id,this.scope):a.id,c=new ll(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:a.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return c.setEventedParent(this.map,{style:c}),c}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let a=this.isRootStyle();this._shouldPrecompile=a,this.fire(new o.b(a?"style.load":"style.import.load"))}_load(a,l){let c=a.schema;if(this.isRootStyle()&&(a.fragment||c&&a.fragment!==!1)){let Z=o.e({},db,{imports:[{id:"basemap",data:a,url:""}]});return void this._load(Z,l)}if(this.setConfig(this._config,c),l&&ro(this,Ta(a)))return;this._loaded=!0,this.stylesheet=o.c1(a);for(let Z in a.sources)this.addSource(Z,a.sources[Z],{validate:!1,isInitialLoad:!0});a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(a.glyphs,this.scope);let m=o0(this.stylesheet.layers);if(this._order=m.map(Z=>Z.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let Z=this.stylesheet.lights[0];this.light=new ge(Z.properties,Z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ge(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let Z of m){let R=o.c2(Z,this.scope,this.options);R.isConfigDependent&&this._configDependentLayers.add(R.fqid),R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R,this._serializedLayers[R.id]=R.serialize();let I=this.getOwnLayerSourceCache(R),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&R.canCastShadows()&&N&&(I.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let p=this.stylesheet.terrain;p&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(p,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.b("data",{dataType:"style"})),a.imports?this._loadImports(a.imports,l).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let a,l,c,m,p,Z,R,I;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(N=>{if(N.stylesheet){if(N.light!=null&&(a=N.light),N.stylesheet.lights)for(let Y of N.stylesheet.lights)Y.type==="ambient"&&N.ambientLight!=null&&(l=N.ambientLight),Y.type==="directional"&&N.directionalLight!=null&&(c=N.directionalLight);m=this._prioritizeTerrain(m,N.terrain,N.stylesheet.terrain),N.stylesheet.fog&&N.fog!=null&&(p=N.fog),N.stylesheet.camera!=null&&(I=N.stylesheet.camera),N.stylesheet.projection!=null&&(Z=N.stylesheet.projection),N.stylesheet.transition!=null&&(R=N.stylesheet.transition)}}),this.light=a,this.ambientLight=l,this.directionalLight=c,this.fog=p,m===null?delete this.terrain:this.terrain=m,this.camera=I||{"camera-projection":"perspective"},this.projection=Z||{name:"mercator"},this.transition=o.e({},W0,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(a){let l=c=>{for(let m of c.fragments)l(m.style);a(c)};l(this)}_prioritizeTerrain(a,l,c){let m=a&&a.drapeRenderMode===0;return c===null?l&&l.drapeRenderMode===0?l:m?a:null:l!=null&&(!a||m||l&&l.drapeRenderMode===1)?l:a}mergeTerrain(){let a;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{a=this._prioritizeTerrain(a,l.terrain,l.stylesheet.terrain)}),a===null?delete this.terrain:this.terrain=a}mergeProjection(){let a;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(a=l.stylesheet.projection)}),this.projection=a||{name:"mercator"}}mergeSources(){let a={},l={},c={};this.forEachFragmentStyle(m=>{for(let p in m._sourceCaches){let Z=o.ag(p,m.scope);a[Z]=m._sourceCaches[p]}for(let p in m._otherSourceCaches){let Z=o.ag(p,m.scope);l[Z]=m._otherSourceCaches[p]}for(let p in m._symbolSourceCaches){let Z=o.ag(p,m.scope);c[Z]=m._symbolSourceCaches[p]}}),this._mergedSourceCaches=a,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=c}mergeLayers(){let a={},l=[],c={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(p=>{for(let Z of p._order){let R=p._layers[Z];if(R.type==="slot"){let I=o.c3(Z);if(a[I])continue;a[I]=[]}R.slot&&a[R.slot]?a[R.slot].push(R):l.push(R)}}),this._mergedOrder=[];let m=(p=[])=>{for(let Z of p)if(Z.type==="slot"){let R=o.c3(Z.id);a[R]&&m(a[R])}else{let R=o.ag(Z.id,Z.scope);this._mergedOrder.push(R),c[R]=Z,Z.is3D()&&(this._has3DLayers=!0),Z.type==="circle"&&(this._hasCircleLayers=!0),Z.type==="symbol"&&(this._hasSymbolLayers=!0)}};m(l),this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(a){return this.stylesheet.camera=o.e({},this.stylesheet.camera,a),this.camera=this.stylesheet.camera,this}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(a){this._spriteRequest=function(l,c,m){let p,Z,R,I=o.f.devicePixelRatio>1?"@2x":"",N=o.g(c.transformRequest(c.normalizeSpriteURL(l,I,".json"),o.R.SpriteJSON),(M,T)=>{N=null,R||(R=M,p=T,J())}),Y=o.d(c.transformRequest(c.normalizeSpriteURL(l,I,".png"),o.R.SpriteImage),(M,T)=>{Y=null,R||(R=M,Z=T,J())});function J(){if(R)m(R);else if(p&&Z){let M=o.f.getImageData(Z),T={};for(let v in p){let{width:f,height:z,x:Q,y:E,sdf:P,pixelRatio:H,stretchX:K,stretchY:w,content:q}=p[v],it=new o.h({width:f,height:z});o.h.copy(M,it,{x:Q,y:E},{x:0,y:0},{width:f,height:z}),T[v]={data:it,pixelRatio:H,sdf:P,stretchX:K,stretchY:w,content:q}}m(null,T)}}return{cancel(){N&&(N.cancel(),N=null),Y&&(Y.cancel(),Y=null)}}}(a,this.map._requestManager,(l,c)=>{if(this._spriteRequest=null,l)this.fire(new o.a(l));else if(c)for(let m in c)this.imageManager.addImage(m,this.scope,c[m]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.b("data",{dataType:"style"}))})}_validateLayer(a){let l=this.getOwnSource(a.source);if(!l)return;let c=a.sourceLayer;c&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.a(new Error('Source layer "'.concat(c,'" does not exist on source "').concat(l.id,'" as specified by style layer "').concat(a.id,'"'))))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:a}of this.fragments)if(!a.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((a,l)=>{let c=this.fragments[l];return c&&c.style&&(a.data=c.style.serialize()),a})}_serializeSources(){let a={};for(let l in this._sourceCaches){let c=this._sourceCaches[l].getSource();a[c.id]||(a[c.id]=c.serialize())}return a}_serializeLayers(a){let l=[];for(let c of a){let m=this._layers[c];m&&m.type!=="custom"&&l.push(m.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(let a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(a){return!!this.terrain&&(typeof a.isLayerDraped=="function"?a.isLayerDraped(this.getLayerSourceCache(a)):Ap.has(a.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(a){let l=this.getOwnLayer(a);if(l)return l;this.fire(new o.a(new Error("The layer '".concat(a,"' does not exist in the map's style."))))}_checkSource(a){let l=this.getOwnSource(a);if(l)return l;this.fire(new o.a(new Error("The source '".concat(a,"' does not exist in the map's style."))))}update(a){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(a),this.directionalLight&&this.directionalLight.recalculate(a);let l=this.calculateLightsBrightness();a.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));let c=this._changes.isDirty();if(this._changes.isDirty()){let p=this._changes.getLayerUpdatesByScope();for(let Z in p){let{updatedIds:R,removedIds:I}=p[Z];(R||I)&&this._updateWorkerLayers(Z,R,I)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(a),this.light&&this.light.updateTransitions(a),this.ambientLight&&this.ambientLight.updateTransitions(a),this.directionalLight&&this.directionalLight.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._changes.reset()}let m={};for(let p in this._mergedSourceCaches){let Z=this._mergedSourceCaches[p];m[p]=Z.used,Z.used=!1,Z.tileCoverLift=0}for(let p of this._mergedOrder){let Z=this._mergedLayers[p];if(Z.recalculate(a,this._availableImages),!Z.isHidden(a.zoom)){let R=this.getLayerSourceCache(Z);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,Z.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let R=Z.minzoom||0;R<(Z.maxzoom||25.5);R++){let I=this.map.painter;if(I){let N=Z.getProgramIds();if(!N)continue;for(let Y of N){let J=Z.getDefaultProgramParams(Y,a.zoom);J&&(I.style=this,this.fog&&(I._fogVisible=!0,J.overrideFog=!0,I.getOrCreateProgram(Y,J)),I._fogVisible=!1,J.overrideFog=!1,I.getOrCreateProgram(Y,J),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(J.overrideRtt=!0,I.getOrCreateProgram(Y,J)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let p in m){let Z=this._mergedSourceCaches[p];m[p]!==Z.used&&Z.getSource().fire(new o.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:Z.getSource().id}))}this.light&&this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new o.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let a=this._changes.getUpdatedImages();if(a.length){for(let l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],a);this._changes.resetUpdatedImages()}}_updateWorkerLayers(a,l,c){let m=this.getFragmentStyle(a);m&&this.dispatcher.broadcast("updateLayers",{layers:l?m._serializeLayers(l):[],scope:a,removedIds:c||[],options:m.options})}setState(a){if(this._checkLoaded(),ro(this,Ta(a)))return!1;(a=o.c1(a)).layers=o0(a.layers);let l=function(m,p){if(!m)return[{command:ri.setStyle,args:[p]}];let Z=[];try{if(!_(m.version,p.version))return[{command:ri.setStyle,args:[p]}];_(m.center,p.center)||Z.push({command:ri.setCenter,args:[p.center]}),_(m.zoom,p.zoom)||Z.push({command:ri.setZoom,args:[p.zoom]}),_(m.bearing,p.bearing)||Z.push({command:ri.setBearing,args:[p.bearing]}),_(m.pitch,p.pitch)||Z.push({command:ri.setPitch,args:[p.pitch]}),_(m.sprite,p.sprite)||Z.push({command:ri.setSprite,args:[p.sprite]}),_(m.glyphs,p.glyphs)||Z.push({command:ri.setGlyphs,args:[p.glyphs]}),_(m.imports,p.imports)||function(J=[],M=[],T){M=M||[];let v=(J=J||[]).map(io),f=M.map(io),z=J.reduce(ud,{}),Q=M.reduce(ud,{}),E=v.slice(),P,H,K,w;for(P=0,H=0;P<v.length;P++)K=v[P],Q.hasOwnProperty(K)?H++:(T.push({command:ri.removeImport,args:[K]}),E.splice(E.indexOf(K,H),1));for(P=0,H=0;P<f.length;P++)K=f[f.length-1-P],E[E.length-1-P]!==K&&(z.hasOwnProperty(K)?(T.push({command:ri.removeImport,args:[K]}),E.splice(E.lastIndexOf(K,E.length-H),1)):H++,w=E[E.length-P],T.push({command:ri.addImport,args:[Q[K],w]}),E.splice(E.length-P,0,K));for(let q of M){let it=z[q.id];it&&!_(it,q)&&T.push({command:ri.updateImport,args:[q.id,q]})}}(m.imports,p.imports,Z),_(m.transition,p.transition)||Z.push({command:ri.setTransition,args:[p.transition]}),_(m.light,p.light)||Z.push({command:ri.setLight,args:[p.light]}),_(m.fog,p.fog)||Z.push({command:ri.setFog,args:[p.fog]}),_(m.projection,p.projection)||Z.push({command:ri.setProjection,args:[p.projection]}),_(m.lights,p.lights)||Z.push({command:ri.setLights,args:[p.lights]}),_(m.camera,p.camera)||Z.push({command:ri.setCamera,args:[p.camera]});let R={},I=[];(function(J,M,T,v){let f;for(f in M=M||{},J=J||{})J.hasOwnProperty(f)&&(M.hasOwnProperty(f)||wc(f,T,v));for(f in M){if(!M.hasOwnProperty(f))continue;let z=M[f];J.hasOwnProperty(f)?_(J[f],z)||(J[f].type==="geojson"&&z.type==="geojson"&&Sp(J,M,f)?T.push({command:ri.setGeoJSONSourceData,args:[f,z.data]}):Qp(f,M,T,v)):es(f,M,T)}})(m.sources,p.sources,I,R);let N=[];m.layers&&m.layers.forEach(J=>{J.source&&R[J.source]?Z.push({command:ri.removeLayer,args:[J.id]}):N.push(J)});let Y=m.terrain;Y&&R[Y.source]&&(Z.push({command:ri.setTerrain,args:[void 0]}),Y=void 0),Z=Z.concat(I),_(Y,p.terrain)||Z.push({command:ri.setTerrain,args:[p.terrain]}),function(J,M,T){M=M||[];let v=(J=J||[]).map(io),f=M.map(io),z=J.reduce(ud,{}),Q=M.reduce(ud,{}),E=v.slice(),P=Object.create(null),H,K,w,q,it,at,rt;for(H=0,K=0;H<v.length;H++)w=v[H],Q.hasOwnProperty(w)?K++:(T.push({command:ri.removeLayer,args:[w]}),E.splice(E.indexOf(w,K),1));for(H=0,K=0;H<f.length;H++)w=f[f.length-1-H],E[E.length-1-H]!==w&&(z.hasOwnProperty(w)?(T.push({command:ri.removeLayer,args:[w]}),E.splice(E.lastIndexOf(w,E.length-K),1)):K++,at=E[E.length-H],T.push({command:ri.addLayer,args:[Q[w],at]}),E.splice(E.length-H,0,w),P[w]=!0);for(H=0;H<f.length;H++)if(w=f[H],q=z[w],it=Q[w],!P[w]&&!_(q,it))if(_(q.source,it.source)&&_(q["source-layer"],it["source-layer"])&&_(q.type,it.type)){for(rt in eo(q.layout,it.layout,T,w,null,ri.setLayoutProperty),eo(q.paint,it.paint,T,w,null,ri.setPaintProperty),_(q.slot,it.slot)||T.push({command:ri.setSlot,args:[w,it.slot]}),_(q.filter,it.filter)||T.push({command:ri.setFilter,args:[w,it.filter]}),_(q.minzoom,it.minzoom)&&_(q.maxzoom,it.maxzoom)||T.push({command:ri.setLayerZoomRange,args:[w,it.minzoom,it.maxzoom]}),q)q.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?eo(q[rt],it[rt],T,w,rt.slice(6),ri.setPaintProperty):_(q[rt],it[rt])||T.push({command:ri.setLayerProperty,args:[w,rt,it[rt]]}));for(rt in it)it.hasOwnProperty(rt)&&!q.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?eo(q[rt],it[rt],T,w,rt.slice(6),ri.setPaintProperty):_(q[rt],it[rt])||T.push({command:ri.setLayerProperty,args:[w,rt,it[rt]]}))}else T.push({command:ri.removeLayer,args:[w]}),at=E[E.lastIndexOf(w)+1],T.push({command:ri.addLayer,args:[it,at]})}(N,p.layers,Z)}catch(R){console.warn("Unable to compute style diff:",R),Z=[{command:ri.setStyle,args:[p]}]}return Z}(this.serialize(),a).filter(m=>!(m.command in pr));if(l.length===0)return!1;let c=l.filter(m=>!(m.command in p0));if(c.length>0)throw new Error("Unimplemented: ".concat(c.map(m=>m.command).join(", "),"."));return l.forEach(m=>{this[m.command].apply(this,m.args)}),this.stylesheet=a,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(a,l){return this.getImage(a)?this.fire(new o.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,this.scope,l),this._afterImageUpdated(a),this)}updateImage(a,l){this.imageManager.updateImage(a,this.scope,l)}getImage(a){return this.imageManager.getImage(a,this.scope)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a,this.scope),this._afterImageUpdated(a),this):this.fire(new o.a(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(a),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(a,l,c={}){return this._checkLoaded(),this._validate(he,"models.".concat(a),l,null,c)||(this.modelManager.addModel(a,l,this.scope),this._changes.setDirty()),this}hasModel(a){return this.modelManager.hasModel(a,this.scope)}removeModel(a){return this.hasModel(a)?(this.modelManager.removeModel(a,this.scope),this):this.fire(new o.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(a,l,c={}){if(this._checkLoaded(),this.getOwnSource(a)!==void 0)throw new Error('There is already a source with ID "'.concat(a,'".'));if(!l.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(l).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Rn,"sources.".concat(a),l,null,c))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let m=Ua(a,l,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));let p=Z=>{let R=(Z?"symbol:":"other:")+m.id,I=o.ag(R,this.scope),N=this._sourceCaches[R]=new al(I,m,Z);(Z?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=N,N.onAdd(this.map)};p(!1),l.type!=="vector"&&l.type!=="geojson"||p(!0),m.onAdd&&m.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(a){this._checkLoaded();let l=this.getOwnSource(a);if(!l)throw new Error("There is no source with this ID");for(let m in this._layers)if(this._layers[m].source===a)return this.fire(new o.a(new Error('Source "'.concat(a,'" cannot be removed while layer "').concat(m,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===a)return this.fire(new o.a(new Error('Source "'.concat(a,'" cannot be removed while terrain is using it.'))));let c=this.getOwnSourceCaches(a);for(let m of c){let p=o.c3(m.id);delete this._sourceCaches[p],this._changes.discardSourceCacheUpdate(m.id),m.fire(new o.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(a,l){this._checkLoaded(),this.getOwnSource(a).setData(l),this._changes.setDirty()}getOwnSource(a){let l=this.getOwnSourceCache(a);return l&&l.getSource()}getOwnSources(){let a=[];for(let l in this._otherSourceCaches){let c=this.getOwnSourceCache(l);c&&a.push(c.getSource())}return a}areTilesLoaded(){let a=this._mergedSourceCaches;for(let l in a){let c=a[l]._tiles;for(let m in c){let p=c[m];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}setLights(a){if(this._checkLoaded(),!a)return delete this.ambientLight,void delete this.directionalLight;let l=this._getTransitionParameters();for(let m of a){if(this._validate(Mt,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){let p=this.ambientLight;p.set(m),p.updateTransitions(l)}else this.ambientLight=new rn(m,Gn,this.scope,this.options);break;case"directional":if(this.directionalLight){let p=this.directionalLight;p.set(m),p.updateTransitions(l)}else this.directionalLight=new rn(m,Ga,this.scope,this.options)}}let c=new o.K(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let a=this.directionalLight,l=this.ambientLight;if(!a||!l)return;let c=J=>.2126*(J[0]<=.03928?J[0]/12.92:Math.pow((J[0]+.055)/1.055,2.4))+.7152*(J[1]<=.03928?J[1]/12.92:Math.pow((J[1]+.055)/1.055,2.4))+.0722*(J[2]<=.03928?J[2]/12.92:Math.pow((J[2]+.055)/1.055,2.4)),m=a.properties.get("color").toArray01(),p=a.properties.get("intensity"),Z=a.properties.get("direction"),R=1-o.bQ(Z.x,Z.y,Z.z)[2]/90,I=c(m)*p*R,N=l.properties.get("color").toArray01(),Y=l.properties.get("intensity");return(I+c(N)*Y)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let a=[];return this.directionalLight&&a.push(this.directionalLight.get()),this.ambientLight&&a.push(this.ambientLight.get()),a}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(a){if(!a)return this;if(o.c4(a)){let l=o.c5(a),c=this.fragments.find(({id:p})=>p===l);if(!c)throw new Error("Style import not found: ".concat(a));let m=o.c3(a);return c.style.getFragmentStyle(m)}{let l=this.fragments.find(({id:c})=>c===a);if(!l)throw new Error("Style import not found: ".concat(a));return l.style}}getConfigProperty(a,l){let c=this.getFragmentStyle(a);if(!c)return null;let m=o.ag(l,c.scope),p=c.options.get(m),Z=p?p.value||p.default:null;return Z?Z.serialize():null}setConfigProperty(a,l,c){let m=o.r(c);if(m.result!=="success")return void ro(this,m.value);let p=m.value.expression,Z=this.getFragmentStyle(a);if(!Z)return;let R=o.ag(l,Z.scope),I=Z.options.get(R);I&&(this.options.set(R,{...I,value:p}),this.updateConfigDependencies())}setConfig(a,l){if(this._config=a,a||l)if(l)for(let c in l){let m,p,Z=o.r(l[c].default);if(Z.result==="success"&&(m=Z.value.expression),a&&a[c]!==void 0){let M=o.r(a[c]);M.result==="success"&&(p=M.value.expression)}let{minValue:R,maxValue:I,stepValue:N,type:Y,values:J}=l[c];if(m){let M=o.ag(c,this.scope);this.options.set(M,{default:m,value:p,minValue:R,maxValue:I,stepValue:N,type:Y,values:J})}else this.fire(new o.a(new Error('No schema defined for config option "'.concat(c,'".'))))}else this.fire(new o.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let a of this._configDependentLayers){let l=this.getLayer(a);l&&(l.possiblyEvaluateVisibility(),this._updateLayer(l))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(a,l,c={}){this._checkLoaded();let m=a.id;if(this._layers[m])return void this.fire(new o.a(new Error('Layer with id "'.concat(m,'" already exists on this map'))));let p;if(a.type==="custom"){if(ro(this,o.c6(a)))return;p=o.c2(a,this.scope,this.options)}else{if(typeof a.source=="object"&&(this.addSource(m,a.source),a=o.c1(a),a=o.e(a,{source:m})),this._validate(st,"layers.".concat(m),a,{arrayIndex:-1},c))return;p=o.c2(a,this.scope,this.options),this._validateLayer(p),p.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[p.id]=p.serialize()}p.isConfigDependent&&this._configDependentLayers.add(p.fqid);let Z=this._order.length;if(l){let Y=this._order.indexOf(l);if(Y===-1)return void this.fire(new o.a(new Error('Layer with id "'.concat(l,'" does not exist on this map.'))));p.slot===this._layers[l].slot?Z=Y:o.w('Layer with id "'.concat(l,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(Z,0,m),this._layerOrderChanged=!0,this._layers[m]=p;let R=this.getOwnLayerSourceCache(p),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&p.canCastShadows()&&I&&(R.castsShadows=!0);let N=this._changes.getRemovedLayer(p);if(N&&p.source&&R&&p.type!=="custom"){this._changes.discardLayerRemoval(p);let Y=o.ag(p.source,p.scope);N.type!==p.type?this._changes.updateSourceCache(Y,"clear"):(this._changes.updateSourceCache(Y,"reload"),R.pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map),p.scope=this.scope,this.mergeLayers()}moveLayer(a,l){this._checkLoaded();let c=this._checkLayer(a);if(!c||a===l)return;let m=this._order.indexOf(a);this._order.splice(m,1);let p=this._order.length;if(l){let Z=this._order.indexOf(l);if(Z===-1)return void this.fire(new o.a(new Error('Layer with id "'.concat(l,'" does not exist on this map.'))));c.slot===this._layers[l].slot?p=Z:o.w('Layer with id "'.concat(l,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(p,0,a),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(a){this._checkLoaded();let l=this._checkLayer(a);if(!l)return;l.setEventedParent(null);let c=this._order.indexOf(a);this._order.splice(c,1),delete this._layers[a],delete this._serializedLayers[a],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);let m=this.getOwnLayerSourceCache(l);if(m&&m.castsShadows){let p=!1;for(let Z in this._layers)if(this._layers[Z].source===l.source&&this._layers[Z].canCastShadows()){p=!0;break}m.castsShadows=p}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(a){return this._layers[a]}hasLayer(a){return a in this._mergedLayers}hasLayerType(a){for(let l in this._layers)if(this._layers[l].type===a)return!0;return!1}setLayerZoomRange(a,l,c){this._checkLoaded();let m=this._checkLayer(a);m&&(m.minzoom===l&&m.maxzoom===c||(l!=null&&(m.minzoom=l),c!=null&&(m.maxzoom=c),this._updateLayer(m)))}setSlot(a,l){this._checkLoaded();let c=this._checkLayer(a);c&&c.slot!==l&&(c.slot=l,this._updateLayer(c))}setFilter(a,l,c={}){this._checkLoaded();let m=this._checkLayer(a);if(m&&!_(m.filter,l))return l==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Yt,"layers.".concat(m.id,".filter"),l,{layerType:m.type},c)||(m.filter=o.c1(l),this._updateLayer(m)))}getFilter(a){let l=this._checkLayer(a);if(l)return o.c1(l.filter)}setLayoutProperty(a,l,c,m={}){this._checkLoaded();let p=this._checkLayer(a);if(p&&!_(p.getLayoutProperty(l),c)){if(c!=null&&(!m||m.validate!==!1)&&ro(p,zt.call(Ta,{key:"layers.".concat(a,".layout.").concat(l),layerType:p.type,objectKey:l,value:c,styleSpec:o.D,style:{glyphs:!0,sprite:!0}})))return;p.setLayoutProperty(l,c),p.isConfigDependent&&this._configDependentLayers.add(p.fqid),this._updateLayer(p)}}getLayoutProperty(a,l){let c=this._checkLayer(a);if(c)return c.getLayoutProperty(l)}setPaintProperty(a,l,c,m={}){this._checkLoaded();let p=this._checkLayer(a);if(!p||_(p.getPaintProperty(l),c)||c!=null&&(!m||m.validate!==!1)&&ro(p,Tt.call(Ta,{key:"layers.".concat(a,".paint.").concat(l),layerType:p.type,objectKey:l,value:c,styleSpec:o.D})))return;let Z=p.setPaintProperty(l,c);p.isConfigDependent&&this._configDependentLayers.add(p.fqid),Z&&this._updateLayer(p),this._changes.updatePaintProperties(p)}getPaintProperty(a,l){let c=this._checkLayer(a);if(c)return c.getPaintProperty(l)}setFeatureState(a,l){this._checkLoaded();let c=a.source,m=a.sourceLayer,p=this._checkSource(c);if(!p)return;let Z=p.type;if(Z==="geojson"&&m)return void this.fire(new o.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(Z==="vector"&&!m)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided.")));let R=this.getOwnSourceCaches(c);for(let I of R)I.setFeatureState(m,a.id,l)}removeFeatureState(a,l){this._checkLoaded();let c=a.source,m=this._checkSource(c);if(!m)return;let p=m.type,Z=p==="vector"?a.sourceLayer:void 0;if(p==="vector"&&!Z)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.a(new Error("A feature id is required to remove its specific state property.")));let R=this.getOwnSourceCaches(c);for(let I of R)I.removeFeatureState(Z,a.id,l)}getFeatureState(a){this._checkLoaded();let l=a.source,c=a.sourceLayer,m=this._checkSource(l);if(m){if(m.type!=="vector"||c)return a.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(c,a.id);this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(a){return this.stylesheet.transition=o.e({},this.stylesheet.transition,a),this.transition=this.stylesheet.transition,this}getTransition(){return o.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let a=this.getTerrain(),l=a&&this.terrain&&this.terrain.scope===this.scope?a:this.stylesheet.terrain;return o.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(a){this._changes.updateLayer(a);let l=this.getLayerSourceCache(a),c=o.ag(a.source,a.scope),m=this._changes.getUpdatedSourceCaches();a.source&&!m[c]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),l.pause()),a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){let l=R=>this._mergedLayers[R].type==="fill-extrusion"||this._mergedLayers[R].type==="model",c=this.order,m={},p=[];for(let R=c.length-1;R>=0;R--){let I=c[R];if(l(I)){m[I]=R;for(let N of a){let Y=N[I];if(Y)for(let J of Y)p.push(J)}}}p.sort((R,I)=>I.intersectionZ-R.intersectionZ);let Z=[];for(let R=c.length-1;R>=0;R--){let I=c[R];if(l(I))for(let N=p.length-1;N>=0;N--){let Y=p[N].feature;if(m[Y.layer.id]<R)break;Z.push(Y),p.pop()}else for(let N of a){let Y=N[I];if(Y)for(let J of Y)Z.push(J.feature)}}return Z}queryRenderedFeatures(a,l,c){l&&l.filter&&this._validate(Yt,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;let m={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.a(new Error("parameters.layers must be an Array."))),[];for(let N of l.layers){let Y=this._mergedLayers[N];if(!Y)return this.fire(new o.a(new Error("The layer '".concat(N,"' does not exist in the map's style and cannot be queried for features.")))),[];m[Y.source]=!0}}let p=[],Z=l.serializedLayers||{},R=l&&l.layers?l.layers.some(N=>{let Y=this.getLayer(N);return Y&&Y.is3D()}):this.has3DLayers(),I=Za.createFromScreenPoints(a,c);for(let N in this._mergedSourceCaches){let Y=this._mergedSourceCaches[N].getSource();if(!Y||Y.scope!==l.scope)continue;let J=this._mergedSourceCaches[N].getSource().id;l.layers&&!m[J]||p.push(zc(this._mergedSourceCaches[N],this._mergedLayers,Z,I,l,c,R,!!this.map._showQueryGeometry))}return this.placement&&p.push(function(N,Y,J,M,T,v,f){let z={},Q=v.queryRenderedSymbols(M),E=[];for(let P of Object.keys(Q).map(Number))E.push(f[P]);E.sort(rr);for(let P of E){let H=P.featureIndex.lookupSymbolFeatures(Q[P.bucketInstanceId],Y,P.bucketIndex,P.sourceLayerIndex,T.filter,T.layers,T.availableImages,N);for(let K in H){let w=z[K]=z[K]||[],q=H[K];q.sort((it,at)=>{let rt=P.featureSortOrder;if(rt){let Zt=rt.indexOf(it.featureIndex);return rt.indexOf(at.featureIndex)-Zt}return at.featureIndex-it.featureIndex});for(let it of q)w.push(it)}}for(let P in z)z[P].forEach(H=>{let K=H.feature,w=J(N[P]);if(!w)return;let q=w.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=q});return z}(this._mergedLayers,Z,this.getLayerSourceCache.bind(this),I.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(a,l){l&&l.filter&&this._validate(Yt,"querySourceFeatures.filter",l.filter,null,l);let c=this.getOwnSourceCaches(a),m=[];for(let p of c)m=m.concat(Ml(p,l));return m}addSourceType(a,l,c){return ll.getSourceType(a)?c(new Error('A source type called "'.concat(a,'" already exists.'))):(ll.setSourceType(a,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:l.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(a,l,c={}){this._checkLoaded();let m=this.light.getLight(),p=!1;for(let R in a)if(!_(a[R],m[R])){p=!0;break}if(!p)return;let Z=this._getTransitionParameters();this.light.setLight(a,l,c),this.light.updateTransitions(Z)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,l=1){if(this._checkLoaded(),!a)return this.terrainSetForDrapingOnly()&&l!==0||delete this.terrain,a===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let c=a,m=a.source==null;if(l===1){if(typeof c.source=="object"){let R="terrain-dem-src";this.addSource(R,c.source),c=o.c1(c),c=o.e(c,{source:R})}let p=o.e({},c),Z={};if(this.terrain&&m){p.source=this.terrain.get().source;let R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(Z.style=R.serialize())}if(this._validate(j,"terrain",p,Z))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&l!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,l),this.fire(new o.b("data",{dataType:"style"}))}else{let p=this.terrain,Z=p.get();for(let R of Object.keys(o.D.terrain))!c.hasOwnProperty(R)&&o.D.terrain[R].default&&(c[R]=o.D.terrain[R].default);for(let R in a)if(!_(a[R],Z[R])){p.set(a,this.options),this.stylesheet.terrain=a;let I=this._getTransitionParameters({duration:0});p.updateTransitions(I),this.fire(new o.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){let l=this.fog=new hn(a,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();let c=this._getTransitionParameters({duration:0});l.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let l=this.fog;if(!_(l.get(),a)){l.set(a,this.options),this.stylesheet.fog=l.get();let c=this._getTransitionParameters({duration:0});l.updateTransitions(c)}}else this._createFog(a);this._markersNeedUpdate=!0}_getTransitionParameters(a){return{now:o.f.now(),transition:o.e(this.transition,a)}}updateDrapeFirstLayers(){if(!this.terrain)return;let a=[],l=[];for(let c in this._mergedLayers)this.isLayerDraped(this._mergedLayers[c])?a.push(c):l.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...l)}_createTerrain(a,l){let c=this.terrain=new Mi(a,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=a),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_force3DLayerUpdate(){for(let a in this._layers){let l=this._layers[a];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(let a in this._layers){let l=this._layers[a];l.type==="symbol"&&this._updateLayer(l)}}_validate(a,l,c,m,p={}){if(p&&p.validate===!1)return!1;let Z=o.e({},this.serialize());return ro(this,a.call(Ta,o.e({key:l,style:Z,value:c,styleSpec:o.D},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(let a in this._mergedLayers)this._mergedLayers[a].setEventedParent(null);for(let a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles(),this._mergedSourceCaches[a].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(a){let l=this.getSourceCaches(a);for(let c of l)c.clearTiles()}clearSources(){for(let a in this._mergedSourceCaches)this._mergedSourceCaches[a].clearTiles()}reloadSource(a){let l=this.getSourceCaches(a);for(let c of l)c.resume(),c.reload()}reloadSources(){for(let a of this.getSources())a.reload&&a.reload()}updateSources(a){let l;this.directionalLight&&(l=Id(this.directionalLight));for(let c in this._mergedSourceCaches)this._mergedSourceCaches[c].update(a,void 0,void 0,l)}_generateCollisionBoxes(){for(let a in this._sourceCaches){let l=this._sourceCaches[a];l.resume(),l.reload()}}_updatePlacement(a,l,c,m,p=!1){let Z=!1,R=!1,I={},N={};for(let Y of this._mergedOrder){let J=this._mergedLayers[Y];if(J.type!=="symbol")continue;let M=o.ag(J.source,J.scope),T=I[M];if(!T){let f=this.getLayerSourceCache(J);if(!f)continue;let z=f.getRenderableIds(!0).map(Q=>f.getTileByID(Q));N[M]=z.slice(),T=I[M]=z.sort((Q,E)=>E.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(E.tileID)?-1:1))}let v=this.crossTileSymbolIndex.addLayer(J,T,a.center.lng,a.projection);Z=Z||v}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),p=p||this._layerOrderChanged||c===0,this._layerOrderChanged&&this.fire(new o.b("neworder")),(p||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.f.now(),a.zoom))&&(this.pauseablePlacement=new Rd(a,this._mergedOrder,p,l,c,m,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.f.now()),R=!0),Z&&this.pauseablePlacement.placement.setStale()),R||Z){this._buildingIndex.onNewFrame(a.zoom);for(let Y of this._mergedOrder){let J=this._mergedLayers[Y];J.type==="symbol"&&this.placement.updateLayerOpacities(J,I[o.ag(J.source,J.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.f.now())}_releaseSymbolFadeTiles(){for(let a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}addImport(a,l){this._checkLoaded();let c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:p})=>p===a.id)!==-1)return this.fire(new o.a(new Error("Import with id '".concat(a.id,"' already exists in the map's style."))));if(!l)return c.push(a),this._loadImports([a],!0),this;let m=c.findIndex(({id:p})=>p===l);return m===-1?this.fire(new o.a(new Error('Import with id "'.concat(l,'" does not exist on this map.')))):(this.stylesheet.imports=c.slice(0,m).concat(a).concat(c.slice(m)),this._loadImports([a],!0,l),this)}updateImport(a,l){this._checkLoaded();let c=this.stylesheet.imports||[],m=this.getImportIndex(a);return m===-1?this:typeof l=="string"?(this.setImportUrl(a,l),this):(l.url&&l.url!==c[m].url&&this.setImportUrl(a,l.url),_(l.config,c[m].config)||this.setImportConfig(a,l.config),_(l.data,c[m].data)||this.setImportData(a,l.data),this)}moveImport(a,l){this._checkLoaded();let c=this.stylesheet.imports||[],m=this.getImportIndex(a);if(m===-1)return this;let p=this.getImportIndex(l);if(p===-1)return this;let Z=c[m],R=this.fragments[m];return c=c.filter(({id:I})=>I!==a),this.fragments=this.fragments.filter(({id:I})=>I!==a),this.stylesheet.imports=c.slice(0,p).concat(Z).concat(c.slice(p)),this.fragments=this.fragments.slice(0,p).concat(R).concat(this.fragments.slice(p)),this.mergeLayers(),this}setImportUrl(a,l){this._checkLoaded();let c=this.stylesheet.imports||[],m=this.getImportIndex(a);if(m===-1)return this;c[m].url=l;let p=this.fragments[m];return p.style=this._createFragmentStyle(c[m]),p.style.on("style.import.load",()=>this.mergeAll()),p.style.loadURL(l),this}setImportData(a,l){this._checkLoaded();let c=this.getImportIndex(a),m=this.stylesheet.imports||[];return c===-1?this:l?(this.fragments[c].style.setState(l),this._reloadImports(),this):(delete m[c].data,this.setImportUrl(a,m[c].url))}setImportConfig(a,l){this._checkLoaded();let c=this.getImportIndex(a),m=this.stylesheet.imports||[];if(c===-1)return this;l?m[c].config=l:delete m[c].config;let p=this.fragments[c],Z=p.style.stylesheet&&p.style.stylesheet.schema;return p.config=l,p.style.setConfig(l,Z),this.updateConfigDependencies(),this}removeImport(a){this._checkLoaded();let l=this.stylesheet.imports||[],c=this.getImportIndex(a);return c===-1||(l.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports()),this}getImportIndex(a){let l=(this.stylesheet.imports||[]).findIndex(c=>c.id===a);return l===-1&&this.fire(new o.a(new Error("Import '".concat(a,"' does not exist in the map's style and cannot be updated.")))),l}getLayer(a){return this._mergedLayers[a]}getSources(){let a=[];for(let l in this._mergedOtherSourceCaches){let c=this._mergedOtherSourceCaches[l];c&&a.push(c.getSource())}return a}getSource(a,l){let c=this.getSourceCache(a,l);return c&&c.getSource()}getLayerSource(a){let l=this.getLayerSourceCache(a);return l&&l.getSource()}getSourceCache(a,l){let c=o.ag(a,l);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(a){let l=o.ag(a.source,a.scope);return a.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(a){let l=[];return this._mergedOtherSourceCaches[a]&&l.push(this._mergedOtherSourceCaches[a]),this._mergedSymbolSourceCaches[a]&&l.push(this._mergedSymbolSourceCaches[a]),l}updateSourceCaches(){let a=this._changes.getUpdatedSourceCaches();for(let l in a){let c=a[l];c==="reload"?this.reloadSource(l):c==="clear"&&this.clearSource(l)}}updateLayers(a){let l=this._changes.getUpdatedPaintProperties();for(let c of l){let m=this.getLayer(c);m&&m.updateTransitions(a)}}getImages(a,l,c){this.imageManager.getImages(l.icons,l.scope,c),this._updateTilesForChangedImages();let m=p=>{p&&p.setDependencies(l.tileID.key,l.type,l.icons)};m(this._otherSourceCaches[l.source]),m(this._symbolSourceCaches[l.source])}getGlyphs(a,l,c){this.glyphManager.getGlyphs(l.stacks,l.scope,c)}getResource(a,l,c){return o.c9(l,c)}getOwnSourceCache(a){return this._otherSourceCaches[a]}getOwnLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}getOwnSourceCaches(a){let l=[];return this._otherSourceCaches[a]&&l.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&l.push(this._symbolSourceCaches[a]),l}_isSourceCacheLoaded(a){let l=this.getOwnSourceCaches(a);return l.length===0?(this.fire(new o.a(new Error("There is no source with ID '".concat(a,"'")))),!1):l.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(a=>{a.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ll.getSourceType=function(d){return Bl[d]},ll.setSourceType=function(d,a){Bl[d]=a},ll.registerForPluginStateChange=o.bV;var Ud="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",xd="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",Nd="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Yd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",cb="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",bb="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",u0="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Wr="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",ur="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",mb="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",bs="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";let Zr=[];so(Ud,Zr),so(Nd,Zr),so(xd,Zr);let Cn={"_prelude_fog.vertex.glsl":bb,"_prelude_terrain.vertex.glsl":cb,"_prelude_shadow.vertex.glsl":mb,"_prelude_fog.fragment.glsl":u0,"_prelude_shadow.fragment.glsl":bs,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Wr,"_prelude_raster_particle.glsl":ur},gr={};bi("",cb),bi(u0,bb),bi(bs,mb),bi(Wr,""),bi(ur,"");let hb=bi(xd,Nd),Xd=Ud;var pb={background:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:bi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bi('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:bi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:bi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:bi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:bi('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:bi("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:bi("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:bi("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:bi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:bi("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:bi('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:bi('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:bi('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:bi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:bi('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Yd),skyboxGradient:bi('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Yd),skyboxCapture:bi("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:bi('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:bi('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:bi("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:bi("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function so(d,a){let l=d.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let c of l)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let m=c.split(" ");for(let p of m)a.includes(p)||a.push(p)}}function bi(d,a){let l=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m=a.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(N=>{let Y=N.split(" ");return Y[Y.length-1]}),m=[...new Set(m)]);let p={},Z=[],R=[];if(d=d.replace(l,(N,Y)=>(R.push(Y),"")),(a=a.replace(l,(N,Y)=>(Z.push(Y),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Zr];so(d,I),so(a,I);for(let N of[...Z,...R])Cn[N]||console.error("Undefined include: ".concat(N)),gr[N]||(gr[N]=[],so(Cn[N],gr[N])),I=[...I,...gr[N]];return{fragmentSource:d=d.replace(c,(N,Y,J,M,T)=>(p[T]=!0,Y==="define"?"\n#ifndef HAS_UNIFORM_u_".concat(T,"\nin ").concat(J," ").concat(M," ").concat(T,";\n#else\nuniform ").concat(J," ").concat(M," u_").concat(T,";\n#endif\n"):Y==="initialize"?"\n#ifdef HAS_UNIFORM_u_".concat(T,"\n    ").concat(J," ").concat(M," ").concat(T," = u_").concat(T,";\n#endif\n"):Y==="define-attribute"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(T,"\n    in ").concat(J," ").concat(M," ").concat(T,";\n#endif\n"):Y==="initialize-attribute"?"":void 0)),vertexSource:a=a.replace(c,(N,Y,J,M,T)=>{let v=M==="float"?"vec2":M,f=T.match(/color/)?"color":v;return Y==="define-attribute-vertex-shader-only"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(T,"\nin ").concat(J," ").concat(M," a_").concat(T,";\n#endif\n"):p[T]?Y==="define"?"\n#ifndef HAS_UNIFORM_u_".concat(T,"\nuniform lowp float u_").concat(T,"_t;\nin ").concat(J," ").concat(v," a_").concat(T,";\nout ").concat(J," ").concat(M," ").concat(T,";\n#else\nuniform ").concat(J," ").concat(M," u_").concat(T,";\n#endif\n"):Y==="initialize"?f==="vec4"?"\n#ifndef HAS_UNIFORM_u_".concat(T,"\n    ").concat(T," = a_").concat(T,";\n#else\n    ").concat(J," ").concat(M," ").concat(T," = u_").concat(T,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(T,"\n    ").concat(T," = unpack_mix_").concat(f,"(a_").concat(T,", u_").concat(T,"_t);\n#else\n    ").concat(J," ").concat(M," ").concat(T," = u_").concat(T,";\n#endif\n"):Y==="define-attribute"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(T,"\n    in ").concat(J," ").concat(M," a_").concat(T,";\n    out ").concat(J," ").concat(M," ").concat(T,";\n#endif\n"):Y==="initialize-attribute"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(T,"\n    ").concat(T," = a_").concat(T,";\n#endif\n"):void 0:Y==="define"?"\n#ifndef HAS_UNIFORM_u_".concat(T,"\nuniform lowp float u_").concat(T,"_t;\nin ").concat(J," ").concat(v," a_").concat(T,";\n#else\nuniform ").concat(J," ").concat(M," u_").concat(T,";\n#endif\n"):Y==="define-instanced"?f==="mat4"?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(T,"0;\nin vec4 a_").concat(T,"1;\nin vec4 a_").concat(T,"2;\nin vec4 a_").concat(T,"3;\n#else\nuniform ").concat(J," ").concat(M," u_").concat(T,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(J," ").concat(v," a_").concat(T,";\n#else\nuniform ").concat(J," ").concat(M," u_").concat(T,";\n#endif\n"):Y==="initialize-attribute-custom"?"\n#ifdef HAS_ATTRIBUTE_a_".concat(T,"\n    ").concat(J," ").concat(M," ").concat(T," = a_").concat(T,";\n#endif\n"):f==="vec4"?"\n#ifndef HAS_UNIFORM_u_".concat(T,"\n    ").concat(J," ").concat(M," ").concat(T," = a_").concat(T,";\n#else\n    ").concat(J," ").concat(M," ").concat(T," = u_").concat(T,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(T,"\n    ").concat(J," ").concat(M," ").concat(T," = unpack_mix_").concat(f,"(a_").concat(T,", u_").concat(T,"_t);\n#else\n    ").concat(J," ").concat(M," ").concat(T," = u_").concat(T,";\n#endif\n")}),staticAttributes:m,usedDefines:I,vertexIncludes:Z,fragmentIncludes:R}}class Wb{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,l,c,m,p,Z,R,I){this.context=a;let N=this.boundPaintVertexBuffers.length!==m.length;for(let J=0;!N&&J<m.length;J++)this.boundPaintVertexBuffers[J]!==m[J]&&(N=!0);let Y=this.boundDynamicVertexBuffers.length!==R.length;for(let J=0;!Y&&J<R.length;J++)this.boundDynamicVertexBuffers[J]!==R[J]&&(Y=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==c||N||Y||this.boundIndexBuffer!==p||this.boundVertexOffset!==Z)this.freshBind(l,c,m,p,Z,R,I);else{a.bindVertexArrayOES.set(this.vao);for(let J of R)J&&(J.bind(),I&&J.instanceCount&&J.setVertexAttribDivisor(a.gl,l,I));p&&p.dynamicDraw&&p.bind()}}freshBind(a,l,c,m,p,Z,R){let I=a.numAttributes,N=this.context,Y=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=m,this.boundVertexOffset=p,this.boundDynamicVertexBuffers=Z,l.enableAttributes(Y,a),l.bind(),l.setVertexAttribPointers(Y,a,p);for(let J of c)J.enableAttributes(Y,a),J.bind(),J.setVertexAttribPointers(Y,a,p);for(let J of Z)J&&(J.enableAttributes(Y,a),J.bind(),J.setVertexAttribPointers(Y,a,p),R&&J.instanceCount&&J.setVertexAttribDivisor(Y,a,R));m&&m.bind(),N.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Hp(d,a){let l=Math.pow(2,a.canonical.z),c=a.canonical.y;return[new o.L(0,c/l).toLngLat().lat,new o.L(0,(c+1)/l).toLngLat().lat]}function Jd(d,a,l,c,m,p,Z){let R=d.context,I=R.gl,N=l.hillshadeFBO;if(!N)return;d.prepareDrawTile();let Y=d.isTileAffectedByFog(a),J=d.getOrCreateProgram("hillshade",{overrideFog:Y});R.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,N.colorAttachment.get());let M=((z,Q,E,P)=>{let H=E.paint.get("hillshade-shadow-color"),K=E.paint.get("hillshade-highlight-color"),w=E.paint.get("hillshade-accent-color"),q=E.paint.get("hillshade-emissive-strength"),it=o.bj(E.paint.get("hillshade-illumination-direction"));if(E.paint.get("hillshade-illumination-anchor")==="viewport")it-=z.transform.angle;else if(z.style&&z.style.enable3dLights()&&z.style.directionalLight){let rt=z.style.directionalLight.properties.get("direction"),Zt=o.bQ(rt.x,rt.y,rt.z);it=o.bj(Zt[1])}let at=!z.options.moving;return{u_matrix:P||z.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),at),u_image:0,u_latrange:Hp(0,Q.tileID),u_light:[E.paint.get("hillshade-exaggeration"),it],u_shadow:H,u_highlight:K,u_emissive_strength:q,u_accent:w}})(d,l,c,d.terrain?a.projMatrix:null);d.uploadCommonUniforms(R,J,a.toUnwrapped());let{tileBoundsBuffer:T,tileBoundsIndexBuffer:v,tileBoundsSegments:f}=d.getTileBoundsBuffers(l);J.draw(d,I.TRIANGLES,m,p,Z,Ye.disabled,M,c.id,T,v,f)}function Z0(d,a,l){if(!a.needsDEMTextureUpload)return;let c=d.context,m=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||d.getTileTexture(l.stride);let p=l.getPixels();a.demTexture?a.demTexture.update(p,{premultiply:!1}):a.demTexture=new o.T(c,p,m.R32F,{premultiply:!1}),a.needsDEMTextureUpload=!1}function ub(d,a,l){let c=d.context,m=c.gl;if(!a.dem)return;let p=a.dem;if(c.activeTexture.set(m.TEXTURE1),Z0(d,a,p),!a.demTexture)return;a.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);let Z=p.dim;c.activeTexture.set(m.TEXTURE0);let R=a.hillshadeFBO;if(!R){let M=new o.T(c,{width:Z,height:Z,data:null},m.RGBA);M.bind(m.LINEAR,m.CLAMP_TO_EDGE),R=a.hillshadeFBO=c.createFramebuffer(Z,Z,!0,"renderbuffer"),R.colorAttachment.set(M.texture)}c.bindFramebuffer.set(R.framebuffer),c.viewport.set([0,0,Z,Z]);let{tileBoundsBuffer:I,tileBoundsIndexBuffer:N,tileBoundsSegments:Y}=d.getMercatorTileBoundsBuffers(),J=[];d.linearFloatFilteringSupported()&&J.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:J}).draw(d,m.TRIANGLES,Ne.disabled,Ce.disabled,Pe.unblended,Ye.disabled,((M,T)=>{let v=T.stride,f=o.a6.create();return o.a6.ortho(f,0,o.V,-o.V,0,0,1),o.a6.translate(f,f,[0,-o.V,0]),{u_matrix:f,u_image:1,u_dimension:[v,v],u_zoom:M.overscaledZ}})(a.tileID,p),l.id,I,N,Y),a.needsHillshadePrepare=!1}let g0=d=>({u_matrix:new o.bK(d),u_image0:new o.bO(d),u_skirt_height:new o.bN(d),u_ground_shadow_factor:new o.bM(d)}),yd=(d,a,l)=>({u_matrix:d,u_image0:0,u_skirt_height:a,u_ground_shadow_factor:l}),V0=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:l,u_zoom_transition:m,u_merc_center:p,u_image0:0,u_frustum_tl:Z,u_frustum_tr:R,u_frustum_br:I,u_frustum_bl:N,u_globe_pos:Y,u_globe_radius:J,u_viewport:M,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:T,u_far_z_cutoff:v});function ms(d,a){return d!=null&&a!=null&&!(!d.hasData()||!a.hasData())&&d.demTexture!=null&&a.demTexture!=null&&d.tileID.key!==a.tileID.key}let Vr=new class{constructor(){this.operations={}}newMorphing(d,a,l,c,m){if(d in this.operations){let p=this.operations[d];p.to.tileID.key!==l.tileID.key&&(p.queued=l)}else this.operations[d]={startTime:c,phase:0,duration:m,from:a,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;let a=this.operations[d];return{from:a.from,to:a.to,phase:a.phase}}update(d){for(let a in this.operations){let l=this.operations[a];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[a];break}}}_nextOp(d,a){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=a,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Zb={0:null,1:"TERRAIN_VERTEX_MORPHING"};function gb(d,a,l){if(a===0)return 0;let c=a<1&&l===514?.25/a:1;return 6*Math.pow(1.5,22-d)*Math.max(a,1)*c}function Rr(d,a){let l=1<<d.z;return!a&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}let Vb=d=>({u_matrix:d});function Rb(d,a,l,c,m){if(m>0){let p=o.f.now(),Z=(p-d.timeAdded)/m,R=a?(p-a.timeAdded)/m:-1,I=l.getSource(),N=c.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),Y=!a||Math.abs(a.tileID.overscaledZ-N)>Math.abs(d.tileID.overscaledZ-N),J=Y&&d.refreshedUponExpiration?1:o.aa(Y?Z:1-R,0,1);return d.refreshedUponExpiration&&Z>=1&&(d.refreshedUponExpiration=!1),a?{opacity:1,mix:1-J}:{opacity:J,mix:0}}return{opacity:1,mix:0}}class jp extends al{constructor(a){let l={type:"raster-dem",maxzoom:a.transform.maxZoom},c=new o.bW(o.bX(),null),m=Ua("mock-dem",l,c,a.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,l){a.state="loaded",l(null)}}class Op extends al{constructor(a){let l=Ua("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new o.bW(o.bX(),null),a.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,l,c){if(a.freezeTileCoverage)return;this.transform=a;let m=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((p,Z)=>{if(p[Z.key]="",!this._tiles[Z.key]){let R=new to(Z,this._source.tileSize*Z.overscaleFactor(),a.tileZoom);R.state="loaded",this._tiles[Z.key]=R}return p},{});for(let p in this._tiles)p in m||(this.freeFBO(p),this._tiles[p].unloadVectorData(),delete this._tiles[p])}freeFBO(a){let l=this.proxyCachedFBO[a];if(l!==void 0){let c=Object.values(l);this.renderCachePool.push(...c),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class R0 extends o.am{constructor(a,l,c){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=l,this.projMatrix=c}}class Dp extends o.ck{constructor(a,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},a.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),a.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[c,m,p]=function(I){let N=new o.aN,Y=new o.aw,J=131;N.reserve(17161),Y.reserve(33800);let M=o.V/128,T=o.V+M/2,v=T+M;for(let z=-M;z<v;z+=M)for(let Q=-M;Q<v;Q+=M){let E=Q<0||Q>T||z<0||z>T?24575:0,P=o.aa(Math.round(Q),0,o.V),H=o.aa(Math.round(z),0,o.V);N.emplaceBack(P+E,H)}let f=(z,Q)=>{let E=Q*J+z;Y.emplaceBack(E+1,E,E+J),Y.emplaceBack(E+J,E+J+1,E+1)};for(let z=1;z<129;z++)for(let Q=1;Q<129;Q++)f(Q,z);return[0,129].forEach(z=>{for(let Q=0;Q<130;Q++)f(Q,z),f(z,Q)}),[N,Y,32768]}(),Z=a.context;this.gridBuffer=Z.createVertexBuffer(c,o.aP.members),this.gridIndexBuffer=Z.createIndexBuffer(m),this.gridSegments=o.aB.simpleSegment(0,0,c.length,m.length),this.gridNoSkirtSegments=o.aB.simpleSegment(0,0,c.length,p),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Op(l.map),this.orthoMatrix=o.a6.create(),o.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.V,0,o.V,0,1);let R=Z.gl;this._overlapStencilMode=new Ce({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new jp(l.map),this._pendingGroundEffectLayers=[]}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),this._style=a,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,l,c){if(a&&a.terrain){this._style!==a&&(this.style=a,this._evaluationZoom=void 0);let m=a.terrain.properties,p=a.terrain.drapeRenderMode===0,Z=a.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.f.now();let R=a.terrain&&a.terrain.scope,I=m.get("source"),N=p?this._mockSourceCache:a.getSourceCache(I,R);if(!N)return void o.w("Couldn't find terrain source \"".concat(I,'".'));if(this.sourceCache=N,this._exaggeration=Z?this.calculateExaggeration(l):m.get("exaggeration"),!l.projection.requiresDraping&&Z&&this._exaggeration===0)return void this._disable();this.enabled=!0;let Y=()=>{this.sourceCache.used&&o.w("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));let J=this.getScaledDemTileSize();this.sourceCache.update(l,J,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Y(),this._initializing=!0),Y(),l.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(a){let l=this._previousCameraAltitude,c=a.getFreeCameraOptions().position.z/a.pixelsPerMeter*a.worldSize;this._previousCameraAltitude=c;let m=l!=null?c-l:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;let p=a.zoom,Z=this._style.terrain;if(!this._previousUpdateTimestamp)return Z.getExaggeration(p);let R=p-this._previousZoom,I=this._previousUpdateTimestamp,N=p;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(p-N)>.5&&(R=.5*(p-N+R)),R*m<0&&(N+=R)),this._evaluationZoom=N;let Y=Z.getExaggeration(N),J=Y===Z.getExaggeration(Math.max(0,N-.1));if(J&&Math.abs(Y-this._exaggeration)<.01)return Y;let M=Math.min(.1,.00375*(this._updateTimestamp-I));return(J||Y<.1||Math.abs(R)<1e-4)&&(M=Math.min(.2,4*M)),o.U(this._exaggeration,Y,M)}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let a in this._style._mergedSourceCaches)this._style._mergedSourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let l=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(o.L.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let m=this.proxyCoords=l.getIds().map(I=>{let N=l.getTileByID(I).tileID;return N.projMatrix=c.calculateProjMatrix(N.toUnwrapped()),N});(function(I,N){let Y=N.transform.pointCoordinate(N.transform.getCameraPoint()),J=new o.P(Y.x,Y.y);I.sort((M,T)=>{if(T.overscaledZ-M.overscaledZ)return T.overscaledZ-M.overscaledZ;let v=new o.P(M.canonical.x+(1<<M.canonical.z)*M.wrap,M.canonical.y),f=new o.P(T.canonical.x+(1<<T.canonical.z)*T.wrap,T.canonical.y),z=J.mult(1<<M.canonical.z);return z.x-=.5,z.y-=.5,z.distSqr(v)-z.distSqr(f)})})(m,this.painter);let p=this.proxyToSource||{};this.proxyToSource={},m.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};let Z=this._style._mergedSourceCaches;for(let I in Z){let N=Z[I];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,a[I],p),N.usedForTerrain))continue;let Y=a[I];N.getSource().reparseOverscaled&&this._assignTerrainTiles(Y)}this.proxiedCoords[l.id]=m.map(I=>new R0(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(p),this.renderingToTexture=!1;let R={};this._visibleDemTiles=[];for(let I of this.proxyCoords){let N=this.terrainTileForTile[I.key];if(!N)continue;let Y=N.tileID.key;Y in R||(this._visibleDemTiles.push(N),R[Y]=Y)}}_assignTerrainTiles(a){this._initializing||a.forEach(l=>{if(this.terrainTileForTile[l.key])return;let c=this._findTileCoveringTileID(l,this.sourceCache);c&&(this.terrainTileForTile[l.key]=c)})}_prepareDEMTextures(){let a=this.painter.context,l=a.gl;for(let c in this.terrainTileForTile){let m=this.terrainTileForTile[c],p=m.dem;!p||m.demTexture&&!m.needsDEMTextureUpload||(a.activeTexture.set(l.TEXTURE1),Z0(this.painter,m,p))}}_prepareDemTileUniforms(a,l,c,m){if(!l||l.demTexture==null)return!1;let p=a.tileID.canonical,Z=Math.pow(2,l.tileID.canonical.z-p.z),R=m||"";return c["u_dem_tl".concat(R)]=[p.x*Z%1,p.y*Z%1],c["u_dem_scale".concat(R)]=Z,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let a=this.painter.context,l=a.gl;if(!this._emptyDepthBufferTexture){let c=new o.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(a,c,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0,l=this._visibleDemTiles.reduce((c,m)=>{if(!m.dem)return c;let p=m.dem.tree.minimums[0];return p>0&&a++,c+p},0);return a?l/a:0}_updateEmptyDEMTexture(){let a=this.painter.context,l=a.gl;a.activeTexture.set(l.TEXTURE2);let c=this._getLoadedAreaMinimum(),[m,p]=(()=>{let R=new o.cm({width:1,height:1},new Float32Array([c]));return[l.R32F,R]})();this._emptyDEMTextureDirty=!1;let Z=this._emptyDEMTexture;return Z?Z.update(p,{premultiply:!1}):Z=this._emptyDEMTexture=new o.T(a,p,m,{premultiply:!1}),Z}setupElevationDraw(a,l,c){let m=this.painter.context,p=m.gl,Z={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};Z.u_exaggeration=this.exaggeration();let R=null,I=null,N=1;if(c&&c.morphing&&this._useVertexMorphing){let M=c.morphing.srcDemTile,T=c.morphing.dstDemTile;N=c.morphing.phase,M&&T&&(this._prepareDemTileUniforms(a,M,Z,"_prev")&&(I=M),this._prepareDemTileUniforms(a,T,Z)&&(R=T))}let Y=M=>M&&M.demTexture&&this.painter.linearFloatFilteringSupported()?p.LINEAR:p.NEAREST,J=M=>{Z.u_dem_size=M.size[0]===1?1:M.size[0]-2};if(I&&R)m.activeTexture.set(p.TEXTURE2),R.demTexture.bind(Y(R),p.CLAMP_TO_EDGE),m.activeTexture.set(p.TEXTURE4),I.demTexture.bind(Y(I),p.CLAMP_TO_EDGE),R.demTexture&&J(R.demTexture),Z.u_dem_lerp=N;else{R=this.terrainTileForTile[a.tileID.key],m.activeTexture.set(p.TEXTURE2);let M=this._prepareDemTileUniforms(a,R,Z)?R.demTexture:this.emptyDEMTexture;M.bind(Y(R),p.CLAMP_TO_EDGE),J(M)}if(m.activeTexture.set(p.TEXTURE3),c&&c.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),this._depthFBO&&(Z.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE),Z.u_depth_size_inv=[1,1]),c&&c.useMeterToDem&&R){let M=(1<<R.tileID.canonical.z)*o.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;Z.u_meter_to_dem=M}if(c&&c.labelPlaneMatrixInv&&(Z.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),l.setTerrainUniformValues(m,Z),this.painter.transform.projection.name==="globe"){let M=this.globeUniformValues(this.painter.transform,a.tileID.canonical,c&&c.useDenormalizedUpVectorScale);l.setGlobeUniformValues(m,M)}}globeUniformValues(a,l,c){let m=a.projection;return{u_tile_tl_up:m.upVector(l,0,0),u_tile_tr_up:m.upVector(l,o.V,0),u_tile_br_up:m.upVector(l,o.V,o.V),u_tile_bl_up:m.upVector(l,0,o.V),u_tile_up_scale:c?o.cl(1):m.upVectorScale(l,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){let l=this.painter,c=this.painter.context;a.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,p,Z,R,I){if(m.transform.projection.name==="globe")(function(N,Y,J,M,T){let v=N.context,f=v.gl,z,Q,E=N.transform,P=o.cd(N,v,E),H=(It,Gt)=>{if(Q===Gt)return;let St=[Zb[Gt],"PROJECTION_GLOBE_VIEW"];P&&St.push("CUSTOM_ANTIALIASING");let mt=N.isTileAffectedByFog(It);z=N.getOrCreateProgram("globeRaster",{defines:St,overrideFog:mt}),Q=Gt},K=N.colorModeForRenderPass(),w=new Ne(f.LEQUAL,Ne.ReadWrite,N.depthRangeFor3D);Vr.update(T);let q=o.ce(E),it=[o.a5(E.center.lng),o.ae(E.center.lat)],at=N.globeSharedBuffers,rt=[E.width*o.f.devicePixelRatio,E.height*o.f.devicePixelRatio],Zt=Float32Array.from(E.globeMatrix),bt={useDenormalizedUpVectorScale:!0};{let It=N.transform,Gt=gb(It.zoom,Y.exaggeration(),Y.sourceCache._source.tileSize);Q=-1;let St=f.TRIANGLES;for(let mt of M){let Vt=J.getTile(mt),ot=Ce.disabled,Wt=Y.prevTerrainTileForTile[mt.key],ft=Y.terrainTileForTile[mt.key];ms(Wt,ft)&&Vr.newMorphing(mt.key,Wt,ft,T,250),v.activeTexture.set(f.TEXTURE0),Vt.texture&&Vt.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE);let At=Vr.getMorphValuesForProxy(mt.key),Et=At?1:0;At&&o.j(bt,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:o.cc(At.phase)}});let $t=o.cf(mt.canonical),me=o.cg($t.getCenter().lat),Ie=o.ch(mt.canonical,$t,me,It.worldSize/It._pixelsPerMercatorPixel),ue=o.aT(o.ci(mt.canonical)),Re=V0(It.expandedFarZProjMatrix,Zt,q,ue,o.S(It.zoom),it,It.frustumCorners.TL,It.frustumCorners.TR,It.frustumCorners.BR,It.frustumCorners.BL,It.globeCenterInViewSpace,It.globeRadius,rt,Gt,It._farZ,Ie);if(H(mt,Et),z&&(Y.setupElevationDraw(Vt,z,bt),N.uploadCommonUniforms(v,z,mt.toUnwrapped()),at)){let[Ae,Me,fe]=at.getGridBuffers(me,Gt!==0);z.draw(N,St,w,ot,K,Ye.backCCW,Re,"globe_raster",Ae,Me,fe)}}}if(at&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){let It=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];P&&It.push("CUSTOM_ANTIALIASING"),z=N.getOrCreateProgram("globeRaster",{defines:It});for(let Gt of M){let{x:St,y:mt,z:Vt}=Gt.canonical,ot=mt===0,Wt=mt===(1<<Vt)-1,[ft,At,Et,$t]=at.getPoleBuffers(Vt,!1);if($t&&(ot||Wt)){let me=J.getTile(Gt);v.activeTexture.set(f.TEXTURE0),me.texture&&me.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE);let Ie=o.cj(Vt,St,E),ue=o.aT(o.ci(Gt.canonical)),Re=(Ae,Me)=>Ae.draw(N,f.TRIANGLES,w,Ce.disabled,K,Ye.disabled,V0(E.expandedFarZProjMatrix,Ie,Ie,ue,0,it,E.frustumCorners.TL,E.frustumCorners.TR,E.frustumCorners.BR,E.frustumCorners.BL,E.globeCenterInViewSpace,E.globeRadius,rt,0,E._farZ),"globe_pole_raster",Me,Et,$t);Y.setupElevationDraw(me,z,bt),N.uploadCommonUniforms(v,z,Gt.toUnwrapped()),ot&&N.renderDefaultNorthPole&&Re(z,ft),Wt&&N.renderDefaultSouthPole&&(Ie=o.a6.scale(o.a6.create(),Ie,[1,-1,1]),Re(z,At))}}}})(m,p,Z,R,I);else{let N=m.context,Y=N.gl,J,M,T=m.shadowRenderer,v=oo(m,m.longestCutoffRange),f=K=>{if(M===K)return;let w=[];w.push(Zb[K]),v.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),J=m.getOrCreateProgram("terrainRaster",{defines:w}),M=K},z=m.colorModeForRenderPass(),Q=new Ne(Y.LEQUAL,Ne.ReadWrite,m.depthRangeFor3D);Vr.update(I);let E=m.transform,P=gb(E.zoom,p.exaggeration(),p.sourceCache._source.tileSize),H=[0,0,0];if(T){let K=m.style.directionalLight,w=m.style.ambientLight;K&&w&&(H=cs(K,w))}{M=-1;let K=Y.TRIANGLES,[w,q]=[p.gridIndexBuffer,p.gridSegments];for(let it of R){let at=Z.getTile(it),rt=Ce.disabled,Zt=p.prevTerrainTileForTile[it.key],bt=p.terrainTileForTile[it.key];ms(Zt,bt)&&Vr.newMorphing(it.key,Zt,bt,I,250),N.activeTexture.set(Y.TEXTURE0),at.texture&&at.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let It=Vr.getMorphValuesForProxy(it.key),Gt=It?1:0,St;It&&(St={morphing:{srcDemTile:It.from,dstDemTile:It.to,phase:o.cc(It.phase)}});let mt=yd(it.projMatrix,Rr(it.canonical,E.renderWorldCopies)?P/10:P,H);if(f(Gt),!J)continue;p.setupElevationDraw(at,J,St);let Vt=it.toUnwrapped();T&&T.setupShadows(Vt,J),m.uploadCommonUniforms(N,J,Vt,null,v),J.draw(m,K,Q,rt,z,Ye.backCCW,mt,"terrain_raster",p.gridBuffer,w,q)}}}}(l,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;let l=this.painter,c=this.painter.context,m=this.proxySourceCache,p=this.proxiedCoords[m.id],Z=this._drapedRenderBatches.shift(),R=l.style.order,I=[],N=0;for(let Y of p){let J=m.getTileByID(Y.proxyTileKey),M=m.proxyCachedFBO[Y.key]?m.proxyCachedFBO[Y.key][a]:void 0,T=M!==void 0?m.renderCache[M]:this.pool[N++],v=M!==void 0;if(J.texture=T.tex,v&&!T.dirty){I.push(J.tileID);continue}let f;c.bindFramebuffer.set(T.fb.framebuffer),this.renderedToTile=!1,T.dirty&&(c.clear({color:o.ax.transparent,stencil:0}),T.dirty=!1);for(let z=Z.start;z<=Z.end;++z){let Q=l.style._mergedLayers[R[z]];if(Q.isHidden(l.transform.zoom))continue;let E=l.style.getLayerSourceCache(Q),P=E?this.proxyToSource[Y.key][E.id]:[Y];if(!P)continue;let H=P;c.viewport.set([0,0,T.fb.width,T.fb.height]),f!==(E?E.id:null)&&(this._setupStencil(T,P,Q,E),f=E?E.id:null),l.renderLayer(l,E,Q,H)}if(this._drapedRenderBatches.length===0)for(let z of this._pendingGroundEffectLayers){let Q=l.style._mergedLayers[R[z]];if(Q.isHidden(l.transform.zoom))continue;let E=l.style.getLayerSourceCache(Q),P=E?this.proxyToSource[Y.key][E.id]:[Y];if(!P)continue;let H=P;c.viewport.set([0,0,T.fb.width,T.fb.height]),f!==(E?E.id:null)&&(this._setupStencil(T,P,Q,E),f=E?E.id:null),l.renderLayer(l,E,Q,H)}this.renderedToTile?(T.dirty=!0,I.push(J.tileID)):v||--N,N===5&&(N=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,l.width,l.height]),Z.end+1}postRender(){}isLayerOrderingCorrect(a){let l=a.order.length,c=-1,m=l;for(let p=0;p<l;++p)this._style.isLayerDraped(a._mergedLayers[a.order[p]])?c=Math.max(c,p):m=Math.min(m,p);return m>c}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{a=Math.min(a,l.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,l,c){if(!this._visibleDemTiles)return null;let m=this._visibleDemTiles.filter(p=>p.dem).map(p=>{let Z=p.tileID,R=1<<Z.overscaledZ,{x:I,y:N}=Z.canonical,Y=I/R,J=(I+1)/R,M=N/R,T=(N+1)/R;return{minx:Y,miny:M,maxx:J,maxy:T,t:p.dem.tree.raycastRoot(Y,M,J,T,a,l,c),tile:p}});m.sort((p,Z)=>(p.t!==null?p.t:Number.MAX_VALUE)-(Z.t!==null?Z.t:Number.MAX_VALUE));for(let p of m){if(p.t==null)return null;let Z=p.tile.dem.tree.raycast(p.minx,p.miny,p.maxx,p.maxy,a,l,c);if(Z!=null)return Z}return null}_createFBO(){let a=this.painter.context,l=a.gl,c=this.drapeBufferSize;a.activeTexture.set(l.TEXTURE0);let m=new o.T(a,{width:c[0],height:c[1],data:null},l.RGBA);m.bind(l.LINEAR,l.CLAMP_TO_EDGE);let p=a.createFramebuffer(c[0],c[1],!0,null);return p.colorAttachment.set(m.texture),p.depthAttachment=new In(a,p.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,p.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):p.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:p,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let a in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{let l=this._style._mergedLayers[a],c=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!c&&l.shouldRedrape():!c&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(let c of this._style.getSources())if(c instanceof te){a=!0;break}if(!a)return;let l={};for(let c=0;c<this._style.order.length;++c){let m=this._style._mergedLayers[this._style.order[c]],p=this._style.getLayerSourceCache(m);if(p&&!l[p.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof o.Z){l[p.id]=!0;for(let Z of this.proxyCoords){let R=this.proxyToSource[Z.key][p.id];if(R)for(let I of R)this._clearRenderCacheForTile(p.id,I)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(let c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof ee){a=!0;break}if(!a)return;let l={};for(let c=0;c<this._style.order.length;++c){let m=this._style._mergedLayers[this._style.order[c]],p=this._style.getLayerSourceCache(m);if(!p||l[p.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;let Z=m.paint.get("raster-fade-duration");for(let R of this.proxyCoords){let I=this.proxyToSource[R.key][p.id];if(I)for(let N of I){let Y=Rb(p.getTile(N),p.findLoadedParent(N,0),p,this.painter.transform,Z);(Y.opacity!==1||Y.mix!==0)&&this._clearRenderCacheForTile(p.id,N)}}}}_setupDrapedRenderBatches(){let a=this._style.order,l=a.length;if(l===0)return;let c=[];this._pendingGroundEffectLayers=[];let m,p=0,Z=this._style._mergedLayers[a[p]];for(;!this._style.isLayerDraped(Z)&&Z.isHidden(this.painter.transform.zoom)&&++p<l;)Z=this._style._mergedLayers[a[p]];for(;p<l;++p){let R=this._style._mergedLayers[a[p]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?m===void 0&&(m=p):(R.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(p),m!==void 0&&(c.push({start:m,end:p-1}),m=void 0)))}if(m!==void 0&&c.push({start:m,end:p-1}),c.length!==0){let R=c[c.length-1];this._pendingGroundEffectLayers.every(I=>I>R.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(a){let l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){let Z=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let R=0;R<Z.length;++R){let I=Object.values(Z[R]);l.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();let c=this.proxyCoords,m=this._tilesDirty;for(let Z=c.length-1;Z>=0;Z--){let R=c[Z];if(l.getTileByID(R.key),l.proxyCachedFBO[R.key]!==void 0){let I=a[R.key],N=this.proxyToSource[R.key],Y=0;for(let J in N){let M=N[J],T=I[J];if(!T||T.length!==M.length||M.some((v,f)=>v!==T[f]||m[J]&&m[J].hasOwnProperty(v.key))){Y=-1;break}++Y}for(let J in l.proxyCachedFBO[R.key])l.renderCache[l.proxyCachedFBO[R.key][J]].dirty=Y<0||Y!==Object.values(I).length}}let p=[...this._drapedRenderBatches];p.sort((Z,R)=>R.end-R.start-(Z.end-Z.start));for(let Z of p)for(let R of c){if(l.proxyCachedFBO[R.key])continue;let I=l.renderCachePool.pop();I===void 0&&l.renderCache.length<50&&(I=l.renderCache.length,l.renderCache.push(this._createFBO())),I!==void 0&&(l.proxyCachedFBO[R.key]={},l.proxyCachedFBO[R.key][Z.start]=I,l.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(a,l,c,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let p=this.painter.context,Z=p.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let R;if(c.isTileClipped())R=l.length,this._overlapStencilMode.test={func:Z.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:Z.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(p.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):Ce.disabled}_renderTileClippingMasks(a,l){let c=this.painter,m=this.painter.context,p=m.gl;c._tileClippingMaskIDs={},m.setColorMode(Pe.disabled),m.setDepthMode(Ne.disabled);let Z=c.getOrCreateProgram("clippingMask");for(let R of a){let I=c._tileClippingMaskIDs[R.key]=--l;Z.draw(c,p.TRIANGLES,Ne.disabled,new Ce({func:p.ALWAYS,mask:0},I,255,p.KEEP,p.KEEP,p.REPLACE),Pe.disabled,Ye.disabled,Vb(R.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(a){let l=this.painter.transform;if(a.x<0||a.x>l.width||a.y<0||a.y>l.height)return null;let c=[a.x,a.y,1,1];o.a7.transformMat4(c,c,l.pixelMatrixInverse),o.a7.scale(c,c,1/c[3]),c[0]/=l.worldSize,c[1]/=l.worldSize;let m=l._camera.position,p=o.bl(1,l.center.lat),Z=[m[0],m[1],m[2]/p,0],R=o.N.subtract([],c.slice(0,3),Z);o.N.normalize(R,R);let I=this.raycast(Z,R,this._exaggeration);return I!==null&&I?(o.N.scaleAndAdd(Z,Z,R,I),Z[3]=Z[2],Z[2]*=p,Z):null}drawDepth(){let a=this.painter,l=a.context,c=this.proxySourceCache,m=Math.ceil(a.width),p=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===p||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let Z=l.gl,R=l.createFramebuffer(m,p,!0,"renderbuffer");l.activeTexture.set(Z.TEXTURE0);let I=new o.T(l,{width:m,height:p,data:null},Z.RGBA);I.bind(Z.NEAREST,Z.CLAMP_TO_EDGE),R.colorAttachment.set(I.texture);let N=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,m,p);R.depthAttachment.set(N),this._depthFBO=R,this._depthTexture=I}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,m,p]),function(Z,R,I,N){if(Z.transform.projection.name==="globe")return;let Y=Z.context,J=Y.gl;Y.clear({depth:1});let M=Z.getOrCreateProgram("terrainDepth"),T=new Ne(J.LESS,Ne.ReadWrite,Z.depthRangeFor3D);for(let v of N){let f=I.getTile(v),z=yd(v.projMatrix,0,[0,0,0]);R.setupElevationDraw(f,M),M.draw(Z,J.TRIANGLES,T,Ce.disabled,Pe.unblended,Ye.backCCW,z,"terrain_depth",R.gridBuffer,R.gridIndexBuffer,R.gridNoSkirtSegments)}}(a,this,c,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,l,c){if(a.getSource()instanceof o.ap)return this._setupProxiedCoordsForImageSource(a,l,c);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};let m=this.proxiedCoords[a.id]=[],p=this.proxyCoords;for(let I=0;I<p.length;I++){let N=p[I],Y=this._findTileCoveringTileID(N,a);if(Y){let J=this._createProxiedId(N,Y,c[N.key]&&c[N.key][a.id]);m.push(J),this.proxyToSource[N.key][a.id]=[J]}}let Z=!1,R=new Set;for(let I=0;I<l.length;I++){let N=a.getTile(l[I]);if(!N||!N.hasData())continue;let Y=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(Y&&Y.tileID.canonical.z!==N.tileID.canonical.z){let J=this.proxyToSource[Y.tileID.key][a.id],M=this._createProxiedId(Y.tileID,N,c[Y.tileID.key]&&c[Y.tileID.key][a.id]);J?J.splice(J.length-1,0,M):this.proxyToSource[Y.tileID.key][a.id]=[M];let T=this.proxyToSource[Y.tileID.key][a.id];R.has(T)||R.add(T),m.push(M),Z=!0}}if(this._sourceTilesOverlap[a.id]=Z,Z&&this._debugParams.sortTilesHiZFirst)for(let I of R)I.sort((N,Y)=>Y.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(a,l,c){if(!a.getSource().loaded())return;let m=this.proxiedCoords[a.id]=[],p=this.proxyCoords,Z=a.getSource(),R=Z.tileID;if(!R)return;let I=new o.P(R.x,R.y)._div(1<<R.z),N=Z.coordinates.map(o.L.fromLngLat).reduce((J,M)=>(J.min.x=Math.min(J.min.x,M.x-I.x),J.min.y=Math.min(J.min.y,M.y-I.y),J.max.x=Math.max(J.max.x,M.x-I.x),J.max.y=Math.max(J.max.y,M.y-I.y),J),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Y=(J,M)=>{let T=J.wrap+J.canonical.x/(1<<J.canonical.z),v=J.canonical.y/(1<<J.canonical.z),f=o.V/(1<<J.canonical.z),z=M.wrap+M.canonical.x/(1<<M.canonical.z),Q=M.canonical.y/(1<<M.canonical.z);return T+f<z+N.min.x||T>z+N.max.x||v+f<Q+N.min.y||v>Q+N.max.y};for(let J=0;J<p.length;J++){let M=p[J];for(let T=0;T<l.length;T++){let v=a.getTile(l[T]);if(!v||!v.hasData()||Y(M,v.tileID))continue;let f=this._createProxiedId(M,v,c[M.key]&&c[M.key][a.id]),z=this.proxyToSource[M.key][a.id];z?z.push(f):this.proxyToSource[M.key][a.id]=[f],m.push(f)}}}_createProxiedId(a,l,c){let m=this.orthoMatrix;if(c){let p=c.find(Z=>Z.key===l.tileID.key);if(p)return p}if(l.tileID.key!==a.key){let p=a.canonical.z-l.tileID.canonical.z,Z,R,I;m=o.a6.create();let N=l.tileID.wrap-a.wrap<<a.overscaledZ;p>0?(Z=o.V>>p,R=Z*((l.tileID.canonical.x<<p)-a.canonical.x+N),I=Z*((l.tileID.canonical.y<<p)-a.canonical.y)):(Z=o.V<<-p,R=o.V*(l.tileID.canonical.x-(a.canonical.x+N<<-p)),I=o.V*(l.tileID.canonical.y-(a.canonical.y<<-p))),o.a6.ortho(m,0,Z,0,Z,0,1),o.a6.translate(m,m,[R,I,0])}return new R0(l.tileID,a.key,m)}_findTileCoveringTileID(a,l){let c=l.getTile(a);if(c&&c.hasData())return c;let m=this._findCoveringTileCache[l.id],p=m[a.key];if(c=p?l.getTileByID(p):null,c&&c.hasData()||p===null)return c;let Z=c?c.tileID:a,R=Z.overscaledZ,I=l.getSource().minzoom,N=[];if(!p){let J=l.getSource().maxzoom;if(a.canonical.z>=J){let M=a.canonical.z-J;l.getSource().reparseOverscaled?(R=Math.max(a.canonical.z+2,l.transform.tileZoom),Z=new o.am(R,a.wrap,J,a.canonical.x>>M,a.canonical.y>>M)):M!==0&&(R=J,Z=new o.am(R,a.wrap,J,a.canonical.x>>M,a.canonical.y>>M))}Z.key!==a.key&&(N.push(Z.key),c=l.getTile(Z))}let Y=J=>{N.forEach(M=>{m[M]=J}),N.length=0};for(R-=1;R>=I&&(!c||!c.hasData());R--){c&&Y(c.tileID.key);let J=Z.calculateScaledKey(R);if(c=l.getTileByID(J),c&&c.hasData())break;let M=m[J];if(M===null)break;M===void 0?N.push(J):c=l.getTileByID(M)}return Y(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,l){let c=this._tilesDirty[a];c||(c=this._tilesDirty[a]={}),c[l.key]=!0}}function Gb(d,a,l){let c=function(R,I,N){let Y=o.N.dot(I,R),J=o.N.dot(N,[.2126,.7152,.0722]),M=(v,f,z)=>(1-z)*v+z*f,T=M(1-.3*Math.min(J,1),1,Math.min(Y+1,1));return M(.92,1,Math.asin(o.aa(I[2],-1,1))/Math.PI+.5)*T}(d,[0,0,1],a),m=[0,0,0];o.N.scale(m,l.slice(0,3),c);let p=[0,0,0];o.N.scale(p,a.slice(0,3),d[2]);let Z=[0,0,0];return o.N.add(Z,m,p),o.bU(Z)}let Fb=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],G0=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ib{static cacheKey(a,l,c,m){let p="".concat(l).concat(m?m.cacheKey:"");for(let Z of c)a.usedDefines.includes(Z)&&(p+="/".concat(Z));return p}constructor(a,l,c,m,p,Z,R){let I=a.gl;this.program=I.createProgram(),this.configuration=m,this.name=l,this.fixedDefines=[...Z];let N=m?m.getBinderAttributes():[],Y=(c.staticAttributes||[]).concat(N),J=m?m.defines():[];J=J.concat(Z.map(Q=>"#define ".concat(Q)));let M="#version 300 es\n",T=M+J.concat("precision mediump float;",Xd,hb.fragmentSource).join("\n");for(let Q of c.fragmentIncludes)T+="\n".concat(Cn[Q]);T+="\n".concat(c.fragmentSource);let v=M+J.concat("precision highp float;",Xd,hb.vertexSource).join("\n");for(let Q of c.vertexIncludes)v+="\n".concat(Cn[Q]);v+="\n".concat(c.vertexSource);let f=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(f,T),I.compileShader(f),I.attachShader(this.program,f);let z=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(z,v),I.compileShader(z),I.attachShader(this.program,z),this.attributes={},this.numAttributes=Y.length;for(let Q=0;Q<this.numAttributes;Q++)if(Y[Q]){let E=Y[Q].startsWith("a_")?Y[Q]:"a_".concat(Y[Q]);I.bindAttribLocation(this.program,Q,E),this.attributes[E]=Q}R&&R.shaderVaryings.length>0&&I.transformFeedbackVaryings(this.program,R.shaderVaryings,R.bufferMode),I.linkProgram(this.program),I.deleteShader(z),I.deleteShader(f),this.fixedUniforms=p(a),this.binderUniforms=m?m.getUniforms(a):[],Z.includes("TERRAIN")&&(this.terrainUniforms=(Q=>({u_dem:new o.bO(Q),u_dem_prev:new o.bO(Q),u_dem_tl:new o.bL(Q),u_dem_scale:new o.bN(Q),u_dem_tl_prev:new o.bL(Q),u_dem_scale_prev:new o.bN(Q),u_dem_size:new o.bN(Q),u_dem_lerp:new o.bN(Q),u_exaggeration:new o.bN(Q),u_depth:new o.bO(Q),u_depth_size_inv:new o.bL(Q),u_meter_to_dem:new o.bN(Q),u_label_plane_matrix_inv:new o.bK(Q)}))(a)),Z.includes("GLOBE")&&(this.globeUniforms=(Q=>({u_tile_tl_up:new o.bM(Q),u_tile_tr_up:new o.bM(Q),u_tile_br_up:new o.bM(Q),u_tile_bl_up:new o.bM(Q),u_tile_up_scale:new o.bN(Q)}))(a)),Z.includes("FOG")&&(this.fogUniforms=(Q=>({u_fog_matrix:new o.bK(Q),u_fog_range:new o.bL(Q),u_fog_color:new o.bP(Q),u_fog_horizon_blend:new o.bN(Q),u_fog_vertical_limit:new o.bL(Q),u_fog_temporal_offset:new o.bN(Q),u_frustum_tl:new o.bM(Q),u_frustum_tr:new o.bM(Q),u_frustum_br:new o.bM(Q),u_frustum_bl:new o.bM(Q),u_globe_pos:new o.bM(Q),u_globe_radius:new o.bN(Q),u_globe_transition:new o.bN(Q),u_is_globe:new o.bO(Q),u_viewport:new o.bL(Q)}))(a)),Z.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Q=>({u_cutoff_params:new o.bP(Q)}))(a)),Z.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Q=>({u_lighting_ambient_color:new o.bM(Q),u_lighting_directional_dir:new o.bM(Q),u_lighting_directional_color:new o.bM(Q),u_ground_radiance:new o.bM(Q)}))(a)),Z.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Q=>({u_light_matrix_0:new o.bK(Q),u_light_matrix_1:new o.bK(Q),u_fade_range:new o.bL(Q),u_shadow_normal_offset:new o.bM(Q),u_shadow_intensity:new o.bN(Q),u_shadow_texel_size:new o.bN(Q),u_shadow_map_resolution:new o.bN(Q),u_shadow_direction:new o.bM(Q),u_shadow_bias:new o.bM(Q),u_shadowmap_0:new o.bO(Q),u_shadowmap_1:new o.bO(Q)}))(a))}}setTerrainUniformValues(a,l){if(!this.terrainUniforms)return;let c=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let m in l)c[m]&&c[m].set(this.program,m,l[m])}}setGlobeUniformValues(a,l){if(!this.globeUniforms)return;let c=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let m in l)c[m]&&c[m].set(this.program,m,l[m])}}setFogUniformValues(a,l){if(!this.fogUniforms)return;let c=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let m in l)c[m].set(this.program,m,l[m])}}setCutoffUniformValues(a,l){if(!this.cutoffUniforms)return;let c=this.cutoffUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let m in l)c[m].set(this.program,m,l[m])}}setLightsUniformValues(a,l){if(!this.lightsUniforms)return;let c=this.lightsUniforms;if(!this.failedToCreate){a.program.set(this.program);for(let m in l)c[m].set(this.program,m,l[m])}}setShadowUniformValues(a,l){if(this.failedToCreate||!this.shadowUniforms)return;let c=this.shadowUniforms;a.program.set(this.program);for(let m in l)c[m].set(this.program,m,l[m])}_drawDebugWireframe(a,l,c,m,p,Z,R,I,N,Y){let J=a.options.wireframe;if(J.terrain===!1&&J.layers2D===!1&&J.layers3D===!1)return;let M=a.context;if(!(!(!J.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!J.layers2D||a._terrain&&a._terrain.renderingToTexture||!Fb.includes(this.name))||!(!J.layers3D||!G0.includes(this.name))))return;let T=M.gl,v=a.wireframeDebugCache.getLinesFromTrianglesBuffer(a.frameCounter,p,M);if(!v)return;let f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");let z=a.getOrCreateProgram(this.name,{config:this.configuration,defines:f});M.program.set(z.program);let Q=(H,K,w)=>{if(K[H]&&w[H])for(let q in K[H])w[H][q]&&w[H][q].set(w.program,q,K[H][q].current)};N&&N.setUniforms(z.program,M,z.binderUniforms,R,{zoom:I}),Q("fixedUniforms",this,z),Q("terrainUniforms",this,z),Q("globeUniforms",this,z),Q("fogUniforms",this,z),Q("lightsUniforms",this,z),Q("shadowUniforms",this,z),v.bind(),M.setColorMode(new Pe([T.ONE,T.ONE_MINUS_SRC_ALPHA,T.ZERO,T.ONE],o.ax.transparent,[!0,!0,!0,!1])),M.setDepthMode(new Ne(l.func===T.LESS?T.LEQUAL:l.func,Ne.ReadOnly,l.range)),M.setStencilMode(Ce.disabled);let E=3*Z.primitiveLength*2,P=3*Z.primitiveOffset*2*2;Y&&Y>1?T.drawElementsInstanced(T.LINES,E,T.UNSIGNED_SHORT,P,Y):T.drawElements(T.LINES,E,T.UNSIGNED_SHORT,P),p.bind(),M.program.set(this.program),M.setDepthMode(l),M.setStencilMode(c),M.setColorMode(m)}draw(a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q){let E=a.context,P=E.gl;if(this.failedToCreate)return;E.program.set(this.program),E.setDepthMode(c),E.setStencilMode(m),E.setColorMode(p),E.setCullFace(Z);for(let q of Object.keys(this.fixedUniforms))this.fixedUniforms[q].set(this.program,q,R[q]);v&&v.setUniforms(this.program,E,this.binderUniforms,M,{zoom:T});let H={[P.POINTS]:1,[P.LINES]:2,[P.TRIANGLES]:3,[P.LINE_STRIP]:1}[l],K=Q&&Q.length>0;if(K){for(let q of Q)P.bindBufferBase(P.TRANSFORM_FEEDBACK_BUFFER,q.targetIndex,q.buffer.buffer);P.beginTransformFeedback(l)}let w=z&&z>0?1:void 0;for(let q of J.get()){let it=q.vaos||(q.vaos={});(it[I]||(it[I]=new Wb)).bind(E,this,N,v?v.getPaintVertexBuffers():[],Y,q.vertexOffset,f||[],w),z&&z>1?P.drawElementsInstanced(l,q.primitiveLength*H,P.UNSIGNED_SHORT,q.primitiveOffset*H*2,z):Y?P.drawElements(l,q.primitiveLength*H,P.UNSIGNED_SHORT,q.primitiveOffset*H*2):P.drawArrays(l,q.vertexOffset,q.vertexLength),l===P.TRIANGLES&&Y&&this._drawDebugWireframe(a,c,m,p,Y,q,M,T,v,z)}K&&P.endTransformFeedback()}}function Ub(d,a){let l=Math.pow(2,a.tileID.overscaledZ),c=a.tileSize*Math.pow(2,d.transform.tileZoom)/l,m=c*(a.tileID.canonical.x+a.tileID.wrap*l),p=c*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.a3(a,1,d.transform.tileZoom),u_pixel_coord_upper:[m>>16,p>>16],u_pixel_coord_lower:[65535&m,65535&p]}}let F0=o.a6.create(),xb=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f)=>{let z=a.style.light,Q=z.properties.get("position"),E=[Q.x,Q.y,Q.z],P=o.co.create();z.properties.get("anchor")==="viewport"&&(o.co.fromRotation(P,-a.transform.angle),o.N.transformMat3(E,E,P));let H=z.properties.get("color"),K=a.transform,w={u_matrix:d,u_lightpos:E,u_lightintensity:z.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+l,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:F0,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:p,u_flood_light_color:J,u_vertical_scale:M,u_flood_light_intensity:T,u_ground_shadow_factor:v,u_emissive_strength:f};return K.projection.name==="globe"&&(w.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],w.u_zoom_transition=I,w.u_inv_rot_matrix=Y,w.u_merc_center=N,w.u_up_dir=K.projection.upVector(new o.bs(0,0,0),N[0]*o.V,N[1]*o.V),w.u_height_lift=R),w},Nb=(d,a,l)=>({u_matrix:d,u_edge_radius:a,u_vertical_scale:l}),To=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T)=>{let v=xb(d,a,l,c,m,p,Z,I,N,Y,J,M,T,1,[0,0,0],0),f={u_height_factor:-Math.pow(2,Z.overscaledZ)/R.tileSize/8};return o.e(v,Ub(a,R),f)},Gr=(d,a)=>({u_matrix:d,u_emissive_strength:a}),Yb=(d,a,l,c)=>o.e(Gr(d,a),Ub(l,c)),ko=(d,a,l)=>({u_matrix:d,u_world:l,u_emissive_strength:a}),I0=(d,a,l,c,m)=>o.e(Yb(d,a,l,c),{u_world:m}),Bd=(d,a,l,c)=>{let m=o.V/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:a.getCameraToCenterDistance(c),u_extrude_scale:[a.pixelsToGLUnits[0]/m,a.pixelsToGLUnits[1]/m]}},Xb=(d,a,l=1)=>({u_matrix:d,u_color:a,u_overlay:0,u_overlay_scale:l}),U0=o.a6.create(),Jb=(d,a,l,c,m,p,Z)=>{let R=d.transform,I=R.projection.name==="globe",N=I?o.cp(R.zoom,a.canonical)*R._pixelsPerMercatorPixel:o.a3(l,1,p),Y={u_matrix:a.projMatrix,u_extrude_scale:N,u_intensity:Z,u_inv_rot_matrix:U0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){Y.u_inv_rot_matrix=c,Y.u_merc_center=m,Y.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],Y.u_zoom_transition=o.S(R.zoom);let J=m[0]*o.V,M=m[1]*o.V;Y.u_up_dir=R.projection.upVector(new o.bs(0,0,0),J,M)}return Y};function Md(d,[a,l,c,m],[p,Z]){if(p===Z)return[0,0,0,0];let R=255*(d-1)/(d*(Z-p));return[a*R,l*R,c*R,m*R]}function x0(d,a,[l,c]){return l===c?0:.5/d+(a-l)*(d-1)/(d*(c-l))}let yb=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q,E,P,H)=>{return{u_matrix:d,u_normalize_matrix:a,u_globe_matrix:l,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:p,u_scale_parent:N,u_fade_t:Y.mix,u_opacity:Y.opacity*J.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:J.paint.get("raster-brightness-min"),u_brightness_high:J.paint.get("raster-brightness-max"),u_saturation_factor:(w=J.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(K=J.paint.get("raster-contrast"),K>0?1/(1-K):1+K),u_spin_weights:hs(J.paint.get("raster-hue-rotate")),u_perspective_transform:M,u_raster_elevation:T,u_zoom_transition:Z,u_merc_center:R,u_cutoff_params:I,u_colorization_mix:Md(o.cq,f,Q),u_colorization_offset:x0(o.cq,z,Q),u_color_ramp:v,u_texture_offset:[P/(E+2*P),E/(E+2*P)],u_texture_res:[E+2*P,E+2*P],u_emissive_strength:H};var K,w};function hs(d){d*=Math.PI/180;let a=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*a-l+1)/3,(Math.sqrt(3)*a-l+1)/3]}let _p=(d,a,l,c,m,p,Z,R,I,N,Y,J)=>({u_matrix:d,u_normalize_matrix:a,u_globe_matrix:l,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:p,u_scale_parent:N,u_fade_t:Y.mix,u_opacity:Y.opacity,u_image0:0,u_image1:1,u_raster_elevation:J,u_zoom_transition:Z,u_merc_center:R,u_cutoff_params:I}),Pp=(d,a,l,c,m,p,Z,R)=>({u_tile_offset:d,u_velocity:a,u_color_ramp:c,u_velocity_res:l,u_max_speed:m,u_texture_offset:p,u_data_scale:Z,u_data_offset:R}),N0=(d,a,l,c,m,p,Z,R)=>({u_velocity:d,u_velocity_res:a,u_max_speed:l,u_speed_factor:c,u_lifetime_delta:m,u_rand_seed:Math.random(),u_texture_offset:p,u_data_scale:Z,u_data_offset:R}),Y0=o.a6.create(),Cd=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q)=>{let E=m.transform,P={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:E.getCameraToCenterDistance(f),u_rotate_symbol:+l,u_aspect_ratio:E.width/E.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:p,u_label_plane_matrix:Z,u_coord_matrix:R,u_is_text:+I,u_pitch_with_map:+c,u_texsize:N,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Y0,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Y0,u_up_vector:[0,-1,0],u_icon_transition:Q||0,u_icon_saturation:z};return f.name==="globe"&&(P.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],P.u_zoom_transition=J,P.u_inv_rot_matrix=T,P.u_merc_center=M,P.u_camera_forward=E._camera.forward(),P.u_ecef_origin=o.cr(E.globeMatrix,Y.toUnwrapped()),P.u_tile_matrix=Float32Array.from(E.globeMatrix),P.u_up_vector=v),P},ps=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z)=>o.e(Cd(d,a,l,c,m,p,Z,R,I,N,J,M,T,v,f,z,1),{u_gamma_scale:c?m.transform.getCameraToCenterDistance(z)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.f.devicePixelRatio,u_is_halo:+Y,undefined:void 0}),Td=(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f)=>o.e(ps(d,a,l,c,m,p,Z,R,!0,I,!0,Y,J,M,T,v,f),{u_texsize_icon:N,u_texture_icon:1}),Bb=(d,a,l,c)=>({u_matrix:d,u_emissive_strength:a,u_opacity:l,u_color:c}),Ws=(d,a,l,c,m,p,Z)=>o.e(function(R,I,N,Y){let J=N.imageManager.getPattern(R.toString(),I),{width:M,height:T}=N.imageManager.getPixelSize(I),v=Math.pow(2,Y.tileID.overscaledZ),f=Y.tileSize*Math.pow(2,N.transform.tileZoom)/v,z=f*(Y.tileID.canonical.x+Y.tileID.wrap*v),Q=f*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:J.tl,u_pattern_br:J.br,u_texsize:[M,T],u_pattern_size:J.displaySize,u_tile_units_to_pixels:1/o.a3(Y,1,N.transform.tileZoom),u_pixel_coord_upper:[z>>16,Q>>16],u_pixel_coord_lower:[65535&z,65535&Q]}}(m,p,c,Z),{u_matrix:d,u_emissive_strength:a,u_opacity:l}),kd=(d,a,l,c,m,p,Z,R,I,N,Y,J,M=[0,0,0],T)=>{let v=c.style.light,f=v.properties.get("position"),z=[-f.x,-f.y,f.z],Q=o.co.create();v.properties.get("anchor")==="viewport"&&(o.co.fromRotation(Q,-c.transform.angle),o.N.transformMat3(z,z,Q));let E=N.alphaMode==="MASK",P=v.properties.get("color"),H=J.paint.get("model-ambient-occlusion-intensity"),K=J.paint.get("model-color").constantOr(o.ax.white),w=J.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:a,u_normal_matrix:l,u_lightpos:z,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_camera_pos:M,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+E,u_alphaCutoff:N.alphaCutoff,u_baseColorFactor:[p.r,p.g,p.b,p.a],u_emissiveFactor:[Z[0],Z[1],Z[2],1],u_metallicFactor:R,u_roughnessFactor:I,u_baseColorTexture:Pa.BaseColor,u_metallicRoughnessTexture:Pa.MetallicRoughness,u_normalTexture:Pa.Normal,u_occlusionTexture:Pa.Occlusion,u_emissionTexture:Pa.Emission,u_color_mix:[K.r,K.g,K.b,w],u_aoIntensity:H,u_emissive_strength:Y,u_occlusionTextureTransform:T||[0,0,0,0]}},us=new Float32Array(16),Zs=(d,a=us,l=us)=>({u_matrix:d,u_instance:a,u_node_matrix:l}),Kp={fillExtrusion:d=>({u_matrix:new o.bK(d),u_lightpos:new o.bM(d),u_lightintensity:new o.bN(d),u_lightcolor:new o.bM(d),u_vertical_gradient:new o.bN(d),u_opacity:new o.bN(d),u_edge_radius:new o.bN(d),u_ao:new o.bL(d),u_tile_id:new o.bM(d),u_zoom_transition:new o.bN(d),u_inv_rot_matrix:new o.bK(d),u_merc_center:new o.bL(d),u_up_dir:new o.bM(d),u_height_lift:new o.bN(d),u_flood_light_color:new o.bM(d),u_vertical_scale:new o.bN(d),u_flood_light_intensity:new o.bN(d),u_ground_shadow_factor:new o.bM(d),u_emissive_strength:new o.bN(d)}),fillExtrusionDepth:d=>({u_matrix:new o.bK(d),u_edge_radius:new o.bN(d),u_vertical_scale:new o.bN(d)}),fillExtrusionPattern:d=>({u_matrix:new o.bK(d),u_lightpos:new o.bM(d),u_lightintensity:new o.bN(d),u_lightcolor:new o.bM(d),u_vertical_gradient:new o.bN(d),u_height_factor:new o.bN(d),u_edge_radius:new o.bN(d),u_ao:new o.bL(d),u_tile_id:new o.bM(d),u_zoom_transition:new o.bN(d),u_inv_rot_matrix:new o.bK(d),u_merc_center:new o.bL(d),u_up_dir:new o.bM(d),u_height_lift:new o.bN(d),u_image:new o.bO(d),u_texsize:new o.bL(d),u_pixel_coord_upper:new o.bL(d),u_pixel_coord_lower:new o.bL(d),u_tile_units_to_pixels:new o.bN(d),u_opacity:new o.bN(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new o.bK(d),u_opacity:new o.bN(d),u_ao_pass:new o.bN(d),u_meter_to_tile:new o.bN(d),u_ao:new o.bL(d),u_flood_light_intensity:new o.bN(d),u_flood_light_color:new o.bM(d),u_attenuation:new o.bN(d),u_edge_radius:new o.bN(d),u_fb:new o.bO(d),u_fb_size:new o.bN(d)}),fill:d=>({u_matrix:new o.bK(d),u_emissive_strength:new o.bN(d)}),fillPattern:d=>({u_matrix:new o.bK(d),u_emissive_strength:new o.bN(d),u_image:new o.bO(d),u_texsize:new o.bL(d),u_pixel_coord_upper:new o.bL(d),u_pixel_coord_lower:new o.bL(d),u_tile_units_to_pixels:new o.bN(d)}),fillOutline:d=>({u_matrix:new o.bK(d),u_emissive_strength:new o.bN(d),u_world:new o.bL(d)}),fillOutlinePattern:d=>({u_matrix:new o.bK(d),u_emissive_strength:new o.bN(d),u_world:new o.bL(d),u_image:new o.bO(d),u_texsize:new o.bL(d),u_pixel_coord_upper:new o.bL(d),u_pixel_coord_lower:new o.bL(d),u_tile_units_to_pixels:new o.bN(d)}),circle:o.cs,collisionBox:d=>({u_matrix:new o.bK(d),u_camera_to_center_distance:new o.bN(d),u_extrude_scale:new o.bL(d)}),collisionCircle:d=>({u_matrix:new o.bK(d),u_inv_matrix:new o.bK(d),u_camera_to_center_distance:new o.bN(d),u_viewport_size:new o.bL(d)}),debug:d=>({u_color:new o.ca(d),u_matrix:new o.bK(d),u_overlay:new o.bO(d),u_overlay_scale:new o.bN(d)}),clippingMask:d=>({u_matrix:new o.bK(d)}),heatmap:d=>({u_extrude_scale:new o.bN(d),u_intensity:new o.bN(d),u_matrix:new o.bK(d),u_inv_rot_matrix:new o.bK(d),u_merc_center:new o.bL(d),u_tile_id:new o.bM(d),u_zoom_transition:new o.bN(d),u_up_dir:new o.bM(d)}),heatmapTexture:d=>({u_image:new o.bO(d),u_color_ramp:new o.bO(d),u_opacity:new o.bN(d)}),hillshade:d=>({u_matrix:new o.bK(d),u_image:new o.bO(d),u_latrange:new o.bL(d),u_light:new o.bL(d),u_shadow:new o.ca(d),u_highlight:new o.ca(d),u_emissive_strength:new o.bN(d),u_accent:new o.ca(d)}),hillshadePrepare:d=>({u_matrix:new o.bK(d),u_image:new o.bO(d),u_dimension:new o.bL(d),u_zoom:new o.bN(d)}),line:o.ct,linePattern:o.cu,raster:d=>({u_matrix:new o.bK(d),u_normalize_matrix:new o.bK(d),u_globe_matrix:new o.bK(d),u_merc_matrix:new o.bK(d),u_grid_matrix:new o.cb(d),u_tl_parent:new o.bL(d),u_scale_parent:new o.bN(d),u_fade_t:new o.bN(d),u_opacity:new o.bN(d),u_image0:new o.bO(d),u_image1:new o.bO(d),u_brightness_low:new o.bN(d),u_brightness_high:new o.bN(d),u_saturation_factor:new o.bN(d),u_contrast_factor:new o.bN(d),u_spin_weights:new o.bM(d),u_perspective_transform:new o.bL(d),u_raster_elevation:new o.bN(d),u_zoom_transition:new o.bN(d),u_merc_center:new o.bL(d),u_cutoff_params:new o.bP(d),u_colorization_mix:new o.bP(d),u_colorization_offset:new o.bN(d),u_color_ramp:new o.bO(d),u_texture_offset:new o.bL(d),u_texture_res:new o.bL(d),u_emissive_strength:new o.bN(d)}),rasterParticle:d=>({u_matrix:new o.bK(d),u_normalize_matrix:new o.bK(d),u_globe_matrix:new o.bK(d),u_merc_matrix:new o.bK(d),u_grid_matrix:new o.cb(d),u_tl_parent:new o.bL(d),u_scale_parent:new o.bN(d),u_fade_t:new o.bN(d),u_opacity:new o.bN(d),u_image0:new o.bO(d),u_image1:new o.bO(d),u_raster_elevation:new o.bN(d),u_zoom_transition:new o.bN(d),u_merc_center:new o.bL(d),u_cutoff_params:new o.bP(d)}),rasterParticleTexture:d=>({u_texture:new o.bO(d),u_opacity:new o.bN(d)}),rasterParticleDraw:d=>({u_tile_offset:new o.bL(d),u_velocity:new o.bO(d),u_color_ramp:new o.bO(d),u_velocity_res:new o.bL(d),u_max_speed:new o.bN(d),u_texture_offset:new o.bL(d),u_data_scale:new o.bP(d),u_data_offset:new o.bN(d)}),rasterParticleUpdate:d=>({u_velocity:new o.bO(d),u_velocity_res:new o.bL(d),u_max_speed:new o.bN(d),u_speed_factor:new o.bN(d),u_lifetime_delta:new o.bN(d),u_rand_seed:new o.bN(d),u_texture_offset:new o.bL(d),u_data_scale:new o.bP(d),u_data_offset:new o.bN(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new o.bO(d),u_is_size_feature_constant:new o.bO(d),u_size_t:new o.bN(d),u_size:new o.bN(d),u_camera_to_center_distance:new o.bN(d),u_rotate_symbol:new o.bO(d),u_aspect_ratio:new o.bN(d),u_fade_change:new o.bN(d),u_matrix:new o.bK(d),u_label_plane_matrix:new o.bK(d),u_coord_matrix:new o.bK(d),u_is_text:new o.bO(d),u_pitch_with_map:new o.bO(d),u_texsize:new o.bL(d),u_tile_id:new o.bM(d),u_zoom_transition:new o.bN(d),u_inv_rot_matrix:new o.bK(d),u_merc_center:new o.bL(d),u_camera_forward:new o.bM(d),u_tile_matrix:new o.bK(d),u_up_vector:new o.bM(d),u_ecef_origin:new o.bM(d),u_texture:new o.bO(d),u_icon_transition:new o.bN(d),u_icon_saturation:new o.bN(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new o.bO(d),u_is_size_feature_constant:new o.bO(d),u_size_t:new o.bN(d),u_size:new o.bN(d),u_camera_to_center_distance:new o.bN(d),u_rotate_symbol:new o.bO(d),u_aspect_ratio:new o.bN(d),u_fade_change:new o.bN(d),u_matrix:new o.bK(d),u_label_plane_matrix:new o.bK(d),u_coord_matrix:new o.bK(d),u_is_text:new o.bO(d),u_pitch_with_map:new o.bO(d),u_texsize:new o.bL(d),u_texture:new o.bO(d),u_gamma_scale:new o.bN(d),u_device_pixel_ratio:new o.bN(d),u_tile_id:new o.bM(d),u_zoom_transition:new o.bN(d),u_inv_rot_matrix:new o.bK(d),u_merc_center:new o.bL(d),u_camera_forward:new o.bM(d),u_tile_matrix:new o.bK(d),u_up_vector:new o.bM(d),u_ecef_origin:new o.bM(d),u_is_halo:new o.bO(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new o.bO(d),u_is_size_feature_constant:new o.bO(d),u_size_t:new o.bN(d),u_size:new o.bN(d),u_camera_to_center_distance:new o.bN(d),u_rotate_symbol:new o.bO(d),u_aspect_ratio:new o.bN(d),u_fade_change:new o.bN(d),u_matrix:new o.bK(d),u_label_plane_matrix:new o.bK(d),u_coord_matrix:new o.bK(d),u_is_text:new o.bO(d),u_pitch_with_map:new o.bO(d),u_texsize:new o.bL(d),u_texsize_icon:new o.bL(d),u_texture:new o.bO(d),u_texture_icon:new o.bO(d),u_gamma_scale:new o.bN(d),u_device_pixel_ratio:new o.bN(d),u_is_halo:new o.bO(d)}),background:d=>({u_matrix:new o.bK(d),u_emissive_strength:new o.bN(d),u_opacity:new o.bN(d),u_color:new o.ca(d)}),backgroundPattern:d=>({u_matrix:new o.bK(d),u_emissive_strength:new o.bN(d),u_opacity:new o.bN(d),u_image:new o.bO(d),u_pattern_tl:new o.bL(d),u_pattern_br:new o.bL(d),u_texsize:new o.bL(d),u_pattern_size:new o.bL(d),u_pixel_coord_upper:new o.bL(d),u_pixel_coord_lower:new o.bL(d),u_tile_units_to_pixels:new o.bN(d)}),terrainRaster:g0,terrainDepth:g0,skybox:d=>({u_matrix:new o.bK(d),u_sun_direction:new o.bM(d),u_cubemap:new o.bO(d),u_opacity:new o.bN(d),u_temporal_offset:new o.bN(d)}),skyboxGradient:d=>({u_matrix:new o.bK(d),u_color_ramp:new o.bO(d),u_center_direction:new o.bM(d),u_radius:new o.bN(d),u_opacity:new o.bN(d),u_temporal_offset:new o.bN(d)}),skyboxCapture:d=>({u_matrix_3f:new o.cb(d),u_sun_direction:new o.bM(d),u_sun_intensity:new o.bN(d),u_color_tint_r:new o.bP(d),u_color_tint_m:new o.bP(d),u_luminance:new o.bN(d)}),globeRaster:d=>({u_proj_matrix:new o.bK(d),u_globe_matrix:new o.bK(d),u_normalize_matrix:new o.bK(d),u_merc_matrix:new o.bK(d),u_zoom_transition:new o.bN(d),u_merc_center:new o.bL(d),u_image0:new o.bO(d),u_grid_matrix:new o.cb(d),u_skirt_height:new o.bN(d),u_far_z_cutoff:new o.bN(d),u_frustum_tl:new o.bM(d),u_frustum_tr:new o.bM(d),u_frustum_br:new o.bM(d),u_frustum_bl:new o.bM(d),u_globe_pos:new o.bM(d),u_globe_radius:new o.bN(d),u_viewport:new o.bL(d)}),globeAtmosphere:d=>({u_frustum_tl:new o.bM(d),u_frustum_tr:new o.bM(d),u_frustum_br:new o.bM(d),u_frustum_bl:new o.bM(d),u_horizon:new o.bN(d),u_transition:new o.bN(d),u_fadeout_range:new o.bN(d),u_color:new o.bP(d),u_high_color:new o.bP(d),u_space_color:new o.bP(d),u_temporal_offset:new o.bN(d),u_horizon_angle:new o.bN(d)}),model:d=>({u_matrix:new o.bK(d),u_lighting_matrix:new o.bK(d),u_normal_matrix:new o.bK(d),u_lightpos:new o.bM(d),u_lightintensity:new o.bN(d),u_lightcolor:new o.bM(d),u_camera_pos:new o.bM(d),u_opacity:new o.bN(d),u_baseColorFactor:new o.bP(d),u_emissiveFactor:new o.bP(d),u_metallicFactor:new o.bN(d),u_roughnessFactor:new o.bN(d),u_baseTextureIsAlpha:new o.bO(d),u_alphaMask:new o.bO(d),u_alphaCutoff:new o.bN(d),u_baseColorTexture:new o.bO(d),u_metallicRoughnessTexture:new o.bO(d),u_normalTexture:new o.bO(d),u_occlusionTexture:new o.bO(d),u_emissionTexture:new o.bO(d),u_color_mix:new o.bP(d),u_aoIntensity:new o.bN(d),u_emissive_strength:new o.bN(d),u_occlusionTextureTransform:new o.bP(d)}),modelDepth:d=>({u_matrix:new o.bK(d),u_instance:new o.bK(d),u_node_matrix:new o.bK(d)}),groundShadow:d=>({u_matrix:new o.bK(d),u_ground_shadow_factor:new o.bM(d)}),stars:d=>({u_matrix:new o.bK(d),u_up:new o.bM(d),u_right:new o.bM(d),u_intensity_multiplier:new o.bN(d)})},ol;function rl(d,a,l,c,m,p,Z){let R=d.context,I=R.gl,N=d.transform,Y=d.getOrCreateProgram("collisionBox"),J=[],M=0,T=0;for(let H=0;H<c.length;H++){let K=c[H],w=a.getTile(K),q=w.getBucket(l);if(!q)continue;let it=qc(K,q,N),at=it;m[0]===0&&m[1]===0||(at=d.translatePosMatrix(it,w,m,p));let rt=Z?q.textCollisionBox:q.iconCollisionBox,Zt=q.collisionCircleArray;if(Zt.length>0){let bt=o.a6.create(),It=at;o.a6.mul(bt,q.placementInvProjMatrix,N.glCoordMatrix),o.a6.mul(bt,bt,q.placementViewportMatrix),J.push({circleArray:Zt,circleOffset:T,transform:It,invTransform:bt,projection:q.getProjection()}),M+=Zt.length/4,T=M}rt&&(d.terrain&&d.terrain.setupElevationDraw(w,Y),Y.draw(d,I.LINES,Ne.disabled,Ce.disabled,d.colorModeForRenderPass(),Ye.disabled,Bd(at,N,w,q.getProjection()),l.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,N.zoom,null,[rt.collisionVertexBuffer,rt.collisionVertexBufferExt]))}if(!Z||!J.length)return;let v=d.getOrCreateProgram("collisionCircle"),f=new o.cv;f.resize(4*M),f._trim();let z=0;for(let H of J)for(let K=0;K<H.circleArray.length/4;K++){let w=4*K,q=H.circleArray[w+0],it=H.circleArray[w+1],at=H.circleArray[w+2],rt=H.circleArray[w+3];f.emplace(z++,q,it,at,rt,0),f.emplace(z++,q,it,at,rt,1),f.emplace(z++,q,it,at,rt,2),f.emplace(z++,q,it,at,rt,3)}(!ol||ol.length<2*M)&&(ol=function(H){let K=2*H,w=new o.aw;w.resize(K),w._trim();for(let q=0;q<K;q++){let it=6*q;w.uint16[it+0]=4*q+0,w.uint16[it+1]=4*q+1,w.uint16[it+2]=4*q+2,w.uint16[it+3]=4*q+2,w.uint16[it+4]=4*q+3,w.uint16[it+5]=4*q+0}return w}(M));let Q=R.createIndexBuffer(ol,!0),E=R.createVertexBuffer(f,o.cw.members,!0);for(let H of J){let K={u_matrix:H.transform,u_inv_matrix:H.invTransform,u_camera_to_center_distance:(P=N).getCameraToCenterDistance(H.projection),u_viewport_size:[P.width,P.height]};v.draw(d,I.TRIANGLES,Ne.disabled,Ce.disabled,d.colorModeForRenderPass(),Ye.disabled,K,l.id,E,Q,o.aB.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,N.zoom)}var P;E.destroy(),Q.destroy()}let kl=o.a6.create();function gs(d){let a=d._camera.getWorldToCamera(d.worldSize,1),l=o.a6.multiply([],a,d.globeMatrix);o.a6.invert(l,l);let c=[0,0,0],m=[0,1,0,0];return o.a7.transformMat4(m,m,l),c[0]=m[0],c[1]=m[1],c[2]=m[2],o.N.normalize(c,c),c}function se({width:d,height:a,anchor:l,textOffset:c,textScale:m},p){let{horizontalAlign:Z,verticalAlign:R}=o.bf(l),I=-(Z-.5)*d,N=-(R-.5)*a,Y=o.bd(l,c);return new o.P((I/m+Y[0])*p,(N/m+Y[1])*p)}function X0(d,a,l,c,m,p,Z,R,I,N,Y){let J=d.text.placedSymbolArray,M=d.text.dynamicLayoutVertexArray,T=d.icon.dynamicLayoutVertexArray,v={},f=d.getProjection(),z=ns(R,f,p),Q=p.elevation,E=f.upVectorScale(R.canonical,p.center.lat,p.worldSize).metersToTile;M.clear();for(let P=0;P<J.length;P++){let H=J.get(P),{tileAnchorX:K,tileAnchorY:w,numGlyphs:q}=H,it=H.hidden||!H.crossTileID||d.allowVerticalPlacement&&!H.placedOrientation?null:c[H.crossTileID];if(it){let at=0,rt=0,Zt=0;if(Q){let ft=Q?Q.getAtTileOffset(R,K,w):0,[At,Et,$t]=f.upVector(R.canonical,K,w);at=ft*At*E,rt=ft*Et*E,Zt=ft*$t*E}let[bt,It,Gt,St]=Hn(H.projectedAnchorX+at,H.projectedAnchorY+rt,H.projectedAnchorZ+Zt,l?z:Z),mt=r0(p.getCameraToCenterDistance(f),St),Vt=m.evaluateSizeForFeature(d.textSizeData,N,H)*mt/o.bc;l&&(Vt*=d.tilePixelRatio/I);let ot=se(it,Vt);l?({x:bt,y:It,z:Gt}=f.projectTilePoint(K+ot.x,w+ot.y,R.canonical),[bt,It,Gt]=Hn(bt+at,It+rt,Gt+Zt,Z)):(a&&ot._rotate(-p.angle),bt+=ot.x,It+=ot.y,Gt=0);let Wt=d.allowVerticalPlacement&&H.placedOrientation===o.b6.vertical?Math.PI/2:0;for(let ft=0;ft<q;ft++)o.b9(M,bt,It,Gt,Wt);Y&&H.associatedIconIndex>=0&&(v[H.associatedIconIndex]={x:bt,y:It,z:Gt,angle:Wt})}else no(q,M)}if(Y){T.clear();let P=d.icon.placedSymbolArray;for(let H=0;H<P.length;H++){let K=P.get(H),{numGlyphs:w}=K,q=v[H];if(K.hidden||!q)no(w,T);else{let{x:it,y:at,z:rt,angle:Zt}=q;for(let bt=0;bt<w;bt++)o.b9(T,it,at,rt,Zt)}}d.icon.dynamicLayoutVertexBuffer.updateData(T)}d.text.dynamicLayoutVertexBuffer.updateData(M)}function Qd(d,a,l,c,m,p,Z={}){let R=l.paint.get("icon-translate"),I=l.paint.get("text-translate"),N=l.paint.get("icon-translate-anchor"),Y=l.paint.get("text-translate-anchor"),J=l.layout.get("icon-rotation-alignment"),M=l.layout.get("text-rotation-alignment"),T=l.layout.get("icon-pitch-alignment"),v=l.layout.get("text-pitch-alignment"),f=l.layout.get("icon-keep-upright"),z=l.layout.get("text-keep-upright"),Q=l.paint.get("icon-color-saturation"),E=d.context,P=E.gl,H=d.transform,K=J==="map",w=M==="map",q=T==="map",it=v==="map",at=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,rt=!1,Zt=d.depthModeForSublayer(0,Ne.ReadOnly),bt=[o.a5(H.center.lng),o.ae(H.center.lat)],It=l.layout.get("text-variable-anchor"),Gt=H.projection.name==="globe",St=[],mt=[0,-1,0];for(let Vt of c){let ot=a.getTile(Vt),Wt=ot.getBucket(l);if(!Wt||Wt.projection.name==="mercator"&&Gt||Wt.fullyClipped)continue;let ft=Wt.projection.name==="globe",At=ft?o.S(H.zoom):0,Et=ns(Vt,Wt.getProjection(),H),$t=H.calculatePixelsToTileUnitsMatrix(ot),me=It&&Wt.hasTextData(),Ie=Wt.hasIconTextFit()&&me&&Wt.hasIconData(),ue=Wt.getProjection().createInversionMatrix(H,Vt.canonical),Re=()=>{let ia=K&&l.layout.get("symbol-placement")!=="point",ti=[],pi=ia||Ie,ei=l.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&q&&ti.push("PITCH_WITH_MAP_TERRAIN"),ft&&(ti.push("PROJECTION_GLOBE_VIEW"),pi&&ti.push("PROJECTED_POS_ON_VIEWPORT")),ei>0&&ti.push("ICON_TRANSITION"),Wt.icon.zOffsetVertexBuffer&&ti.push("Z_OFFSET"),Q<1&&ti.push("SATURATION");let mi=Wt.icon.programConfigurations.get(l.id),Ei=d.getOrCreateProgram(Wt.sdfIcons?"symbolSDF":"symbolIcon",{config:mi,defines:ti}),Ri,Sa=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],Ka=Wt.iconSizeData,Nn=o.b5(Ka,H.zoom),Fl=q||H.pitch!==0,Yn=is(Et,ot.tileID.canonical,q,K,H,Wt.getProjection(),$t),fa=Hc(Et,ot.tileID.canonical,q,K,H,Wt.getProjection(),$t),xa=d.translatePosMatrix(fa,ot,R,N,!0),dn=d.translatePosMatrix(Et,ot,R,N),un=pi?kl:Yn,Xn=K&&!q&&!ia,Il=mt;!Gt&&!H.mercatorFromTransition||K||(Il=gs(H));let go=ft?Il:mt;Ri=Wt.sdfIcons&&!Wt.iconsInText?ps(Ka.kind,Nn,Xn,q,d,dn,un,xa,!1,Sa,!0,Vt,At,bt,ue,go,Wt.getProjection()):Cd(Ka.kind,Nn,Xn,q,d,dn,un,xa,!1,Sa,Vt,At,bt,ue,go,Wt.getProjection(),Q,ei);let Lo=ot.imageAtlasTexture?ot.imageAtlasTexture:null,Ss=l.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear,fs=Wt.sdfIcons||d.options.rotating||d.options.zooming||Ss||Fl?P.LINEAR:P.NEAREST,rm=Wt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,vs=d.terrain&&q&&ia?o.a6.invert(o.a6.create(),Yn):kl;if(ia&&Wt.icon){let Nr=H.elevation,jd=Nr?Nr.getAtTileOffsetFunc(Vt,H.center.lat,H.worldSize,Wt.getProjection()):null,vl=Ac(Et,ot.tileID.canonical,q,K,H,Wt.getProjection(),$t);Oc(Wt,Et,d,!1,vl,fa,q,f,jd,Vt)}return{program:Ei,buffers:Wt.icon,uniformValues:Ri,atlasTexture:Lo,atlasTextureIcon:null,atlasInterpolation:fs,atlasInterpolationIcon:null,isSDF:Wt.sdfIcons,hasHalo:rm,tile:ot,labelPlaneMatrixInv:vs}},Ae=()=>{let ia=w&&l.layout.get("symbol-placement")!=="point",ti=[],pi=ia||It||Ie;d.terrainRenderModeElevated()&&it&&ti.push("PITCH_WITH_MAP_TERRAIN"),ft&&(ti.push("PROJECTION_GLOBE_VIEW"),pi&&ti.push("PROJECTED_POS_ON_VIEWPORT")),Wt.text.zOffsetVertexBuffer&&ti.push("Z_OFFSET");let ei=Wt.text.programConfigurations.get(l.id),mi=d.getOrCreateProgram(Wt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:ei,defines:ti}),Ei,Ri=[0,0],Sa=null,Ka=Wt.textSizeData;Wt.iconsInText&&(Ri=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],Sa=ot.imageAtlasTexture?ot.imageAtlasTexture:null,Ei=it||H.pitch!==0||d.options.rotating||d.options.zooming||Ka.kind==="composite"||Ka.kind==="camera"?P.LINEAR:P.NEAREST);let Nn=ot.glyphAtlasTexture?ot.glyphAtlasTexture.size:[0,0],Fl=o.b5(Ka,H.zoom),Yn=is(Et,ot.tileID.canonical,it,w,H,Wt.getProjection(),$t),fa=Hc(Et,ot.tileID.canonical,it,w,H,Wt.getProjection(),$t),xa=d.translatePosMatrix(fa,ot,I,Y,!0),dn=d.translatePosMatrix(Et,ot,I,Y),un=pi?kl:Yn,Xn=w&&!it&&!ia,Il=mt;!Gt&&!H.mercatorFromTransition||w||(Il=gs(H));let go=ft?Il:mt,Lo;Lo=Wt.iconsInText?Td(Ka.kind,Fl,Xn,it,d,dn,un,xa,Nn,Ri,Vt,At,bt,ue,go,Wt.getProjection()):ps(Ka.kind,Fl,Xn,it,d,dn,un,xa,!0,Nn,!0,Vt,At,bt,ue,go,Wt.getProjection());let Ss=ot.glyphAtlasTexture?ot.glyphAtlasTexture:null,fs=P.LINEAR,rm=l.paint.get("text-halo-width").constantOr(1)!==0,vs=d.terrain&&it&&ia?o.a6.invert(o.a6.create(),Yn):kl;if(ia&&Wt.text){let Nr=H.elevation,jd=Nr?Nr.getAtTileOffsetFunc(Vt,H.center.lat,H.worldSize,Wt.getProjection()):null,vl=Ac(Et,ot.tileID.canonical,it,w,H,Wt.getProjection(),$t);Oc(Wt,Et,d,!0,vl,fa,it,z,jd,Vt)}return{program:mi,buffers:Wt.text,uniformValues:Lo,atlasTexture:Ss,atlasTextureIcon:Sa,atlasInterpolation:fs,atlasInterpolationIcon:Ei,isSDF:!0,hasHalo:rm,tile:ot,labelPlaneMatrixInv:vs}},Me=Wt.icon.segments.get().length,fe=Wt.text.segments.get().length,Qe=Me&&!Z.onlyText?Re():null,si=fe&&!Z.onlyIcons?Ae():null,fi=l.paint.get("icon-opacity").constantOr(1),$e=l.paint.get("text-opacity").constantOr(1);if(at&&Wt.canOverlap){rt=!0;let ia=fi&&!Z.onlyText?Wt.icon.segments.get():[],ti=$e&&!Z.onlyIcons?Wt.text.segments.get():[];for(let pi of ia)St.push({segments:new o.aB([pi]),sortKey:pi.sortKey,state:Qe});for(let pi of ti)St.push({segments:new o.aB([pi]),sortKey:pi.sortKey,state:si})}else Z.onlyText||St.push({segments:fi?Wt.icon.segments:new o.aB([]),sortKey:0,state:Qe}),Z.onlyIcons||St.push({segments:$e?Wt.text.segments:new o.aB([]),sortKey:0,state:si})}rt&&St.sort((Vt,ot)=>Vt.sortKey-ot.sortKey);for(let Vt of St){let ot=Vt.state;if(ot)if(d.terrain&&d.terrain.setupElevationDraw(ot.tile,ot.program,{useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ot.labelPlaneMatrixInv}),E.activeTexture.set(P.TEXTURE0),ot.atlasTexture&&ot.atlasTexture.bind(ot.atlasInterpolation,P.CLAMP_TO_EDGE,!0),ot.atlasTextureIcon&&(E.activeTexture.set(P.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,P.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,ot.program),ot.hasHalo){let Wt=ot.uniformValues;Wt.u_is_halo=1,co(ot.buffers,Vt.segments,l,d,ot.program,Zt,m,p,Wt,2),Wt.u_is_halo=0}else{if(ot.isSDF){let Wt=ot.uniformValues;ot.hasHalo&&(Wt.u_is_halo=1,co(ot.buffers,Vt.segments,l,d,ot.program,Zt,m,p,Wt,1)),Wt.u_is_halo=0}co(ot.buffers,Vt.segments,l,d,ot.program,Zt,m,p,ot.uniformValues,1)}}}function co(d,a,l,c,m,p,Z,R,I,N){let Y=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];m.draw(c,c.context.gl.TRIANGLES,p,Z,R,Ye.disabled,I,l.id,d.layoutVertexBuffer,d.indexBuffer,a,l.paint,c.transform.zoom,d.programConfigurations.get(l.id),Y,N)}function Qo(d,a,l,c,m,p,Z){let R=d.context.gl,I=l.paint.get("fill-pattern"),N=I&&I.constantOr(1),Y,J,M,T,v;Z?(J=N&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=R.LINES):(J=N?"fillPattern":"fill",Y=R.TRIANGLES);for(let f of c){let z=a.getTile(f);if(N&&!z.patternsLoaded())continue;let Q=z.getBucket(l);if(!Q)continue;d.prepareDrawTile();let E=Q.programConfigurations.get(l.id),P=d.isTileAffectedByFog(f),H=d.getOrCreateProgram(J,{config:E,overrideFog:P});N&&(d.context.activeTexture.set(R.TEXTURE0),z.imageAtlasTexture&&z.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),E.updatePaintBuffers());let K=I.constantOr(null);if(K&&z.imageAtlas){let it=z.imageAtlas.patternPositions[K.toString()];it&&E.setConstantPatternPositions(it)}let w=d.translatePosMatrix(f.projMatrix,z,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),q=l.paint.get("fill-emissive-strength");if(Z){T=Q.indexBuffer2,v=Q.segments2;let it=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];M=J==="fillOutlinePattern"&&N?I0(w,q,d,z,it):ko(w,q,it)}else T=Q.indexBuffer,v=Q.segments,M=N?Yb(w,q,d,z):Gr(w,q);d.uploadCommonUniforms(d.context,H,f.toUnwrapped()),H.draw(d,Y,m,d.stencilModeForClipping(f),p,Ye.disabled,M,l.id,Q.layoutVertexBuffer,T,v,l.paint,d.transform.zoom,E,void 0)}}function pe(d,a,l,c,m,p,Z,R){l.resetLayerRenderingStats(d);let I=d.context,N=I.gl,Y=d.transform,J=l.paint.get("fill-extrusion-pattern"),M=J.constantOr(1),T=l.paint.get("fill-extrusion-opacity"),v=d.style.enable3dLights(),f=l.paint.get(v&&!M?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),z=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),f],Q=l.layout.get("fill-extrusion-edge-radius"),E=Q>0&&!l.paint.get("fill-extrusion-rounded-roof"),P=E?0:Q,H=Y.projection.name==="globe"?o.cF():0,K=Y.projection.name==="globe",w=K?o.S(Y.zoom):0,q=[o.a5(Y.center.lng),o.ae(Y.center.lat)],it=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),at=l.paint.get("fill-extrusion-flood-light-intensity"),rt=l.paint.get("fill-extrusion-vertical-scale"),Zt=oo(d,l.paint.get("fill-extrusion-cutoff-fade-range")),bt=l.paint.get("fill-extrusion-emissive-strength"),It=[],Gt;K&&It.push("PROJECTION_GLOBE_VIEW"),z[0]>0&&It.push("FAUX_AO"),E&&It.push("ZERO_ROOF_RADIUS"),R&&It.push("HAS_CENTROID"),at>0&&It.push("FLOOD_LIGHT"),Zt.shouldRenderCutoff&&It.push("RENDER_CUTOFF");let St=d.renderPass==="shadow",mt=d.shadowRenderer,Vt=St&&!!mt;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let ot=[0,0,0];if(mt){let At=d.style.directionalLight,Et=d.style.ambientLight;At&&Et&&(ot=cs(At,Et)),Gt=It.concat(["SHADOWS_SINGLE_CASCADE"])}let Wt=Vt?"fillExtrusionDepth":M?"fillExtrusionPattern":"fillExtrusion",ft=l.getLayerRenderingStats();for(let At of c){let Et=a.getTile(At),$t=Et.getBucket(l);if(!$t||$t.projection.name!==Y.projection.name)continue;let me=!1;mt&&(me=mt.getMaxCascadeForTile(At.toUnwrapped())===0);let Ie=d.isTileAffectedByFog(At),ue=$t.programConfigurations.get(l.id),Re=d.getOrCreateProgram(Wt,{config:ue,defines:me?Gt:It,overrideFog:Ie});if(d.terrain&&d.terrain.setupElevationDraw(Et,Re,{useMeterToDem:!0}),!$t.centroidVertexBuffer){let fi=Re.attributes.a_centroid_pos;fi!==void 0&&N.vertexAttrib2f(fi,0,0)}!St&&mt&&mt.setupShadows(Et.tileID.toUnwrapped(),Re,"vector-tile",Et.tileID.overscaledZ),M&&(d.context.activeTexture.set(N.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ue.updatePaintBuffers());let Ae=J.constantOr(null);if(Ae&&Et.imageAtlas){let fi=Et.imageAtlas.patternPositions[Ae.toString()];fi&&ue.setConstantPatternPositions(fi)}let Me=l.paint.get("fill-extrusion-vertical-gradient"),fe;if(St&&mt){if(y0(Et.tileID,$t,d))continue;let fi=mt.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());fe=Nb(fi,P,rt)}else{let fi=d.translatePosMatrix(At.expandedProjMatrix,Et,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),$e=Y.projection.createInversionMatrix(Y,At.canonical);fe=M?To(fi,d,Me,T,z,P,At,Et,H,w,q,$e,it,rt):xb(fi,d,Me,T,z,P,At,H,w,q,$e,it,rt,at,ot,bt)}d.uploadCommonUniforms(I,Re,At.toUnwrapped(),null,Zt);let Qe=$t.segments;if(Y.projection.name==="mercator"&&!St&&(Qe=$t.getVisibleSegments(Et.tileID,d.terrain,d.transform.getFrustum(0)),!Qe.get().length))continue;if(ft)if(St)for(let fi of Qe.get())ft.numRenderedVerticesInShadowPass+=fi.primitiveLength;else for(let fi of Qe.get())ft.numRenderedVerticesInTransparentPass+=fi.primitiveLength;let si=[];(d.terrain||R)&&si.push($t.centroidVertexBuffer),K&&si.push($t.layoutVertexExtBuffer),Re.draw(d,I.gl.TRIANGLES,m,p,Z,Ye.backCCW,fe,l.id,$t.layoutVertexBuffer,$t.indexBuffer,Qe,l.paint,d.transform.zoom,ue,si)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function bo(d,a,l,c,m,p,Z,R,I,N,Y,J,M,T,v,f,z,Q,E){let P=d.context,H=P.gl,K=d.transform,w=d.transform.zoom,q=[],it=oo(d,l.paint.get("fill-extrusion-cutoff-fade-range"));N==="clear"?(q.push("CLEAR_SUBPASS"),E&&(q.push("CLEAR_FROM_TEXTURE"),P.activeTexture.set(H.TEXTURE0),E.bind(H.LINEAR,H.CLAMP_TO_EDGE))):N==="sdf"&&q.push("SDF_SUBPASS"),z&&q.push("HAS_CENTROID"),it.shouldRenderCutoff&&q.push("RENDER_CUTOFF");let at=l.layout.get("fill-extrusion-edge-radius"),rt=(Zt,bt,It,Gt,St)=>{let mt=bt.programConfigurations.get(l.id),Vt=d.isTileAffectedByFog(Zt),ot=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:mt,defines:q,overrideFog:Vt}),Wt=((At,Et,$t,me,Ie,ue,Re,Ae,Me,fe,Qe)=>({u_matrix:Et,u_opacity:$t,u_ao_pass:me?1:0,u_meter_to_tile:Ie,u_ao:ue,u_flood_light_intensity:Re,u_flood_light_color:Ae,u_attenuation:Me,u_edge_radius:fe,u_fb:0,u_fb_size:Qe}))(0,Gt,Y,I,St,[J,M*St],T,v,f,w>=17?0:at*St,E?E.size[0]:0),ft=[];z&&ft.push(bt.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(P,ot,Zt.toUnwrapped(),null,it),ot.draw(d,P.gl.TRIANGLES,m,p,Z,R,Wt,l.id,bt.vertexBuffer,bt.indexBuffer,It,l.paint,w,mt,ft)};for(let Zt of c){let bt=a.getTile(Zt),It=bt.getBucket(l);if(!It||It.projection.name!==K.projection.name||!It.groundEffect||It.groundEffect&&!It.groundEffect.hasData())continue;let Gt=It.groundEffect,St=1/It.tileToMeter;{let mt=d.translatePosMatrix(Zt.projMatrix,bt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Vt=Gt.getDefaultSegment();rt(Zt,Gt,Vt,mt,St)}if(Q)for(let mt=0;mt<4;mt++){let Vt=o.cG[mt](Zt),ot=a.getTile(Vt);if(!ot)continue;let Wt=ot.getBucket(l);if(!Wt||Wt.projection.name!==K.projection.name||!Wt.groundEffect||Wt.groundEffect&&!Wt.groundEffect.hasData())continue;let ft=Wt.groundEffect,At,Et;mt===0?(At=[-o.V,0,0],Et=1):mt===1?(At=[o.V,0,0],Et=0):mt===2?(At=[0,-o.V,0],Et=3):(At=[0,o.V,0],Et=2);let $t=ft.regionSegments[Et];if(!$t)continue;let me=new Float32Array(16);o.a6.translate(me,Zt.projMatrix,At),rt(Zt,ft,$t,d.translatePosMatrix(me,bt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),St)}}}function qp(d,a,l,c,m,p,Z){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();let R=p?p.findDEMTileFor(l):null;if(!(R&&R.dem||Z))return;let I=Q=>new o.P(Math.ceil((Q+o.cJ)*o.cK),0),N=Q=>{let E=a.getSource().minzoom,P=K=>{let w=a.getTileByID(K);if(w&&w.hasData())return w.getBucket(m)},H=[0,-1,1];for(let K of H){if(Q.overscaledZ+K<E)continue;let w=P(Q.calculateScaledKey(Q.overscaledZ+K));if(w)return w}},Y=[0,0,0],J=(Q,E)=>(Y[0]=Math.min(Q.min.y,E.min.y),Y[1]=Math.max(Q.max.y,E.max.y),Y[2]=o.V-E.min.x>Q.max.x?E.min.x-o.V:Q.max.x,Y),M=(Q,E)=>(Y[0]=Math.min(Q.min.x,E.min.x),Y[1]=Math.max(Q.max.x,E.max.x),Y[2]=o.V-E.min.y>Q.max.y?E.min.y-o.V:Q.max.y,Y),T=[(Q,E)=>J(Q,E),(Q,E)=>J(E,Q),(Q,E)=>M(Q,E),(Q,E)=>M(E,Q)],v=(Q,E,P,H,K,w,q)=>{if(!p)return 0;let it=[[w?P:Q,w?Q:P,0],[w?P:E,w?E:P,0]],at=q<0?o.V+q:q,rt=[w?at:(Q+E)/2,w?(Q+E)/2:at,0];return P===0&&q<0||P!==0&&q>0?p.getForTilePoints(K,[rt],!0,H):it.push(rt),p.getForTilePoints(l,it,!0,R),Math.max(it[0][2],it[1][2],rt[2])/p.exaggeration()};for(let Q=0;Q<4;Q++){let E=c.borderFeatureIndices[Q];if(E.length===0)continue;let P=o.cG[Q](l),H=N(P);if(!(H&&H instanceof o.cH)||c.borderDoneWithNeighborZ[Q]===H.canonical.z)continue;H.centroidVertexArray.length===0&&H.createCentroidsBuffer();let K=p?p.findDEMTileFor(P):null;if(!(K&&K.dem||Z))continue;let w=(Q<2?1:5)-Q,q=H.borderDoneWithNeighborZ[w]!==c.canonical.z,it=H.borderFeatureIndices[w],at=0;if(c.canonical.z!==H.canonical.z){for(let rt of E)c.showCentroid(c.featuresOnBorder[rt]);if(q)for(let rt of it)H.showCentroid(H.featuresOnBorder[rt]);c.borderDoneWithNeighborZ[Q]=H.canonical.z,H.borderDoneWithNeighborZ[w]=c.canonical.z}for(let rt of E){let Zt=c.featuresOnBorder[rt],bt=c.centroidData[Zt.centroidDataIndex],It=Zt.borders[Q],Gt;for(;at<it.length;){Gt=H.featuresOnBorder[it[at]];let St=Gt.borders[w];if(St[1]>It[0]+3||St[0]>It[0]-3)break;H.showCentroid(Gt),at++}if(Gt&&at<it.length){let St=at,mt=0;for(;!(Gt.borders[w][0]>It[1]-3)&&(mt++,++at!==it.length);)Gt=H.featuresOnBorder[it[at]];if(Gt=H.featuresOnBorder[it[St]],mt>1){let Wt=Gt.borders[w];Math.abs(It[0]-Wt[0])<3&&Math.abs(It[1]-Wt[1])<3&&(mt=1,at=St+1)}else if(mt===0){c.showCentroid(Zt);continue}let Vt=H.centroidData[Gt.centroidDataIndex];Z&&mt===1&&(((f=bt).flags|(z=Vt).flags)&o.cI?(f.flags|=o.cI,z.flags|=o.cI):(f.flags&=~o.cI,z.flags&=~o.cI));let ot=Zt.intersectsCount()>1||Gt.intersectsCount()>1;if(mt>1)at=St,bt.centroidXY=Vt.centroidXY=new o.P(0,0);else if(K&&K.dem&&!ot){let Wt=T[Q](bt,Vt),ft=Q%2?o.V-1:0,At=v(Wt[0],Math.min(o.V-1,Wt[1]),ft,K,P,Q<2,Wt[2]);bt.centroidXY=Vt.centroidXY=I(At)}else ot?bt.centroidXY=Vt.centroidXY=new o.P(0,0):(bt.centroidXY=c.encodeBorderCentroid(Zt),Vt.centroidXY=H.encodeBorderCentroid(Gt));c.writeCentroidToBuffer(bt),H.writeCentroidToBuffer(Vt)}else c.showCentroid(Zt)}c.borderDoneWithNeighborZ[Q]=H.canonical.z,H.borderDoneWithNeighborZ[w]=c.canonical.z}var f,z;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(d)}let $p=[1,0,0],Mb=[0,1,0],J0=[0,0,1];function y0(d,a,l){let c=l.transform,m=l.shadowRenderer;if(!m)return!0;let p=d.toUnwrapped(),Z=c.tileSize*m._cascades[l.currentShadowCascade].scale,R=a.maxHeight;if(c.elevation){let f=c.elevation.getMinMaxForTile(d);f&&(R+=f.max)}let I=[...m.shadowDirection];I[2]=-I[2];let N=m.computeSimplifiedTileShadowVolume(p,R,Z,I);if(!N)return!1;let Y=[$p,Mb,J0,I,[I[0],0,I[2]],[0,I[1],I[2]]],J=c.projection.name==="globe",M=c.scaleZoom(Z),T=o.bq.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,M,!J),v=m.getCurrentCascadeFrustum();return T.intersectsPrecise(N.vertices,N.planes,Y)===0||v.intersectsPrecise(N.vertices,N.planes,Y)===0}function B0(d){return[d[0]*o.cL,d[1]*o.cL,d[2]*o.cL,0]}function Cb(d,a,l,c,m,p,Z,R,I){let N=c.getSource(),Y=l.globeSharedBuffers;if(!Y)return;let J,M,T;if(a&&(J=c.getTile(a)),N instanceof o.ap?(M=N.texture,T=o.cj(0,0,l.transform)):J&&a&&(M=J.texture,T=o.cj(a.canonical.z,a.canonical.x,l.transform)),!M||!T)return;d||(T=o.a6.scale(o.a6.create(),T,[1,-1,1]));let v=l.context,f=v.gl,z=m.paint.get("raster-resampling")==="nearest"?f.NEAREST:f.LINEAR,Q=l.colorModeForDrapableLayerRenderPass(p),E=Z.defines;E.push("GLOBE_POLES");let P=new Ne(f.LEQUAL,Ne.ReadWrite,l.depthRangeFor3D),H=Float32Array.from(l.transform.expandedFarZProjMatrix),K=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),v.activeTexture.set(f.TEXTURE0),M.bind(z,f.CLAMP_TO_EDGE),v.activeTexture.set(f.TEXTURE1),M.bind(z,f.CLAMP_TO_EDGE),M.useMipmap&&v.extTextureFilterAnisotropic&&l.transform.pitch>20&&f.texParameterf(f.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax);let[w,q,it,at]=a?Y.getPoleBuffers(a.canonical.z,!1):Y.getPoleBuffers(0,!0),rt=m.paint.get("raster-elevation"),Zt;d?(Zt=w,l.renderDefaultNorthPole=rt!==0):(Zt=q,l.renderDefaultSouthPole=rt!==0);let bt=B0(Z.mix),It=((St,mt,Vt,ot,Wt,ft,At,Et,$t,me,Ie,ue,Re)=>yb(St,mt,Vt,new Float32Array(16),new Float32Array(9),[0,0],ot,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ft,[0,0],Et,2,me,Ie,ue,1,0,Re))(H,K,T,o.S(l.transform.zoom),0,m,0,rt,0,bt,Z.offset,Z.range,p),Gt=l.getOrCreateProgram("raster",{defines:E});l.uploadCommonUniforms(v,Gt,null),Gt.draw(l,f.TRIANGLES,P,I,Q,R,It,m.id,Zt,it,at)}function Tb(d){let a=d._nearZ,l=d.projection.farthestPixelDistance(d),c=l-a,m=.2*d.height,p=a+m;return[a,l,(p-m-a)/c,(p-a)/c]}function kb(d,a,l,c){if(d)return a instanceof Dt&&d instanceof Xo?a.getTextureDescriptor(d,l,!0):{texture:d.texture,mix:B0(c.mix),offset:c.offset,buffer:0,tileSize:1}}function Qb(d,a,l){if(!d)return null;let c=a.getTextureDescriptor(d,l,!0);if(!c)return null;let{texture:m,mix:p,offset:Z,tileSize:R,buffer:I,format:N}=c;if(!m||!N)return null;let Y=!1;return N==="uint32"&&(Y=!0,p[3]=0,p=Md(o.cM,p,[0,l.paint.get("raster-particle-max-speed")]),Z=x0(o.cM,Z,[0,l.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[I/(R+2*I),R/(R+2*I)],tileSize:R,scalarData:Y,scale:p,offset:Z,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function Sb(d){let a=d._nearZ,l=d.projection.farthestPixelDistance(d),c=l-a,m=.2*d.height,p=a+m;return[a,l,(p-m-a)/c,(p-a)/c]}let Un=new o.ax(1,0,0,1),mo=new o.ax(0,1,0,1),M0=new o.ax(0,0,1,1),fb=new o.ax(1,0,1,1),vb=new o.ax(0,1,1,1);function ho(d,a,l,c,m,p,Z){let R=d.context,I=d.transform,N=R.gl,Y=I.projection.name==="globe",J=Y?["PROJECTION_GLOBE_VIEW"]:[],M=o.a6.clone(l.projMatrix);if(Y&&o.S(I.zoom)>0){let bt=o.aS(l.canonical,I),It=o.cN(bt);M=o.a6.multiply(new Float32Array(16),I.globeMatrix,It),o.a6.multiply(M,I.projMatrix,M)}let T=o.a6.create();T[12]+=2*m/(o.f.devicePixelRatio*I.width),T[13]+=2*p/(o.f.devicePixelRatio*I.height),o.a6.multiply(M,T,M);let v=d.getOrCreateProgram("debug",{defines:J}),f=a.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(f,v);let z=Ne.disabled,Q=Ce.disabled,E=d.colorModeForRenderPass(),P="$debug";R.activeTexture.set(N.TEXTURE0),d.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Y?f._makeGlobeTileDebugBuffers(d.context,I):f._makeDebugTileBoundsBuffers(d.context,I.projection);let H=f._tileDebugBuffer||d.debugBuffer,K=f._tileDebugIndexBuffer||d.debugIndexBuffer,w=f._tileDebugSegments||d.debugSegments;if(v.draw(d,N.LINE_STRIP,z,Q,E,Ye.disabled,Xb(M,c),P,H,K,w,null,null,null,[f._globeTileDebugBorderBuffer]),Z){let bt=f.latestRawTileData,It=Math.floor((bt&&bt.byteLength||0)/1024),Gt=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Gt+=" => ".concat(l.overscaledZ)),Gt+=" ".concat(f.state),Gt+=" ".concat(It,"kb"),function(St,mt){St.initDebugOverlayCanvas();let Vt=St.debugOverlayCanvas,ot=St.context.gl,Wt=St.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,Vt.width,Vt.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(mt,5,5),Wt.strokeText(mt,5,5),St.debugOverlayTexture.update(Vt),St.debugOverlayTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE)}(d,Gt)}let q=a.getTile(l).tileSize,it=512/Math.min(q,512)*(l.overscaledZ/I.zoom)*.5,at=f._tileDebugTextBuffer||d.debugBuffer,rt=f._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Zt=f._tileDebugTextSegments||d.debugSegments;v.draw(d,N.TRIANGLES,z,Q,Pe.alphaBlended,Ye.disabled,Xb(M,o.ax.transparent,it),P,at,rt,Zt,null,null,null,[f._globeTileDebugTextBuffer])}function Lb(d,a,l,c){ta(d,0,a+l/2,d.transform.width,l,c)}function Tn(d,a,l,c){ta(d,a-l/2,0,l,d.transform.height,c)}function ta(d,a,l,c,m,p){let Z=d.context,R=Z.gl;R.enable(R.SCISSOR_TEST),R.scissor(a*o.f.devicePixelRatio,l*o.f.devicePixelRatio,c*o.f.devicePixelRatio,m*o.f.devicePixelRatio),Z.clear({color:p}),R.disable(R.SCISSOR_TEST)}let Sd=o.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zb}=Sd;function Ql(d,a,l,c){d.emplaceBack(a,l,c)}class wb{constructor(a){this.vertexArray=new o.az,this.indices=new o.aw,Ql(this.vertexArray,-1,-1,1),Ql(this.vertexArray,1,-1,1),Ql(this.vertexArray,-1,1,1),Ql(this.vertexArray,1,1,1),Ql(this.vertexArray,-1,-1,-1),Ql(this.vertexArray,1,-1,-1),Ql(this.vertexArray,-1,1,-1),Ql(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,zb),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.aB.simpleSegment(0,0,36,12)}}function So(d,a,l,c,m,p){let Z=d.context.gl,R=a.paint.get("sky-atmosphere-color"),I=a.paint.get("sky-atmosphere-halo-color"),N=a.paint.get("sky-atmosphere-sun-intensity"),Y=((J,M,T,v,f)=>({u_matrix_3f:J,u_sun_direction:M,u_sun_intensity:T,u_color_tint_r:[v.r,v.g,v.b,v.a],u_color_tint_m:[f.r,f.g,f.b,f.a],u_luminance:5e-5}))(o.co.fromMat4(o.co.create(),c),m,N,R,I);Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_CUBE_MAP_POSITIVE_X+p,a.skyboxTexture,0),l.draw(d,Z.TRIANGLES,Ne.disabled,Ce.disabled,Pe.unblended,Ye.frontCW,Y,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}let tW=o.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Fr{constructor(a){let l=new o.cO;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);let c=new o.aw;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(l,tW.members),this.indexBuffer=a.createIndexBuffer(c),this.segments=o.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Vs=o.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class jt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ue{constructor(a){this.colorModeAlphaBlendedWriteRGB=new Pe([1,$l,1,$l],o.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Pe([1,0,1,0],o.ax.transparent,[!1,!1,!1,!0]),this.params=new jt,this.updateNeeded=!0,a.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),a.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),a.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(a){let l=a.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Fr(l);let c=this.params.sizeRange,m=this.params.intensityRange,p=function(Y){let J=o.aA(30),M=[];for(let T=0;T<Y;++T){let v=2*Math.PI*J(),f=Math.acos(1-2*J())-.5*Math.PI;M.push(o.N.fromValues(Math.cos(f)*Math.cos(v),Math.cos(f)*Math.sin(v),Math.sin(f)))}return M}(this.params.starsCount),Z=o.aA(300),R=new o.cP,I=new o.aw,N=0;for(let Y=0;Y<p.length;++Y){let J=o.N.scale([],p[Y],200),M=Math.max(0,1+.01*c*(1*Z()-.5)),T=Math.max(0,1+.01*m*(1*Z()-.5));R.emplaceBack(J[0],J[1],J[2],-1,-1,M,T),R.emplaceBack(J[0],J[1],J[2],1,-1,M,T),R.emplaceBack(J[0],J[1],J[2],1,1,M,T),R.emplaceBack(J[0],J[1],J[2],-1,1,M,T),I.emplaceBack(N+0,N+1,N+2),I.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=l.createVertexBuffer(R,Vs.members),this.starsIdx=l.createIndexBuffer(I),this.starsSegments=o.aB.simpleSegment(0,0,R.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(a,l){let c=a.context,m=c.gl,p=a.transform,Z=new Ne(m.LEQUAL,Ne.ReadOnly,[0,1]),R=o.S(p.zoom),I=l.properties.get("color").toArray01(),N=l.properties.get("high-color").toArray01(),Y=l.properties.get("space-color").toArray01PremultipliedAlpha(),J=5e-4,M=o.cQ(l.properties.get("horizon-blend"),0,1,J,.25),T=o.cd(a,c,p)&&M===J?p.worldSize/(2*Math.PI*1.025)-1:p.globeRadius,v=a.frameCounter/1e3%1,f=o.N.length(p.globeCenterInViewSpace),z=Math.sqrt(Math.pow(f,2)-Math.pow(T,2)),Q=Math.acos(z/f),E=P=>{let H=p.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];P&&H.push("ALPHA_PASS");let K=a.getOrCreateProgram("globeAtmosphere",{defines:H}),w=((it,at,rt,Zt,bt,It,Gt,St,mt,Vt,ot,Wt)=>({u_frustum_tl:it,u_frustum_tr:at,u_frustum_br:rt,u_frustum_bl:Zt,u_horizon:bt,u_transition:It,u_fadeout_range:Gt,u_color:St,u_high_color:mt,u_space_color:Vt,u_temporal_offset:ot,u_horizon_angle:Wt}))(p.frustumCorners.TL,p.frustumCorners.TR,p.frustumCorners.BR,p.frustumCorners.BL,p.frustumCorners.horizon,R,M,I,N,Y,v,Q);a.uploadCommonUniforms(c,K);let q=this.atmosphereBuffer;q&&K.draw(a,m.TRIANGLES,Z,Ce.disabled,P?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ye.backCW,w,P?"atmosphere_glow_alpha":"atmosphere_glow",q.vertexBuffer,q.indexBuffer,q.segments)};E(!1),E(!0)}drawStars(a,l){let c=o.aa(l.properties.get("star-intensity"),0,1);if(c===0)return;let m=a.context,p=m.gl,Z=a.transform,R=a.getOrCreateProgram("stars"),I=o.bi.identity([]);o.bi.rotateX(I,I,-Z._pitch),o.bi.rotateZ(I,I,-Z.angle),o.bi.rotateX(I,I,o.bj(Z._center.lat)),o.bi.rotateY(I,I,-o.bj(Z._center.lng));let N=o.a6.fromQuat(new Float32Array(16),I),Y=o.a6.multiply([],Z.starsProjMatrix,N),J=o.co.fromMat4([],N),M=o.co.invert([],J),T=[0,1,0];o.N.transformMat3(T,T,M),o.N.scale(T,T,this.params.sizeMultiplier);let v=[1,0,0];o.N.transformMat3(v,v,M),o.N.scale(v,v,this.params.sizeMultiplier);let f=(z=T,Q=v,E=c,{u_matrix:Float32Array.from(Y),u_up:z,u_right:Q,u_intensity_multiplier:E});var z,Q,E;a.uploadCommonUniforms(m,R),this.starsVx&&this.starsIdx&&R.draw(a,p.TRIANGLES,Ne.disabled,Ce.disabled,this.colorModeAlphaBlendedWriteRGB,Ye.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function fo(d,a){let l=[...d],c=a.cameraWorldSizeForFog/a.worldSize,m=o.a6.identity([]);return o.a6.scale(m,m,[c,c,1]),o.a6.multiply(l,m,l),o.a6.multiply(l,a.worldToFogMatrix,l),l}function ea(d,a,l,c){let m=l.material,p=c.context,{baseColorTexture:Z,metallicRoughnessTexture:R}=m.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:N,emissionTexture:Y}=m;function J(M,T,v){if(M&&(d.push(T),p.activeTexture.set(p.gl.TEXTURE0+v),M.gfxTexture)){let{minFilter:f,magFilter:z,wrapS:Q,wrapT:E}=M.sampler;M.gfxTexture.bindExtraParam(f,z,Q,E)}}J(Z,"HAS_TEXTURE_u_baseColorTexture",Pa.BaseColor),J(R,"HAS_TEXTURE_u_metallicRoughnessTexture",Pa.MetallicRoughness),J(I,"HAS_TEXTURE_u_normalTexture",Pa.Normal),J(N,"HAS_TEXTURE_u_occlusionTexture",Pa.Occlusion),J(Y,"HAS_TEXTURE_u_emissionTexture",Pa.Emission),l.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),a.push(l.texcoordBuffer)),l.colorBuffer&&(d.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),a.push(l.colorBuffer)),l.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),a.push(l.normalBuffer)),l.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),a.push(l.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||d.push("DIFFUSE_SHADED"),d.push("USE_STANDARD_DERIVATIVES")}function Rs(d,a,l,c,m,p){let Z=l.paint.get("model-opacity"),R=a.context,I=new Ne(a.context.gl.LEQUAL,Ne.ReadWrite,a.depthRangeFor3D),N=a.transform,Y=d.mesh,J=Y.material,M=J.pbrMetallicRoughness,T=a.style.fog,v;v=a.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:o.a6.multiply([],c.zScaleMatrix,d.nodeModelMatrix),o.a6.multiply(v,c.negCameraPosMatrix,v);let f=o.a6.invert([],v);o.a6.transpose(f,f);let z=l.paint.get("model-emissive-strength").constantOr(0),Q=kd(new Float32Array(d.worldViewProjection),new Float32Array(v),new Float32Array(f),a,Z,M.baseColorFactor,J.emissiveFactor,M.metallicFactor,M.roughnessFactor,J,z,l),E={defines:[]},P=[];ea(E.defines,P,Y,a);let H=a.shadowRenderer;H&&(H.useNormalOffset=!1);let K=null;if(T){let it=fo(d.nodeModelMatrix,a.transform);if(K=new Float32Array(it),N.projection.name!=="globe"){let at=Y.aabb.min,rt=Y.aabb.max,[Zt,bt]=T.getOpacityForBounds(it,at[0],at[1],rt[0],rt[1]);E.overrideFog=Zt>=xi||bt>=xi}}let w=oo(a,l.paint.get("model-cutoff-fade-range"));w.shouldRenderCutoff&&E.defines.push("RENDER_CUTOFF");let q=a.getOrCreateProgram("model",E);a.uploadCommonUniforms(R,q,null,K,w),a.renderPass!=="shadow"&&H&&H.setupShadowsFromMatrix(d.nodeModelMatrix,q),q.draw(a,R.gl.TRIANGLES,I,m,p,Y.material.doubleSided?Ye.disabled:Ye.backCCW,Q,l.id,Y.vertexBuffer,Y.indexBuffer,Y.segments,l.paint,a.transform.zoom,void 0,P)}function Gs(d,a,l,c,m,p,Z){let R;R=d.projection.name==="globe"?o.cS(l,d):[...l],o.a6.multiply(R,R,a.matrix);let I=o.a6.multiply([],c,R);if(a.meshes)for(let N of a.meshes){if(N.material.alphaMode!=="BLEND"){Z.push({mesh:N,depth:0,modelIndex:m,worldViewProjection:I,nodeModelMatrix:R});continue}let Y=o.N.transformMat4([],N.centroid,I);Y[2]>0&&p.push({mesh:N,depth:Y[2],modelIndex:m,worldViewProjection:I,nodeModelMatrix:R})}if(a.children)for(let N of a.children)Gs(d,N,l,c,m,p,Z)}function ut(d,a,l,c){let m=l.shadowRenderer;if(!m)return;let p=m.getShadowPassDepthMode(),Z=m.getShadowPassColorMode(),R=m.calculateShadowPassMatrixFromMatrix(a),I=Zs(R);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,p,Ce.disabled,Z,Ye.backCCW,I,c.id,d.vertexBuffer,d.indexBuffer,d.segments,c.paint,l.transform.zoom,void 0,void 0)}function Eb(d,a,l){let c=a.updateZoomBasedPaintProperties(),m=function(p,Z,R){let I,N,Y,J=p.terrain?p.terrain.exaggeration():0;if(p.terrain&&J>0){let M=p.terrain,T=M.findDEMTileFor(R);T&&T.dem?I=o.cU.create(M,R,T):J=0}if(J===0&&(Z.terrainElevationMin=0,Z.terrainElevationMax=0),J===Z.validForExaggeration&&(J===0||I&&I._demTile&&I._demTile.tileID===Z.validForDEMTile.id&&I._dem._timestamp===Z.validForDEMTile.timestamp))return!1;for(let M in Z.instancesPerModel){let T=Z.instancesPerModel[M];for(let v=0;v<T.instancedDataArray.length;++v){let f=(I?J*I.getElevationAt(0|T.instancedDataArray.float32[16*v],0|T.instancedDataArray.float32[16*v+1],!0,!0):0)+T.instancesEvaluatedElevation[v];T.instancedDataArray.float32[16*v+6]=f,N=N?Math.min(Z.terrainElevationMin,f):f,Y=Y?Math.max(Z.terrainElevationMax,f):f}}return Z.terrainElevationMin=N||0,Z.terrainElevationMax=Y||0,Z.validForExaggeration=J,Z.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,a,l);(c||m)&&(a.uploaded=!1,a.upload(d.context))}let kn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.bS([0,0,0],[o.V,o.V,0])};function C0(d,a){let l=1<<d.canonical.z,c=a.getFreeCameraOptions().position,m=a.elevation,p=d.canonical.x/l,Z=(d.canonical.x+1)/l,R=d.canonical.y/l,I=(d.canonical.y+1)/l,N=a._centerAltitude;if(m){let T=m.getMinMaxForTile(d);T&&T.max>N&&(N=T.max)}let Y=o.aa(c.x,p,Z)-c.x,J=o.aa(c.y,R,I)-c.y,M=o.bl(N,a.center.lat)-c.z;return a._zoomFromMercatorZ(Math.sqrt(Y*Y+J*J+M*M))}function Ab(d,a,l,c,m,p,Z){let R=d.context,I=d.renderPass==="shadow",N=d.shadowRenderer,Y=I&&N?N.getShadowPassDepthMode():new Ne(R.gl.LEQUAL,Ne.ReadWrite,d.depthRangeFor3D),J=d.isTileAffectedByFog(p);if(l.meshes)for(let M of l.meshes){let T=["MODEL_POSITION_ON_GPU"],v=[],f,z,Q;c.instancedDataArray.length>20&&T.push("INSTANCED_ARRAYS");let E=oo(d,a.paint.get("model-cutoff-fade-range"));if(E.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),I&&N)f=d.getOrCreateProgram("modelDepth",{defines:T}),z=Zs(Z.shadowTileMatrix,Z.shadowTileMatrix,Float32Array.from(l.matrix)),Q=N.getShadowPassColorMode();else{ea(T,v,M,d),f=d.getOrCreateProgram("model",{defines:T,overrideFog:J});let H=M.material,K=H.pbrMetallicRoughness,w=a.paint.get("model-opacity"),q=a.paint.get("model-emissive-strength").constantOr(0);z=kd(p.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),d,w,K.baseColorFactor,H.emissiveFactor,K.metallicFactor,K.roughnessFactor,H,q,a,m),N&&(Z.shadowUniformsInitialized?f.setShadowUniformValues(R,N.getShadowUniformValues()):(N.setupShadows(p.toUnwrapped(),f,"model-tile",p.overscaledZ),Z.shadowUniformsInitialized=!0)),Q=E.shouldRenderCutoff||w<1||H.alphaMode!=="OPAQUE"?Pe.alphaBlended:Pe.unblended}d.uploadCommonUniforms(R,f,p.toUnwrapped(),null,E);let P=M.material.doubleSided?Ye.disabled:Ye.backCCW;if(c.instancedDataArray.length>20)v.push(c.instancedDataBuffer),f.draw(d,R.gl.TRIANGLES,Y,Ce.disabled,Q,P,z,a.id,M.vertexBuffer,M.indexBuffer,M.segments,a.paint,d.transform.zoom,void 0,v,c.instancedDataArray.length);else{let H=I?"u_instance":"u_normal_matrix";for(let K=0;K<c.instancedDataArray.length;++K)z[H]=new Float32Array(c.instancedDataArray.arrayBuffer,64*K,16),f.draw(d,R.gl.TRIANGLES,Y,Ce.disabled,Q,P,z,a.id,M.vertexBuffer,M.indexBuffer,M.segments,a.paint,d.transform.zoom,void 0,v)}}if(l.children)for(let M of l.children)Ab(d,a,M,c,m,p,Z)}let Ir=[1,-1,1];function eW(d,a,l,c){if(!l.modelManager)return!0;let m=l.modelManager;if(!l.shadowRenderer)return!0;let p=l.shadowRenderer,Z=a.aabb,R=!0,I=d.maxHeight;if(I===0){let Y=0;for(let J in d.instancesPerModel){let M=m.getModel(J,c);M?Y=Math.max(Y,Math.max(Math.max(M.aabb.max[0],M.aabb.max[1]),M.aabb.max[2])):R=!1}I=d.maxScale*Y*1.41+d.maxVerticalOffset,R&&(d.maxHeight=I)}Z.max[2]=I,Z.min[2]+=d.terrainElevationMin,Z.max[2]+=d.terrainElevationMax,o.N.transformMat4(Z.min,Z.min,a.tileMatrix),o.N.transformMat4(Z.max,Z.max,a.tileMatrix);let N=Z.intersects(p.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=N===2),N===0}class iW{}class T0{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(a,l,c){{let J=this._storage.get(l.id);if(J)return J.lastUsedFrameIdx=a,J.buf}let m=c.gl,p=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),Z=new ArrayBuffer(p),R=new Int16Array(Z);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(Z));let I=new o.cW;for(let J=0;J<p/2;J+=3){let M=R[J],T=R[J+1],v=R[J+2];I.emplaceBack(M,T),I.emplaceBack(T,v),I.emplaceBack(v,M)}let N=c.bindVertexArrayOES.current,Y=new iW;return Y.buf=new Li(c,I),Y.lastUsedFrameIdx=a,this._storage.set(l.id,Y),c.bindVertexArrayOES.set(N),Y.buf}update(a){for(let[l,c]of this._storage)a-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(l))}destroy(){for(let[a,l]of this._storage)l.buf.destroy(),this._storage.delete(a)}}class Fs{registerParameter(a,l,c,m,p){}registerButton(a,l,c){}}let Is={symbol:function(d,a,l,c,m){if(d.renderPass!=="translucent")return;let p=Ce.disabled,Z=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(N,Y,J,M,T,v,f){let z=Y.transform,Q=T==="map",E=v==="map";for(let P of N){let H=M.getTile(P),K=H.getBucket(J);if(!K||!K.text||!K.text.segments.get().length)continue;let w=o.b5(K.textSizeData,z.zoom),q=ns(P,K.getProjection(),z),it=z.calculatePixelsToTileUnitsMatrix(H),at=is(q,H.tileID.canonical,E,Q,z,K.getProjection(),it),rt=K.hasIconTextFit()&&K.hasIconData();if(w){let Zt=Math.pow(2,z.zoom-H.tileID.overscaledZ);X0(K,Q,E,f,o.cx,z,at,P,Zt,w,rt)}}}(c,d,l,a,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),m);let R=l.paint.get("icon-opacity").constantOr(1)!==0,I=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||I)?Qd(d,a,l,c,p,Z):(R&&Qd(d,a,l,c,p,Z,{onlyIcons:!0}),I&&Qd(d,a,l,c,p,Z,{onlyText:!0})),a.map.showCollisionBoxes&&(rl(d,a,l,c,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),rl(d,a,l,c,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,a,l,c){if(d.renderPass!=="translucent")return;let m=l.paint.get("circle-opacity"),p=l.paint.get("circle-stroke-width"),Z=l.paint.get("circle-stroke-opacity"),R=l.layout.get("circle-sort-key").constantOr(1)!==void 0,I=l.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(p.constantOr(1)===0||Z.constantOr(1)===0))return;let N=d.context,Y=N.gl,J=d.transform,M=d.depthModeForSublayer(0,Ne.ReadOnly),T=Ce.disabled,v=d.colorModeForDrapableLayerRenderPass(I),f=J.projection.name==="globe",z=[o.a5(J.center.lng),o.ae(J.center.lat)],Q=[];for(let P=0;P<c.length;P++){let H=c[P],K=a.getTile(H),w=K.getBucket(l);if(!w||w.projection.name!==J.projection.name)continue;let q=w.programConfigurations.get(l.id),it=o.cy(l),at=d.isTileAffectedByFog(H);f&&it.push("PROJECTION_GLOBE_VIEW");let rt=d.getOrCreateProgram("circle",{config:q,defines:it,overrideFog:at}),Zt=w.layoutVertexBuffer,bt=w.globeExtVertexBuffer,It=w.indexBuffer,Gt=J.projection.createInversionMatrix(J,H.canonical),St={programConfiguration:q,program:rt,layoutVertexBuffer:Zt,globeExtVertexBuffer:bt,indexBuffer:It,uniformValues:o.cz(d,H,K,Gt,z,l),tile:K};if(R){let mt=w.segments.get();for(let Vt of mt)Q.push({segments:new o.aB([Vt]),sortKey:Vt.sortKey,state:St})}else Q.push({segments:w.segments,sortKey:0,state:St})}R&&Q.sort((P,H)=>P.sortKey-H.sortKey);let E={useDepthForOcclusion:J.depthOcclusionForSymbolsAndCircles};for(let P of Q){let{programConfiguration:H,program:K,layoutVertexBuffer:w,globeExtVertexBuffer:q,indexBuffer:it,uniformValues:at,tile:rt}=P.state,Zt=P.segments;d.terrain&&d.terrain.setupElevationDraw(rt,K,E),d.uploadCommonUniforms(N,K,rt.tileID.toUnwrapped()),K.draw(d,Y.TRIANGLES,M,T,v,Ye.disabled,at,l.id,w,it,Zt,l.paint,J.zoom,H,[q])}},heatmap:function(d,a,l,c){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){let m=d.context,p=m.gl,Z=Ce.disabled,R=new Pe([p.ONE,p.ONE,p.ONE,p.ONE],o.ax.transparent,[!0,!0,!0,!0]);(function(T,v,f,z){let Q=T.gl,E=v.width*z,P=v.height*z;T.activeTexture.set(Q.TEXTURE1),T.viewport.set([0,0,E,P]);let H=f.heatmapFbo;if(!H||H&&(H.width!==E||H.height!==P)){H&&H.destroy();let K=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,K),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),H=f.heatmapFbo=T.createFramebuffer(E,P,!0,null),function(w,q,it,at,rt,Zt){let bt=w.gl;bt.texImage2D(bt.TEXTURE_2D,0,w.extRenderToTextureHalfFloat?bt.RGBA16F:bt.RGBA,rt,Zt,0,bt.RGBA,w.extRenderToTextureHalfFloat?bt.HALF_FLOAT:bt.UNSIGNED_BYTE,null),at.colorAttachment.set(it)}(T,0,K,H,E,P)}else Q.bindTexture(Q.TEXTURE_2D,H.colorAttachment.get()),T.bindFramebuffer.set(H.framebuffer)})(m,d,l,d.transform.projection.name==="globe"?.5:.25),m.clear({color:o.ax.transparent});let I=d.transform,N=I.projection.name==="globe",Y=N?["PROJECTION_GLOBE_VIEW"]:[],J=N?Ye.frontCCW:Ye.disabled,M=[o.a5(I.center.lng),o.ae(I.center.lat)];for(let T=0;T<c.length;T++){let v=c[T];if(a.hasRenderableParent(v))continue;let f=a.getTile(v),z=f.getBucket(l);if(!z||z.projection.name!==I.projection.name)continue;let Q=d.isTileAffectedByFog(v),E=z.programConfigurations.get(l.id),P=d.getOrCreateProgram("heatmap",{config:E,defines:Y,overrideFog:Q}),{zoom:H}=d.transform;d.terrain&&d.terrain.setupElevationDraw(f,P),d.uploadCommonUniforms(m,P,v.toUnwrapped());let K=I.projection.createInversionMatrix(I,v.canonical);P.draw(d,p.TRIANGLES,Ne.disabled,Z,R,J,Jb(d,v,f,K,M,H,l.paint.get("heatmap-intensity")),l.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,l.paint,d.transform.zoom,E,N?[z.globeExtVertexBuffer]:null)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,p){let Z=m.context,R=Z.gl,I=p.heatmapFbo;if(!I)return;Z.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,I.colorAttachment.get()),Z.activeTexture.set(R.TEXTURE1);let N=p.colorRampTexture;N||(N=p.colorRampTexture=new o.T(Z,p.colorRamp,R.RGBA)),N.bind(R.LINEAR,R.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,R.TRIANGLES,Ne.disabled,Ce.disabled,m.colorModeForRenderPass(),Ye.disabled,((Y,J,M,T)=>({u_image:0,u_color_ramp:1,u_opacity:J.paint.get("heatmap-opacity")}))(0,p),p.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,p.paint,m.transform.zoom)}(d,l))},line:function(d,a,l,c){if(d.renderPass!=="translucent")return;let m=l.paint.get("line-opacity"),p=l.paint.get("line-width");if(m.constantOr(1)===0||p.constantOr(1)===0)return;let Z=l.paint.get("line-emissive-strength"),R=d.depthModeForSublayer(0,Ne.ReadOnly),I=d.colorModeForDrapableLayerRenderPass(Z),N=d.terrain&&d.terrain.renderingToTexture?1:o.f.devicePixelRatio,Y=l.paint.get("line-dasharray"),J=Y.constantOr(1),M=l.layout.get("line-cap"),T=l.paint.get("line-pattern"),v=T.constantOr(1),f=l.paint.get("line-pattern").constantOr(1),z=l.paint.get("line-opacity").constantOr(1)!==1,Q=!f&&z,E=l.paint.get("line-gradient"),P=v?"linePattern":"line",H=d.context,K=H.gl,w=o.cA(l);d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Q=!1);for(let q of c){let it=a.getTile(q);if(v&&!it.patternsLoaded())continue;let at=it.getBucket(l);if(!at)continue;d.prepareDrawTile();let rt=at.programConfigurations.get(l.id),Zt=d.isTileAffectedByFog(q),bt=d.getOrCreateProgram(P,{config:rt,defines:w,overrideFog:Zt}),It=T.constantOr(null);if(It&&it.imageAtlas){let At=it.imageAtlas.patternPositions[It.toString()];At&&rt.setConstantPatternPositions(At)}let Gt=Y.constantOr(null),St=M.constantOr(null);if(!v&&Gt&&St&&it.lineAtlas){let At=it.lineAtlas.getDash(Gt,St);At&&rt.setConstantPatternPositions(At)}let[mt,Vt]=l.paint.get("line-trim-offset");(St==="round"||St==="square")&&mt!==Vt&&(mt===0&&(mt-=1),Vt===1&&(Vt+=1));let ot=d.terrain?q.projMatrix:null,Wt=v?o.cB(d,it,l,ot,N,[mt,Vt]):o.cC(d,it,l,ot,at.lineClipsArray.length,N,[mt,Vt]);if(E){let At=at.gradients[l.id],Et=At.texture;if(l.gradientVersion!==At.version){let $t=256;if(l.stepInterpolant){let me=a.getSource().maxzoom,Ie=q.canonical.z===me?Math.ceil(1<<d.transform.maxZoom-q.canonical.z):1;$t=o.aa(o.cD(at.maxLineLength/o.V*1024*Ie),256,H.maxTextureSize)}At.gradient=o.cE({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:$t,image:At.gradient||void 0,clips:at.lineClipsArray}),At.texture?At.texture.update(At.gradient):At.texture=new o.T(H,At.gradient,K.RGBA),At.version=l.gradientVersion,Et=At.texture}H.activeTexture.set(K.TEXTURE1),Et.bind(l.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}J&&(H.activeTexture.set(K.TEXTURE0),it.lineAtlasTexture&&it.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),rt.updatePaintBuffers()),v&&(H.activeTexture.set(K.TEXTURE0),it.imageAtlasTexture&&it.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),rt.updatePaintBuffers()),d.uploadCommonUniforms(H,bt,q.toUnwrapped());let ft=At=>{bt.draw(d,K.TRIANGLES,R,At,I,Ye.disabled,Wt,l.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,l.paint,d.transform.zoom,rt,[at.layoutVertexBuffer2])};if(Q){let At=d.stencilModeForClipping(q).ref;At===0&&d.terrain&&H.clear({stencil:0});let Et={func:K.EQUAL,mask:255};Wt.u_alpha_discard_threshold=.8,ft(new Ce(Et,At,255,K.KEEP,K.KEEP,K.INVERT)),Wt.u_alpha_discard_threshold=0,ft(new Ce(Et,At,255,K.KEEP,K.KEEP,K.KEEP))}else ft(d.stencilModeForClipping(q))}Q&&(d.resetStencilClippingMasks(),d.terrain&&H.clear({stencil:0}))},fill:function(d,a,l,c){let m=l.paint.get("fill-color"),p=l.paint.get("fill-opacity");if(p.constantOr(1)===0)return;let Z=l.paint.get("fill-emissive-strength"),R=d.colorModeForDrapableLayerRenderPass(Z),I=l.paint.get("fill-pattern"),N=d.opaquePassEnabledForLayer()&&!I.constantOr(1)&&m.constantOr(o.ax.transparent).a===1&&p.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===N){let Y=d.depthModeForSublayer(1,d.renderPass==="opaque"?Ne.ReadWrite:Ne.ReadOnly);Qo(d,a,l,c,Y,R,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){let Y=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Ne.ReadOnly);Qo(d,a,l,c,Y,R,!0)}},"fill-extrusion":function(d,a,l,c){let m=l.paint.get("fill-extrusion-opacity"),p=d.context,Z=p.gl,R=d.terrain,I=R&&R.renderingToTexture;if(m===0)return;let N=d.conflationActive&&d.layerUsedInConflation(l,a.getSource());if(N&&function(Y,J,M,T){for(let v of T){let f=J.getTile(v).getBucket(M);f&&(f.updateReplacement(v,Y.replacementSource),f.uploadCentroid(Y.context))}}(d,a,l,c),R||N)for(let Y of c){let J=a.getTile(Y).getBucket(l);J&&qp(d.context,a,Y,J,l,R,N)}if(d.renderPass==="shadow"&&d.shadowRenderer){let Y=d.shadowRenderer;if(R&&m<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;let J=Y.getShadowPassDepthMode(),M=Y.getShadowPassColorMode();pe(d,a,l,c,J,Ce.disabled,M,N)}else if(d.renderPass==="translucent"){let Y=!l.paint.get("fill-extrusion-pattern").constantOr(1),J=l.paint.get("fill-extrusion-color").constantOr(o.ax.white);if(!I&&J.a!==0){let M=new Ne(d.context.gl.LEQUAL,Ne.ReadWrite,d.depthRangeFor3D);m===1&&Y?pe(d,a,l,c,M,Ce.disabled,Pe.unblended,N):(pe(d,a,l,c,M,Ce.disabled,Pe.disabled,N),pe(d,a,l,c,M,d.stencilModeFor3D(),d.colorModeForRenderPass(),N),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&Y&&(!R&&d.transform.projection.name!=="globe"||I)){let M=l.paint.get("fill-extrusion-opacity"),T=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),v=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=l.paint.get("fill-extrusion-flood-light-intensity"),z=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Q=T>0&&v>0,E=f>0,P=(K,w,q)=>(1-q)*K+q*w,H=K=>{let w=d.depthModeForSublayer(1,Ne.ReadOnly,Z.LEQUAL,!0),q=l.paint.get(K?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),it=P(.1,3,q),at=d._showOverdrawInspector;if(!at){let rt=new Ce({func:Z.ALWAYS,mask:255},255,255,Z.KEEP,Z.KEEP,Z.REPLACE),Zt=new Pe([Z.ONE,Z.ONE,Z.ONE,Z.ONE],o.ax.transparent,[!1,!1,!1,!0],Z.MIN);bo(d,a,l,c,w,rt,Zt,Ye.disabled,K,"sdf",M,T,v,f,z,it,N,!1)}{let rt=at?Ce.disabled:new Ce({func:Z.EQUAL,mask:255},255,255,Z.KEEP,Z.DECR,Z.DECR),Zt=at?d.colorModeForRenderPass():new Pe([Z.ONE_MINUS_DST_ALPHA,Z.DST_ALPHA,Z.ONE,Z.ONE],o.ax.transparent,[!0,!0,!0,!0]);bo(d,a,l,c,w,rt,Zt,Ye.disabled,K,"color",M,T,v,f,z,it,N,!1)}};if(I){let K=(w,q,it)=>{let at=d.depthModeForSublayer(1,Ne.ReadOnly,Z.LEQUAL,!1),rt=l.paint.get(w?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Zt=P(.1,3,rt);{let bt=new Pe([Z.ONE,Z.ONE,Z.ONE,Z.ONE],o.ax.transparent,[!1,!1,!1,!0]);bo(d,a,l,c,at,Ce.disabled,bt,Ye.disabled,w,"clear",M,T,v,f,z,Zt,N,q)}{let bt=new Ce({func:Z.ALWAYS,mask:255},255,255,Z.KEEP,Z.KEEP,Z.REPLACE),It=new Pe([Z.ONE,Z.ONE,Z.ONE,Z.ONE],o.ax.transparent,[!1,!1,!1,!0],Z.MIN);bo(d,a,l,c,at,bt,It,Ye.disabled,w,"sdf",M,T,v,f,z,Zt,N,q)}{let bt=w?Z.ZERO:Z.ONE_MINUS_DST_ALPHA,It=new Ce({func:Z.EQUAL,mask:255},255,255,Z.KEEP,Z.DECR,Z.DECR),Gt=new Pe([bt,Z.DST_ALPHA,Z.ONE_MINUS_DST_ALPHA,Z.ZERO],o.ax.transparent,[!0,!0,!0,!0]);bo(d,a,l,c,at,It,Gt,Ye.disabled,w,"color",M,T,v,f,z,Zt,N,q)}{let bt=new Pe([Z.ONE,Z.ONE,Z.ONE,w?Z.ZERO:Z.ONE],o.ax.transparent,[!1,!1,!1,!0],w?Z.FUNC_ADD:Z.MAX);bo(d,a,l,c,at,Ce.disabled,bt,Ye.disabled,w,"clear",M,T,v,f,z,Zt,N,q,it)}};if(Q||E){let w;if(d.prepareDrawTile(),R){let q=R.drapeBufferSize[0],it=R.drapeBufferSize[1];w=R.framebufferCopyTexture,w&&(!w||w.size[0]===q&&w.size[1]===it)||(w&&w.destroy(),w=R.framebufferCopyTexture=new o.T(p,new o.h({width:q,height:it}),Z.RGBA)),w.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Z.copyTexImage2D(Z.TEXTURE_2D,0,Z.RGBA,0,0,q,it,0)}Q&&K(!0,!1,w),E&&K(!1,!0,w)}}else Q&&H(!0),E&&H(!1)}}},hillshade:function(d,a,l,c){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;let m=d.context,p=d.terrain&&d.terrain.renderingToTexture,[Z,R]=d.renderPass!=="translucent"||p?[{},c]:d.stencilConfigForOverlap(c);for(let I of R){let N=a.getTile(I);if(N.needsHillshadePrepare&&d.renderPass==="offscreen")ub(d,N,l);else if(d.renderPass==="translucent"){let Y=d.depthModeForSublayer(0,Ne.ReadOnly),J=l.paint.get("hillshade-emissive-strength"),M=d.colorModeForDrapableLayerRenderPass(J),T=p&&d.terrain?d.terrain.stencilModeForRTTOverlap(I):Z[I.overscaledZ];Jd(d,I,N,l,Y,T,M)}}m.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,a,l,c,m,p){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;let Z=d.transform.projection.name==="globe",R=l.paint.get("raster-elevation")!==0,I=R&&Z;if(d.renderElevatedRasterBackface&&!I)return;let N=d.context,Y=N.gl,J=a.getSource(),M=function(w,q,it,at){let rt=q.paint.get("raster-color"),Zt=w.type==="raster-array",bt=[],It=q.paint.get("raster-resampling"),Gt=q.paint.get("raster-color-mix"),St=q.paint.get("raster-color-range"),mt=[Gt[0],Gt[1],Gt[2],0],Vt=Gt[3],ot=It==="nearest"?at.NEAREST:at.LINEAR;if(Zt&&(bt.push("RASTER_ARRAY"),rt||bt.push("RASTER_COLOR"),It==="linear"&&bt.push("RASTER_ARRAY_LINEAR"),ot=at.NEAREST,!St&&w.rasterLayers)){let Wt=w.rasterLayers.find(({id:ft})=>ft===q.sourceLayer);Wt&&Wt.fields&&Wt.fields.range&&(St=Wt.fields.range)}if(St=St||[0,1],rt){bt.push("RASTER_COLOR"),it.activeTexture.set(at.TEXTURE2),q.updateColorRamp(St);let Wt=q.colorRampTexture;Wt||(Wt=q.colorRampTexture=new o.T(it,q.colorRamp,at.RGBA)),Wt.bind(at.LINEAR,at.CLAMP_TO_EDGE)}return{mix:mt,range:St,offset:Vt,defines:bt,resampling:ot}}(J,l,N,Y);if(J instanceof o.ap&&!c.length&&!Z)return;let T=l.paint.get("raster-emissive-strength"),v=d.colorModeForDrapableLayerRenderPass(T),f=d.terrain&&d.terrain.renderingToTexture,z=!d.options.moving,Q=l.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR;if(J instanceof o.ap&&!c.length&&(J.onNorthPole||J.onSouthPole)){let w=R?d.stencilModeFor3D():Ce.disabled;return void Cb(!!J.onNorthPole,null,d,a,l,T,M,Ye.disabled,w)}if(!c.length)return;let[E,P]=J instanceof o.ap||f?[{},c]:d.stencilConfigForOverlap(c),H=P[P.length-1].overscaledZ;I&&M.defines.push("PROJECTION_GLOBE_VIEW"),R&&M.defines.push("RENDER_CUTOFF");let K=(w,q,it)=>{for(let at of w){let rt=at.toUnwrapped(),Zt=a.getTile(at);if(f&&(!Zt||!Zt.hasData()))continue;N.activeTexture.set(Y.TEXTURE0);let bt=kb(Zt,J,l,M);if(!bt||!bt.texture)continue;let{texture:It,mix:Gt,offset:St,tileSize:mt,buffer:Vt}=bt,ot,Wt;f?(ot=Ne.disabled,Wt=at.projMatrix):R?(ot=new Ne(Y.LEQUAL,Ne.ReadWrite,d.depthRangeFor3D),Wt=Z?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(rt,z)):(ot=d.depthModeForSublayer(at.overscaledZ-H,l.paint.get("raster-opacity")===1?Ne.ReadWrite:Ne.ReadOnly,Y.LESS),Wt=d.transform.calculateProjMatrix(rt,z));let ft=d.terrain&&f?d.terrain.stencilModeForRTTOverlap(at):E[at.overscaledZ],At=p?0:l.paint.get("raster-fade-duration");Zt.registerFadeDuration(At);let Et=a.findLoadedParent(at,0),$t=Rb(Zt,Et,a,d.transform,At),me,Ie;d.terrain&&d.terrain.prepareDrawTile(),N.activeTexture.set(Y.TEXTURE0),It.bind(Q,Y.CLAMP_TO_EDGE),N.activeTexture.set(Y.TEXTURE1),Et?(Et.texture&&Et.texture.bind(Q,Y.CLAMP_TO_EDGE),me=Math.pow(2,Et.tileID.overscaledZ-Zt.tileID.overscaledZ),Ie=[Zt.tileID.canonical.x*me%1,Zt.tileID.canonical.y*me%1]):It.bind(Q,Y.CLAMP_TO_EDGE),It.useMipmap&&N.extTextureFilterAnisotropic&&d.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);let ue=d.transform,Re,Ae=R?Tb(ue):[0,0,0,0],Me,fe,Qe,si,fi,$e=0;if(I&&J instanceof o.ap&&J.coordinates.length>3)Me=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0)))),fe=Float32Array.from(ue.globeMatrix),Qe=Float32Array.from(o.ce(ue)),si=[o.a5(ue.center.lng),o.ae(ue.center.lat)],Re=J.elevatedGlobePerspectiveTransform,fi=J.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){let ei=o.cf(at.canonical);$e=o.cg(ei.getCenter().lat),Me=Float32Array.from(o.aT(o.ci(at.canonical))),fe=Float32Array.from(ue.globeMatrix),Qe=Float32Array.from(o.ce(ue)),si=[o.a5(ue.center.lng),o.ae(ue.center.lat)],Re=[0,0],fi=Float32Array.from(o.ch(at.canonical,ei,$e,ue.worldSize/ue._pixelsPerMercatorPixel))}else Re=J instanceof o.ap?J.perspectiveTransform:[0,0],Me=new Float32Array(16),fe=new Float32Array(9),Qe=new Float32Array(16),si=[0,0],fi=new Float32Array(9);let ia=yb(Wt,Me,fe,Qe,fi,Ie||[0,0],o.S(d.transform.zoom),si,Ae,me||1,$t,l,Re,R?l.paint.get("raster-elevation"):0,2,Gt,St,M.range,mt,Vt,T),ti=d.isTileAffectedByFog(at),pi=d.getOrCreateProgram("raster",{defines:M.defines,overrideFog:ti});if(d.uploadCommonUniforms(N,pi,rt),J instanceof o.ap){let ei=J.elevatedGlobeVertexBuffer,mi=J.elevatedGlobeIndexBuffer;if(f||!Z)J.boundsBuffer&&J.boundsSegments&&pi.draw(d,Y.TRIANGLES,ot,Ce.disabled,v,Ye.disabled,ia,l.id,J.boundsBuffer,d.quadTriangleIndexBuffer,J.boundsSegments);else if(ei&&mi){let Ei=ue.zoom<=o.bG?J.elevatedGlobeSegments:J.getSegmentsForLongitude(ue.center.lng);Ei&&pi.draw(d,Y.TRIANGLES,ot,Ce.disabled,v,q,ia,l.id,ei,mi,Ei)}}else if(I){ot=new Ne(Y.LEQUAL,Ne.ReadOnly,d.depthRangeFor3D);let ei=d.globeSharedBuffers;if(ei){let[mi,Ei,Ri]=ei.getGridBuffers($e,!1);pi.draw(d,Y.TRIANGLES,ot,it||ft,d.colorModeForRenderPass(),q,ia,l.id,mi,Ei,Ri)}}else{let{tileBoundsBuffer:ei,tileBoundsIndexBuffer:mi,tileBoundsSegments:Ei}=d.getTileBoundsBuffers(Zt);pi.draw(d,Y.TRIANGLES,ot,ft,v,Ye.disabled,ia,l.id,ei,mi,Ei)}}if(!(J instanceof o.ap)&&I)for(let at of w){let rt=at.canonical.y===(1<<at.canonical.z)-1;at.canonical.y===0&&Cb(!0,at,d,a,l,T,M,q,it||Ce.disabled),rt&&Cb(!1,at,d,a,l,T,M,q===Ye.frontCW?Ye.backCW:Ye.frontCW,it||Ce.disabled)}};I?K(P,d.renderElevatedRasterBackface?Ye.backCW:Ye.frontCW,d.stencilModeFor3D()):K(P,Ye.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,a,l,c,m,p){d.renderPass==="offscreen"&&function(Z,R,I,N){if(!N.length)return;let Y=Z.context,J=Y.gl,M=R.getSource();if(!(M instanceof Dt))return;let T=[];for(let z of N){let Q=R.getTile(z);if(!(Q instanceof Xo))continue;let E=Qb(Q,M,I);if(!E)continue;let P=[E.tileSize,E.tileSize],H=I.tileFramebuffer;H||(H=I.tileFramebuffer=Y.createFramebuffer(P[0],P[1],!0,null));let K=Q.rasterParticleState,w=I.paint.get("raster-particle-count");K||(K=Q.rasterParticleState=new Ia(Y,z,P,w));let q=K.update(I.lastInvalidatedAt);K.numParticles!==w&&K.setNumParticles(z,w);let it=K.targetColorTexture;K.targetColorTexture=K.backgroundColorTexture,K.backgroundColorTexture=it;let at=K.particleVertices0;K.particleVertices0=K.particleVertices1,K.particleVertices1=at,T.push([z,E,K,q])}if(T.length===0)return;let v=o.f.now(),f=I.previousDrawTimestamp?.001*(v-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=v,I.hasColorMap()){Y.activeTexture.set(J.TEXTURE0+2);let z=I.colorRampTexture;z||(z=I.colorRampTexture=new o.T(Y,I.colorRamp,J.RGBA)),z.bind(J.LINEAR,J.CLAMP_TO_EDGE)}Y.bindFramebuffer.set(I.tileFramebuffer.framebuffer),Y.activeTexture.set(J.TEXTURE0),function(z,Q,E){let P=z.context,H=P.gl,K=Q.tileFramebuffer;P.activeTexture.set(H.TEXTURE0);let w={u_texture:0,u_opacity:1.05*(it=Q.paint.get("raster-particle-fade-opacity-factor"))/(it+.05)},q=z.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var it;for(let at of E){let[,,rt,Zt]=at;K.colorAttachment.set(rt.targetColorTexture.texture),P.viewport.set([0,0,K.width,K.height]),P.clear({color:o.ax.transparent}),Zt&&(rt.backgroundColorTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE),q.draw(z,H.TRIANGLES,Ne.disabled,Ce.disabled,Pe.alphaBlended,Ye.disabled,w,Q.id,z.viewportBuffer,z.quadTriangleIndexBuffer,z.viewportSegments))}}(Z,I,T),function(z,Q,E,P){let H=z.context.gl,K=E.tileFramebuffer,w=z.transform.projection.name==="globe",q=E.paint.get("raster-particle-max-speed");for(let it of P){let[at,rt,Zt]=it;rt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE),K.colorAttachment.set(Zt.targetColorTexture.texture);let bt=z.getOrCreateProgram("rasterParticleDraw",{defines:rt.defines,overrideFog:!1}),It=rt.scalarData?[]:[0,1,2,3].map(mt=>o.cG[mt](at));It.push(at);let Gt=at.canonical.x,St=at.canonical.y;for(let mt of It){let Vt=Q.getTile(w?mt.wrapped():mt);if(!Vt)continue;let ot=Vt.rasterParticleState;if(!ot)continue;let Wt=Pp([mt.canonical.x+(1<<mt.canonical.z)*(mt.wrap-at.wrap)-Gt,mt.canonical.y-St],0,rt.texture.size,2,q,rt.textureOffset,rt.scale,rt.offset);bt.draw(z,H.POINTS,Ne.disabled,Ce.disabled,Pe.alphaBlended,Ye.disabled,Wt,E.id,ot.particleVertices0,void 0,ot.particleSegment)}}}(Z,R,I,T),function(z,Q,E,P){let H=z.context.gl,K=Q.transformFeedbackObject;K||(K=Q.transformFeedbackObject=H.createTransformFeedback()),H.bindTransformFeedback(H.TRANSFORM_FEEDBACK,Q.transformFeedbackObject);let w=Q.paint.get("raster-particle-max-speed"),q=P*Q.paint.get("raster-particle-speed-factor")*.3,it=(at=Q.paint.get("raster-particle-reset-rate-factor"),Math.pow(at,6));var at;for(let rt of E){let[,Zt,bt]=rt;Zt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let It=N0(0,Zt.texture.size,w,q,it,Zt.textureOffset,Zt.scale,Zt.offset);z.getOrCreateProgram("rasterParticleUpdate",{defines:Zt.defines,transformFeedback:{bufferMode:H.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(z,H.POINTS,Ne.disabled,Ce.disabled,Pe.disabled,Ye.disabled,It,Q.id,bt.particleVertices0,void 0,bt.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:bt.particleVertices1,targetIndex:0}])}H.bindTransformFeedback(H.TRANSFORM_FEEDBACK,null)}(Z,I,T,f)}(d,a,l,c),d.renderPass==="translucent"&&(function(Z,R,I,N,Y){let J=Z.context,M=J.gl,T=!Z.options.moving,v=Z.transform.projection.name==="globe";if(!N.length)return;let[f,z]=Z.stencilConfigForOverlap(N),Q=[];v&&Q.push("PROJECTION_GLOBE_VIEW");for(let E of z){let P=E.toUnwrapped(),H=R.getTile(E);if(!H.rasterParticleState)continue;let K=H.rasterParticleState,w=100;H.registerFadeDuration(w);let q=R.findLoadedParent(E,0),it=Rb(H,q,R,Z.transform,w),at,rt;Z.terrain&&Z.terrain.prepareDrawTile(),J.activeTexture.set(M.TEXTURE0),K.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),J.activeTexture.set(M.TEXTURE1),q&&q.rasterParticleState?(q.rasterParticleState.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),at=Math.pow(2,q.tileID.overscaledZ-H.tileID.overscaledZ),rt=[H.tileID.canonical.x*at%1,H.tileID.canonical.y*at%1]):K.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);let Zt=v?Float32Array.from(Z.transform.expandedFarZProjMatrix):Z.transform.calculateProjMatrix(P,T),bt=Z.transform,It=Sb(bt),Gt=o.cf(E.canonical),St=o.cg(Gt.getCenter().lat),mt,Vt,ot,Wt,ft;v?(mt=Float32Array.from(o.aT(o.ci(E.canonical))),Vt=Float32Array.from(bt.globeMatrix),ot=Float32Array.from(o.ce(bt)),Wt=[o.a5(bt.center.lng),o.ae(bt.center.lat)],ft=Float32Array.from(o.ch(E.canonical,Gt,St,bt.worldSize/bt._pixelsPerMercatorPixel))):(mt=new Float32Array(16),Vt=new Float32Array(9),ot=new Float32Array(16),Wt=[0,0],ft=new Float32Array(9));let At=_p(Zt,mt,Vt,ot,ft,rt||[0,0],o.S(Z.transform.zoom),Wt,It,at||1,it,250),Et=Z.isTileAffectedByFog(E),$t=Z.getOrCreateProgram("rasterParticle",{defines:Q,overrideFog:Et});if(Z.uploadCommonUniforms(J,$t,P),v){let me=new Ne(M.LEQUAL,Ne.ReadWrite,Z.depthRangeFor3D),Ie=0,ue=Z.globeSharedBuffers;if(ue){let[Re,Ae,Me]=ue.getGridBuffers(St,Ie!==0);$t.draw(Z,M.TRIANGLES,me,Ce.disabled,Pe.alphaBlended,Ye.backCCW,At,I.id,Re,Ae,Me)}}else{let me=Z.depthModeForSublayer(0,Ne.ReadOnly),Ie=f[E.overscaledZ],{tileBoundsBuffer:ue,tileBoundsIndexBuffer:Re,tileBoundsSegments:Ae}=Z.getTileBoundsBuffers(H);$t.draw(Z,M.TRIANGLES,me,Ie,Pe.alphaBlended,Ye.disabled,At,I.id,ue,Re,Ae)}}Z.resetStencilClippingMasks()}(d,a,l,c),d.style.map.triggerRepaint())},background:function(d,a,l,c){let m=l.paint.get("background-color"),p=l.paint.get("background-opacity"),Z=l.paint.get("background-emissive-strength");if(p===0)return;let R=d.context,I=R.gl,N=d.transform,Y=N.tileSize,J=l.paint.get("background-pattern");if(d.isPatternMissing(J,l.scope))return;let M=!J&&m.a===1&&p===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==M)return;let T=Ce.disabled,v=d.depthModeForSublayer(0,M==="opaque"?Ne.ReadWrite:Ne.ReadOnly),f=d.colorModeForDrapableLayerRenderPass(Z),z=J?"backgroundPattern":"background",Q,E=c;E||(Q=d.getBackgroundTiles(),E=Object.values(Q).map(P=>P.tileID)),J&&(R.activeTexture.set(I.TEXTURE0),d.imageManager.bind(d.context,l.scope));for(let P of E){let H=d.isTileAffectedByFog(P),K=d.getOrCreateProgram(z,{overrideFog:H}),w=P.toUnwrapped(),q=c?P.projMatrix:d.transform.calculateProjMatrix(w);d.prepareDrawTile();let it=a?a.getTile(P):Q?Q[P.key]:new to(P,Y,N.zoom,d),at=J?Ws(q,Z,p,d,J,l.scope,{tileID:P,tileSize:Y}):Bb(q,Z,p,m);d.uploadCommonUniforms(R,K,w);let{tileBoundsBuffer:rt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:bt}=d.getTileBoundsBuffers(it);K.draw(d,I.TRIANGLES,v,T,f,Ye.disabled,at,l.id,rt,Zt,bt)}},sky:function(d,a,l){let c=d._atmosphere?o.S(d.transform.zoom):1,m=l.paint.get("sky-opacity")*c;if(m===0)return;let p=d.context,Z=l.paint.get("sky-type"),R=new Ne(p.gl.LEQUAL,Ne.ReadOnly,[0,1]),I=d.frameCounter/1e3%1;Z==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(N,Y,J,M){let T=N.context,v=T.gl,f=Y.skyboxFbo;if(!f){f=Y.skyboxFbo=T.createFramebuffer(32,32,!0,null),Y.skyboxGeometry=new wb(T),Y.skyboxTexture=T.gl.createTexture(),v.bindTexture(v.TEXTURE_CUBE_MAP,Y.skyboxTexture),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,v.LINEAR);for(let P=0;P<6;++P)v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+P,0,v.RGBA,32,32,0,v.RGBA,v.UNSIGNED_BYTE,null)}T.bindFramebuffer.set(f.framebuffer),T.viewport.set([0,0,32,32]);let z=Y.getCenter(N,!0),Q=N.getOrCreateProgram("skyboxCapture"),E=new Float64Array(16);o.a6.identity(E),o.a6.rotateY(E,E,.5*-Math.PI),So(N,Y,Q,E,z,0),o.a6.identity(E),o.a6.rotateY(E,E,.5*Math.PI),So(N,Y,Q,E,z,1),o.a6.identity(E),o.a6.rotateX(E,E,.5*-Math.PI),So(N,Y,Q,E,z,2),o.a6.identity(E),o.a6.rotateX(E,E,.5*Math.PI),So(N,Y,Q,E,z,3),o.a6.identity(E),So(N,Y,Q,E,z,4),o.a6.identity(E),o.a6.rotateY(E,E,Math.PI),So(N,Y,Q,E,z,5),T.viewport.set([0,0,N.width,N.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(N,Y,J,M,T){let v=N.context,f=v.gl,z=N.transform,Q=N.getOrCreateProgram("skybox");v.activeTexture.set(f.TEXTURE0),f.bindTexture(f.TEXTURE_CUBE_MAP,Y.skyboxTexture);let E=((P,H,K,w,q)=>({u_matrix:P,u_sun_direction:H,u_cubemap:0,u_opacity:w,u_temporal_offset:q}))(z.skyboxMatrix,Y.getCenter(N,!1),0,M,T);N.uploadCommonUniforms(v,Q),Q.draw(N,f.TRIANGLES,J,Ce.disabled,N.colorModeForRenderPass(),Ye.backCW,E,"skybox",Y.skyboxGeometry.vertexBuffer,Y.skyboxGeometry.indexBuffer,Y.skyboxGeometry.segment)}(d,l,R,m,I):Z==="gradient"&&d.renderPass==="sky"&&function(N,Y,J,M,T){let v=N.context,f=v.gl,z=N.transform,Q=N.getOrCreateProgram("skyboxGradient");Y.skyboxGeometry||(Y.skyboxGeometry=new wb(v)),v.activeTexture.set(f.TEXTURE0);let E=Y.colorRampTexture;E||(E=Y.colorRampTexture=new o.T(v,Y.colorRamp,f.RGBA)),E.bind(f.LINEAR,f.CLAMP_TO_EDGE);let P=((H,K,w,q,it)=>({u_matrix:H,u_color_ramp:0,u_center_direction:K,u_radius:o.bj(w),u_opacity:q,u_temporal_offset:it}))(z.skyboxMatrix,Y.getCenter(N,!1),Y.paint.get("sky-gradient-radius"),M,T);N.uploadCommonUniforms(v,Q),Q.draw(N,f.TRIANGLES,J,Ce.disabled,N.colorModeForRenderPass(),Ye.backCW,P,"skyboxGradient",Y.skyboxGeometry.vertexBuffer,Y.skyboxGeometry.indexBuffer,Y.skyboxGeometry.segment)}(d,l,R,m,I)},debug:function(d,a,l,c,m,p){for(let Z=0;Z<l.length;Z++)if(m){let N=new o.ax(c.r*.8,c.g*.8,c.b*.8,1);ho(d,a,l[Z],c,-1,-1,p),ho(d,a,l[Z],c,-1,1,p),ho(d,a,l[Z],c,1,1,p),ho(d,a,l[Z],c,1,-1,p),ho(d,a,l[Z],N,0,0,p)}else ho(d,a,l[Z],c,0,0,p)},custom:function(d,a,l,c){let m=d.context,p=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isLayerDraped(a)){if(d.renderPass==="offscreen"){let Z=p.prerender;if(Z){if(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){let R=d.transform.pointMerc;Z.call(p,m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.S(d.transform.zoom),[R.x,R.y],d.transform.pixelsPerMeterRatio)}else Z.call(p,m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){let R=p.renderToTile;if(R){let I=c[0].canonical,N=new o.L(I.x+c[0].wrap*(1<<I.z),I.y,I.z);m.setDepthMode(Ne.disabled),m.setStencilMode(Ce.disabled),m.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),R.call(p,m.gl,N),m.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(Ce.disabled);let Z=p.renderingMode==="3d"?new Ne(d.context.gl.LEQUAL,Ne.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Ne.ReadOnly);if(m.setDepthMode(Z),d.transform.projection.name==="globe"){let R=d.transform.pointMerc;p.render(m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.S(d.transform.zoom),[R.x,R.y],d.transform.pixelsPerMeterRatio)}else p.render(m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,a,l,c){if(d.renderPass==="opaque")return;let m=l.paint.get("model-opacity");if(m===0)return;let p=l.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!p||d.terrain&&m<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;let Z=d.shadowRenderer,R=l.paint.get("model-receive-shadows");Z&&(Z.useNormalOffset=!0,R||(Z.enabled=!1));let I=()=>{Z&&(Z.useNormalOffset=!0,R||(Z.enabled=!0))},N=a.getSource();if(d.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return function(Q,E,P,H){let K=Q.transform;if(K.projection.name!=="mercator")return void o.w("Drawing 3D models for ".concat(K.projection.name," projection is not yet implemented"));let w=K.getFreeCameraOptions().position;if(!Q.modelManager)return;let q=Q.modelManager;P.modelManager=q;let it=Q.shadowRenderer;if(!P._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let at=P._unevaluatedLayout._values["model-id"],rt={...P.layout.get("model-id").parameters};for(let Zt of H){let bt=E.getTile(Zt).getBucket(P);if(!bt||bt.projection.name!==K.projection.name)continue;let It=C0(Zt,K);rt.zoom=It;let Gt=at.possiblyEvaluate(rt);if(Eb(Q,bt,Zt),kn.shadowUniformsInitialized=!1,kn.useSingleShadowCascade=!!it&&it.getMaxCascadeForTile(Zt.toUnwrapped())===0,Q.renderPass==="shadow"&&it){if(Q.currentShadowCascade===1&&bt.isInsideFirstShadowMapFrustum)continue;let Vt=K.calculatePosMatrix(Zt.toUnwrapped(),K.worldSize);if(kn.tileMatrix.set(Vt),kn.shadowTileMatrix=Float32Array.from(it.calculateShadowPassMatrixFromMatrix(Vt)),kn.aabb.min.fill(0),kn.aabb.max[0]=kn.aabb.max[1]=o.V,kn.aabb.max[2]=0,eW(bt,kn,Q,P.scope))continue}let St=1<<Zt.canonical.z,mt=[((w.x-Zt.wrap)*St-Zt.canonical.x)*o.V,(w.y*St-Zt.canonical.y)*o.V,w.z*St*o.V];for(let Vt in bt.instancesPerModel){let ot=bt.instancesPerModel[Vt];ot.features.length>0&&(Vt=Gt.evaluate(ot.features[0].feature,{}));let Wt=q.getModel(Vt,P.scope);if(Wt&&Wt.uploaded)for(let ft of Wt.nodes)Ab(Q,P,ft,ot,mt,Zt,kn)}}}(d,a,l,c),void I();if(!N.loaded())return;if(N.type==="batched-model")return function(Q,E,P,H){P.resetLayerRenderingStats(Q);let K=Q.context,w=Q.transform,q=Q.style.fog,it=Q.shadowRenderer;if(w.projection.name!=="mercator")return void o.w("Drawing 3D landmark models for ".concat(w.projection.name," projection is not yet implemented"));let at=Q.transform.getFreeCameraOptions().position,rt=o.N.scale([],[at.x,at.y,at.z],Q.transform.worldSize);o.N.negate(rt,rt);let Zt=o.a6.identity([]),bt=o.cR(w.center.lat,w.zoom),It=o.a6.fromScaling([],[1,1,1/bt]);o.a6.translate(Zt,Zt,rt);let Gt=P.paint.get("model-opacity"),St=new Ne(K.gl.LEQUAL,Ne.ReadWrite,Q.depthRangeFor3D),mt=new Ne(K.gl.LEQUAL,Ne.ReadOnly,Q.depthRangeFor3D),Vt=new o.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=Q.renderPass==="shadow",Wt=ot&&it?it.getCurrentCascadeFrustum():w.getFrustum(w.scaleZoom(w.worldSize)),ft=P.getLayerRenderingStats(),At=function(Et,$t){for(let me of H){let Ie=E.getTile(me).getBucket(P);if(!Ie||!Ie.uploaded)continue;let ue=!1;it&&(ue=it.getMaxCascadeForTile(me.toUnwrapped())===0);let Re=w.calculatePosMatrix(me.toUnwrapped(),w.worldSize),Ae=Ie.modelTraits;for(let Me of Ie.getNodesInfo()){if(Me.hiddenByReplacement||!Me.node.meshes)continue;let fe=Me.evaluatedScale,Qe=Me.node,si=0;if(Q.terrain&&Qe.elevation&&(si=Qe.elevation*Q.terrain.exaggeration()),fe[0]<=1&&fe[1]<=1&&fe[2]<=1&&(()=>{let Ei=Me.getLocalBounds();return Vt.min=[...Ei.min],Vt.max=[...Ei.max],Vt.min[2]+=si,Vt.max[2]+=si,o.N.transformMat4(Vt.min,Vt.min,Re),o.N.transformMat4(Vt.max,Vt.max,Re),Vt})().intersects(Wt)===0)continue;let fi=Q.renderPass==="light-beam",$e=[...Re];o.a6.translate($e,$e,[(Qe.anchor?Qe.anchor[0]:0)*(fe[0]-1),(Qe.anchor?Qe.anchor[1]:0)*(fe[1]-1),si]),o.N.exactEquals(fe,o.cT)||o.a6.scale($e,$e,fe),o.a6.multiply($e,$e,Qe.matrix);let ia=o.a6.multiply([],It,$e);o.a6.multiply(ia,Zt,ia);let ti=o.a6.invert([],ia);o.a6.transpose(ti,ti),o.a6.scale(ti,ti,Ir);let pi=o.a6.multiply([],w.expandedFarZProjMatrix,$e),ei=Ae&o.cV.HasMapboxMeshFeatures,mi=ei?0:Me.evaluatedRMEA[0][2];for(let Ei=0;Ei<Qe.meshes.length;++Ei){let Ri=Qe.meshes[Ei],Sa=Ei===Qe.lightMeshIndex;if(Sa){if(!fi&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}}else if(fi)continue;let Ka={defines:[]},Nn=[];if(ea(Ka.defines,Nn,Ri,Q),ei||Ka.defines.push("DIFFUSE_SHADED"),ue&&Ka.defines.push("SHADOWS_SINGLE_CASCADE"),ft&&(ot?ft.numRenderedVerticesInShadowPass+=Ri.vertexArray.length:ft.numRenderedVerticesInTransparentPass+=Ri.vertexArray.length),ot){ut(Ri,$e,Q,P);continue}let Fl=null;if(q){let Xn=fo($e,Q.transform);if(Fl=new Float32Array(Xn),w.projection.name!=="globe"){let Il=Ri.aabb.min,go=Ri.aabb.max,[Lo,Ss]=q.getOpacityForBounds(Xn,Il[0],Il[1],go[0],go[1]);Ka.overrideFog=Lo>=xi||Ss>=xi}}let Yn=Ri.material,fa;Yn.occlusionTexture&&Yn.occlusionTexture.offsetScale&&(fa=Yn.occlusionTexture.offsetScale,Ka.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ot&&it&&(it.useNormalOffset=!!Ri.normalBuffer);let xa=Q.getOrCreateProgram("model",Ka);!ot&&it&&it.setupShadowsFromMatrix($e,xa,it.useNormalOffset),Q.uploadCommonUniforms(K,xa,me.toUnwrapped(),Fl);let dn=Yn.pbrMetallicRoughness;dn.metallicFactor=.9,dn.roughnessFactor=.5;let un=kd(new Float32Array(pi),new Float32Array(ia),new Float32Array(ti),Q,Gt,dn.baseColorFactor,Yn.emissiveFactor,dn.metallicFactor,dn.roughnessFactor,Yn,mi,P,[0,0,0],fa);xa.draw(Q,K.gl.TRIANGLES,$t&&!Sa?St:mt,Ce.disabled,Et?Sa||Gt<1||Me.hasTranslucentParts?Pe.alphaBlended:Pe.unblended:Pe.disabled,Ye.backCCW,un,P.id,Ri.vertexBuffer,Ri.indexBuffer,Ri.segments,P.paint,Q.transform.zoom,void 0,Nn)}}}};(function(Et,$t,me,Ie){let ue=Et.terrain?Et.terrain.exaggeration():0,Re=Et.transform.zoom;for(let Ae of Ie){let Me=$t.getTile(Ae).getBucket(me);Me&&(Et.conflationActive&&Me.updateReplacement(Ae,Et.replacementSource),Me.evaluateScale(Et,me),Et.terrain&&ue>0&&Me.elevationUpdate(Et.terrain,ue,Ae,me.source),Me.needsReEvaluation(Et,Re,me)&&Me.evaluate(me))}})(Q,E,P,H),Gt===1?At(!0,!0):(At(!1,!0),At(!0,!1))}(d,a,l,c),void I();let Y=N.getModels(),J=[],M=d.transform.getFreeCameraOptions().position,T=o.N.scale([],[M.x,M.y,M.z],d.transform.worldSize);o.N.negate(T,T);let v=[],f=[],z=0;for(let Q of Y){let E=l.paint.get("model-rotation").constantOr(null),P=l.paint.get("model-scale").constantOr(null),H=l.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(d,E,P,H,!0,!0,!1);let K=o.a6.identity([]),w=o.cR(Q.position.lat,d.transform.zoom),q=o.a6.fromScaling([],[1,1,1/w]);o.a6.translate(K,K,T),J.push({zScaleMatrix:q,negCameraPosMatrix:K});for(let it of Q.nodes)Gs(d.transform,it,Q.matrix,d.transform.expandedFarZProjMatrix,z,v,f);z++}if(v.sort((Q,E)=>E.depth-Q.depth),d.renderPass!=="shadow"){if(m===1)for(let Q of f)Rs(Q,d,l,J[Q.modelIndex],Ce.disabled,d.colorModeForRenderPass());else{for(let Q of f)Rs(Q,d,l,J[Q.modelIndex],Ce.disabled,Pe.disabled);for(let Q of f)Rs(Q,d,l,J[Q.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(let Q of v)Rs(Q,d,l,J[Q.modelIndex],Ce.disabled,d.colorModeForRenderPass());I()}else{for(let Q of f)ut(Q.mesh,Q.nodeModelMatrix,d,l);for(let Q of v)ut(Q.mesh,Q.nodeModelMatrix,d,l);I()}}},Hb={model:function(d,a,l){let c=d.scope,m=a.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,c));if(m.type==="batched-model")return;let p=m.getModels();for(let Z of p)Z.upload(l.context)},raster:function(d,a,l){let c=a.getSource();if(!(c instanceof Dt&&c.loaded()))return;let m=d.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;let p=d.paint.get("raster-array-band")||c.getInitialBand(m);if(p==null)return;let Z=a.getIds().map(R=>a.getTileByID(R));for(let R of Z)R.updateNeeded(m,p)&&c.prepareTile(R,m,p)},"raster-particle":function(d,a,l){let c=a.getSource();if(!(c instanceof Dt&&c.loaded()))return;let m=d.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;let p=d.paint.get("raster-particle-array-band")||c.getInitialBand(m);if(p==null)return;let Z=a.getIds().map(R=>a.getTileByID(R));for(let R of Z)R.updateNeeded(m,p)&&c.prepareTile(R,m,p)}};class k0{constructor(a,l,c,m){this.context=new n0(a,l),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._debugParams={showTerrainProxyTiles:!1},m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=al.maxUnderzooming+al.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new sb(this),this._wireframeDebugCache=new T0,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(a,l){let c=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Dp(this,a));let m=this._terrain;this.transform.elevation=c?m:null,m.update(a,this.transform,l),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(a){let l=a.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[c,m]=l.getFovAdjustedRange(this.transform._fov);if(c>m)return void(this.transform.fogCullDistSq=null);let p=c+.78*(m-c);this.transform.fogCullDistSq=p*p}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(a,l){if(this.width=a*o.f.devicePixelRatio,this.height=l*o.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let c of this.style.order)this.style._mergedLayers[c].resize()}setup(){let a=this.context,l=new o.aN;l.emplaceBack(0,0),l.emplaceBack(o.V,0),l.emplaceBack(0,o.V),l.emplaceBack(o.V,o.V),this.tileExtentBuffer=a.createVertexBuffer(l,o.aP.members),this.tileExtentSegments=o.aB.simpleSegment(0,0,4,2);let c=new o.aN;c.emplaceBack(0,0),c.emplaceBack(o.V,0),c.emplaceBack(0,o.V),c.emplaceBack(o.V,o.V),this.debugBuffer=a.createVertexBuffer(c,o.aP.members),this.debugSegments=o.aB.simpleSegment(0,0,4,5);let m=new o.aN;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(m,o.aP.members),this.viewportSegments=o.aB.simpleSegment(0,0,4,2);let p=new o.av;p.emplaceBack(0,0,0,0),p.emplaceBack(o.V,0,o.V,0),p.emplaceBack(0,o.V,0,o.V),p.emplaceBack(o.V,o.V,o.V,o.V),this.mercatorBoundsBuffer=a.createVertexBuffer(p,o.aR.members),this.mercatorBoundsSegments=o.aB.simpleSegment(0,0,4,2);let Z=new o.aw;Z.emplaceBack(0,1,2),Z.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(Z);let R=new o.aO;for(let N of[0,1,3,2,0])R.emplaceBack(N);this.debugIndexBuffer=a.createIndexBuffer(R),this.emptyTexture=new o.T(a,new o.h({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=o.a6.create();let I=this.context.gl;this.stencilClearMode=new Ce({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let a=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,a.TRIANGLES,Ne.disabled,this.stencilClearMode,Pe.disabled,Ye.disabled,Vb(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,l,c){if(!l||this.currentStencilSource===l.id||!a.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(let I of c)if(this._tileClippingMaskIDs[I.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=l.id;let m=this.context,p=m.gl;this.nextStencilID+c.length>256&&this.clearStencil(),m.setColorMode(Pe.disabled),m.setDepthMode(Ne.disabled);let Z=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let R of c){let I=l.getTile(R),N=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:Y,tileBoundsIndexBuffer:J,tileBoundsSegments:M}=this.getTileBoundsBuffers(I);Z.draw(this,p.TRIANGLES,Ne.disabled,new Ce({func:p.ALWAYS,mask:0},N,255,p.KEEP,p.KEEP,p.REPLACE),Pe.disabled,Ye.disabled,Vb(R.projMatrix),"$clipping",Y,J,M)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let a=this.nextStencilID++,l=this.context.gl;return new Ce({func:l.NOTEQUAL,mask:255},a,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);let l=this.context.gl;return new Ce({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(a){let l=this.context.gl,c=a.sort((Z,R)=>R.overscaledZ-Z.overscaledZ),m=c[c.length-1].overscaledZ,p=c[0].overscaledZ-m+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();let Z={};for(let R=0;R<p;R++)Z[R+m]=new Ce({func:l.GEQUAL,mask:255},R+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=p,[Z,c]}return[{[m]:Ce.disabled},c]}colorModeForRenderPass(){let a=this.context.gl;return this._showOverdrawInspector?new Pe([a.CONSTANT_COLOR,a.ONE,a.CONSTANT_COLOR,a.ONE],new o.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Pe.unblended:Pe.alphaBlended}colorModeForDrapableLayerRenderPass(a){let l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Pe([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.ax(0,0,0,a===void 0?0:a),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(a,l,c,m=!1){if(!this.opaquePassEnabledForLayer()&&!m)return Ne.disabled;let p=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Ne(c||this.context.gl.LEQUAL,l,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,l){this._wireframeDebugCache.update(this.frameCounter),this.style=a,this.options=l;let c=this.style._mergedLayers,m=this.style.order,p=m.map(w=>c[w]),Z=this.style._mergedSourceCaches;this.imageManager=a.imageManager,this.modelManager=a.modelManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.f.now()),this.imageManager.beginFrame();let R=0,I=!1;for(let w in Z){let q=Z[w];q.used&&(q.prepare(this.context),q.getSource().usedInConflation&&++R)}for(let w of p)w.isHidden(this.transform.zoom)||this.prepareLayer(w);let N={},Y={},J={},M={},T={};for(let w in Z){let q=Z[w];N[w]=q.getVisibleCoordinates(),Y[w]=N[w].slice().reverse(),J[w]=q.getVisibleCoordinates(!0).reverse(),M[w]=q.getShadowCasterCoordinates(),T[w]=q.sortCoordinatesByDistance(N[w])}let v=w=>{let q=this.style.getLayerSourceCache(w);return q&&q.used?q.getSource():null};if(R){let w=[];for(let q of p)this.layerUsedInConflation(q,v(q))&&w.push(q);if(w&&w.length>1){let q=[];for(let it of w){let at=this.style.getLayerSourceCache(it);at&&at.used&&at.getSource().usedInConflation&&q.push({layer:it.fqid,cache:at})}this.replacementSource.setSources(q),I=!0}}I||this.replacementSource.clear(),this.conflationActive=I,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let w of p){let q=w.cutoffRange();if(this.longestCutoffRange=Math.max(q,this.longestCutoffRange),q>0){let it=v(w);it&&(this.minCutoffZoom=Math.max(it.minzoom,this.minCutoffZoom)),w.minzoom&&(this.minCutoffZoom=Math.max(w.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let w=0;w<p.length;w++)if(p[w].is3D()){this.opaquePassCutoff=w;break}let f=this.style&&this.style.fog;f?(this._fogVisible=f.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=f.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(J),this.opaquePassCutoff=0);let z=this._shadowRenderer;if(z){z.updateShadowParameters(this.transform,this.style.directionalLight);for(let w in Z)for(let q of N[w]){let it={min:0,max:0};this.terrain&&(it=this.terrain.getMinMaxForTile(q)||it),z.addShadowReceiver(q.toUnwrapped(),it.min,it.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ue(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.cZ(this.context.gl))return;this.renderPass="offscreen";for(let w of p){let q=a.getLayerSourceCache(w);if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;let it=q?Y[q.id]:void 0;(w.type==="custom"||w.type==="raster"||w.type==="raster-particle"||w.isSky()||it&&it.length)&&this.renderLayer(this,q,w,it)}this.depthRangeFor3D=[0,1-(p.length+2)*this.numSublayers*this.depthEpsilon];let Q=this.terrain;Q&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&Q.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,M)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let E=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),P=(()=>{if(l.showOverdrawInspector)return o.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!E){let w=this.style.fog.properties.get("color").toArray01();return new o.ax(...w)}if(this.style.fog&&this.transform.projection.supportsFog&&E){let w=this.style.fog.properties.get("space-color").toArray01();return new o.ax(...w)}return o.ax.transparent})();if(this.context.clear({color:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&E&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){let w=p[this.currentLayer],q=a.getLayerSourceCache(w);if(w.isSky())continue;let it=q?(w.is3D()?T:Y)[q.id]:void 0;this._renderTileClippingMasks(w,q,it),this.renderLayer(this,q,w,it)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&E&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){let w=p[this.currentLayer],q=a.getLayerSourceCache(w);w.isSky()&&this.renderLayer(this,q,w,q?Y[q.id]:void 0)}function H(w,q){let it;return q&&(it=(w.type==="symbol"?J:w.is3D()?T:Y)[q.id]),it}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<m.length;){let w=p[this.currentLayer];if(w.type==="raster"){let q=a.getLayerSourceCache(w);this.renderLayer(this,q,w,H(w,q))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let K=0;for(z&&(K=z.getShadowCastingLayerCount());this.currentLayer<m.length;){let w=p[this.currentLayer],q=a.getLayerSourceCache(w);if(w.isSky())++this.currentLayer;else if(Q&&this.style.isLayerDraped(w)){if(w.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=Q.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(w,q,q?N[q.id]:void 0),this.renderLayer(this,q,w,H(w,q)),!Q&&z&&K>0&&w.hasShadowPass()&&--K==0&&(z.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let it=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=it;this.currentLayer++){let at=p[this.currentLayer];if(!at.hasLightBeamPass())continue;let rt=a.getLayerSourceCache(at);this.renderLayer(this,rt,at,rt?Y[rt.id]:void 0)}this.currentLayer=it,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let w=null;p.forEach(q=>{let it=a.getLayerSourceCache(q);it&&!q.isHidden(this.transform.zoom)&&it.getVisibleCoordinates().length&&(!w||w.getSource().maxzoom<it.getSource().maxzoom)&&(w=it)}),w&&this.options.showTileBoundaries&&Is.debug(this,w,w.getVisibleCoordinates(),o.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Is.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(w){let q=w.transform.padding;Lb(w,w.transform.height-(q.top||0),3,Un),Lb(w,q.bottom||0,3,mo),Tn(w,q.left||0,3,M0),Tn(w,w.transform.width-(q.right||0),3,fb);let it=w.transform.centerPoint;(function(at,rt,Zt,bt){ta(at,rt-1,Zt-10,2,20,bt),ta(at,rt-10,Zt-1,20,2,bt)})(w,it.x,w.transform.height-it.y,vb)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),I||(this.conflationActive=!1)}prepareLayer(a){this.gpuTimingStart(a);let{unsupportedLayers:l}=this.transform.projection,c=!l||!l.includes(a.type);if(Hb[a.type]&&(c||this.terrain&&a.type==="custom")){let m=this.style.getLayerSourceCache(a);Hb[a.type](a,m,this)}this.gpuTimingEnd()}renderLayer(a,l,c,m){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||m&&m.length)&&(this.id=c.id,this.gpuTimingStart(c),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(c.type)||a.terrain&&c.type==="custom")&&Is[c.type](a,l,c,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery,c=this.context.gl,m=this.gpuTimers[a.id];m||(m=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:c.createQuery()}),m.calls++,c.beginQuery(l.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let a=this.context.extTimerQuery,l=this.context.gl,c=l.createQuery();this.deferredRenderGpuTimeQueries.push(c),l.beginQuery(a.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){let a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){let l={};for(let c in a){let m=a[c],p=this.context.extTimerQuery,Z=p.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;p.deleteQueryEXT(m.query),l[c]=Z}return l}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;let l=this.context.extTimerQuery,c=this.context.gl,m=0;for(let p of a)m+=l.getQueryParameter(p,c.QUERY_RESULT)/1e6,l.deleteQueryEXT(p);return m}translatePosMatrix(a,l,c,m,p){if(!c[0]&&!c[1])return a;let Z=p?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(Z){let N=Math.sin(Z),Y=Math.cos(Z);c=[c[0]*Y-c[1]*N,c[0]*N+c[1]*Y]}let R=[p?c[0]:o.a3(l,c[0],this.transform.zoom),p?c[1]:o.a3(l,c[1],this.transform.zoom),0],I=new Float32Array(16);return o.a6.translate(I,a,R),I}saveTileTexture(a){let l=a.size[0],c=this._tileTextures[l];c?c.push(a):this._tileTextures[l]=[a]}getTileTexture(a){let l=this._tileTextures[a];return l&&l.length>0?l.pop():null}isPatternMissing(a,l){return a===null||a!==void 0&&!this.imageManager.getPattern(a.toString(),l)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(a,l,c){let m=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,p=this.terrain&&this.terrain.exaggeration()===0,Z=[];return this.style&&this.style.enable3dLights()&&(a==="globeRaster"||a==="terrainRaster"?(Z.push("LIGHTING_3D_MODE"),Z.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||Z.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||Z.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?Z.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):Z.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(Z.push("TERRAIN"),this.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),p&&Z.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&Z.push("GLOBE"),!this._fogVisible||m||l!==void 0&&!l||Z.push("FOG","FOG_DITHERING"),m&&Z.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&Z.push("OVERDRAW_INSPECTOR"),Z}getOrCreateProgram(a,l){this.cache=this.cache||{};let c=l&&l.defines||[],m=l&&l.config,p=l&&l.transformFeedback,Z=this.currentGlobalDefines(a,l&&l.overrideFog,l&&l.overrideRtt).concat(c),R=Ib.cacheKey(pb[a],a,Z,m);return this.cache[R]||(this.cache[R]=new Ib(this.context,a,pb[a],m,Kp[a],Z,p)),this.cache[R]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(a,l){if(this.style.enable3dLights()){let c=this.style.directionalLight,m=this.style.ambientLight;if(c&&m){let p=((Z,R)=>{let I=Z.properties.get("direction"),N=Z.properties.get("color").toArray01(),Y=Z.properties.get("intensity"),J=R.properties.get("color").toArray01(),M=R.properties.get("intensity"),T=[I.x,I.y,I.z],v=o.cn(J,M),f=o.cn(N,Y);return{u_lighting_ambient_color:v,u_lighting_directional_dir:T,u_lighting_directional_color:f,u_ground_radiance:Gb(T,f,v)}})(c,m);l.setLightsUniformValues(a,p)}}}uploadCommonUniforms(a,l,c,m,p){if(this.uploadCommonLightUniforms(a,l),this.terrain&&this.terrain.renderingToTexture)return;let Z=this.style.fog;if(Z){let R=Z.getOpacity(this.transform.pitch),I=((N,Y,J,M,T,v,f,z,Q,E,P,H)=>{let K=N.transform,w=Y.properties.get("color").toArray01();w[3]=M;let q=N.frameCounter/1e3%1,[it,at]=Y.properties.get("vertical-range");return{u_fog_matrix:J?K.calculateFogTileMatrix(J):H||N.identityMat,u_fog_range:Y.getFovAdjustedRange(K._fov),u_fog_color:w,u_fog_horizon_blend:Y.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(it,at),at],u_fog_temporal_offset:q,u_frustum_tl:T,u_frustum_tr:v,u_frustum_br:f,u_frustum_bl:z,u_globe_pos:Q,u_globe_radius:E,u_viewport:P,u_globe_transition:o.S(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,Z,c,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.f.devicePixelRatio,this.transform.height*o.f.devicePixelRatio],m);l.setFogUniformValues(a,I)}p&&l.setCutoffUniformValues(a,p.uniformValues)}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){let a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){let a=this.context.gl,l=a.createTexture();return a.bindTexture(a.TEXTURE_2D,l),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let a=this._backgroundTiles,l=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(let m of c)l[m.key]=a[m.key]||new to(m,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(a,l){return!(!a.is3D()||a.minzoom&&a.minzoom>this.transform.zoom||a.sourceLayer!=="building"&&(!l||l.type!=="batched-model"))}isTileAffectedByFog(a){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[a.key];return l||(this._cachedTileFogOpacities[a.key]=l=this.style.fog.getOpacityForTile(a)),l[0]>=xi||l[1]>=xi}}function Us(d,a){let l=!1,c=null,m=()=>{c=null,l&&(d(),c=setTimeout(m,a),l=!1)};return()=>(l=!0,c||m(),c)}class fd{constructor(a){this._hashName=a&&encodeURIComponent(a),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Us(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let a=this._map;if(!a)return"";let l=jb(a);if(this._hashName){let c=this._hashName,m=!1,p=location.hash.slice(1).split("&").map(Z=>{let R=Z.split("=")[0];return R===c?(m=!0,"".concat(R,"=").concat(l)):Z}).filter(Z=>Z);return m||p.push("".concat(c,"=").concat(l)),"#".concat(p.join("&"))}return"#".concat(l)}_getCurrentHash(){let a=location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return a.split("/")}_onHashChange(){let a=this._map;if(!a)return!1;let l=this._getCurrentHash();if(l.length>=3&&!l.some(c=>isNaN(c))){let c=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(l[3]||0):a.getBearing();return a.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:c,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function jb(d,a){let l=d.getCenter(),c=Math.round(100*d.getZoom())/100,m=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,m),Z=Math.round(l.lng*p)/p,R=Math.round(l.lat*p)/p,I=d.getBearing(),N=d.getPitch(),Y=a?"/".concat(Z,"/").concat(R,"/").concat(c):"".concat(c,"/").concat(R,"/").concat(Z);return(I||N)&&(Y+="/"+Math.round(10*I)/10),N&&(Y+="/".concat(Math.round(N))),Y}let xs={linearity:.3,easing:o.c_(0,0,.3,1)},xn=o.e({deceleration:2500,maxSpeed:1400},xs),aW=o.e({deceleration:20,maxSpeed:1400},xs),vd=o.e({deceleration:1e3,maxSpeed:360},xs),Di=o.e({deceleration:1e3,maxSpeed:90},xs);class Ni{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.f.now(),settings:a})}_drainInertiaBuffer(){let a=this._inertiaBuffer,l=o.f.now();for(;a.length>0&&l-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:p}of this._inertiaBuffer)l.zoom+=p.zoomDelta||0,l.bearing+=p.bearingDelta||0,l.pitch+=p.pitchDelta||0,p.panDelta&&l.pan._add(p.panDelta),p.around&&(l.around=p.around),p.pinchAround&&(l.pinchAround=p.pinchAround);let c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(l.pan.mag()){let p=sl(l.pan.mag(),c,o.e({},xn,a||{}));m.offset=l.pan.mult(p.amount/l.pan.mag()),m.center=this._map.transform.center,Ns(m,p)}if(l.zoom){let p=sl(l.zoom,c,aW);m.zoom=this._map.transform.zoom+p.amount,Ns(m,p)}if(l.bearing){let p=sl(l.bearing,c,vd);m.bearing=this._map.transform.bearing+o.aa(p.amount,-179,179),Ns(m,p)}if(l.pitch){let p=sl(l.pitch,c,Di);m.pitch=this._map.transform.pitch+p.amount,Ns(m,p)}if(m.zoom||m.bearing){let p=l.pinchAround===void 0?l.around:l.pinchAround;m.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Ns(d,a){(!d.duration||d.duration<a.duration)&&(d.duration=a.duration,d.easing=a.easing)}function sl(d,a,l){let{maxSpeed:c,linearity:m,deceleration:p}=l,Z=o.aa(d*m/(a/1e3),-c,c),R=Math.abs(Z)/(p*m);return{easing:l.easing,duration:1e3*R,amount:Z*(R/2)}}class Wn extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,l,c,m={}){let p=vi(l.getCanvasContainer(),c),Z=l.unproject(p);super(a,o.e({point:p,lngLat:Z,originalEvent:c},m)),this._defaultPrevented=!1,this.target=l}}class Sl extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,l,c){let m=a==="touchend"?c.changedTouches:c.touches,p=Se(l.getCanvasContainer(),m),Z=p.map(I=>l.unproject(I)),R=p.reduce((I,N,Y,J)=>I.add(N.div(J.length)),new o.P(0,0));super(a,{points:p,point:R,lngLats:Z,lngLat:l.unproject(R),originalEvent:c}),this._defaultPrevented=!1}}class Ob extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,l,c){super(a,{originalEvent:c}),this._defaultPrevented=!1}}class Db{constructor(a,l){this._map=a,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new Ob(a.type,this._map,a))}mousedown(a,l){return this._mousedownPos=l,this._firePreventable(new Wn(a.type,this._map,a))}mouseup(a){this._map.fire(new Wn(a.type,this._map,a))}preclick(a){let l=o.e({},a);l.type="preclick",this._map.fire(new Wn(l.type,this._map,l))}click(a,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Wn(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Wn(a.type,this._map,a))}mouseover(a){this._map.fire(new Wn(a.type,this._map,a))}mouseout(a){this._map.fire(new Wn(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Sl(a.type,this._map,a))}touchmove(a){this._map.fire(new Sl(a.type,this._map,a))}touchend(a){this._map.fire(new Sl(a.type,this._map,a))}touchcancel(a){this._map.fire(new Sl(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class po{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Wn(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Wn(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(a,l){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,l){this.isEnabled()&&a.shiftKey&&a.button===0&&(Le(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(a,l){if(!this._active)return;let c=l,m=this._startPos,p=this._lastPos;if(!m||!p||p.equals(c)||!this._box&&c.dist(m)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=Ut("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));let Z=Math.min(m.x,c.x),R=Math.max(m.x,c.x),I=Math.min(m.y,c.y),N=Math.max(m.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(Z,"px,").concat(I,"px)"),this._box.style.width=R-Z+"px",this._box.style.height=N-I+"px")})}mouseupWindow(a,l){if(!this._active)return;let c=this._startPos,m=l;if(c&&a.button===0){if(this.reset(),Xi(),c.x!==m.x||c.y!==m.y)return this._map.fire(new o.b("boxzoomend",{originalEvent:a})),{cameraAnimation:p=>p.fitScreenCoordinates(c,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ee(),delete this._startPos,delete this._lastPos}_fireEvent(a,l){return this._map.fire(new o.b(a,{originalEvent:l}))}}function Ur(d,a){let l={};for(let c=0;c<d.length;c++)l[d[c].identifier]=a[c];return l}class Ld{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,l,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),c.length===this.numTouches&&(this.centroid=function(m){let p=new o.P(0,0);for(let Z of m)p._add(Z);return p.div(m.length)}(l),this.touches=Ur(c,l)))}touchmove(a,l,c){if(this.aborted||!this.centroid)return;let m=Ur(c,l);for(let p in this.touches){let Z=m[p];(!Z||Z.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(a,l,c){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){let m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ys{constructor(a){this.singleTap=new Ld(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,l,c){this.singleTap.touchstart(a,l,c)}touchmove(a,l,c){this.singleTap.touchmove(a,l,c)}touchend(a,l,c){let m=this.singleTap.touchend(a,l,c);if(m){let p=a.timeStamp-this.lastTime<500,Z=!this.lastTap||this.lastTap.dist(m)<30;if(p&&Z||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class _b{constructor(){this._zoomIn=new Ys({numTouches:1,numTaps:2}),this._zoomOut=new Ys({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,l,c){this._zoomIn.touchstart(a,l,c),this._zoomOut.touchstart(a,l,c)}touchmove(a,l,c){this._zoomIn.touchmove(a,l,c),this._zoomOut.touchmove(a,l,c)}touchend(a,l,c){let m=this._zoomIn.touchend(a,l,c),p=this._zoomOut.touchend(a,l,c);return m?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Z=>Z.easeTo({duration:300,zoom:Z.getZoom()+1,around:Z.unproject(m)},{originalEvent:a})}):p?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:Z=>Z.easeTo({duration:300,zoom:Z.getZoom()-1,around:Z.unproject(p)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Pb={0:1,2:2};class Gl{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,l){return!1}_move(a,l){return{}}mousedown(a,l){if(this._lastPoint)return;let c=Zi(a);this._correctButton(a,c)&&(this._lastPoint=l,this._eventButton=c)}mousemoveWindow(a,l){let c=this._lastPoint;if(c){if(a.preventDefault(),this._eventButton!=null&&function(m,p){let Z=Pb[p];return m.buttons===void 0||(m.buttons&Z)!==Z}(a,this._eventButton))this.reset();else if(this._moved||!(l.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(c,l)}}mouseupWindow(a){this._lastPoint&&Zi(a)===this._eventButton&&(this._moved&&Xi(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kb extends Gl{mousedown(a,l){super.mousedown(a,l),this._lastPoint&&(this._active=!0)}_correctButton(a,l){return l===0&&!a.ctrlKey}_move(a,l){return{around:l,panDelta:l.sub(a)}}}class Xs extends Gl{_correctButton(a,l){return l===0&&a.ctrlKey||l===2}_move(a,l){let c=.8*(l.x-a.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(a){a.preventDefault()}}class zd extends Gl{_correctButton(a,l){return l===0&&a.ctrlKey||l===2}_move(a,l){let c=-.5*(l.y-a.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(a){a.preventDefault()}}class qb{constructor(a,l){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(a,l,c){return this._calculateTransform(a,l,c)}touchmove(a,l,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!o.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,l,c)}}touchend(a,l,c){this._calculateTransform(a,l,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,l,c){c.length>0&&(this._active=!0);let m=Ur(c,l),p=new o.P(0,0),Z=new o.P(0,0),R=0;for(let N in m){let Y=m[N],J=this._touches[N];J&&(p._add(Y),Z._add(Y.sub(J)),R++,m[N]=Y)}if(this._touches=m,R<this._minTouches||!Z.mag())return;let I=Z.div(R);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(R),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ut("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Qa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,l,c){return{}}touchstart(a,l,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([l[0],l[1]]))}touchmove(a,l,c){let m=this._firstTwoTouches;if(!m)return;a.preventDefault();let[p,Z]=m,R=xr(c,l,p),I=xr(c,l,Z);if(!R||!I)return;let N=this._aroundCenter?null:R.add(I).div(2);return this._move([R,I],N,a)}touchend(a,l,c){if(!this._firstTwoTouches)return;let[m,p]=this._firstTwoTouches,Z=xr(c,l,m),R=xr(c,l,p);Z&&R||(this._active&&Xi(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xr(d,a,l){for(let c=0;c<d.length;c++)if(d[c].identifier===l)return a[c]}function wd(d,a){return Math.log(d/a)/Math.LN2}class Js extends Qa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,l){let c=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(wd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wd(this._distance,c),pinchAround:l}}}function uo(d,a){return 180*d.angleWith(a)/Math.PI}class $b extends Qa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,l){let c=this._vector;if(this._vector=a[0].sub(a[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:uo(this._vector,c),pinchAround:l}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());let l=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;let m=uo(a,c);return Math.abs(m)<l}}function ys(d){return Math.abs(d.y)>Math.abs(d.x)}class tm extends Qa{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,ys(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,l,c){let m=this._lastPoints;if(!m)return;let p=a[0].sub(m[0]),Z=a[1].sub(m[1]);return this._map._cooperativeGestures&&!o.c$()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(p,Z,c.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(p.y+Z.y)/2*-.5})}gestureBeginsVertically(a,l,c){if(this._valid!==void 0)return this._valid;let m=a.mag()>=2,p=l.mag()>=2;if(!m&&!p)return;if(!m||!p)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;let Z=a.y>0==l.y>0;return ys(a)&&ys(l)&&Z}}let vo={panStep:100,bearingStep:15,pitchStep:10};class Bs{constructor(){let a=vo;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let l=0,c=0,m=0,p=0,Z=0;switch(a.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:a.shiftKey?c=-1:(a.preventDefault(),p=-1);break;case 39:a.shiftKey?c=1:(a.preventDefault(),p=1);break;case 38:a.shiftKey?m=1:(a.preventDefault(),Z=-1);break;case 40:a.shiftKey?m=-1:(a.preventDefault(),Z=1);break;default:return}return this._rotationDisabled&&(c=0,m=0),{cameraAnimation:R=>{let I=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:em,zoom:l?Math.round(I)+l*(a.shiftKey?2:1):I,bearing:R.getBearing()+c*this._bearingStep,pitch:R.getPitch()+m*this._pitchStep,offset:[-p*this._panStep,-Z*this._panStep],center:R.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function em(d){return d*(2-d)}let Ms=4.000244140625,im=1/450;class Q0{constructor(a,l){this._map=a,this._el=a.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=im,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||o.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,c=o.f.now(),m=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,l!==0&&l%Ms==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(m*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),a.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=a,this._delta-=l,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=vi(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let a=this._map.transform;this._type==="wheel"&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let l=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){let N=this._type==="wheel"&&Math.abs(this._delta)>Ms?this._wheelZoomRate:this._defaultZoomRate,Y=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&Y!==0&&(Y=1/Y);let J=l(),M=Math.pow(2,J),T=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):M;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(T*Y))),this._type==="wheel"&&(this._startZoom=J,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let c=typeof this._targetZoom=="number"?this._targetZoom:l(),m=this._startZoom,p=this._easing,Z,R=!1;if(this._type==="wheel"&&m&&p){let N=Math.min((o.f.now()-this._lastWheelEventTime)/200,1),Y=p(N);Z=o.U(m,c,Y),N<1?this._frameId||(this._frameId=!0):R=!0}else Z=c,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=Z-l();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let l=o.d0;if(this._prevEase){let c=this._prevEase,m=(o.f.now()-c.start)/c.duration,p=c.easing(m+.01)-c.easing(m),Z=.27/Math.sqrt(p*p+1e-4)*.01,R=Math.sqrt(.0729-Z*Z);l=o.c_(Z,R,.25,1)}return this._prevEase={start:o.f.now(),duration:a,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ut("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class S0{constructor(a,l){this._clickZoom=a,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class f0{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,l){return a.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(a.shiftKey?-1:1),around:c.unproject(l)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class v0{constructor(){this._tap=new Ys({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,l,c){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=l[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(a,l,c))}touchmove(a,l,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let m=l[0],p=m.y-this._swipePoint.y;return this._swipePoint=m,a.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(a,l,c)}touchend(a,l,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(a,l,c)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class L0{constructor(a,l,c){this._el=a,this._mousePan=l,this._touchPan=c}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class z0{constructor(a,l,c){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=l,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class w0{constructor(a,l,c,m){this._el=a,this._touchZoom=l,this._touchRotate=c,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Cs=d=>d.zoom||d.drag||d.pitch||d.rotate;class E0 extends o.b{}class A0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,l){let c=o.N.sub([],l,a);this.radius=o.N.length(c[2]<0?o.N.div([],c,this.constants):[c[0],c[1],0])}projectRay(a){o.N.div(a,a,this.constants),o.N.normalize(a,a),o.N.mul(a,a,this.constants);let l=o.N.scale([],a,this.radius);if(l[2]>0){let c=o.N.scale([],[0,0,1],o.N.dot(l,[0,0,1])),m=o.N.scale([],o.N.normalize([],[l[0],l[1],0]),this.radius),p=o.N.add([],l,o.N.scale([],o.N.sub([],o.N.add([],m,c),l),2));l[0]=p[0],l[1]=p[1]}return l}}function Ts(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class nW{constructor(a,l){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ni(a),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new A0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aY(["handleEvent","handleWindowEvent"],this);let c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(let[m,p,Z]of this._listeners){let R=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(p,R,Z)}}destroy(){for(let[a,l,c]of this._listeners){let m=a===document?this.handleWindowEvent:this.handleEvent;a.removeEventListener(l,m,c)}}_addDefaultHandlers(a){let l=this._map,c=l.getCanvasContainer();this._add("mapEvent",new Db(l,a));let m=l.boxZoom=new Wo(l,a);this._add("boxZoom",m);let p=new _b,Z=new f0;l.doubleClickZoom=new S0(Z,p),this._add("tapZoom",p),this._add("clickZoom",Z);let R=new v0;this._add("tapDragZoom",R);let I=l.touchPitch=new tm(l);this._add("touchPitch",I);let N=new Xs(a),Y=new zd(a);l.dragRotate=new z0(a,N,Y),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);let J=new Kb(a),M=new qb(l,a);l.dragPan=new L0(c,J,M),this._add("mousePan",J),this._add("touchPan",M,["touchZoom","touchRotate"]);let T=new $b,v=new Js;l.touchZoomRotate=new w0(c,v,T,R),this._add("touchRotate",T,["touchPan","touchZoom"]),this._add("touchZoom",v,["touchPan","touchRotate"]),this._add("blockableMapEvent",new po(l));let f=l.scrollZoom=new Q0(l,this);this._add("scrollZoom",f,["mousePan"]);let z=l.keyboard=new Bs;this._add("keyboard",z);for(let Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Q]&&l[Q].enable(a[Q])}_add(a,l,c){this._handlers.push({handlerName:a,handler:l,allowed:c}),this._handlersById[a]=l}stop(a){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,l,c){for(let m in a)if(m!==c&&(!l||l.indexOf(m)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,"".concat(a.type,"Window"))}_getMapTouches(a){let l=[];for(let c of a)this._el.contains(c.target)&&l.push(c);return l}handleEvent(a,l){this._updatingCamera=!0;let c=a.type==="renderFrame",m=c?void 0:a,p={needsRenderFrame:!1},Z={},R={},I=a.touches?this._getMapTouches(a.touches):void 0,N=I?Se(this._el,I):c?void 0:vi(this._el,a);for(let{handlerName:M,handler:T,allowed:v}of this._handlers){if(!T.isEnabled())continue;let f;this._blockedByActive(R,v,M)?T.reset():T[l||a.type]&&(f=T[l||a.type](a,N,I),this.mergeHandlerResult(p,Z,f,M,m),f&&f.needsRenderFrame&&this._triggerRenderFrame()),(f||T.isActive())&&(R[M]=T)}let Y={};for(let M in this._previousActiveHandlers)R[M]||(Y[M]=m);this._previousActiveHandlers=R,(Object.keys(Y).length||Ts(p))&&(this._changes.push([p,Z,Y]),this._triggerRenderFrame()),(Object.keys(R).length||Ts(p))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:J}=p;J&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],J(this._map))}mergeHandlerResult(a,l,c,m,p){if(!c)return;o.e(a,c);let Z={handlerName:m,originalEvent:c.originalEvent||p};c.zoomDelta!==void 0&&(l.zoom=Z),c.panDelta!==void 0&&(l.drag=Z),c.pitchDelta!==void 0&&(l.pitch=Z),c.bearingDelta!==void 0&&(l.rotate=Z)}_applyChanges(){let a={},l={},c={};for(let[m,p,Z]of this._changes)m.panDelta&&(a.panDelta=(a.panDelta||new o.P(0,0))._add(m.panDelta)),m.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(a.around=m.around),m.aroundCoord!==void 0&&(a.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(a.pinchAround=m.pinchAround),m.noInertia&&(a.noInertia=m.noInertia),o.e(l,p),o.e(c,Z);this._updateMapTransform(a,l,c),this._changes=[]}_updateMapTransform(a,l,c){let m=this._map,p=m.transform,Z=E=>[E.x,E.y,E.z];if((E=>{let P=this._eventsInProgress.drag;return P&&!this._handlersById[P.handlerName].isActive()})()&&!Ts(a)){let E=p.zoom;p.cameraElevationReference="sea",this._originalZoom!=null&&p._orthographicProjectionAtLowPitch&&p.projection.name!=="globe"&&p.pitch===0?(p.cameraElevationReference="ground",p.zoom=this._originalZoom):(p.recenterOnTerrain(),p.cameraElevationReference="ground"),E!==p.zoom&&this._map._update(!0)}if(p._isCameraConstrained&&m._stop(!0),!Ts(a))return void this._fireEvents(l,c,!0);let{panDelta:R,zoomDelta:I,bearingDelta:N,pitchDelta:Y,around:J,aroundCoord:M,pinchAround:T}=a;p._isCameraConstrained&&(I>0&&(I=0),p._isCameraConstrained=!1),T!==void 0&&(J=T),(I||(E=>l[E]&&!this._eventsInProgress[E])("drag"))&&J&&(this._dragOrigin=Z(p.pointCoordinate3D(J)),this._originalZoom=p.zoom,this._trackingEllipsoid.setup(p._camera.position,this._dragOrigin)),p.cameraElevationReference="sea",m._stop(!0),J=J||m.transform.centerPoint,N&&(p.bearing+=N),Y&&(p.pitch+=Y),p._updateCameraState();let v=[0,0,0];if(R)if(p.projection.name==="mercator"){let E=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(J).dir),P=this._trackingEllipsoid.projectRay(p.screenPointToMercatorRay(J.sub(R)).dir);v[0]=P[0]-E[0],v[1]=P[1]-E[1]}else{let E=p.pointCoordinate(J);if(p.projection.name==="globe"){R=R.rotate(-p.angle);let P=p._pixelsPerMercatorPixel/p.worldSize;v[0]=-R.x*o.d1(o.au(E.y))*P,v[1]=-R.y*o.d1(p.center.lat)*P}else{let P=p.pointCoordinate(J.sub(R));E&&P&&(v[0]=P.x-E.x,v[1]=P.y-E.y)}}let f=p.zoom,z=[0,0,0];if(I){let E=Z(M||p.pointCoordinate3D(J)),P={dir:o.N.normalize([],o.N.sub([],E,p._camera.position))};if(P.dir[2]<0){let H=p.zoomDeltaToMovement(E,I);o.N.scale(z,P.dir,H)}}let Q=o.N.add(v,v,z);p._translateCameraConstrained(Q),I&&Math.abs(p.zoom-f)>1e-4&&p.recenterOnTerrain(),p.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(l,c,!0)}_fireEvents(a,l,c){let m=Cs(this._eventsInProgress),p=Cs(a),Z={};for(let Y in a){let{originalEvent:J}=a[Y];this._eventsInProgress[Y]||(Z["".concat(Y,"start")]=J),this._eventsInProgress[Y]=a[Y]}!m&&p&&this._fireEvent("movestart",p.originalEvent);for(let Y in Z)this._fireEvent(Y,Z[Y]);p&&this._fireEvent("move",p.originalEvent);for(let Y in a){let{originalEvent:J}=a[Y];this._fireEvent(Y,J)}let R={},I;for(let Y in this._eventsInProgress){let{handlerName:J,originalEvent:M}=this._eventsInProgress[Y];this._handlersById[J].isActive()||(delete this._eventsInProgress[Y],I=l[J]||M,R["".concat(Y,"end")]=I)}for(let Y in R)this._fireEvent(Y,R[Y]);let N=Cs(this._eventsInProgress);if(c&&(m||p)&&!N){this._updatingCamera=!0;let Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),J=M=>M!==0&&-this._bearingSnap<M&&M<this._bearingSnap;Y?(J(Y.bearing||this._map.getBearing())&&(Y.bearing=0),this._map.easeTo(Y,{originalEvent:I})):(this._map.fire(new o.b("moveend",{originalEvent:I})),J(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,l){this._map.fire(new o.b(a,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new E0("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let H0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class da extends o.E{constructor(a,l){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(a,l){return this.jumpTo({center:a},l)}panBy(a,l,c){return a=o.P.convert(a).mult(-1),this.panTo(this.transform.center,o.e({offset:a},l),c)}panTo(a,l,c){return this.easeTo(o.e({center:a},l),c)}getZoom(){return this.transform.zoom}setZoom(a,l){return this.jumpTo({zoom:a},l),this}zoomTo(a,l,c){return this.easeTo(o.e({zoom:a},l),c)}zoomIn(a,l){return this.zoomTo(this.getZoom()+1,a,l),this}zoomOut(a,l){return this.zoomTo(this.getZoom()-1,a,l),this}getBearing(){return this.transform.bearing}setBearing(a,l){return this.jumpTo({bearing:a},l),this}getPadding(){return this.transform.padding}setPadding(a,l){return this.jumpTo({padding:a},l),this}rotateTo(a,l,c){return this.easeTo(o.e({bearing:a},l),c)}resetNorth(a,l){return this.rotateTo(0,o.e({duration:1e3},a),l),this}resetNorthPitch(a,l){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},a),l),this}snapToNorth(a,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,l):this}getPitch(){return this.transform.pitch}setPitch(a,l){return this.jumpTo({pitch:a},l),this}cameraForBounds(a,l){a=o.ad.convert(a);let c=l&&l.bearing||0,m=l&&l.pitch||0,p=a.getNorthWest(),Z=a.getSouthEast();return this._cameraForBounds(this.transform,p,Z,c,m,l)}_extendCameraOptions(a){let l={top:0,bottom:0,right:0,left:0};if(typeof(a=o.e({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){let c=a.padding;a.padding={top:c,bottom:c,right:c,left:c}}return a.padding=o.e(l,a.padding),a}_minimumAABBFrustumDistance(a,l){let c=l.max[0]-l.min[0],m=l.max[1]-l.min[1];return c/m>a.aspect?c/(2*Math.tan(.5*a.fovX)*a.aspect):m/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,l,c,m,p,Z){let R=a.clone(),I=this._extendCameraOptions(Z);R.bearing=m,R.pitch=p;let N=o.bn.convert(l),Y=o.bn.convert(c),J=.5*(N.lat+Y.lat),M=.5*(N.lng+Y.lng),T=o.d2(J,M),v=o.N.normalize([],T),f=o.N.normalize([],o.N.cross([],v,[0,1,0])),z=o.N.cross([],f,v),Q=[f[0],f[1],f[2],0,z[0],z[1],z[2],0,v[0],v[1],v[2],0,0,0,0,1],E=[T,o.d2(N.lat,N.lng),o.d2(Y.lat,N.lng),o.d2(Y.lat,Y.lng),o.d2(N.lat,Y.lng),o.d2(J,N.lng),o.d2(J,Y.lng),o.d2(N.lat,M),o.d2(Y.lat,M)],P=o.bS.fromPoints(E.map(Wt=>[o.N.dot(f,Wt),o.N.dot(z,Wt),o.N.dot(v,Wt)])),H=o.N.transformMat4([],P.center,Q);o.N.squaredLength(H)===0&&o.N.set(H,0,0,1),o.N.normalize(H,H),o.N.scale(H,H,o.ab),R.center=o.d3(H);let K=R.getWorldToCameraMatrix(),w=o.a6.invert(new Float64Array(16),K);P=o.bS.applyTransform(P,o.a6.multiply([],K,Q)),o.N.transformMat4(H,H,K);let q=.5*(P.max[2]-P.min[2]),it=this._minimumAABBFrustumDistance(R,P),at=o.N.scale([],[0,0,1],q),rt=o.N.add(at,H,at),Zt=it+(R.pitch===0?0:o.N.distance(H,rt)),bt=R.globeCenterInViewSpace,It=o.N.sub([],H,[bt[0],bt[1],bt[2]]);o.N.normalize(It,It),o.N.scale(It,It,Zt);let Gt=o.N.add([],H,It);o.N.transformMat4(Gt,Gt,w);let St=o.d4/o.ab,mt=o.N.length(Gt),Vt=o.bl(Math.max(mt*St-o.d4,Number.EPSILON),0),ot=Math.min(R.zoomFromMercatorZAdjusted(Vt),I.maxZoom);return ot>.5*(o.bG+o.bx)?(R.setProjection({name:"mercator"}),R.zoom=ot,this._cameraForBounds(R,l,c,m,p,Z)):{center:R.center,zoom:ot,bearing:m,pitch:p}}queryTerrainElevation(a,l){let c=this.transform.elevation;return c?(l=o.e({},{exaggerated:!0},l),c.getAtPoint(o.L.fromLngLat(a),null,l.exaggerated)):null}_cameraForBounds(a,l,c,m,p,Z){if(a.projection.name==="globe")return this._cameraForBoundsOnGlobe(a,l,c,m,p,Z);let R=a.clone(),I=this._extendCameraOptions(Z),N=R.padding;R.bearing=m,R.pitch=p;let Y=o.bn.convert(l),J=o.bn.convert(c),M=new o.bn(Y.lng,J.lat),T=new o.bn(J.lng,Y.lat),v=R.project(Y),f=R.project(J),z=this.queryTerrainElevation(Y),Q=this.queryTerrainElevation(J),E=this.queryTerrainElevation(M),P=this.queryTerrainElevation(T),H=[[v.x,v.y,Math.min(z||0,Q||0,E||0,P||0)],[f.x,f.y,Math.max(z||0,Q||0,E||0,P||0)]],K=o.bS.fromPoints(H),w=R.getWorldToCameraMatrix(),q=o.a6.invert(new Float64Array(16),w);K=o.bS.applyTransform(K,w);let it=o.N.sub([],K.max,K.min),at=N.left||0,rt=N.right||0,Zt=N.bottom||0,bt=N.top||0,{left:It,right:Gt,top:St,bottom:mt}=I.padding,Vt=.5*(at+rt),ot=.5*(bt+Zt),Wt=Math.min(R.scaleZoom(R.scale*Math.min((R.width-(at+rt+It+Gt))/it[0],(R.height-(Zt+bt+mt+St))/it[1])),I.maxZoom),ft=R.scale/R.zoomScale(Wt);K=new o.bS([K.min[0]-(It+Vt)*ft,K.min[1]-(mt+ot)*ft,K.min[2]],[K.max[0]+(Gt+Vt)*ft,K.max[1]+(St+ot)*ft,K.max[2]]);let At=.5*it[2],Et=this._minimumAABBFrustumDistance(R,K),$t=[0,0,1,0];o.a7.transformMat4($t,$t,w),o.a7.normalize($t,$t);let me=o.N.scale([],$t,Et+At),Ie=o.N.add([],K.center,me),ue=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new o.P(I.offset.x,I.offset.y):o.P.convert(I.offset)).rotate(-o.bj(m));K.center[0]-=ue.x*ft,K.center[1]+=ue.y*ft,o.N.transformMat4(K.center,K.center,q),o.N.transformMat4(Ie,Ie,q);let Re=[K.center[0],K.center[1],Ie[2]*R.pixelsPerMeter];o.N.scale(Re,Re,1/R.worldSize);let Ae=o.at(Re[0]),Me=o.au(Re[1]),fe=Math.min(R._zoomFromMercatorZ(Re[2]),I.maxZoom),Qe=new o.bn(Ae,Me);return R.mercatorFromTransition&&fe<.5*(o.bG+o.bx)?(R.setProjection({name:"globe"}),R.zoom=fe,this._cameraForBounds(R,l,c,m,p,Z)):{center:Qe,zoom:fe,bearing:m,pitch:p}}fitBounds(a,l,c){let m=this.cameraForBounds(a,l);return this._fitInternal(m,l,c)}fitScreenCoordinates(a,l,c,m,p){let Z=o.P.convert(a),R=o.P.convert(l),I=new o.P(Math.min(Z.x,R.x),Math.min(Z.y,R.y)),N=new o.P(Math.max(Z.x,R.x),Math.max(Z.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(Z,R))return this;let Y=this.transform.pointLocation3D(I),J=this.transform.pointLocation3D(N),M=this.transform.pointLocation3D(new o.P(I.x,N.y)),T=this.transform.pointLocation3D(new o.P(N.x,I.y)),v=[Math.min(Y.lng,J.lng,M.lng,T.lng),Math.min(Y.lat,J.lat,M.lat,T.lat)],f=[Math.max(Y.lng,J.lng,M.lng,T.lng),Math.max(Y.lat,J.lat,M.lat,T.lat)],z=m&&m.pitch?m.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,v,f,c,z,m);return this._fitInternal(Q,m,p)}_fitInternal(a,l,c){return a?(delete(l=o.e(a,l)).padding,l.linear?this.easeTo(l,c):this.flyTo(l,c)):this}jumpTo(a,l){this.stop();let c=a.preloadOnly?this.transform.clone():this.transform,m=!1,p=!1,Z=!1;return"zoom"in a&&c.zoom!==+a.zoom&&(m=!0,c.zoom=+a.zoom),a.center!==void 0&&(c.center=o.bn.convert(a.center)),"bearing"in a&&c.bearing!==+a.bearing&&(p=!0,c.bearing=+a.bearing),"pitch"in a&&c.pitch!==+a.pitch&&(Z=!0,c.pitch=+a.pitch),a.padding==null||c.isPaddingEqual(a.padding)||(c.padding=a.padding),a.preloadOnly?(this._preloadTiles(c),this):(this.fire(new o.b("movestart",l)).fire(new o.b("move",l)),m&&this.fire(new o.b("zoomstart",l)).fire(new o.b("zoom",l)).fire(new o.b("zoomend",l)),p&&this.fire(new o.b("rotatestart",l)).fire(new o.b("rotate",l)).fire(new o.b("rotateend",l)),Z&&this.fire(new o.b("pitchstart",l)).fire(new o.b("pitch",l)).fire(new o.b("pitchend",l)),this.fire(new o.b("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(H0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,l){let c=this.transform;if(!c.projection.supportsFreeCamera)return o.w(H0),this;this.stop();let m=c.zoom,p=c.pitch,Z=c.bearing;c.setFreeCameraOptions(a);let R=m!==c.zoom,I=p!==c.pitch,N=Z!==c.bearing;return this.fire(new o.b("movestart",l)).fire(new o.b("move",l)),R&&this.fire(new o.b("zoomstart",l)).fire(new o.b("zoom",l)).fire(new o.b("zoomend",l)),N&&this.fire(new o.b("rotatestart",l)).fire(new o.b("rotate",l)).fire(new o.b("rotateend",l)),I&&this.fire(new o.b("pitchstart",l)).fire(new o.b("pitch",l)).fire(new o.b("pitchend",l)),this.fire(new o.b("moveend",l)),this}easeTo(a,l){this._stop(!1,a.easeId),((a=o.e({offset:[0,0],duration:500,easing:o.d0},a)).animate===!1||this._prefersReducedMotion(a))&&(a.duration=0);let c=this.transform,m=this.getZoom(),p=this.getBearing(),Z=this.getPitch(),R=this.getPadding(),I="zoom"in a?+a.zoom:m,N="bearing"in a?this._normalizeBearing(a.bearing,p):p,Y="pitch"in a?+a.pitch:Z,J="padding"in a?a.padding:c.padding,M=o.P.convert(a.offset),T,v,f;if(c.projection.name==="globe"){let at=o.L.fromLngLat(c.center),rt=M.rotate(-c.angle);at.x+=rt.x/c.worldSize,at.y+=rt.y/c.worldSize;let Zt=at.toLngLat(),bt=o.bn.convert(a.center||Zt);this._normalizeCenter(bt),T=c.centerPoint.add(rt),v=new o.P(at.x,at.y).mult(c.worldSize),f=new o.P(o.a5(bt.lng),o.ae(bt.lat)).mult(c.worldSize).sub(v)}else{T=c.centerPoint.add(M);let at=c.pointLocation(T),rt=o.bn.convert(a.center||at);this._normalizeCenter(rt),v=c.project(at),f=c.project(rt).sub(v)}let z=c.zoomScale(I-m),Q,E;a.around&&(Q=o.bn.convert(a.around),E=c.locationPoint(Q));let P=this._zooming||I!==m,H=this._rotating||p!==N,K=this._pitching||Y!==Z,w=!c.isPaddingEqual(J),q=at=>rt=>{if(P&&(at.zoom=o.U(m,I,rt)),H&&(at.bearing=o.U(p,N,rt)),K&&(at.pitch=o.U(Z,Y,rt)),w&&(at.interpolatePadding(R,J,rt),T=at.centerPoint.add(M)),Q)at.setLocationAtPoint(Q,E);else{let Zt=at.zoomScale(at.zoom-m),bt=I>m?Math.min(2,z):Math.max(.5,z),It=Math.pow(bt,1-rt),Gt=at.unproject(v.add(f.mult(rt*It)).mult(Zt));at.setLocationAtPoint(at.renderWorldCopies?Gt.wrap():Gt,T)}return a.preloadOnly||this._fireMoveEvents(l),at};if(a.preloadOnly){let at=this._emulate(q,a.duration,c);return this._preloadTiles(at),this}let it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=P,this._rotating=H,this._pitching=K,this._easeId=a.easeId,this._prepareEase(l,a.noMoveStart,it),this._ease(q(c),at=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(l,at)},a),this}_prepareEase(a,l,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||c.moving||this.fire(new o.b("movestart",a)),this._zooming&&!c.zooming&&this.fire(new o.b("zoomstart",a)),this._rotating&&!c.rotating&&this.fire(new o.b("rotatestart",a)),this._pitching&&!c.pitching&&this.fire(new o.b("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.b("move",a)),this._zooming&&this.fire(new o.b("zoom",a)),this._rotating&&this.fire(new o.b("rotate",a)),this._pitching&&this.fire(new o.b("pitch",a))}_afterEase(a,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let c=this._zooming,m=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,c&&this.fire(new o.b("zoomend",a)),m&&this.fire(new o.b("rotateend",a)),p&&this.fire(new o.b("pitchend",a)),this.fire(new o.b("moveend",a))}flyTo(a,l){if(this._prefersReducedMotion(a)){let mt=o.ac(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(mt,l)}this.stop(),a=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.d0},a);let c=this.transform,m=this.getZoom(),p=this.getBearing(),Z=this.getPitch(),R="zoom"in a?o.aa(+a.zoom,c.minZoom,c.maxZoom):m,I="bearing"in a?this._normalizeBearing(a.bearing,p):p,N="pitch"in a?+a.pitch:Z,Y=c.zoomScale(R-m),J=o.P.convert(a.offset),M=c.centerPoint.add(J),T=c.pointLocation(M),v=a.center;if(v&&a.padding){let mt=this._cameraForBounds(this.transform,v,v,I,N,a);mt&&(v=mt.center)}v=o.bn.convert(v||T),this._normalizeCenter(v);let f=c.project(T),z=c.project(v).sub(f),Q=a.curve,E=Math.max(c.width,c.height),P=E/Y,H=z.mag();if("minZoom"in a){let mt=o.aa(Math.min(a.minZoom,m,R),c.minZoom,c.maxZoom),Vt=E/c.zoomScale(mt-m);Q=Math.sqrt(Vt/H*2)}let K=Q*Q;function w(mt){let Vt=(P*P-E*E+(mt?-1:1)*K*K*H*H)/(2*(mt?P:E)*K*H);return Math.log(Math.sqrt(Vt*Vt+1)-Vt)}function q(mt){return(Math.exp(mt)-Math.exp(-mt))/2}function it(mt){return(Math.exp(mt)+Math.exp(-mt))/2}let at=w(0),rt=function(mt){return it(at)/it(at+Q*mt)},Zt=function(mt){return E*((it(at)*(q(Vt=at+Q*mt)/it(Vt))-q(at))/K)/H;var Vt},bt=(w(1)-at)/Q;if(Math.abs(H)<1e-6||!isFinite(bt)){if(Math.abs(E-P)<1e-6)return this.easeTo(a,l);let mt=P<E?-1:1;bt=Math.abs(Math.log(P/E))/Q,Zt=function(){return 0},rt=function(Vt){return Math.exp(mt*Q*Vt)}}a.duration="duration"in a?+a.duration:1e3*bt/("screenSpeed"in a?+a.screenSpeed/Q:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);let It=p!==I,Gt=N!==Z,St=mt=>Vt=>{let ot=Vt*bt,Wt=1/rt(ot);mt.zoom=Vt===1?R:m+mt.scaleZoom(Wt),It&&(mt.bearing=o.U(p,I,Vt)),Gt&&(mt.pitch=o.U(Z,N,Vt));let ft=Vt===1?v:mt.unproject(f.add(z.mult(Zt(ot))).mult(Wt));return mt.setLocationAtPoint(mt.renderWorldCopies?ft.wrap():ft,M),mt._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(l),mt};if(a.preloadOnly){let mt=this._emulate(St,a.duration,c);return this._preloadTiles(mt),this}return this._zooming=!0,this._rotating=It,this._pitching=Gt,this._prepareEase(l,!1),this._ease(St(c),()=>this._afterEase(l),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,l)}if(!a){let c=this.handlers;c&&c.stop(!1)}return this}_ease(a,l,c){c.animate===!1||c.duration===0?(a(1),l()):(this._easeStart=o.f.now(),this._easeOptions=c,this._onEaseFrame=a,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let a=Math.min((o.f.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,l){a=o.bh(a,-180,180);let c=Math.abs(a-l);return Math.abs(a-360-l)<c&&(a-=360),Math.abs(a+360-l)<c&&(a+=360),a}_normalizeCenter(a){let l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;let c=a.lng-l.center.lng;a.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&o.f.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,l,c){let m=Math.ceil(15*l/1e3),p=[],Z=a(c.clone());for(let R=0;R<=m;R++){let I=Z(R/m);p.push(I.clone())}return p}}class am{constructor(a={}){this.options=a,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){let l=this.options&&this.options.compact;return this._map=a,this._container=Ut("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ut("button","mapboxgl-ctrl-attrib-button",this._container),Ut("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ut("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,l){let c=this._map._getUIString("AttributionControl.".concat(l));a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",c)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));let l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d5.ACCESS_TOKEN}];if(a){let c=l.reduce((m,p,Z)=>(p.value&&(m+="".concat(p.key,"=").concat(p.value).concat(Z<l.length-1?"&":"")),m),"?");a.href="".concat(o.d5.FEEDBACK_URL,"/").concat(c,"#").concat(jb(this._map,!0)),a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){let m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}let l=this._map.style._mergedSourceCaches;for(let m in l){let p=l[m];if(p.used){let Z=p.getSource();Z.attribution&&a.indexOf(Z.attribution)<0&&a.push(Z.attribution)}}a.sort((m,p)=>m.length-p.length),a=a.filter((m,p)=>{for(let Z=p+1;Z<a.length;Z++)if(a[Z].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));let c=a.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,a.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class j0{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Ut("div","mapboxgl-ctrl");let l=Ut("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(let l in a){let c=a[l].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){let a=this._container.children;if(a.length){let l=a[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class O0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){let l=++this._id;return this._queue.push({callback:a,id:l,cancelled:!1}),l}remove(a){let l=this._currentlyRunning,c=l?this._queue.concat(l):this._queue;for(let m of c)if(m.id===a)return void(m.cancelled=!0)}run(a=0){let l=this._currentlyRunning=this._queue;this._queue=[];for(let c of l)if(!c.cancelled&&(c.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ks(d,a,l){if(d=new o.bn(d.lng,d.lat),a){let c=new o.bn(d.lng-360,d.lat),m=new o.bn(d.lng+360,d.lat),p=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),Z=l.locationPoint(d).distSqr(a),R=a.x<0||a.y<0||a.x>l.width||a.y>l.height;l.locationPoint(c).distSqr(a)<Z&&(R||Math.abs(c.lng-l.center.lng)<p)?d=c:l.locationPoint(m).distSqr(a)<Z&&(R||Math.abs(m.lng-l.center.lng)<p)&&(d=m)}for(;Math.abs(d.lng-l.center.lng)>180;){let c=l.locationPoint(d);if(c.x>=0&&c.y>=0&&c.x<=l.width&&c.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}let Ed={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class nm extends o.E{constructor(a,l){if(super(),(a instanceof HTMLElement||l)&&(a=o.e({element:a},l)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=o.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ut("div");let p=41,Z=27,R=de("svg",{display:"block",height:p*this._scale+"px",width:Z*this._scale+"px",viewBox:"0 0 ".concat(Z," ").concat(p)},this._element),I=de("radialGradient",{id:"shadowGradient"},de("defs",{},R));de("stop",{offset:"10%","stop-opacity":.4},I),de("stop",{offset:"100%","stop-opacity":.05},I),de("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},R),de("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},R),de("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},R),de("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},R),this._offset=o.P.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()});let c=this._element.classList;for(let p in Ed)c.remove("mapboxgl-marker-anchor-".concat(p));c.add("mapboxgl-marker-anchor-".concat(this._anchor));let m=a&&a.className?a.className.trim().split(/\s+/):[];c.add(...m),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){let a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.bn.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){let m=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){let l=a.code,c=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(a){let l=a.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let a=this._map,l=this._pos;if(!a||!l)return!1;let c=a.unproject(l),m=a.getFreeCameraOptions();if(!m.position)return!1;let p=m.position.toLngLat();return p.distanceTo(c)<.9*p.distanceTo(this._lngLat)}_evaluateOpacity(){let a=this._map;if(!a)return;let l=this._pos;if(!l||l.x<0||l.x>a.transform.width||l.y<0||l.y>a.transform.height)return void this._clearFadeTimer();let c=a.unproject(l),m;a._showingGlobe()&&o.d6(a.transform,this._lngLat)?m=0:(m=1-a._queryFogOpacity(c),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity="".concat(m),this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let a=this._pos;if(!a||!this._map)return;let l=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(a.x,"px,").concat(a.y,"px)\n            ").concat(Ed[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(l.x,"px,").concat(l.y,"px)\n        ")}_calculateXYTransform(){let a=this._pos,l=this._map,c=this.getPitchAlignment();if(!l||!a||c!=="map")return"";if(!l._showingGlobe()){let I=l.getPitch();return I?"rotateX(".concat(I,"deg)"):""}let m=o.bF(o.d7(l.transform,this._lngLat)),p=a.sub(o.d8(l.transform)),Z=Math.abs(p.x)+Math.abs(p.y);if(Z===0)return"";let R=m/Z;return"rotateX(".concat(-p.y*R,"deg) rotateY(").concat(p.x*R,"deg)")}_calculateZTransform(){let a=this._pos,l=this._map;if(!l||!a)return"";let c=0,m=this.getRotationAlignment();if(m==="map")if(l._showingGlobe()){let p=l.project(new o.bn(this._lngLat.lng,this._lngLat.lat+.001)),Z=l.project(new o.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(p);c=o.bF(Math.atan2(Z.y,Z.x))-90}else c=-l.getBearing();else if(m==="horizon"){let p=o.O(4,6,l.getZoom()),Z=o.d8(l.transform);Z.y+=p*l.transform.height;let R=a.sub(Z),I=o.bF(Math.atan2(R.y,R.x));c=(I>90?I-270:I+90)*(1-p)}return c+=this._rotation,c?"rotateZ(".concat(c,"deg)"):""}_update(a){cancelAnimationFrame(this._updateFrameId);let l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=ks(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),a===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=o.P.convert(a),this._update(),this}addClassName(a){return this._element.classList.add(a),this}removeClassName(a){return this._element.classList.remove(a),this}toggleClassName(a){return this._element.classList.toggle(a)}_onMove(a){let l=this._map;if(!l)return;let c=this._pointerdownPos,m=this._positionDelta;if(c&&m){if(!this._isDragging){let p=this._clickTolerance||l._clickTolerance;if(a.point.dist(c)<p)return;this._isDragging=!0}this._pos=a.point.sub(m),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.b("dragstart"))),this.fire(new o.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.b("dragend")),this._state="inactive"}_addDragHandler(a){let l=this._map,c=this._pos;l&&c&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(c),this._pointerdownPos=a.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;let l=this._map;return l&&(a?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let D0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function P0(d=new o.P(0,0),a="bottom"){if(typeof d=="number"){let l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(a){case"top":return new o.P(0,d);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-d);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(d,0);case"right":return new o.P(-d,0)}return new o.P(0,0)}return d instanceof o.P||Array.isArray(d)?o.P.convert(d):o.P.convert(d[a]||[0,0])}class lm{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;let l=o.cc((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,l,c){this._start=this.getValue(l),this._end=a,this._startTime=l,this._endTime=l+c}}let Qs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},K0={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class om{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}let Ad={showCompass:!0,showZoom:!0,visualizePitch:!1};class fl{constructor(a,l,c=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Xs({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,c&&(this.mousePitch=new zd({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(a,l){this.mouseRotate.mousedown(a,l),this.mousePitch&&this.mousePitch.mousedown(a,l),Le()}move(a,l){let c=this.map,m=this.mouseRotate.mousemoveWindow(a,l),p=m&&m.bearingDelta;if(p&&c.setBearing(c.getBearing()+p),this.mousePitch){let Z=this.mousePitch.mousemoveWindow(a,l),R=Z&&Z.pitchDelta;R&&c.setPitch(c.getPitch()+R)}}off(){let a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ee(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.e({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),vi(this.element,a)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,vi(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Se(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=Se(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Hd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},sn={maxWidth:100,unit:"metric"},Zo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dk,supported:ct,setRTLTextPlugin:o.dm,getRTLTextPluginStatus:o.dn,Map:class extends da{constructor(d){let a=d;if((d=o.e({},K0,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.d9(window)&&(d.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ds(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!1,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new O0,this._domRenderTaskQueue=new O0,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aC(),this._locale=o.e({},Qs,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new lm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.da(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?{...d.contextCreateOptions}:{},typeof d.container=="string"){let l=document.getElementById(d.container);if(!l)throw new Error("Container '".concat(d.container.toString(),"' not found."));this._container=l}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new om,this._tp=d.devtools?new Fs(this):new Fs,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,l=>{this.repaint=l}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,l=>{this.showTileAABBs=l}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,l=>{this.showPadding=l}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new nW(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||o.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new fd(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){a.center==null&&a.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});let l=d.bounds;l&&(this.resize(),this.fitBounds(l,o.e({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new am({customAttribution:d.customAttribution})),this._logoControl=new j0,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.b("".concat(l.dataType,"data"),l))}),this.on("dataloading",l=>{this.fire(new o.b("".concat(l.dataType,"dataloading"),l))})}_getMapId(){return this._mapId}addControl(d,a){if(a===void 0&&(a=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=d.onAdd(this);this._controls.push(d);let c=this._controlPositions[a];return a.indexOf("bottom")!==-1?c.insertBefore(l,c.firstChild):c.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let a=this._controls.indexOf(d);return a>-1&&this._controls.splice(a,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let a=!this._moving;return a&&this.fire(new o.b("movestart",d)).fire(new o.b("move",d)),this.fire(new o.b("resize",d)),a&&this.fire(new o.b("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.ad.convert(d)),this._update()}setMinZoom(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d==null?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(a=>a==="auto"?navigator.language:a):d}setLanguage(d){let a=this._parseLanguage(d);if(!this.style||a===this._language)return this;this._language=a,this.style.reloadSources();for(let l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let d=this.transform,a=d.projection.name,l;a==="globe"&&d.zoom>=o.bx?(d.setMercatorFromTransition(),l=!0):a==="mercator"&&d.zoom<o.bx&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,a){return this._updateProjection(d||a||{name:"mercator"})}_updateProjection(d){let a;return a=d.name==="globe"&&this.transform.zoom>=o.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),a&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(o.bn.convert(d))}unproject(d){return this.transform.pointLocation3D(o.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,a,l){if(d==="mouseenter"||d==="mouseover"){let c=!1,m=Z=>{let R=a.filter(N=>this.getLayer(N)),I=R.length?this.queryRenderedFeatures(Z.point,{layers:R}):[];I.length?c||(c=!0,l.call(this,new Wn(d,this,Z.originalEvent,{features:I}))):c=!1},p=()=>{c=!1};return{layers:new Set(a),listener:l,delegates:{mousemove:m,mouseout:p}}}if(d==="mouseleave"||d==="mouseout"){let c=!1,m=Z=>{let R=a.filter(I=>this.getLayer(I));(R.length?this.queryRenderedFeatures(Z.point,{layers:R}):[]).length?c=!0:c&&(c=!1,l.call(this,new Wn(d,this,Z.originalEvent)))},p=Z=>{c&&(c=!1,l.call(this,new Wn(d,this,Z.originalEvent)))};return{layers:new Set(a),listener:l,delegates:{mousemove:m,mouseout:p}}}{let c=m=>{let p=a.filter(R=>this.getLayer(R)),Z=p.length?this.queryRenderedFeatures(m.point,{layers:p}):[];Z.length&&(m.features=Z,l.call(this,m),delete m.features)};return{layers:new Set(a),listener:l,delegates:{[d]:c}}}}on(d,a,l){if(l===void 0)return super.on(d,a);if(Array.isArray(a)||(a=[a]),a){for(let m of a)if(!this._isValidId(m))return this}let c=this._createDelegatedListener(d,a,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(c);for(let m in c.delegates)this.on(m,c.delegates[m]);return this}once(d,a,l){if(l===void 0)return super.once(d,a);if(Array.isArray(a)||(a=[a]),a){for(let m of a)if(!this._isValidId(m))return this}let c=this._createDelegatedListener(d,a,l);for(let m in c.delegates)this.once(m,c.delegates[m]);return this}off(d,a,l){if(l===void 0)return super.off(d,a);a=new Set(Array.isArray(a)?a:[a]);for(let p of a)if(!this._isValidId(p))return this;let c=(p,Z)=>{if(p.size!==Z.size)return!1;for(let R of p)if(!Z.has(R))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[d]:void 0;return m&&(p=>{for(let Z=0;Z<p.length;Z++){let R=p[Z];if(R.listener===l&&c(R.layers,a)){for(let I in R.delegates)this.off(I,R.delegates[I]);return p.splice(Z,1),this}}})(m),this}queryRenderedFeatures(d,a){if(!this.style)return[];if(a!==void 0||d===void 0||d instanceof o.P||Array.isArray(d)||(a=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],(a=a||{}).layers&&Array.isArray(a.layers)){for(let l of a.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(d,a){return this._isValidId(d)?this.style.querySourceFeatures(d,a):[]}isPointOnSurface(d){let{name:a}=this.transform.projection;return a!=="globe"&&a!=="mercator"&&o.w("".concat(a," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(o.P.convert(d))}setStyle(d,a){return(a=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(d,a))}_getUIString(d){let a=this._locale[d];if(a==null)throw new Error("Missing UI string '".concat(d,"'"));return a}_updateStyle(d,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new ll(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ll(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,a){if(typeof d=="string"){let l=this._requestManager.normalizeStyleURL(d),c=this._requestManager.transformRequest(l,o.R.Style);o.g(c,(m,p)=>{m?this.fire(new o.a(m)):p&&this._updateDiff(p,a)})}else typeof d=="object"&&this._updateDiff(d,a)}_updateDiff(d,a){try{this.style.setState(d)&&this._update(!0)}catch(l){o.w("Unable to perform style diff: ".concat(l.message||l.error||l,".  Rebuilding the style from scratch.")),this._updateStyle(d,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new o.a(new Error("IDs can't be empty."))),!1):!o.c4(d)||(this.fire(new o.a(new Error("IDs can't contain special symbols: \"".concat(d,'".')))),!1)}addSource(d,a){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,a),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,a,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,a,l)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,a,{pixelRatio:l=1,sdf:c=!1,stretchX:m,stretchY:p,content:Z}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap){let{width:R,height:I,data:N}=o.f.getImageData(a);this.style.addImage(d,{data:new o.h({width:R,height:I},N),pixelRatio:l,stretchX:m,stretchY:p,content:Z,sdf:c,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new o.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:R,height:I}=a,N=a;this.style.addImage(d,{data:new o.h({width:R,height:I},new Uint8Array(N.data)),pixelRatio:l,stretchX:m,stretchY:p,content:Z,sdf:c,version:0,userImage:N}),N.onAdd&&N.onAdd(this,d)}}updateImage(d,a){this._lazyInitEmptyStyle();let l=this.style.getImage(d);if(!l)return void this.fire(new o.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let c=a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap?o.f.getImageData(a):a,{width:m,height:p}=c,Z=c.data;if(m===void 0||p===void 0)return void this.fire(new o.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==l.data.width||p!==l.data.height)return void this.fire(new o.a(new Error("The width and height of the updated image (".concat(m,", ").concat(p,")\n                must be that same as the previous version of the image\n                (").concat(l.data.width,", ").concat(l.data.height,")"))));let R=!(a instanceof HTMLImageElement||ImageBitmap&&a instanceof ImageBitmap);l.data.replace(Z,R),this.style.updateImage(d,l)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new o.a(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,a){o.d(this._requestManager.transformRequest(d,o.R.Image),(l,c)=>{a(l,c instanceof HTMLImageElement?o.f.getImageData(c):c)})}listImages(){return this.style.listImages()}addModel(d,a){this._lazyInitEmptyStyle(),this.style.addModel(d,a)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new o.a(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,a){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,a),this._update(!0)):this}getSlot(d){let a=this.getLayer(d);return a&&a.slot||null}setSlot(d,a){return this.style.setSlot(d,a),this.style.mergeLayers(),this._update(!0)}addImport(d,a){return this.style.addImport(d,a),this}updateImport(d,a){return typeof a!="string"&&a.id!==d?(this.removeImport(d),this.addImport(a)):(this.style.updateImport(d,a),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,a){return this.style.moveImport(d,a),this._update(!0)}moveLayer(d,a){return this._isValidId(d)?(this.style.moveLayer(d,a),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){return this._isValidId(d)?this.style.getOwnLayer(d):null}setLayerZoomRange(d,a,l){return this._isValidId(d)?(this.style.setLayerZoomRange(d,a,l),this._update(!0)):this}setFilter(d,a,l={}){return this._isValidId(d)?(this.style.setFilter(d,a,l),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,a,l,c={}){return this._isValidId(d)?(this.style.setPaintProperty(d,a,l,c),this._update(!0)):this}getPaintProperty(d,a){return this._isValidId(d)?this.style.getPaintProperty(d,a):null}setLayoutProperty(d,a,l,c={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,a,l,c),this._update(!0)):this}getLayoutProperty(d,a){return this._isValidId(d)?this.style.getLayoutProperty(d,a):null}getConfigProperty(d,a){return this.style.getConfigProperty(d,a)}setConfigProperty(d,a,l){return this.style.setConfigProperty(d,a,l),this._update(!0)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){let a=d[0];a.properties?this.style.setFlatLight(a.properties,a.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,a={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bn.convert(d),this.transform):0}setFeatureState(d,a){return this._isValidId(d.source)?(this.style.setFeatureState(d,a),this._update()):this}removeFeatureState(d,a){return this._isValidId(d.source)?(this.style.removeFeatureState(d,a),this._update()):this}getFeatureState(d){return this._isValidId(d.source)?this.style.getFeatureState(d):null}_updateContainerDimensions(){if(!this._container)return;let d=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300,l,c,m,p=this._container;for(;p&&(!c||!m);){let Z=window.getComputedStyle(p).transform;Z&&Z!=="none"&&(l=Z.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(c=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(m=l[3])),p=p.parentElement}this._containerWidth=c?Math.abs(d/c):d,this._containerHeight=m?Math.abs(a/m):a}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ut("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();let a=this._canvasContainer=Ut("div","mapboxgl-canvas-container",d);this._canvas=Ut("canvas","mapboxgl-canvas",a),this._interactive&&(a.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let l=this._controlContainer=Ut("div","mapboxgl-control-container",d),c=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{c[m]=Ut("div","mapboxgl-ctrl-".concat(m),l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,a){let l=o.f.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(a),this._canvas.style.width="".concat(d,"px"),this._canvas.style.height="".concat(a,"px")}_addMarker(d){this._markers.push(d)}_removeMarker(d){let a=this._markers.indexOf(d);a!==-1&&this._markers.splice(a,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){let a=this._popups.indexOf(d);a!==-1&&this._popups.splice(a,1)}_setupPainter(){let d=o.e({},ct.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl2",d);a?(o.db(a,!0),this.painter=new k0(a,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.dc.testSupport(a)):this.fire(new o.a(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.b("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new o.b("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let a;this.fire(new o.b("renderstart"));let l=this.painter.context.extTimerQuery,c=o.f.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(a=m.createQuery(),m.beginQuery(l.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();let p=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let I=this.transform.zoom,N=this.transform.pitch,Y=o.f.now(),J=new o.K(I,{now:Y,fadeDuration:p,pitch:N,transition:this.style.transition});this.style.update(J)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let Z=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),Z=this._updateAverageElevation(c),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):Z=this._updateAverageElevation(c),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,p,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:p,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){let I=o.f.now()-c;m.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{let N=m.getQueryParameter(a,m.QUERY_RESULT)/1e6;m.deleteQuery(a),this.fire(new o.b("gpu-timing-frame",{cpuTime:I,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){let I=this.painter.collectGpuTimers();setTimeout(()=>{let N=this.painter.queryGpuTimers(I);this.fire(new o.b("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){let I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let N=this.painter.queryGpuTimeDeferredRender(I);this.fire(new o.b("gpu-timing-deferred-render",{gpuTime:N}))},50)}let R=this._sourcesDirty||this._styleDirty||this._placementDirty||Z;if(R||this._repaint)this.triggerRepaint();else{let I=!this.isMoving()&&this.loaded();if(I&&(Z=this._updateAverageElevation(c,!0)),Z)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new o.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let N=this._calculateSpeedIndex();this.fire(new o.b("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,this._performanceMetricsCollection&&o.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(let a of this._markers)d&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(let a of this._popups)!d||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(d,a=!1){let l=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);let c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(a||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){let m=this.transform.averageElevation,p=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=d;let Z=Math.abs(m-p);if(Z>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(p),l(p);this._averageElevation.easeTo(p,d,300)}else if(Z>1e-4)return this._averageElevation.jumpTo(p),l(p)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){o.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===o.df||d.status===401)){let a=this.painter.context.gl;o.db(a,!1),this._logoControl instanceof j0&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){let d=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());let l=this.painter.context.gl,c=l.createFramebuffer();function m(p){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,p,0);let Z=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,Z),Z}return l.bindFramebuffer(l.FRAMEBUFFER,c),this._canvasPixelComparison(m(d),a.canvasCopies.map(m),a.timeStamps)}_canvasPixelComparison(d,a,l){let c=l[1]-l[0],m=d.length/4;for(let p=0;p<a.length;p++){let Z=a[p],R=0;for(let I=0;I<Z.length;I+=4)Z[I]===d[I]&&Z[I+1]===d[I+1]&&Z[I+2]===d[I+2]&&Z[I+3]===d[I+3]&&(R+=1);c+=(l[p+2]-l[p+1])*(1-R/m)}return c}remove(){this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dh(this.painter.context.gl),o.di.remove(),o.dj.remove(),this._removed=!0,this.fire(new o.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.f.frame(a=>{let l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(a)}))}_preloadTiles(d){let a=this.style?Object.values(this.style._sourceCaches):[];return o.b1(a,(l,c)=>l._preloadTiles(d,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,a){o.dl(d,a)}get version(){return o.dk}},NavigationControl:class{constructor(d){this.options=o.e({},Ad,d),this._container=Ut("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Ut("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Ut("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{let l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:a}):l.resetNorth({},{originalEvent:a}))}),this._compassIcon=Ut("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let d=this._map;if(!d)return;let a=d.getZoom(),l=a===d.getMaxZoom(),c=a===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){let d=this._map;if(!d)return;let a=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(d.transform.pitch,"deg) rotateZ(").concat(d.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(d.transform.angle*(180/Math.PI),"deg)");d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fl(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){let d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,a){let l=Ut("button",d,this._container);return l.type="button",l.addEventListener("click",a),l}_setButtonTitle(d,a){if(!this._map)return;let l=this._map._getUIString("NavigationControl.".concat(a));d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(d){super();let a=navigator.geolocation;this.options=o.e({geolocation:a},Hd,d),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Us(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=Ut("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){let a=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>a(l.state!=="denied")).catch(()=>a()):a()}_isOutOfMapMaxBounds(d){let a=this._map.getMaxBounds(),l=d.coords;return!!a&&(l.longitude<a.getWest()||l.longitude>a.getEast()||l.latitude<a.getSouth()||l.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.b("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("geolocate",d)),this._finish()}}_updateCamera(d){let a=new o.bn(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,c=this._map.getBearing(),m=o.e({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(l),m,{geolocateSource:!0})}_updateMarker(d){if(d){let a=new o.bn(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let d=this._map.transform,a=o.bl(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*a);this._circleElement.style.width="".concat(l,"px"),this._circleElement.style.height="".concat(l,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Ut("button","mapboxgl-ctrl-geolocate",this._container),Ut("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ut("div","mapboxgl-user-location"),this._dotElement.appendChild(Ut("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ut("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new nm({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ut("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nm({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.b("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:am,ScaleControl:class{constructor(d){this.options=o.e({},sn,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let d=this.options.maxWidth||100,a=this._map,l=a._containerHeight/2,c=a._containerWidth/2-d/2,m=a.unproject([c,l]),p=a.unproject([c+d,l]),Z=m.distanceTo(p);if(this.options.unit==="imperial"){let R=3.2808*Z;R>5280?this._setScale(d,R/5280,"mile"):this._setScale(d,R,"foot")}else this.options.unit==="nautical"?this._setScale(d,Z/1852,"nautical-mile"):Z>=1e3?this._setScale(d,Z/1e3,"kilometer"):this._setScale(d,Z,"meter")}_setScale(d,a,l){this._map._requestDomTask(()=>{let c=function(p){let Z=Math.pow(10,"".concat(Math.floor(p)).length-1),R=p/Z;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(I){let N=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*N)/N}(R),Z*R}(a),m=c/a;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(c):"".concat(c,"&nbsp;").concat(Zo[l]),this._container.style.width=d*m+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=Ut("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ut("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let d=this._fullscreenButton=Ut("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ut("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(d){super(),this.options=o.e(Object.create(D0),d),o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new o.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new o.b("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=o.bn.convert(d),this._pos=null,this._trackPointer=!1,this._update();let a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){let a=document.createDocumentFragment(),l=document.createElement("body"),c;for(l.innerHTML=d;c=l.firstChild,c;)a.appendChild(c);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Ut("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(d),this.options.closeButton){let l=this._closeButton=Ut("button","mapboxgl-popup-close-button",a);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let a;return this._classList.delete(d)?a=!1:(this._classList.add(d),a=!0),this._updateClassList(),a}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;let a=this._map,l=this._container,c=this._pos;if(!a||!l||!c)return"bottom";let m=l.offsetWidth,p=l.offsetHeight,Z=c.x<m/2,R=c.x>a.transform.width-m/2;if(c.y+d<p)return Z?"top-left":R?"top-right":"top";if(c.y>a.transform.height-p){if(Z)return"bottom-left";if(R)return"bottom-right"}return Z?"left":R?"right":"bottom"}_updateClassList(){let d=this._container;if(!d)return;let a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),d.className=a.join(" ")}_update(d){let a=this._map,l=this._content;if(!a||!this._lngLat&&!this._trackPointer||!l)return;let c=this._container;if(c||(c=this._container=Ut("div","mapboxgl-popup",a.getContainer()),this._tip=Ut("div","mapboxgl-popup-tip",c),c.appendChild(l)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ks(this._lngLat,this._pos,a.transform)),!this._trackPointer||d){let m=this._pos=this._trackPointer&&d?d:a.project(this._lngLat),p=P0(this.options.offset),Z=this._anchor=this._getAnchor(p.y),R=P0(this.options.offset,Z),I=m.add(R).round();a._requestDomTask(()=>{this._container&&Z&&(this._container.style.transform="".concat(Ed[Z]," translate(").concat(I.x,"px,").concat(I.y,"px)"))})}if(!this._marker&&a._showingGlobe()){let m=o.d6(a.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let d=this._container.querySelector(_0);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity="".concat(d)),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:nm,Style:ll,LngLat:o.bn,LngLatBounds:o.ad,Point:o.P,MercatorCoordinate:o.L,FreeCameraOptions:rs,Evented:o.E,config:o.d5,prewarm:o.dp,clearPrewarmedResources:o.dq,get accessToken(){return o.d5.ACCESS_TOKEN},set accessToken(d){o.d5.ACCESS_TOKEN=d},get baseApiUrl(){return o.d5.API_URL},set baseApiUrl(d){o.d5.API_URL=d},get workerCount(){return o.dr.workerCount},set workerCount(d){o.dr.workerCount=d},get maxParallelImageRequests(){return o.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.d5.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.ds(d)},get workerUrl(){return o.dt.workerUrl},set workerUrl(d){o.dt.workerUrl=d},get workerClass(){return o.dt.workerClass},set workerClass(d){o.dt.workerClass=d},get workerParams(){return o.dt.workerParams},set workerParams(d){o.dt.workerParams=d},get dracoUrl(){return o.du()},set dracoUrl(d){o.dv(d)},get meshoptUrl(){return o.dw()},set meshoptUrl(d){o.dx(d)},setNow:o.f.setNow,restoreNow:o.f.restoreNow}});var L=x;return L})});var sd=Si((kf,rF)=>{rF.exports=fB;var SB=Object.prototype.hasOwnProperty;function fB(){for(var G={},g=0;g<arguments.length;g++){var x=arguments[g];for(var C in x)SB.call(x,C)&&(G[C]=x[C])}return G}});var cF=Si((sF,dF)=>{(function(){var G=this,g={};typeof sF<"u"?dF.exports=g:G.fuzzy=g,g.simpleFilter=function(x,C){return C.filter(function(L){return g.test(x,L)})},g.test=function(x,C){return g.match(x,C)!==null},g.match=function(x,C,L){L=L||{};var o=0,_=[],ct=C.length,lt=0,Ot=0,Ut=L.pre||"",de=L.post||"",Ze=L.caseSensitive&&C||C.toLowerCase(),Fe;x=L.caseSensitive&&x||x.toLowerCase();for(var qe=0;qe<ct;qe++)Fe=C[qe],Ze[qe]===x[o]?(Fe=Ut+Fe+de,o+=1,Ot+=1+Ot):Ot=0,lt+=Ot,_[_.length]=Fe;return o===x.length?(lt=Ze===x?1/0:lt,{rendered:_.join(""),score:lt}):null},g.filter=function(x,C,L){return!C||C.length===0?[]:typeof x!="string"?C:(L=L||{},C.reduce(function(o,_,ct,lt){var Ot=_;L.extract&&(Ot=L.extract(_));var Ut=g.match(x,Ot,L);return Ut!=null&&(o[o.length]={string:Ut.rendered,score:Ut.score,index:ct,original:_}),o},[]).sort(function(o,_){var ct=_.score-o.score;return ct||o.index-_.index}))}})()});var mF=Si((Qf,bF)=>{"use strict";var qn=function(G){return this.component=G,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,G.el.parentNode.insertBefore(this.wrapper,G.el.nextSibling),this};qn.prototype.show=function(){this.element.style.display="block"};qn.prototype.hide=function(){this.element.style.display="none"};qn.prototype.add=function(G){this.items.push(G)};qn.prototype.clear=function(){this.items=[],this.active=0};qn.prototype.isEmpty=function(){return!this.items.length};qn.prototype.isVisible=function(){return this.element.style.display==="block"};qn.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var G=0;G<this.items.length;G++)this.drawItem(this.items[G],this.active===G);this.show()};qn.prototype.drawItem=function(G,g){var x=document.createElement("li"),C=document.createElement("a");g&&(x.className+=" active"),C.innerHTML=G.string,x.appendChild(C),this.element.appendChild(x),x.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),x.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,G)}).bind(this))};qn.prototype.handleMouseUp=function(G){this.selectingListItem=!1,this.component.value(G.original),this.clear(),this.draw()};qn.prototype.move=function(G){this.active=G,this.draw()};qn.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};qn.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};qn.prototype.drawError=function(G){var g=document.createElement("li");g.innerHTML=G,this.element.appendChild(g),this.show()};bF.exports=qn});var pF=Si((Sf,hF)=>{"use strict";var vB=sd(),LB=cF(),zB=mF(),yn=function(G,g,x){return x=x||{},this.options=vB({minLength:2,limit:5,filter:!0,hideOnBlur:!0},x),this.el=G,this.data=g||[],this.list=new zB(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(C){this.handleKeyUp(C.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(C){this.handleKeyDown(C)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(C){this.handlePaste(C)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};yn.prototype.handleKeyUp=function(G){G===40||G===38||G===27||G===13||G===9||this.handleInputChange(this.el.value)};yn.prototype.handleKeyDown=function(G){switch(G.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&G.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};yn.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};yn.prototype.handlePaste=function(G){if(G.clipboardData)this.handleInputChange(G.clipboardData.getData("Text"));else{var g=this;setTimeout(function(){g.handleInputChange(G.target.value)},100)}};yn.prototype.handleInputChange=function(G){if(this.query=this.normalize(G),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(g){for(var x=0;x<g.length&&(this.list.add(g[x]),x!==this.options.limit-1);x++);this.list.draw()}).bind(this))};yn.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};yn.prototype.update=function(G){this.data=G,this.handleKeyUp()};yn.prototype.clear=function(){this.data=[],this.list.clear()};yn.prototype.normalize=function(G){return G=G.toLowerCase(),G};yn.prototype.match=function(G,g){return G.indexOf(g)>-1};yn.prototype.value=function(G){if(this.selected=G,this.el.value=this.getItemValue(G),document.createEvent){var g=document.createEvent("HTMLEvents");g.initEvent("change",!0,!1),this.el.dispatchEvent(g)}else this.el.fireEvent("onchange")};yn.prototype.getCandidates=function(G){var g={pre:"<strong>",post:"</strong>",extract:(function(C){return this.getItemValue(C)}).bind(this)},x;this.options.filter?(x=LB.filter(this.query,this.data,g),x=x.map((function(C){return{original:C.original,string:this.render(C.original,C.string)}}).bind(this))):x=this.data.map((function(C){var L=this.render(C);return{original:C,string:L}}).bind(this)),G(x)};yn.prototype.getItemValue=function(G){return G};yn.prototype.render=function(G,g){if(g)return g;for(var x=G.original?this.getItemValue(G.original):this.getItemValue(G),C=this.normalize(x),L=C.lastIndexOf(this.query);L>-1;){var o=L+this.query.length;x=x.slice(0,L)+"<strong>"+x.slice(L,o)+"</strong>"+x.slice(o),L=C.slice(0,L).lastIndexOf(this.query)}return x};yn.prototype.renderError=function(G){this.list.drawError(G)};hF.exports=yn});var ZF=Si((ff,uF)=>{"use strict";var WF=pF();uF.exports=WF;typeof window<"u"&&(window.Suggestions=WF)});var GF=Si((vf,RF)=>{var wB="Expected a function",gF=NaN,EB="[object Symbol]",AB=/^\s+|\s+$/g,HB=/^[-+]0x[0-9a-f]+$/i,jB=/^0b[01]+$/i,OB=/^0o[0-7]+$/i,DB=parseInt,_B=typeof global=="object"&&global&&global.Object===Object&&global,PB=typeof self=="object"&&self&&self.Object===Object&&self,KB=_B||PB||Function("return this")(),qB=Object.prototype,$B=qB.toString,tM=Math.max,eM=Math.min,mu=function(){return KB.Date.now()};function iM(G,g,x){var C,L,o,_,ct,lt,Ot=0,Ut=!1,de=!1,Ze=!0;if(typeof G!="function")throw new TypeError(wB);g=VF(g)||0,hu(x)&&(Ut=!!x.leading,de="maxWait"in x,o=de?tM(VF(x.maxWait)||0,g):o,Ze="trailing"in x?!!x.trailing:Ze);function Fe(Nt){var Yi=C,Pi=L;return C=L=void 0,Ot=Nt,_=G.apply(Pi,Yi),_}function qe(Nt){return Ot=Nt,ct=setTimeout(hi,g),Ut?Fe(Nt):_}function Le(Nt){var Yi=Nt-lt,Pi=Nt-Ot,ye=g-Yi;return de?eM(ye,o-Pi):ye}function Ee(Nt){var Yi=Nt-lt,Pi=Nt-Ot;return lt===void 0||Yi>=g||Yi<0||de&&Pi>=o}function hi(){var Nt=mu();if(Ee(Nt))return Xi(Nt);ct=setTimeout(hi,Le(Nt))}function Xi(Nt){return ct=void 0,Ze&&C?Fe(Nt):(C=L=void 0,_)}function vi(){ct!==void 0&&clearTimeout(ct),Ot=0,C=lt=L=ct=void 0}function Se(){return ct===void 0?_:Xi(mu())}function Zi(){var Nt=mu(),Yi=Ee(Nt);if(C=arguments,L=this,lt=Nt,Yi){if(ct===void 0)return qe(lt);if(de)return ct=setTimeout(hi,g),Fe(lt)}return ct===void 0&&(ct=setTimeout(hi,g)),_}return Zi.cancel=vi,Zi.flush=Se,Zi}function hu(G){var g=typeof G;return!!G&&(g=="object"||g=="function")}function aM(G){return!!G&&typeof G=="object"}function nM(G){return typeof G=="symbol"||aM(G)&&$B.call(G)==EB}function VF(G){if(typeof G=="number")return G;if(nM(G))return gF;if(hu(G)){var g=typeof G.valueOf=="function"?G.valueOf():G;G=hu(g)?g+"":g}if(typeof G!="string")return G===0?G:+G;G=G.replace(AB,"");var x=jB.test(G);return x||OB.test(G)?DB(G.slice(2),x?2:8):HB.test(G)?gF:+G}RF.exports=iM});var MF=Si((Lf,pu)=>{"use strict";var Bc=typeof Reflect=="object"?Reflect:null,FF=Bc&&typeof Bc.apply=="function"?Bc.apply:function(g,x,C){return Function.prototype.apply.call(g,x,C)},Up;Bc&&typeof Bc.ownKeys=="function"?Up=Bc.ownKeys:Object.getOwnPropertySymbols?Up=function(g){return Object.getOwnPropertyNames(g).concat(Object.getOwnPropertySymbols(g))}:Up=function(g){return Object.getOwnPropertyNames(g)};function lM(G){console&&console.warn&&console.warn(G)}var UF=Number.isNaN||function(g){return g!==g};function ba(){ba.init.call(this)}pu.exports=ba;pu.exports.once=dM;ba.EventEmitter=ba;ba.prototype._events=void 0;ba.prototype._eventsCount=0;ba.prototype._maxListeners=void 0;var IF=10;function xp(G){if(typeof G!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof G)}Object.defineProperty(ba,"defaultMaxListeners",{enumerable:!0,get:function(){return IF},set:function(G){if(typeof G!="number"||G<0||UF(G))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+G+".");IF=G}});ba.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ba.prototype.setMaxListeners=function(g){if(typeof g!="number"||g<0||UF(g))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+g+".");return this._maxListeners=g,this};function xF(G){return G._maxListeners===void 0?ba.defaultMaxListeners:G._maxListeners}ba.prototype.getMaxListeners=function(){return xF(this)};ba.prototype.emit=function(g){for(var x=[],C=1;C<arguments.length;C++)x.push(arguments[C]);var L=g==="error",o=this._events;if(o!==void 0)L=L&&o.error===void 0;else if(!L)return!1;if(L){var _;if(x.length>0&&(_=x[0]),_ instanceof Error)throw _;var ct=new Error("Unhandled error."+(_?" ("+_.message+")":""));throw ct.context=_,ct}var lt=o[g];if(lt===void 0)return!1;if(typeof lt=="function")FF(lt,this,x);else for(var Ot=lt.length,Ut=yF(lt,Ot),C=0;C<Ot;++C)FF(Ut[C],this,x);return!0};function NF(G,g,x,C){var L,o,_;if(xp(x),o=G._events,o===void 0?(o=G._events=Object.create(null),G._eventsCount=0):(o.newListener!==void 0&&(G.emit("newListener",g,x.listener?x.listener:x),o=G._events),_=o[g]),_===void 0)_=o[g]=x,++G._eventsCount;else if(typeof _=="function"?_=o[g]=C?[x,_]:[_,x]:C?_.unshift(x):_.push(x),L=xF(G),L>0&&_.length>L&&!_.warned){_.warned=!0;var ct=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(g)+" listeners added. Use emitter.setMaxListeners() to increase limit");ct.name="MaxListenersExceededWarning",ct.emitter=G,ct.type=g,ct.count=_.length,lM(ct)}return G}ba.prototype.addListener=function(g,x){return NF(this,g,x,!1)};ba.prototype.on=ba.prototype.addListener;ba.prototype.prependListener=function(g,x){return NF(this,g,x,!0)};function oM(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function YF(G,g,x){var C={fired:!1,wrapFn:void 0,target:G,type:g,listener:x},L=oM.bind(C);return L.listener=x,C.wrapFn=L,L}ba.prototype.once=function(g,x){return xp(x),this.on(g,YF(this,g,x)),this};ba.prototype.prependOnceListener=function(g,x){return xp(x),this.prependListener(g,YF(this,g,x)),this};ba.prototype.removeListener=function(g,x){var C,L,o,_,ct;if(xp(x),L=this._events,L===void 0)return this;if(C=L[g],C===void 0)return this;if(C===x||C.listener===x)--this._eventsCount===0?this._events=Object.create(null):(delete L[g],L.removeListener&&this.emit("removeListener",g,C.listener||x));else if(typeof C!="function"){for(o=-1,_=C.length-1;_>=0;_--)if(C[_]===x||C[_].listener===x){ct=C[_].listener,o=_;break}if(o<0)return this;o===0?C.shift():rM(C,o),C.length===1&&(L[g]=C[0]),L.removeListener!==void 0&&this.emit("removeListener",g,ct||x)}return this};ba.prototype.off=ba.prototype.removeListener;ba.prototype.removeAllListeners=function(g){var x,C,L;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[g]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[g]),this;if(arguments.length===0){var o=Object.keys(C),_;for(L=0;L<o.length;++L)_=o[L],_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(x=C[g],typeof x=="function")this.removeListener(g,x);else if(x!==void 0)for(L=x.length-1;L>=0;L--)this.removeListener(g,x[L]);return this};function XF(G,g,x){var C=G._events;if(C===void 0)return[];var L=C[g];return L===void 0?[]:typeof L=="function"?x?[L.listener||L]:[L]:x?sM(L):yF(L,L.length)}ba.prototype.listeners=function(g){return XF(this,g,!0)};ba.prototype.rawListeners=function(g){return XF(this,g,!1)};ba.listenerCount=function(G,g){return typeof G.listenerCount=="function"?G.listenerCount(g):JF.call(G,g)};ba.prototype.listenerCount=JF;function JF(G){var g=this._events;if(g!==void 0){var x=g[G];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}ba.prototype.eventNames=function(){return this._eventsCount>0?Up(this._events):[]};function yF(G,g){for(var x=new Array(g),C=0;C<g;++C)x[C]=G[C];return x}function rM(G,g){for(;g+1<G.length;g++)G[g]=G[g+1];G.pop()}function sM(G){for(var g=new Array(G.length),x=0;x<g.length;++x)g[x]=G[x].listener||G[x];return g}function dM(G,g){return new Promise(function(x,C){function L(_){G.removeListener(g,o),C(_)}function o(){typeof G.removeListener=="function"&&G.removeListener("error",L),x([].slice.call(arguments))}BF(G,g,o,{once:!0}),g!=="error"&&cM(G,L,{once:!0})})}function cM(G,g,x){typeof G.on=="function"&&BF(G,"error",g,x)}function BF(G,g,x,C){if(typeof G.on=="function")C.once?G.once(g,x):G.on(g,x);else if(typeof G.addEventListener=="function")G.addEventListener(g,function L(o){C.once&&G.removeEventListener(g,L),x(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof G)}});var TF=Si((zf,CF)=>{CF.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}});var QF=Si((wf,kF)=>{"use strict";function bM(G){var g=G.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return g?{key:g[1],value:g[2]}:null}function mM(G){var g=G.match(/<?([^>]*)>(.*)/);if(!g)return null;var x=g[1],C=g[2].split(";"),L=null,o=C.reduce(function(_,ct){var lt=bM(ct);return lt?lt.key==="rel"?(L||(L=lt.value),_):(_[lt.key]=lt.value,_):_},{});return L?{url:x,rel:L,params:o}:null}function hM(G){return G?G.split(/,\s*</).reduce(function(g,x){var C=mM(x);if(!C)return g;var L=C.rel.split(/\s+/);return L.forEach(function(o){g[o]||(g[o]={url:C.url,params:C.params})}),g},{}):{}}kF.exports=hM});var fF=Si((Ef,SF)=>{"use strict";var pM=QF();function Wu(G,g){this.request=G,this.headers=g.headers,this.rawBody=g.body,this.statusCode=g.statusCode;try{this.body=JSON.parse(g.body||"{}")}catch{this.body=g.body}this.links=pM(this.headers.link)}Wu.prototype.hasNextPage=function(){return!!this.links.next};Wu.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};SF.exports=Wu});var $m=Si((Af,vF)=>{"use strict";vF.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}});var wF=Si((Hf,zF)=>{"use strict";var LF=$m();function WM(G){var g=G.type||LF.ERROR_HTTP,x;if(G.body)try{x=JSON.parse(G.body)}catch{x=G.body}else x=null;var C=G.message||null;C||(typeof x=="string"?C=x:x&&typeof x.message=="string"?C=x.message:g===LF.ERROR_REQUEST_ABORTED&&(C="Request aborted")),this.message=C,this.type=g,this.statusCode=G.statusCode||null,this.request=G.request,this.body=x}zF.exports=WM});var AF=Si((jf,EF)=>{"use strict";function uM(G){var g=G.indexOf(":"),x=G.substring(0,g).trim().toLowerCase(),C=G.substring(g+1).trim();return{name:x,value:C}}function ZM(G){var g={};return G&&G.trim().split(/[\r|\n]+/).forEach(function(x){var C=uM(x);g[C.name]=C.value}),g}EF.exports=ZM});var PF=Si((Of,_F)=>{"use strict";var gM=fF(),HF=wF(),uu=$m(),VM=AF(),Np={};function RM(G){var g=Np[G.id];g&&(g.abort(),delete Np[G.id])}function GM(G,g){return new gM(G,{body:g.response,headers:VM(g.getAllResponseHeaders()),statusCode:g.status})}function jF(G){var g=G.total,x=G.loaded,C=100*x/g;return{total:g,transferred:x,percent:C}}function OF(G,g){return new Promise(function(x,C){g.onprogress=function(_){G.emitter.emit(uu.EVENT_PROGRESS_DOWNLOAD,jF(_))};var L=G.file;L&&(g.upload.onprogress=function(_){G.emitter.emit(uu.EVENT_PROGRESS_UPLOAD,jF(_))}),g.onerror=function(_){C(_)},g.onabort=function(){var _=new HF({request:G,type:uu.ERROR_REQUEST_ABORTED});C(_)},g.onload=function(){if(delete Np[G.id],g.status<200||g.status>=400){var _=new HF({request:G,body:g.response,statusCode:g.status});C(_);return}x(g)};var o=G.body;typeof o=="string"?g.send(o):o?g.send(JSON.stringify(o)):L?g.send(L):g.send(),Np[G.id]=g}).then(function(x){return GM(G,x)})}function DF(G,g){var x=G.url(g),C=new window.XMLHttpRequest;return C.open(G.method,x),Object.keys(G.headers).forEach(function(L){C.setRequestHeader(L,G.headers[L])}),C}function FM(G){return Promise.resolve().then(function(){var g=DF(G,G.client.accessToken);return OF(G,g)})}_F.exports={browserAbort:RM,sendRequestXhr:OF,browserSend:FM,createRequestXhr:DF}});var KF=Si((Yp,t0)=>{(function(G){var g=typeof Yp=="object"&&Yp,x=typeof t0=="object"&&t0&&t0.exports==g&&t0,C=typeof global=="object"&&global;(C.global===C||C.window===C)&&(G=C);var L=function(Ze){this.message=Ze};L.prototype=new Error,L.prototype.name="InvalidCharacterError";var o=function(Ze){throw new L(Ze)},_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ct=/[\t\n\f\r ]/g,lt=function(Ze){Ze=String(Ze).replace(ct,"");var Fe=Ze.length;Fe%4==0&&(Ze=Ze.replace(/==?$/,""),Fe=Ze.length),(Fe%4==1||/[^+a-zA-Z0-9/]/.test(Ze))&&o("Invalid character: the string to be decoded is not correctly encoded.");for(var qe=0,Le,Ee,hi="",Xi=-1;++Xi<Fe;)Ee=_.indexOf(Ze.charAt(Xi)),Le=qe%4?Le*64+Ee:Ee,qe++%4&&(hi+=String.fromCharCode(255&Le>>(-2*qe&6)));return hi},Ot=function(Ze){Ze=String(Ze),/[^\0-\xFF]/.test(Ze)&&o("The string to be encoded contains characters outside of the Latin1 range.");for(var Fe=Ze.length%3,qe="",Le=-1,Ee,hi,Xi,vi,Se,Zi=Ze.length-Fe;++Le<Zi;)Ee=Ze.charCodeAt(Le)<<16,hi=Ze.charCodeAt(++Le)<<8,Xi=Ze.charCodeAt(++Le),Se=Ee+hi+Xi,qe+=_.charAt(Se>>18&63)+_.charAt(Se>>12&63)+_.charAt(Se>>6&63)+_.charAt(Se&63);return Fe==2?(Ee=Ze.charCodeAt(Le)<<8,hi=Ze.charCodeAt(++Le),Se=Ee+hi,qe+=_.charAt(Se>>10)+_.charAt(Se>>4&63)+_.charAt(Se<<2&63)+"="):Fe==1&&(Se=Ze.charCodeAt(Le),qe+=_.charAt(Se>>2)+_.charAt(Se<<4&63)+"=="),qe},Ut={encode:Ot,decode:lt,version:"0.1.0"};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define(function(){return Ut});else if(g&&!g.nodeType)if(x)x.exports=Ut;else for(var de in Ut)Ut.hasOwnProperty(de)&&(g[de]=Ut[de]);else G.base64=Ut})(Yp)});var gu=Si((Df,qF)=>{"use strict";var IM=KF(),Zu={};function UM(G){if(Zu[G])return Zu[G];var g=G.split("."),x=g[0],C=g[1];if(!C)throw new Error("Invalid token");var L=xM(C),o={usage:x,user:L.u};return dd(L,"a")&&(o.authorization=L.a),dd(L,"exp")&&(o.expires=L.exp*1e3),dd(L,"iat")&&(o.created=L.iat*1e3),dd(L,"scopes")&&(o.scopes=L.scopes),dd(L,"client")&&(o.client=L.client),dd(L,"ll")&&(o.lastLogin=L.ll),dd(L,"iu")&&(o.impersonator=L.iu),Zu[G]=o,o}function xM(G){try{return JSON.parse(IM.decode(G))}catch{throw new Error("Invalid token")}}function dd(G,g){return Object.prototype.hasOwnProperty.call(G,g)}qF.exports=UM});var tI=Si((_f,Vu)=>{"use strict";var NM=Object.prototype.hasOwnProperty,vn="~";function e0(){}Object.create&&(e0.prototype=Object.create(null),new e0().__proto__||(vn=!1));function YM(G,g,x){this.fn=G,this.context=g,this.once=x||!1}function $F(G,g,x,C,L){if(typeof x!="function")throw new TypeError("The listener must be a function");var o=new YM(x,C||G,L),_=vn?vn+g:g;return G._events[_]?G._events[_].fn?G._events[_]=[G._events[_],o]:G._events[_].push(o):(G._events[_]=o,G._eventsCount++),G}function Xp(G,g){--G._eventsCount===0?G._events=new e0:delete G._events[g]}function Bn(){this._events=new e0,this._eventsCount=0}Bn.prototype.eventNames=function(){var g=[],x,C;if(this._eventsCount===0)return g;for(C in x=this._events)NM.call(x,C)&&g.push(vn?C.slice(1):C);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(x)):g};Bn.prototype.listeners=function(g){var x=vn?vn+g:g,C=this._events[x];if(!C)return[];if(C.fn)return[C.fn];for(var L=0,o=C.length,_=new Array(o);L<o;L++)_[L]=C[L].fn;return _};Bn.prototype.listenerCount=function(g){var x=vn?vn+g:g,C=this._events[x];return C?C.fn?1:C.length:0};Bn.prototype.emit=function(g,x,C,L,o,_){var ct=vn?vn+g:g;if(!this._events[ct])return!1;var lt=this._events[ct],Ot=arguments.length,Ut,de;if(lt.fn){switch(lt.once&&this.removeListener(g,lt.fn,void 0,!0),Ot){case 1:return lt.fn.call(lt.context),!0;case 2:return lt.fn.call(lt.context,x),!0;case 3:return lt.fn.call(lt.context,x,C),!0;case 4:return lt.fn.call(lt.context,x,C,L),!0;case 5:return lt.fn.call(lt.context,x,C,L,o),!0;case 6:return lt.fn.call(lt.context,x,C,L,o,_),!0}for(de=1,Ut=new Array(Ot-1);de<Ot;de++)Ut[de-1]=arguments[de];lt.fn.apply(lt.context,Ut)}else{var Ze=lt.length,Fe;for(de=0;de<Ze;de++)switch(lt[de].once&&this.removeListener(g,lt[de].fn,void 0,!0),Ot){case 1:lt[de].fn.call(lt[de].context);break;case 2:lt[de].fn.call(lt[de].context,x);break;case 3:lt[de].fn.call(lt[de].context,x,C);break;case 4:lt[de].fn.call(lt[de].context,x,C,L);break;default:if(!Ut)for(Fe=1,Ut=new Array(Ot-1);Fe<Ot;Fe++)Ut[Fe-1]=arguments[Fe];lt[de].fn.apply(lt[de].context,Ut)}}return!0};Bn.prototype.on=function(g,x,C){return $F(this,g,x,C,!1)};Bn.prototype.once=function(g,x,C){return $F(this,g,x,C,!0)};Bn.prototype.removeListener=function(g,x,C,L){var o=vn?vn+g:g;if(!this._events[o])return this;if(!x)return Xp(this,o),this;var _=this._events[o];if(_.fn)_.fn===x&&(!L||_.once)&&(!C||_.context===C)&&Xp(this,o);else{for(var ct=0,lt=[],Ot=_.length;ct<Ot;ct++)(_[ct].fn!==x||L&&!_[ct].once||C&&_[ct].context!==C)&&lt.push(_[ct]);lt.length?this._events[o]=lt.length===1?lt[0]:lt:Xp(this,o)}return this};Bn.prototype.removeAllListeners=function(g){var x;return g?(x=vn?vn+g:g,this._events[x]&&Xp(this,x)):(this._events=new e0,this._eventsCount=0),this};Bn.prototype.off=Bn.prototype.removeListener;Bn.prototype.addListener=Bn.prototype.on;Bn.prefixed=vn;Bn.EventEmitter=Bn;typeof Vu<"u"&&(Vu.exports=Bn)});var nI=Si((Pf,aI)=>{"use strict";function XM(G){return G.map(encodeURIComponent).join(",")}function eI(G){return Array.isArray(G)?XM(G):encodeURIComponent(String(G))}function iI(G,g,x){if(x===!1||x===null)return G;var C=/\?/.test(G)?"&":"?",L=encodeURIComponent(g);return x!==void 0&&x!==""&&x!==!0&&(L+="="+eI(x)),""+G+C+L}function JM(G,g){if(!g)return G;var x=G;return Object.keys(g).forEach(function(C){var L=g[C];L!==void 0&&(Array.isArray(L)&&(L=L.filter(function(o){return o!=null}).join(",")),x=iI(x,C,L))}),x}function yM(G,g){if(!g||G.slice(0,4)==="http")return G;var x=G[0]==="/"?"":"/";return""+g.replace(/\/$/,"")+x+G}function BM(G,g){return g?G.replace(/\/:([a-zA-Z0-9]+)/g,function(x,C){var L=g[C];if(L===void 0)throw new Error("Unspecified route parameter "+C);var o=eI(L);return"/"+o}):G}aI.exports={appendQueryObject:JM,appendQueryParam:iI,prependOrigin:yM,interpolateRouteParams:BM}});var rI=Si((Kf,oI)=>{"use strict";var MM=gu(),Ru=sd(),CM=tI(),Jp=nI(),lI=$m(),TM=1;function _r(G,g){if(!G)throw new Error("MapiRequest requires a client");if(!g||!g.path||!g.method)throw new Error("MapiRequest requires an options object with path and method properties");var x={};g.body&&(x["content-type"]="application/json");var C=Ru(x,g.headers),L=Object.keys(C).reduce(function(o,_){return o[_.toLowerCase()]=C[_],o},{});this.id=TM++,this._options=g,this.emitter=new CM,this.client=G,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=g.path,this.method=g.method,this.origin=g.origin||G.origin,this.query=g.query||{},this.params=g.params||{},this.body=g.body||null,this.file=g.file||null,this.encoding=g.encoding||"utf8",this.sendFileAs=g.sendFileAs||null,this.headers=L}_r.prototype.url=function(g){var x=Jp.prependOrigin(this.path,this.origin);x=Jp.appendQueryObject(x,this.query);var C=this.params,L=g==null?this.client.accessToken:g;if(L){x=Jp.appendQueryParam(x,"access_token",L);var o=MM(L).user;C=Ru({ownerId:o},C)}return x=Jp.interpolateRouteParams(x,C),x};_r.prototype.send=function(){var g=this;if(g.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return g.sent=!0,g.client.sendRequest(g).then(function(x){return g.response=x,g.emitter.emit(lI.EVENT_RESPONSE,x),x},function(x){throw g.error=x,g.emitter.emit(lI.EVENT_ERROR,x),x})};_r.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};_r.prototype.eachPage=function(g){var x=this;function C(_){function ct(){delete x._nextPageRequest;var lt=_.nextPage();lt&&(x._nextPageRequest=lt,o(lt))}g(null,_,ct)}function L(_){g(_,null,function(){})}function o(_){_.send().then(C,L)}o(this)};_r.prototype.clone=function(){return this._extend()};_r.prototype._extend=function(g){var x=Ru(this._options,g);return new _r(this.client,x)};oI.exports=_r});var Gu=Si((qf,dI)=>{"use strict";var kM=gu(),QM=rI(),SM=$m();function sI(G){if(!G||!G.accessToken)throw new Error("Cannot create a client without an access token");kM(G.accessToken),this.accessToken=G.accessToken,this.origin=G.origin||SM.API_ORIGIN}sI.prototype.createRequest=function(g){return new QM(this,g)};dI.exports=sI});var Fu=Si(($f,mI)=>{"use strict";var cI=PF(),bI=Gu();function Mc(G){bI.call(this,G)}Mc.prototype=Object.create(bI.prototype);Mc.prototype.constructor=Mc;Mc.prototype.sendRequest=cI.browserSend;Mc.prototype.abortRequest=cI.browserAbort;function fM(G){return new Mc(G)}mI.exports=fM});var pI=Si((tv,hI)=>{"use strict";var vM=Fu();hI.exports=vM});var uI=Si((ev,WI)=>{"use strict";var LM=Object.prototype.toString;WI.exports=function(G){var g;return LM.call(G)==="[object Object]"&&(g=Object.getPrototypeOf(G),g===null||g===Object.getPrototypeOf({}))}});var FI=Si((iv,GI)=>{"use strict";var zM=uI(),wM=sd(),ZI="value",Iu="\n  ",Wa={};Wa.assert=function(G,g){return g=g||{},function(x){var C=Pr(G,x);if(C){var L=Uu(C,g);throw g.apiName&&(L=g.apiName+": "+L),new Error(L)}}};Wa.shape=function(g){var x=jM(g);return function(L){var o=Pr(Wa.plainObject,L);if(o)return o;for(var _,ct,lt=[],Ot=0;Ot<x.length;Ot++)_=x[Ot].key,ct=x[Ot].value,o=Pr(ct,L[_]),o&&lt.push([_].concat(o));return lt.length<2?lt[0]:function(Ut){lt=lt.map(function(Fe){var qe=Fe[0],Le=Uu(Fe,Ut).split("\n").join(Iu);return"- "+qe+": "+Le});var de=Ut.path.join("."),Ze=de===ZI?"":" of "+de;return"The following properties"+Ze+" have invalid values:"+Iu+lt.join(Iu)}}};Wa.strictShape=function(g){var x=Wa.shape(g);return function(L){var o=x(L);if(o)return o;var _=Object.keys(L).reduce(function(ct,lt){return g[lt]===void 0&&ct.push(lt),ct},[]);if(_.length!==0)return function(){return"The following keys are invalid: "+_.join(", ")}}};Wa.arrayOf=function(g){return gI(g)};Wa.tuple=function(){var g=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return gI(g)};function gI(G){var g=Array.isArray(G),x=function(C){return g?G[C]:G};return function(L){var o=Pr(Wa.plainArray,L);if(o)return o;if(g&&L.length!==G.length)return"an array with "+G.length+" items";for(var _=0;_<L.length;_++)if(o=Pr(x(_),L[_]),o)return[_].concat(o)}}Wa.required=function(g){function x(C){return C==null?function(L){return VI(L,RI(L.path)?"cannot be undefined/null.":"is required.")}:g.apply(this,arguments)}return x.__required=!0,x};Wa.oneOfType=function(){var g=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(C){var L=g.map(function(o){return Pr(o,C)}).filter(Boolean);if(L.length===g.length)return L.every(function(o){return o.length===1&&typeof o[0]=="string"})?EM(L.map(function(o){return o[0]})):L.reduce(function(o,_){return _.length>o.length?_:o})}};Wa.equal=function(g){return function(C){if(C!==g)return JSON.stringify(g)}};Wa.oneOf=function(){var g=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),x=g.map(function(C){return Wa.equal(C)});return Wa.oneOfType.apply(this,x)};Wa.range=function(g){var x=g[0],C=g[1];return function(o){var _=Pr(Wa.number,o);if(_||o<x||o>C)return"number between "+x+" & "+C+" (inclusive)"}};Wa.any=function(){};Wa.boolean=function(g){if(typeof g!="boolean")return"boolean"};Wa.number=function(g){if(typeof g!="number")return"number"};Wa.plainArray=function(g){if(!Array.isArray(g))return"array"};Wa.plainObject=function(g){if(!zM(g))return"object"};Wa.string=function(g){if(typeof g!="string")return"string"};Wa.func=function(g){if(typeof g!="function")return"function"};function Pr(G,g){if(!(g==null&&!G.hasOwnProperty("__required"))){var x=G(g);if(x)return Array.isArray(x)?x:[x]}}function Uu(G,g){var x=G.length,C=G[x-1],L=G.slice(0,x-1);return L.length===0&&(L=[ZI]),g=wM(g,{path:L}),typeof C=="function"?C(g):VI(g,AM(C))}function EM(G){return G.length<2?G[0]:G.length===2?G.join(" or "):G.slice(0,-1).join(", ")+", or "+G.slice(-1)}function AM(G){return"must be "+HM(G)+"."}function HM(G){return/^an? /.test(G)?G:/^[aeiou]/i.test(G)?"an "+G:/^[a-z]/i.test(G)?"a "+G:G}function VI(G,g){var x=RI(G.path),C=G.path.join(".")+" "+g,L=x?"Item at position ":"";return L+C}function RI(G){return typeof G[G.length-1]=="number"||typeof G[0]=="number"}function jM(G){return Object.keys(G||{}).map(function(g){return{key:g,value:G[g]}})}Wa.validate=Pr;Wa.processMessage=Uu;GI.exports=Wa});var UI=Si((av,II)=>{"use strict";var OM=sd(),Cc=FI();function DM(G){if(typeof window<"u")return G instanceof global.Blob||G instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof G=="string"||G.pipe!==void 0))return"Filename or Readable stream"}function _M(G,g){return Cc.assert(Cc.strictShape(G),g)}function PM(G){var g="date";if(typeof G=="boolean")return g;try{var x=new Date(G);if(x.getTime&&isNaN(x.getTime()))return g}catch{return g}}function KM(G){return Cc.tuple(Cc.number,Cc.number)(G)}II.exports=OM(Cc,{file:DM,date:PM,coordinates:KM,assertShape:_M})});var NI=Si((nv,xI)=>{"use strict";function qM(G,g){var x=function(C,L){return g.indexOf(C)!==-1&&L!==void 0};return typeof g=="function"&&(x=g),Object.keys(G).filter(function(C){return x(C,G[C])}).reduce(function(C,L){return C[L]=G[L],C},{})}xI.exports=qM});var XI=Si((lv,YI)=>{"use strict";function $M(G,g){return Object.keys(G).reduce(function(x,C){return x[C]=g(C,G[C]),x},{})}YI.exports=$M});var yI=Si((ov,JI)=>{"use strict";var tC=XI();function eC(G){return tC(G,function(g,x){return typeof x=="boolean"?JSON.stringify(x):x})}JI.exports=eC});var MI=Si((rv,BI)=>{"use strict";var iC=Gu(),aC=Fu();function nC(G){return function(g){var x;iC.prototype.isPrototypeOf(g)?x=g:x=aC(g);var C=Object.create(G);return C.client=x,C}}BI.exports=nC});var SI=Si((sv,QI)=>{"use strict";var CI=sd(),zi=UI(),yp=NI(),TI=yI(),lC=MI(),xu={},kI=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];xu.forwardGeocode=function(G){zi.assertShape({query:zi.required(zi.string),mode:zi.oneOf("mapbox.places","mapbox.places-permanent"),countries:zi.arrayOf(zi.string),proximity:zi.oneOf(zi.coordinates,"ip"),types:zi.arrayOf(zi.oneOf(kI)),autocomplete:zi.boolean,bbox:zi.arrayOf(zi.number),limit:zi.number,language:zi.arrayOf(zi.string),routing:zi.boolean,fuzzyMatch:zi.boolean,worldview:zi.string})(G),G.mode=G.mode||"mapbox.places";var g=TI(CI({country:G.countries},yp(G,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:yp(G,["mode","query"]),query:g})};xu.reverseGeocode=function(G){zi.assertShape({query:zi.required(zi.coordinates),mode:zi.oneOf("mapbox.places","mapbox.places-permanent"),countries:zi.arrayOf(zi.string),types:zi.arrayOf(zi.oneOf(kI)),bbox:zi.arrayOf(zi.number),limit:zi.number,language:zi.arrayOf(zi.string),reverseMode:zi.oneOf("distance","score"),routing:zi.boolean,worldview:zi.string})(G),G.mode=G.mode||"mapbox.places";var g=TI(CI({country:G.countries},yp(G,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:yp(G,["mode","query"]),query:g})};QI.exports=lC(xu)});var fI,vI=kR(()=>{fI="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"});var wI={};QR(wI,{customAlphabet:()=>oC,customRandom:()=>zI,nanoid:()=>rC,random:()=>LI,urlAlphabet:()=>fI});var LI,zI,oC,rC,EI=kR(()=>{vI();LI=G=>crypto.getRandomValues(new Uint8Array(G)),zI=(G,g,x)=>{let C=(2<<Math.log(G.length-1)/Math.LN2)-1,L=-~(1.6*C*g/G.length);return(o=g)=>{let _="";for(;;){let ct=x(L),lt=L;for(;lt--;)if(_+=G[ct[lt]&C]||"",_.length===o)return _}}},oC=(G,g=21)=>zI(G,g,LI),rC=(G=21)=>crypto.getRandomValues(new Uint8Array(G)).reduce((g,x)=>(x&=63,x<36?g+=x.toString(36):x<62?g+=(x-26).toString(36).toUpperCase():x>62?g+="-":g+="_",g),"")});var jI=Si((bv,HI)=>{"use strict";var sC=(EI(),qY(wI)).nanoid;function AI(G){this.origin=G.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=G.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=G,this.send=this.send.bind(this),this.countries=G.countries?G.countries.split(","):null,this.types=G.types?G.types.split(","):null,this.bbox=G.bbox?G.bbox:null,this.language=G.language?G.language.split(","):null,this.limit=G.limit?+G.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(G),this.eventQueue=new Array,this.flushInterval=G.flushInterval||1e3,this.maxQueueSize=G.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}AI.prototype={select:function(G,g){var x=this.getSelectedIndex(G,g),C=this.getEventPayload("search.select",g);if(C.resultIndex=x,C.resultPlaceName=G.place_name,C.resultId=G.id,!(x===this.lastSentIndex&&C.queryString===this.lastSentInput||x==-1)&&(this.lastSentIndex=x,this.lastSentInput=C.queryString,!!C.queryString))return this.push(C)},start:function(G){var g=this.getEventPayload("search.start",G);if(g.queryString)return this.push(g)},keyevent:function(G,g){if(G.key&&!(G.metaKey||[9,27,37,39,13,38,40].indexOf(G.keyCode)!==-1)){var x=this.getEventPayload("search.keystroke",g);if(x.lastAction=G.key,!!x.queryString)return this.push(x)}},send:function(G,g){if(!this.enableEventLogging)return g?g():void 0;var x=this.getRequestOptions(G);this.request(x,(function(C){if(C)return this.handleError(C,g);if(g)return g()}).bind(this))},getRequestOptions:function(G){Array.isArray(G)||(G=[G]);var g={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(G)};return g},getEventPayload:function(G,g){var x;g.options.proximity?typeof g.options.proximity=="object"?x=[g.options.proximity.longitude,g.options.proximity.latitude]:g.options.proximity==="ip"?x=[999,999]:x=g.options.proximity:x=null;var C=g._map?g._map.getZoom():void 0,L={event:G,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:g.options.autocomplete,fuzzyMatch:g.options.fuzzyMatch,proximity:x,limit:g.options.limit,routing:g.options.routing,worldview:g.options.worldview,mapZoom:C,keyboardLocale:this.locale};return G==="search.select"?L.queryString=g.inputString:G!="search.select"&&g._inputEl?L.queryString=g._inputEl.value:L.queryString=g.inputString,L},request:function(G,g){var x=new XMLHttpRequest;x.onreadystatechange=function(){if(this.readyState==4)return this.status==204?g(null):g(this.statusText)},x.open(G.method,G.host+"/"+G.path,!0);for(var C in G.headers){var L=G.headers[C];x.setRequestHeader(C,L)}x.send(G.body)},handleError:function(G,g){if(g)return g(G)},generateSessionID:function(){return sC()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(G,g){if(g._typeahead){var x=g._typeahead.data,C=G.id,L=x.map(function(_){return _.id}),o=L.indexOf(C);return o}},shouldEnableLogging:function(G){return!(G.enableEventLogging===!1||G.origin&&G.origin!=="https://api.mapbox.com"||G.localGeocoder||G.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(G,g){this.eventQueue.push(G),(this.eventQueue.length>=this.maxQueueSize||g)&&this.flush()},remove:function(){this.flush()}};HI.exports=AI});var DI=Si((mv,OI)=>{"use strict";var dC={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"};OI.exports={placeholder:dC}});var PI=Si((_I,Bp)=>{(function(G,g,x){typeof Bp<"u"&&Bp.exports?Bp.exports=x():G[g]=x()})(_I,"subtag",function(){var G="",g=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function x(ct){return ct.match(g)||[]}function C(ct){return x(ct).filter(function(lt,Ot){return lt&&Ot})}function L(ct){return ct=x(ct),{language:ct[1]||G,extlang:ct[2]||G,script:ct[3]||G,region:ct[4]||G}}function o(ct,lt,Ot){Object.defineProperty(ct,lt,{value:Ot,enumerable:!0})}function _(ct,lt,Ot){function Ut(de){return x(de)[ct]||G}o(Ut,"pattern",lt),o(L,Ot,Ut)}return _(1,/^[a-zA-Z]{2,3}$/,"language"),_(2,/^[a-zA-Z]{3}$/,"extlang"),_(3,/^[a-zA-Z]{4}$/,"script"),_(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),o(L,"split",C),L})});var $I=Si((hv,qI)=>{function KI(){}KI.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){let G={enableHighAccuracy:!0};return new Promise(function(g,x){window.navigator.geolocation.getCurrentPosition(g,x,G)})}};qI.exports=KI});var iU=Si((pv,eU)=>{function cC(G,g){let x=tU(G),C=["address","street","place","country"];var L;if(typeof g=="function")return g(x);let o=C.indexOf(g);return o===-1?L=C:L=C.slice(o),L.reduce(function(_,ct){return x[ct]?(_!==""&&(_=_+", "),_+x[ct]):_},"")}function tU(G){let g=G.address||"",x=G.text||"",C=G.place_name||"",o={address:C.split(",")[0],houseNumber:g,street:x,placeName:C};return G.context.forEach(function(_){let ct=_.id.split(".")[0];o[ct]=_.text}),o}var bC=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;eU.exports={transformFeatureToGeolocationText:cC,getAddressInfo:tU,REVERSE_GEOCODE_COORD_RGX:bC}});var rU=Si((Wv,oU)=>{"use strict";var mC=ZF(),hC=GF(),cd=sd(),pC=MF().EventEmitter,aU=TF(),Nu=pI(),Yu=SI(),WC=jI(),uC=DI(),ZC=PI(),gC=$I(),nU=iU(),Kr={FORWARD:0,LOCAL:1,REVERSE:2};function VC(){var G=document.createElement("div");return G.className="mapboxgl-ctrl-geocoder--powered-by",G.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',G}function lU(G){this._eventEmitter=new pC,this.options=cd({},this.options,G),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new gC}lU.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(G){return G.place_name},render:function(G){var g=G.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+g[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+g.splice(1,g.length).join(",")+"</div></div>"}},addTo:function(G){function g(x,C){if(!document.body.contains(C))throw new Error("Element provided to #addTo() exists, but is not in the DOM");let L=x.onAdd();C.appendChild(L)}if(G._controlContainer)G.addControl(this);else if(G instanceof HTMLElement)g(this,G);else if(typeof G=="string"){let x=document.querySelectorAll(G);if(x.length===0)throw new Error("Element ",G,"not found.");if(x.length>1)throw new Error("Geocoder can only be added to a single html element");g(this,x[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(G){if(G&&typeof G!="string"&&(this._map=G),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Yu(Nu({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new WC(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var g=this.container=document.createElement("div");g.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var x=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",hC(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(Ot){this.eventManager.keyevent(Ot,this)}).bind(this));var C=document.createElement("div");C.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var L=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(L),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),C.appendChild(this._clearEl),C.appendChild(this._loadingEl),g.appendChild(x),g.appendChild(this._inputEl),g.appendChild(C),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var o=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(o),C.appendChild(this._geolocateEl),this._showGeolocateButton()}var _=this._typeahead=new mC(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),_.getItemValue=this.options.getItemValue;var ct=_.list.draw,lt=this._footerNode=VC();return _.list.draw=function(){ct.call(this),lt.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),lt.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(lt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),g},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(G){this._hideLoadingIcon();let g={geometry:{type:"Point",coordinates:[G.coords.longitude,G.coords.latitude]}};this._handleMarker(g),this._fly(g),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(g),this._showClearButton(),this.fresh=!1;let x={limit:1,language:[this.options.language],query:g.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){let C=g.geometry.coordinates[0]+","+g.geometry.coordinates[1];this._setInputValue(C),this._eventEmitter.emit("result",{result:g})}else this.geocoderService.reverseGeocode(x).send().then((function(C){let L=C.body.features[0];if(L){let o=nU.transformFeatureToGeolocationText(L,this.options.addressAccuracy);this._setInputValue(o),L.user_coordinates=g.geometry.coordinates,this._eventEmitter.emit("result",{result:L})}else this._eventEmitter.emit("result",{result:{user_coordinates:g.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(G){G.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(G,g){var x=document.createElementNS("http://www.w3.org/2000/svg","svg");return x.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+G),x.setAttribute("viewBox","0 0 18 18"),x.setAttribute("xml:space","preserve"),x.setAttribute("width",18),x.setAttribute("height",18),x.innerHTML=g,x},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(G){this._inputEl.value=G,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(G){var g=(G.clipboardData||window.clipboardData).getData("text");g.length>=this.options.minLength&&this._geocode(g)},_onKeyDown:function(G){var g=27,x=9;if(G.keyCode===g&&this.options.clearAndBlurOnEsc)return this._clear(G),this._inputEl.blur();var C=G.target&&G.target.shadowRoot?G.target.shadowRoot.activeElement:G.target,L=C?C.value:"";if(!L)return this.fresh=!0,G.keyCode!==x&&this.clear(G),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(G.metaKey||[x,g,37,39,13,38,40].indexOf(G.keyCode)!==-1)&&C.value.length>=this.options.minLength&&this._geocode(C.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(G){this.options.clearOnBlur&&this._clearOnBlur(G),this.options.collapsed&&this._collapse()},_onChange:function(){var G=this._typeahead.selected;G&&JSON.stringify(G)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(G),this.options.marker&&this._mapboxgl&&this._handleMarker(G),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(G),this._eventEmitter.emit("result",{result:G}),this.eventManager.select(G,this))},_fly:function(G){var g;if(G.properties&&aU[G.properties.short_code])g=cd({},this.options.flyTo),this._map&&this._map.fitBounds(aU[G.properties.short_code].bbox,g);else if(G.bbox){var x=G.bbox;g=cd({},this.options.flyTo),this._map&&this._map.fitBounds([[x[0],x[1]],[x[2],x[3]]],g)}else{var C={zoom:this.options.zoom};g=cd({},C,this.options.flyTo),G.center?g.center=G.center:G.geometry&&G.geometry.type&&G.geometry.type==="Point"&&G.geometry.coordinates&&(g.center=G.geometry.coordinates),this._map&&this._map.flyTo(g)}},_requestType:function(G,g){var x;return G.localGeocoderOnly?x=Kr.LOCAL:G.reverseGeocode&&nU.REVERSE_GEOCODE_COORD_RGX.test(g)?x=Kr.REVERSE:x=Kr.FORWARD,x},_setupConfig:function(G,g){let x=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],C=/[\s,]+/;var L=this,o=x.reduce(function(ct,lt){if(L.options[lt]===void 0||L.options[lt]===null)return ct;["countries","types","language"].indexOf(lt)>-1?ct[lt]=L.options[lt].split(C):ct[lt]=L.options[lt];let Ot=typeof L.options[lt].longitude=="number"&&typeof L.options[lt].latitude=="number";if(lt==="proximity"&&Ot){let Ut=L.options[lt].longitude,de=L.options[lt].latitude;ct[lt]=[Ut,de]}return ct},{});switch(G){case Kr.REVERSE:{var _=g.split(C).map(function(ct){return parseFloat(ct,10)});L.options.flipCoordinates||_.reverse(),o.types&&o.types[0],o=cd(o,{query:_,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(ct){ct in o&&delete o[ct]})}break;case Kr.FORWARD:{let ct=g.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(ct)&&(g=g.replace(/,/g," ")),o=cd(o,{query:g})}break}return o},_geocode:function(G){this.inputString=G,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:G});let g=this._requestType(this.options,G),x=this._setupConfig(g,G);var C;switch(g){case Kr.LOCAL:C=Promise.resolve();break;case Kr.FORWARD:C=this.geocoderService.forwardGeocode(x).send();break;case Kr.REVERSE:C=this.geocoderService.reverseGeocode(x).send();break}var L=this.options.localGeocoder?this.options.localGeocoder(G)||[]:[],o=[],_=null;return C.catch((function(ct){_=ct}).bind(this)).then((function(ct){this._hideLoadingIcon();var lt={};return ct?ct.statusCode=="200"&&(lt=ct.body,lt.request=ct.request,lt.headers=ct.headers):lt={type:"FeatureCollection",features:[]},lt.config=x,this.fresh&&(this.eventManager.start(this),this.fresh=!1),lt.features=lt.features?L.concat(lt.features):L,this.options.externalGeocoder?(o=this.options.externalGeocoder(G,lt.features)||Promise.resolve([]),o.then(function(Ot){return lt.features=lt.features?Ot.concat(lt.features):Ot,lt},function(){return lt})):lt}).bind(this)).then((function(ct){if(_)throw _;this.options.filter&&ct.features.length&&(ct.features=ct.features.filter(this.options.filter)),ct.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",ct),this._typeahead.update(ct.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",ct))}).bind(this)).catch((function(ct){this._hideLoadingIcon(),this._hideAttribution(),L.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(L)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:L}),this._eventEmitter.emit("error",{error:ct})}).bind(this)),C},_clear:function(G){G&&G.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(G){this._clear(G),this._inputEl.focus()},_clearOnBlur:function(G){var g=this;G.relatedTarget&&g._clear(G)},_onQueryResult:function(G){var g=G.body;if(g.features.length){var x=g.features[0];this._typeahead.selected=x,this._inputEl.value=x.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var G=this._map.getCenter().wrap();this.setProximity({longitude:G.lng,latitude:G.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(G){return this._geocode(G).then(this._onQueryResult),this},_renderError:function(){var G="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(G)},_renderLocationError:function(){var G="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(G)},_renderNoResults:function(){var G="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(G)},_renderUserDeniedGeolocationError:function(){var G="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(G)},_renderMessage:function(G){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(G)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var G=this.options.language.split(",")[0],g=ZC.language(G),x=uC.placeholder[g];if(x)return x}return"Search"},setInput:function(G,g){return g===void 0&&(g=!1),this._inputEl.value=G,this._typeahead.selected=null,this._typeahead.clear(),G.length>=this.options.minLength&&(g?this._geocode(G):this._onChange()),this},setProximity:function(G,g=!0){return this.options.proximity=G,g&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(G){return G&&typeof G=="function"&&(this._typeahead.render=G),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(G){var g=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=G||this.options.language||g,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(G){return this.options.zoom=G,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(G){return this.options.flyTo=G,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(G){return this.options.placeholder=G||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(G){return this.options.bbox=G,this},getCountries:function(){return this.options.countries},setCountries:function(G){return this.options.countries=G,this},getTypes:function(){return this.options.types},setTypes:function(G){return this.options.types=G,this},getMinLength:function(){return this.options.minLength},setMinLength:function(G){return this.options.minLength=G,this._typeahead&&(this._typeahead.options.minLength=G),this},getLimit:function(){return this.options.limit},setLimit:function(G){return this.options.limit=G,this._typeahead&&(this._typeahead.options.limit=G),this},getFilter:function(){return this.options.filter},setFilter:function(G){return this.options.filter=G,this},setOrigin:function(G){return this.options.origin=G,this.geocoderService=Yu(Nu({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(G){return this.options.accessToken=G,this.geocoderService=Yu(Nu({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(G){return this.options.autocomplete=G,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(G){return this.options.fuzzyMatch=G,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(G){return this.options.routing=G,this},getRouting:function(){return this.options.routing},setWorldview:function(G){return this.options.worldview=G,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(G){if(this._map){this._removeMarker();var g={color:"#4668F2"},x=cd({},g,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(x),G.center?this.mapMarker.setLngLat(G.center).addTo(this._map):G.geometry&&G.geometry.type&&G.geometry.type==="Point"&&G.geometry.coordinates&&this.mapMarker.setLngLat(G.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(G,g){return this._eventEmitter.on(G,g),this},off:function(G,g){return this._eventEmitter.removeListener(G,g),this.eventManager.remove(),this}};oU.exports=lU});var np={};QR(np,{afterMain:()=>AR,afterRead:()=>zR,afterWrite:()=>OR,applyStyles:()=>Wc,arrow:()=>Ph,auto:()=>Qm,basePlacements:()=>Do,beforeMain:()=>wR,beforeRead:()=>vR,beforeWrite:()=>HR,bottom:()=>$a,clippingParents:()=>x1,computeStyles:()=>Zc,createPopper:()=>Hm,createPopperBase:()=>iG,createPopperLite:()=>aG,detectOverflow:()=>fn,end:()=>Lr,eventListeners:()=>gc,flip:()=>tp,hide:()=>ep,left:()=>va,main:()=>ER,modifierPhases:()=>Y1,offset:()=>ip,placements:()=>fm,popper:()=>Ds,popperGenerator:()=>id,popperOffsets:()=>Gc,preventOverflow:()=>ap,read:()=>LR,reference:()=>N1,right:()=>Ha,start:()=>Io,top:()=>ya,variationPlacements:()=>_h,viewport:()=>Sm,write:()=>jR});var ya="top",$a="bottom",Ha="right",va="left",Qm="auto",Do=[ya,$a,Ha,va],Io="start",Lr="end",x1="clippingParents",Sm="viewport",Ds="popper",N1="reference",_h=Do.reduce(function(G,g){return G.concat([g+"-"+Io,g+"-"+Lr])},[]),fm=[].concat(Do,[Qm]).reduce(function(G,g){return G.concat([g,g+"-"+Io,g+"-"+Lr])},[]),vR="beforeRead",LR="read",zR="afterRead",wR="beforeMain",ER="main",AR="afterMain",HR="beforeWrite",jR="write",OR="afterWrite",Y1=[vR,LR,zR,wR,ER,AR,HR,jR,OR];function cn(G){return G?(G.nodeName||"").toLowerCase():null}function Na(G){if(G==null)return window;if(G.toString()!=="[object Window]"){var g=G.ownerDocument;return g&&g.defaultView||window}return G}function xl(G){var g=Na(G).Element;return G instanceof g||G instanceof Element}function an(G){var g=Na(G).HTMLElement;return G instanceof g||G instanceof HTMLElement}function pc(G){if(typeof ShadowRoot>"u")return!1;var g=Na(G).ShadowRoot;return G instanceof g||G instanceof ShadowRoot}function $Y(G){var g=G.state;Object.keys(g.elements).forEach(function(x){var C=g.styles[x]||{},L=g.attributes[x]||{},o=g.elements[x];!an(o)||!cn(o)||(Object.assign(o.style,C),Object.keys(L).forEach(function(_){var ct=L[_];ct===!1?o.removeAttribute(_):o.setAttribute(_,ct===!0?"":ct)}))})}function tX(G){var g=G.state,x={popper:{position:g.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(g.elements.popper.style,x.popper),g.styles=x,g.elements.arrow&&Object.assign(g.elements.arrow.style,x.arrow),function(){Object.keys(g.elements).forEach(function(C){var L=g.elements[C],o=g.attributes[C]||{},_=Object.keys(g.styles.hasOwnProperty(C)?g.styles[C]:x[C]),ct=_.reduce(function(lt,Ot){return lt[Ot]="",lt},{});!an(L)||!cn(L)||(Object.assign(L.style,ct),Object.keys(o).forEach(function(lt){L.removeAttribute(lt)}))})}}var Wc={name:"applyStyles",enabled:!0,phase:"write",fn:$Y,effect:tX,requires:["computeStyles"]};function bn(G){return G.split("-")[0]}var Dl=Math.max,_s=Math.min,_o=Math.round;function uc(){var G=navigator.userAgentData;return G!=null&&G.brands&&Array.isArray(G.brands)?G.brands.map(function(g){return g.brand+"/"+g.version}).join(" "):navigator.userAgent}function vm(){return!/^((?!chrome|android).)*safari/i.test(uc())}function Nl(G,g,x){g===void 0&&(g=!1),x===void 0&&(x=!1);var C=G.getBoundingClientRect(),L=1,o=1;g&&an(G)&&(L=G.offsetWidth>0&&_o(C.width)/G.offsetWidth||1,o=G.offsetHeight>0&&_o(C.height)/G.offsetHeight||1);var _=xl(G)?Na(G):window,ct=_.visualViewport,lt=!vm()&&x,Ot=(C.left+(lt&&ct?ct.offsetLeft:0))/L,Ut=(C.top+(lt&&ct?ct.offsetTop:0))/o,de=C.width/L,Ze=C.height/o;return{width:de,height:Ze,top:Ut,right:Ot+de,bottom:Ut+Ze,left:Ot,x:Ot,y:Ut}}function Ps(G){var g=Nl(G),x=G.offsetWidth,C=G.offsetHeight;return Math.abs(g.width-x)<=1&&(x=g.width),Math.abs(g.height-C)<=1&&(C=g.height),{x:G.offsetLeft,y:G.offsetTop,width:x,height:C}}function Lm(G,g){var x=g.getRootNode&&g.getRootNode();if(G.contains(g))return!0;if(x&&pc(x)){var C=g;do{if(C&&G.isSameNode(C))return!0;C=C.parentNode||C.host}while(C)}return!1}function Sn(G){return Na(G).getComputedStyle(G)}function X1(G){return["table","td","th"].indexOf(cn(G))>=0}function gn(G){return((xl(G)?G.ownerDocument:G.document)||window.document).documentElement}function Po(G){return cn(G)==="html"?G:G.assignedSlot||G.parentNode||(pc(G)?G.host:null)||gn(G)}function DR(G){return!an(G)||Sn(G).position==="fixed"?null:G.offsetParent}function eX(G){var g=/firefox/i.test(uc()),x=/Trident/i.test(uc());if(x&&an(G)){var C=Sn(G);if(C.position==="fixed")return null}var L=Po(G);for(pc(L)&&(L=L.host);an(L)&&["html","body"].indexOf(cn(L))<0;){var o=Sn(L);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||g&&o.willChange==="filter"||g&&o.filter&&o.filter!=="none")return L;L=L.parentNode}return null}function _l(G){for(var g=Na(G),x=DR(G);x&&X1(x)&&Sn(x).position==="static";)x=DR(x);return x&&(cn(x)==="html"||cn(x)==="body"&&Sn(x).position==="static")?g:x||eX(G)||g}function Ks(G){return["top","bottom"].indexOf(G)>=0?"x":"y"}function qs(G,g,x){return Dl(G,_s(g,x))}function _R(G,g,x){var C=qs(G,g,x);return C>x?x:C}function zm(){return{top:0,right:0,bottom:0,left:0}}function wm(G){return Object.assign({},zm(),G)}function Em(G,g){return g.reduce(function(x,C){return x[C]=G,x},{})}var iX=function(g,x){return g=typeof g=="function"?g(Object.assign({},x.rects,{placement:x.placement})):g,wm(typeof g!="number"?g:Em(g,Do))};function aX(G){var g,x=G.state,C=G.name,L=G.options,o=x.elements.arrow,_=x.modifiersData.popperOffsets,ct=bn(x.placement),lt=Ks(ct),Ot=[va,Ha].indexOf(ct)>=0,Ut=Ot?"height":"width";if(!(!o||!_)){var de=iX(L.padding,x),Ze=Ps(o),Fe=lt==="y"?ya:va,qe=lt==="y"?$a:Ha,Le=x.rects.reference[Ut]+x.rects.reference[lt]-_[lt]-x.rects.popper[Ut],Ee=_[lt]-x.rects.reference[lt],hi=_l(o),Xi=hi?lt==="y"?hi.clientHeight||0:hi.clientWidth||0:0,vi=Le/2-Ee/2,Se=de[Fe],Zi=Xi-Ze[Ut]-de[qe],Nt=Xi/2-Ze[Ut]/2+vi,Yi=qs(Se,Nt,Zi),Pi=lt;x.modifiersData[C]=(g={},g[Pi]=Yi,g.centerOffset=Yi-Nt,g)}}function nX(G){var g=G.state,x=G.options,C=x.element,L=C===void 0?"[data-popper-arrow]":C;L!=null&&(typeof L=="string"&&(L=g.elements.popper.querySelector(L),!L)||Lm(g.elements.popper,L)&&(g.elements.arrow=L))}var Ph={name:"arrow",enabled:!0,phase:"main",fn:aX,effect:nX,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Yl(G){return G.split("-")[1]}var lX={top:"auto",right:"auto",bottom:"auto",left:"auto"};function oX(G,g){var x=G.x,C=G.y,L=g.devicePixelRatio||1;return{x:_o(x*L)/L||0,y:_o(C*L)/L||0}}function PR(G){var g,x=G.popper,C=G.popperRect,L=G.placement,o=G.variation,_=G.offsets,ct=G.position,lt=G.gpuAcceleration,Ot=G.adaptive,Ut=G.roundOffsets,de=G.isFixed,Ze=_.x,Fe=Ze===void 0?0:Ze,qe=_.y,Le=qe===void 0?0:qe,Ee=typeof Ut=="function"?Ut({x:Fe,y:Le}):{x:Fe,y:Le};Fe=Ee.x,Le=Ee.y;var hi=_.hasOwnProperty("x"),Xi=_.hasOwnProperty("y"),vi=va,Se=ya,Zi=window;if(Ot){var Nt=_l(x),Yi="clientHeight",Pi="clientWidth";if(Nt===Na(x)&&(Nt=gn(x),Sn(Nt).position!=="static"&&ct==="absolute"&&(Yi="scrollHeight",Pi="scrollWidth")),Nt=Nt,L===ya||(L===va||L===Ha)&&o===Lr){Se=$a;var ye=de&&Nt===Zi&&Zi.visualViewport?Zi.visualViewport.height:Nt[Yi];Le-=ye-C.height,Le*=lt?1:-1}if(L===va||(L===ya||L===$a)&&o===Lr){vi=Ha;var Bi=de&&Nt===Zi&&Zi.visualViewport?Zi.visualViewport.width:Nt[Pi];Fe-=Bi-C.width,Fe*=lt?1:-1}}var Ya=Object.assign({position:ct},Ot&&lX),Kt=Ut===!0?oX({x:Fe,y:Le},Na(x)):{x:Fe,y:Le};if(Fe=Kt.x,Le=Kt.y,lt){var la;return Object.assign({},Ya,(la={},la[Se]=Xi?"0":"",la[vi]=hi?"0":"",la.transform=(Zi.devicePixelRatio||1)<=1?"translate("+Fe+"px, "+Le+"px)":"translate3d("+Fe+"px, "+Le+"px, 0)",la))}return Object.assign({},Ya,(g={},g[Se]=Xi?Le+"px":"",g[vi]=hi?Fe+"px":"",g.transform="",g))}function rX(G){var g=G.state,x=G.options,C=x.gpuAcceleration,L=C===void 0?!0:C,o=x.adaptive,_=o===void 0?!0:o,ct=x.roundOffsets,lt=ct===void 0?!0:ct,Ot={placement:bn(g.placement),variation:Yl(g.placement),popper:g.elements.popper,popperRect:g.rects.popper,gpuAcceleration:L,isFixed:g.options.strategy==="fixed"};g.modifiersData.popperOffsets!=null&&(g.styles.popper=Object.assign({},g.styles.popper,PR(Object.assign({},Ot,{offsets:g.modifiersData.popperOffsets,position:g.options.strategy,adaptive:_,roundOffsets:lt})))),g.modifiersData.arrow!=null&&(g.styles.arrow=Object.assign({},g.styles.arrow,PR(Object.assign({},Ot,{offsets:g.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:lt})))),g.attributes.popper=Object.assign({},g.attributes.popper,{"data-popper-placement":g.placement})}var Zc={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:rX,data:{}};var Kh={passive:!0};function sX(G){var g=G.state,x=G.instance,C=G.options,L=C.scroll,o=L===void 0?!0:L,_=C.resize,ct=_===void 0?!0:_,lt=Na(g.elements.popper),Ot=[].concat(g.scrollParents.reference,g.scrollParents.popper);return o&&Ot.forEach(function(Ut){Ut.addEventListener("scroll",x.update,Kh)}),ct&&lt.addEventListener("resize",x.update,Kh),function(){o&&Ot.forEach(function(Ut){Ut.removeEventListener("scroll",x.update,Kh)}),ct&&lt.removeEventListener("resize",x.update,Kh)}}var gc={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:sX,data:{}};var dX={left:"right",right:"left",bottom:"top",top:"bottom"};function Vc(G){return G.replace(/left|right|bottom|top/g,function(g){return dX[g]})}var cX={start:"end",end:"start"};function qh(G){return G.replace(/start|end/g,function(g){return cX[g]})}function $s(G){var g=Na(G),x=g.pageXOffset,C=g.pageYOffset;return{scrollLeft:x,scrollTop:C}}function td(G){return Nl(gn(G)).left+$s(G).scrollLeft}function J1(G,g){var x=Na(G),C=gn(G),L=x.visualViewport,o=C.clientWidth,_=C.clientHeight,ct=0,lt=0;if(L){o=L.width,_=L.height;var Ot=vm();(Ot||!Ot&&g==="fixed")&&(ct=L.offsetLeft,lt=L.offsetTop)}return{width:o,height:_,x:ct+td(G),y:lt}}function y1(G){var g,x=gn(G),C=$s(G),L=(g=G.ownerDocument)==null?void 0:g.body,o=Dl(x.scrollWidth,x.clientWidth,L?L.scrollWidth:0,L?L.clientWidth:0),_=Dl(x.scrollHeight,x.clientHeight,L?L.scrollHeight:0,L?L.clientHeight:0),ct=-C.scrollLeft+td(G),lt=-C.scrollTop;return Sn(L||x).direction==="rtl"&&(ct+=Dl(x.clientWidth,L?L.clientWidth:0)-o),{width:o,height:_,x:ct,y:lt}}function ed(G){var g=Sn(G),x=g.overflow,C=g.overflowX,L=g.overflowY;return/auto|scroll|overlay|hidden/.test(x+L+C)}function $h(G){return["html","body","#document"].indexOf(cn(G))>=0?G.ownerDocument.body:an(G)&&ed(G)?G:$h(Po(G))}function zr(G,g){var x;g===void 0&&(g=[]);var C=$h(G),L=C===((x=G.ownerDocument)==null?void 0:x.body),o=Na(C),_=L?[o].concat(o.visualViewport||[],ed(C)?C:[]):C,ct=g.concat(_);return L?ct:ct.concat(zr(Po(_)))}function Rc(G){return Object.assign({},G,{left:G.x,top:G.y,right:G.x+G.width,bottom:G.y+G.height})}function bX(G,g){var x=Nl(G,!1,g==="fixed");return x.top=x.top+G.clientTop,x.left=x.left+G.clientLeft,x.bottom=x.top+G.clientHeight,x.right=x.left+G.clientWidth,x.width=G.clientWidth,x.height=G.clientHeight,x.x=x.left,x.y=x.top,x}function KR(G,g,x){return g===Sm?Rc(J1(G,x)):xl(g)?bX(g,x):Rc(y1(gn(G)))}function mX(G){var g=zr(Po(G)),x=["absolute","fixed"].indexOf(Sn(G).position)>=0,C=x&&an(G)?_l(G):G;return xl(C)?g.filter(function(L){return xl(L)&&Lm(L,C)&&cn(L)!=="body"}):[]}function B1(G,g,x,C){var L=g==="clippingParents"?mX(G):[].concat(g),o=[].concat(L,[x]),_=o[0],ct=o.reduce(function(lt,Ot){var Ut=KR(G,Ot,C);return lt.top=Dl(Ut.top,lt.top),lt.right=_s(Ut.right,lt.right),lt.bottom=_s(Ut.bottom,lt.bottom),lt.left=Dl(Ut.left,lt.left),lt},KR(G,_,C));return ct.width=ct.right-ct.left,ct.height=ct.bottom-ct.top,ct.x=ct.left,ct.y=ct.top,ct}function Am(G){var g=G.reference,x=G.element,C=G.placement,L=C?bn(C):null,o=C?Yl(C):null,_=g.x+g.width/2-x.width/2,ct=g.y+g.height/2-x.height/2,lt;switch(L){case ya:lt={x:_,y:g.y-x.height};break;case $a:lt={x:_,y:g.y+g.height};break;case Ha:lt={x:g.x+g.width,y:ct};break;case va:lt={x:g.x-x.width,y:ct};break;default:lt={x:g.x,y:g.y}}var Ot=L?Ks(L):null;if(Ot!=null){var Ut=Ot==="y"?"height":"width";switch(o){case Io:lt[Ot]=lt[Ot]-(g[Ut]/2-x[Ut]/2);break;case Lr:lt[Ot]=lt[Ot]+(g[Ut]/2-x[Ut]/2);break;default:}}return lt}function fn(G,g){g===void 0&&(g={});var x=g,C=x.placement,L=C===void 0?G.placement:C,o=x.strategy,_=o===void 0?G.strategy:o,ct=x.boundary,lt=ct===void 0?x1:ct,Ot=x.rootBoundary,Ut=Ot===void 0?Sm:Ot,de=x.elementContext,Ze=de===void 0?Ds:de,Fe=x.altBoundary,qe=Fe===void 0?!1:Fe,Le=x.padding,Ee=Le===void 0?0:Le,hi=wm(typeof Ee!="number"?Ee:Em(Ee,Do)),Xi=Ze===Ds?N1:Ds,vi=G.rects.popper,Se=G.elements[qe?Xi:Ze],Zi=B1(xl(Se)?Se:Se.contextElement||gn(G.elements.popper),lt,Ut,_),Nt=Nl(G.elements.reference),Yi=Am({reference:Nt,element:vi,strategy:"absolute",placement:L}),Pi=Rc(Object.assign({},vi,Yi)),ye=Ze===Ds?Pi:Nt,Bi={top:Zi.top-ye.top+hi.top,bottom:ye.bottom-Zi.bottom+hi.bottom,left:Zi.left-ye.left+hi.left,right:ye.right-Zi.right+hi.right},Ya=G.modifiersData.offset;if(Ze===Ds&&Ya){var Kt=Ya[L];Object.keys(Bi).forEach(function(la){var ua=[Ha,$a].indexOf(la)>=0?1:-1,ke=[ya,$a].indexOf(la)>=0?"y":"x";Bi[la]+=Kt[ke]*ua})}return Bi}function M1(G,g){g===void 0&&(g={});var x=g,C=x.placement,L=x.boundary,o=x.rootBoundary,_=x.padding,ct=x.flipVariations,lt=x.allowedAutoPlacements,Ot=lt===void 0?fm:lt,Ut=Yl(C),de=Ut?ct?_h:_h.filter(function(qe){return Yl(qe)===Ut}):Do,Ze=de.filter(function(qe){return Ot.indexOf(qe)>=0});Ze.length===0&&(Ze=de);var Fe=Ze.reduce(function(qe,Le){return qe[Le]=fn(G,{placement:Le,boundary:L,rootBoundary:o,padding:_})[bn(Le)],qe},{});return Object.keys(Fe).sort(function(qe,Le){return Fe[qe]-Fe[Le]})}function hX(G){if(bn(G)===Qm)return[];var g=Vc(G);return[qh(G),g,qh(g)]}function pX(G){var g=G.state,x=G.options,C=G.name;if(!g.modifiersData[C]._skip){for(var L=x.mainAxis,o=L===void 0?!0:L,_=x.altAxis,ct=_===void 0?!0:_,lt=x.fallbackPlacements,Ot=x.padding,Ut=x.boundary,de=x.rootBoundary,Ze=x.altBoundary,Fe=x.flipVariations,qe=Fe===void 0?!0:Fe,Le=x.allowedAutoPlacements,Ee=g.options.placement,hi=bn(Ee),Xi=hi===Ee,vi=lt||(Xi||!qe?[Vc(Ee)]:hX(Ee)),Se=[Ee].concat(vi).reduce(function(zn,on){return zn.concat(bn(on)===Qm?M1(g,{placement:on,boundary:Ut,rootBoundary:de,padding:Ot,flipVariations:qe,allowedAutoPlacements:Le}):on)},[]),Zi=g.rects.reference,Nt=g.rects.popper,Yi=new Map,Pi=!0,ye=Se[0],Bi=0;Bi<Se.length;Bi++){var Ya=Se[Bi],Kt=bn(Ya),la=Yl(Ya)===Io,ua=[ya,$a].indexOf(Kt)>=0,ke=ua?"width":"height",Ba=fn(g,{placement:Ya,boundary:Ut,rootBoundary:de,altBoundary:Ze,padding:Ot}),Ma=ua?la?Ha:va:la?$a:ya;Zi[ke]>Nt[ke]&&(Ma=Vc(Ma));var ln=Vc(Ma),ma=[];if(o&&ma.push(Ba[Kt]<=0),ct&&ma.push(Ba[Ma]<=0,Ba[ln]<=0),ma.every(function(zn){return zn})){ye=Ya,Pi=!1;break}Yi.set(Ya,ma)}if(Pi)for(var Ln=qe?3:1,ul=function(on){var mn=Se.find(function(Ra){var Ca=Yi.get(Ra);if(Ca)return Ca.slice(0,on).every(function(tn){return tn})});if(mn)return ye=mn,"break"},$n=Ln;$n>0;$n--){var Zl=ul($n);if(Zl==="break")break}g.placement!==ye&&(g.modifiersData[C]._skip=!0,g.placement=ye,g.reset=!0)}}var tp={name:"flip",enabled:!0,phase:"main",fn:pX,requiresIfExists:["offset"],data:{_skip:!1}};function qR(G,g,x){return x===void 0&&(x={x:0,y:0}),{top:G.top-g.height-x.y,right:G.right-g.width+x.x,bottom:G.bottom-g.height+x.y,left:G.left-g.width-x.x}}function $R(G){return[ya,Ha,$a,va].some(function(g){return G[g]>=0})}function WX(G){var g=G.state,x=G.name,C=g.rects.reference,L=g.rects.popper,o=g.modifiersData.preventOverflow,_=fn(g,{elementContext:"reference"}),ct=fn(g,{altBoundary:!0}),lt=qR(_,C),Ot=qR(ct,L,o),Ut=$R(lt),de=$R(Ot);g.modifiersData[x]={referenceClippingOffsets:lt,popperEscapeOffsets:Ot,isReferenceHidden:Ut,hasPopperEscaped:de},g.attributes.popper=Object.assign({},g.attributes.popper,{"data-popper-reference-hidden":Ut,"data-popper-escaped":de})}var ep={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:WX};function uX(G,g,x){var C=bn(G),L=[va,ya].indexOf(C)>=0?-1:1,o=typeof x=="function"?x(Object.assign({},g,{placement:G})):x,_=o[0],ct=o[1];return _=_||0,ct=(ct||0)*L,[va,Ha].indexOf(C)>=0?{x:ct,y:_}:{x:_,y:ct}}function ZX(G){var g=G.state,x=G.options,C=G.name,L=x.offset,o=L===void 0?[0,0]:L,_=fm.reduce(function(Ut,de){return Ut[de]=uX(de,g.rects,o),Ut},{}),ct=_[g.placement],lt=ct.x,Ot=ct.y;g.modifiersData.popperOffsets!=null&&(g.modifiersData.popperOffsets.x+=lt,g.modifiersData.popperOffsets.y+=Ot),g.modifiersData[C]=_}var ip={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:ZX};function gX(G){var g=G.state,x=G.name;g.modifiersData[x]=Am({reference:g.rects.reference,element:g.rects.popper,strategy:"absolute",placement:g.placement})}var Gc={name:"popperOffsets",enabled:!0,phase:"read",fn:gX,data:{}};function C1(G){return G==="x"?"y":"x"}function VX(G){var g=G.state,x=G.options,C=G.name,L=x.mainAxis,o=L===void 0?!0:L,_=x.altAxis,ct=_===void 0?!1:_,lt=x.boundary,Ot=x.rootBoundary,Ut=x.altBoundary,de=x.padding,Ze=x.tether,Fe=Ze===void 0?!0:Ze,qe=x.tetherOffset,Le=qe===void 0?0:qe,Ee=fn(g,{boundary:lt,rootBoundary:Ot,padding:de,altBoundary:Ut}),hi=bn(g.placement),Xi=Yl(g.placement),vi=!Xi,Se=Ks(hi),Zi=C1(Se),Nt=g.modifiersData.popperOffsets,Yi=g.rects.reference,Pi=g.rects.popper,ye=typeof Le=="function"?Le(Object.assign({},g.rects,{placement:g.placement})):Le,Bi=typeof ye=="number"?{mainAxis:ye,altAxis:ye}:Object.assign({mainAxis:0,altAxis:0},ye),Ya=g.modifiersData.offset?g.modifiersData.offset[g.placement]:null,Kt={x:0,y:0};if(Nt){if(o){var la,ua=Se==="y"?ya:va,ke=Se==="y"?$a:Ha,Ba=Se==="y"?"height":"width",Ma=Nt[Se],ln=Ma+Ee[ua],ma=Ma-Ee[ke],Ln=Fe?-Pi[Ba]/2:0,ul=Xi===Io?Yi[Ba]:Pi[Ba],$n=Xi===Io?-Pi[Ba]:-Yi[Ba],Zl=g.elements.arrow,zn=Fe&&Zl?Ps(Zl):{width:0,height:0},on=g.modifiersData["arrow#persistent"]?g.modifiersData["arrow#persistent"].padding:zm(),mn=on[ua],Ra=on[ke],Ca=qs(0,Yi[Ba],zn[Ba]),tn=vi?Yi[Ba]/2-Ln-Ca-mn-Bi.mainAxis:ul-Ca-mn-Bi.mainAxis,tr=vi?-Yi[Ba]/2+Ln+Ca+Ra+Bi.mainAxis:$n+Ca+Ra+Bi.mainAxis,ji=g.elements.arrow&&_l(g.elements.arrow),Vn=ji?Se==="y"?ji.clientTop||0:ji.clientLeft||0:0,gl=(la=Ya==null?void 0:Ya[Se])!=null?la:0,tl=Ma+tn-gl-Vn,wn=Ma+tr-gl,Vl=qs(Fe?_s(ln,tl):ln,Ma,Fe?Dl(ma,wn):ma);Nt[Se]=Vl,Kt[Se]=Vl-Ma}if(ct){var sa,Pl=Se==="x"?ya:va,Kl=Se==="x"?$a:Ha,Ta=Nt[Zi],Rn=Zi==="y"?"height":"width",el=Ta+Ee[Pl],Mt=Ta-Ee[Kl],j=[ya,va].indexOf(hi)!==-1,tt=(sa=Ya==null?void 0:Ya[Zi])!=null?sa:0,st=j?el:Ta-Yi[Rn]-Pi[Rn]-tt+Bi.altAxis,Yt=j?Ta+Yi[Rn]+Pi[Rn]-tt-Bi.altAxis:Mt,Tt=Fe&&j?_R(st,Ta,Yt):qs(Fe?st:el,Ta,Fe?Yt:Mt);Nt[Zi]=Tt,Kt[Zi]=Tt-Ta}g.modifiersData[C]=Kt}}var ap={name:"preventOverflow",enabled:!0,phase:"main",fn:VX,requiresIfExists:["offset"]};function T1(G){return{scrollLeft:G.scrollLeft,scrollTop:G.scrollTop}}function k1(G){return G===Na(G)||!an(G)?$s(G):T1(G)}function RX(G){var g=G.getBoundingClientRect(),x=_o(g.width)/G.offsetWidth||1,C=_o(g.height)/G.offsetHeight||1;return x!==1||C!==1}function Q1(G,g,x){x===void 0&&(x=!1);var C=an(g),L=an(g)&&RX(g),o=gn(g),_=Nl(G,L,x),ct={scrollLeft:0,scrollTop:0},lt={x:0,y:0};return(C||!C&&!x)&&((cn(g)!=="body"||ed(o))&&(ct=k1(g)),an(g)?(lt=Nl(g,!0),lt.x+=g.clientLeft,lt.y+=g.clientTop):o&&(lt.x=td(o))),{x:_.left+ct.scrollLeft-lt.x,y:_.top+ct.scrollTop-lt.y,width:_.width,height:_.height}}function GX(G){var g=new Map,x=new Set,C=[];G.forEach(function(o){g.set(o.name,o)});function L(o){x.add(o.name);var _=[].concat(o.requires||[],o.requiresIfExists||[]);_.forEach(function(ct){if(!x.has(ct)){var lt=g.get(ct);lt&&L(lt)}}),C.push(o)}return G.forEach(function(o){x.has(o.name)||L(o)}),C}function S1(G){var g=GX(G);return Y1.reduce(function(x,C){return x.concat(g.filter(function(L){return L.phase===C}))},[])}function f1(G){var g;return function(){return g||(g=new Promise(function(x){Promise.resolve().then(function(){g=void 0,x(G())})})),g}}function v1(G){var g=G.reduce(function(x,C){var L=x[C.name];return x[C.name]=L?Object.assign({},L,C,{options:Object.assign({},L.options,C.options),data:Object.assign({},L.data,C.data)}):C,x},{});return Object.keys(g).map(function(x){return g[x]})}var tG={placement:"bottom",modifiers:[],strategy:"absolute"};function eG(){for(var G=arguments.length,g=new Array(G),x=0;x<G;x++)g[x]=arguments[x];return!g.some(function(C){return!(C&&typeof C.getBoundingClientRect=="function")})}function id(G){G===void 0&&(G={});var g=G,x=g.defaultModifiers,C=x===void 0?[]:x,L=g.defaultOptions,o=L===void 0?tG:L;return function(ct,lt,Ot){Ot===void 0&&(Ot=o);var Ut={placement:"bottom",orderedModifiers:[],options:Object.assign({},tG,o),modifiersData:{},elements:{reference:ct,popper:lt},attributes:{},styles:{}},de=[],Ze=!1,Fe={state:Ut,setOptions:function(hi){var Xi=typeof hi=="function"?hi(Ut.options):hi;Le(),Ut.options=Object.assign({},o,Ut.options,Xi),Ut.scrollParents={reference:xl(ct)?zr(ct):ct.contextElement?zr(ct.contextElement):[],popper:zr(lt)};var vi=S1(v1([].concat(C,Ut.options.modifiers)));return Ut.orderedModifiers=vi.filter(function(Se){return Se.enabled}),qe(),Fe.update()},forceUpdate:function(){if(!Ze){var hi=Ut.elements,Xi=hi.reference,vi=hi.popper;if(eG(Xi,vi)){Ut.rects={reference:Q1(Xi,_l(vi),Ut.options.strategy==="fixed"),popper:Ps(vi)},Ut.reset=!1,Ut.placement=Ut.options.placement,Ut.orderedModifiers.forEach(function(Bi){return Ut.modifiersData[Bi.name]=Object.assign({},Bi.data)});for(var Se=0;Se<Ut.orderedModifiers.length;Se++){if(Ut.reset===!0){Ut.reset=!1,Se=-1;continue}var Zi=Ut.orderedModifiers[Se],Nt=Zi.fn,Yi=Zi.options,Pi=Yi===void 0?{}:Yi,ye=Zi.name;typeof Nt=="function"&&(Ut=Nt({state:Ut,options:Pi,name:ye,instance:Fe})||Ut)}}}},update:f1(function(){return new Promise(function(Ee){Fe.forceUpdate(),Ee(Ut)})}),destroy:function(){Le(),Ze=!0}};if(!eG(ct,lt))return Fe;Fe.setOptions(Ot).then(function(Ee){!Ze&&Ot.onFirstUpdate&&Ot.onFirstUpdate(Ee)});function qe(){Ut.orderedModifiers.forEach(function(Ee){var hi=Ee.name,Xi=Ee.options,vi=Xi===void 0?{}:Xi,Se=Ee.effect;if(typeof Se=="function"){var Zi=Se({state:Ut,name:hi,instance:Fe,options:vi}),Nt=function(){};de.push(Zi||Nt)}})}function Le(){de.forEach(function(Ee){return Ee()}),de=[]}return Fe}}var iG=id();var FX=[gc,Gc,Zc,Wc],aG=id({defaultModifiers:FX});var IX=[gc,Gc,Zc,Wc,ip,tp,ap,Ph,ep],Hm=id({defaultModifiers:IX});var wr=new Map,L1={set(G,g,x){wr.has(G)||wr.set(G,new Map);let C=wr.get(G);if(!C.has(g)&&C.size!==0){console.error("Bootstrap doesn't allow more than one instance per element. Bound instance: ".concat(Array.from(C.keys())[0],"."));return}C.set(g,x)},get(G,g){return wr.has(G)&&wr.get(G).get(g)||null},remove(G,g){if(!wr.has(G))return;let x=wr.get(G);x.delete(g),x.size===0&&wr.delete(G)}},UX=1e6,xX=1e3,eu="transitionend",MG=G=>(G&&window.CSS&&window.CSS.escape&&(G=G.replace(/#([^\s"#']+)/g,(g,x)=>"#".concat(CSS.escape(x)))),G),NX=G=>G==null?"".concat(G):Object.prototype.toString.call(G).match(/\s([a-z]+)/i)[1].toLowerCase(),YX=G=>{do G+=Math.floor(Math.random()*UX);while(document.getElementById(G));return G},XX=G=>{if(!G)return 0;let{transitionDuration:g,transitionDelay:x}=window.getComputedStyle(G),C=Number.parseFloat(g),L=Number.parseFloat(x);return!C&&!L?0:(g=g.split(",")[0],x=x.split(",")[0],(Number.parseFloat(g)+Number.parseFloat(x))*xX)},CG=G=>{G.dispatchEvent(new Event(eu))},Ko=G=>!G||typeof G!="object"?!1:(typeof G.jquery<"u"&&(G=G[0]),typeof G.nodeType<"u"),Er=G=>Ko(G)?G.jquery?G[0]:G:typeof G=="string"&&G.length>0?document.querySelector(MG(G)):null,Jc=G=>{if(!Ko(G)||G.getClientRects().length===0)return!1;let g=getComputedStyle(G).getPropertyValue("visibility")==="visible",x=G.closest("details:not([open])");if(!x)return g;if(x!==G){let C=G.closest("summary");if(C&&C.parentNode!==x||C===null)return!1}return g},Ar=G=>!G||G.nodeType!==Node.ELEMENT_NODE||G.classList.contains("disabled")?!0:typeof G.disabled<"u"?G.disabled:G.hasAttribute("disabled")&&G.getAttribute("disabled")!=="false",TG=G=>{if(!document.documentElement.attachShadow)return null;if(typeof G.getRootNode=="function"){let g=G.getRootNode();return g instanceof ShadowRoot?g:null}return G instanceof ShadowRoot?G:G.parentNode?TG(G.parentNode):null},hp=()=>{},Km=G=>{G.offsetHeight},kG=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,z1=[],JX=G=>{document.readyState==="loading"?(z1.length||document.addEventListener("DOMContentLoaded",()=>{for(let g of z1)g()}),z1.push(G)):G()},Xl=()=>document.documentElement.dir==="rtl",yl=G=>{JX(()=>{let g=kG();if(g){let x=G.NAME,C=g.fn[x];g.fn[x]=G.jQueryInterface,g.fn[x].Constructor=G,g.fn[x].noConflict=()=>(g.fn[x]=C,G.jQueryInterface)}})},Kn=(G,g=[],x=G)=>typeof G=="function"?G(...g):x,QG=(G,g,x=!0)=>{if(!x){Kn(G);return}let L=XX(g)+5,o=!1,_=({target:ct})=>{ct===g&&(o=!0,g.removeEventListener(eu,_),Kn(G))};g.addEventListener(eu,_),setTimeout(()=>{o||CG(g)},L)},ou=(G,g,x,C)=>{let L=G.length,o=G.indexOf(g);return o===-1?!x&&C?G[L-1]:G[0]:(o+=x?1:-1,C&&(o=(o+L)%L),G[Math.max(0,Math.min(o,L-1))])},yX=/[^.]*(?=\..*)\.|.*/,BX=/\..*/,MX=/::\d+$/,w1={},nG=1,SG={mouseenter:"mouseover",mouseleave:"mouseout"},CX=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function fG(G,g){return g&&"".concat(g,"::").concat(nG++)||G.uidEvent||nG++}function vG(G){let g=fG(G);return G.uidEvent=g,w1[g]=w1[g]||{},w1[g]}function TX(G,g){return function x(C){return ru(C,{delegateTarget:G}),x.oneOff&&oe.off(G,C.type,g),g.apply(G,[C])}}function kX(G,g,x){return function C(L){let o=G.querySelectorAll(g);for(let{target:_}=L;_&&_!==this;_=_.parentNode)for(let ct of o)if(ct===_)return ru(L,{delegateTarget:_}),C.oneOff&&oe.off(G,L.type,g,x),x.apply(_,[L])}}function LG(G,g,x=null){return Object.values(G).find(C=>C.callable===g&&C.delegationSelector===x)}function zG(G,g,x){let C=typeof g=="string",L=C?x:g||x,o=wG(G);return CX.has(o)||(o=G),[C,L,o]}function lG(G,g,x,C,L){if(typeof g!="string"||!G)return;let[o,_,ct]=zG(g,x,C);g in SG&&(_=(qe=>function(Le){if(!Le.relatedTarget||Le.relatedTarget!==Le.delegateTarget&&!Le.delegateTarget.contains(Le.relatedTarget))return qe.call(this,Le)})(_));let lt=vG(G),Ot=lt[ct]||(lt[ct]={}),Ut=LG(Ot,_,o?x:null);if(Ut){Ut.oneOff=Ut.oneOff&&L;return}let de=fG(_,g.replace(yX,"")),Ze=o?kX(G,x,_):TX(G,_);Ze.delegationSelector=o?x:null,Ze.callable=_,Ze.oneOff=L,Ze.uidEvent=de,Ot[de]=Ze,G.addEventListener(ct,Ze,o)}function iu(G,g,x,C,L){let o=LG(g[x],C,L);o&&(G.removeEventListener(x,o,!!L),delete g[x][o.uidEvent])}function QX(G,g,x,C){let L=g[x]||{};for(let[o,_]of Object.entries(L))o.includes(C)&&iu(G,g,x,_.callable,_.delegationSelector)}function wG(G){return G=G.replace(BX,""),SG[G]||G}var oe={on(G,g,x,C){lG(G,g,x,C,!1)},one(G,g,x,C){lG(G,g,x,C,!0)},off(G,g,x,C){if(typeof g!="string"||!G)return;let[L,o,_]=zG(g,x,C),ct=_!==g,lt=vG(G),Ot=lt[_]||{},Ut=g.startsWith(".");if(typeof o<"u"){if(!Object.keys(Ot).length)return;iu(G,lt,_,o,L?x:null);return}if(Ut)for(let de of Object.keys(lt))QX(G,lt,de,g.slice(1));for(let[de,Ze]of Object.entries(Ot)){let Fe=de.replace(MX,"");(!ct||g.includes(Fe))&&iu(G,lt,_,Ze.callable,Ze.delegationSelector)}},trigger(G,g,x){if(typeof g!="string"||!G)return null;let C=kG(),L=wG(g),o=g!==L,_=null,ct=!0,lt=!0,Ot=!1;o&&C&&(_=C.Event(g,x),C(G).trigger(_),ct=!_.isPropagationStopped(),lt=!_.isImmediatePropagationStopped(),Ot=_.isDefaultPrevented());let Ut=ru(new Event(g,{bubbles:ct,cancelable:!0}),x);return Ot&&Ut.preventDefault(),lt&&G.dispatchEvent(Ut),Ut.defaultPrevented&&_&&_.preventDefault(),Ut}};function ru(G,g={}){for(let[x,C]of Object.entries(g))try{G[x]=C}catch{Object.defineProperty(G,x,{configurable:!0,get(){return C}})}return G}function oG(G){if(G==="true")return!0;if(G==="false")return!1;if(G===Number(G).toString())return Number(G);if(G===""||G==="null")return null;if(typeof G!="string")return G;try{return JSON.parse(decodeURIComponent(G))}catch{return G}}function E1(G){return G.replace(/[A-Z]/g,g=>"-".concat(g.toLowerCase()))}var qo={setDataAttribute(G,g,x){G.setAttribute("data-bs-".concat(E1(g)),x)},removeDataAttribute(G,g){G.removeAttribute("data-bs-".concat(E1(g)))},getDataAttributes(G){if(!G)return{};let g={},x=Object.keys(G.dataset).filter(C=>C.startsWith("bs")&&!C.startsWith("bsConfig"));for(let C of x){let L=C.replace(/^bs/,"");L=L.charAt(0).toLowerCase()+L.slice(1,L.length),g[L]=oG(G.dataset[C])}return g},getDataAttribute(G,g){return oG(G.getAttribute("data-bs-".concat(E1(g))))}},ld=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(g){return g=this._mergeConfigObj(g),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}_configAfterMerge(g){return g}_mergeConfigObj(g,x){let C=Ko(x)?qo.getDataAttribute(x,"config"):{};return{...this.constructor.Default,...typeof C=="object"?C:{},...Ko(x)?qo.getDataAttributes(x):{},...typeof g=="object"?g:{}}}_typeCheckConfig(g,x=this.constructor.DefaultType){for(let[C,L]of Object.entries(x)){let o=g[C],_=Ko(o)?"element":NX(o);if(!new RegExp(L).test(_))throw new TypeError("".concat(this.constructor.NAME.toUpperCase(),': Option "').concat(C,'" provided type "').concat(_,'" but expected type "').concat(L,'".'))}}},SX="5.3.2",Wl=class extends ld{constructor(g,x){super(),g=Er(g),g&&(this._element=g,this._config=this._getConfig(x),L1.set(this._element,this.constructor.DATA_KEY,this))}dispose(){L1.remove(this._element,this.constructor.DATA_KEY),oe.off(this._element,this.constructor.EVENT_KEY);for(let g of Object.getOwnPropertyNames(this))this[g]=null}_queueCallback(g,x,C=!0){QG(g,x,C)}_getConfig(g){return g=this._mergeConfigObj(g,this._element),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}static getInstance(g){return L1.get(Er(g),this.DATA_KEY)}static getOrCreateInstance(g,x={}){return this.getInstance(g)||new this(g,typeof x=="object"?x:null)}static get VERSION(){return SX}static get DATA_KEY(){return"bs.".concat(this.NAME)}static get EVENT_KEY(){return".".concat(this.DATA_KEY)}static eventName(g){return"".concat(g).concat(this.EVENT_KEY)}},A1=G=>{let g=G.getAttribute("data-bs-target");if(!g||g==="#"){let x=G.getAttribute("href");if(!x||!x.includes("#")&&!x.startsWith("."))return null;x.includes("#")&&!x.startsWith("#")&&(x="#".concat(x.split("#")[1])),g=x&&x!=="#"?MG(x.trim()):null}return g},ii={find(G,g=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(g,G))},findOne(G,g=document.documentElement){return Element.prototype.querySelector.call(g,G)},children(G,g){return[].concat(...G.children).filter(x=>x.matches(g))},parents(G,g){let x=[],C=G.parentNode.closest(g);for(;C;)x.push(C),C=C.parentNode.closest(g);return x},prev(G,g){let x=G.previousElementSibling;for(;x;){if(x.matches(g))return[x];x=x.previousElementSibling}return[]},next(G,g){let x=G.nextElementSibling;for(;x;){if(x.matches(g))return[x];x=x.nextElementSibling}return[]},focusableChildren(G){let g=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(x=>"".concat(x,':not([tabindex^="-"])')).join(",");return this.find(g,G).filter(x=>!Ar(x)&&Jc(x))},getSelectorFromElement(G){let g=A1(G);return g&&ii.findOne(g)?g:null},getElementFromSelector(G){let g=A1(G);return g?ii.findOne(g):null},getMultipleElementsFromSelector(G){let g=A1(G);return g?ii.find(g):[]}},Ip=(G,g="hide")=>{let x="click.dismiss".concat(G.EVENT_KEY),C=G.NAME;oe.on(document,x,'[data-bs-dismiss="'.concat(C,'"]'),function(L){if(["A","AREA"].includes(this.tagName)&&L.preventDefault(),Ar(this))return;let o=ii.getElementFromSelector(this)||this.closest(".".concat(C));G.getOrCreateInstance(o)[g]()})},fX="alert",vX="bs.alert",EG=".".concat(vX),LX="close".concat(EG),zX="closed".concat(EG),wX="fade",EX="show",pp=class G extends Wl{static get NAME(){return fX}close(){if(oe.trigger(this._element,LX).defaultPrevented)return;this._element.classList.remove(EX);let x=this._element.classList.contains(wX);this._queueCallback(()=>this._destroyElement(),this._element,x)}_destroyElement(){this._element.remove(),oe.trigger(this._element,zX),this.dispose()}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this);if(typeof g=="string"){if(x[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError('No method named "'.concat(g,'"'));x[g](this)}})}};Ip(pp,"close");yl(pp);var AX="button",HX="bs.button",jX=".".concat(HX),OX=".data-api",DX="active",rG='[data-bs-toggle="button"]',_X="click".concat(jX).concat(OX),Wp=class G extends Wl{static get NAME(){return AX}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(DX))}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this);g==="toggle"&&x[g]()})}};oe.on(document,_X,rG,G=>{G.preventDefault();let g=G.target.closest(rG);Wp.getOrCreateInstance(g).toggle()});yl(Wp);var PX="swipe",yc=".bs.swipe",KX="touchstart".concat(yc),qX="touchmove".concat(yc),$X="touchend".concat(yc),tJ="pointerdown".concat(yc),eJ="pointerup".concat(yc),iJ="touch",aJ="pen",nJ="pointer-event",lJ=40,oJ={endCallback:null,leftCallback:null,rightCallback:null},rJ={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"},up=class G extends ld{constructor(g,x){super(),this._element=g,!(!g||!G.isSupported())&&(this._config=this._getConfig(x),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return oJ}static get DefaultType(){return rJ}static get NAME(){return PX}dispose(){oe.off(this._element,yc)}_start(g){if(!this._supportPointerEvents){this._deltaX=g.touches[0].clientX;return}this._eventIsPointerPenTouch(g)&&(this._deltaX=g.clientX)}_end(g){this._eventIsPointerPenTouch(g)&&(this._deltaX=g.clientX-this._deltaX),this._handleSwipe(),Kn(this._config.endCallback)}_move(g){this._deltaX=g.touches&&g.touches.length>1?0:g.touches[0].clientX-this._deltaX}_handleSwipe(){let g=Math.abs(this._deltaX);if(g<=lJ)return;let x=g/this._deltaX;this._deltaX=0,x&&Kn(x>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(oe.on(this._element,tJ,g=>this._start(g)),oe.on(this._element,eJ,g=>this._end(g)),this._element.classList.add(nJ)):(oe.on(this._element,KX,g=>this._start(g)),oe.on(this._element,qX,g=>this._move(g)),oe.on(this._element,$X,g=>this._end(g)))}_eventIsPointerPenTouch(g){return this._supportPointerEvents&&(g.pointerType===aJ||g.pointerType===iJ)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}},sJ="carousel",dJ="bs.carousel",Or=".".concat(dJ),AG=".data-api",cJ="ArrowLeft",bJ="ArrowRight",mJ=500,jm="next",Fc="prev",Uc="left",bp="right",hJ="slide".concat(Or),H1="slid".concat(Or),pJ="keydown".concat(Or),WJ="mouseenter".concat(Or),uJ="mouseleave".concat(Or),ZJ="dragstart".concat(Or),gJ="load".concat(Or).concat(AG),VJ="click".concat(Or).concat(AG),HG="carousel",lp="active",RJ="slide",GJ="carousel-item-end",FJ="carousel-item-start",IJ="carousel-item-next",UJ="carousel-item-prev",jG=".active",OG=".carousel-item",xJ=jG+OG,NJ=".carousel-item img",YJ=".carousel-indicators",XJ="[data-bs-slide], [data-bs-slide-to]",JJ='[data-bs-ride="carousel"]',yJ={[cJ]:bp,[bJ]:Uc},BJ={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},MJ={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"},Dm=class G extends Wl{constructor(g,x){super(g,x),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=ii.findOne(YJ,this._element),this._addEventListeners(),this._config.ride===HG&&this.cycle()}static get Default(){return BJ}static get DefaultType(){return MJ}static get NAME(){return sJ}next(){this._slide(jm)}nextWhenVisible(){!document.hidden&&Jc(this._element)&&this.next()}prev(){this._slide(Fc)}pause(){this._isSliding&&CG(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){oe.one(this._element,H1,()=>this.cycle());return}this.cycle()}}to(g){let x=this._getItems();if(g>x.length-1||g<0)return;if(this._isSliding){oe.one(this._element,H1,()=>this.to(g));return}let C=this._getItemIndex(this._getActive());if(C===g)return;let L=g>C?jm:Fc;this._slide(L,x[g])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(g){return g.defaultInterval=g.interval,g}_addEventListeners(){this._config.keyboard&&oe.on(this._element,pJ,g=>this._keydown(g)),this._config.pause==="hover"&&(oe.on(this._element,WJ,()=>this.pause()),oe.on(this._element,uJ,()=>this._maybeEnableCycle())),this._config.touch&&up.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let C of ii.find(NJ,this._element))oe.on(C,ZJ,L=>L.preventDefault());let x={leftCallback:()=>this._slide(this._directionToOrder(Uc)),rightCallback:()=>this._slide(this._directionToOrder(bp)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),mJ+this._config.interval))}};this._swipeHelper=new up(this._element,x)}_keydown(g){if(/input|textarea/i.test(g.target.tagName))return;let x=yJ[g.key];x&&(g.preventDefault(),this._slide(this._directionToOrder(x)))}_getItemIndex(g){return this._getItems().indexOf(g)}_setActiveIndicatorElement(g){if(!this._indicatorsElement)return;let x=ii.findOne(jG,this._indicatorsElement);x.classList.remove(lp),x.removeAttribute("aria-current");let C=ii.findOne('[data-bs-slide-to="'.concat(g,'"]'),this._indicatorsElement);C&&(C.classList.add(lp),C.setAttribute("aria-current","true"))}_updateInterval(){let g=this._activeElement||this._getActive();if(!g)return;let x=Number.parseInt(g.getAttribute("data-bs-interval"),10);this._config.interval=x||this._config.defaultInterval}_slide(g,x=null){if(this._isSliding)return;let C=this._getActive(),L=g===jm,o=x||ou(this._getItems(),C,L,this._config.wrap);if(o===C)return;let _=this._getItemIndex(o),ct=Fe=>oe.trigger(this._element,Fe,{relatedTarget:o,direction:this._orderToDirection(g),from:this._getItemIndex(C),to:_});if(ct(hJ).defaultPrevented||!C||!o)return;let Ot=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(_),this._activeElement=o;let Ut=L?FJ:GJ,de=L?IJ:UJ;o.classList.add(de),Km(o),C.classList.add(Ut),o.classList.add(Ut);let Ze=()=>{o.classList.remove(Ut,de),o.classList.add(lp),C.classList.remove(lp,de,Ut),this._isSliding=!1,ct(H1)};this._queueCallback(Ze,C,this._isAnimated()),Ot&&this.cycle()}_isAnimated(){return this._element.classList.contains(RJ)}_getActive(){return ii.findOne(xJ,this._element)}_getItems(){return ii.find(OG,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(g){return Xl()?g===Uc?Fc:jm:g===Uc?jm:Fc}_orderToDirection(g){return Xl()?g===Fc?Uc:bp:g===Fc?bp:Uc}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="number"){x.to(g);return}if(typeof g=="string"){if(x[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError('No method named "'.concat(g,'"'));x[g]()}})}};oe.on(document,VJ,XJ,function(G){let g=ii.getElementFromSelector(this);if(!g||!g.classList.contains(HG))return;G.preventDefault();let x=Dm.getOrCreateInstance(g),C=this.getAttribute("data-bs-slide-to");if(C){x.to(C),x._maybeEnableCycle();return}if(qo.getDataAttribute(this,"slide")==="next"){x.next(),x._maybeEnableCycle();return}x.prev(),x._maybeEnableCycle()});oe.on(window,gJ,()=>{let G=ii.find(JJ);for(let g of G)Dm.getOrCreateInstance(g)});yl(Dm);var CJ="collapse",TJ="bs.collapse",qm=".".concat(TJ),kJ=".data-api",QJ="show".concat(qm),SJ="shown".concat(qm),fJ="hide".concat(qm),vJ="hidden".concat(qm),LJ="click".concat(qm).concat(kJ),j1="show",Nc="collapse",op="collapsing",zJ="collapsed",wJ=":scope .".concat(Nc," .").concat(Nc),EJ="collapse-horizontal",AJ="width",HJ="height",jJ=".collapse.show, .collapse.collapsing",au='[data-bs-toggle="collapse"]',OJ={parent:null,toggle:!0},DJ={parent:"(null|element)",toggle:"boolean"},Zp=class G extends Wl{constructor(g,x){super(g,x),this._isTransitioning=!1,this._triggerArray=[];let C=ii.find(au);for(let L of C){let o=ii.getSelectorFromElement(L),_=ii.find(o).filter(ct=>ct===this._element);o!==null&&_.length&&this._triggerArray.push(L)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return OJ}static get DefaultType(){return DJ}static get NAME(){return CJ}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let g=[];if(this._config.parent&&(g=this._getFirstLevelChildren(jJ).filter(ct=>ct!==this._element).map(ct=>G.getOrCreateInstance(ct,{toggle:!1}))),g.length&&g[0]._isTransitioning||oe.trigger(this._element,QJ).defaultPrevented)return;for(let ct of g)ct.hide();let C=this._getDimension();this._element.classList.remove(Nc),this._element.classList.add(op),this._element.style[C]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;let L=()=>{this._isTransitioning=!1,this._element.classList.remove(op),this._element.classList.add(Nc,j1),this._element.style[C]="",oe.trigger(this._element,SJ)},o=C[0].toUpperCase()+C.slice(1),_="scroll".concat(o);this._queueCallback(L,this._element,!0),this._element.style[C]="".concat(this._element[_],"px")}hide(){if(this._isTransitioning||!this._isShown()||oe.trigger(this._element,fJ).defaultPrevented)return;let x=this._getDimension();this._element.style[x]="".concat(this._element.getBoundingClientRect()[x],"px"),Km(this._element),this._element.classList.add(op),this._element.classList.remove(Nc,j1);for(let L of this._triggerArray){let o=ii.getElementFromSelector(L);o&&!this._isShown(o)&&this._addAriaAndCollapsedClass([L],!1)}this._isTransitioning=!0;let C=()=>{this._isTransitioning=!1,this._element.classList.remove(op),this._element.classList.add(Nc),oe.trigger(this._element,vJ)};this._element.style[x]="",this._queueCallback(C,this._element,!0)}_isShown(g=this._element){return g.classList.contains(j1)}_configAfterMerge(g){return g.toggle=!!g.toggle,g.parent=Er(g.parent),g}_getDimension(){return this._element.classList.contains(EJ)?AJ:HJ}_initializeChildren(){if(!this._config.parent)return;let g=this._getFirstLevelChildren(au);for(let x of g){let C=ii.getElementFromSelector(x);C&&this._addAriaAndCollapsedClass([x],this._isShown(C))}}_getFirstLevelChildren(g){let x=ii.find(wJ,this._config.parent);return ii.find(g,this._config.parent).filter(C=>!x.includes(C))}_addAriaAndCollapsedClass(g,x){if(g.length)for(let C of g)C.classList.toggle(zJ,!x),C.setAttribute("aria-expanded",x)}static jQueryInterface(g){let x={};return typeof g=="string"&&/show|hide/.test(g)&&(x.toggle=!1),this.each(function(){let C=G.getOrCreateInstance(this,x);if(typeof g=="string"){if(typeof C[g]>"u")throw new TypeError('No method named "'.concat(g,'"'));C[g]()}})}};oe.on(document,LJ,au,function(G){(G.target.tagName==="A"||G.delegateTarget&&G.delegateTarget.tagName==="A")&&G.preventDefault();for(let g of ii.getMultipleElementsFromSelector(this))Zp.getOrCreateInstance(g,{toggle:!1}).toggle()});yl(Zp);var sG="dropdown",_J="bs.dropdown",od=".".concat(_J),su=".data-api",PJ="Escape",dG="Tab",KJ="ArrowUp",cG="ArrowDown",qJ=2,$J="hide".concat(od),t2="hidden".concat(od),e2="show".concat(od),i2="shown".concat(od),DG="click".concat(od).concat(su),_G="keydown".concat(od).concat(su),a2="keyup".concat(od).concat(su),xc="show",n2="dropup",l2="dropend",o2="dropstart",r2="dropup-center",s2="dropdown-center",ad='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',d2="".concat(ad,".").concat(xc),mp=".dropdown-menu",c2=".navbar",b2=".navbar-nav",m2=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",h2=Xl()?"top-end":"top-start",p2=Xl()?"top-start":"top-end",W2=Xl()?"bottom-end":"bottom-start",u2=Xl()?"bottom-start":"bottom-end",Z2=Xl()?"left-start":"right-start",g2=Xl()?"right-start":"left-start",V2="top",R2="bottom",G2={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},F2={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"},Hr=class G extends Wl{constructor(g,x){super(g,x),this._popper=null,this._parent=this._element.parentNode,this._menu=ii.next(this._element,mp)[0]||ii.prev(this._element,mp)[0]||ii.findOne(mp,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return G2}static get DefaultType(){return F2}static get NAME(){return sG}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Ar(this._element)||this._isShown())return;let g={relatedTarget:this._element};if(!oe.trigger(this._element,e2,g).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(b2))for(let C of[].concat(...document.body.children))oe.on(C,"mouseover",hp);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(xc),this._element.classList.add(xc),oe.trigger(this._element,i2,g)}}hide(){if(Ar(this._element)||!this._isShown())return;let g={relatedTarget:this._element};this._completeHide(g)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(g){if(!oe.trigger(this._element,$J,g).defaultPrevented){if("ontouchstart"in document.documentElement)for(let C of[].concat(...document.body.children))oe.off(C,"mouseover",hp);this._popper&&this._popper.destroy(),this._menu.classList.remove(xc),this._element.classList.remove(xc),this._element.setAttribute("aria-expanded","false"),qo.removeDataAttribute(this._menu,"popper"),oe.trigger(this._element,t2,g)}}_getConfig(g){if(g=super._getConfig(g),typeof g.reference=="object"&&!Ko(g.reference)&&typeof g.reference.getBoundingClientRect!="function")throw new TypeError("".concat(sG.toUpperCase(),': Option "reference" provided type "object" without a required "getBoundingClientRect" method.'));return g}_createPopper(){if(typeof np>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let g=this._element;this._config.reference==="parent"?g=this._parent:Ko(this._config.reference)?g=Er(this._config.reference):typeof this._config.reference=="object"&&(g=this._config.reference);let x=this._getPopperConfig();this._popper=Hm(g,this._menu,x)}_isShown(){return this._menu.classList.contains(xc)}_getPlacement(){let g=this._parent;if(g.classList.contains(l2))return Z2;if(g.classList.contains(o2))return g2;if(g.classList.contains(r2))return V2;if(g.classList.contains(s2))return R2;let x=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return g.classList.contains(n2)?x?p2:h2:x?u2:W2}_detectNavbar(){return this._element.closest(c2)!==null}_getOffset(){let{offset:g}=this._config;return typeof g=="string"?g.split(",").map(x=>Number.parseInt(x,10)):typeof g=="function"?x=>g(x,this._element):g}_getPopperConfig(){let g={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(qo.setDataAttribute(this._menu,"popper","static"),g.modifiers=[{name:"applyStyles",enabled:!1}]),{...g,...Kn(this._config.popperConfig,[g])}}_selectMenuItem({key:g,target:x}){let C=ii.find(m2,this._menu).filter(L=>Jc(L));C.length&&ou(C,x,g===cG,!C.includes(x)).focus()}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof x[g]>"u")throw new TypeError('No method named "'.concat(g,'"'));x[g]()}})}static clearMenus(g){if(g.button===qJ||g.type==="keyup"&&g.key!==dG)return;let x=ii.find(d2);for(let C of x){let L=G.getInstance(C);if(!L||L._config.autoClose===!1)continue;let o=g.composedPath(),_=o.includes(L._menu);if(o.includes(L._element)||L._config.autoClose==="inside"&&!_||L._config.autoClose==="outside"&&_||L._menu.contains(g.target)&&(g.type==="keyup"&&g.key===dG||/input|select|option|textarea|form/i.test(g.target.tagName)))continue;let ct={relatedTarget:L._element};g.type==="click"&&(ct.clickEvent=g),L._completeHide(ct)}}static dataApiKeydownHandler(g){let x=/input|textarea/i.test(g.target.tagName),C=g.key===PJ,L=[KJ,cG].includes(g.key);if(!L&&!C||x&&!C)return;g.preventDefault();let o=this.matches(ad)?this:ii.prev(this,ad)[0]||ii.next(this,ad)[0]||ii.findOne(ad,g.delegateTarget.parentNode),_=G.getOrCreateInstance(o);if(L){g.stopPropagation(),_.show(),_._selectMenuItem(g);return}_._isShown()&&(g.stopPropagation(),_.hide(),o.focus())}};oe.on(document,_G,ad,Hr.dataApiKeydownHandler);oe.on(document,_G,mp,Hr.dataApiKeydownHandler);oe.on(document,DG,Hr.clearMenus);oe.on(document,a2,Hr.clearMenus);oe.on(document,DG,ad,function(G){G.preventDefault(),Hr.getOrCreateInstance(this).toggle()});yl(Hr);var PG="backdrop",I2="fade",bG="show",mG="mousedown.bs.".concat(PG),U2={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},x2={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"},gp=class extends ld{constructor(g){super(),this._config=this._getConfig(g),this._isAppended=!1,this._element=null}static get Default(){return U2}static get DefaultType(){return x2}static get NAME(){return PG}show(g){if(!this._config.isVisible){Kn(g);return}this._append();let x=this._getElement();this._config.isAnimated&&Km(x),x.classList.add(bG),this._emulateAnimation(()=>{Kn(g)})}hide(g){if(!this._config.isVisible){Kn(g);return}this._getElement().classList.remove(bG),this._emulateAnimation(()=>{this.dispose(),Kn(g)})}dispose(){this._isAppended&&(oe.off(this._element,mG),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let g=document.createElement("div");g.className=this._config.className,this._config.isAnimated&&g.classList.add(I2),this._element=g}return this._element}_configAfterMerge(g){return g.rootElement=Er(g.rootElement),g}_append(){if(this._isAppended)return;let g=this._getElement();this._config.rootElement.append(g),oe.on(g,mG,()=>{Kn(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(g){QG(g,this._getElement(),this._config.isAnimated)}},N2="focustrap",Y2="bs.focustrap",Vp=".".concat(Y2),X2="focusin".concat(Vp),J2="keydown.tab".concat(Vp),y2="Tab",B2="forward",hG="backward",M2={autofocus:!0,trapElement:null},C2={autofocus:"boolean",trapElement:"element"},Rp=class extends ld{constructor(g){super(),this._config=this._getConfig(g),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return M2}static get DefaultType(){return C2}static get NAME(){return N2}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),oe.off(document,Vp),oe.on(document,X2,g=>this._handleFocusin(g)),oe.on(document,J2,g=>this._handleKeydown(g)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,oe.off(document,Vp))}_handleFocusin(g){let{trapElement:x}=this._config;if(g.target===document||g.target===x||x.contains(g.target))return;let C=ii.focusableChildren(x);C.length===0?x.focus():this._lastTabNavDirection===hG?C[C.length-1].focus():C[0].focus()}_handleKeydown(g){g.key===y2&&(this._lastTabNavDirection=g.shiftKey?hG:B2)}},pG=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",WG=".sticky-top",rp="padding-right",uG="margin-right",_m=class{constructor(){this._element=document.body}getWidth(){let g=document.documentElement.clientWidth;return Math.abs(window.innerWidth-g)}hide(){let g=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,rp,x=>x+g),this._setElementAttributes(pG,rp,x=>x+g),this._setElementAttributes(WG,uG,x=>x-g)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,rp),this._resetElementAttributes(pG,rp),this._resetElementAttributes(WG,uG)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(g,x,C){let L=this.getWidth(),o=_=>{if(_!==this._element&&window.innerWidth>_.clientWidth+L)return;this._saveInitialAttribute(_,x);let ct=window.getComputedStyle(_).getPropertyValue(x);_.style.setProperty(x,"".concat(C(Number.parseFloat(ct)),"px"))};this._applyManipulationCallback(g,o)}_saveInitialAttribute(g,x){let C=g.style.getPropertyValue(x);C&&qo.setDataAttribute(g,x,C)}_resetElementAttributes(g,x){let C=L=>{let o=qo.getDataAttribute(L,x);if(o===null){L.style.removeProperty(x);return}qo.removeDataAttribute(L,x),L.style.setProperty(x,o)};this._applyManipulationCallback(g,C)}_applyManipulationCallback(g,x){if(Ko(g)){x(g);return}for(let C of ii.find(g,this._element))x(C)}},T2="modal",k2="bs.modal",Jl=".".concat(k2),Q2=".data-api",S2="Escape",f2="hide".concat(Jl),v2="hidePrevented".concat(Jl),KG="hidden".concat(Jl),qG="show".concat(Jl),L2="shown".concat(Jl),z2="resize".concat(Jl),w2="click.dismiss".concat(Jl),E2="mousedown.dismiss".concat(Jl),A2="keydown.dismiss".concat(Jl),H2="click".concat(Jl).concat(Q2),ZG="modal-open",j2="fade",gG="show",O1="modal-static",O2=".modal.show",D2=".modal-dialog",_2=".modal-body",P2='[data-bs-toggle="modal"]',K2={backdrop:!0,focus:!0,keyboard:!0},q2={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"},Yc=class G extends Wl{constructor(g,x){super(g,x),this._dialog=ii.findOne(D2,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new _m,this._addEventListeners()}static get Default(){return K2}static get DefaultType(){return q2}static get NAME(){return T2}toggle(g){return this._isShown?this.hide():this.show(g)}show(g){this._isShown||this._isTransitioning||oe.trigger(this._element,qG,{relatedTarget:g}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(ZG),this._adjustDialog(),this._backdrop.show(()=>this._showElement(g)))}hide(){!this._isShown||this._isTransitioning||oe.trigger(this._element,f2).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(gG),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){oe.off(window,Jl),oe.off(this._dialog,Jl),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new gp({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Rp({trapElement:this._element})}_showElement(g){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;let x=ii.findOne(_2,this._dialog);x&&(x.scrollTop=0),Km(this._element),this._element.classList.add(gG);let C=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,oe.trigger(this._element,L2,{relatedTarget:g})};this._queueCallback(C,this._dialog,this._isAnimated())}_addEventListeners(){oe.on(this._element,A2,g=>{if(g.key===S2){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),oe.on(window,z2,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),oe.on(this._element,E2,g=>{oe.one(this._element,w2,x=>{if(!(this._element!==g.target||this._element!==x.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(ZG),this._resetAdjustments(),this._scrollBar.reset(),oe.trigger(this._element,KG)})}_isAnimated(){return this._element.classList.contains(j2)}_triggerBackdropTransition(){if(oe.trigger(this._element,v2).defaultPrevented)return;let x=this._element.scrollHeight>document.documentElement.clientHeight,C=this._element.style.overflowY;C==="hidden"||this._element.classList.contains(O1)||(x||(this._element.style.overflowY="hidden"),this._element.classList.add(O1),this._queueCallback(()=>{this._element.classList.remove(O1),this._queueCallback(()=>{this._element.style.overflowY=C},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){let g=this._element.scrollHeight>document.documentElement.clientHeight,x=this._scrollBar.getWidth(),C=x>0;if(C&&!g){let L=Xl()?"paddingLeft":"paddingRight";this._element.style[L]="".concat(x,"px")}if(!C&&g){let L=Xl()?"paddingRight":"paddingLeft";this._element.style[L]="".concat(x,"px")}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(g,x){return this.each(function(){let C=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof C[g]>"u")throw new TypeError('No method named "'.concat(g,'"'));C[g](x)}})}};oe.on(document,H2,P2,function(G){let g=ii.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&G.preventDefault(),oe.one(g,qG,L=>{L.defaultPrevented||oe.one(g,KG,()=>{Jc(this)&&this.focus()})});let x=ii.findOne(O2);x&&Yc.getInstance(x).hide(),Yc.getOrCreateInstance(g).toggle(this)});Ip(Yc);yl(Yc);var $2="offcanvas",ty="bs.offcanvas",$o=".".concat(ty),$G=".data-api",ey="load".concat($o).concat($G),iy="Escape",VG="show",RG="showing",GG="hiding",ay="offcanvas-backdrop",tF=".offcanvas.show",ny="show".concat($o),ly="shown".concat($o),oy="hide".concat($o),FG="hidePrevented".concat($o),eF="hidden".concat($o),ry="resize".concat($o),sy="click".concat($o).concat($G),dy="keydown.dismiss".concat($o),cy='[data-bs-toggle="offcanvas"]',by={backdrop:!0,keyboard:!0,scroll:!1},my={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"},jr=class G extends Wl{constructor(g,x){super(g,x),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return by}static get DefaultType(){return my}static get NAME(){return $2}toggle(g){return this._isShown?this.hide():this.show(g)}show(g){if(this._isShown||oe.trigger(this._element,ny,{relatedTarget:g}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new _m().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(RG);let C=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(VG),this._element.classList.remove(RG),oe.trigger(this._element,ly,{relatedTarget:g})};this._queueCallback(C,this._element,!0)}hide(){if(!this._isShown||oe.trigger(this._element,oy).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(GG),this._backdrop.hide();let x=()=>{this._element.classList.remove(VG,GG),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new _m().reset(),oe.trigger(this._element,eF)};this._queueCallback(x,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){let g=()=>{if(this._config.backdrop==="static"){oe.trigger(this._element,FG);return}this.hide()},x=!!this._config.backdrop;return new gp({className:ay,isVisible:x,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:x?g:null})}_initializeFocusTrap(){return new Rp({trapElement:this._element})}_addEventListeners(){oe.on(this._element,dy,g=>{if(g.key===iy){if(this._config.keyboard){this.hide();return}oe.trigger(this._element,FG)}})}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(x[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError('No method named "'.concat(g,'"'));x[g](this)}})}};oe.on(document,sy,cy,function(G){let g=ii.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&G.preventDefault(),Ar(this))return;oe.one(g,eF,()=>{Jc(this)&&this.focus()});let x=ii.findOne(tF);x&&x!==g&&jr.getInstance(x).hide(),jr.getOrCreateInstance(g).toggle(this)});oe.on(window,ey,()=>{for(let G of ii.find(tF))jr.getOrCreateInstance(G).show()});oe.on(window,ry,()=>{for(let G of ii.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(G).position!=="fixed"&&jr.getOrCreateInstance(G).hide()});Ip(jr);yl(jr);var hy=/^aria-[\w-]*$/i,iF={"*":["class","dir","id","lang","role",hy],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},py=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Wy=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,uy=(G,g)=>{let x=G.nodeName.toLowerCase();return g.includes(x)?py.has(x)?!!Wy.test(G.nodeValue):!0:g.filter(C=>C instanceof RegExp).some(C=>C.test(x))};function Zy(G,g,x){if(!G.length)return G;if(x&&typeof x=="function")return x(G);let L=new window.DOMParser().parseFromString(G,"text/html"),o=[].concat(...L.body.querySelectorAll("*"));for(let _ of o){let ct=_.nodeName.toLowerCase();if(!Object.keys(g).includes(ct)){_.remove();continue}let lt=[].concat(..._.attributes),Ot=[].concat(g["*"]||[],g[ct]||[]);for(let Ut of lt)uy(Ut,Ot)||_.removeAttribute(Ut.nodeName)}return L.body.innerHTML}var gy="TemplateFactory",Vy={allowList:iF,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Ry={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Gy={entry:"(string|element|function|null)",selector:"(string|element)"},nu=class extends ld{constructor(g){super(),this._config=this._getConfig(g)}static get Default(){return Vy}static get DefaultType(){return Ry}static get NAME(){return gy}getContent(){return Object.values(this._config.content).map(g=>this._resolvePossibleFunction(g)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(g){return this._checkContent(g),this._config.content={...this._config.content,...g},this}toHtml(){let g=document.createElement("div");g.innerHTML=this._maybeSanitize(this._config.template);for(let[L,o]of Object.entries(this._config.content))this._setContent(g,o,L);let x=g.children[0],C=this._resolvePossibleFunction(this._config.extraClass);return C&&x.classList.add(...C.split(" ")),x}_typeCheckConfig(g){super._typeCheckConfig(g),this._checkContent(g.content)}_checkContent(g){for(let[x,C]of Object.entries(g))super._typeCheckConfig({selector:x,entry:C},Gy)}_setContent(g,x,C){let L=ii.findOne(C,g);if(L){if(x=this._resolvePossibleFunction(x),!x){L.remove();return}if(Ko(x)){this._putElementInTemplate(Er(x),L);return}if(this._config.html){L.innerHTML=this._maybeSanitize(x);return}L.textContent=x}}_maybeSanitize(g){return this._config.sanitize?Zy(g,this._config.allowList,this._config.sanitizeFn):g}_resolvePossibleFunction(g){return Kn(g,[this])}_putElementInTemplate(g,x){if(this._config.html){x.innerHTML="",x.append(g);return}x.textContent=g.textContent}},Fy="tooltip",Iy=new Set(["sanitize","allowList","sanitizeFn"]),D1="fade",Uy="modal",sp="show",xy=".tooltip-inner",IG=".".concat(Uy),UG="hide.bs.modal",Om="hover",_1="focus",Ny="click",Yy="manual",Xy="hide",Jy="hidden",yy="show",By="shown",My="inserted",Cy="click",Ty="focusin",ky="focusout",Qy="mouseenter",Sy="mouseleave",fy={AUTO:"auto",TOP:"top",RIGHT:Xl()?"left":"right",BOTTOM:"bottom",LEFT:Xl()?"right":"left"},vy={allowList:iF,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Ly={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"},Xc=class G extends Wl{constructor(g,x){if(typeof np>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(g,x),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return vy}static get DefaultType(){return Ly}static get NAME(){return Fy}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),oe.off(this._element.closest(IG),UG,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;let g=oe.trigger(this._element,this.constructor.eventName(yy)),C=(TG(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(g.defaultPrevented||!C)return;this._disposePopper();let L=this._getTipElement();this._element.setAttribute("aria-describedby",L.getAttribute("id"));let{container:o}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(o.append(L),oe.trigger(this._element,this.constructor.eventName(My))),this._popper=this._createPopper(L),L.classList.add(sp),"ontouchstart"in document.documentElement)for(let ct of[].concat(...document.body.children))oe.on(ct,"mouseover",hp);let _=()=>{oe.trigger(this._element,this.constructor.eventName(By)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(_,this.tip,this._isAnimated())}hide(){if(!this._isShown()||oe.trigger(this._element,this.constructor.eventName(Xy)).defaultPrevented)return;if(this._getTipElement().classList.remove(sp),"ontouchstart"in document.documentElement)for(let L of[].concat(...document.body.children))oe.off(L,"mouseover",hp);this._activeTrigger[Ny]=!1,this._activeTrigger[_1]=!1,this._activeTrigger[Om]=!1,this._isHovered=null;let C=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),oe.trigger(this._element,this.constructor.eventName(Jy)))};this._queueCallback(C,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(g){let x=this._getTemplateFactory(g).toHtml();if(!x)return null;x.classList.remove(D1,sp),x.classList.add("bs-".concat(this.constructor.NAME,"-auto"));let C=YX(this.constructor.NAME).toString();return x.setAttribute("id",C),this._isAnimated()&&x.classList.add(D1),x}setContent(g){this._newContent=g,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(g){return this._templateFactory?this._templateFactory.changeContent(g):this._templateFactory=new nu({...this._config,content:g,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[xy]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(g){return this.constructor.getOrCreateInstance(g.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(D1)}_isShown(){return this.tip&&this.tip.classList.contains(sp)}_createPopper(g){let x=Kn(this._config.placement,[this,g,this._element]),C=fy[x.toUpperCase()];return Hm(this._element,g,this._getPopperConfig(C))}_getOffset(){let{offset:g}=this._config;return typeof g=="string"?g.split(",").map(x=>Number.parseInt(x,10)):typeof g=="function"?x=>g(x,this._element):g}_resolvePossibleFunction(g){return Kn(g,[this._element])}_getPopperConfig(g){let x={placement:g,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:".".concat(this.constructor.NAME,"-arrow")}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:C=>{this._getTipElement().setAttribute("data-popper-placement",C.state.placement)}}]};return{...x,...Kn(this._config.popperConfig,[x])}}_setListeners(){let g=this._config.trigger.split(" ");for(let x of g)if(x==="click")oe.on(this._element,this.constructor.eventName(Cy),this._config.selector,C=>{this._initializeOnDelegatedTarget(C).toggle()});else if(x!==Yy){let C=x===Om?this.constructor.eventName(Qy):this.constructor.eventName(Ty),L=x===Om?this.constructor.eventName(Sy):this.constructor.eventName(ky);oe.on(this._element,C,this._config.selector,o=>{let _=this._initializeOnDelegatedTarget(o);_._activeTrigger[o.type==="focusin"?_1:Om]=!0,_._enter()}),oe.on(this._element,L,this._config.selector,o=>{let _=this._initializeOnDelegatedTarget(o);_._activeTrigger[o.type==="focusout"?_1:Om]=_._element.contains(o.relatedTarget),_._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},oe.on(this._element.closest(IG),UG,this._hideModalHandler)}_fixTitle(){let g=this._element.getAttribute("title");g&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",g),this._element.setAttribute("data-bs-original-title",g),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(g,x){clearTimeout(this._timeout),this._timeout=setTimeout(g,x)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(g){let x=qo.getDataAttributes(this._element);for(let C of Object.keys(x))Iy.has(C)&&delete x[C];return g={...x,...typeof g=="object"&&g?g:{}},g=this._mergeConfigObj(g),g=this._configAfterMerge(g),this._typeCheckConfig(g),g}_configAfterMerge(g){return g.container=g.container===!1?document.body:Er(g.container),typeof g.delay=="number"&&(g.delay={show:g.delay,hide:g.delay}),typeof g.title=="number"&&(g.title=g.title.toString()),typeof g.content=="number"&&(g.content=g.content.toString()),g}_getDelegateConfig(){let g={};for(let[x,C]of Object.entries(this._config))this.constructor.Default[x]!==C&&(g[x]=C);return g.selector=!1,g.trigger="manual",g}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof x[g]>"u")throw new TypeError('No method named "'.concat(g,'"'));x[g]()}})}};yl(Xc);var zy="popover",wy=".popover-header",Ey=".popover-body",Ay={...Xc.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Hy={...Xc.DefaultType,content:"(null|string|element|function)"},lu=class G extends Xc{static get Default(){return Ay}static get DefaultType(){return Hy}static get NAME(){return zy}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[wy]:this._getTitle(),[Ey]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof x[g]>"u")throw new TypeError('No method named "'.concat(g,'"'));x[g]()}})}};yl(lu);var jy="scrollspy",Oy="bs.scrollspy",du=".".concat(Oy),Dy=".data-api",_y="activate".concat(du),xG="click".concat(du),Py="load".concat(du).concat(Dy),Ky="dropdown-item",Ic="active",qy='[data-bs-spy="scroll"]',P1="[href]",$y=".nav, .list-group",NG=".nav-link",tB=".nav-item",eB=".list-group-item",iB="".concat(NG,", ").concat(tB," > ").concat(NG,", ").concat(eB),aB=".dropdown",nB=".dropdown-toggle",lB={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},oB={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"},Gp=class G extends Wl{constructor(g,x){super(g,x),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return lB}static get DefaultType(){return oB}static get NAME(){return jy}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(let g of this._observableSections.values())this._observer.observe(g)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(g){return g.target=Er(g.target)||document.body,g.rootMargin=g.offset?"".concat(g.offset,"px 0px -30%"):g.rootMargin,typeof g.threshold=="string"&&(g.threshold=g.threshold.split(",").map(x=>Number.parseFloat(x))),g}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(oe.off(this._config.target,xG),oe.on(this._config.target,xG,P1,g=>{let x=this._observableSections.get(g.target.hash);if(x){g.preventDefault();let C=this._rootElement||window,L=x.offsetTop-this._element.offsetTop;if(C.scrollTo){C.scrollTo({top:L,behavior:"smooth"});return}C.scrollTop=L}}))}_getNewObserver(){let g={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(x=>this._observerCallback(x),g)}_observerCallback(g){let x=_=>this._targetLinks.get("#".concat(_.target.id)),C=_=>{this._previousScrollData.visibleEntryTop=_.target.offsetTop,this._process(x(_))},L=(this._rootElement||document.documentElement).scrollTop,o=L>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=L;for(let _ of g){if(!_.isIntersecting){this._activeTarget=null,this._clearActiveClass(x(_));continue}let ct=_.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(o&&ct){if(C(_),!L)return;continue}!o&&!ct&&C(_)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;let g=ii.find(P1,this._config.target);for(let x of g){if(!x.hash||Ar(x))continue;let C=ii.findOne(decodeURI(x.hash),this._element);Jc(C)&&(this._targetLinks.set(decodeURI(x.hash),x),this._observableSections.set(x.hash,C))}}_process(g){this._activeTarget!==g&&(this._clearActiveClass(this._config.target),this._activeTarget=g,g.classList.add(Ic),this._activateParents(g),oe.trigger(this._element,_y,{relatedTarget:g}))}_activateParents(g){if(g.classList.contains(Ky)){ii.findOne(nB,g.closest(aB)).classList.add(Ic);return}for(let x of ii.parents(g,$y))for(let C of ii.prev(x,iB))C.classList.add(Ic)}_clearActiveClass(g){g.classList.remove(Ic);let x=ii.find("".concat(P1,".").concat(Ic),g);for(let C of x)C.classList.remove(Ic)}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(x[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError('No method named "'.concat(g,'"'));x[g]()}})}};oe.on(window,Py,()=>{for(let G of ii.find(qy))Gp.getOrCreateInstance(G)});yl(Gp);var rB="tab",sB="bs.tab",rd=".".concat(sB),dB="hide".concat(rd),cB="hidden".concat(rd),bB="show".concat(rd),mB="shown".concat(rd),hB="click".concat(rd),pB="keydown".concat(rd),WB="load".concat(rd),uB="ArrowLeft",YG="ArrowRight",ZB="ArrowUp",XG="ArrowDown",K1="Home",JG="End",nd="active",yG="fade",q1="show",gB="dropdown",aF=".dropdown-toggle",VB=".dropdown-menu",$1=":not(".concat(aF,")"),RB='.list-group, .nav, [role="tablist"]',GB=".nav-item, .list-group-item",FB=".nav-link".concat($1,", .list-group-item").concat($1,', [role="tab"]').concat($1),nF='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',tu="".concat(FB,", ").concat(nF),IB=".".concat(nd,'[data-bs-toggle="tab"], .').concat(nd,'[data-bs-toggle="pill"], .').concat(nd,'[data-bs-toggle="list"]'),Pm=class G extends Wl{constructor(g){super(g),this._parent=this._element.closest(RB),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),oe.on(this._element,pB,x=>this._keydown(x)))}static get NAME(){return rB}show(){let g=this._element;if(this._elemIsActive(g))return;let x=this._getActiveElem(),C=x?oe.trigger(x,dB,{relatedTarget:g}):null;oe.trigger(g,bB,{relatedTarget:x}).defaultPrevented||C&&C.defaultPrevented||(this._deactivate(x,g),this._activate(g,x))}_activate(g,x){if(!g)return;g.classList.add(nd),this._activate(ii.getElementFromSelector(g));let C=()=>{if(g.getAttribute("role")!=="tab"){g.classList.add(q1);return}g.removeAttribute("tabindex"),g.setAttribute("aria-selected",!0),this._toggleDropDown(g,!0),oe.trigger(g,mB,{relatedTarget:x})};this._queueCallback(C,g,g.classList.contains(yG))}_deactivate(g,x){if(!g)return;g.classList.remove(nd),g.blur(),this._deactivate(ii.getElementFromSelector(g));let C=()=>{if(g.getAttribute("role")!=="tab"){g.classList.remove(q1);return}g.setAttribute("aria-selected",!1),g.setAttribute("tabindex","-1"),this._toggleDropDown(g,!1),oe.trigger(g,cB,{relatedTarget:x})};this._queueCallback(C,g,g.classList.contains(yG))}_keydown(g){if(![uB,YG,ZB,XG,K1,JG].includes(g.key))return;g.stopPropagation(),g.preventDefault();let x=this._getChildren().filter(L=>!Ar(L)),C;if([K1,JG].includes(g.key))C=x[g.key===K1?0:x.length-1];else{let L=[YG,XG].includes(g.key);C=ou(x,g.target,L,!0)}C&&(C.focus({preventScroll:!0}),G.getOrCreateInstance(C).show())}_getChildren(){return ii.find(tu,this._parent)}_getActiveElem(){return this._getChildren().find(g=>this._elemIsActive(g))||null}_setInitialAttributes(g,x){this._setAttributeIfNotExists(g,"role","tablist");for(let C of x)this._setInitialAttributesOnChild(C)}_setInitialAttributesOnChild(g){g=this._getInnerElement(g);let x=this._elemIsActive(g),C=this._getOuterElement(g);g.setAttribute("aria-selected",x),C!==g&&this._setAttributeIfNotExists(C,"role","presentation"),x||g.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(g,"role","tab"),this._setInitialAttributesOnTargetPanel(g)}_setInitialAttributesOnTargetPanel(g){let x=ii.getElementFromSelector(g);x&&(this._setAttributeIfNotExists(x,"role","tabpanel"),g.id&&this._setAttributeIfNotExists(x,"aria-labelledby","".concat(g.id)))}_toggleDropDown(g,x){let C=this._getOuterElement(g);if(!C.classList.contains(gB))return;let L=(o,_)=>{let ct=ii.findOne(o,C);ct&&ct.classList.toggle(_,x)};L(aF,nd),L(VB,q1),C.setAttribute("aria-expanded",x)}_setAttributeIfNotExists(g,x,C){g.hasAttribute(x)||g.setAttribute(x,C)}_elemIsActive(g){return g.classList.contains(nd)}_getInnerElement(g){return g.matches(tu)?g:ii.findOne(tu,g)}_getOuterElement(g){return g.closest(GB)||g}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this);if(typeof g=="string"){if(x[g]===void 0||g.startsWith("_")||g==="constructor")throw new TypeError('No method named "'.concat(g,'"'));x[g]()}})}};oe.on(document,hB,nF,function(G){["A","AREA"].includes(this.tagName)&&G.preventDefault(),!Ar(this)&&Pm.getOrCreateInstance(this).show()});oe.on(window,WB,()=>{for(let G of ii.find(IB))Pm.getOrCreateInstance(G)});yl(Pm);var UB="toast",xB="bs.toast",Dr=".".concat(xB),NB="mouseover".concat(Dr),YB="mouseout".concat(Dr),XB="focusin".concat(Dr),JB="focusout".concat(Dr),yB="hide".concat(Dr),BB="hidden".concat(Dr),MB="show".concat(Dr),CB="shown".concat(Dr),TB="fade",BG="hide",dp="show",cp="showing",kB={animation:"boolean",autohide:"boolean",delay:"number"},QB={animation:!0,autohide:!0,delay:5e3},Fp=class G extends Wl{constructor(g,x){super(g,x),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return QB}static get DefaultType(){return kB}static get NAME(){return UB}show(){if(oe.trigger(this._element,MB).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(TB);let x=()=>{this._element.classList.remove(cp),oe.trigger(this._element,CB),this._maybeScheduleHide()};this._element.classList.remove(BG),Km(this._element),this._element.classList.add(dp,cp),this._queueCallback(x,this._element,this._config.animation)}hide(){if(!this.isShown()||oe.trigger(this._element,yB).defaultPrevented)return;let x=()=>{this._element.classList.add(BG),this._element.classList.remove(cp,dp),oe.trigger(this._element,BB)};this._element.classList.add(cp),this._queueCallback(x,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(dp),super.dispose()}isShown(){return this._element.classList.contains(dp)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(g,x){switch(g.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=x;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=x;break}}if(x){this._clearTimeout();return}let C=g.relatedTarget;this._element===C||this._element.contains(C)||this._maybeScheduleHide()}_setListeners(){oe.on(this._element,NB,g=>this._onInteraction(g,!0)),oe.on(this._element,YB,g=>this._onInteraction(g,!1)),oe.on(this._element,XB,g=>this._onInteraction(g,!0)),oe.on(this._element,JB,g=>this._onInteraction(g,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(g){return this.each(function(){let x=G.getOrCreateInstance(this,g);if(typeof g=="string"){if(typeof x[g]>"u")throw new TypeError('No method named "'.concat(g,'"'));x[g](this)}})}};Ip(Fp);yl(Fp);var Cp=fR(oF()),hU=fR(rU()),pU="pk.eyJ1IjoidXJzY2hyZWkiLCJhIjoiY2xzMzd6NzdnMHMxejJzbWszbHA2ZGk1ZCJ9.ovSNXA6ytYytX8zlex81iA",WU=["base","middle","top"],Uo=["ed","lea"],RC=[[-14.471549243406628,51.04252955091917],[-.016129311437452998,55.69861887397013]],sU=new Intl.NumberFormat("en-IE",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}),nn=new Map;nn.set("13260429","/dublin-city-council/artane-whitehall");nn.set("13260420","/dublin-city-council/ballymun-finglas");nn.set("13260422","/dublin-city-council/ballyfermot-drimnagh");nn.set("13260421","/dublin-city-council/cabra-glasnevin");nn.set("13260427","/dublin-city-council/clontarf");nn.set("13260428","/dublin-city-council/donaghmede");nn.set("13260423","/dublin-city-council/kimmage-rathmines");nn.set("13260426","/dublin-city-council/north-inner-city");nn.set("13260424","/dublin-city-council/pembroke");nn.set("13260425","/dublin-city-council/south-east-inner-city");nn.set("13260430","/dublin-city-council/south-west-inner-city");nn.set("13260417","/fingal-county-council/balbriggan");nn.set("13260403","/fingal-county-council/castleknock");nn.set("13260404","/fingal-county-council/howth-malahide");nn.set("13260402","/fingal-county-council/blanchardstown-mulhuddart");nn.set("13260401","/fingal-county-council/swords");nn.set("13260418","/fingal-county-council/ongar");nn.set("13260400","/fingal-county-council/rush-lusk");var uU;function dU(G){let g=G.features[0].properties.OBJECTID,x=G.features[0].layer.id,C="cso-".concat(Uo[1],"-polygons"),L=x===C?"cso-".concat(Uo[1],"-polygons"):"cso-".concat(Uo[0],"-polygons"),o=x===C?{type:"LEA",county:"".concat(G.features[0].properties.COUNTY),title:"Name: ".concat(G.features[0].properties.CSO_LEA),raw_id:G.features[0].properties.LEA_ID,id:"ID: ".concat(G.features[0].properties.LEA_ID),median_income:"Median Income (2021): ".concat(sU.format(G.features[0].properties.MEDIAN_INCOME)),median_price:"Median House Price (all transactions, 2021): ".concat(sU.format(G.features[0].properties.MEDIAN_PRICE))}:{type:"Electoral Division",county:"".concat(G.features[0].properties.COUNTY_ENGLISH),title:"Name: ".concat(G.features[0].properties.ED_ENGLISH),raw_id:G.features[0].properties.ED_ID_STR,id:"ID: ".concat(G.features[0].properties.ED_ID_STR)};x===C&&xC(G.features[0].properties.LEA_ID);let _=G.lngLat;for(;Math.abs(G.lngLat.lng-_[0])>180;)_[0]+=G.lngLat.lng>_[0]?360:-360;let ct=x===C?'<div class="row m-1">\n            <div class="container">\n                <div class="col">\n                      <div class="card text-bg-secondary">\n                            <div class="card-header">'.concat(o.type,'</div>\n                            <div class="card-body">\n                                <h5 class="card-title">').concat(o.id,'</h5>\n                                <h6 class="card-subtitle mb-2 text-orange text-opacity-75">').concat(o.county,'</h6>\n                                <ul class="list-group list-group-flush">\n                                    <li class="list-group-item">').concat(o.title,'</li>\n                                    <li class="list-group-item">').concat(o.median_income,'</li>\n                                    <li class="list-group-item">').concat(o.median_price,"</li>\n                                </ul>\n                            </div>\n                      </div>\n                </div>\n            </div>\n        </div>"):'<div class="row m-1">\n            <div class="container">\n                <div class="col">\n                    <div class="card text-bg-secondary">\n                        <div class="card-header">'.concat(o.type,'</div>\n                        <div class="card-body">\n                            <h5 class="card-title">').concat(o.id,'</h5>\n                            <h6 class="card-subtitle mb-2 text-orange text-opacity-75">').concat(o.county,'</h6>\n                            <p class="card-text">').concat(o.title,"</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>");ja.setPaintProperty(L,"fill-opacity",["match",["get","OBJECTID"],g,.5,0]),uU=new Cp.default.Popup().setLngLat(_).setHTML(ct).addTo(ja),UC(o.raw_id)}function cU(G){ja.getCanvas().style.cursor="pointer"}function bU(G){ja.getCanvas().style.cursor=""}function mU(G,g){ja.fire("closeAllPopups"),WU.forEach(x=>{let C="cso-".concat(G,"-polygons-").concat(x),L="cso-".concat(g,"-polygons-").concat(x),o="cso-".concat(g,"-polygons"),_=x==="base"||x==="middle"?.4:1;ja.setPaintProperty(C,"line-opacity",_),ja.setPaintProperty(L,"line-opacity",0),ja.setPaintProperty(o,"fill-opacity",0)})}function GC(G){let g=G.coords.longitude,x=G.coords.latitude;ja.flyTo({center:[g,x],zoom:15,essential:!0})}function FC(){let G=document.getElementById("locate");G.classList.add("btn-dark"),G.classList.remove("btn-outline-orange"),G.innerText="Couldn't geolocate you",G.disabled=!0}function Mp(G,g){let x="cso-".concat(G,"-polygons");g?(ja.off("click",x,dU),ja.off("mouseenter",x,cU),ja.off("mouseleave",x,bU)):(ja.on("click",x,dU),ja.on("mouseenter",x,cU),ja.on("mouseleave",x,bU))}var IC=new hU.default({accessToken:pU,mapboxgl:Cp.default,options:{placeholder:"Address search",countries:"ie",routing:!1,proximity:"ip",types:"address,place,locality",language:"en"}}),ja=new Cp.default.Map({accessToken:pU,container:"map",style:"mapbox://styles/urschrei/cls285qtr00ht01qqd92g58mt",maxBounds:RC,customAttribution:['<a href="https://www.geohive.ie/datasets/60b27acc557d4e8bb4b5a781f0622c39_1/about">Electoral Division</a> and <a href="https://www.geohive.ie/datasets/e73ec0ad02654778adca35fa86b24a5f_3/about">LEA data</a> provided by CSO']});ja.on("load",()=>{ja.resize(),WU.forEach(G=>{Uo.forEach(g=>{let x="cso-".concat(g,"-polygons-").concat(G);ja.setPaintProperty(x,"line-opacity-transition",{duration:500})})}),Uo.forEach(G=>{let g="cso-".concat(G,"-polygons");ja.setPaintProperty(g,"fill-opacity-transition",{duration:1e3})}),ja.addControl(IC),Xu(Uo[1])});ja.on("closeAllPopups",()=>{try{uU.remove()}catch{}});function UC(G){let g=window.location.pathname,x=new URLSearchParams(window.location.search),C=window.location.hash;x.set("id",G),window.history.replaceState({},"","".concat(g,"?").concat(x.toString()).concat(C))}function Xu(G){let g=Uo[0],x=Uo[1];if(G===g){let C=g,L=x;mU(C,L),Mp(C,!1),Mp(L,!0)}if(G===x){let C=x,L=g;mU(C,L),Mp(C,!1),Mp(L,!0)}document.getElementById(G).checked=!0}function xC(G){let g=nn.get(G),x=document.getElementById("le24");if(g){for(;x.firstChild;)x.removeChild(x.lastChild);let C="https://dublinvoterguide2024.ie/areas/".concat(g),L=document.createElement("mark"),o=document.createElement("a");o.href=C;let _=document.createTextNode("Voter Guide 24 candidate info");o.appendChild(_),L.appendChild(o),x.appendChild(L)}else x.textContent=""}document.addEventListener("click",function(G){let g=Uo[0],x=Uo[1];switch(G.target.id){case g:{Xu(g);break}case x:{Xu(x);break}case"locate":{navigator.geolocation.getCurrentPosition(GC,FC,{enableHighAccuracy:!0,timeout:2500});break}default:}});export{ja as map};
/*! Bundled license information:

mapbox-gl/dist/mapbox-gl.js:
  (**
   * tiny-lru
   *
   * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
   * @license BSD-3-Clause
   * @version 11.2.5
   *)

base-64/base64.js:
  (*! http://mths.be/base64 v0.1.0 by @mathias | MIT license *)

bootstrap/dist/js/bootstrap.esm.js:
  (*!
    * Bootstrap v5.3.2 (https://getbootstrap.com/)
    * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
    *)
*/
//# sourceMappingURL=index.js.map
